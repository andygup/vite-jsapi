import{e as a,y as l,n as o,m as g,t as u,v as m}from"./cast-daef7652.js";import{t as y}from"./typedArrayUtil-2bcf3cee.js";import{l as _,f as v,a as c,U as H}from"./reactiveUtils-3c1b281e.js";let h=class extends g{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new u,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,t,s={}){return this._installWatch(e,t,s,_)}addWhen(e,t,s={}){return this._installWatch(e,t,s,v)}addOnCollectionChange(e,t,{initial:s=!1,final:n=!1}={}){const d=++this._handleId;return this._handles.add([c(e,"after-changes",this._createSyncUpdatingCallback(),H),c(e,"change",t,{onListenerAdd:s?i=>t({added:i.toArray(),removed:[]}):void 0,onListenerRemove:n?i=>t({added:[],removed:i.toArray()}):void 0})],d),{remove:()=>this._handles.remove(d)}}addPromise(e){if(y(e))return e;const t=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(r)||this._set("updating",!1))}},t),this._pendingPromises.add(e),this._set("updating",!0);const s=()=>this._handles.remove(t);return e.then(s,s),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,s={},n){const d=++this._handleId;s.sync||this._installSyncUpdatingWatch(e,d);const i=n(e,t,s);return this._handles.add(i,d),{remove:()=>this._handles.remove(d)}}_installSyncUpdatingWatch(e,t){const s=this._createSyncUpdatingCallback(),n=_(e,s,{sync:!0,equals:()=>!1});return this._handles.add(n,t),n}_createSyncUpdatingCallback(){return()=>{this._handles.remove(r),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(m(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(r))}),r)}}};a([l({readOnly:!0})],h.prototype,"updating",void 0),h=a([o("esri.core.support.WatchUpdatingTracking")],h);const r=-42,I=e=>{let t=class extends e{destroy(){var s,n;this.destroyed||((s=this._get("handles"))==null||s.destroy(),(n=this._get("updatingHandles"))==null||n.destroy())}get handles(){return this._get("handles")||new u}get updatingHandles(){return this._get("updatingHandles")||new h}};return a([l({readOnly:!0})],t.prototype,"handles",null),a([l({readOnly:!0})],t.prototype,"updatingHandles",null),t=a([o("esri.core.HandleOwner")],t),t};let p=class extends I(g){};p=a([o("esri.core.HandleOwner")],p);export{I as a,h as c,p as d};
