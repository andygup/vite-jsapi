import{gu as it,gF as st,bv as lt,fS as D,gE as ct,ae as y,af as A,ai as ut,bH as ft,e as R,bC as gt,gG as pt,gH as Q,gI as U,gJ as b,gK as yt,gL as B,gM as ht,K as mt,gN as At,gO as Ft,gP as z,J as Pt,gQ as q,fM as H,fL as W,gR as $t,gA as Tt,gS as Mt,gT as vt,gU as wt,gV as C,gW as X,gX as dt,Q as xt,fr as Rt,dY as bt}from"./index-65afe59f.js";import{e as Z}from"./mat3f64-221ce671.js";import{e as F,o as Ct}from"./mat4f64-1413b4a7.js";import{c as v}from"./spatialReferenceEllipsoidUtils-2bc586ce.js";import{v as N,y as Ot,x as _t}from"./quat-30839e1b.js";import{e as S}from"./quatf64-3363c48e.js";import{r as T,n as P,s as tt}from"./vec32-112321df.js";import{i as h,T as m}from"./BufferView-f31a7c61.js";function M(t=zt){return[t[0],t[1],t[2],t[3]]}function fr(t,r,n=M()){return it(n,t),n[3]=r,n}function gr(t,r,n=M()){return N(w,t,L(t)),N(Y,r,L(r)),Ot(w,Y,w),Et(n,st(_t(n,w)))}function pr(t){return t}function L(t){return lt(t[3])}function Et(t,r){return t[3]=r,t}const zt=[0,0,1,0],w=S(),Y=S();M();function k(t,r=!1){return t<=D?r?new Array(t).fill(0):new Array(t):new Float64Array(t)}function Nt(t){return(ct(t)?t.length:t.byteLength/8)<=D?Array.from(t):new Float64Array(t)}function yr(t,r,n){return Array.isArray(t)?t.slice(r,r+n):t.subarray(r,r+n)}var j;let g=j=class extends ft{constructor(t){super(t),this.origin=R(),this.translation=R(),this.rotation=M(),this.scale=gt(1,1,1),this.geographic=!0}get localMatrix(){const t=F();return N(J,this.rotation,L(this.rotation)),pt(t,J,this.translation,this.scale),t}get localMatrixInverse(){return Q(F(),this.localMatrix)}applyLocal(t,r){return U(r,t,this.localMatrix)}applyLocalInverse(t,r){return U(r,t,this.localMatrixInverse)}project(t,r){if(this.geographic){const a=v(r),i=F();b(r,this.origin,i,a),yt(i,i,this.localMatrix);const l=k(t.length);return T(l,t,i),B(l,a,0,l,r,0,l.length/3),l}const{localMatrix:n,origin:e}=this,o=ht(n,Ct)?Nt(t):T(k(t.length),t,n);for(let a=0;a<o.length;a+=3)o[a]+=e[0],o[a+1]+=e[1],o[a+2]+=e[2];return o}getOriginPoint(t){const[r,n,e]=this.origin;return new mt({x:r,y:n,z:e,spatialReference:t})}equals(t){return t!=null&&this.geographic===t.geographic&&At(this.origin,t.origin)&&Ft(this.localMatrix,t.localMatrix)}clone(){const t={origin:z(this.origin),translation:z(this.translation),rotation:M(this.rotation),scale:z(this.scale),geographic:this.geographic};return new j(t)}};y([A({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"origin",void 0),y([A({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"translation",void 0),y([A({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"rotation",void 0),y([A({type:[Number],nonNullable:!0,json:{write:!0}})],g.prototype,"scale",void 0),y([A({type:Boolean,nonNullable:!0,json:{write:!0}})],g.prototype,"geographic",void 0),y([A()],g.prototype,"localMatrix",null),y([A()],g.prototype,"localMatrixInverse",null),g=j=y([ut("esri.geometry.support.MeshTransform")],g);const J=S(),Lt=g;function G(t,r){return t.isGeographic||t.isWebMercator&&((r==null?void 0:r.geographic)??!0)}const O=Pt.getLogger("esri.geometry.support.meshUtils.normalProjection");function jt(t,r,n,e,o){return E(e)?(_(p.TO_PCPF,h.fromTypedArray(t),m.fromTypedArray(r),m.fromTypedArray(n),e,h.fromTypedArray(o)),o):(O.error("Cannot convert spatial reference to PCPF"),o)}function Vt(t,r,n,e,o){return E(e)?(_(p.FROM_PCPF,h.fromTypedArray(t),m.fromTypedArray(r),m.fromTypedArray(n),e,h.fromTypedArray(o)),o):(O.error("Cannot convert to spatial reference from PCPF"),o)}function Bt(t,r,n){return B(t,r,0,n,v(r),0,t.length/3),n}function St(t,r,n){return B(t,v(n),0,r,n,0,t.length/3),r}function Gt(t,r,n){return C(c,n),P(r,t,c),X(c)||tt(r,r),r}function It(t,r,n){if(C(c,n),P(r,t,c,4),X(c)||tt(r,r,4),t!==r)for(let e=3;e<t.length;e+=4)r[e]=t[e];return r}function Ut(t,r,n,e,o){if(!E(e))return O.error("Cannot convert spatial reference to PCPF"),o;_(p.TO_PCPF,h.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),m.fromTypedArray(r),m.fromTypedArray(n),e,h.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function qt(t,r,n,e,o){if(!E(e))return O.error("Cannot convert to spatial reference from PCPF"),o;_(p.FROM_PCPF,h.fromTypedArray(t,16),m.fromTypedArray(r),m.fromTypedArray(n),e,h.fromTypedArray(o,16));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function _(t,r,n,e,o,a){if(!r)return;const i=n.count,l=v(o);if(rt(o))for(let u=0;u<i;u++)e.getVec(u,d),r.getVec(u,f),b(l,d,x,l),q(c,x),t===p.FROM_PCPF&&H(c,c),W(f,f,c),a.setVec(u,f);else for(let u=0;u<i;u++){e.getVec(u,d),r.getVec(u,f),b(l,d,x,l),q(c,x);const $=$t(n.get(u,1));let s=Math.cos($);t===p.TO_PCPF&&(s=1/s),c[0]*=s,c[1]*=s,c[2]*=s,c[3]*=s,c[4]*=s,c[5]*=s,t===p.FROM_PCPF&&H(c,c),W(f,f,c),Tt(f,f),a.setVec(u,f)}return a}function E(t){return rt(t)||Ht(t)}function rt(t){return t.isWGS84||Mt(t)||vt(t)||wt(t)}function Ht(t){return t.isWebMercator}var p;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(p||(p={}));const d=R(),f=R(),x=F(),c=Z();function nt(t,r,n){return G(r.spatialReference,n)?kt(t,r,n):Yt(t,r,n)}function Wt(t,r,n){const{position:e,normal:o,tangent:a}=t;if(r==null)return{position:e,normal:o,tangent:a};const i=r.localMatrix;return nt({position:T(new Float64Array(e.length),e,i),normal:o!=null?Gt(o,new Float32Array(o.length),i):null,tangent:a!=null?It(a,new Float32Array(a.length),i):null},r.getOriginPoint(n),{geographic:r.geographic})}function hr(t,r,n){if(n!=null&&n.useTransform){const{position:e,normal:o,tangent:a}=t;return{vertexAttributes:{position:e,normal:o,tangent:a},transform:new Lt({origin:[r.x,r.y,r.z??0],geographic:G(r.spatialReference,n)})}}return{vertexAttributes:nt(t,r,n),transform:null}}function K(t,r,n){return G(r.spatialReference,n)?Qt(t,r,n):et(t,r,n)}function mr(t,r,n,e){if(r==null)return K(t,n,e);const o=Wt(t,r,n.spatialReference);return n.equals(r.getOriginPoint(n.spatialReference))?et(o,n,e):K(o,n,e)}function Yt(t,r,n){const e=new Float64Array(t.position.length),o=t.position,a=r.x,i=r.y,l=r.z||0,{horizontal:u,vertical:$}=I(n?n.unit:null,r.spatialReference);for(let s=0;s<o.length;s+=3)e[s]=o[s]*u+a,e[s+1]=o[s+1]*u+i,e[s+2]=o[s+2]*$+l;return{position:e,normal:t.normal,tangent:t.tangent}}function kt(t,r,n){const e=r.spatialReference,o=ot(r,n,V),a=new Float64Array(t.position.length),i=Jt(t.position,o,e,a),l=C(at,o);return{position:i,normal:Kt(i,a,t.normal,l,e),tangent:Dt(i,a,t.tangent,l,e)}}function Jt(t,r,n,e){T(e,t,r);const o=new Float64Array(t.length);return St(e,o,n)}function Kt(t,r,n,e,o){if(n==null)return null;const a=new Float32Array(n.length);return P(a,n,e),Vt(a,t,r,o,a),a}function Dt(t,r,n,e,o){if(n==null)return null;const a=new Float32Array(n.length);P(a,n,e,4);for(let i=3;i<a.length;i+=4)a[i]=n[i];return qt(a,t,r,o,a),a}function et(t,r,n){const e=new Float64Array(t.position.length),o=t.position,a=r.x,i=r.y,l=r.z||0,{horizontal:u,vertical:$}=I(n?n.unit:null,r.spatialReference);for(let s=0;s<o.length;s+=3)e[s]=(o[s]-a)/u,e[s+1]=(o[s+1]-i)/u,e[s+2]=(o[s+2]-l)/$;return{position:e,normal:t.normal,tangent:t.tangent}}function Qt(t,r,n){const e=r.spatialReference;ot(r,n,V);const o=Q(rr,V),a=new Float64Array(t.position.length),i=Xt(t.position,e,o,a),l=C(at,o);return{position:i,normal:Zt(t.normal,t.position,a,e,l),tangent:tr(t.tangent,t.position,a,e,l)}}function ot(t,r,n){b(t.spatialReference,[t.x,t.y,t.z||0],n,v(t.spatialReference));const{horizontal:e,vertical:o}=I(r?r.unit:null,t.spatialReference);return dt(n,n,[e,e,o]),n}function Xt(t,r,n,e){const o=Bt(t,r,e),a=new Float64Array(o.length);return T(a,o,n),a}function Zt(t,r,n,e,o){if(t==null)return null;const a=jt(t,r,n,e,new Float32Array(t.length));return P(a,a,o),a}function tr(t,r,n,e,o){if(t==null)return null;const a=Ut(t,r,n,e,new Float32Array(t.length));return P(a,a,o,4),a}function I(t,r){if(t==null)return nr;const n=r.isGeographic?1:xt(r),e=r.isGeographic?1:Rt(r),o=bt(1,t,"meters");return{horizontal:o*n,vertical:o*e}}const V=F(),rr=F(),at=Z(),nr={horizontal:1,vertical:1};export{St as E,Lt as L,Ut as R,jt as _,yr as a,qt as b,M as c,gr as d,Nt as e,L as f,pr as g,Bt as h,fr as i,Vt as j,K as k,mr as l,G as r,k as t,Wt as v,hr as x,nt as z};
