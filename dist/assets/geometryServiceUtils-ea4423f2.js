import{b as l,a as f}from"./Error-bd05b442.js";import{j as S}from"./Portal-ac0dca24.js";import{U as h}from"./request-c2b0ab45.js";import{b as d}from"./ensureType-fa162cfc.js";import{c}from"./jsonUtils-8bd548d9.js";import{f as w,b as R,o as v}from"./normalizeUtils-d322ac85.js";import{e as m,y as p,n as $,l as J}from"./cast-daef7652.js";import"./typedArrayUtil-2bcf3cee.js";import"./string-3d0ebcd3.js";import"./preload-helper-101896b7.js";import"./Loadable-7c89bd10.js";import"./Promise-088a0e17.js";import"./promiseUtils-29120e0a.js";import"./Extent-7f29a1bb.js";import"./locale-30120714.js";import"./PortalGroup-f3dee6d8.js";import"./jsonMap-a9c94baf.js";import"./PortalUser-cdb4116b.js";import"./nextTick-3ee5a785.js";import"./Polyline-c56eca9b.js";import"./geometry-4b789d90.js";import"./typeUtils-d7b057b5.js";let a=class extends J{constructor(r){super(r),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const r=this.geometries.map(i=>i.toJSON()),e=this.geometries[0],t={};return t.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),t.inSR=e.spatialReference.wkid||JSON.stringify(e.spatialReference.toJSON()),t.geometries=JSON.stringify({geometryType:c(e),geometries:r}),this.transformation&&(t.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(t.transformForward=this.transformForward),t}};m([p()],a.prototype,"geometries",void 0),m([p({json:{read:{source:"outSR"}}})],a.prototype,"outSpatialReference",void 0),m([p()],a.prototype,"transformation",void 0),m([p()],a.prototype,"transformForward",void 0),a=m([$("esri.rest.support.ProjectParameters")],a);const u=a,N=d(u);async function O(o,r,e){r=N(r);const t=w(o),i={...t.query,f:"json",...r.toJSON()},n=r.outSpatialReference,s=c(r.geometries[0]),g=R(i,e);return h(t.path+"/project",g).then(({data:{geometries:y}})=>v(y,s,n))}async function j(o=null,r){var i,n;if(l.geometryServiceUrl)return l.geometryServiceUrl;if(!o)throw new f("internal:geometry-service-url-not-configured");let e;e="portal"in o?o.portal||S.getDefault():o,await e.load({signal:r});const t=(n=(i=e.helperServices)==null?void 0:i.geometry)==null?void 0:n.url;if(!t)throw new f("internal:geometry-service-url-not-configured");return t}async function X(o,r,e=null,t){const i=await j(e,t),n=new u;n.geometries=[o],n.outSpatialReference=r;const s=await O(i,n,{signal:t});if(s&&Array.isArray(s)&&s.length===1)return s[0];throw new f("internal:geometry-service-projection-failed")}export{j as getGeometryServiceURL,X as projectGeometry};
