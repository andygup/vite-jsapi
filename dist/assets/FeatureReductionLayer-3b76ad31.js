import{ae as r,af as n,ai as f,bH as N,eF as V,eG as A,em as F,bf as G,bK as I,bJ as m,ex as _,cJ as d,cK as c,fb as K}from"./index-65afe59f.js";import{w as H}from"./FeatureEffect-8de6067b.js";import{a as g,c as P}from"./clusterUtils-a342a95a.js";import{A as L}from"./UniqueValueRenderer-c45fa812.js";import{b as B,o as S,p as x}from"./jsonUtils-cf75a5b6.js";import{m as J,p as O}from"./commonProperties-605b6017.js";import{C as k}from"./labelingInfo-a25619a7.js";const T={write:{allowNull:!0}},ie=i=>{let e=class extends i{constructor(){super(...arguments),this.featureEffect=null}};return r([n({type:H,json:{origins:{"web-map":T,"portal-item":T}}})],e.prototype,"featureEffect",void 0),e=r([f("esri.layers.mixins.FeatureEffectLayer")],e),e};let y=class extends N{constructor(){super(...arguments),this.type=null}};r([n({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],y.prototype,"type",void 0),y=r([f("esri.layers.support.FeatureReduction")],y);var R;const w=V({types:A}),Q="esri.layers.support.FeatureReductionBinning";let p=R=class extends y{constructor(i){super(i),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(i,e,o){const t=i.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());_(o,t,e)}readRenderer(i,e,o){var s;const t=(s=e.drawingInfo)==null?void 0:s.renderer;return t?S(t,e,o)??void 0:e.defaultSymbol?e.types&&e.types.length?new L({defaultSymbol:w(e.defaultSymbol,e,o),field:e.typeIdField,uniqueValueInfos:e.types.map(a=>({id:a.id,symbol:w(a.symbol,a,o)}))}):new x({symbol:w(e.defaultSymbol,e,o)}):null}clone(){return new R({fields:d(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:d(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:d(this.popupTemplate),renderer:d(this.renderer)})}};r([F({binning:"binning"})],p.prototype,"type",void 0),r([F({geohash:"geohash"})],p.prototype,"binType",void 0),r([n({type:Number,range:{min:1,max:9},json:{write:!0}})],p.prototype,"fixedBinLevel",void 0),r([n({type:[k],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],p.prototype,"labelingInfo",void 0),r([n(J)],p.prototype,"labelsVisible",void 0),r([n({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],p.prototype,"maxScale",void 0),r([n(O)],p.prototype,"popupEnabled",void 0),r([n({type:G,json:{name:"popupInfo",write:!0}})],p.prototype,"popupTemplate",void 0),r([n({type:[g],json:{write:!0}})],p.prototype,"fields",void 0),r([I("fields")],p.prototype,"writeFields",null),r([n({types:B,json:{write:{target:"drawingInfo.renderer"}}})],p.prototype,"renderer",void 0),r([m("renderer",["drawingInfo.renderer"])],p.prototype,"readRenderer",null),p=R=r([f(Q)],p);const q=p;var $;const v=V({types:A}),U="esri.layers.support.FeatureReductionCluster";function z(i){var e;return i.type==="simple"&&!((e=i.visualVariables)!=null&&e.length)}let l=$=class extends N{constructor(i){super(i),this.type="cluster",this.clusterRadius=c("80px"),this.clusterMinSize=c("12px"),this.clusterMaxSize=c("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(i,e,o){var s,a;const t=(s=e.drawingInfo)==null?void 0:s.renderer;return(a=t==null?void 0:t.authoringInfo)!=null&&a.isAutoGenerated?null:t?z(t)?null:S(t,e,o)??void 0:e.defaultSymbol?e.types&&e.types.length?new L({defaultSymbol:v(e.defaultSymbol,e,o),field:e.typeIdField,uniqueValueInfos:e.types.map(u=>({id:u.id,symbol:v(u.symbol,u,o)}))}):new x({symbol:v(e.defaultSymbol,e,o)}):null}readSymbol(i,e,o){var s,a;const t=(s=e.drawingInfo)==null?void 0:s.renderer;if((a=t==null?void 0:t.authoringInfo)!=null&&a.isAutoGenerated)return null;if(t&&z(t)){const u=S(t,e,o);return u==null?void 0:u.symbol}return null}writeSymbol(i,e,o,t){var a,u;const s=(u=(a=this.renderer)==null?void 0:a.authoringInfo)==null?void 0:u.isAutoGenerated;if(!this.renderer||s){const b=new x({symbol:i});e.drawingInfo={renderer:b.write({},t)}}}writeFields(i,e,o){const t=i.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());_(o,t,e)}readFields(i,e,o){return i.filter(t=>!t.isAutoGenerated).map(t=>g.fromJSON(t))}clone(){return new $({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:d(this.labelingInfo),labelsVisible:this.labelsVisible,fields:d(this.fields),maxScale:this.maxScale,renderer:d(this.renderer),symbol:d(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:d(this.popupTemplate)})}};r([n({type:["cluster"],readOnly:!0,json:{write:!0}})],l.prototype,"type",void 0),r([n({type:Number,cast:i=>i==="auto"?i:c(i),json:{write:!0}})],l.prototype,"clusterRadius",void 0),r([n({type:Number,cast:c,json:{write:!0}})],l.prototype,"clusterMinSize",void 0),r([n({type:Number,cast:c,json:{write:!0}})],l.prototype,"clusterMaxSize",void 0),r([n({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],l.prototype,"maxScale",void 0),r([n(O)],l.prototype,"popupEnabled",void 0),r([n({type:G,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],l.prototype,"popupTemplate",void 0),r([n({types:B,json:{write:{target:"drawingInfo.renderer"}}})],l.prototype,"renderer",void 0),r([m("renderer",["drawingInfo.renderer"])],l.prototype,"readRenderer",null),r([n({types:K})],l.prototype,"symbol",void 0),r([m("symbol",["drawingInfo.renderer"])],l.prototype,"readSymbol",null),r([I("symbol")],l.prototype,"writeSymbol",null),r([n({type:[k],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],l.prototype,"labelingInfo",void 0),r([n(J)],l.prototype,"labelsVisible",void 0),r([n({type:[g],json:{write:!0}})],l.prototype,"fields",void 0),r([I("fields")],l.prototype,"writeFields",null),r([m("fields")],l.prototype,"readFields",null),l=$=r([f(U)],l);const C=l;var j;let h=j=class extends y{constructor(i){super(i),this.type="selection"}clone(){return new j}};r([n({type:["selection"]})],h.prototype,"type",void 0),h=j=r([f("esri.layers.support.FeatureReductionSelection")],h);const M=h,E={key:"type",base:y,typeMap:{cluster:C,binning:q}},W={types:{key:"type",base:y,typeMap:{selection:M,cluster:C,binning:q}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:E},"portal-item":{types:E},"web-scene":{types:{key:"type",base:y,typeMap:{selection:M}}}}}},se=i=>{let e=class extends i{constructor(...o){super(...o),this.own(this.watch("renderer",()=>{if(this.featureReduction){const t=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",t)}},!0))}set featureReduction(o){const t=this._normalizeFeatureReduction(o);this._set("featureReduction",t)}set renderer(o){}_normalizeFeatureReduction(o){var b;if((o==null?void 0:o.type)!=="cluster")return o;const t=o.clone(),s=[new g({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],a=(t.fields??[]).filter(D=>!D.isAutoGenerated);if(o.renderer&&!((b=o.renderer.authoringInfo)!=null&&b.isAutoGenerated))return t.fields=[...s,...a],t;if(o.symbol)return t.fields=[...s,...a],t.renderer=null,t;if(!this.renderer)return o;const u=P(s,this.renderer,o,null,!1);return t.fields=[...s,...a],t.renderer=u,t}};return r([n(W)],e.prototype,"featureReduction",null),e=r([f("esri.layers.mixins.FeatureReductionLayer")],e),e};export{M as a,se as n,ie as p,y as t};
