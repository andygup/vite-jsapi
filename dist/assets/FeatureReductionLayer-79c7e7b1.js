import{ae as t,af as s,ai as b,bD as L,ez as C,eA as A,eg as M,bb as $,bG as j,bF as h,er as N,cE as y,cF as f,f5 as K}from"./index-b4b3ae7d.js";import{a as Q}from"./FeatureEffect-1ace3eec.js";import{A as g,b as W}from"./clusterUtils-651430bd.js";import{U as B}from"./UniqueValueRenderer-51ab4299.js";import{a as G,r as F,S}from"./jsonUtils-930956cb.js";import{l as D,p as O}from"./commonProperties-6e3ee32c.js";import{L as k}from"./labelingInfo-90efb402.js";const E={write:{allowNull:!0}},ae=p=>{let i=class extends p{constructor(){super(...arguments),this.featureEffect=null}};return t([s({type:Q,json:{origins:{"web-map":E,"portal-item":E}}})],i.prototype,"featureEffect",void 0),i=t([b("esri.layers.mixins.FeatureEffectLayer")],i),i};let c=class extends L{constructor(){super(...arguments),this.type=null}};t([s({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0);c=t([b("esri.layers.support.FeatureReduction")],c);var I;const w=C({types:A}),X="esri.layers.support.FeatureReductionBinning";let u=I=class extends c{constructor(i){super(i),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(i,r,n){const e=i.filter(l=>l.statisticType!=="avg_angle").map(l=>l.toJSON());N(n,e,r)}readRenderer(i,r,n){var l;const e=(l=r.drawingInfo)==null?void 0:l.renderer;return e?F(e,r,n)??void 0:r.defaultSymbol?r.types&&r.types.length?new B({defaultSymbol:w(r.defaultSymbol,r,n),field:r.typeIdField,uniqueValueInfos:r.types.map(a=>({id:a.id,symbol:w(a.symbol,a,n)}))}):new S({symbol:w(r.defaultSymbol,r,n)}):null}clone(){return new I({fields:y(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:y(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:y(this.popupTemplate),renderer:y(this.renderer)})}};t([M({binning:"binning"})],u.prototype,"type",void 0);t([M({geohash:"geohash"})],u.prototype,"binType",void 0);t([s({type:Number,range:{min:1,max:9},json:{write:!0}})],u.prototype,"fixedBinLevel",void 0);t([s({type:[k],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],u.prototype,"labelingInfo",void 0);t([s(D)],u.prototype,"labelsVisible",void 0);t([s({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],u.prototype,"maxScale",void 0);t([s(O)],u.prototype,"popupEnabled",void 0);t([s({type:$,json:{name:"popupInfo",write:!0}})],u.prototype,"popupTemplate",void 0);t([s({type:[g],json:{write:!0}})],u.prototype,"fields",void 0);t([j("fields")],u.prototype,"writeFields",null);t([s({types:G,json:{write:{target:"drawingInfo.renderer"}}})],u.prototype,"renderer",void 0);t([h("renderer",["drawingInfo.renderer"])],u.prototype,"readRenderer",null);u=I=t([b(X)],u);const q=u;var v;const R=C({types:A}),Y="esri.layers.support.FeatureReductionCluster";function V(p){var i;return p.type==="simple"&&!((i=p.visualVariables)!=null&&i.length)}let o=v=class extends L{constructor(i){super(i),this.type="cluster",this.clusterRadius=f("80px"),this.clusterMinSize=f("12px"),this.clusterMaxSize=f("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(i,r,n){var l,a;const e=(l=r.drawingInfo)==null?void 0:l.renderer;return(a=e==null?void 0:e.authoringInfo)!=null&&a.isAutoGenerated?null:e?V(e)?null:F(e,r,n)??void 0:r.defaultSymbol?r.types&&r.types.length?new B({defaultSymbol:R(r.defaultSymbol,r,n),field:r.typeIdField,uniqueValueInfos:r.types.map(d=>({id:d.id,symbol:R(d.symbol,d,n)}))}):new S({symbol:R(r.defaultSymbol,r,n)}):null}readSymbol(i,r,n){var l,a;const e=(l=r.drawingInfo)==null?void 0:l.renderer;if((a=e==null?void 0:e.authoringInfo)!=null&&a.isAutoGenerated)return null;if(e&&V(e)){const d=F(e,r,n);return d==null?void 0:d.symbol}return null}writeSymbol(i,r,n,e){var a,d;const l=(d=(a=this.renderer)==null?void 0:a.authoringInfo)==null?void 0:d.isAutoGenerated;if(!this.renderer||l){const T=new S({symbol:i});r.drawingInfo={renderer:T.write({},e)}}}writeFields(i,r,n){const e=i.filter(l=>l.statisticType!=="avg_angle").map(l=>l.toJSON());N(n,e,r)}readFields(i,r,n){return i.filter(e=>!e.isAutoGenerated).map(e=>g.fromJSON(e))}clone(){return new v({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:y(this.labelingInfo),labelsVisible:this.labelsVisible,fields:y(this.fields),maxScale:this.maxScale,renderer:y(this.renderer),symbol:y(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:y(this.popupTemplate)})}};t([s({type:["cluster"],readOnly:!0,json:{write:!0}})],o.prototype,"type",void 0);t([s({type:Number,cast:p=>p==="auto"?p:f(p),json:{write:!0}})],o.prototype,"clusterRadius",void 0);t([s({type:Number,cast:f,json:{write:!0}})],o.prototype,"clusterMinSize",void 0);t([s({type:Number,cast:f,json:{write:!0}})],o.prototype,"clusterMaxSize",void 0);t([s({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],o.prototype,"maxScale",void 0);t([s(O)],o.prototype,"popupEnabled",void 0);t([s({type:$,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],o.prototype,"popupTemplate",void 0);t([s({types:G,json:{write:{target:"drawingInfo.renderer"}}})],o.prototype,"renderer",void 0);t([h("renderer",["drawingInfo.renderer"])],o.prototype,"readRenderer",null);t([s({types:K})],o.prototype,"symbol",void 0);t([h("symbol",["drawingInfo.renderer"])],o.prototype,"readSymbol",null);t([j("symbol")],o.prototype,"writeSymbol",null);t([s({type:[k],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],o.prototype,"labelingInfo",void 0);t([s(D)],o.prototype,"labelsVisible",void 0);t([s({type:[g],json:{write:!0}})],o.prototype,"fields",void 0);t([j("fields")],o.prototype,"writeFields",null);t([h("fields")],o.prototype,"readFields",null);o=v=t([b(Y)],o);const P=o;var x;let m=x=class extends c{constructor(i){super(i),this.type="selection"}clone(){return new x}};t([s({type:["selection"]})],m.prototype,"type",void 0);m=x=t([b("esri.layers.support.FeatureReductionSelection")],m);const J=m,Z={key:"type",base:c,typeMap:{selection:J}},z={key:"type",base:c,typeMap:{cluster:P,binning:q}},ee={types:{key:"type",base:c,typeMap:{selection:J,cluster:P,binning:q}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:z},"portal-item":{types:z},"web-scene":{types:Z}}}},fe=p=>{let i=class extends p{constructor(...n){super(...n),this.own(this.watch("renderer",()=>{if(this.featureReduction){const e=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",e)}},!0))}set featureReduction(n){const e=this._normalizeFeatureReduction(n);this._set("featureReduction",e)}set renderer(n){}_normalizeFeatureReduction(n){var _;if((n==null?void 0:n.type)!=="cluster")return n;const e=n.clone(),a=[new g({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],d=(e.fields??[]).filter(H=>!H.isAutoGenerated);if(n.renderer&&!((_=n.renderer.authoringInfo)!=null&&_.isAutoGenerated))return e.fields=[...a,...d],e;if(n.symbol)return e.fields=[...a,...d],e.renderer=null,e;if(!this.renderer)return n;const U=W(a,this.renderer,n,null,!1);return e.fields=[...a,...d],e.renderer=U,e}};return t([s(ee)],i.prototype,"featureReduction",null),i=t([b("esri.layers.mixins.FeatureReductionLayer")],i),i};export{fe as F,ae as a,c as b,J as c};
