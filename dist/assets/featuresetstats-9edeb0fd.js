import{A as F,E as h}from"./executionError-e2eca390.js";import{p as w,q as e,m as g,l as S,n as y,al as s,L as l}from"./arcadeUtils-938fc326.js";import{W as a}from"./WhereClause-8e84f842.js";import"./index-fb3bdf4f.js";import"./arcadeTimeUtils-275f29fb.js";import"./FieldsIndex-56690a21.js";import"./number-c93bbabc.js";import"./Field-f5f1ebb3.js";import"./fieldType-d335b740.js";import"./featureConversionUtils-f24a23cd.js";import"./OptimizedGeometry-af84d2ad.js";import"./OptimizedFeatureSet-5c82fe5a.js";import"./sizeVariableUtils-2914222a.js";import"./_commonjsHelpers-725317a4.js";async function o(i,u,n,t,r,c){if(t.length===1){if(g(t[0]))return s(i,t[0],l(t[1],-1));if(y(t[0]))return s(i,t[0].toArray(),l(t[1],-1))}else if(t.length===2){if(g(t[0]))return s(i,t[0],l(t[1],-1));if(y(t[0]))return s(i,t[0].toArray(),l(t[1],-1));if(e(t[0])){const f=await t[0].load(),d=await A(a.create(t[1],f.getFieldsIndex()),c,r);return t[0].calculateStatistic(i,d,l(t[2],1e3),u.abortSignal)}}else if(t.length===3&&e(t[0])){const f=await t[0].load(),d=await A(a.create(t[1],f.getFieldsIndex()),c,r);return t[0].calculateStatistic(i,d,l(t[2],1e3),u.abortSignal)}return s(i,t,-1)}async function A(i,u,n){const t=i.getVariables();if(t.length>0){const r=[];for(let f=0;f<t.length;f++){const d={name:t[f]};r.push(await u.evaluateIdentifier(n,d))}const c={};for(let f=0;f<t.length;f++)c[t[f]]=r[f];return i.parameters=c,i}return i}function C(i){i.mode==="async"&&(i.functions.stdev=function(u,n){return i.standardFunctionAsync(u,n,(t,r,c)=>o("stdev",t,r,c,u,i))},i.functions.variance=function(u,n){return i.standardFunctionAsync(u,n,(t,r,c)=>o("variance",t,r,c,u,i))},i.functions.average=function(u,n){return i.standardFunctionAsync(u,n,(t,r,c)=>o("mean",t,r,c,u,i))},i.functions.mean=function(u,n){return i.standardFunctionAsync(u,n,(t,r,c)=>o("mean",t,r,c,u,i))},i.functions.sum=function(u,n){return i.standardFunctionAsync(u,n,(t,r,c)=>o("sum",t,r,c,u,i))},i.functions.min=function(u,n){return i.standardFunctionAsync(u,n,(t,r,c)=>o("min",t,r,c,u,i))},i.functions.max=function(u,n){return i.standardFunctionAsync(u,n,(t,r,c)=>o("max",t,r,c,u,i))},i.functions.count=function(u,n){return i.standardFunctionAsync(u,n,(t,r,c)=>{if(w(c,1,1,u,n),e(c[0]))return c[0].count(t.abortSignal);if(g(c[0])||S(c[0]))return c[0].length;if(y(c[0]))return c[0].length();throw new F(u,h.InvalidParameter,n)})})}export{C as registerFunctions};
