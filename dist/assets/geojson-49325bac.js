import{a as P}from"./Error-bd05b442.js";import{s as N,t as $}from"./OptimizedFeature-9345d11b.js";import{p as G,i as C}from"./fieldUtils-021fea8a.js";const J={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function b(t){return J[t]}function*M(t){switch(t.type){case"Feature":yield t;break;case"FeatureCollection":for(const n of t.features)n&&(yield n)}}function*x(t){if(!t)return null;switch(t.type){case"Point":yield t.coordinates;break;case"LineString":case"MultiPoint":yield*t.coordinates;break;case"MultiLineString":case"Polygon":for(const n of t.coordinates)yield*n;break;case"MultiPolygon":for(const n of t.coordinates)for(const o of n)yield*o}}function*A(t,n={}){const{geometryType:o,objectIdField:e}=n;for(const r of t){const{geometry:s,properties:p,id:i}=r;if(s&&b(s.type)!==o)continue;const c=p||{};let l=c[e]??null;e&&i!=null&&!c[e]&&(c[e]=l=i),yield new N(s?Z(new $,s,n):null,c,null,l)}}function D(t){for(const n of t)if(n.length>2)return!0;return!1}function E(t){return!k(t)}function R(t){return k(t)}function k(t){let n=0;for(let o=0;o<t.length;o++){const e=t[o],r=t[(o+1)%t.length];n+=e[0]*r[1]-r[0]*e[1]}return n<=0}function T(t){const n=t[0],o=t[t.length-1];return n[0]===o[0]&&n[1]===o[1]&&n[2]===o[2]||t.push(n),t}function Z(t,n,o){switch(n.type){case"LineString":return H(t,n,o);case"MultiLineString":return q(t,n,o);case"MultiPoint":return v(t,n,o);case"MultiPolygon":return z(t,n,o);case"Point":return B(t,n,o);case"Polygon":return K(t,n,o)}}function H(t,n,o){return g(t,n.coordinates,o),t}function q(t,n,o){for(const e of n.coordinates)g(t,e,o);return t}function v(t,n,o){return g(t,n.coordinates,o),t}function z(t,n,o){for(const e of n.coordinates){L(t,e[0],o);for(let r=1;r<e.length;r++)O(t,e[r],o)}return t}function B(t,n,o){return S(t,n.coordinates,o),t}function K(t,n,o){const e=n.coordinates;L(t,e[0],o);for(let r=1;r<e.length;r++)O(t,e[r],o);return t}function L(t,n,o){const e=T(n);E(e)?I(t,e,o):g(t,e,o)}function O(t,n,o){const e=T(n);R(e)?I(t,e,o):g(t,e,o)}function g(t,n,o){for(const e of n)S(t,e,o);t.lengths.push(n.length)}function I(t,n,o){for(let e=n.length-1;e>=0;e--)S(t,n[e],o);t.lengths.push(n.length)}function S(t,n,o){const[e,r,s]=n;t.coords.push(e,r),o.hasZ&&t.coords.push(s||0)}function Q(t){switch(typeof t){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function X(t){if(!t)throw new P("geojson-layer:empty","GeoJSON data is empty");if(t.type!=="Feature"&&t.type!=="FeatureCollection")throw new P("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:t});const{crs:n}=t;if(!n)return;const o=typeof n=="string"?n:n.type==="name"?n.properties.name:n.type==="EPSG"?n.properties.code:null,e=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!e.test(o))throw new P("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function Y(t,n={}){const o=[],e=new Set,r=new Set;let s,p=!1,i=null,c=!1,{geometryType:l=null}=n,m=!1;for(const d of M(t)){const{geometry:h,properties:f,id:a}=d;if((!h||(l||(l=b(h.type)),b(h.type)===l))&&(p||(p=D(x(h))),c||(c=a!=null,c&&(s=typeof a,i=Object.keys(f).filter(y=>f[y]===a))),c&&a!=null&&(i.length>1?i=i.filter(y=>f[y]===a):i.length===1&&(i=f[i[0]]===a?i:[])),!m&&f)){let y=!0;for(const u in f){if(e.has(u))continue;const F=f[u];if(F==null){y=!1,r.add(u);continue}const j=Q(F);j!=="unknown"?(r.delete(u),e.add(u),o.push({name:G(u),alias:u,type:j})):r.add(u)}m=y}}const w=G((i==null?void 0:i.length)===1&&i[0]||null);if(w){for(const d of o)if(d.name===w&&C(d)){d.type="esriFieldTypeOID";break}}return{fields:o,geometryType:l,hasZ:p,objectIdFieldName:w,objectIdFieldType:s,unknownFields:Array.from(r)}}function _(t,n){return Array.from(A(M(t),n))}export{_ as I,Y as L,X as T,b as s};
