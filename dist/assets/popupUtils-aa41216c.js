import{k as f,c as m,u as l,d as p,l as F}from"./PopupTemplate-343851b8.js";import{h as b,E as g}from"./fieldUtils-021fea8a.js";const w=["oid","global-id"],y=["oid","global-id","guid"];function B({displayField:e,editFieldsInfo:i,fields:t,objectIdField:n,title:a},o){if(!t)return null;const s=h({editFieldsInfo:i,fields:t,objectIdField:n},o);if(!s.length)return null;const c=N({titleBase:a,fields:t,displayField:e}),u=v();return new f({title:c,content:u,fieldInfos:s})}const $=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],I=(e,{editFieldsInfo:i,objectIdField:t,visibleFieldNames:n})=>n?n.has(e.name):!d(e.name,i)&&(!t||e.name!==t)&&!w.includes(e.type)&&!$.some(a=>a.test(e.name));function L(e,i){const t=e;return i&&(e=e.filter(n=>!i.includes(n.type))),e===t&&(e=e.slice()),e.sort(C),e}function C(e,i){return e.type==="oid"?-1:i.type==="oid"?1:r(e)?-1:r(i)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((i.alias||i.name).toLocaleLowerCase())}function d(e,i){if(!e||!i)return!1;const{creationDateField:t,creatorField:n,editDateField:a,editorField:o}=i;return[t&&t.toLowerCase(),n&&n.toLowerCase(),a&&a.toLowerCase(),o&&o.toLowerCase()].includes(e.toLowerCase())}function _(e,i){return e.editable&&!y.includes(e.type)&&!d(e.name,i)}function h({editFieldsInfo:e,fields:i,objectIdField:t},n){return L(i??[],(n==null?void 0:n.ignoreFieldTypes)||k).map(a=>new m({fieldName:a.name,isEditable:_(a,e),label:a.alias,format:j(a),visible:I(a,{editFieldsInfo:e,objectIdField:t,visibleFieldNames:n==null?void 0:n.visibleFieldNames})}))}function j(e){switch(e.type){case"small-integer":case"integer":case"single":return new l({digitSeparator:!0,places:0});case"double":return new l({digitSeparator:!0,places:2});case"date":return new l({dateFormat:"long-month-day-year"});default:return e.type==="string"&&b(e.name)?new l({digitSeparator:!0,places:0}):null}}function v(){return[new p,new F]}function N(e){const i=g(e),{titleBase:t}=e;return i?`${t}: {${i.trim()}}`:t??""}function r(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"}const k=["geometry","blob","raster","guid","xml"];export{B as p};
