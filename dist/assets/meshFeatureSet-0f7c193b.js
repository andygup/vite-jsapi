import{g as de}from"./Graphic-cf98a91a.js";import{r as c,t as ot}from"./typedArrayUtil-2bcf3cee.js";import{r as ye,o as xe,w as E,p as we,a as Tt}from"./Extent-7f29a1bb.js";import{_ as pt}from"./preload-helper-101896b7.js";import{e as p,y as d,n as Q,l as xt,s as W}from"./cast-daef7652.js";import{s as $,a as Mt}from"./Error-bd05b442.js";import{a as ve}from"./HandleOwner-78d35324.js";import{m as $e}from"./Loadable-7c89bd10.js";import{m as Ae}from"./Promise-088a0e17.js";import{y as Dt,L as be,p as Te,f as Me}from"./promiseUtils-29120e0a.js";import{l as Fe}from"./reactiveUtils-3c1b281e.js";import{v as Ft}from"./ensureType-fa162cfc.js";import{n as M,f as Qt,a as vt}from"./common-701a4199.js";import{k as Re,v as Le}from"./Polyline-c56eca9b.js";import{r as wt,b as Ce,x as Oe,M as Et,j as It,a as Pt,O as St,h as jt,L as Nt,_ as _e,c as st,v as Rt,g as Lt,d as De,e as ct,f as ht}from"./georeference-eb1d0a87.js";import{y as _}from"./string-3d0ebcd3.js";import{l as te}from"./Color-2245b966.js";import{r as Ee}from"./imageUtils-c2d0d1ae.js";import{f as Ie,m as Ht}from"./persistableUrlUtils-7e525def.js";import{x as Pe}from"./earcut-58237617.js";import{n as Se}from"./deduplicate-eb9d58da.js";import{g as N,Z as ee}from"./projection-33a6cba9.js";import{O as je,_ as Ne}from"./request-c2b0ab45.js";import{a as re}from"./mat3-45e3f2eb.js";import{e as zt}from"./mat3f64-b33e332c.js";import{e as ne}from"./mat4f64-3d813481.js";import{u as Wt,S as ft,z as ze,o as oe,e as gt,O as We,g as se}from"./mathUtils-daf59e84.js";import{O as kt}from"./unitUtils-43365914.js";import{g as ke}from"./mat4-62d5e6a4.js";import Ue from"./FeatureSet-9ea00c01.js";var Z;const $t=new WeakMap;let He=0,D=Z=class extends xt{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,n){if(t instanceof HTMLImageElement){const o={type:"image-element",src:Ht(t.src,n),crossOrigin:t.crossOrigin};e[r]=o}else if(t instanceof HTMLCanvasElement){const o=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(o)};e[r]=s}else if(t instanceof HTMLVideoElement){const o={type:"video-element",src:Ht(t.src,n),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=o}else{const o={type:"image-data",imageData:this._encodeImageData(t)};e[r]=o}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),n=e.substr(0,15).toLocaleLowerCase();if(r===".png"||n==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):($t.has(this.data)||$t.set(this.data,++He),e($t.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new Z(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return Ee(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new Z({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new Z({data:t}):Ft(Z,t)}};p([d({type:String,json:{write:Ie}})],D.prototype,"url",null),p([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],D.prototype,"data",null),p([ye("data")],D.prototype,"writeData",null),p([xe("data")],D.prototype,"readData",null),p([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],D.prototype,"transparent",null),p([d({json:{write:!0}})],D.prototype,"wrap",void 0),p([d({readOnly:!0})],D.prototype,"contentHash",null),D=Z=p([Q("esri.geometry.support.MeshTexture")],D);const nt=D;var Ct;let C=Ct=class extends xt{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=c(t)?t.get(this):null;if(r)return r;const n=new Ct(this.clonePropertiesWithDeduplication(e));return c(t)&&t.set(this,n),n}clonePropertiesWithDeduplication(t){return{color:c(this.color)?this.color.clone():null,colorTexture:c(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:c(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:c(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:c(this.normalTextureTransform)?this.normalTextureTransform:null}}};p([d({type:te,json:{write:!0}})],C.prototype,"color",void 0),p([d({type:nt,json:{write:!0}})],C.prototype,"colorTexture",void 0),p([d({type:nt,json:{write:!0}})],C.prototype,"normalTexture",void 0),p([d({nonNullable:!0,json:{write:!0}})],C.prototype,"alphaMode",void 0),p([d({nonNullable:!0,json:{write:!0}})],C.prototype,"alphaCutoff",void 0),p([d({nonNullable:!0,json:{write:!0}})],C.prototype,"doubleSided",void 0),p([d()],C.prototype,"colorTextureTransform",void 0),p([d()],C.prototype,"normalTextureTransform",void 0),C=Ct=p([Q("esri.geometry.support.MeshMaterial")],C);const Ut=C;var Ot;let L=Ot=class extends Ut{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=c(t)?t.get(this):null;if(r)return r;const n=new Ot(this.clonePropertiesWithDeduplication(e));return c(t)&&t.set(this,n),n}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:c(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:c(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:c(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:c(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:c(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:c(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:c(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};p([d({type:te,json:{write:!0}})],L.prototype,"emissiveColor",void 0),p([d({type:nt,json:{write:!0}})],L.prototype,"emissiveTexture",void 0),p([d({type:nt,json:{write:!0}})],L.prototype,"occlusionTexture",void 0),p([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],L.prototype,"metallic",void 0),p([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],L.prototype,"roughness",void 0),p([d({type:nt,json:{write:!0}})],L.prototype,"metallicRoughnessTexture",void 0),p([d()],L.prototype,"occlusionTextureTransform",void 0),p([d()],L.prototype,"emissiveTextureTransform",void 0),p([d()],L.prototype,"metallicRoughnessTextureTransform",void 0),L=Ot=p([Q("esri.geometry.support.MeshMaterialMetallicRoughness")],L);const Be=L;var ut;const ie="esri.geometry.support.MeshVertexAttributes",U=$.getLogger(ie);let T=ut=class extends xt{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return Y(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},U)}castPosition(t){return t&&t instanceof Float32Array&&U.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),Y(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},U)}castUv(t){return Y(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},U)}castNormal(t){return Y(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},U)}castTangent(t){return Y(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},U)}clone(){const t={position:_(this.position),uv:_(this.uv),normal:_(this.normal),tangent:_(this.tangent),color:_(this.color)};return new ut(t)}clonePositional(){const t={position:_(this.position),normal:_(this.normal),tangent:_(this.tangent),uv:this.uv,color:this.color};return new ut(t)}};function At(t,e,r,n){const{loggerTag:o,stride:s}=e;return t.length%s!=0?(n.error(o,`Invalid array length, expected a multiple of ${s}`),new r([])):t}function Y(t,e,r,n,o){if(!t)return t;if(t instanceof e)return At(t,n,e,o);for(const s of r)if(t instanceof s)return At(new e(t),n,e,o);if(Array.isArray(t))return At(new e(t),n,e,o);{const s=r.map(i=>`'${i.name}'`);return o.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function tt(t,e,r){e[r]=Ge(t)}function Ge(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}p([d({json:{write:tt}})],T.prototype,"color",void 0),p([W("color")],T.prototype,"castColor",null),p([d({nonNullable:!0,json:{write:tt}})],T.prototype,"position",void 0),p([W("position")],T.prototype,"castPosition",null),p([d({json:{write:tt}})],T.prototype,"uv",void 0),p([W("uv")],T.prototype,"castUv",null),p([d({json:{write:tt}})],T.prototype,"normal",void 0),p([W("normal")],T.prototype,"castNormal",null),p([d({json:{write:tt}})],T.prototype,"tangent",void 0),p([W("tangent")],T.prototype,"castTangent",null),T=ut=p([Q(ie)],T);var rt;const ae="esri.geometry.support.MeshComponent",Ve=$.getLogger(ae);let I=rt=class extends xt{constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(t){return Ft(rt,t)}castFaces(t){return Y(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Ve)}castMaterial(t){return Ft(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?Be:Ut,t)}clone(){return new rt({faces:_(this.faces),shading:this.shading,material:_(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:_(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new rt(r)}};p([d({json:{write:!0}})],I.prototype,"faces",void 0),p([W("faces")],I.prototype,"castFaces",null),p([d({type:Ut,json:{write:!0}})],I.prototype,"material",void 0),p([W("material")],I.prototype,"castMaterial",null),p([d({type:String,json:{write:!0}})],I.prototype,"shading",void 0),p([d({type:Boolean})],I.prototype,"trustSourceNormals",void 0),I=rt=p([Q(ae)],I);const K=I;function Ze(t){const e=Je(t.rings,t.hasZ,mt.CCW_IS_HOLE),r=new Array;let n=0,o=0;for(const a of e.polygons){const l=a.count,u=a.index,h=new Float64Array(e.position.buffer,3*u*e.position.BYTES_PER_ELEMENT,3*l),m=a.holeIndices.map(g=>g-u),f=new Uint32Array(Pe(h,m,3));r.push({position:h,faces:f}),n+=h.length,o+=f.length}const s=Ye(r,n,o),i=Se(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(i.buffer),s.faces=i.indices,s}function Ye(t,e,r){if(t.length===1)return t[0];const n=new Float64Array(e),o=new Uint32Array(r);let s=0,i=0,a=0;for(const l of t){for(let u=0;u<l.position.length;u++)n[s++]=l.position[u];for(let u=0;u<l.faces.length;u++)o[i++]=l.faces[u]+a;a=s/3}return{position:n,faces:o}}function Je(t,e,r){const n=t.length,o=new Array(n),s=new Array(n),i=new Array(n);let a=0,l=0,u=0,h=0;for(let g=0;g<n;++g)h+=t[g].length;const m=new Float64Array(3*h);let f=0;for(let g=n-1;g>=0;g--){const y=t[g],R=r===mt.CCW_IS_HOLE&&Xe(y);if(R&&n!==1)o[a++]=y;else{let v=y.length;for(let x=0;x<a;++x)v+=o[x].length;const A={index:f,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};A.pathLengths[0]=y.length,y.length>0&&(i[u++]={index:f,count:y.length}),f=R?it(y,y.length-1,-1,m,f,y.length,e):it(y,0,1,m,f,y.length,e);for(let x=0;x<a;++x){const b=o[x];A.holeIndices[x]=f,A.pathLengths[x+1]=b.length,b.length>0&&(i[u++]={index:f,count:b.length}),f=it(b,0,1,m,f,b.length,e)}a=0,A.count>0&&(s[l++]=A)}}for(let g=0;g<a;++g){const y=o[g];y.length>0&&(i[u++]={index:f,count:y.length}),f=it(y,0,1,m,f,y.length,e)}return s.length=l,i.length=u,{position:m,polygons:s,outlines:i}}function it(t,e,r,n,o,s,i){o*=3;for(let a=0;a<s;++a){const l=t[e];n[o++]=l[0],n[o++]=l[1],n[o++]=i?l[2]:0,e+=r}return o/3}function Xe(t){return!Re(t,!1,!1)}var mt;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(mt||(mt={}));const _t=$.getLogger("esri.geometry.support.meshUtils.centerAt");function qe(t,e,r){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const n=(r==null?void 0:r.origin)??t.origin;c(t.transform)?((r==null?void 0:r.geographic)!=null&&r.geographic!==t.transform.geographic&&_t.warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`),Ke(t.transform,e,n)):wt(t.spatialReference,r)?Qe(t,e,n):tr(t,e,n)}function Ke(t,e,r){const n=e.x-r.x,o=e.y-r.y,s=e.hasZ&&r.hasZ?e.z-r.z:0,i=t.origin;t.origin=[i[0]+n,i[1]+o,i[2]+s]}function Qe(t,e,r){const n=Ce(t.vertexAttributes,r,{geographic:!0}),{position:o,normal:s,tangent:i}=Oe(n,e,{geographic:!0});t.vertexAttributes.position=o,t.vertexAttributes.normal=s,t.vertexAttributes.tangent=i,t.vertexAttributesChanged()}function tr(t,e,r){const n=nr,o=rr;if(N(e,o,t.spatialReference)){if(!N(r,n,t.spatialReference)){const s=t.origin;n[0]=s.x,n[1]=s.y,n[2]=s.z,_t.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}er(t.vertexAttributes.position,o,n),t.vertexAttributesChanged()}else _t.error(`Failed to project centerAt location (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid})`)}function er(t,e,r){if(t)for(let n=0;n<t.length;n+=3)for(let o=0;o<3;o++)t[n+o]+=e[o]-r[o]}const rr=M(),nr=M();async function or(t,e,r){const{loadGLTFMesh:n}=await Dt(pt(()=>import("./loadGLTFMesh-48e2772a.js"),["assets/loadGLTFMesh-48e2772a.js","assets/Color-2245b966.js","assets/colorUtils-639f4d25.js","assets/mathUtils-daf59e84.js","assets/common-701a4199.js","assets/typedArrayUtil-2bcf3cee.js","assets/ensureType-fa162cfc.js","assets/string-3d0ebcd3.js","assets/Error-bd05b442.js","assets/request-c2b0ab45.js","assets/preload-helper-101896b7.js","assets/promiseUtils-29120e0a.js","assets/mat3-45e3f2eb.js","assets/mat3f64-b33e332c.js","assets/vec4f64-018b3fa6.js","assets/BufferView-dfb97f8b.js","assets/vec2-f978aef8.js","assets/vec33-b89f760e.js","assets/DefaultMaterial_COLOR_GAMMA-10d4f229.js","assets/types-e1c0a5bf.js","assets/asyncUtils-59234081.js","assets/cast-daef7652.js","assets/nextTick-3ee5a785.js","assets/mat4f64-3d813481.js","assets/enums-64ab819c.js","assets/Version-c777a35e.js","assets/mat4-62d5e6a4.js","assets/quat-7867de93.js","assets/quatf64-7fd38d64.js","assets/compilerUtils-06ced1a6.js","assets/georeference-eb1d0a87.js","assets/unitUtils-43365914.js","assets/jsonMap-a9c94baf.js","assets/Extent-7f29a1bb.js","assets/projection-33a6cba9.js","assets/SimpleObservable-7c382d01.js","assets/Polyline-c56eca9b.js","assets/assets-4cb15247.js","assets/zscale-a508c8e5.js","assets/Graphic-cf98a91a.js","assets/geometry-4b789d90.js","assets/typeUtils-d7b057b5.js","assets/PopupTemplate-343851b8.js","assets/Clonable-f249bc0f.js","assets/Collection-e2259e32.js","assets/Evented-d8fc77f0.js","assets/fieldUtils-021fea8a.js","assets/arcadeOnDemand-87969052.js","assets/enumeration-e46f3fd4.js","assets/number-53937715.js","assets/locale-30120714.js","assets/Identifiable-e3a09883.js","assets/symbols-fce921a6.js","assets/CIMSymbol-d0e12b74.js","assets/Symbol-f45dc441.js","assets/screenUtils-7afeb41c.js","assets/opacityUtils-94fd2faa.js","assets/aaBoundingBox-6fbd5972.js","assets/persistableUrlUtils-7e525def.js","assets/collectionUtils-09289d8f.js","assets/Portal-ac0dca24.js","assets/Loadable-7c89bd10.js","assets/Promise-088a0e17.js","assets/PortalGroup-f3dee6d8.js","assets/PortalUser-cdb4116b.js","assets/jsonUtils-8bd548d9.js","assets/HandleOwner-78d35324.js","assets/reactiveUtils-3c1b281e.js","assets/imageUtils-c2d0d1ae.js","assets/earcut-58237617.js","assets/deduplicate-eb9d58da.js","assets/FeatureSet-9ea00c01.js","assets/Field-0ac3c9d2.js","assets/fieldType-4ec45634.js"]),r),o=await le(e,r),s=n(new E({x:0,y:0,z:0,spatialReference:t.spatialReference}),o.url,{resolveFile:sr(o),useTransform:!0,signal:c(r)?r.signal:null});s.then(()=>o.dispose(),()=>o.dispose());const{vertexAttributes:i,components:a}=await s;t.vertexAttributes=i,t.components=a}function sr(t){const e=je(t.url);return r=>{const n=Ne(r,e,e),o=n?n.replace(/^ *\.\//,""):null;return(o?t.files.get(o):null)??r}}async function le(t,e){return t instanceof Blob?dt.fromBlob(t):typeof t=="string"?new dt(t):Array.isArray(t)?ir(t,e):ar(t,e)}async function ir(t,e){const r=new Map;let n=null;const o=await be(t.map(async i=>({name:i.name,source:await le(i instanceof Blob?i:i.source,e)}))),s=[];for(const i of o)i&&(Te(e)?i.source.dispose():s.push(i));Me(e);for(const{name:i,source:a}of s)(ot(n)||/\.(gltf|glb)/i.test(i))&&(n=a.url),r.set(i,a.url),a.files&&a.files.forEach((l,u)=>r.set(u,l));if(ot(n))throw new Mt("mesh-load-external:missing-files","Missing files to load external mesh source");return new dt(n,()=>s.forEach(({source:i})=>i.dispose()),r)}async function ar(t,e){const{default:r}=await Dt(pt(()=>import("./request-c2b0ab45.js").then(o=>o.w),["assets/request-c2b0ab45.js","assets/preload-helper-101896b7.js","assets/Error-bd05b442.js","assets/string-3d0ebcd3.js","assets/typedArrayUtil-2bcf3cee.js","assets/promiseUtils-29120e0a.js"]),e),n=typeof t.multipart[0]=="string"?await Promise.all(t.multipart.map(async o=>(await r(o,{responseType:"array-buffer"})).data)):t.multipart;return dt.fromBlob(new Blob(n))}let dt=class ce{constructor(e,r=()=>{},n=new Map){this.url=e,this.dispose=r,this.files=n}static fromBlob(e){const r=URL.createObjectURL(e);return new ce(r,()=>URL.revokeObjectURL(r))}};function lr(t,e,r){t.vertexAttributes&&t.vertexAttributes.position&&(c(t.transform)?((r==null?void 0:r.geographic)!=null&&r.geographic!==t.transform.geographic&&$.getLogger("esri.geometry.support.meshUtils.offset").warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`),cr(t.transform,e)):wt(t.spatialReference,r)?ur(t,e):pr(t,e))}function cr(t,e){const r=t.origin;t.origin=Wt(M(),r,e)}function ur(t,e){const r=t.spatialReference,n=t.vertexAttributes.position,o=t.vertexAttributes.normal,s=t.vertexAttributes.tangent,i=new Float64Array(n.length),a=c(o)?new Float32Array(o.length):null,l=c(s)?new Float32Array(s.length):null,u=t.extent.center,h=hr;ee(r,[u.x,u.y,u.z],Bt,kt(r)),re(Gt,Bt),ft(h,e,Gt),Et(n,r,i),c(o)&&c(a)&&It(o,n,i,r,a),c(s)&&c(l)&&Pt(s,n,i,r,l),ue(i,h),St(i,n,r),c(o)&&c(a)&&jt(a,n,i,r,o),c(s)&&c(l)&&Nt(l,n,i,r,s),t.vertexAttributesChanged()}function pr(t,e){ue(t.vertexAttributes.position,e),t.vertexAttributesChanged()}function ue(t,e){if(t)for(let r=0;r<t.length;r+=3)for(let n=0;n<3;n++)t[r+n]+=e[n]}const hr=M(),Bt=ne(),Gt=zt();function fr(){const{faceDescriptions:t,faceVertexOffsets:e,uvScales:r}=$r,n=4*t.length,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(2*t.length*3);let l=0,u=0,h=0,m=0;for(let f=0;f<t.length;f++){const g=t[f],y=l/3;for(const v of e)a[m++]=y+v;const R=g.corners;for(let v=0;v<4;v++){const A=R[v];let x=0;i[h++]=.25*r[v][0]+g.uvOrigin[0],i[h++]=g.uvOrigin[1]-.25*r[v][1];for(let b=0;b<3;b++)g.axis[b]!==0?(o[l++]=.5*g.axis[b],s[u++]=g.axis[b]):(o[l++]=.5*A[x++],s[u++]=0)}}return{position:o,normal:s,uv:i,faces:a}}function gr(t,e){const r=t.components[0],n=r.faces,o=Ar[e],s=6*o,i=new Array(6),a=new Array(n.length-6);let l=0,u=0;for(let h=0;h<n.length;h++)h>=s&&h<s+6?i[l++]=n[h]:a[u++]=n[h];if(c(t.vertexAttributes.uv)){const h=new Float32Array(t.vertexAttributes.uv),m=4*o*2,f=[0,1,1,1,1,0,0,0];for(let g=0;g<f.length;g++)h[m+g]=f[g];t.vertexAttributes.uv=h}return t.components=[new K({faces:i,material:r.material}),new K({faces:a})],t}function mr(t=0){const e=Math.round(8*2**t),r=2*e,n=(e-1)*(r+1)+2*r,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*((e-1)*r*2));let l=0,u=0,h=0,m=0;for(let f=0;f<=e;f++){const g=f/e*Math.PI+.5*Math.PI,y=Math.cos(g),R=Math.sin(g);w[2]=R;const v=f===0||f===e,A=v?r-1:r;for(let x=0;x<=A;x++){const b=x/A*2*Math.PI;w[0]=-Math.sin(b)*y,w[1]=Math.cos(b)*y;for(let P=0;P<3;P++)o[l]=.5*w[P],s[l]=w[P],++l;i[u++]=(x+(v?.5:0))/r,i[u++]=f/e,f!==0&&x!==r&&(f!==e&&(a[h++]=m,a[h++]=m+1,a[h++]=m-r),f!==1&&(a[h++]=m,a[h++]=m-r,a[h++]=m-r-1)),m++}}return{position:o,normal:s,uv:i,faces:a}}function dr(t=0){const r=Math.round(16*2**t),n=(5-1)*(r+1)+2*r,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*(4*r));let l=0,u=0,h=0,m=0,f=0;for(let g=0;g<=5;g++){const y=g===0||g===5,R=g<=1||g>=5-1,v=g===2||g===4,A=y?r-1:r;for(let x=0;x<=A;x++){const b=x/A*2*Math.PI,P=y?0:.5;w[0]=P*Math.sin(b),w[1]=P*-Math.cos(b),w[2]=g<=2?.5:-.5;for(let k=0;k<3;k++)o[l++]=w[k],s[u++]=R?k===2?g<=1?1:-1:0:k===2?0:w[k]/P;i[h++]=(x+(y?.5:0))/r,i[h++]=g<=1?1*g/3:g<=3?1*(g-2)/3+1/3:1*(g-4)/3+2/3,v||g===0||x===r||(g!==5&&(a[m++]=f,a[m++]=f+1,a[m++]=f-r),g!==1&&(a[m++]=f,a[m++]=f-r,a[m++]=f-r-1)),f++}}return{position:o,normal:s,uv:i,faces:a}}function yr(t,e){const r=typeof e=="number"?e:e!=null?e.width:1,n=typeof e=="number"?e:e!=null?e.height:1;switch(t){case"up":case"down":return{width:r,depth:n};case"north":case"south":return{width:r,height:n};case"east":case"west":return{depth:r,height:n}}}function xr(t){const e=et.facingAxisOrderSwap[t],r=et.position,n=et.normal,o=new Float64Array(r.length),s=new Float32Array(n.length);let i=0;for(let a=0;a<4;a++){const l=i;for(let u=0;u<3;u++){const h=e[u],m=Math.abs(h)-1,f=h>=0?1:-1;o[i]=r[l+m]*f,s[i]=n[l+m]*f,i++}}return{position:o,normal:s,uv:new Float32Array(et.uv),faces:new Uint32Array(et.faces),isPlane:!0}}const H=1,B=2,G=3,et={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[G,H,B],west:[-G,-H,B],north:[-H,G,B],south:[H,-G,B],up:[H,B,G],down:[H,-B,-G]}};function at(t,e,r){t.isPlane||wr(t),vr(t,r==null?void 0:r.size);const{vertexAttributes:n,transform:o}=_e(t,e,r);return{vertexAttributes:new T({...n,uv:t.uv}),transform:o,components:[new K({faces:t.faces,material:r&&r.material||null})],spatialReference:e.spatialReference}}function wr(t){for(let e=0;e<t.position.length;e+=3)t.position[e+2]+=.5}function vr(t,e){if(e==null)return;const r=typeof e=="number"?[e,e,e]:[e.width!=null?e.width:1,e.depth!=null?e.depth:1,e.height!=null?e.height:1];S[0]=r[0],S[4]=r[1],S[8]=r[2];for(let n=0;n<t.position.length;n+=3){for(let o=0;o<3;o++)w[o]=t.position[n+o];ft(w,w,S);for(let o=0;o<3;o++)t.position[n+o]=w[o]}if(r[0]!==r[1]||r[1]!==r[2]){S[0]=1/r[0],S[4]=1/r[1],S[8]=1/r[2];for(let n=0;n<t.normal.length;n+=3){for(let o=0;o<3;o++)w[o]=t.normal[n+o];ft(w,w,S),ze(w,w);for(let o=0;o<3;o++)t.normal[n+o]=w[o]}}}const $r={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Ar={south:0,east:1,north:2,west:3,up:4,down:5},w=M(),S=zt(),pe=$.getLogger("esri.geometry.support.meshUtils.rotate");function br(t,e,r){if(!t.vertexAttributes||!t.vertexAttributes.position||e[3]===0)return;const n=t.spatialReference;if(c(t.transform)){(r==null?void 0:r.geographic)!=null&&r.geographic!==t.transform.geographic&&pe.warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`);const o=(r==null?void 0:r.origin)??t.transform.getOriginPoint(n);Tr(t.transform,e,o)}else{const o=(r==null?void 0:r.origin)??t.origin;wt(t.spatialReference,r)?Mr(t,e,o):Fr(t,e,o)}}function Tr(t,e,r){const n=oe(J,r.x,r.y,r.z),o=gt(J,n,t.origin);t.applyLocalInverse(o,Vt),t.rotation=Rt(t.rotation,e,st()),t.applyLocalInverse(o,o),gt(o,o,Vt),t.translation=Wt(M(),t.translation,o)}function Mr(t,e,r){const n=t.spatialReference,o=kt(n),s=he;N(r,s,o)||N(t.origin,s,o);const i=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,u=new Float64Array(i.length),h=c(a)?new Float32Array(a.length):null,m=c(l)?new Float32Array(l.length):null;ee(o,s,yt,o),re(Yt,yt);const f=Zt;ft(Lt(Zt),Lt(e),Yt),f[3]=e[3],Et(i,n,u),c(a)&&c(h)&&It(a,i,u,n,h),c(l)&&c(m)&&Pt(l,i,u,n,m),q(u,f,3,s),St(u,i,n),c(a)&&c(h)&&(q(h,f,3),jt(h,i,u,n,a)),c(l)&&c(m)&&(q(m,f,4),Nt(m,i,u,n,l)),t.vertexAttributesChanged()}function Fr(t,e,r){const n=he;if(!N(r,n,t.spatialReference)){const o=t.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,pe.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}q(t.vertexAttributes.position,e,3,n),q(t.vertexAttributes.normal,e,3),q(t.vertexAttributes.tangent,e,4),t.vertexAttributesChanged()}function q(t,e,r,n=Qt){if(!ot(t)){ke(yt,De(e),Lt(e));for(let o=0;o<t.length;o+=r){for(let s=0;s<3;s++)J[s]=t[o+s]-n[s];We(J,J,yt);for(let s=0;s<3;s++)t[o+s]=J[s]+n[s]}}}const J=M(),Vt=M(),Zt=st(),yt=ne(),Yt=zt(),he=M(),fe=$.getLogger("esri.geometry.support.meshUtils.scale");function Rr(t,e,r){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const n=t.spatialReference;if(c(t.transform)){(r==null?void 0:r.geographic)!=null&&r.geographic!==t.transform.geographic&&fe.warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`);const o=(r==null?void 0:r.origin)??t.transform.getOriginPoint(n);Lr(t.transform,e,o)}else{const o=wt(t.spatialReference,r),s=r&&r.origin||t.origin;o?Cr(t,e,s):Or(t,e,s)}}function Lr(t,e,r){const n=oe(X,r.x,r.y,r.z),o=gt(X,n,t.origin);t.applyLocalInverse(o,Jt);const s=se(M(),t.scale,e);t.scale=s,t.applyLocalInverse(o,o),gt(o,o,Jt),t.translation=Wt(M(),t.translation,o)}function Cr(t,e,r){const n=t.spatialReference,o=kt(n),s=me;N(r,s,o)||N(t.origin,s,o);const i=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,u=new Float64Array(i.length),h=c(a)?new Float32Array(a.length):null,m=c(l)?new Float32Array(l.length):null;Et(i,n,u),c(a)&&c(h)&&It(a,i,u,n,h),c(l)&&c(m)&&Pt(l,i,u,n,m),ge(u,e,s),St(u,i,n),c(a)&&c(h)&&jt(h,i,u,n,a),c(l)&&c(m)&&Nt(m,i,u,n,l),t.vertexAttributesChanged()}function Or(t,e,r){const n=me;if(!N(r,n,t.spatialReference)){const o=t.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,fe.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}ge(t.vertexAttributes.position,e,n),t.vertexAttributesChanged()}function ge(t,e,r=Qt){if(t)for(let n=0;n<t.length;n+=3){for(let o=0;o<3;o++)X[o]=t[n+o]-r[o];se(X,X,e);for(let o=0;o<3;o++)t[n+o]=X[o]+r[o]}}const X=M(),Jt=M(),me=M();var O;const z="esri.geometry.Mesh";let F=O=class extends ve($e.LoadableMixin(Ae(we))){constructor(t){super(t),this.components=null,this.transform=null,this.external=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new T,this.type="mesh"}initialize(){(ot(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(Fe(()=>{var t;return{vertexAttributes:this.vertexAttributes,components:(t=this.components)==null?void 0:t.map(e=>e.clone())}},()=>this._set("external",null),{once:!0,sync:!0}))})}get hasExtent(){return!this.loaded&&c(this.external)&&c(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}get _boundingInfo(){const t=this.vertexAttributes.position,e=this.spatialReference;if(t.length===0||this.components&&this.components.length===0)return{extent:new Tt({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:e}),center:new E({x:0,y:0,z:0,spatialReference:e})};const r=c(this.transform)?this.transform.project(t,e):t;let n=1/0,o=1/0,s=1/0,i=-1/0,a=-1/0,l=-1/0,u=0,h=0,m=0;const f=r.length,g=1/(f/3);let y=0;for(;y<f;){const R=r[y++],v=r[y++],A=r[y++];n=Math.min(n,R),o=Math.min(o,v),s=Math.min(s,A),i=Math.max(i,R),a=Math.max(a,v),l=Math.max(l,A),u+=g*R,h+=g*v,m+=g*A}return{extent:new Tt({xmin:n,ymin:o,zmin:s,xmax:i,ymax:a,zmax:l,spatialReference:e}),center:new E({x:u,y:h,z:m,spatialReference:e})}}get anchor(){if(c(this.transform))return this.transform.getOriginPoint(this.spatialReference);const t=this._boundingInfo;return new E({x:t.center.x,y:t.center.y,z:t.extent.zmin,spatialReference:this.spatialReference})}get origin(){return c(this.transform)?this.transform.getOriginPoint(this.spatialReference):this._boundingInfo.center}get extent(){return!this.loaded&&c(this.external)&&c(this.external.extent)?this.external.extent.clone():this._boundingInfo.extent}addComponent(t){this.loaded?(this.components||(this.components=[]),this.components.push(K.from(t)),this.notifyChange("components")):$.getLogger(this.declaredClass).error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(t){if(this.loaded){if(this.components){const e=this.components.indexOf(t);if(e!==-1)return this.components.splice(e,1),void this.notifyChange("components")}$.getLogger(this.declaredClass).error("removeComponent()","Provided component is not part of the list of components")}else $.getLogger(this.declaredClass).error("removeComponent()","Mesh must be loaded before applying operations")}rotate(t,e,r,n){return ct(bt.x,t,V),ct(bt.y,e,Xt),ct(bt.z,r,qt),Rt(V,Xt,V),Rt(V,qt,V),br(this,V,n),this}offset(t,e,r,n){return this.loaded?(lt[0]=t,lt[1]=e,lt[2]=r,lr(this,lt,n),this):($.getLogger(this.declaredClass).error("offset()","Mesh must be loaded before applying operations"),this)}scale(t,e){return this.loaded?(Rr(this,t,e),this):($.getLogger(this.declaredClass).error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(t,e){return this.loaded?(qe(this,t,e),this):($.getLogger(this.declaredClass).error("centerAt()","Mesh must be loaded before applying operations"),this)}load(t){return c(this.external)&&this.addResolvingPromise(or(this,this.external.source,t)),Promise.resolve(this)}updateExternalSource(t){this._set("external",t)}clone(){let t=null;if(this.components){const r=new Map,n=new Map;t=this.components.map(o=>o.cloneWithDeduplication(r,n))}const e={components:t,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:c(this.transform)?this.transform.clone():null,external:c(this.external)?{source:this.external.source,extent:c(this.external.extent)?this.external.extent.clone():null}:null};return new O(e)}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(t){const e=pt(()=>import("./gltfexport-b5436b15.js"),["assets/gltfexport-b5436b15.js","assets/request-c2b0ab45.js","assets/preload-helper-101896b7.js","assets/Error-bd05b442.js","assets/string-3d0ebcd3.js","assets/typedArrayUtil-2bcf3cee.js","assets/promiseUtils-29120e0a.js","assets/Extent-7f29a1bb.js","assets/cast-daef7652.js","assets/ensureType-fa162cfc.js","assets/nextTick-3ee5a785.js","assets/quat-7867de93.js","assets/mat3f64-b33e332c.js","assets/quatf64-7fd38d64.js","assets/common-701a4199.js","assets/mathUtils-daf59e84.js","assets/georeference-eb1d0a87.js","assets/unitUtils-43365914.js","assets/jsonMap-a9c94baf.js","assets/mat4-62d5e6a4.js","assets/mat4f64-3d813481.js","assets/mat3-45e3f2eb.js","assets/projection-33a6cba9.js","assets/SimpleObservable-7c382d01.js","assets/Polyline-c56eca9b.js","assets/assets-4cb15247.js","assets/zscale-a508c8e5.js","assets/BufferView-dfb97f8b.js","assets/vec2-f978aef8.js","assets/vec33-b89f760e.js","assets/enums-64ab819c.js","assets/imageutils-f64c5776.js","assets/Graphic-cf98a91a.js","assets/geometry-4b789d90.js","assets/typeUtils-d7b057b5.js","assets/PopupTemplate-343851b8.js","assets/Clonable-f249bc0f.js","assets/Collection-e2259e32.js","assets/Evented-d8fc77f0.js","assets/fieldUtils-021fea8a.js","assets/arcadeOnDemand-87969052.js","assets/enumeration-e46f3fd4.js","assets/number-53937715.js","assets/locale-30120714.js","assets/Identifiable-e3a09883.js","assets/symbols-fce921a6.js","assets/CIMSymbol-d0e12b74.js","assets/Symbol-f45dc441.js","assets/Color-2245b966.js","assets/colorUtils-639f4d25.js","assets/screenUtils-7afeb41c.js","assets/opacityUtils-94fd2faa.js","assets/aaBoundingBox-6fbd5972.js","assets/persistableUrlUtils-7e525def.js","assets/collectionUtils-09289d8f.js","assets/Portal-ac0dca24.js","assets/Loadable-7c89bd10.js","assets/Promise-088a0e17.js","assets/PortalGroup-f3dee6d8.js","assets/PortalUser-cdb4116b.js","assets/jsonUtils-8bd548d9.js","assets/HandleOwner-78d35324.js","assets/reactiveUtils-3c1b281e.js","assets/imageUtils-c2d0d1ae.js","assets/earcut-58237617.js","assets/deduplicate-eb9d58da.js","assets/FeatureSet-9ea00c01.js","assets/Field-0ac3c9d2.js","assets/fieldType-4ec45634.js"]),r=this.load(),n=await Promise.all([e,r]),{toBinaryGLTF:o}=n[0];return o(this,t)}static createBox(t,e){if(!(t instanceof E))return $.getLogger(z).error(".createBox()","expected location to be a Point instance"),null;const r=new O(at(fr(),t,e));return e&&e.imageFace&&e.imageFace!=="all"?gr(r,e.imageFace):r}static createSphere(t,e){return t instanceof E?new O(at(mr(e&&e.densificationFactor||0),t,e)):($.getLogger(z).error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(t,e){return t instanceof E?new O(at(dr(e&&e.densificationFactor||0),t,e)):($.getLogger(z).error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(t,e){if(!(t instanceof E))return $.getLogger(z).error(".createPlane()","expected location to be a Point instance"),null;const r=(e==null?void 0:e.facing)??"up",n=yr(r,e==null?void 0:e.size);return new O(at(xr(r),t,{...e,size:n}))}static createFromPolygon(t,e){if(!(t instanceof Le))return $.getLogger(z).error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const r=Ze(t);return new O({vertexAttributes:new T({position:r.position}),components:[new K({faces:r.faces,shading:"flat",material:(e==null?void 0:e.material)??null})],spatialReference:t.spatialReference})}static async createFromGLTF(t,e,r){if(!(t instanceof E))throw $.getLogger(z).error(".createfromGLTF()","expected location to be a Point instance"),new Mt("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:n}=await Dt(pt(()=>import("./loadGLTFMesh-48e2772a.js"),["assets/loadGLTFMesh-48e2772a.js","assets/Color-2245b966.js","assets/colorUtils-639f4d25.js","assets/mathUtils-daf59e84.js","assets/common-701a4199.js","assets/typedArrayUtil-2bcf3cee.js","assets/ensureType-fa162cfc.js","assets/string-3d0ebcd3.js","assets/Error-bd05b442.js","assets/request-c2b0ab45.js","assets/preload-helper-101896b7.js","assets/promiseUtils-29120e0a.js","assets/mat3-45e3f2eb.js","assets/mat3f64-b33e332c.js","assets/vec4f64-018b3fa6.js","assets/BufferView-dfb97f8b.js","assets/vec2-f978aef8.js","assets/vec33-b89f760e.js","assets/DefaultMaterial_COLOR_GAMMA-10d4f229.js","assets/types-e1c0a5bf.js","assets/asyncUtils-59234081.js","assets/cast-daef7652.js","assets/nextTick-3ee5a785.js","assets/mat4f64-3d813481.js","assets/enums-64ab819c.js","assets/Version-c777a35e.js","assets/mat4-62d5e6a4.js","assets/quat-7867de93.js","assets/quatf64-7fd38d64.js","assets/compilerUtils-06ced1a6.js","assets/georeference-eb1d0a87.js","assets/unitUtils-43365914.js","assets/jsonMap-a9c94baf.js","assets/Extent-7f29a1bb.js","assets/projection-33a6cba9.js","assets/SimpleObservable-7c382d01.js","assets/Polyline-c56eca9b.js","assets/assets-4cb15247.js","assets/zscale-a508c8e5.js","assets/Graphic-cf98a91a.js","assets/geometry-4b789d90.js","assets/typeUtils-d7b057b5.js","assets/PopupTemplate-343851b8.js","assets/Clonable-f249bc0f.js","assets/Collection-e2259e32.js","assets/Evented-d8fc77f0.js","assets/fieldUtils-021fea8a.js","assets/arcadeOnDemand-87969052.js","assets/enumeration-e46f3fd4.js","assets/number-53937715.js","assets/locale-30120714.js","assets/Identifiable-e3a09883.js","assets/symbols-fce921a6.js","assets/CIMSymbol-d0e12b74.js","assets/Symbol-f45dc441.js","assets/screenUtils-7afeb41c.js","assets/opacityUtils-94fd2faa.js","assets/aaBoundingBox-6fbd5972.js","assets/persistableUrlUtils-7e525def.js","assets/collectionUtils-09289d8f.js","assets/Portal-ac0dca24.js","assets/Loadable-7c89bd10.js","assets/Promise-088a0e17.js","assets/PortalGroup-f3dee6d8.js","assets/PortalUser-cdb4116b.js","assets/jsonUtils-8bd548d9.js","assets/HandleOwner-78d35324.js","assets/reactiveUtils-3c1b281e.js","assets/imageUtils-c2d0d1ae.js","assets/earcut-58237617.js","assets/deduplicate-eb9d58da.js","assets/FeatureSet-9ea00c01.js","assets/Field-0ac3c9d2.js","assets/fieldType-4ec45634.js"]),r);return new O(await n(t,e,r))}static createWithExternalSource(t,e,r){var i;const n=(r==null?void 0:r.extent)??null,o=((i=r==null?void 0:r.transform)==null?void 0:i.clone())??new ht;o.origin=[t.x,t.y,t.z??0];const s=t.spatialReference;return new O({external:{source:e,extent:n},transform:o,spatialReference:s})}static createIncomplete(t,e){var s;const r=((s=e==null?void 0:e.transform)==null?void 0:s.clone())??new ht;r.origin=[t.x,t.y,t.z??0];const n=t.spatialReference,o=new O({transform:r,spatialReference:n});return o.addResolvingPromise(Promise.reject(new Mt("mesh-incomplete","Mesh resources are not complete"))),o}};p([d({type:[K],json:{write:!0}})],F.prototype,"components",void 0),p([d({type:ht,json:{write:!0}})],F.prototype,"transform",void 0),p([d({constructOnly:!0})],F.prototype,"external",void 0),p([d({readOnly:!0})],F.prototype,"hasExtent",null),p([d({readOnly:!0})],F.prototype,"_boundingInfo",null),p([d({readOnly:!0})],F.prototype,"anchor",null),p([d({readOnly:!0})],F.prototype,"origin",null),p([d({readOnly:!0,json:{read:!1}})],F.prototype,"extent",null),p([d({readOnly:!0,json:{read:!1,write:!0,default:!0}})],F.prototype,"hasZ",void 0),p([d({readOnly:!0,json:{read:!1,write:!0,default:!1}})],F.prototype,"hasM",void 0),p([d({type:T,nonNullable:!0,json:{write:!0}})],F.prototype,"vertexAttributes",void 0),F=O=p([Q(z)],F);const bt={x:vt(1,0,0),y:vt(0,1,0),z:vt(0,0,1)},V=st(),Xt=st(),qt=st(),lt=M(),Kt=F;function _r(t,e,r){const n=r.features;r.features=[],delete r.geometryType;const o=Ue.fromJSON(r);if(o.geometryType="mesh",!r.assetMaps)return o;const s=Sr(e,r.assetMaps),i=o.spatialReference,a=r.globalIdFieldName,l=ot(t.outFields)||!t.outFields.length?()=>({}):Dr(t.outFields.includes("*")?null:new Set(t.outFields));for(const u of n){const h=Er(u,a,i,e,s);c(h)&&o.features.push(new de({geometry:h,attributes:l(u)}))}return o}function Dr(t){return({attributes:e})=>{if(!e)return{};if(!t)return e;for(const r in e)t.has(r)||delete e[r];return e}}function Er(t,e,r,n,o){const s=t.attributes[e],i=o.get(s);if(i==null||i.status===j.FAILED||i.url==null)return null;const a=Ir(t,r,n),l=Tt.fromJSON(t.geometry);l.spatialReference=r;const u=Pr(t.attributes,n,i.geographic);return i.status===j.PENDING?Kt.createIncomplete(a,{extent:l,transform:u}):Kt.createWithExternalSource(a,[{name:i.name,source:i.url}],{extent:l,transform:u})}function Ir({attributes:t},e,{transformFieldRoles:r}){return new E({x:t[r.originX],y:t[r.originY],z:t[r.originZ],spatialReference:e})}function Pr(t,{transformFieldRoles:e},r){return new ht({translation:[t[e.translationX],t[e.translationY],t[e.translationZ]],rotation:ct([t[e.rotationX],t[e.rotationY],t[e.rotationZ]],t[e.rotationDeg]),scale:[t[e.scaleX],t[e.scaleY],t[e.scaleZ]],geographic:r})}var j;function Sr(t,e){const r=new Map;for(const n of e){const o=n.parentGlobalId;if(o==null)continue;const s=n.assetName,i=n.assetURL,a=n.conversionStatus;let l=r.get(o);if(l!=null)throw new Error("multiple asset parts not expected.");switch(l={name:s,status:j.FAILED,url:i,geographic:jr(n.flags).projectVertices},r.set(o,l),a){case"COMPLETED":case"SUBMITTED":l.status=j.COMPLETED;break;case"INPROGRESS":l.status=j.PENDING;break;default:l.status=j.FAILED}}return r}function jr(t){return{projectVertices:t.includes("PROJECT_VERTICES")}}(function(t){t[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"})(j||(j={}));const mn=Object.freeze(Object.defineProperty({__proto__:null,meshFeatureSetFromJSON:_r},Symbol.toStringTag,{value:"Module"}));export{mn as a,Be as c,K as g,nt as m,T as p};
