import"./geometry-4b789d90.js";import{h as a}from"./string-3d0ebcd3.js";import{r as _,t as d,f as c,z as g}from"./typedArrayUtil-2bcf3cee.js";import{e as m}from"./centroid-de776b3b.js";import{r as b}from"./featureConversionUtils-7c9ea581.js";import{t as l}from"./OptimizedFeature-9345d11b.js";import{v as y}from"./jsonUtils-8bd548d9.js";class o{constructor(t,e){this._mask=0,this._buf=t,this._mask=e}static fromBuffer(t,e){return new o(t,e)}static create(t,e=4294967295){const r=new Uint32Array(Math.ceil(t/32));return new o(r,e)}_getIndex(t){return Math.floor(t/32)}has(t){const e=this._mask&t;return!!(this._buf[this._getIndex(e)]&1<<e%32)}hasRange(t,e){let r=t,s=e;for(;r%32&&r!==s;){if(this.has(r))return!0;r++}for(;s%32&&r!==s;){if(this.has(r))return!0;s--}if(r===s)return!1;for(let i=r/32;i!==s/32;i++)if(this._buf[i])return!0;return!1}set(t){const e=this._mask&t,r=this._getIndex(e),s=1<<e%32;this._buf[r]|=s}setRange(t,e){let r=t,s=e;for(;r%32&&r!==s;)this.set(r++);for(;s%32&&r!==s;)this.set(s--);if(r!==s)for(let i=r/32;i!==s/32;i++)this._buf[i]=4294967295}unset(t){const e=this._mask&t,r=this._getIndex(e),s=1<<e%32;this._buf[r]&=4294967295^s}resize(t){const e=this._buf,r=new Uint32Array(Math.ceil(t/32));r.set(e),this._buf=r}or(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=t._buf[e];return this}and(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=t._buf[e];return this}xor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=t._buf[e];return this}ior(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=~t._buf[e];return this}iand(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=~t._buf[e];return this}ixor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=~t._buf[e];return this}any(){for(let t=0;t<this._buf.length;t++)if(this._buf[t])return!0;return!1}copy(t){for(let e=0;e<this._buf.length;e++)this._buf[e]=t._buf[e];return this}clone(){return new o(this._buf.slice(),this._mask)}clear(){for(let t=0;t<this._buf.length;t++)this._buf[t]=0}forEachSet(t){for(let e=0;e<this._buf.length;e++){let r=this._buf[e],s=32*e;if(r)for(;r;)1&r&&t(s),r>>>=1,s++}}countSet(){let t=0;return this.forEachSet(e=>{t++}),t}}let n=0;const u=a("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],p=u[0],x=u[1],I=u[2],A=u[3],f=a("featurelayer-simplify-payload-size-factors")??[1,2,4],S=f[0],C=f[1],j=f[2],v=a("featurelayer-simplify-mobile-factor")??2,T=a("esri-mobile");class G{constructor(t,e){this.type="FeatureSetReader",this.arcadeDeclaredClass="esri.arcade.Feature",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._level=0,this.instance=t,this._layerSchema=e}static createInstance(){return n++,n=n>65535?0:n,n}get isEmpty(){return _(this._deleted)&&this._deleted.countSet()===this.getSize()}set level(t){this._level=t}getAreaSimplificationThreshold(t,e){let r=1;const s=T?v:1;e>4e6?r=j*s:e>1e6?r=C*s:e>5e5?r=S*s:e>1e5&&(r=s);let i=0;t>4e3?i=A*r:t>2e3?i=I*r:t>100?i=x:t>15&&(i=p);let h=8;return this._level<4?h=1:this._level<5?h=2:this._level<6&&(h=4),i*h}createQuantizedExtrudedQuad(t,e){return new l([5],[t-1,e,1,-1,1,1,-1,1,-1,-1])}setArcadeSpatialReference(t){this._arcadeSpatialReference=t}attachStorage(t){this._storage=t}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(t){return this.getComputedNumericAtIndex(0)}setComputedNumeric(t,e){return this.setComputedNumericAtIndex(e,0)}getComputedString(t){return this.getComputedStringAtIndex(0)}setComputedString(t,e){return this.setComputedStringAtIndex(0,e)}getComputedNumericAtIndex(t){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),t)}setComputedNumericAtIndex(t,e){this._storage.setComputedNumericAtIndex(this.getDisplayId(),t,e)}getComputedStringAtIndex(t){return this._storage.getComputedStringAtIndex(this.getDisplayId(),t)}setComputedStringAtIndex(t,e){return this._storage.setComputedStringAtIndex(this.getDisplayId(),t,e)}transform(t,e,r,s){const i=this.copy();return i._tx+=t,i._ty+=e,i._sx*=r,i._sy*=s,i}readAttribute(t,e=!1){const r=this._readAttribute(t,e);if(r!==void 0)return r;for(const s of this._joined){s.setIndex(this.getIndex());const i=s._readAttribute(t,e);if(i!==void 0)return i}}readAttributes(){const t=this._readAttributes();for(const e of this._joined){e.setIndex(this.getIndex());const r=e._readAttributes();for(const s of Object.keys(r))t[s]=r[s]}return t}joinAttributes(t){this._joined.push(t)}readArcadeFeature(){return this}geometry(){const t=this.readHydratedGeometry(),e=b(t,this.geometryType,this.hasZ,this.hasM),r=y(e);return r&&(r.spatialReference=this._arcadeSpatialReference),r}field(t){if(this.hasField(t))return this.readAttribute(t,!0);for(const e of this._joined)if(e.setIndex(this.getIndex()),e.hasField(t))return e._readAttribute(t,!0);throw new Error(`Field ${t} does not exist`)}setField(t,e){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.getFieldNames()}castToText(t=!1){if(!t)return JSON.stringify(this.readLegacyFeature());const e=this.readLegacyFeature();if(!e)return JSON.stringify(null);const r={geometry:e.geometry,attributes:{...e.attributes?e.attributes:{}}};for(const s in r.attributes){const i=r.attributes[s];i instanceof Date&&(r.attributes[s]=i.getTime())}return JSON.stringify(r)}gdbVersion(){return null}fullSchema(){return this._layerSchema}castAsJson(t=null){return{attributes:this._readAttributes(),geometry:(t==null?void 0:t.keepGeometryType)===!0?this.geometry():this.geometry().toJSON()}}castAsJsonAsync(t=null,e=null){return Promise.resolve(this.castAsJson(e))}removeIds(t){if(d(this._objectIdToIndex)){const r=new Map,s=this.getCursor();for(;s.next();){const i=c(s.getObjectId());r.set(i,s.getIndex())}this._objectIdToIndex=r}const e=this._objectIdToIndex;for(const r of t)e.has(r)&&this.removeAtIndex(e.get(r))}removeAtIndex(t){d(this._deleted)&&(this._deleted=o.create(this.getSize())),this._deleted.set(t)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const t=this.getCursor();for(;t.next();)yield t.readOptimizedFeature()}_getExists(){return d(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if(this.geometryType!=="esriGeometryPolygon")return null;const t=this.readUnquantizedGeometry();if(!t||t.hasIndeterminateRingOrder)return null;const e=g(this.getQuantizationTransform(),null);return m(new l,t,this.hasM,this.hasZ,e)}copyInto(t){t.seen=this.seen,t._storage=this._storage,t._arcadeSpatialReference=this._arcadeSpatialReference,t._joined=this._joined,t._tx=this._tx,t._ty=this._ty,t._sx=this._sx,t._sy=this._sy,t._deleted=this._deleted,t._objectIdToIndex=this._objectIdToIndex}}export{G as b,o as t};
