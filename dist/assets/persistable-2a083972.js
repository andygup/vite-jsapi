import{hK as O,hL as b,hx as P,eN as d,hM as v,eU as E,hN as F,hO as M,f8 as g,hP as S,ht as _,es as T,fQ as j,_ as J,hQ as A}from"./index-a9c4c008.js";import{i as $}from"./multiOriginJSONSupportUtils-ad07e08e.js";import{g as p}from"./resourceExtension-ecd257cb.js";function V(e){const n=(e==null?void 0:e.origins)??[void 0];return(r,i)=>{const o=k(e,r,i);for(const s of n){const u=O(r,s,i);for(const t in o)u[t]=o[t]}}}function k(e,n,r){if((e==null?void 0:e.type)==="resource")return B(e,n,r);switch((e==null?void 0:e.type)??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:o,write:s}=A;return{read:o,write:s}}}}function B(e,n,r){const i=b(n,r);return{type:String,read:(o,s,u)=>{const t=P(o,s,u);if(i.type===String)return t;if(typeof i.type=="function")return new i.type({url:t})},write:{writer(o,s,u,t){if(!t||!t.resources){if(typeof o=="string"){s[u]=d(o,t);return}s[u]=o.write({},t);return}const h=D(o),l=d(h,{...t,verifyItemRelativeUrls:t&&t.verifyItemRelativeUrls?{writtenUrls:t.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},v.NO),c=i.type!==String&&(!$(this)||t&&t.origin&&this.originIdOf(r)>E(t.origin)),f={object:this,propertyName:r,value:o,targetUrl:l,dest:s,targetPropertyName:u,context:t,params:e};if(t&&t.portalItem&&l&&!F(l)){c?C(f):K(f);return}if(t&&t.portalItem&&(l==null||M(l)!=null||g(l)||c)){U(f);return}s[u]=l}}}}function U(e){const{targetUrl:n,params:r,value:i,context:o,dest:s,targetPropertyName:u}=e;if(!o.portalItem)return;const t=S(n),h=(t==null?void 0:t.filename)??_(),l=(r==null?void 0:r.prefix)??(t==null?void 0:t.prefix),c=I(i,n,o),f=T(l,h),w=`${f}.${p(c)}`,a=o.portalItem.resourceFromPath(w);g(n)&&o.resources&&o.resources.pendingOperations.push(N(n).then(m=>{a.path=`${f}.${p(m)}`,s[u]=a.itemRelativeUrl}).catch(()=>{}));const R=(r==null?void 0:r.compress)??!1;o.resources&&y({...e,resource:a,content:c,compress:R,updates:o.resources.toAdd}),s[u]=a.itemRelativeUrl}function C(e){const{context:n,targetUrl:r,params:i,value:o,dest:s,targetPropertyName:u}=e;if(!n.portalItem)return;const t=n.portalItem.resourceFromPath(r),h=I(o,r,n),l=p(h),c=j(t.path),f=(i==null?void 0:i.compress)??!1;if(l!==c){U(e);return}n.resources&&y({...e,resource:t,content:h,compress:f,updates:n.resources.toUpdate}),s[u]=r}function K({context:e,targetUrl:n,dest:r,targetPropertyName:i}){!e.portalItem||!e.resources||(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(n),compress:!1}),r[i]=n)}function y({object:e,propertyName:n,updates:r,resource:i,content:o,compress:s}){r.push({resource:i,content:o,compress:s,finish:u=>{L(e,n,u)}})}function I(e,n,r){return typeof e=="string"?{url:n}:new Blob([JSON.stringify(e.toJSON(r))],{type:"application/json"})}async function N(e){const n=(await J(()=>import("./index-a9c4c008.js").then(i=>i.jk),["assets/index-a9c4c008.js","assets/index-d832a396.css"])).default,{data:r}=await n(e,{responseType:"blob"});return r}function D(e){return e==null?null:typeof e=="string"?e:e.url}function L(e,n,r){typeof e[n]=="string"?e[n]=r.url:e[n].url=r.url}export{V as p};
