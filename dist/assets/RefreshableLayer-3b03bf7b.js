import{J as m,fc as d,ae as o,af as h,ai as p,be as y,aN as g,L as v}from"./index-fb3bdf4f.js";const a=new m,n=new WeakMap;function L(e){c(e)&&a.push(e)}function b(e){c(e)&&a.includes(e)&&a.remove(e)}function c(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function u(e,r){return!Number.isFinite(e)||!Number.isFinite(r)?0:r<=0?e:u(r,e%r)}let l=0,f=0;d(()=>{const e=Date.now();let r=0;for(const t of a)r=u(Math.round(t.refreshInterval*6e4),r),t.refreshInterval?n.get(t)||n.set(t,e):n.delete(t);if(r!==f){if(f=r,clearInterval(l),f===0){l=0;return}l=setInterval(I,f)}});function I(){const e=Date.now();for(const r of a)if(r.refreshInterval){const t=n.get(r)??0;e-t+5>=r.refreshInterval*6e4&&(n.set(r,e),r.refresh(e))}}const R=e=>{let r=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=y(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||L(this)},()=>{})}destroy(){b(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){g(this._debounceHasDataChanged()).then(s=>{s&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:s})},s=>{v.getLogger(this.declaredClass).error(s),this.emit("refresh",{dataChanged:!1,error:s})})}async hasDataChanged(){return!0}};return o([h({type:Number,cast:t=>t>=.1?t:t<=0?0:.1,json:{write:!0}})],r.prototype,"refreshInterval",void 0),o([h({readOnly:!0})],r.prototype,"refreshTimestamp",void 0),o([h()],r.prototype,"refreshParameters",null),r=o([p("esri.layers.mixins.RefreshableLayer")],r),r};export{R};
