import{cH as F,ae as f,af as m,ah as G,bF as v,bG as w,bA as N,bt as d,ai as S,bD as P,bB as j,cF as q,ce as g}from"./index-175d32d0.js";import{y as b}from"./Field-b346df3f.js";var x;const R=new F({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let u=x=class extends P{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,n){const o=d.fromJSON(n.spatialReference),e=[];for(let s=0;s<t.length;s++){const i=t[s],a=G.fromJSON(i),p=i.geometry&&i.geometry.spatialReference;a.geometry==null||p||(a.geometry.spatialReference=o);const y=i.aggregateGeometries,r=a.aggregateGeometries;if(y&&r!=null)for(const l in r){const h=r[l],c=y[l],T=c==null?void 0:c.spatialReference;h==null||T||(h.spatialReference=o)}e.push(a)}return e}writeGeometryType(t,n,o,e){if(t)return void R.write(t,n,o,e);const{features:s}=this;if(s){for(const i of s)if(i&&i.geometry!=null)return void R.write(i.geometry.type,n,o,e)}}readQueryGeometry(t,n){if(!t)return null;const o=!!t.spatialReference,e=j(t);return e&&!o&&n.spatialReference&&(e.spatialReference=d.fromJSON(n.spatialReference)),e}writeSpatialReference(t,n){if(t)return void(n.spatialReference=t.toJSON());const{features:o}=this;if(o){for(const e of o)if(e&&e.geometry!=null&&e.geometry.spatialReference)return void(n.spatialReference=e.geometry.spatialReference.toJSON())}}clone(){return new x(this.cloneProperties())}cloneProperties(){return q({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const n=this.write();if(n.features&&Array.isArray(t)&&t.length>0)for(let o=0;o<n.features.length;o++){const e=n.features[o];if(e.geometry){const s=t&&t[o];e.geometry=s&&s.toJSON()||e.geometry}}return n}quantize(t){const{scale:[n,o],translate:[e,s]}=t,i=r=>Math.round((r-e)/n),a=r=>Math.round((s-r)/o),p=this.features,y=this._getQuantizationFunction(this.geometryType,i,a);for(let r=0,l=p.length;r<l;r++)y!=null&&y(p[r].geometry)||(p.splice(r,1),r--,l--);return this.transform=t,this}unquantize(){const{geometryType:t,features:n,transform:o}=this;if(!o)return this;const{translate:[e,s],scale:[i,a]}=o,p=l=>l*i+e,y=l=>s-l*a,r=this._getHydrationFunction(t,p,y);for(const{geometry:l}of n)l!=null&&r&&r(l);return this.transform=null,this}_quantizePoints(t,n,o){let e,s;const i=[];for(let a=0,p=t.length;a<p;a++){const y=t[a];if(a>0){const r=n(y[0]),l=o(y[1]);r===e&&l===s||(i.push([r-e,l-s]),e=r,s=l)}else e=n(y[0]),s=o(y[1]),i.push([e,s])}return i.length>0?i:null}_getQuantizationFunction(t,n,o){return t==="point"?e=>(e.x=n(e.x),e.y=o(e.y),e):t==="polyline"||t==="polygon"?e=>{const s=g(e)?e.rings:e.paths,i=[];for(let a=0,p=s.length;a<p;a++){const y=s[a],r=this._quantizePoints(y,n,o);r&&i.push(r)}return i.length>0?(g(e)?e.rings=i:e.paths=i,e):null}:t==="multipoint"?e=>{const s=this._quantizePoints(e.points,n,o);return s&&s.length>0?(e.points=s,e):null}:t==="extent"?e=>e:null}_getHydrationFunction(t,n,o){return t==="point"?e=>{e.x=n(e.x),e.y=o(e.y)}:t==="polyline"||t==="polygon"?e=>{const s=g(e)?e.rings:e.paths;let i,a;for(let p=0,y=s.length;p<y;p++){const r=s[p];for(let l=0,h=r.length;l<h;l++){const c=r[l];l>0?(i+=c[0],a+=c[1]):(i=c[0],a=c[1]),c[0]=n(i),c[1]=o(a)}}}:t==="extent"?e=>{e.xmin=n(e.xmin),e.ymin=o(e.ymin),e.xmax=n(e.xmax),e.ymax=o(e.ymax)}:t==="multipoint"?e=>{const s=e.points;let i,a;for(let p=0,y=s.length;p<y;p++){const r=s[p];p>0?(i+=r[0],a+=r[1]):(i=r[0],a=r[1]),r[0]=n(i),r[1]=o(a)}}:null}};f([m({type:String,json:{write:!0}})],u.prototype,"displayFieldName",void 0),f([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],u.prototype,"exceededTransferLimit",void 0),f([m({type:[G],json:{write:!0}})],u.prototype,"features",void 0),f([v("features")],u.prototype,"readFeatures",null),f([m({type:[b],json:{write:!0}})],u.prototype,"fields",void 0),f([m({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:R.read}}})],u.prototype,"geometryType",void 0),f([w("geometryType")],u.prototype,"writeGeometryType",null),f([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],u.prototype,"hasM",void 0),f([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],u.prototype,"hasZ",void 0),f([m({types:N,json:{write:!0}})],u.prototype,"queryGeometry",void 0),f([v("queryGeometry")],u.prototype,"readQueryGeometry",null),f([m({type:d,json:{write:!0}})],u.prototype,"spatialReference",void 0),f([w("spatialReference")],u.prototype,"writeSpatialReference",null),f([m({json:{write:!0}})],u.prototype,"transform",void 0),u=x=f([S("esri.rest.support.FeatureSet")],u),u.prototype.toJSON.isDefaultToJSON=!0;const z=u;export{z as g};
