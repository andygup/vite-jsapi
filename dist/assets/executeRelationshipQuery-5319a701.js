import{r as p,bw as f}from"./index-cc043433.js";import{m as y}from"./query-9e3c025a.js";import{F as R}from"./FeatureSet-c867eab0.js";import l from"./RelationshipQuery-5072c00c.js";import"./normalizeUtils-0017e781.js";import"./normalizeUtilsCommon-f6f02a9c.js";import"./pbfQueryUtils-7123e2aa.js";import"./pbf-d1689fd2.js";import"./OptimizedGeometry-af84d2ad.js";import"./OptimizedFeatureSet-5c82fe5a.js";import"./queryZScale-7ff9b58f.js";import"./Field-7a917492.js";import"./fieldType-79ae9077.js";import"./Query-74ceeec9.js";function S(o,t){const e=o.toJSON();return e.objectIds&&(e.objectIds=e.objectIds.join(",")),e.orderByFields&&(e.orderByFields=e.orderByFields.join(",")),e.outFields&&!(t!=null&&t.returnCountOnly)?e.outFields.includes("*")?e.outFields="*":e.outFields=e.outFields.join(","):delete e.outFields,e.outSpatialReference&&(e.outSR=e.outSR.wkid||JSON.stringify(e.outSR.toJSON()),delete e.outSpatialReference),e.dynamicDataSource&&(e.layer=JSON.stringify({source:e.dynamicDataSource}),delete e.dynamicDataSource),e}async function j(o,t,e){const s=await m(o,t,e),r=s.data,a=r.geometryType,n=r.spatialReference,u={};for(const c of r.relatedRecordGroups){const i={fields:void 0,objectIdFieldName:void 0,geometryType:a,spatialReference:n,hasZ:!!r.hasZ,hasM:!!r.hasM,features:c.relatedRecords};if(c.objectId!=null)u[c.objectId]=i;else for(const d of Object.keys(c))d!=="relatedRecords"&&(u[c[d]]=i)}return{...s,data:u}}async function F(o,t,e){const s=await m(o,t,e,{returnCountOnly:!0}),r=s.data,a={};for(const n of r.relatedRecordGroups)n.objectId!=null&&(a[n.objectId]=n.count);return{...s,data:a}}async function m(o,t,e={},s){const r=y({...o.query,f:"json",...s,...S(t,s)});return p(o.path+"/queryRelatedRecords",{...e,query:{...e.query,...r}})}async function B(o,t,e){t=l.from(t);const s=f(o);return j(s,t,e).then(r=>{const a=r.data,n={};return Object.keys(a).forEach(u=>n[u]=R.fromJSON(a[u])),n})}async function Q(o,t,e){t=l.from(t);const s=f(o);return F(s,t,{...e}).then(r=>r.data)}export{B as executeRelationshipQuery,Q as executeRelationshipQueryForCount};
