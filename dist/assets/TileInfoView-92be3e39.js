import{hi as U,l7 as P,hh as x}from"./index-0b6846a6.js";var O,R,y,B,v,N,p;(function(t){t[t.FILL=0]="FILL",t[t.LINE=1]="LINE",t[t.MARKER=2]="MARKER",t[t.TEXT=3]="TEXT",t[t.LABEL=4]="LABEL"})(O||(O={})),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LABEL=2]="LABEL",t[t.LABEL_ALPHA=4]="LABEL_ALPHA",t[t.HITTEST=8]="HITTEST",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.CLIP=32]="CLIP",t[t.DEBUG=64]="DEBUG",t[t.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(R||(R={})),function(t){t[t.SIZE=0]="SIZE",t[t.COLOR=1]="COLOR",t[t.OPACITY=2]="OPACITY",t[t.ROTATION=3]="ROTATION"}(y||(y={})),function(t){t[t.NONE=0]="NONE",t[t.OPACITY=1]="OPACITY",t[t.COLOR=2]="COLOR",t[t.ROTATION=4]="ROTATION",t[t.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",t[t.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",t[t.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",t[t.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(B||(B={})),function(t){t[t.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",t[t.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",t[t.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",t[t.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(v||(v={})),function(t){t[t.SPRITE=0]="SPRITE",t[t.GLYPH=1]="GLYPH"}(N||(N={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SIMPLE=1]="SIMPLE",t[t.DOT_DENSITY=2]="DOT_DENSITY",t[t.OUTLINE_FILL=3]="OUTLINE_FILL",t[t.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",t[t.HEATMAP=5]="HEATMAP",t[t.PIE_CHART=6]="PIE_CHART"}(p||(p={}));class F{constructor(){this.spans=[]}acquire(o){this.lodInfo=o}release(){this.lodInfo=null,this.spans.length=0}forEach(o,e){const{spans:i,lodInfo:l}=this,{level:r}=l;if(i.length!==0)for(const{row:n,colFrom:s,colTo:h}of i)for(let a=s;a<=h;a++)o.call(e,r,n,l.normalizeCol(a),l.getWorldForColumn(a))}}F.pool=new U(F);function A(t,o){return[t,o]}function M(t,o,e){return t[0]=o,t[1]=e,t}function Y(t,o,e,i,l){return t[0]=o,t[1]=e,t[2]=i,t[3]=l,t}const S=new P("0/0/0/0");let D=class z{static create(o,e,i=null){const l=x(o.spatialReference),r=e.origin||A(o.origin.x,o.origin.y),n=A(o.size[0]*e.resolution,o.size[1]*e.resolution),s=A(-1/0,-1/0),h=A(1/0,1/0),a=A(1/0,1/0);i!=null&&(M(s,Math.max(0,Math.floor((i.xmin-r[0])/n[0])),Math.max(0,Math.floor((r[1]-i.ymax)/n[1]))),M(h,Math.max(0,Math.floor((i.xmax-r[0])/n[0])),Math.max(0,Math.floor((r[1]-i.ymin)/n[1]))),M(a,h[0]-s[0]+1,h[1]-s[1]+1));const{cols:T,rows:I}=e;let g,m,d,f;return!i&&T&&I&&(M(s,T[0],I[0]),M(h,T[1],I[1]),M(a,T[1]-T[0]+1,I[1]-I[0]+1)),o.isWrappable?(g=A(Math.ceil(Math.round((l.valid[1]-l.valid[0])/e.resolution)/o.size[0]),a[1]),m=A(Math.floor((l.origin[0]-r[0])/n[0]),s[1]),d=A(g[0]+m[0]-1,h[1]),f=!0):(m=s,d=h,g=a,f=!1),new z(e.level,e.resolution,e.scale,r,s,h,a,n,m,d,g,f)}constructor(o,e,i,l,r,n,s,h,a,T,I,g){this.level=o,this.resolution=e,this.scale=i,this.origin=l,this.first=r,this.last=n,this.size=s,this.norm=h,this.worldStart=a,this.worldEnd=T,this.worldSize=I,this.wrap=g}normalizeCol(o){if(!this.wrap)return o;const e=this.worldSize[0];return o<0?e-1-Math.abs((o+1)%e):o%e}denormalizeCol(o,e){return this.wrap?this.worldSize[0]*e+o:o}getWorldForColumn(o){return this.wrap?Math.floor(o/this.worldSize[0]):0}getFirstColumnForWorld(o){return o*this.worldSize[0]+this.first[0]}getLastColumnForWorld(o){return o*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(o){return(o-this.origin[0])/this.norm[0]}getXForColumn(o){return this.origin[0]+o*this.norm[0]}getRowForY(o){return(this.origin[1]-o)/this.norm[1]}getYForRow(o){return this.origin[1]-o*this.norm[1]}getTileBounds(o,e,i=!1){S.set(e);const l=i?S.col:this.denormalizeCol(S.col,S.world),r=S.row;return Y(o,this.getXForColumn(l),this.getYForRow(r+1),this.getXForColumn(l+1),this.getYForRow(r)),o}getTileCoords(o,e,i=!1){S.set(e);const l=i?S.col:this.denormalizeCol(S.col,S.world);return Array.isArray(o)?M(o,this.getXForColumn(l),this.getYForRow(S.row)):(o.x=this.getXForColumn(l),o.y=this.getYForRow(S.row)),o}};class w{constructor(o,e,i){this.row=o,this.colFrom=e,this.colTo=i}}const u=new P("0/0/0/0");class C{static create(o,e){o[1]>e[1]&&([o,e]=[e,o]);const[i,l]=o,[r,n]=e,s=r-i,h=n-l,a=h!==0?s/h:0,T=(Math.ceil(l)-l)*a,I=(Math.floor(l)-l)*a;return new C(i,Math.floor(l),Math.ceil(n),a,s<0?T:I,s<0?I:T,s<0?r:i,s<0?i:r)}constructor(o,e,i,l,r,n,s,h){this.x=o,this.ymin=e,this.ymax=i,this.invM=l,this.leftAdjust=r,this.rightAdjust=n,this.leftBound=s,this.rightBound=h}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const _=[[0,0],[0,0],[0,0],[0,0]],H=1e-6;class G{constructor(o,e=null){this.tileInfo=o,this.fullExtent=e,this.scales=[],this._infoByScale={},this._infoByLevel={};const i=o.lods.slice();i.sort((r,n)=>n.scale-r.scale);const l=this._lodInfos=i.map(r=>D.create(o,r,e));i.forEach((r,n)=>{this._infoByLevel[r.level]=l[n],this._infoByScale[r.scale]=l[n],this.scales[n]=r.scale},this),this._wrap=o.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(o){return this._infoByLevel[typeof o=="number"?o:o.level]}getTileBounds(o,e,i=!1){u.set(e);const l=this._infoByLevel[u.level];return l?l.getTileBounds(o,u,i):o}getTileCoords(o,e,i=!1){u.set(e);const l=this._infoByLevel[u.level];return l?l.getTileCoords(o,u,i):o}getTileCoverage(o,e=192,i="closest"){const l=i==="closest"?this.getClosestInfoForScale(o.scale):this.getSmallestInfoForScale(o.scale),r=F.pool.acquire(l),n=this._wrap;let s,h,a,T=1/0,I=-1/0;const g=r.spans;_[0][0]=_[0][1]=_[1][1]=_[3][0]=-e,_[1][0]=_[2][0]=o.size[0]+e,_[2][1]=_[3][1]=o.size[1]+e;for(const c of _)o.toMap(c,c),c[0]=l.getColumnForX(c[0]),c[1]=l.getRowForY(c[1]);const m=[];let d=3;for(let c=0;c<4;c++){if(_[c][1]===_[d][1]){d=c;continue}const L=C.create(_[c],_[d]);T=Math.min(L.ymin,T),I=Math.max(L.ymax,I),m[L.ymin]===void 0&&(m[L.ymin]=[]),m[L.ymin].push(L),d=c}if(T==null||I==null||I-T>100)return null;let f=[];for(s=T;s<I;){m[s]!=null&&(f=f.concat(m[s])),h=1/0,a=-1/0;for(let c=f.length-1;c>=0;c--){const L=f[c];h=Math.min(h,L.getLeftCol()),a=Math.max(a,L.getRightCol())}if(h=Math.floor(h),a=Math.floor(a),s>=l.first[1]&&s<=l.last[1])if(n)if(l.size[0]<l.worldSize[0]){const c=Math.floor(a/l.worldSize[0]);for(let L=Math.floor(h/l.worldSize[0]);L<=c;L++)g.push(new w(s,Math.max(l.getFirstColumnForWorld(L),h),Math.min(l.getLastColumnForWorld(L),a)))}else g.push(new w(s,h,a));else h>l.last[0]||a<l.first[0]||(h=Math.max(h,l.first[0]),a=Math.min(a,l.last[0]),g.push(new w(s,h,a)));s+=1;for(let c=f.length-1;c>=0;c--){const L=f[c];L.ymax>=s?L.incrRow():f.splice(c,1)}}return r}getTileParentId(o){u.set(o);const e=this._infoByLevel[u.level],i=this._lodInfos.indexOf(e)-1;return i<0?null:(this._getTileIdAtLOD(u,this._lodInfos[i],u),u.id)}getTileResolution(o){const e=this._infoByLevel[typeof o=="object"?o.level:o];return e?e.resolution:-1}getTileScale(o){const e=this._infoByLevel[o.level];return e?e.scale:-1}intersects(o,e){u.set(e);const i=this._infoByLevel[u.level],l=o.lodInfo;if(l.resolution>i.resolution){this._getTileIdAtLOD(u,l,u);const n=l.denormalizeCol(u.col,u.world);for(const s of o.spans)if(s.row===u.row&&s.colFrom<=n&&s.colTo>=n)return!0}if(l.resolution<i.resolution){const[n,s,h,a]=o.spans.reduce((f,c)=>(f[0]=Math.min(f[0],c.row),f[1]=Math.max(f[1],c.row),f[2]=Math.min(f[2],c.colFrom),f[3]=Math.max(f[3],c.colTo),f),[1/0,-1/0,1/0,-1/0]),T=i.denormalizeCol(u.col,u.world),I=l.getColumnForX(i.getXForColumn(T)),g=l.getRowForY(i.getYForRow(u.row)),m=l.getColumnForX(i.getXForColumn(T+1))-1,d=l.getRowForY(i.getYForRow(u.row+1))-1;return!(I>a||m<h||g>s||d<n)}const r=l.denormalizeCol(u.col,u.world);return o.spans.some(n=>n.row===u.row&&n.colFrom<=r&&n.colTo>=r)}normalizeBounds(o,e,i){if(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],this._wrap){const l=x(this.tileInfo.spatialReference),r=-i*(l.valid[1]-l.valid[0]);o[0]+=r,o[2]+=r}return o}getSmallestInfoForScale(o){const e=this.scales;if(this._infoByScale[o])return this._infoByScale[o];if(o>e[0])return this._infoByScale[e[0]];for(let i=1;i<e.length-1;i++)if(o>e[i]+H)return this._infoByScale[e[i-1]];return this._infoByScale[e[e.length-1]]}getClosestInfoForScale(o){const e=this.scales;return this._infoByScale[o]||(o=e.reduce((i,l)=>Math.abs(l-o)<Math.abs(i-o)?l:i,e[0])),this._infoByScale[o]}scaleToLevel(o){const e=this.scales;if(this._infoByScale[o])return this._infoByScale[o].level;for(let i=e.length-1;i>=0;i--)if(o<e[i])return i===e.length-1?this._infoByScale[e[e.length-1]].level:this._infoByScale[e[i]].level+(e[i]-o)/(e[i]-e[i+1]);return this._infoByScale[e[0]].level}scaleToZoom(o){return this.tileInfo.scaleToZoom(o)}_getTileIdAtLOD(o,e,i){const l=this._infoByLevel[i.level];return o.set(i),e.resolution<l.resolution?null:(e.resolution===l.resolution||(o.level=e.level,o.col=Math.floor(i.col*l.resolution/e.resolution+.01),o.row=Math.floor(i.row*l.resolution/e.resolution+.01)),o)}}export{v as A,O as E,B as L,p as S,R as T,G as h,F as l};
