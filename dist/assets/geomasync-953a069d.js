import{cJ as d,bf as U,a2 as C,K as D,cc as O,a1 as G,bB as V,bu as en,Q as un}from"./index-0ea7d266.js";import{G as w,p as y,H as W,w as z,m as b,n as N,z as M,J as F,q as T,K as k,L as h,M as H,O as P,P as E,Q as j,t as S,T as ln,U as fn,V as rn,W as K,D as q,X as B,Y as cn,Z as L}from"./arcadeUtils-41d7ce0f.js";import{d as on,i as sn,t as wn,c as hn,w as dn,a as yn,o as _n,e as gn,r as Pn,b as An,u as In,f as Fn,s as Rn,g as bn,h as Nn,p as Q,j as X,k as J,l as $,m as Sn,n as Y,q as v,v as Cn,x as On,y as Un,z as kn,A as a,B as x,C as Dn,D as Mn}from"./geometryEngineAsync-ea32e9e5.js";import{A as f,E as r}from"./executionError-e2eca390.js";import{g as p,l as m}from"./portalUtils-d6fe8b97.js";import"./arcadeTimeUtils-b7ab261c.js";import"./FieldsIndex-e2dec42a.js";import"./number-cf71f7c3.js";import"./Field-da71a869.js";import"./fieldType-2fab90c6.js";import"./featureConversionUtils-70bb5e62.js";import"./OptimizedGeometry-af84d2ad.js";import"./OptimizedFeatureSet-5c82fe5a.js";import"./sizeVariableUtils-2914222a.js";function nn(e){return en.indexOf("4.")===0?O.fromExtent(e):new O({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function R(e,i,t){if(y(e,2,2,i,t),!(e[0]instanceof d&&e[1]instanceof d)){if(!(e[0]instanceof d&&e[1]===null)){if(!(e[1]instanceof d&&e[0]===null)){if(!(e[0]===null&&e[1]===null))throw new f(i,r.InvalidParameter,t)}}}}async function tn(e,i){if(!(e.type==="polygon"||e.type==="polyline"||e.type==="extent"))return 0;let t=1;if(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid){const n=cn(e.spatialReference),u=un(e.spatialReference);t=n/u}let c=0;if(e.type==="polyline")for(const n of e.paths)for(let u=1;u<n.length;u++)c+=L(n[u],n[u-1],t);else if(e.type==="polygon")for(const n of e.rings){for(let u=1;u<n.length;u++)c+=L(n[u],n[u-1],t);(n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1]||n[0][2]!==void 0&&n[0][2]!==n[n.length-1][2])&&(c+=L(n[0],n[n.length-1],t))}else e.type==="extent"&&(c+=L([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],t)*2,c+=L([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],t)*2,c*=2,c+=4*Math.abs(h(e.zmax,0)*t-h(e.zmin,0)*t));const s=new C({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:[[0,0],[0,c]]});return J(s,i)}function Kn(e){e.mode==="async"&&(e.functions.disjoint=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]===null||n[1]===null?!0:on(n[0],n[1])))},e.functions.intersects=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]===null||n[1]===null?!1:sn(n[0],n[1])))},e.functions.touches=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]===null||n[1]===null?!1:wn(n[0],n[1])))},e.functions.crosses=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]===null||n[1]===null?!1:hn(n[0],n[1])))},e.functions.within=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]===null||n[1]===null?!1:dn(n[0],n[1])))},e.functions.contains=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]===null||n[1]===null?!1:yn(n[0],n[1])))},e.functions.overlaps=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]===null||n[1]===null?!1:_n(n[0],n[1])))},e.functions.equals=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(y(n,2,2,i,t),n[0]===n[1]?!0:n[0]instanceof d&&n[1]instanceof d?gn(n[0],n[1]):W(n[0])&&W(n[1])?n[0].equals(n[1]):!1))},e.functions.relate=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,3,3,i,t),n[0]instanceof d&&n[1]instanceof d)return Pn(n[0],n[1],z(n[2]));if(n[0]instanceof d&&n[1]===null||n[1]instanceof d&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new f(i,r.InvalidParameter,t)})},e.functions.intersection=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]===null||n[1]===null?null:An(n[0],n[1])))},e.functions.union=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{n=w(n);const u=[];if(n.length===0)throw new f(i,r.WrongNumberOfParameters,t);if(n.length===1)if(b(n[0])){const l=w(n[0]);for(let o=0;o<l.length;o++)if(l[o]!==null){if(!(l[o]instanceof d))throw new f(i,r.InvalidParameter,t);u.push(l[o])}}else if(N(n[0])){const l=w(n[0].toArray());for(let o=0;o<l.length;o++)if(l[o]!==null){if(!(l[o]instanceof d))throw new f(i,r.InvalidParameter,t);u.push(l[o])}}else{if(n[0]instanceof d)return M(F(n[0]),i.spatialReference);if(n[0]===null)return null;throw new f(i,r.InvalidParameter,t)}else for(let l=0;l<n.length;l++)if(n[l]!==null){if(!(n[l]instanceof d))throw new f(i,r.InvalidParameter,t);u.push(n[l])}return u.length===0?null:In(u)})},e.functions.difference=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]!==null&&n[1]===null?F(n[0]):n[0]===null?null:Fn(n[0],n[1])))},e.functions.symmetricdifference=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>(n=w(n),R(n,i,t),n[0]===null&&n[1]===null?null:n[0]===null?F(n[1]):n[1]===null?F(n[0]):Rn(n[0],n[1])))},e.functions.clip=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,2,2,i,t),!(n[1]instanceof U)&&n[1]!==null)throw new f(i,r.InvalidParameter,t);if(n[0]===null)return null;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return n[1]===null?null:bn(n[0],n[1])})},e.functions.cut=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,2,2,i,t),!(n[1]instanceof C)&&n[1]!==null)throw new f(i,r.InvalidParameter,t);if(n[0]===null)return[];if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return n[1]===null?[F(n[0])]:Nn(n[0],n[1])})},e.functions.area=function(i,t){return e.standardFunctionAsync(i,t,async(c,s,n)=>{if(y(n,1,2,i,t),n=w(n),n[0]===null)return 0;if(T(n[0])){const u=await n[0].sumArea(k(h(n[1],-1)),!1,i.abortSignal);if(i.abortSignal.aborted)throw new f(i,r.Cancelled,t);return u}if(b(n[0])||N(n[0])){const u=H(n[0],i.spatialReference);return u===null?0:Q(u,k(h(n[1],-1)))}if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return Q(n[0],k(h(n[1],-1)))})},e.functions.areageodetic=function(i,t){return e.standardFunctionAsync(i,t,async(c,s,n)=>{if(y(n,1,2,i,t),n=w(n),n[0]===null)return 0;if(T(n[0])){const u=await n[0].sumArea(k(h(n[1],-1)),!0,i.abortSignal);if(i.abortSignal.aborted)throw new f(i,r.Cancelled,t);return u}if(b(n[0])||N(n[0])){const u=H(n[0],i.spatialReference);return u===null?0:X(u,k(h(n[1],-1)))}if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return X(n[0],k(h(n[1],-1)))})},e.functions.length=function(i,t){return e.standardFunctionAsync(i,t,async(c,s,n)=>{if(y(n,1,2,i,t),n=w(n),n[0]===null)return 0;if(T(n[0])){const u=await n[0].sumLength(P(h(n[1],-1)),!1,i.abortSignal);if(i.abortSignal.aborted)throw new f(i,r.Cancelled,t);return u}if(b(n[0])||N(n[0])){const u=E(n[0],i.spatialReference);return u===null?0:J(u,P(h(n[1],-1)))}if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return J(n[0],P(h(n[1],-1)))})},e.functions.length3d=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(y(n,1,2,i,t),n=w(n),n[0]===null)return 0;if(b(n[0])||N(n[0])){const u=E(n[0],i.spatialReference);return u===null?0:u.hasZ===!0?tn(u,P(h(n[1],-1))):J(u,P(h(n[1],-1)))}if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return n[0].hasZ===!0?tn(n[0],P(h(n[1],-1))):J(n[0],P(h(n[1],-1)))})},e.functions.lengthgeodetic=function(i,t){return e.standardFunctionAsync(i,t,async(c,s,n)=>{if(y(n,1,2,i,t),n=w(n),n[0]===null)return 0;if(T(n[0])){const u=await n[0].sumLength(P(h(n[1],-1)),!0,i.abortSignal);if(i.abortSignal.aborted)throw new f(i,r.Cancelled,t);return u}if(b(n[0])||N(n[0])){const u=E(n[0],i.spatialReference);return u===null?0:$(u,P(h(n[1],-1)))}if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return $(n[0],P(h(n[1],-1)))})},e.functions.distance=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{n=w(n),y(n,2,3,i,t);let u=n[0];(b(n[0])||N(n[0]))&&(u=j(n[0],i.spatialReference));let l=n[1];if((b(n[1])||N(n[1]))&&(l=j(n[1],i.spatialReference)),!(u instanceof d))throw new f(i,r.InvalidParameter,t);if(!(l instanceof d))throw new f(i,r.InvalidParameter,t);return Sn(u,l,P(h(n[2],-1)))})},e.functions.distancegeodetic=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{n=w(n),y(n,2,3,i,t);const u=n[0],l=n[1];if(!(u instanceof D))throw new f(i,r.InvalidParameter,t);if(!(l instanceof D))throw new f(i,r.InvalidParameter,t);const o=new C({paths:[],spatialReference:u.spatialReference});return o.addPath([u,l]),$(o,P(h(n[2],-1)))})},e.functions.densify=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,2,3,i,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);const u=S(n[1]);if(isNaN(u))throw new f(i,r.InvalidParameter,t);if(u<=0)throw new f(i,r.InvalidParameter,t);return n[0]instanceof O||n[0]instanceof C?Y(n[0],u,P(h(n[2],-1))):n[0]instanceof U?Y(nn(n[0]),u,P(h(n[2],-1))):n[0]})},e.functions.densifygeodetic=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,2,3,i,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);const u=S(n[1]);if(isNaN(u))throw new f(i,r.InvalidParameter,t);if(u<=0)throw new f(i,r.InvalidParameter,t);return n[0]instanceof O||n[0]instanceof C?v(n[0],u,P(h(n[2],-1))):n[0]instanceof U?v(nn(n[0]),u,P(h(n[2],-1))):n[0]})},e.functions.generalize=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,2,4,i,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);const u=S(n[1]);if(isNaN(u))throw new f(i,r.InvalidParameter,t);return Cn(n[0],u,ln(h(n[2],!0)),P(h(n[3],-1)))})},e.functions.buffer=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,2,3,i,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);const u=S(n[1]);if(isNaN(u))throw new f(i,r.InvalidParameter,t);return u===0?F(n[0]):On(n[0],u,P(h(n[2],-1)))})},e.functions.buffergeodetic=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,2,3,i,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);const u=S(n[1]);if(isNaN(u))throw new f(i,r.InvalidParameter,t);return u===0?F(n[0]):Un(n[0],u,P(h(n[2],-1)))})},e.functions.offset=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,2,6,i,t),n[0]===null)return null;if(!(n[0]instanceof O||n[0]instanceof C))throw new f(i,r.InvalidParameter,t);const u=S(n[1]);if(isNaN(u))throw new f(i,r.InvalidParameter,t);const l=S(h(n[4],10));if(isNaN(l))throw new f(i,r.InvalidParameter,t);const o=S(h(n[5],0));if(isNaN(o))throw new f(i,r.InvalidParameter,t);return kn(n[0],u,P(h(n[2],-1)),z(h(n[3],"round")).toLowerCase(),l,o)})},e.functions.rotate=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{n=w(n),y(n,2,3,i,t);let u=n[0];if(u===null)return null;if(!(u instanceof d))throw new f(i,r.InvalidParameter,t);u instanceof U&&(u=O.fromExtent(u));const l=S(n[1]);if(isNaN(l))throw new f(i,r.InvalidParameter,t);const o=h(n[2],null);if(o===null)return a(u,l);if(o instanceof D)return a(u,l,o);throw new f(i,r.InvalidParameter,t)})},e.functions.centroid=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,1,1,i,t),n[0]===null)return null;let u=n[0];if((b(n[0])||N(n[0]))&&(u=j(n[0],i.spatialReference)),u===null)return null;if(!(u instanceof d))throw new f(i,r.InvalidParameter,t);return u instanceof D?M(F(n[0]),i.spatialReference):u instanceof O?u.centroid:u instanceof C?fn(u):u instanceof G?rn(u):u instanceof U?u.center:null})},e.functions.multiparttosinglepart=function(i,t){return e.standardFunctionAsync(i,t,async(c,s,n)=>{n=w(n),y(n,1,1,i,t);const u=[];if(n[0]===null)return null;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);if(n[0]instanceof D)return[M(F(n[0]),i.spatialReference)];if(n[0]instanceof U)return[M(F(n[0]),i.spatialReference)];const l=await x(n[0]);if(l instanceof O){const o=[],g=[];for(let _=0;_<l.rings.length;_++)if(l.isClockwise(l.rings[_])){const A=V({rings:[l.rings[_]],hasZ:l.hasZ===!0,hazM:l.hasM===!0,spatialReference:l.spatialReference.toJSON()});o.push(A)}else g.push({ring:l.rings[_],pt:l.getPoint(_,0)});for(let _=0;_<g.length;_++)for(let A=0;A<o.length;A++)if(o[A].contains(g[_].pt)){o[A].addRing(g[_].ring);break}return o}if(l instanceof C){const o=[];for(let g=0;g<l.paths.length;g++){const _=V({paths:[l.paths[g]],hasZ:l.hasZ===!0,hazM:l.hasM===!0,spatialReference:l.spatialReference.toJSON()});o.push(_)}return o}if(n[0]instanceof G){const o=M(F(n[0]),i.spatialReference);for(let g=0;g<o.points.length;g++)u.push(o.getPoint(g));return u}return null})},e.functions.issimple=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,1,1,i,t),n[0]===null)return!0;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return Dn(n[0])})},e.functions.simplify=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,1,1,i,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return x(n[0])})},e.functions.convexhull=function(i,t){return e.standardFunctionAsync(i,t,(c,s,n)=>{if(n=w(n),y(n,1,1,i,t),n[0]===null)return null;if(!(n[0]instanceof d))throw new f(i,r.InvalidParameter,t);return Mn(n[0])})},e.functions.getuser=function(i,t){return e.standardFunctionAsync(i,t,async(c,s,n)=>{y(n,0,2,i,t);let u=h(n[1],""),l=u===!0;if(u===!0||u===!1?u="":u=z(u),n.length===0||n[0]instanceof K){let g=null;i.services&&i.services.portal&&(g=i.services.portal),n.length>0&&(g=p(n[0],g));const _=await m(g,u,l);if(_){const A=JSON.parse(JSON.stringify(_));for(const I of["lastLogin","created","modified"])A[I]!==void 0&&A[I]!==null&&(A[I]=new Date(A[I]));return q.convertObjectToArcadeDictionary(A,B(i))}return null}let o=null;if(T(n[0])&&(o=n[0]),o){if(l=!1,u)return null;await o.load();const g=await o.getOwningSystemUrl();if(!g){if(!u){const I=await o.getIdentityUser();return I?q.convertObjectToArcadeDictionary({username:I},B(i)):null}return null}let _=null;i.services&&i.services.portal&&(_=i.services.portal),_=p(new K(g),_);const A=await m(_,u,l);if(A){const I=JSON.parse(JSON.stringify(A));for(const Z of["lastLogin","created","modified"])I[Z]!==void 0&&I[Z]!==null&&(I[Z]=new Date(I[Z]));return q.convertObjectToArcadeDictionary(I,B(i))}return null}throw new f(i,r.InvalidParameter,t)})})}export{Kn as registerFunctions};
