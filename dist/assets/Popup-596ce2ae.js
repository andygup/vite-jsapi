import{a4 as Nt,a5 as Ve,F as Ri,J as G,a6 as nt,a7 as vn,a8 as bn,a9 as Oi,aa as Vi,ab as wn,ac as Mn,ad as In,V as he,ae as a,af as d,ag as Fe,ah as De,ai as L,aj as Ce,D as M,E as D,s as E,ak as Fn,al as K,am as Z,an as pe,ao as Qe,_ as w,ap as u,aq as st,ar as Jt,as as oe,at as Cn,au as St,av as An,aw as Di,ax as Ni,ay as $n,az as En,Y as xn,P as Me,aA as Tn,L as kn,aB as Bt,aC as Ln,aD as Pn,aE as J,aF as Lt,aG as Te,aH as Rn,aI as Si,aJ as On,aK as Vn,aL as Dn,aM as Bi,aN as ft,B as qi,aO as zi,z as dt,d as Nn,aP as Sn,aQ as ot,aR as Bn,aS as Ge,aT as qn,m as Wi,aU as zn,aV as Wn,aW as Un,aX as jn,aY as Hn,aZ as Qn,a_ as Gn,a$ as Zt,K as Kn,b0 as ei,b1 as Yn,b2 as Xn,b3 as Jn,b4 as de}from"./index-298039cc.js";import{e as Oe}from"./throttle-7bf02de9.js";import{E as ti}from"./ByteSizeUnit-d4757d40.js";import{l as Zn}from"./AttachmentInfo-e5242fbe.js";import{c as ii}from"./AttachmentQuery-d56ecafe.js";import{e as Ui,t as es}from"./widget-4bed28e8.js";import"./ColorStop-a25162f1.js";import{h as Ee,J as ts,g as mt,M as is,R as ns}from"./utils-ddc505ee.js";import{a as ss}from"./jsonUtils-57bc7364.js";import{m as os,b as gt}from"./Query-a9897e6e.js";import{s as _t}from"./executeQueryJSON-9b41cacb.js";import"./featureConversionUtils-d60f35b9.js";import"./normalizeUtils-1070937a.js";import"./pbf-35a70a69.js";import"./FeatureSet-3f378b6d.js";import Pt from"./RelationshipQuery-69f7bad3.js";import"./TopFeaturesQuery-e41629f5.js";import rs from"./FeatureLayer-2f61e2e0.js";import"./featureFlags-8316ab84.js";import"./parser-b2de9c30.js";import"./ItemCache-f24398e0.js";import"./MemCache-782b477a.js";import"./UniqueValueRenderer-d96bd559.js";import"./LegendOptions-1287e8f6.js";import"./diffUtils-39c4addc.js";import"./SizeVariable-8d9a35e0.js";import"./colorRamps-51949912.js";import"./sizeVariableUtils-d4870b0d.js";import"./lengthUtils-f797b468.js";import"./jsonUtils-10e33437.js";import"./styleUtils-7224a88d.js";import"./DictionaryLoader-3df509a7.js";import"./LRUCache-879d162d.js";import"./FieldsIndex-dd7ebb88.js";import"./heatmapUtils-504dcdfd.js";import"./vec4f64-aa64c7e9.js";import"./Field-33980454.js";import"./fieldType-81268207.js";import"./query-31751284.js";import"./pbfQueryUtils-141b125a.js";import"./OptimizedGeometry-33b2eb0d.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./queryZScale-824fc224.js";import"./normalizeUtilsCommon-385dee75.js";import"./MultiOriginJSONSupport-1e25fea4.js";import"./sql-b41dbce4.js";import"./FeatureLayerBase-950d5bd1.js";import"./commonProperties-4b011f7f.js";import"./ElevationInfo-7a165961.js";import"./serviceCapabilitiesUtils-4610e307.js";import"./editsZScale-84ad3f9a.js";import"./APIKeyMixin-f386eb70.js";import"./ArcGISService-5b4b2430.js";import"./BlendLayer-cb6a7453.js";import"./jsonUtils-4a81df35.js";import"./CustomParametersMixin-8768a13f.js";import"./EditBusLayer-e25d47c9.js";import"./FeatureReductionLayer-f54ab365.js";import"./FeatureEffect-69caabe4.js";import"./clusterUtils-55de78c0.js";import"./labelingInfo-15c25517.js";import"./labelUtils-a3e7c4dd.js";import"./defaultsJSON-b087dd4d.js";import"./OperationalLayer-801a0f7c.js";import"./OrderedLayer-b471b54d.js";import"./PortalLayer-c1506571.js";import"./portalItemUtils-8d4c2c9b.js";import"./RefreshableLayer-2dd2ccaf.js";import"./ScaleRangeLayer-24dee353.js";import"./TemporalLayer-98e8530b.js";import"./FeatureTemplate-967978d9.js";import"./FeatureType-8ed1bc47.js";import"./fieldProperties-d6e5fb53.js";import"./versionUtils-b6f09ff6.js";import"./styleUtils-73b036e4.js";import"./popupUtils-a64a4c8d.js";const ni=["B","kB","MB","GB","TB"];function as(t,e){let i=e===0?0:Math.floor(Math.log(e)/Math.log(ti.KILOBYTES));i=Ri(i,0,ni.length-1);const n=Nt(e/ti.KILOBYTES**i,{maximumFractionDigits:2});return Ve(t.units.bytes[ni[i]],{fileSize:n})}const ls="esri.widgets.Feature.support.featureUtils",si=G.getLogger(ls),ds=/href=(""|'')/gi,cs=/(\{([^\{\r\n]+)\})/g,us=/\'/g,ji=/^\s*expression\//i,hs=/(\n)/gi,ps=/[\u00A0-\u9999<>\&]/gim,fs=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,ms=/^(?:mailto:|tel:)/,Hi="relationships/",Rt=Vi("short-date-short-time");function Qi(t){if(t!=null)return t.get("sourceLayer")||t.get("layer")}async function rt(t,e){return typeof t=="function"?t.call(null,e):t}function Gi(t=""){if(t)return!ms.test(t.trim().toLowerCase())}function qt(t){return!!t&&ji.test(t)}function gs(t,e){if(!qt(e)||!t)return null;const i=e.replace(ji,"").toLowerCase();let n=null;return t.some(s=>s.name.toLowerCase()===i&&(n=s,!0)),n}function Ki(t,e){const i=gs(e,t==null?void 0:t.fieldName);return i?i.title||null:t?t.label||t.fieldName:null}function _s(t,e){const i=e.get(t.toLowerCase());return`{${i&&i.fieldName||t}}`}function ys(t){return t.replace(ds,"")}function He(t,e){const i=zt(e,t);return i?i.name:t}function vs(t,e){return t&&t.map(i=>He(i,e))}function zt(t,e){return t&&typeof t.getField=="function"&&e?t.getField(e)??null:null}function Yi(t){return`${t}`.trim()}function ve({attributes:t,globalAttributes:e,layer:i,text:n,expressionAttributes:s,fieldInfoMap:o}){return n?Ot({formattedAttributes:e,template:Is(n,{...e,...s,...t},i),fieldInfoMap:o}):""}function Ot({formattedAttributes:t,template:e,fieldInfoMap:i}){return Yi(ys(Ve(Ve(e,n=>_s(n,i)),t)))}function bs(t,e,i=!1){const n=e[t];if(typeof n=="string"){const s="%27",o=(i?encodeURIComponent(n):n).replace(us,s);e[t]=o}}function ws(t,e=!1){const i={...t};return Object.keys(i).forEach(n=>bs(n,i,e)),i}function Ms(t,e,i){const n=(e=Yi(e))&&e[0]!=="{";return Ve(t,ws(i,n||!1))}function Vt(t,e){return t.replace(cs,(i,n,s)=>{const o=zt(e,s);return o?`{${o.name}}`:n})}function Is(t,e,i){const n=Vt(t,i);return n&&n.replace(fs,(s,o,r)=>Ms(s,o||r,e))}function Fs(t,e){if(typeof t=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const i=Number(t);if(!isNaN(i))return i}return t}function Cs(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function oi(t){return t!=null&&typeof t=="object"&&"layer"in t&&!!t.layer}function As(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="map-image"}function $s(t){return t!=null&&typeof t=="object"&&"fieldsIndex"in t&&"geometryType"in t&&"getField"in t&&"load"in t&&"loaded"in t&&"objectIdField"in t&&"spatialReference"in t&&"type"in t&&t.type==="feature"&&"when"in t}function Es(t){return t!=null&&typeof t=="object"&&"createQuery"in t&&"queryFeatureCount"in t&&"queryObjectIds"in t&&"queryRelatedFeatures"in t&&"queryRelatedFeaturesCount"in t&&"relationships"in t}function Xi(t){return $s(t)&&Es(t)}function xs(t,e){const i=e.fieldInfos,n=e.fieldName,s=Ji(i,n),o=s==null?void 0:s.clone(),r=e.preventPlacesFormatting,l=e.layer,c=zt(l,n);if(o&&(c==null?void 0:c.type)==="date"){const p=o.format||new wn;p.dateFormat=p.dateFormat||"short-date-short-time",p.dateTimeFormatOptions=!oi(l)&&Cs(l)&&l.datesInUnknownTimezone||oi(l)&&As(l.layer)&&l.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,o.format=p}const h=o&&o.format;return typeof t=="string"&&Mn(n)&&h?h.formatRasterPixelValue(t):typeof(t=Fs(t,h))=="string"||t==null||h==null?Ke(t):r?Nt(t,{...In(h),minimumFractionDigits:0,maximumFractionDigits:20}):h.format(t)}function Ji(t,e){if(!t||!t.length||!e)return;const i=e.toLowerCase();let n;return t.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(n=s,!0)),n}function Ts({fieldName:t,graphic:e,layer:i}){if(re(t)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:n}=i;if(!n||t!==n)return null;const s=i.getFeatureType(e);return s?s.name:null}function ks({fieldName:t,value:e,graphic:i,layer:n}){if(re(t)||!n||typeof n.getFieldDomain!="function")return null;const s=i&&n.getFieldDomain(t,{feature:i});return s&&s.type==="coded-value"?s.getName(e):null}function Ls(t,e){const{creatorField:i,creationDateField:n,editorField:s,editDateField:o}=t;if(!e)return;const r=e[o];if(typeof r=="number"){const c=e[s];return{type:"edit",date:nt(r,Rt),user:c}}const l=e[n];if(typeof l=="number"){const c=e[i];return{type:"create",date:nt(l,Rt),user:c}}return null}function Ps(t,e){const i=new Map;return t&&t.forEach(n=>{const s=He(n.fieldName,e);n.fieldName=s,i.set(s.toLowerCase(),n)}),i}function ri(t){const e=[];if(!t)return e;const{fieldInfos:i,content:n}=t;return i&&e.push(...i),n&&Array.isArray(n)&&n.forEach(s=>{if(s.type==="fields"){const o=s&&s.fieldInfos;o&&e.push(...o)}}),e}function Wt(t){return t.replace(ps,e=>`&#${e.charCodeAt(0)};`)}function Ke(t){return typeof t=="string"?t.replace(hs,'<br class="esri-text-new-line" />'):t}function Zi(t){const{value:e,fieldName:i,fieldInfos:n,fieldInfoMap:s,layer:o,graphic:r}=t;if(e==null)return"";const l=ks({fieldName:i,value:e,graphic:r,layer:o});if(l)return l;const c=Ts({fieldName:i,graphic:r,layer:o});if(c)return c;if(s.get(i.toLowerCase()))return xs(e,{fieldInfos:n||Array.from(s.values()),fieldName:i,layer:o});const h=o&&o.fieldsIndex;return h&&h.isDateField(i)?nt(e,Rt):Ke(e)}function yt({fieldInfos:t,attributes:e,layer:i,graphic:n,fieldInfoMap:s,relatedInfos:o}){const r={};return o==null||o.forEach(l=>Ds({attributes:r,relatedInfo:l,fieldInfoMap:s,fieldInfos:t,layer:i})),e&&Object.keys(e).forEach(l=>{const c=e[l];r[l]=Zi({fieldName:l,fieldInfos:t,fieldInfoMap:s,layer:i,value:c,graphic:n})}),r}async function en(t,e){var p,m;const{layer:i,graphic:n,outFields:s,objectIds:o,returnGeometry:r,spatialReference:l}=t,c=o[0];if(typeof c!="number"&&typeof c!="string"){const _="Could not query required fields for the specified feature. The feature's ID is invalid.",y={layer:i,graphic:n,objectId:c,requiredFields:s};return si.warn(_,y),null}if(!((m=(p=vn(i))==null?void 0:p.operations)!=null&&m.supportsQuery)){const _="The specified layer cannot be queried. The following fields will not be available.",y={layer:i,graphic:n,requiredFields:s,returnGeometry:r};return si.warn(_,y),null}const h=i.createQuery();return h.objectIds=o,h.outFields=s!=null&&s.length?s:[i.objectIdField],h.returnGeometry=!!r,h.returnZ=!!r,h.returnM=!!r,h.outSpatialReference=l,(await i.queryFeatures(h,e)).features[0]}async function Rs(t){var n;if(!((n=t.expressionInfos)!=null&&n.length))return!1;const e=await Oi(),{arcadeUtils:{hasGeometryFunctions:i}}=e;return i(t)}async function Os({graphic:t,popupTemplate:e,layer:i,spatialReference:n},s){if(!i||!e||(typeof i.load=="function"&&await i.load(s),!t.attributes))return;const o=t.attributes[i.objectIdField];if(o==null)return;const r=[o],l=await e.getRequiredFields(i.fieldsIndex),c=bn(l,t),h=c?[]:l,p=e.returnGeometry||await Rs(e);if(c&&!p)return;const m=await en({layer:i,graphic:t,outFields:h,objectIds:r,returnGeometry:p,spatialReference:n},s);m&&(m.geometry&&(t.geometry=m.geometry),m.attributes&&(t.attributes={...t.attributes,...m.attributes}))}function re(t=""){return!!t&&t.includes(Hi)}function Vs(t){return t?`${Hi}${t.layerId}/${t.fieldName}`:""}function ai({attributes:t,graphic:e,relatedInfo:i,fieldInfos:n,fieldInfoMap:s,layer:o}){t&&e&&i&&Object.keys(e.attributes).forEach(r=>{const l=Vs({layerId:i.relation.id.toString(),fieldName:r}),c=e.attributes[r];t[l]=Zi({fieldName:l,fieldInfos:n,fieldInfoMap:s,layer:o,value:c,graphic:e})})}function Ds({attributes:t,relatedInfo:e,fieldInfoMap:i,fieldInfos:n,layer:s}){t&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach(o=>ai({attributes:t,graphic:o,relatedInfo:e,fieldInfoMap:i,fieldInfos:n,layer:s})),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach(o=>ai({attributes:t,graphic:o,relatedInfo:e,fieldInfoMap:i,fieldInfos:n,layer:s})))}const li=t=>{if(!t)return!1;const e=t.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},tn=({layer:t,method:e,query:i,definitionExpression:n})=>{var r,l;if(!((l=(r=t.capabilities)==null?void 0:r.query)!=null&&l.supportsCacheHint)||e==="attachments")return;const s=i.where!=null?i.where:null,o=i.geometry!=null?i.geometry:null;li(n)||li(s)||(o==null?void 0:o.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},Ns=({query:t,layer:e,method:i})=>{tn({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})},Ss=({queryPayload:t,layer:e,method:i})=>{tn({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})};function Bs(t,e,i){return t&&e&&i?di(t.allLayers,e,i)||di(t.allTables,e,i):null}function di(t,e,i){return t.filter(Xi).find(n=>n!==e&&n.url===e.url&&n.layerId===i.relatedTableId)}const ci={editing:!1,operations:{add:!0,update:!0,delete:!0}},nn=he.ofType(Zn);let z=class extends Ce{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...ci},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new nn,this.fileInfos=new he,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(M(()=>this.graphic,()=>this._graphicChanged(),D))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...ci,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const i=e.layer||e.sourceLayer;return(i==null?void 0:i.loaded)&&"capabilities"in i&&i.capabilities&&"operations"in i.capabilities&&"supportsResizeAttachments"in i.capabilities.operations&&i.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:i}=this;if(!e||typeof e.queryAttachments!="function")throw new E("invalid-layer","getAttachments(): A valid layer is required.");const n=this._getObjectId(),s=new ii({objectIds:[n],returnMetadata:!0}),o=[],r=e.queryAttachments(s).then(c=>c[n]||o).catch(()=>o);this._getAttachmentsPromise=r,this.notifyChange("state");const l=await r;return i.removeAll(),l.length&&i.addMany(l),this._getAttachmentsPromise=null,this.notifyChange("state"),l}async addAttachment(e,i=this.graphic){var c;const{_attachmentLayer:n,attachmentInfos:s,abilities:o}=this;if(!i)throw new E("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});if(!e)throw new E("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((c=o.operations)!=null&&c.add))throw new E("invalid-abilities","addAttachment(): add abilities are required.");if(!n||typeof n.addAttachment!="function")throw new E("invalid-layer","addAttachment(): A valid layer is required.");const r=n.addAttachment(i,e).then(h=>this._queryAttachment(h.objectId,i)),l=await r;return s.add(l),l}async deleteAttachment(e){var c;const{_attachmentLayer:i,attachmentInfos:n,graphic:s,abilities:o}=this;if(!e)throw new E("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((c=o.operations)!=null&&c.delete))throw new E("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!i||typeof i.deleteAttachments!="function")throw new E("invalid-layer","deleteAttachment(): A valid layer is required.");if(!s)throw new E("invalid-graphic","deleteAttachment(): A graphic is required.");const r=i.deleteAttachments(s,[e.id]).then(()=>e),l=await r;return n.remove(l),l}async updateAttachment(e,i=this.activeAttachmentInfo){var p;const{_attachmentLayer:n,attachmentInfos:s,graphic:o,abilities:r}=this;if(!e)throw new E("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!i)throw new E("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(!((p=r.operations)!=null&&p.update))throw new E("invalid-abilities","updateAttachment(): Update abilities are required.");const l=s.findIndex(m=>m===i);if(!n||typeof n.updateAttachment!="function")throw new E("invalid-layer","updateAttachment(): A valid layer is required.");if(!o)throw new E("invalid-graphic","updateAttachment(): A graphic is required.");const c=n.updateAttachment(o,i.id,e).then(m=>this._queryAttachment(m.objectId)),h=await c;return s.splice(l,1,h),h}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,i){if(!e||!i)return null;const n={file:e,form:i};return this.fileInfos.add(n),n}updateFile(e,i,n=this.activeFileInfo){if(!e||!i||!n)return null;const s=this.fileInfos.findIndex(o=>n===o);return s>-1&&this.fileInfos.splice(s,1,{file:e,form:i}),this.fileInfos.items[s]}deleteFile(e){const i=this.fileInfos.find(n=>n.file===e);return i?(this.fileInfos.remove(i),i):null}async _queryAttachment(e,i){const{_attachmentLayer:n}=this;if(!e||!(n!=null&&n.queryAttachments))throw new E("invalid-attachment-id","Could not query attachment.");const s=this._getObjectId(i),o=new ii({objectIds:[s],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return n.queryAttachments(o).then(r=>r[s][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,i=Qi(e);this._attachmentLayer=i?i.type==="scene"&&i.associatedLayer!=null?i.associatedLayer:i:null}};a([d()],z.prototype,"abilities",void 0),a([Fe("abilities")],z.prototype,"castAbilities",null),a([d()],z.prototype,"activeAttachmentInfo",void 0),a([d()],z.prototype,"activeFileInfo",void 0),a([d({readOnly:!0,type:nn})],z.prototype,"attachmentInfos",void 0),a([d()],z.prototype,"fileInfos",void 0),a([d({type:De})],z.prototype,"graphic",void 0),a([d()],z.prototype,"mode",void 0),a([d({readOnly:!0})],z.prototype,"state",null),a([d()],z.prototype,"filesEnabled",void 0),a([d({readOnly:!0})],z.prototype,"supportsResizeAttachments",null),z=a([L("esri.widgets.Attachments.AttachmentsViewModel")],z);const Ut=z;function ui(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function qs(t){const e=Fn("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}const hi={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},$="esri-attachments",fe="esri-button",g={base:$,loaderContainer:`${$}__loader-container`,loader:`${$}__loader`,fadeIn:`${$}--fade-in`,container:`${$}__container`,containerList:`${$}__container--list`,containerPreview:`${$}__container--preview`,actions:`${$}__actions`,deleteButton:`${$}__delete-button`,addAttachmentButton:`${$}__add-attachment-button`,errorMessage:`${$}__error-message`,items:`${$}__items`,item:`${$}__item`,itemButton:`${$}__item-button`,itemMask:`${$}__item-mask`,itemMaskIcon:`${$}__item-mask--icon`,itemImage:`${$}__image`,itemImageResizable:`${$}__image--resizable`,itemLabel:`${$}__label`,itemFilename:`${$}__filename`,itemChevronIcon:`${$}__item-chevron-icon`,itemLink:`${$}__item-link`,itemLinkOverlay:`${$}__item-link-overlay`,itemLinkOverlayIcon:`${$}__item-link-overlay-icon`,itemEditIcon:`${$}__item-edit-icon`,itemAddIcon:`${$}__item-add-icon`,itemAddButton:`${$}__item-add-button`,formNode:`${$}__form-node`,fileFieldset:`${$}__file-fieldset`,fileLabel:`${$}__file-label`,fileName:`${$}__file-name`,fileInput:`${$}__file-input`,metadata:`${$}__metadata`,metadataFieldset:`${$}__metadata-fieldset`,progressBar:`${$}__progress-bar`,esriWidget:"esri-widget",esriButton:fe,buttonDisabled:`${fe}--disabled`,esriButtonSecondary:`${fe}--secondary`,esriButtonTertiary:`${fe}--tertiary`,esriButtonThird:`${fe}--third`,esriButtonSmall:`${fe}--small`,esriButtonHalf:`${fe}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},vt=window.CSS;let B=class extends Z{constructor(e,i){super(e,i),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...hi},this._supportsImageOrientation=vt&&vt.supports&&vt.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new Ut),this.addHandles([pe(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),pe(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),M(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),D)])}loadDependencies(){return Qe({icon:()=>w(()=>import("./calcite-icon-5e4985c8.js"),["assets/calcite-icon-5e4985c8.js","assets/icon-f89dba00.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/observers-962e5802.js"])})}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...hi,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.addAttachment(e).then(n=>(this._set("submitting",!1),this._set("error",null),i.mode="view",n)).catch(n=>{throw this._set("submitting",!1),this._set("error",new E("attachments:add-attachment",this.messages.addErrorMessage,n)),n})}deleteAttachment(e){const{viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.deleteAttachment(e).then(n=>(this._set("submitting",!1),this._set("error",null),i.mode="view",n)).catch(n=>{throw this._set("submitting",!1),this._set("error",new E("attachments:delete-attachment",this.messages.deleteErrorMessage,n)),n})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:i}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(i).then(n=>(this._set("submitting",!1),this._set("error",null),e.mode="view",n)).catch(n=>{throw this._set("submitting",!1),this._set("error",new E("attachments:update-attachment",this.messages.updateErrorMessage,n)),n})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,i=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",i}deleteFile(e){var n;const i=this.viewModel.deleteFile(e||((n=this.viewModel.activeFileInfo)==null?void 0:n.file));return this.viewModel.mode="view",i}render(){const{submitting:e,viewModel:i}=this,{state:n}=i;return u("div",{class:this.classes(g.base,g.esriWidget)},e?this.renderProgressBar():null,n==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:i}=this;return e&&i.errorMessage?u("div",{key:"error-message",class:g.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:i,activeAttachmentInfo:n}=this.viewModel;return i==="add"?this.renderAddForm():i==="edit"?this.renderDetailsForm(n||e):this.renderAttachmentContainer()}renderLoading(){return u("div",{class:g.loaderContainer,key:"loader"},u("div",{class:g.loader}))}renderProgressBar(){return this.visibleElements.progressBar?u("div",{class:g.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:i}=this,n=e||!i,s=this.visibleElements.cancelAddButton?u("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(g.esriButton,g.esriButtonTertiary,g.esriButtonSmall,g.esriButtonHalf,e&&g.buttonDisabled)},this.messages.cancel):null,o=this.visibleElements.addSubmitButton?u("button",{type:"submit",disabled:n,class:this.classes(g.esriButton,g.esriButtonSecondary,g.esriButtonSmall,g.esriButtonHalf,{[g.buttonDisabled]:n})},this.messages.add):null,r=i?u("span",{key:"file-name",class:g.fileName},i.name):null,l=u("form",{bind:this,afterCreate:st,afterRemoved:Jt,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},u("fieldset",{class:g.fileFieldset},r,u("label",{class:this.classes(g.fileLabel,g.esriButton,g.esriButtonSecondary)},i?this.messages.changeFile:this.messages.selectFile,u("input",{class:g.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),o,s);return u("div",{key:"add-form-container",class:g.formNode},l)}renderDetailsForm(e){var Ae,$e,le;const{visibleElements:i,viewModel:n,selectedFile:s,submitting:o}=this,{abilities:r}=n,l=o||!s;let c,h,p,m;s?(c=s.type,h=s.name,p=s.size):e&&"file"in e?(c=e.file.type,h=e.file.name,p=e.file.size):e&&"contentType"in e&&(c=e.contentType,h=e.name,p=e.size,m=e.url);const _=r.editing&&((Ae=r.operations)!=null&&Ae.delete)&&i.deleteButton?u("button",{key:"delete-button",type:"button",disabled:o,bind:this,onclick:S=>this._submitDeleteAttachment(S,e),class:this.classes(g.esriButton,g.esriButtonSmall,g.esriButtonTertiary,g.deleteButton,{[g.buttonDisabled]:o})},this.messages.delete):void 0,y=r.editing&&(($e=r.operations)!=null&&$e.update)&&i.updateButton?u("button",{disabled:l,key:"update-button",type:"submit",class:this.classes(g.esriButton,g.esriButtonSmall,g.esriButtonThird,{[g.buttonDisabled]:l})},this.messages.update):void 0,I=this.visibleElements.cancelUpdateButton?u("button",{disabled:o,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(g.esriButton,g.esriButtonSmall,g.esriButtonTertiary,g.esriButtonThird,{[g.buttonDisabled]:o})},this.messages.cancel):void 0,C=r.editing&&((le=r.operations)!=null&&le.update)?u("fieldset",{key:"file",class:g.fileFieldset},u("span",{key:"file-name",class:g.fileName},h),u("label",{class:this.classes(g.fileLabel,g.esriButton,g.esriButtonSecondary)},this.messages.changeFile,u("input",{class:g.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,F=u("fieldset",{key:"size",class:g.metadataFieldset},u("label",null,as(this.messagesUnits,p??0))),P=u("fieldset",{key:"content-type",class:g.metadataFieldset},u("label",null,c)),Q=m!=null?u("a",{class:g.itemLink,href:m,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),u("div",{class:g.itemLinkOverlay},u("span",{class:g.itemLinkOverlayIcon},u("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),ae=u("form",{bind:this,afterCreate:st,afterRemoved:Jt,"data-node-ref":"_updateAttachmentForm",onsubmit:S=>this._submitUpdateAttachment(S,e)},u("div",{class:g.metadata},F,P),C,u("div",{class:g.actions},_,I,y));return u("div",{key:"edit-form-container",class:g.formNode},Q,ae)}renderImageMask(e,i){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,i):null}renderGenericImageMask(e,i){const{supportsResizeAttachments:n}=this.viewModel,s=qs(i),o={[g.itemImageResizable]:n};return u("div",{class:this.classes(g.itemMaskIcon,g.itemMask)},u("img",{title:e,alt:e,src:s,class:this.classes(o,g.itemImage)}))}renderImageMaskForAttachment(e,i){const{supportsResizeAttachments:n}=this.viewModel;if(!e)return null;const{contentType:s,name:o,url:r}=e;if(!n||!ui(s))return this.renderGenericImageMask(o,s);const l=this._getCSSTransform(e),c=l?{transform:l,"image-orientation":"none"}:{},h=`${r}${r!=null&&r.includes("?")?"&":"?"}w=${i}`,p={[g.itemImageResizable]:n};return u("div",{class:this.classes(g.itemMask)},u("img",{styles:c,alt:o,title:o,src:h,class:this.classes(p,g.itemImage)}))}renderFile(e){const{file:i}=e;return u("li",{class:g.item,key:i},u("button",{key:"details-button",bind:this,class:g.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),u("label",{class:g.itemLabel},u("span",{class:g.itemFilename},i.name||this.messages.noTitle),u("span",{"aria-hidden":"true",class:this.classes(g.itemChevronIcon,oe(this.container)?g.iconLeft:g.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:i}){const{viewModel:n,effectiveDisplayType:s}=this,{abilities:o,supportsResizeAttachments:r}=n,{contentType:l,name:c,url:h}=e,p=this.renderImageMask(e,i==="list"?48:400),m=o.editing?u("span",{"aria-hidden":"true",class:this.classes(g.itemChevronIcon,oe(this.container)?g.iconLeft:g.iconRight)}):null,_=[p,s==="preview"&&r&&ui(l)?null:u("label",{class:g.itemLabel},u("span",{class:g.itemFilename},c||this.messages.noTitle),m)],y=o.editing?u("button",{key:"details-button",bind:this,class:g.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},_):u("a",{key:"details-link",class:g.itemButton,href:h??void 0,target:"_blank"},_);return u("li",{class:g.item,key:e},y)}renderAttachmentContainer(){var I;const{effectiveDisplayType:e,viewModel:i,visibleElements:n}=this,{attachmentInfos:s,abilities:o,fileInfos:r}=i,l=!!(s!=null&&s.length),c=!!(r!=null&&r.length),h={[g.containerList]:e!=="preview",[g.containerPreview]:e==="preview"},p=o.editing&&((I=o.operations)!=null&&I.add)&&n.addButton?u("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(g.esriButton,g.esriButtonTertiary,g.addAttachmentButton),type:"button"},u("span",{"aria-hidden":"true",class:this.classes(g.itemAddIcon,g.iconPlus)}),this.messages.add):void 0,m=l?u("ul",{key:"attachments-list",class:g.items},s.toArray().map(C=>this.renderAttachmentInfo({attachmentInfo:C,displayType:e}))):void 0,_=c?u("ul",{key:"file-list",class:g.items},r.toArray().map(C=>this.renderFile(C))):void 0,y=c||l?void 0:u("div",{class:g.empty},this.messages.noAttachments);return u("div",{key:"attachments-container",class:this.classes(g.container,h)},m,_,y,p)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const i=e.target,n=i&&i.files&&i.files.item(0);this._set("selectedFile",n)}_submitDeleteAttachment(e,i){e.preventDefault(),i&&("file"in i?this.deleteFile(i.file):i&&this.deleteAttachment(i))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,i){e.preventDefault(),i&&"file"in i?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:i}=this;i.activeFileInfo=null,i.activeAttachmentInfo=e,i.mode="edit"}_startEditFile(e){const{viewModel:i}=this;i.activeAttachmentInfo=null,i.activeFileInfo=e,i.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};a([d()],B.prototype,"abilities",null),a([d()],B.prototype,"displayType",void 0),a([d({readOnly:!0})],B.prototype,"effectiveDisplayType",null),a([d()],B.prototype,"graphic",null),a([d()],B.prototype,"label",null),a([d(),K("esri/widgets/Attachments/t9n/Attachments")],B.prototype,"messages",void 0),a([d(),K("esri/core/t9n/Units")],B.prototype,"messagesUnits",void 0),a([d({readOnly:!0})],B.prototype,"selectedFile",void 0),a([d({readOnly:!0})],B.prototype,"submitting",void 0),a([d({readOnly:!0})],B.prototype,"error",void 0),a([d({type:Ut})],B.prototype,"viewModel",void 0),a([d()],B.prototype,"visibleElements",void 0),a([Fe("visibleElements")],B.prototype,"castVisibleElements",null),B=a([L("esri.widgets.Attachments")],B);const zs=B;let ze=class extends Ut{constructor(e){super(e),this.description=null,this.title=null}};a([d()],ze.prototype,"description",void 0),a([d()],ze.prototype,"title",void 0),ze=a([L("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],ze);const jt=ze,Ws={heading:"esri-widget__heading"};function Ht({level:t,class:e,...i},n){const s=Us(t);return u(`h${s}`,{...i,class:Cn(Ws.heading,e),role:"heading","aria-level":String(s)},n)}function Us(t){return Ri(Math.ceil(t),1,6)}const bt="esri-feature-element-info",wt={base:bt,title:`${bt}__title`,description:`${bt}__description`};let ke=class extends Z{constructor(e,i){super(e,i),this.description=null,this.headingLevel=2,this.title=null}render(){return u("div",{class:wt.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?u(Ht,{level:this.headingLevel,class:wt.title},e):null}renderDescription(){const{description:e}=this;return e?u("div",{key:"description",class:wt.description},e):null}};a([d()],ke.prototype,"description",void 0),a([d()],ke.prototype,"headingLevel",void 0),a([d()],ke.prototype,"title",void 0),ke=a([L("esri.widgets.Feature.support.FeatureElementInfo")],ke);const ct=ke,js={base:"esri-feature-attachments"};let ee=class extends Z{constructor(e,i){super(e,i),this._featureElementInfo=null,this.attachmentsWidget=new zs,this.headingLevel=2,this.viewModel=new jt}initialize(){this._featureElementInfo=new ct,this.addHandles([M(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),D),M(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,D)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var i;const{attachmentsWidget:e}=this;return u("div",{class:js.base},(i=this._featureElementInfo)==null?void 0:i.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var s;const{description:e,title:i,headingLevel:n}=this;(s=this._featureElementInfo)==null||s.set({description:e,title:i,headingLevel:n})}};a([d({readOnly:!0})],ee.prototype,"attachmentsWidget",void 0),a([d()],ee.prototype,"description",null),a([d()],ee.prototype,"displayType",null),a([d()],ee.prototype,"graphic",null),a([d()],ee.prototype,"headingLevel",void 0),a([d()],ee.prototype,"title",null),a([d({type:jt})],ee.prototype,"viewModel",void 0),ee=a([L("esri.widgets.Feature.FeatureAttachments")],ee);const Hs=ee;let ue=class extends St(Ce){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(M(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},D))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:i,destroyer:n}=this;e&&i&&(rt(n,{graphic:i}).catch(()=>null),this._set("created",null))}async _createContent(e){const i=this.graphic;if(!i||!e)return;const n=rt(e,{graphic:i}).catch(()=>null);this._loadingPromise=n,this.notifyChange("state");const s=await n;n===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};a([d({readOnly:!0})],ue.prototype,"created",void 0),a([d()],ue.prototype,"creator",void 0),a([d()],ue.prototype,"destroyer",void 0),a([d({type:De})],ue.prototype,"graphic",void 0),a([d({readOnly:!0})],ue.prototype,"state",null),ue=a([L("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],ue);const at=ue,Mt="esri-feature-content",It={base:Mt,loaderContainer:`${Mt}__loader-container`,loader:`${Mt}__loader`};let Le=class extends Z{constructor(e,i){super(e,i),this.viewModel=null,this._addTargetToAnchors=n=>{Array.from(n.querySelectorAll("a")).forEach(s=>{Gi(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return u("div",{class:It.loaderContainer,key:"loader"},u("div",{class:It.loader}))}renderCreated(){var i;const e=(i=this.viewModel)==null?void 0:i.created;return e?e instanceof HTMLElement?u("div",{key:e,bind:e,afterCreate:this._attachToNode}):Ui(e)?u("div",{key:e},!e.destroyed&&e.render()):u("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state;return u("div",{class:It.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const i=this;e.appendChild(i)}};a([d()],Le.prototype,"creator",null),a([d()],Le.prototype,"graphic",null),a([d({type:at})],Le.prototype,"viewModel",void 0),Le=a([L("esri.widgets.Feature.FeatureContent")],Le);const Je=Le;let se=class extends Ce{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:i}=this,n=[];return i==null||i.forEach(s=>{if(!(!s.hasOwnProperty("visible")||s.visible))return;const o=s.clone();o.label=Ki(o,e),n.push(o)}),n}};a([d()],se.prototype,"attributes",void 0),a([d({type:[An]})],se.prototype,"expressionInfos",void 0),a([d()],se.prototype,"description",void 0),a([d({type:[Di]})],se.prototype,"fieldInfos",void 0),a([d({readOnly:!0})],se.prototype,"formattedFieldInfos",null),a([d()],se.prototype,"title",void 0),se=a([L("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],se);const ut=se,Qs=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Gs(t){let e=null;return Qs.some(i=>(i.pattern.test(t)&&(e=i),!!e)),e}function Ks(t,e){if(typeof e!="string"||!e)return e;const i=Gs(e);if(!i)return e;const n=e.match(i.pattern),s=n&&n[2],o=Ve(Ve(i.label,{messages:t,hierPart:s}),{appName:i.appName}),r=i.target?` target="${i.target}"`:"",l=i.target==="_blank"?' rel="noreferrer"':"";return e.replace(i.pattern,`<a${r} href="$1"${l}>${o}</a>`)}const Ye="esri-feature-fields",Ne={base:Ye,fieldHeader:`${Ye}__field-header`,fieldData:`${Ye}__field-data`,fieldDataDate:`${Ye}__field-data--date`,esriTable:"esri-widget__table"};let X=class extends Z{constructor(e,i){super(e,i),this._featureElementInfo=null,this.viewModel=new ut,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new ct,this.addHandles(M(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),D))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,i){const{attributes:n}=this.viewModel,s=e.fieldName,o=e.label||s,r=n?n[s]==null?"":n[s]:"",l=!(!e.format||!e.format.dateFormat),c=typeof r=="number"&&!l?this._forceLTR(r):Ks(this.messagesURIUtils,r),h={[Ne.fieldDataDate]:l};return u("tr",{key:`fields-element-info-row-${s}-${i}`},u("th",{key:`fields-element-info-row-header-${s}-${i}`,class:Ne.fieldHeader,innerHTML:o}),u("td",{key:`fields-element-info-row-data-${s}-${i}`,class:this.classes(Ne.fieldData,h),innerHTML:c}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?u("table",{class:Ne.esriTable,summary:this.messages.fieldsSummary},u("tbody",null,e.map((i,n)=>this.renderFieldInfo(i,n)))):null}render(){var e;return u("div",{class:Ne.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var n;const{description:e,title:i}=this;(n=this._featureElementInfo)==null||n.set({description:e,title:i})}_forceLTR(e){return`&lrm;${e}`}};a([d()],X.prototype,"attributes",null),a([d()],X.prototype,"description",null),a([d()],X.prototype,"expressionInfos",null),a([d()],X.prototype,"fieldInfos",null),a([d()],X.prototype,"title",null),a([d({type:ut,nonNullable:!0})],X.prototype,"viewModel",void 0),a([d(),K("esri/widgets/Feature/t9n/Feature")],X.prototype,"messages",void 0),a([d(),K("esri/widgets/support/t9n/uriUtils")],X.prototype,"messagesURIUtils",void 0),X=a([L("esri.widgets.Feature.FeatureFields")],X);const sn=X,Ys={maximumFractionDigits:20};function Xs(t){return Nt(t,Ys)}const Js="<",Zs=">",eo=Vi("short-date");function to(t,e,i,n){let s="";e===0?s=`${Js} `:e===i&&(s=`${Zs} `);let o=null;return o=n?nt(t,eo):Xs(t),s+o}const io=new Ni([64,64,64]);function no(t,e){const i=[],n=t.length-1;return t.length===5?i.push(0,2,4):i.push(0,n),t.map((s,o)=>i.includes(o)?to(s,o,n,e):null)}async function so(t,e,i){let n=!1,s=[],o=[];if(t.stops){const h=t.stops;s=h.map(p=>p.value),n=h.some(p=>!!p.label),n&&(o=h.map(p=>p.label))}const r=s[0],l=s[s.length-1];if(r==null&&l==null)return null;const c=n?null:no(s,i??!1);return(await Promise.all(s.map(async(h,p)=>({value:h,color:t.type==="opacity"?await oo(h,t,e):(await w(()=>import("./SizeVariable-8d9a35e0.js").then(m=>m.v),["assets/SizeVariable-8d9a35e0.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/colorRamps-51949912.js","assets/LegendOptions-1287e8f6.js","assets/sizeVariableUtils-d4870b0d.js","assets/lengthUtils-f797b468.js"])).getColor(t,h),label:n?o[p]:(c==null?void 0:c[p])??""})))).reverse()}async function oo(t,e,i){const n=new Ni(i??io),s=(await w(()=>import("./SizeVariable-8d9a35e0.js").then(o=>o.v),["assets/SizeVariable-8d9a35e0.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/colorRamps-51949912.js","assets/LegendOptions-1287e8f6.js","assets/sizeVariableUtils-d4870b0d.js","assets/lengthUtils-f797b468.js"])).getOpacity(e,t);return s!=null&&(n.a=s),n}function ro(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(n=>{var s;return((s=n.color)==null?void 0:s.a)>0});let i=e.length-1;if(e&&e[0]){const n=e[i];n&&n.ratio!==1&&(e.push(new ss({ratio:1,color:n.color})),i++)}return e.map((n,s)=>{var r,l;let o="";return s===0?o=((r=t.legendOptions)==null?void 0:r.minLabel)||"low":s===i&&(o=((l=t.legendOptions)==null?void 0:l.maxLabel)||"high"),{color:n.color,label:o,ratio:n.ratio}}).reverse()}G.getLogger("esri.renderers.support.utils");async function U(t,e,i){En(t,e,()=>[]).push(...i)}async function ao(t){var i,n;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const s=t.visualVariables.filter(o=>o.type==="color");for(const o of s){const r=(await so(o)??[]).map(l=>l.color);await U(e,o.field||o.valueExpression,r)}}if(t.type==="heatmap"){const s=ro(t).map(o=>o.color);await U(e,t.field||t.valueExpression,s)}else if(t.type==="pie-chart"){for(const s of t.attributes)await U(e,s.field||s.valueExpression,[s.color]);await U(e,"default",[(i=t==null?void 0:t.othersCategory)==null?void 0:i.color,Ee(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const s of t.attributes)await U(e,s.field||s.valueExpression,[s.color]);await U(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((n=t.authoringInfo)==null?void 0:n.type)==="predominance")for(const s of t.uniqueValueInfos??[])await U(e,s.value.toString(),[Ee(s.symbol,null)]);else{const s=(t.uniqueValueInfos??[]).map(h=>Ee(h.symbol,null)),{field:o,field2:r,field3:l,valueExpression:c}=t;(o||c)&&await U(e,o||c,s),r&&await U(e,r,s),l&&await U(e,l,s)}else if(t.type==="class-breaks"){const s=t.classBreakInfos.map(l=>Ee(l.symbol,null)),{field:o,valueExpression:r}=t;await U(e,o??r,s)}else t.type==="simple"&&await U(e,"default",[Ee(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await U(e,"default",[Ee(t.defaultSymbol,null)]),e.forEach((s,o)=>{const r=$n(s.filter(Boolean),(l,c)=>JSON.stringify(l)===JSON.stringify(c));e.set(o,r)}),e}const lo="esri.widgets.Feature.support.relatedFeatureUtils",pi=G.getLogger(lo),fi=new Map;function Ze(t){if(!re(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}function co(t,e){if(!e.relationships)return null;let i=null;const{relationships:n}=e;return n.some(s=>s.id===parseInt(t,10)&&(i=s,!0)),i}function uo({originRelationship:t,relationships:e,layerId:i}){let n=null;return e&&e.some(s=>(`${s.relatedTableId}`===i&&s.id===(t==null?void 0:t.id)&&(n=s),!!n)),n}function ho(t,e){const i=e.toLowerCase();for(const n in t)if(n.toLowerCase()===i)return t[n];return null}function po(t,e){const i=co(t,e);if(i)return{url:`${e.url}/${i.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function fo(t,e){if(!e||!t)return;const{features:i,statsFeatures:n}=t,s=i&&i.value;e.relatedFeatures=s?s.features:[];const o=n&&n.value;e.relatedStatsFeatures=o?o.features:[]}function mo(t,e,i,n){var o;const s=new Pt;return s.outFields=["*"],s.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),s.objectIds=[t.attributes[i.objectIdField]],((o=i.queryRelatedFeatures)==null?void 0:o.call(i,s,n))??Promise.resolve({})}function go(t,e,i){let n=0;const s=[];for(;n<e.length;)s.push(`${t} IN (${e.slice(n,i+n)})`),n+=i;return s.join(" OR ")}async function _o(t,e,i,n){const s=i.layerId.toString(),{layerInfo:o,relation:r,relatedFields:l,outStatistics:c,url:h,sourceSpatialReference:p}=e;if(!o||!r)return null;const m=uo({originRelationship:r,relationships:o.relationships,layerId:s});if(m!=null&&m.relationshipTableId&&m.keyFieldInRelationshipTable){const y=(await mo(t,m,i,n))[t.attributes[i.objectIdField]];if(!y)return null;const I=y.features.map(C=>C.attributes[o.objectIdField]);if(c!=null&&c.length&&o.supportsStatistics){const C=new gt;C.where=go(o.objectIdField,I,1e3),C.outFields=l,C.outStatistics=c,C.sourceSpatialReference=p;const F={features:Promise.resolve(y),statsFeatures:_t(h,C)};return Me(F)}}const _=m==null?void 0:m.keyField;if(_){const y=Tn(Mo(o.fields,_)),I=ho(t.attributes,r.keyField),C=y?`${_}=${I}`:`${_}='${I}'`,F=_t(h,new gt({where:C,outFields:e.relatedFields,sourceSpatialReference:p}),n),P=e.outStatistics&&e.outStatistics.length>0&&o.supportsStatistics?_t(h,new gt({where:C,outFields:e.relatedFields,outStatistics:e.outStatistics,sourceSpatialReference:p}),n):null,Q={features:F};return P&&(Q.statsFeatures=P),Me(Q)}return null}function yo(t,e){return kn(t,{query:{f:"json"},signal:e&&e.signal})}function vo({relatedInfos:t,layer:e},i){const n={};return t.forEach((s,o)=>{const{relation:r}=s;if(!r){const m=new E("relation-required","A relation is required on a layer to retrieve related records.");throw pi.error(m),m}const{relatedTableId:l}=r;if(typeof l!="number"){const m=new E("A related table ID is required on a layer to retrieve related records.");throw pi.error(m),m}const c=`${e.url}/${l}`,h=fi.get(c),p=h??yo(c,i);h||fi.set(c,p),n[o]=p}),xn(Me(n),i)}function bo({graphic:t,relatedInfos:e,layer:i},n){const s={};return e.forEach((o,r)=>{o.layerInfo&&(s[r]=_o(t,o,i,n))}),Me(s)}function wo({relatedInfo:t,fieldName:e,fieldInfo:i}){var n,s;if((n=t.relatedFields)==null||n.push(e),i.statisticType){const o=new os({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});(s=t.outStatistics)==null||s.push(o)}}function Mo(t,e){if(t!=null){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}const mi={chartAnimation:!0};let R=class extends Ce{constructor(e){super(e),this.abilities={...mi},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...mi,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:i}=this,n=(e+i)%i;this.activeMediaInfoIndex=n}_pageContentElementMedia(e){const{activeMediaInfoIndex:i}=this,n=i+e;this._setContentElementMedia(n)}_formatMediaInfos(){const{mediaInfos:e,layer:i}=this,n=this.attributes??{},s=this.formattedAttributes??{},o=this.expressionAttributes??{},r=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(l=>{const c=l==null?void 0:l.clone();if(!c)return null;if(c.title=ve({attributes:n,fieldInfoMap:r,globalAttributes:s,expressionAttributes:o,layer:i,text:c.title}),c.caption=ve({attributes:n,fieldInfoMap:r,globalAttributes:s,expressionAttributes:o,layer:i,text:c.caption}),c.altText=ve({attributes:n,fieldInfoMap:r,globalAttributes:s,expressionAttributes:o,layer:i,text:c.altText}),c.type==="image"){const{value:h}=c;return this._setImageValue({value:h,formattedAttributes:s,layer:i}),c.value.sourceURL?c:void 0}if(c.type==="pie-chart"||c.type==="line-chart"||c.type==="column-chart"||c.type==="bar-chart"){const{value:h}=c;return this._setChartValue({value:h,chartType:c.type,attributes:n,formattedAttributes:s,layer:i,expressionAttributes:o}),c}return null}).filter(Bt))??[]}_setImageValue(e){const i=this.fieldInfoMap??new Map,{value:n,formattedAttributes:s,layer:o}=e,{linkURL:r,sourceURL:l}=n;if(l){const c=Vt(l,o);n.sourceURL=Ot({formattedAttributes:s,template:c,fieldInfoMap:i})}if(r){const c=Vt(r,o);n.linkURL=Ot({formattedAttributes:s,template:c,fieldInfoMap:i})}}_setChartValue(e){const{value:i,attributes:n,formattedAttributes:s,chartType:o,layer:r,expressionAttributes:l}=e,{popupTemplate:c,relatedInfos:h}=this,{fields:p,normalizeField:m}=i,_=r;if(i.fields=vs(p,_),m&&(i.normalizeField=He(m,_)),!p.some(I=>!!(s[I]!=null||re(I)&&(h!=null&&h.size))))return;const y=(c==null?void 0:c.fieldInfos)??[];p.forEach(I=>{if(re(I))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:y,fieldName:I,formattedAttributes:s,chartType:o,value:i})]);const C=this._getChartOption({value:i,attributes:n,chartType:o,formattedAttributes:s,expressionAttributes:l,fieldName:I,fieldInfos:y});i.series.push(C)})}_getRelatedChartInfos(e){var y;const{fieldInfos:i,fieldName:n,formattedAttributes:s,chartType:o,value:r}=e,l=[],c=Ze(n),h=c&&((y=this.relatedInfos)==null?void 0:y.get(c.layerId.toString()));if(!h)return l;const{relatedFeatures:p,relation:m}=h;if(!m||!p)return l;const{cardinality:_}=m;return p.forEach(I=>{const{attributes:C}=I;C&&Object.keys(C).forEach(F=>{F===c.fieldName&&l.push(this._getChartOption({value:r,attributes:C,formattedAttributes:s,fieldName:n,chartType:o,relatedFieldName:F,hasMultipleRelatedFeatures:(p==null?void 0:p.length)>1,fieldInfos:i}))})}),_==="one-to-many"||_==="many-to-many"?l:[l[0]]}_getTooltip({label:e,value:i,chartType:n}){return n==="pie-chart"?`${e}`:`${e}: ${i}`}_getChartOption(e){var le;const{value:i,attributes:n,formattedAttributes:s,expressionAttributes:o,fieldName:r,relatedFieldName:l,fieldInfos:c,chartType:h,hasMultipleRelatedFeatures:p}=e,m=this.layer,_=this.fieldInfoMap??new Map,{normalizeField:y,tooltipField:I}=i,C=y?re(y)?n[Ze(y).fieldName]:n[y]:null,F=qt(r)&&o&&o[r]!==void 0?o[r]:l&&n[l]!==void 0?n[l]:n[r]!==void 0?n[r]:s[r],P=new Ln({fieldName:r,value:F===void 0?null:F&&C?F/C:F});if(re(r)){const S=_.get(r.toLowerCase()),Y=I&&_.get(I.toLowerCase()),gn=(S==null?void 0:S.fieldName)??r,pt=p&&I?Ze(I).fieldName:(Y==null?void 0:Y.fieldName)??I,_n=p&&pt?n[pt]:s[pt]??(S==null?void 0:S.label)??(S==null?void 0:S.fieldName)??l,yn=p&&l?n[l]:s[gn];return P.tooltip=this._getTooltip({label:_n,value:yn,chartType:h}),P}const Q=Ji(c,r),ae=He(r,m),Ae=I&&s[I]!==void 0?s[I]:Ki(Q||new Di({fieldName:ae}),(le=this.popupTemplate)==null?void 0:le.expressionInfos),$e=s[ae];return P.tooltip=this._getTooltip({label:Ae,value:$e,chartType:h}),P}};a([d()],R.prototype,"abilities",void 0),a([Fe("abilities")],R.prototype,"castAbilities",null),a([d()],R.prototype,"activeMediaInfoIndex",void 0),a([d({readOnly:!0})],R.prototype,"activeMediaInfo",null),a([d()],R.prototype,"attributes",void 0),a([d()],R.prototype,"description",void 0),a([d()],R.prototype,"fieldInfoMap",void 0),a([d()],R.prototype,"formattedAttributes",void 0),a([d()],R.prototype,"expressionAttributes",void 0),a([d({readOnly:!0})],R.prototype,"formattedMediaInfos",null),a([d()],R.prototype,"isAggregate",void 0),a([d()],R.prototype,"layer",void 0),a([d({readOnly:!0})],R.prototype,"formattedMediaInfoCount",null),a([d()],R.prototype,"mediaInfos",void 0),a([d()],R.prototype,"popupTemplate",void 0),a([d()],R.prototype,"relatedInfos",void 0),a([d()],R.prototype,"title",void 0),R=a([L("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],R);const be=R;var gi=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Io=[].concat(gi.slice(30,39),gi.slice(28,30).reverse()),Fo=[{name:"default",colors:Io},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const _i="en-us",Qt=new Map([["ar",()=>w(()=>import("./ar-0c1c7bec.js"),["assets/ar-0c1c7bec.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.a)],["bg-bg",()=>w(()=>import("./bg_BG-bdcfad6f.js"),["assets/bg_BG-bdcfad6f.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["bs-ba",()=>w(()=>import("./bs_BA-09e27a59.js"),["assets/bs_BA-09e27a59.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.b)],["ca-es",()=>w(()=>import("./ca_ES-328a6d16.js"),["assets/ca_ES-328a6d16.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["cs-cz",()=>w(()=>import("./cs_CZ-389b82b1.js"),["assets/cs_CZ-389b82b1.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.c)],["da-dk",()=>w(()=>import("./da_DK-1c5401da.js"),["assets/da_DK-1c5401da.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-de",()=>w(()=>import("./de_DE-3d8a0881.js"),["assets/de_DE-3d8a0881.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["de-ch",()=>w(()=>import("./de_CH-1a8b4f23.js"),["assets/de_CH-1a8b4f23.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.d)],["el-gr",()=>w(()=>import("./el_GR-dd4b8e47.js"),["assets/el_GR-dd4b8e47.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-us",()=>w(()=>import("./en_US-01dbdae8.js"),["assets/en_US-01dbdae8.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["en-ca",()=>w(()=>import("./en_CA-01dbdae8.js"),["assets/en_CA-01dbdae8.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["es-es",()=>w(()=>import("./es_ES-edaac731.js"),["assets/es_ES-edaac731.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["et-ee",()=>w(()=>import("./et_EE-7d5fb5fd.js"),["assets/et_EE-7d5fb5fd.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.e)],["fi-fi",()=>w(()=>import("./fi_FI-9bf8bb44.js"),["assets/fi_FI-9bf8bb44.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["fr-fr",()=>w(()=>import("./fr_FR-fbebbe08.js"),["assets/fr_FR-fbebbe08.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.f)],["he-il",()=>w(()=>import("./he_IL-01830d9c.js"),["assets/he_IL-01830d9c.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hr-hr",()=>w(()=>import("./hr_HR-522b16f5.js"),["assets/hr_HR-522b16f5.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["hu-hu",()=>w(()=>import("./hu_HU-0b39fbc5.js"),["assets/hu_HU-0b39fbc5.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.h)],["id-id",()=>w(()=>import("./id_ID-f79708c8.js"),["assets/id_ID-f79708c8.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["it-it",()=>w(()=>import("./it_IT-1b10ee1f.js"),["assets/it_IT-1b10ee1f.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.i)],["ja-jp",()=>w(()=>import("./ja_JP-9033b8e3.js"),["assets/ja_JP-9033b8e3.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.j)],["ko-kr",()=>w(()=>import("./ko_KR-05cf8936.js"),["assets/ko_KR-05cf8936.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.k)],["lt-lt",()=>w(()=>import("./lt_LT-dd469d43.js"),["assets/lt_LT-dd469d43.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["lv-lv",()=>w(()=>import("./lv_LV-d14f0d02.js"),["assets/lv_LV-d14f0d02.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.l)],["nb-no",()=>w(()=>import("./nb_NO-b648e921.js"),["assets/nb_NO-b648e921.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["nl-nl",()=>w(()=>import("./nl_NL-3b4ca6d9.js"),["assets/nl_NL-3b4ca6d9.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.n)],["pl-pl",()=>w(()=>import("./pl_PL-9a5fcb5e.js"),["assets/pl_PL-9a5fcb5e.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-br",()=>w(()=>import("./pt_BR-5a009a5d.js"),["assets/pt_BR-5a009a5d.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["pt-pt",()=>w(()=>import("./pt_PT-78479d86.js"),["assets/pt_PT-78479d86.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.p)],["ro-ro",()=>w(()=>import("./ro_RO-ea15d221.js"),["assets/ro_RO-ea15d221.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["ru-ru",()=>w(()=>import("./ru_RU-a7dd44c1.js"),["assets/ru_RU-a7dd44c1.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.r)],["sk-sk",()=>w(()=>import("./sk_SK-2408dafb.js"),["assets/sk_SK-2408dafb.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sl-sl",()=>w(()=>import("./sl_SL-388af167.js"),["assets/sl_SL-388af167.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sr-rs",()=>w(()=>import("./sr_RS-a95c6e04.js"),["assets/sr_RS-a95c6e04.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["sv-se",()=>w(()=>import("./sv_SE-3463f500.js"),["assets/sv_SE-3463f500.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.s)],["th-th",()=>w(()=>import("./th_TH-916dba78.js"),["assets/th_TH-916dba78.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["tr-tr",()=>w(()=>import("./tr_TR-3da84757.js"),["assets/tr_TR-3da84757.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.t)],["uk-ua",()=>w(()=>import("./uk_UA-6f48ab44.js"),["assets/uk_UA-6f48ab44.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.u)],["vi-vn",()=>w(()=>import("./vi_VN-0c0801a8.js"),["assets/vi_VN-0c0801a8.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.v)],["zh-cn",()=>w(()=>import("./zh_Hans-9623f9b3.js"),["assets/zh_Hans-9623f9b3.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-hk",()=>w(()=>import("./zh_Hant-10901bcc.js"),["assets/zh_Hant-10901bcc.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)],["zh-tw",()=>w(()=>import("./zh_Hant-10901bcc.js"),["assets/zh_Hant-10901bcc.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/_commonjs-dynamic-modules-42bbacb3.js"]).then(t=>t.z)]]);function Co(t){const e=t.split("-")[0].toLowerCase();let i=null;for(const n of Qt.keys())if(n.startsWith(e)){i=n;break}return i}function Ao(t){return t?Qt.has(t.toLowerCase())?t.toLowerCase():Co(t)||_i:_i}let xe=null,Se=null;async function $o(t=Pn()){if(t=Ao(t),xe&&t===Se)return xe;xe=w(()=>import("./index-d82c1c5e.js"),["assets/index-d82c1c5e.js","assets/index-298039cc.js","assets/index-001d3307.css"]).then(e=>e.i),Se=t;try{const[e,i]=await Promise.all([xe,Qt.get(Se)()]);Se===t&&(e.am4core.options.defaultLocale=i.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return xe=null,Se=null,null}return xe}function Eo(t,e="default"){const i=Fo.find(n=>n.name===e);return i?i.colors.map(n=>t.color(n)):null}const O="esri-feature-media",j={base:O,mediaContainer:`${O}__container`,mediaItemContainer:`${O}__item-container`,mediaItem:`${O}__item`,mediaItemText:`${O}__item-text`,mediaItemTitle:`${O}__item-title`,mediaItemCaption:`${O}__item-caption`,mediaNavigation:`${O}__item-navigation`,mediaPagination:`${O}__pagination`,mediaPaginationText:`${O}__pagination-text`,mediaPrevious:`${O}__previous`,mediaPreviousIconLTR:`${O}__previous-icon`,mediaPreviousIconRTL:`${O}__previous-icon--rtl`,mediaNext:`${O}__next`,mediaNextIconLTR:`${O}__next-icon`,mediaNextIconRTL:`${O}__next-icon--rtl`,mediaChart:`${O}__chart`,mediaPaginationButton:`${O}__pagination-button`,mediaPaginationIcon:`${O}__pagination-icon`},Ft=.05,Ct=.95,At=15,te="color",ce="tooltip",Be="value",yi="default-line-value";let W=class extends Z{constructor(t,e){super(t,e),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new be,this.messages=null,this._getChartDependencies=async i=>{const n=await $o(),{destroyed:s,viewModel:o}=this;if(s||!o||!i)return;const{activeMediaInfo:r}=o,l=await this._getRendererColors(n);this._renderChart({chartDiv:i,mediaInfo:r,chartsModule:n,colorMap:l})}}initialize(){this._featureElementInfo=new ct,this.addHandles([M(()=>{var t,e;return[(t=this.viewModel)==null?void 0:t.activeMediaInfo,(e=this.viewModel)==null?void 0:e.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),D),M(()=>{var t,e;return[(t=this.viewModel)==null?void 0:t.description,(e=this.viewModel)==null?void 0:e.title]},()=>this._setupFeatureElementInfo(),D)])}loadDependencies(){return Qe({icon:()=>w(()=>import("./calcite-icon-5e4985c8.js"),["assets/calcite-icon-5e4985c8.js","assets/icon-f89dba00.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/observers-962e5802.js"])})}destroy(){var t;this._clearMediaRefreshTimer(),(t=this._featureElementInfo)==null||t.destroy()}get attributes(){return this.viewModel.attributes}set attributes(t){this.viewModel.attributes=t}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(t){this.viewModel.activeMediaInfoIndex=t}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(t){this.viewModel.fieldInfoMap=t}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(t){this.viewModel.mediaInfos=t}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(t){this.viewModel.popupTemplate=t}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(t){this.viewModel.relatedInfos=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}render(){var t;return u("div",{bind:this,class:j.base,onkeyup:this._handleMediaKeyup},(t=this._featureElementInfo)==null?void 0:t.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:t,activeMediaInfoIndex:e}=this.viewModel,i=this.renderMediaText();return t?u("div",{key:"media-element-container",class:j.mediaContainer},this.renderMediaInfo(),u("div",{class:j.mediaNavigation},i,u("div",{class:j.mediaPagination},this.renderMediaPageButton("previous"),u("span",{class:j.mediaPaginationText},J(this.messages.pageText,{index:e+1,total:t})),this.renderMediaPageButton("next")))):null}renderMediaText(){const{activeMediaInfo:t}=this.viewModel;if(!t)return null;const e=t&&t.title?u("div",{key:"media-title",class:j.mediaItemTitle,innerHTML:t.title}):null,i=t&&t.caption?u("div",{key:"media-caption",class:j.mediaItemCaption,innerHTML:t.caption}):null;return e||i?u("div",{class:j.mediaItemText},e,i):null}renderImageMediaInfo(t){const{_refreshIntervalInfo:e}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:n}=this.viewModel,{value:s,refreshInterval:o,altText:r,title:l,type:c}=t,{sourceURL:h,linkURL:p}=s,m=Gi(p??void 0)?"_blank":"_self",_=m==="_blank"?"noreferrer":"",y=o?e:null,I=y?y.timestamp:0,C=y?y.sourceURL:h,F=u("img",{alt:r||l,key:`media-${c}-${i}-${n}-${I}`,src:C??void 0});return(p?u("a",{title:l,href:p,rel:_,target:m},F):null)??F}renderChartMediaInfo(t){const{activeMediaInfoIndex:e,formattedMediaInfoCount:i}=this.viewModel;return u("div",{key:`media-${t.type}-${e}-${i}`,bind:this,class:j.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:t}=this.viewModel;return t?t.type==="image"?this.renderImageMediaInfo(t):t.type.includes("chart")?this.renderChartMediaInfo(t):null:null}renderMediaInfo(){const{activeMediaInfo:t}=this.viewModel;return t?u("div",{key:"media-container",class:j.mediaItemContainer},u("div",{key:"media-item-container",class:j.mediaItem},this.renderMediaInfoType())):null}renderMediaPageButton(t){if(this.viewModel.formattedMediaInfoCount<2)return null;const e=t==="previous",i=e?this.messages.previous:this.messages.next,n=e?"chevron-left":"chevron-right",s=e?"media-previous":"media-next",o=e?this._previous:this._next;return u("button",{type:"button",key:s,title:i,"aria-label":i,tabIndex:0,class:j.mediaPaginationButton,bind:this,onclick:o},u("calcite-icon",{class:j.mediaPaginationIcon,scale:"s",icon:n}))}_setupFeatureElementInfo(){var i;const{description:t,title:e}=this;(i=this._featureElementInfo)==null||i.set({description:t,title:e})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:t,layer:e}=this.viewModel;return t&&(e!=null&&e.featureReduction)&&"renderer"in e.featureReduction?e.featureReduction.renderer:e==null?void 0:e.renderer}async _getRendererColors(t){const{am4core:e}=t,i=new Map,n=this._getRenderer(),s="default";if(!n)return i;const o=await ao(n);return o.delete(s),Array.from(o.values()).every(r=>(r==null?void 0:r.length)===1)&&(i.set(yi,e.color({r:50,g:50,b:50,a:1})),Array.from(o.keys()).forEach(r=>{var l,c;r&&i.set(r,e.color((c=(l=o.get(r))==null?void 0:l[0])==null?void 0:c.toCss(!0)))})),i}_handleMediaKeyup(t){const e=Te(t);e==="ArrowLeft"&&(t.stopPropagation(),this.viewModel.previous()),e==="ArrowRight"&&(t.stopPropagation(),this.viewModel.next())}_renderChart(t){const{abilities:e}=this.viewModel,{chartsModule:i,chartDiv:n,mediaInfo:s,colorMap:o}=t,{value:r,type:l}=s,{am4core:c}=i,h=Eo(c);function p(y){y instanceof c.ColorSet&&h&&(y.list=h)}Lt()&&c.useTheme(i.am4themes_dark);const m=window.matchMedia("(prefers-reduced-motion: reduce)");e.chartAnimation&&!m.matches?c.useTheme(i.am4themes_animated):c.unuseTheme(i.am4themes_animated),c.useTheme(p);const _=l==="pie-chart"?this._createPieChart(t):this._createXYChart(t);n.setAttribute("aria-label",s.altText||s.title),_.data=r.series.map(y=>({[ce]:y.tooltip,[Be]:y.value,[te]:o.get(y.fieldName)})).filter(y=>l!=="pie-chart"||y.value!=null&&y.value>0)}_customizeChartTooltip(t,e){t&&(t.label.wrap=!0,t.label.maxWidth=200,t.autoTextColor=!1,t.getFillFromObject=!1,t.label.fill=e.color("#ffffff"),t.background.fill=e.color({r:0,g:0,b:0,a:.7}))}_createPieChart(t){const{chartDiv:e,chartsModule:i}=t,{am4core:n,am4charts:s}=i,o=n.create(e,s.PieChart);o.rtl=oe(this.container);const r=o.series.push(new s.PieSeries);return r.labels.template.disabled=!0,r.ticks.template.disabled=!0,r.dataFields.value=Be,r.dataFields.category=ce,this._customizeChartTooltip(r.tooltip,n),r.slices.template.propertyFields.fill=te,r.slices.template.propertyFields.stroke=te,o}_getMinSeriesValue(t){let e=0;return t.forEach(i=>e=Math.min(i.value,e)),e}_createColumnChart(t,e){const{chartsModule:i,mediaInfo:n}=e,{value:s}=n,{am4core:o,am4charts:r}=i,l=t.xAxes.push(new r.CategoryAxis);l.dataFields.category=ce,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const h=t.yAxes.push(new r.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=Ft,h.renderer.maxLabelPosition=Ct,h.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const m=t.series.push(new r.ColumnSeries);m.dataFields.valueY=Be,m.dataFields.categoryX=ce,m.columns.template.propertyFields.fill=te,m.columns.template.propertyFields.stroke=te,t.cursor=new r.XYCursor,s.series.length>At&&(t.scrollbarX=new o.Scrollbar)}_createBarChart(t,e){const{chartsModule:i,mediaInfo:n}=e,{value:s}=n,{am4core:o,am4charts:r}=i,l=t.yAxes.push(new r.CategoryAxis);l.dataFields.category=ce,l.renderer.inversed=!0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dx=c.contentWidth});const h=t.xAxes.push(new r.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=Ft,h.renderer.maxLabelPosition=Ct,h.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const m=t.series.push(new r.ColumnSeries);m.dataFields.valueX=Be,m.dataFields.categoryY=ce,m.columns.template.propertyFields.fill=te,m.columns.template.propertyFields.stroke=te,t.cursor=new r.XYCursor,s.series.length>At&&(t.scrollbarY=new o.Scrollbar)}_createLineChart(t,e){const{chartsModule:i,mediaInfo:n,colorMap:s}=e,{value:o}=n,{am4core:r,am4charts:l}=i,c=t.xAxes.push(new l.CategoryAxis);c.dataFields.category=ce,c.renderer.labels.template.disabled=!0;const h=c.tooltip;this._customizeChartTooltip(h,r),h.events.on("sizechanged",()=>{h.dy=-h.contentHeight});const p=t.yAxes.push(new l.ValueAxis),m=p.renderer.labels.template;p.renderer.minLabelPosition=Ft,p.renderer.maxLabelPosition=Ct,p.min=this._getMinSeriesValue(o.series),this._customizeChartTooltip(p.tooltip,r),m.wrap=!0;const _=t.series.push(new l.LineSeries);_.dataFields.categoryX=ce,_.dataFields.valueY=Be,_.strokeWidth=1;const y=s.get(yi);y&&(_.stroke=y);const I=_.bullets.push(new l.CircleBullet);I.propertyFields.fill=te,I.propertyFields.stroke=te,t.cursor=new l.XYCursor,o.series.length>At&&(t.scrollbarX=new r.Scrollbar)}_createXYChart(t){const{chartDiv:e,chartsModule:i,mediaInfo:n}=t,{type:s}=n,{am4core:o,am4charts:r}=i,l=o.create(e,r.XYChart);return l.rtl=oe(this.container),s==="column-chart"&&this._createColumnChart(l,t),s==="bar-chart"&&this._createBarChart(l,t),s==="line-chart"&&this._createLineChart(l,t),l}_clearMediaRefreshTimer(){const{_refreshTimer:t}=this;t&&(clearTimeout(t),this._refreshTimer=null)}_updateMediaInfoTimestamp(t){const e=Date.now();this._refreshIntervalInfo={timestamp:e,sourceURL:t&&this._getImageSource(t,e)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:t}=this.viewModel;t&&t.type==="image"&&t.refreshInterval&&this._setRefreshTimeout(t)}_setRefreshTimeout(t){const{refreshInterval:e,value:i}=t;if(!e)return;const n=6e4*e;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},n);this._refreshTimer=s}_getImageSource(t,e){const i=t.includes("?")?"&":"?",[n,s=""]=t.split("#");return`${n}${i}timestamp=${e}${s?"#":""}${s}`}};a([d()],W.prototype,"attributes",null),a([d()],W.prototype,"activeMediaInfoIndex",null),a([d()],W.prototype,"description",null),a([d()],W.prototype,"fieldInfoMap",null),a([d()],W.prototype,"layer",null),a([d()],W.prototype,"mediaInfos",null),a([d()],W.prototype,"popupTemplate",null),a([d()],W.prototype,"relatedInfos",null),a([d()],W.prototype,"title",null),a([d({type:be})],W.prototype,"viewModel",void 0),a([d(),K("esri/widgets/Feature/t9n/Feature")],W.prototype,"messages",void 0),W=a([L("esri.widgets.Feature.FeatureMedia")],W);const on=W,xo=["$datastore","$map","$layer","$aggregatedfeatures"],To="esri.widgets.Feature.support.arcadeFeatureUtils",ko=G.getLogger(To);function Lo(t){return typeof t=="string"?Ke(Wt(t)):Array.isArray(t)?Po(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?Ro(t):t}function Po(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?Ke(Wt(e)):e}</li>`).join("")}</ul>`}function Ro(t){return`<table class="esri-widget__table">${t.keys().map(e=>{const i=t.field(e);return`<tr><th>${e}</th><td>${typeof i=="string"?Ke(Wt(i)):i}</td></tr>`}).join("")}</table>`}function Oo({aggregatedFeatures:t,arcadeUtils:e,featureSetVars:i,context:n,viewInfo:s,map:o,graphic:r,interceptor:l}){i.forEach(c=>{const h=c.toLowerCase(),p=s.sr,m={map:o,spatialReference:p,interceptor:l};if(h==="$map"&&(n.vars[h]=e.convertMapToFeatureSetCollection(m)),h==="$layer"&&(n.vars[h]=e.convertFeatureLayerToFeatureSet({layer:r.sourceLayer,spatialReference:p,interceptor:l})),h==="$datastore"&&(n.vars[h]=e.convertServiceUrlToWorkspace({url:r.sourceLayer.url,spatialReference:p,interceptor:l})),h==="$aggregatedfeatures"){const _=r.layer,{fields:y,objectIdField:I,geometryType:C,spatialReference:F,displayField:P}=_,Q=new rs({fields:y,objectIdField:I,geometryType:C,spatialReference:F,displayField:P,..._.type==="feature"?{templates:_.templates,typeIdField:_.typeIdField,types:_.types}:null,source:t});n.vars[h]=e.convertFeatureLayerToFeatureSet({layer:Q,spatialReference:F,interceptor:l})}})}function rn(){return w(()=>import("./arcadeUtils-5601ca81.js").then(t=>t.ax),["assets/arcadeUtils-5601ca81.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/arcadeTimeUtils-8966e284.js","assets/executionError-fb3f283a.js","assets/FieldsIndex-dd7ebb88.js","assets/number-be4830f8.js","assets/Field-33980454.js","assets/fieldType-81268207.js","assets/featureConversionUtils-d60f35b9.js","assets/OptimizedGeometry-33b2eb0d.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/sizeVariableUtils-d4870b0d.js"])}function Vo(t){return"createQuery"in t&&"queryFeatures"in t}async function Do({graphic:t,view:e}){const{isAggregate:i,layer:n}=t;if(!i||!n||(e==null?void 0:e.type)!=="2d")return[];const s=await e.whenLayerView(n);if(!Vo(s))return[];const o=s.createQuery(),r=t.getObjectId();o.aggregateIds=r!=null?[r]:[];const{features:l}=await s.queryFeatures(o);return l}async function an({expressionInfo:t,arcadeUtils:e,interceptor:i,spatialReference:n,map:s,graphic:o,view:r}){if(!t||!t.expression)return null;const l=e.createSyntaxTree(t.expression),c=xo.filter(y=>e.hasVariable(l,y)),[h]=await Promise.all([Do({graphic:o,view:r}),e.loadScriptDependencies(l,!0,c)]),p=e.getViewInfo({spatialReference:n}),m=e.createExecContext(o,p);m.interceptor=i,m.useAsync=!0,Oo({aggregatedFeatures:h,arcadeUtils:e,featureSetVars:c,context:m,viewInfo:p,map:s,graphic:o,interceptor:i});const _=e.createFunction(l,m);return e.executeAsyncFunction(_,m).catch(y=>ko.error("arcade-execution-error",{error:y,graphic:o,expressionInfo:t}))}async function No({expressionInfos:t,spatialReference:e,graphic:i,interceptor:n,map:s,view:o}){if(!t||!t.length)return{};const r=await rn(),l={};for(const p of t)l[`expression/${p.name}`]=an({expressionInfo:p,arcadeUtils:r,interceptor:n,spatialReference:e,map:s,graphic:i,view:o});const c=await Me(l),h={};for(const p in c)h[p]=Lo(c[p].value);return h}const So=1;let H=class extends St(Ce){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:i}=this;i&&i.abort(),this._abortController=null},this._createVM=()=>{var s,o;const i=(s=this.contentElement)==null?void 0:s.type;(o=this.contentElementViewModel)==null||o.destroy();const n=i==="fields"?new ut:i==="media"?new be:i==="text"?new at:null;this._set("contentElementViewModel",n)},this._compile=async()=>{this._cancelQuery();const i=new AbortController;this._abortController=i,await this._compileExpression(),this._abortController===i&&(this._abortController=null)},this._compileThrottled=Oe(this._compile,So,this),this._compileExpression=async()=>{const{expressionInfo:i,graphic:n,interceptor:s,spatialReference:o,map:r,view:l,_abortController:c}=this;if(!(i&&n&&o&&r))return void this._set("contentElement",null);const h=await rn();if(c!==this._abortController)return;const p=await an({arcadeUtils:h,expressionInfo:i,graphic:n,interceptor:s,map:r,spatialReference:o,view:l});if(!p||p.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const m=await p.castAsJsonAsync(c==null?void 0:c.signal),_=m==null?void 0:m.type,y=_==="media"?Rn.fromJSON(m):_==="text"?Si.fromJSON(m):_==="fields"?On.fromJSON(m):null;this._set("contentElement",y)},this.handles.add([M(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),D),M(()=>[this.contentElement],()=>this._createVM(),D)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:i,contentElementViewModel:n}=this;return e?"loading":i||n?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};a([d()],H.prototype,"_abortController",void 0),a([d({type:Vn})],H.prototype,"expressionInfo",void 0),a([d({type:De})],H.prototype,"graphic",void 0),a([d({readOnly:!0})],H.prototype,"contentElement",void 0),a([d({readOnly:!0})],H.prototype,"contentElementViewModel",void 0),a([d()],H.prototype,"interceptor",void 0),a([d()],H.prototype,"spatialReference",null),a([d({readOnly:!0})],H.prototype,"state",null),a([d()],H.prototype,"map",null),a([d()],H.prototype,"view",void 0),H=a([L("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],H);const Gt=H,Xe={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let et=class extends Z{constructor(e,i){super(e,i),this._contentWidget=null,this.viewModel=new Gt}initialize(){this.addHandles(M(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),D))}destroy(){this._destroyContentWidget()}renderLoading(){return u("div",{key:"loading-container",class:Xe.loadingSpinnerContainer},u("span",{class:this.classes(Xe.iconLoading,Xe.spinner)}))}render(){var i;const{state:e}=this.viewModel;return u("div",{class:Xe.base},e==="loading"?this.renderLoading():e==="disabled"?null:(i=this._contentWidget)==null?void 0:i.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:i}=this.viewModel,n=i==null?void 0:i.type;this._destroyContentWidget();const s=e?n==="fields"?new sn({viewModel:e}):n==="media"?new on({viewModel:e}):n==="text"?new Je({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};a([d({type:Gt})],et.prototype,"viewModel",void 0),et=a([L("esri.widgets.Feature.FeatureExpression")],et);const Bo=et,$t=100;let x=class extends Dn(Bi(St(Ce))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:i}=this;i&&i.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const i=new AbortController;this._queryAbortController=i,await ft(this._query()),this._queryAbortController===i&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const i=new AbortController;this._queryFeatureCountAbortController=i,await ft(this._queryFeatureCount()),this._queryFeatureCountAbortController===i&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const i=new AbortController;this._queryPageAbortController=i,await ft(this._queryPage()),this._queryPageAbortController===i&&(this._queryPageAbortController=null)},this._queryThrottled=Oe(this._queryController,$t,this),this._queryFeatureCountThrottled=Oe(this._queryFeatureCountController,$t,this),this._queryPageThrottled=Oe(this._queryPageController,$t,this),this._query=async()=>{const{_queryAbortController:i,relatedFeatures:n}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,n.removeAll(),n.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:i==null?void 0:i.signal})))},this.handles.add([M(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),D),M(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),M(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:i,featureCount:n}=this,s=1,o=Math.ceil(n/i)||1;this._set("featurePage",Math.min(Math.max(e,s),o))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:i}=this;return e&&(i!=null&&i.loaded)?e.map(n=>{const s=n.clone();return s.field=He(n.field,i),s}):e??[]}get supportsCacheHint(){var e,i,n;return!!((n=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.queryRelated)!=null&&n.supportsCacheHint)}get canQuery(){var i,n;const e=(n=(i=this.layer)==null?void 0:i.capabilities)==null?void 0:n.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e;return((e=this.orderByFieldsFixedCasing[0])==null?void 0:e.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,i;return(this.objectIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new he}get relatedLayer(){const{layer:e,map:i,relationship:n}=this;return e!=null&&e.loaded&&i&&n?Bs(i,e,n)??null:null}get relationship(){var n;const{relationshipId:e,layer:i}=this;return typeof e=="number"?((n=i==null?void 0:i.relationships)==null?void 0:n.find(({id:s})=>s===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new he}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:i,_queryPageAbortController:n,canQuery:s}=this;return i?"loading":e||n?"querying":s?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(i=>!i.destroyed&&i.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:i,relationshipId:n,objectId:s,_queryFeatureCountAbortController:o,canQuery:r,supportsCacheHint:l}=this;if(await(e==null?void 0:e.load()),await(i==null?void 0:i.load()),!r||!e||!i)return void this._set("featureCount",0);const c=i.createQuery(),h=new Pt({cacheHint:l,relationshipId:n,returnGeometry:!1,objectIds:[s],where:c.where??void 0}),p=await e.queryRelatedFeaturesCount(h,{signal:o==null?void 0:o.signal});this._set("featureCount",p[s]||0)}_sliceFeatures(e){const{showAllEnabled:i,displayCount:n}=this;return i?e:n?e.slice(0,n):[]}async _queryPage(){const{relatedFeatures:e,featurePage:i,showAllEnabled:n,_queryPageAbortController:s}=this;!n||i<2||e.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(e){var S;const{orderByFieldsFixedCasing:i,showAllEnabled:n,featuresPerPage:s,displayCount:o,layer:r,relationshipId:l,featurePage:c,featureCount:h,relatedLayer:p,supportsCacheHint:m}=this,{canQuery:_,objectId:y}=this;if(!_||!r||!p)return[];const I=n?((c-1)*s+h)%h:0,C=n?s:o,F=p.objectIdField,P=[...i.map(Y=>Y.field),F].filter(Bt),Q=i.map(Y=>`${Y.field} ${Y.order}`),ae=p.createQuery(),Ae=new Pt({orderByFields:Q,start:I,num:C,outFields:P,cacheHint:m,relationshipId:l,returnGeometry:!1,objectIds:[y],where:ae.where??void 0}),$e=await r.queryRelatedFeatures(Ae,{signal:e==null?void 0:e.signal}),le=((S=$e[y])==null?void 0:S.features)||[];return le.forEach(Y=>{Y.sourceLayer=p,Y.layer=p}),le}};a([d()],x.prototype,"_queryAbortController",void 0),a([d()],x.prototype,"_queryPageAbortController",void 0),a([d()],x.prototype,"_queryFeatureCountAbortController",void 0),a([d({value:1})],x.prototype,"featurePage",null),a([d()],x.prototype,"featuresPerPage",void 0),a([d({readOnly:!0})],x.prototype,"orderByFieldsFixedCasing",null),a([d({readOnly:!0})],x.prototype,"supportsCacheHint",null),a([d({readOnly:!0})],x.prototype,"canQuery",null),a([d()],x.prototype,"description",void 0),a([d({readOnly:!0})],x.prototype,"itemDescriptionFieldName",null),a([d({value:3})],x.prototype,"displayCount",null),a([d({type:De})],x.prototype,"graphic",void 0),a([d()],x.prototype,"layer",void 0),a([d()],x.prototype,"map",void 0),a([d({readOnly:!0})],x.prototype,"objectId",null),a([d({readOnly:!0})],x.prototype,"objectIdField",null),a([d()],x.prototype,"orderByFields",void 0),a([d({readOnly:!0})],x.prototype,"relatedFeatures",null),a([d({readOnly:!0})],x.prototype,"relatedLayer",null),a([d({readOnly:!0})],x.prototype,"relationship",null),a([d()],x.prototype,"featureCount",void 0),a([d({readOnly:!0})],x.prototype,"relatedFeatureViewModels",null),a([d()],x.prototype,"relationshipId",void 0),a([d()],x.prototype,"showAllEnabled",void 0),a([d()],x.prototype,"state",null),a([d()],x.prototype,"title",void 0),x=a([L("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],x);const Kt=x,We="esri-feature",Et=`${We}-relationship`,ie={base:Et,esriWidget:"esri-widget",listContainer:`${Et}__list`,listContainerQuerying:`${Et}__list--querying`,featureObserver:`${We}__feature-observer`,stickySpinnerContainer:`${We}__sticky-loading-container`,loadingSpinnerContainer:`${We}__loading-container`,spinner:`${We}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},vi={title:!0,description:!0};let q=class extends Z{constructor(t,e){super(t,e),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Kt,this.messages=null,this.messagesCommon=null,this.visibleElements={...vi},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:n,relatedFeatures:s,featuresPerPage:o,featurePage:r}=this.viewModel;i==="ready"&&n&&s.length>=o*r&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new ct,this.addHandles([M(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),D),M(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),pe(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Qe({icon:()=>w(()=>import("./calcite-icon-5e4985c8.js"),["assets/calcite-icon-5e4985c8.js","assets/icon-f89dba00.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/observers-962e5802.js"]),list:()=>w(()=>import("./calcite-list-ff81443c.js"),["assets/calcite-list-ff81443c.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/loader-205e7e2d.js","assets/guid-a49a37f8.js","assets/observers-962e5802.js","assets/utils3-930f3cf0.js","assets/t9n-0db3c134.js","assets/debounce-222042af.js","assets/icon-f89dba00.js","assets/scrim-60feed88.js"]),"list-item":()=>w(()=>import("./calcite-list-item-d2cd44ed.js"),["assets/calcite-list-item-d2cd44ed.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/loader-205e7e2d.js","assets/guid-a49a37f8.js","assets/utils3-930f3cf0.js","assets/t9n-0db3c134.js","assets/observers-962e5802.js","assets/action-d5f77e08.js","assets/icon-f89dba00.js"]),notice:()=>w(()=>import("./calcite-notice-a2a64b39.js"),["assets/calcite-notice-a2a64b39.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/observers-962e5802.js","assets/t9n-0db3c134.js","assets/icon-f89dba00.js"])})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=qi(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:t,featureCount:e,displayCount:i}=this.viewModel;return!t&&!!e&&(e>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(t){this.viewModel.description=t}get featureCountDescription(){const{messages:t}=this,{featureCount:e}=this.viewModel;return J(e===1?t==null?void 0:t.numberRecord:t==null?void 0:t.numberRecords,{number:e})}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}castVisibleElements(t){return{...vi,...t}}renderStickyLoading(){return this.viewModel.state==="querying"?u("div",{key:"sticky-loader",class:ie.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return u("span",{class:this.classes(ie.iconLoading,ie.spinner)})}renderLoading(){return u("div",{key:"loading-container",class:ie.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return u("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const t=oe(this.container)?"chevron-left":"chevron-right";return u("calcite-icon",{scale:"s",icon:t,slot:"content-end"})}renderRelatedFeature(t){var s,o;const{itemDescriptionFieldName:e}=this.viewModel,i=t.title;t.description=e&&((s=t.formattedAttributes)==null?void 0:s.global[e]);const n=t.state==="loading";return u("calcite-list-item",{key:t.uid,label:n?`${(o=this.messagesCommon)==null?void 0:o.loading}`:i,description:n?"":t.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:t})},this.renderChevronIconNode())}renderShowAllListItem(){var t;return this.displayShowAllButton?u("calcite-list-item",{key:"show-all-item",label:(t=this.messages)==null?void 0:t.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var t;return u("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},u("div",{slot:"message"},(t=this.messages)==null?void 0:t.noRelatedFeatures))}renderFeatureObserver(){return u("div",{key:"feature-observer",class:ie.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:t}=this.viewModel;return u("calcite-list",null,t.toArray().map(e=>this.renderRelatedFeature(e)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:t}=this,{state:e}=this.viewModel;return u("div",{key:"list-container",class:this.classes(ie.listContainer,{[ie.listContainerQuerying]:e==="querying"})},t?this.renderList():e==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var t;return u("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},u("div",{slot:"message"},(t=this.messages)==null?void 0:t.relationshipNotFound))}render(){var e;const{state:t}=this.viewModel;return u("div",{class:this.classes(ie.base,ie.esriWidget)},(e=this._featureElementInfo)==null?void 0:e.render(),t==="loading"?this.renderLoading():t==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:t}=this.viewModel,e="related-feature-viewmodels";this.removeHandles(e),t==null||t.forEach(i=>{this.addHandles(M(()=>[i.title,i.state],()=>this.scheduleRender(),D),e)}),this.scheduleRender()}_setupFeatureElementInfo(){var s;const{headingLevel:t,visibleElements:e}=this,i=e.description&&this.description,n=e.title&&this.title;(s=this._featureElementInfo)==null||s.set({description:i,title:n,headingLevel:t})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:t,showAllEnabled:e}=this.viewModel;await zi(0),this._relatedFeatureIntersectionObserverNode&&t==="ready"&&e&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(t){this._relatedFeatureIntersectionObserverNode=t}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};a([d()],q.prototype,"_relatedFeatureIntersectionObserverNode",void 0),a([d({readOnly:!0})],q.prototype,"displayShowAllButton",null),a([d({readOnly:!0})],q.prototype,"displayListItems",null),a([d()],q.prototype,"description",null),a([d({readOnly:!0})],q.prototype,"featureCountDescription",null),a([d()],q.prototype,"headingLevel",void 0),a([d()],q.prototype,"title",null),a([d({type:Kt})],q.prototype,"viewModel",void 0),a([d(),K("esri/widgets/Feature/t9n/Feature")],q.prototype,"messages",void 0),a([d(),K("esri/t9n/common")],q.prototype,"messagesCommon",void 0),a([d()],q.prototype,"visibleElements",void 0),a([Fe("visibleElements")],q.prototype,"castVisibleElements",null),q=a([L("esri.widgets.Feature.FeatureRelationship")],q);const bi=q;let qo=class{constructor(e,i){this.preLayerQueryCallback=e,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=n=>{}),this.preRequestCallback||(this.preLayerQueryCallback=n=>{})}};var Ue;const zo=1,wi="content-view-models",Mi="relationship-view-models",Ii={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let T=Ue=class extends Bi(Ce){constructor(t){super(t),this._handles=new dt,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=Oe(this._graphicChanged,zo,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Ii},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:i}=this;return e.type==="attachments"&&!!i.attachmentsContent||e.type==="custom"&&!!i.customContent||e.type==="fields"&&!!i.fieldsContent||e.type==="media"&&!!i.mediaContent||e.type==="text"&&!!i.textContent||e.type==="expression"&&!!i.expressionContent||e.type==="relationship"&&!!i.relationshipContent},this._handles.add(M(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),D))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return Ps(ri(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Qi(this.graphic)}castAbilities(t){return{...Ii,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",t?t.clone():null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof be&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof be&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof be&&e.previous()}async updateGeometry(){var r;const{graphic:t,spatialReference:e,_sourceLayer:i}=this;await(i==null?void 0:i.load());const n=i==null?void 0:i.objectIdField;if(!n||!t||!i)return;const s=(r=t==null?void 0:t.attributes)==null?void 0:r[n];if(s==null)return;const o=[s];if(!t.geometry){const l=await en({layer:i,graphic:t,outFields:[],objectIds:o,returnGeometry:!0,spatialReference:e}),c=l==null?void 0:l.geometry;c&&(t.geometry=c)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(i){Nn(i)||(this._error=i,G.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,i)=>this._compileContentElement(e,i)).filter(Bt):typeof t=="string"?this._compileText(new Si({text:t}),0).text:t}_destroyContentViewModels(){var t,e;(t=this._handles)==null||t.remove(Mi),(e=this._handles)==null||e.remove(wi),this.contentViewModels.forEach(i=>i&&!i.destroyed&&i.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var s;const i=(s=t==null?void 0:t.graphic)==null?void 0:s.getObjectId(),n=e==null?void 0:e.getObjectId();return i!=null&&n!=null&&i===n}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:i}){const{view:n,spatialReference:s}=this;e==null||e.filter(Boolean).forEach(o=>{t.find(r=>this._matchesFeature(r,o))||t.add(new Ue({abilities:{relationshipContent:!1},map:i,view:n,spatialReference:s,graphic:o}))}),t.forEach(o=>{(e==null?void 0:e.find(l=>this._matchesFeature(o,l)))||t.remove(o)})}_setExpressionContentVM(t,e){const i=this.formattedAttributes,{contentElement:n,contentElementViewModel:s}=t,o=n==null?void 0:n.type;s&&o&&(o==="fields"&&(this._createFieldsFormattedAttributes({contentElement:n,contentElementIndex:e,formattedAttributes:i}),s.set(this._createFieldsVMParams(n,e))),o==="media"&&(this._createMediaFormattedAttributes({contentElement:n,contentElementIndex:e,formattedAttributes:i}),s.set(this._createMediaVMParams(n,e))),o==="text"&&s.set(this._createTextVMParams(n)))}_compileRelationship(t,e){const{displayCount:i,orderByFields:n,relationshipId:s,title:o,description:r}=t,{_sourceLayer:l,graphic:c,map:h}=this;if(!Xi(l))return;const p=new Kt({displayCount:i,graphic:c,orderByFields:n,relationshipId:s,layer:l,map:h,...this._compileTitleAndDesc({title:o,description:r})});return this.contentViewModels[e]=p,this._handles.add(pe(()=>p.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(p)),Mi),t}_compileExpression(t,e){const{expressionInfo:i}=t,{graphic:n,map:s,spatialReference:o,view:r}=this,l=new Gt({expressionInfo:i,graphic:n,interceptor:Ue.interceptor,map:s,spatialReference:o,view:r});return this.contentViewModels[e]=l,this._handles.add(M(()=>l.contentElementViewModel,()=>this._setExpressionContentVM(l,e),D),wi),t}_compileAttachments(t,e){const{graphic:i}=this,{description:n,title:s}=t;return this.contentViewModels[e]=new jt({graphic:i,...this._compileTitleAndDesc({title:s,description:n})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:n,destroyer:s}=t;return this.contentViewModels[e]=new at({graphic:i,creator:n,destroyer:s}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:n,graphic:s,formattedAttributes:o}=this,r=s==null?void 0:s.attributes,l=this._expressionAttributes,c=o.global;return{title:ve({attributes:r,fieldInfoMap:i,globalAttributes:c,expressionAttributes:l,layer:n,text:t}),description:ve({attributes:r,fieldInfoMap:i,globalAttributes:c,expressionAttributes:l,layer:n,text:e})}}_createFieldsVMParams(t,e){const i=this._effectivePopupTemplate,n=this.formattedAttributes,s={...n==null?void 0:n.global,...n==null?void 0:n.content[e]},o=(t==null?void 0:t.fieldInfos)||(i==null?void 0:i.fieldInfos),r=o==null?void 0:o.filter(({fieldName:p})=>qt(p)||re(p)||s.hasOwnProperty(p)),l=i==null?void 0:i.expressionInfos,{description:c,title:h}=t;return{attributes:s,expressionInfos:l,fieldInfos:r,...this._compileTitleAndDesc({title:h,description:c})}}_compileFields(t,e){const i=t.clone(),n=new ut(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=n,i.fieldInfos=n.formattedFieldInfos.slice(0),i}_createMediaVMParams(t,e){const{abilities:i,graphic:n,_fieldInfoMap:s,_effectivePopupTemplate:o,relatedInfos:r,_sourceLayer:l,_expressionAttributes:c}=this,h=this.formattedAttributes,p=(n==null?void 0:n.attributes)??{},{description:m,mediaInfos:_,title:y}=t;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:p,isAggregate:n==null?void 0:n.isAggregate,layer:l,fieldInfoMap:s,formattedAttributes:{...h==null?void 0:h.global,...h==null?void 0:h.content[e]},expressionAttributes:c,mediaInfos:_,popupTemplate:o,relatedInfos:r,...this._compileTitleAndDesc({title:y,description:m})}}_compileMedia(t,e){const i=t.clone(),n=new be(this._createMediaVMParams(t,e));return i.mediaInfos=n.formattedMediaInfos.slice(0),this.contentViewModels[e]=n,i}_createTextVMParams(t){var o;const{graphic:e,_fieldInfoMap:i,_sourceLayer:n,_expressionAttributes:s}=this;if(t&&t.text){const r=(e==null?void 0:e.attributes)??{},l=((o=this.formattedAttributes)==null?void 0:o.global)??{};t.text=ve({attributes:r,fieldInfoMap:i,globalAttributes:l,expressionAttributes:s,layer:n,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const i=t.clone();return this.contentViewModels[e]=new at(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i}=this;if(!t)return;const{lastEditInfoEnabled:n}=t,s=e==null?void 0:e.editFieldsInfo;return n&&s?Ls(s,i==null?void 0:i.attributes):void 0}_compileTitle(t){var l;const{_fieldInfoMap:e,_sourceLayer:i,graphic:n,_expressionAttributes:s}=this,o=(n==null?void 0:n.attributes)??{},r=((l=this.formattedAttributes)==null?void 0:l.global)??{};return ve({attributes:o,fieldInfoMap:e,globalAttributes:r,expressionAttributes:s,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const i=t==null?void 0:t.title;return rt(i,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;if(!e)return null;const i=t==null?void 0:t.content;return rt(i,{graphic:e})}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:i,graphic:n,_effectivePopupTemplate:s}=this,o=this.map,r=this.view,l=this.spatialReference;if(e!==this._featureAbortController||!n)return;await Os({graphic:n,popupTemplate:s,layer:i,spatialReference:l},t);const{content:{value:c},title:{value:h}}=await Me({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:p}}=await Me({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:No({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:l,graphic:n,map:o,interceptor:Ue.interceptor,view:r})});e===this._featureAbortController&&n&&(this._expressionAttributes=p,this._graphicExpressionAttributes={...n.attributes,...p},this._set("formattedAttributes",this._createFormattedAttributes(c)),this._set("title",this._compileTitle(h)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(c)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){const{_effectivePopupTemplate:n,graphic:s,relatedInfos:o,_sourceLayer:r,_fieldInfoMap:l,_graphicExpressionAttributes:c}=this;i.content[e]=yt({fieldInfos:n==null?void 0:n.fieldInfos,graphic:s,attributes:{...c,...t.attributes},layer:r,fieldInfoMap:l,relatedInfos:o})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){if(t.fieldInfos){const{graphic:n,relatedInfos:s,_sourceLayer:o,_fieldInfoMap:r,_graphicExpressionAttributes:l}=this;i.content[e]=yt({fieldInfos:t.fieldInfos,graphic:n,attributes:{...l,...t.attributes},layer:o,fieldInfoMap:r,relatedInfos:s})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:i,relatedInfos:n,_sourceLayer:s,_fieldInfoMap:o,_graphicExpressionAttributes:r}=this,l=e==null?void 0:e.fieldInfos,c={global:yt({fieldInfos:l,graphic:i,attributes:r,layer:s,fieldInfoMap:o,relatedInfos:n}),content:[]};return Array.isArray(t)&&t.forEach((h,p)=>{h.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:h,contentElementIndex:p,formattedAttributes:c}),h.type==="media"&&this._createMediaFormattedAttributes({contentElement:h,contentElementIndex:p,formattedAttributes:c})}),c}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,ri(i),t)}async _queryRelatedInfos(t,e,i){const{relatedInfos:n,_sourceLayer:s}=this;n.clear();const o=(s==null?void 0:s.associatedLayer)!=null?await(s==null?void 0:s.associatedLayer.load(i)):s;if(!o||!t)return;const r=e.filter(h=>h&&re(h.fieldName));if(!r||!r.length)return;e.forEach(h=>this._configureRelatedInfo(h,o));const l=await vo({relatedInfos:n,layer:o},i);Object.keys(l).forEach(h=>{var _;const p=n.get(h.toString()),m=(_=l[h])==null?void 0:_.value;p&&m&&(p.layerInfo=m.data)});const c=await bo({graphic:t,relatedInfos:n,layer:o},i);Object.keys(c).forEach(h=>{var p;fo((p=c[h])==null?void 0:p.value,n.get(h.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,n=Ze(t.fieldName);if(!n)return;const{layerId:s,fieldName:o}=n;if(!s)return;const r=i.get(s.toString())||po(s,e);r&&(wo({relatedInfo:r,fieldName:o,fieldInfo:t}),this.relatedInfos.set(s,r))}};T.interceptor=new qo(Ns,Ss),a([d()],T.prototype,"_error",void 0),a([d()],T.prototype,"_featureAbortController",void 0),a([d({readOnly:!0})],T.prototype,"_effectivePopupTemplate",null),a([d({readOnly:!0})],T.prototype,"_fieldInfoMap",null),a([d({readOnly:!0})],T.prototype,"_sourceLayer",null),a([d()],T.prototype,"abilities",void 0),a([Fe("abilities")],T.prototype,"castAbilities",null),a([d({readOnly:!0})],T.prototype,"content",void 0),a([d({readOnly:!0})],T.prototype,"contentViewModels",void 0),a([d()],T.prototype,"description",void 0),a([d({type:Boolean})],T.prototype,"defaultPopupTemplateEnabled",void 0),a([d({readOnly:!0})],T.prototype,"isTable",null),a([d({readOnly:!0})],T.prototype,"state",null),a([d({readOnly:!0})],T.prototype,"formattedAttributes",void 0),a([d({type:De,value:null})],T.prototype,"graphic",null),a([d({readOnly:!0})],T.prototype,"lastEditInfo",void 0),a([d({readOnly:!0})],T.prototype,"relatedInfos",void 0),a([d()],T.prototype,"spatialReference",null),a([d({readOnly:!0})],T.prototype,"title",void 0),a([d()],T.prototype,"map",null),a([d({readOnly:!0})],T.prototype,"waitingForContent",null),a([d()],T.prototype,"view",void 0),T=Ue=a([L("esri.widgets.FeatureViewModel")],T);const Yt=T,N="esri-feature",k={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:N,container:`${N}__size-container`,title:`${N}__title`,main:`${N}__main-container`,btn:`${N}__button`,icon:`${N}__icon`,content:`${N}__content`,contentNode:`${N}__content-node`,contentElement:`${N}__content-element`,text:`${N}__text`,lastEditedInfo:`${N}__last-edited-info`,fields:`${N}__fields`,fieldHeader:`${N}__field-header`,fieldData:`${N}__field-data`,fieldDataDate:`${N}__field-data--date`,loadingSpinnerContainer:`${N}__loading-container`,spinner:`${N}__loading-spinner`},ln=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=i=>Ui(i)&&!i.destroyed?u("div",{class:k.contentNode,key:i},i.render()):i instanceof HTMLElement?u("div",{class:k.contentNode,key:i,bind:i,afterCreate:this._attachToNode}):es(i)?u("div",{class:k.contentNode,key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const n=this;i.appendChild(n)}};return e=a([L("esri.widgets.Feature.ContentMixin")],e),e};var Dt;const Fi={title:!0,content:!0,lastEditedInfo:!0},Ci="relationship-handles";let V=Dt=class extends ln(Z){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...Fi},this.viewModel=new Yt}initialize(){this.addHandles(M(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),D))}loadDependencies(){return Qe({notice:()=>w(()=>import("./calcite-notice-a2a64b39.js"),["assets/calcite-notice-a2a64b39.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/observers-962e5802.js","assets/t9n-0db3c134.js","assets/icon-f89dba00.js"])})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...Fi,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{state:t}=this.viewModel,e=u("div",{class:k.container,key:"container"},this.renderTitle(),t==="error"?this.renderError():t==="loading"?this.renderLoading():this.renderContentContainer());return u("div",{class:this.classes(k.base,k.esriWidget)},e)}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return u("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},i.title?u("div",{key:"error-title",slot:"title"},t.errorMessage):null,u("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return u("div",{key:"loading-container",class:k.loadingSpinnerContainer},u("span",{class:this.classes(k.iconLoading,k.spinner)}))}renderContentContainer(){const{visibleElements:t}=this;return t.content?u("div",{class:k.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:t,title:e}=this;return t.title?u(Ht,{level:this.headingLevel,class:k.title,innerHTML:e}):null}renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?u("div",{class:k.contentNode,key:`${e}-content-elements`},t.map(this.renderContentElement,this)):null;if(typeof t=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:u("div",{class:k.contentNode,key:`${e}-content`},i.render())}return this.renderNodeContent(t)}renderContentElement(t,e){var n;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((n=i.content)!=null&&n[t.type]))return null;switch(t.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(t,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(t,e);case"expression":return this.renderExpression(e);case"relationship":return this.renderRelationship(e);default:return null}}renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:n}=e.viewModel;return i==="loading"||n.length>0?u("div",{key:this._buildKey("attachments-element",t),class:this.classes(k.contentElement)},e.render()):null}renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?u("div",{key:this._buildKey("relationship-element",t),class:k.contentElement},e.render()):null}renderExpression(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:u("div",{key:this._buildKey("expression-element",t),class:k.contentElement},e.render())}renderCustom(t,e){const{creator:i}=t,n=this._contentWidgets[e];return!n||n.destroyed?null:i?u("div",{key:this._buildKey("custom-element",e),class:k.contentElement},n.render()):null}renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:u("div",{key:this._buildKey("fields-element",t),class:k.contentElement},e.render())}renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:u("div",{key:this._buildKey("media-element",t),class:k.contentElement},e.render())}renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:n,user:s}=i,o=i.type==="edit"?s?e.lastEditedByUser:e.lastEdited:s?e.lastCreatedByUser:e.lastCreated,r=J(o,{date:n,user:s});return u("div",{key:"edit-info-element",class:this.classes(k.lastEditedInfo,k.contentElement)},r)}renderText(t,e){const i=t.text,n=this._contentWidgets[e];return!n||n.destroyed?null:i?u("div",{key:this._buildKey("text-element",e),class:this.classes(k.contentElement,k.text)},n.render()):null}_buildKey(t,...e){return`${t}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this.removeHandles(Ci),this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_addFeatureRelationshipHandles(t){const{flowItems:e,visibleElements:i}=this;this.addHandles([pe(()=>t,"select-record",({featureViewModel:n})=>{e&&(n.abilities={relationshipContent:!0},e.push(new Dt({flowItems:e,viewModel:n,visibleElements:i})))}),pe(()=>t,"show-all-records",()=>{if(!e)return;const{viewModel:n}=t;n.showAllEnabled=!0;const s=new bi({visibleElements:{title:!1,description:!1},viewModel:n});this._addFeatureRelationshipHandles(s),e.push(s)})],Ci)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,i=this.get("viewModel.content"),{contentViewModels:n}=this.viewModel;if(Array.isArray(i))i.forEach((s,o)=>{if(s.type==="attachments"&&(this._contentWidgets[o]=new Hs({displayType:s.displayType,headingLevel:e.title?t+1:t,viewModel:n[o]})),s.type==="fields"&&(this._contentWidgets[o]=new sn({viewModel:n[o]})),s.type==="media"&&(this._contentWidgets[o]=new on({viewModel:n[o]})),s.type==="text"&&(this._contentWidgets[o]=new Je({viewModel:n[o]})),s.type==="custom"&&(this._contentWidgets[o]=new Je({viewModel:n[o]})),s.type==="expression"&&(this._contentWidgets[o]=new Bo({viewModel:n[o]})),s.type==="relationship"){const r=new bi({viewModel:n[o]});this._addFeatureRelationshipHandles(r),this._contentWidgets[o]=r}},this);else{const s=n[0];s&&!s.destroyed&&(this._contentWidgets[0]=new Je({viewModel:s}))}this.scheduleRender()}};a([d()],V.prototype,"graphic",null),a([d()],V.prototype,"defaultPopupTemplateEnabled",null),a([d()],V.prototype,"flowItems",void 0),a([d()],V.prototype,"headingLevel",void 0),a([d({readOnly:!0})],V.prototype,"isTable",null),a([d()],V.prototype,"label",null),a([d(),K("esri/widgets/Feature/t9n/Feature")],V.prototype,"messages",void 0),a([d(),K("esri/t9n/common")],V.prototype,"messagesCommon",void 0),a([d(),K("esri/widgets/support/t9n/uriUtils")],V.prototype,"messagesURIUtils",void 0),a([d()],V.prototype,"spatialReference",null),a([d({readOnly:!0})],V.prototype,"title",null),a([d()],V.prototype,"visibleElements",void 0),a([Fe("visibleElements")],V.prototype,"castVisibleElements",null),a([d()],V.prototype,"map",null),a([d()],V.prototype,"view",null),a([d({type:Yt})],V.prototype,"viewModel",void 0),V=Dt=a([L("esri.widgets.Feature")],V);const Wo=V;var dn;const tt=Symbol("anchorHandles");let ge=class extends Sn.EventedAccessor{constructor(e){super(e),this[dn]=new dt,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[tt].add([ot(()=>Bn(this.screenLocationEnabled?this.view:null,i=>[i.size,i.type==="3d"?i.camera:i.viewpoint]),()=>this.notifyChange("screenLocation")),M(()=>this.screenLocation,(i,n)=>{i!=null&&n!=null&&this.emit("view-change")})])}destroy(){this.view=null,this[tt]=qi(this[tt])}get screenLocation(){var s;const{location:e,view:i,screenLocationEnabled:n}=this;return n&&e!=null&&i!=null&&i.ready?(s=i.toScreen)==null?void 0:s.call(i,e):null}};dn=tt,a([d()],ge.prototype,"location",void 0),a([d()],ge.prototype,"screenLocation",null),a([d()],ge.prototype,"screenLocationEnabled",void 0),a([d()],ge.prototype,"view",void 0),ge=a([L("esri.widgets.support.AnchorElementViewModel")],ge);const cn=ge,Uo="esri.widgets.CompassViewModel";let it=class extends cn{constructor(e){super(e),this.visible=!1}};a([d()],it.prototype,"visible",void 0),it=a([L(Uo)],it);const un=it,xt="esri-spinner",Tt={base:xt,spinnerStart:`${xt}--start`,spinnerFinish:`${xt}--finish`};let _e=class extends Z{constructor(e,i){super(e,i),this._animationDelay=500,this._animationPromise=null,this.viewModel=new un}initialize(){this.addHandles(M(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:i,promise:n}=e??{};i&&(this.viewModel.location=i),this.visible=!0;const s=()=>this.hide();n&&n.catch(()=>{}).then(s)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:i}=this.viewModel,n=!!i,s=e&&n,o=!e&&n,r={[Tt.spinnerStart]:s,[Tt.spinnerFinish]:o},l=this._getPositionStyles();return u("div",{class:this.classes(Tt.base,r),styles:l})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const i=zi(this._animationDelay);this._animationPromise=i,i.catch(()=>{}).then(()=>{this._animationPromise===i&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:i}=this.viewModel;if(i==null||e==null)return{};const{padding:n}=i;return{left:e.x-n.left+"px",top:e.y-n.top+"px"}}};a([d()],_e.prototype,"location",null),a([d()],_e.prototype,"view",null),a([d({type:un})],_e.prototype,"viewModel",void 0),a([d()],_e.prototype,"visible",null),_e=a([L("esri.widgets.Spinner")],_e);const jo=_e,ht={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},we=new Ge({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:ht.iconZoom}),Ai=new Ge({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:ht.iconTrash}),Pe=new Ge({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:ht.iconZoom}),Re=new Ge({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:ht.iconBrowseClusteredFeatures}),Ho="esri.widgets.Popup.PopupViewModel",lt=G.getLogger(Ho),Qo=t=>{const{event:e,view:i,viewModel:n}=t,{action:s}=e;if(!s)return Promise.reject(new E("trigger-action:missing-arguments","Event has no action"));const{disabled:o,id:r}=s;if(!r)return Promise.reject(new E("trigger-action:invalid-action","action.id is missing"));if(o)return Promise.reject(new E("trigger-action:invalid-action","Action is disabled"));if(r===we.id)return Ko(n).catch(qn);if(r===Pe.id)return Yo(n);if(r===Re.id)return n.featureMenuOpen=!n.featureMenuOpen,n.browseClusterEnabled=!n.browseClusterEnabled,Promise.resolve();if(n.browseClusterEnabled=!1,r===Ai.id){n.visible=!1;const{selectedFeature:l}=n;if(!l)return Promise.reject(new E(`trigger-action:${Ai.id}`,"selectedFeature is required",{selectedFeature:l}));const{sourceLayer:c}=l;return c?c.remove(l):i==null||i.graphics.remove(l),Promise.resolve()}return Promise.resolve()};function hn(t){const{selectedFeature:e,location:i,view:n}=t;return n?n.type==="3d"?e??i??null:t.get("selectedFeature.geometry")||i:null}function ye(t){var e,i;return!!t&&t.isAggregate&&((i=(e=t.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:i.type)==="cluster"}async function Go(t,e){if((e==null?void 0:e.type)!=="3d"||!t||t.declaredClass!=="esri.Graphic")return!0;const i=e.getViewForGraphic(t);if(i&&"whenGraphicBounds"in i){let n;try{n=await i.whenGraphicBounds(t,{useViewElevation:!0})}catch{}return!n||!n.boundingBox||n.boundingBox[0]===n.boundingBox[3]&&n.boundingBox[1]===n.boundingBox[4]&&n.boundingBox[2]===n.boundingBox[5]}return!0}async function Ko(t){var p;const{location:e,selectedFeature:i,view:n,zoomFactor:s}=t,o=hn(t);if(!n||!o){const m=new E("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:o,view:n});throw lt.error(m),m}const r=n.scale/s,l=(p=t.selectedFeature)==null?void 0:p.geometry,c=l??e,h=c!=null&&c.type==="point"&&await Go(i,n);we.active=!0,we.disabled=!0;try{await t.zoomTo({target:{target:o,scale:h?r:void 0}})}catch{const _=new E("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});lt.error(_)}finally{we.active=!1,we.disabled=!1,t.zoomToLocation=null,h&&(t.location=c)}}async function Yo(t){const{selectedFeature:e,view:i}=t;if((i==null?void 0:i.type)!=="2d"){const r=new E("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw lt.error(r),r}if(!e||!ye(e)){const r=new E("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw lt.error(r),r}const[n,s]=await Xt(i,e);Pe.active=!0,Pe.disabled=!0;const{extent:o}=await n.queryExtent(s);await t.zoomTo({target:o}),Pe.active=!1,Pe.disabled=!1}async function Xo(t){const{view:e,selectedFeature:i}=t;if(!e||!i)return;const[n,s]=await Xt(e,i),{extent:o}=await n.queryExtent(s);t.selectedClusterBoundaryFeature.geometry=o,e.graphics.add(t.selectedClusterBoundaryFeature)}async function Jo(t){const{selectedFeature:e,view:i}=t;if(!i||!e)return;const[n,s]=await Xt(i,e);Re.active=!0,Re.disabled=!0;const{features:o}=await n.queryFeatures(s);Re.active=!1,Re.disabled=!1,t==null||t.open({features:[e].concat(o),featureMenuOpen:!0})}async function Xt(t,e){const i=await t.whenLayerView(e.sourceLayer),n=i.createQuery(),s=e.getObjectId();return n.aggregateIds=s!=null?[s]:[],[i,n]}function Zo(t){const e=t.features.filter(i=>ye(i));e.length&&(t.features=e)}function pn(t){var e;if(t==null)return null;switch(t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":case"polyline":return(e=t.extent)==null?void 0:e.center;default:return null}}const b="esri-popup",qe=`${b}__header`,me=`${b}--is-docked`,f={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:b,widget:"esri-widget",main:`${b}__main-container`,loadingContainer:`${b}__loading-container`,isCollapsible:`${b}--is-collapsible`,isCollapsed:`${b}--is-collapsed`,shadow:`${b}--shadow`,isDocked:me,isDockedTopLeft:`${me}-top-left`,isDockedTopCenter:`${me}-top-center`,isDockedTopRight:`${me}-top-right`,isDockedBottomLeft:`${me}-bottom-left`,isDockedBottomCenter:`${me}-bottom-center`,isDockedBottomRight:`${me}-bottom-right`,alignTopCenter:`${b}--aligned-top-center`,alignBottomCenter:`${b}--aligned-bottom-center`,alignTopLeft:`${b}--aligned-top-left`,alignBottomLeft:`${b}--aligned-bottom-left`,alignTopRight:`${b}--aligned-top-right`,alignBottomRight:`${b}--aligned-bottom-right`,isFeatureMenuOpen:`${b}--feature-menu-open`,isActionsMenuOpen:`${b}--actions-menu-open`,hasFeatureUpdated:`${b}--feature-updated`,header:qe,headerButtons:`${qe}-buttons`,headerContainer:`${qe}-container`,headerContainerButton:`${qe}-container--button`,headerTitle:`${qe}-title`,content:`${b}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${b}__footer`,footerHasPagination:`${b}__footer--has-pagination`,footerHasActions:`${b}__footer--has-actions`,footerHasActionsMenu:`${b}__footer--has-actions-menu`,button:`${b}__button`,buttonDisabled:`${b}__button--disabled`,buttonDock:`${b}__button--dock`,icon:`${b}__icon`,iconDock:`${b}__icon--dock-icon`,inlineActionsContainer:`${b}__inline-actions-container`,actionsMenuButton:`${b}__actions-menu-button`,actions:`${b}__actions`,action:`${b}__action`,actionImage:`${b}__action-image`,actionText:`${b}__action-text`,actionToggle:`${b}__action-toggle`,actionToggleOn:`${b}__action-toggle--on`,actionExit:`${b}__action--exit`,actionSelectFeature:`${b}__action--select-feature`,pointer:`${b}__pointer`,pointerDirection:`${b}__pointer-direction`,navigation:`${b}__navigation`,paginationPrevious:`${b}__pagination-previous`,paginationNext:`${b}__pagination-next`,paginationPreviousIconLTR:`${b}__pagination-previous-icon`,paginationPreviousIconRTL:`${b}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${b}__pagination-next-icon`,paginationNextIconRTL:`${b}__pagination-next-icon--rtl`,featureMenu:`${b}__feature-menu`,featureMenuList:`${b}__feature-menu-list`,featureMenuItem:`${b}__feature-menu-item`,featureMenuViewport:`${b}__feature-menu-viewport`,featureMenuHeader:`${b}__feature-menu-header`,featureMenuNote:`${b}__feature-menu-note`,featureMenuSelected:`${b}__feature-menu-item--selected`,featureMenuButton:`${b}__feature-menu-button`,featureMenuTitle:`${b}__feature-menu-title`,featureMenuObserver:`${b}__feature-menu-observer`,featureMenuLoader:`${b}__feature-menu-loader`,collapseButton:`${b}__collapse-button`,collapseIcon:`${b}__collapse-icon`},er="OBJECTID";var Ie;(function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"})(Ie||(Ie={}));const $i=Wi("android");Wi("chrome")||$i&&$i>=4;zn();Ie.size;Ie.maxSize;Ie.maxOutlineSize;Ie.lineWidth;Ie.tallSymbolWidth;function fn(t){return t&&"opacity"in t?t.opacity*fn(t.parent):1}async function tr(t,e){if(!t)return;const i=t.sourceLayer,n=(e!=null&&e.useSourceLayer?i:t.layer)??i,s=fn(n);if(t.symbol!=null&&(e==null||e.ignoreGraphicSymbol!==!0)){const F=t.symbol.type==="web-style"?await ts(t.symbol,{...e,cache:e!=null?e.webStyleCache:null}):t.symbol.clone();return mt(F,null,s),F}const o=(e!=null?e.renderer:null)??(n&&"renderer"in n?n.renderer:null);let r=o&&"getSymbolAsync"in o?await o.getSymbolAsync(t,e):null;if(!r)return;if(r=r.type==="web-style"?await r.fetchSymbol({...e,cache:e!=null?e.webStyleCache:null}):r.clone(),!(o&&"visualVariables"in o&&o.visualVariables&&o.visualVariables.length))return mt(r,null,s),r;if("arcadeRequiredForVisualVariables"in o&&o.arcadeRequiredForVisualVariables&&(e==null||e.arcade==null)){const F={...e};F.arcade=await Oi(),e=F}const l=await w(()=>import("./SizeVariable-8d9a35e0.js").then(F=>F.v),["assets/SizeVariable-8d9a35e0.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/colorRamps-51949912.js","assets/LegendOptions-1287e8f6.js","assets/sizeVariableUtils-d4870b0d.js","assets/lengthUtils-f797b468.js"]),c=[],h=[],p=[],m=[];for(const F of o.visualVariables)switch(F.type){case"color":c.push(F);break;case"opacity":h.push(F);break;case"rotation":m.push(F);break;case"size":F.target||p.push(F)}const _=!!c.length&&c[c.length-1],y=_?l.getColor(_,t,e):null,I=!!h.length&&h[h.length-1];let C=I?l.getOpacity(I,t,e):null;if(s!=null&&(C=C!=null?C*s:s),mt(r,y,C),p.length){const F=l.getAllSizes(p,t,e);await is(r,F)}for(const F of m)ns(r,l.getRotationAngle(F,t,e),F.axis);return r}function Ei(t){return t&&typeof t.highlight=="function"}const je=he.ofType({key:"type",defaultKeyValue:"button",base:Wn,typeMap:{button:Ge,toggle:Un}}),ir=()=>[we.clone()],nr=()=>[Pe.clone(),Re.clone()];let A=class extends jn(cn){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new dt,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new je,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new De({symbol:new Hn({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([this.on("view-change",()=>this._autoClose()),M(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),M(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),M(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.animation)==null?void 0:i.state},e=>this._animationStateChange(e)),M(()=>this.location,e=>this._locationChange(e)),M(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),M(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),M(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),M(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>Qo({event:e,viewModel:this,view:this.view})),ot(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Qn),M(()=>{var e,i;return[this.features,(e=this.view)==null?void 0:e.map,(i=this.view)==null?void 0:i.spatialReference]},()=>this._updateFeatureVMs()),M(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),ot(()=>!this.visible,()=>this.browseClusterEnabled=!1),M(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new je;e.removeAll();const{actions:i,defaultActions:n,defaultPopupTemplateEnabled:s,includeDefaultActions:o,selectedFeature:r}=this,l=o?n.concat(i):i,c=r&&(typeof r.getEffectivePopupTemplate=="function"&&r.getEffectivePopupTemplate(s)||r.popupTemplate),h=c&&c.actions,p=c&&c.overwriteActions?h:h?h.concat(l):l;return p&&p.filter(Boolean).forEach(m=>e.add(m)),e}get defaultActions(){const e=this._get("defaultActions")||new je;return e.removeAll(),e.addMany(ye(this.selectedFeature)?nr():ir()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const i=e||[];this._set("features",i);const{pendingPromisesCount:n,promiseCount:s,selectedFeatureIndex:o}=this,r=s&&i.length;r&&n&&o===-1?this.selectedFeatureIndex=0:r&&o!==-1||(this.selectedFeatureIndex=i.length?0:-1)}get location(){return this._get("location")||null}set location(e){var s,o,r;let i=e;const n=(o=(s=this.view)==null?void 0:s.spatialReference)==null?void 0:o.isWebMercator;e&&((r=e==null?void 0:e.spatialReference)!=null&&r.isWGS84)&&n&&(i=Gn(e)),this._set("location",i)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(i=>{this._pendingPromises.add(i);const n=o=>{this._pendingPromises.has(i)&&this._updateFeatures(o),this._updatePendingPromises(i)},s=()=>this._updatePendingPromises(i);i.then(n,s)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:i}=this;return i===-1?null:e[i]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:i}=this;e=isNaN(e)||e<-1||!i?-1:(e+i)%i,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,i=hn(this);return i&&e?this.callGoTo({target:{target:i,scale:e.scale}}):Promise.reject(new E("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:i,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,i){const{view:n}=this;if(!n||!e)throw new E("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:n});return n.fetchPopupFeatures(e,{event:i&&i.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:i&&i.signal})}open(e){const i={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:n}=i;delete i.fetchFeatures,n&&this._setFetchFeaturesPromises(i.location);const s=["actionsMenuOpen","collapsed"];for(const o of s)delete i[o];this.set(i)}triggerAction(e){const i=this.allActions.getItemAt(e);i&&!i.disabled&&this.emit("trigger-action",{action:i})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){Zo(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:i}=this;(e==null?void 0:e.type)==="2d"?ye(i)?(await Xo(this),await Jo(this)):G.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",i):G.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",i)}handleViewClick(e){this.autoOpenEnabled&&this._fetchFeaturesAndOpen(e)}_animationStateChange(e){this.zoomToLocation||(we.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var i;const e=(i=this.view)==null?void 0:i.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(ye(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:i,updateLocationEnabled:n}=this;n&&e&&(!i||i.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:i,featurePage:n,featuresPerPage:s,featureViewModels:o}=this;if(n===null)return;const r=((n-1)*s+i)%i,l=r+s;o.slice(r,l).forEach((c,h)=>{c&&!c.graphic&&(c.graphic=e[r+h])})}async _selectedFeatureChange(e){const{location:i,updateLocationEnabled:n,view:s}=this;if(e&&s){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(s.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),ye(e)?void 0:(e.symbol=await tr(e),this._selectedClusterFeature=e,void s.graphics.add(this._selectedClusterFeature));!n&&i||!e.geometry?n&&!e.geometry&&this.centerAtLocation().then(()=>{var r;const o=(r=s.center)==null?void 0:r.clone();o&&(this.location=o)}):this.location=pn(e.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(i=>{const{clientOnlyGraphics:n,promisesPerLayerView:s}=i,o=Promise.resolve(n),r=s.map(l=>l.promise);this.promises=[o,...r]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:i,featureViewModels:n}=this;if(ye(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!i||!i.length)return;const s=n.slice(0),o=[];i.forEach((r,l)=>{var h,p;if(!r)return;let c=null;if(s.some((m,_)=>(m&&m.graphic===r&&(c=m,s.splice(_,1)),!!c)),c)o[l]=c;else{const m=new Yt({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(h=this.view)==null?void 0:h.spatialReference,graphic:r===e?r:null,map:(p=this.view)==null?void 0:p.map,view:this.view});o[l]=m}}),s.forEach(r=>r&&!r.destroyed&&r.destroy()),this._set("featureViewModels",o)}_getScreenPoint(e){const{view:i}=this;return i&&e&&typeof i.toScreen=="function"?i.toScreen(e):null}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,i){this._cancelFetchingFeatures();const n=new AbortController,{signal:s}=n;this._fetchFeaturesController=n,this.notifyChange("waitingForResult");const o=this.fetchFeatures(e,{signal:s,event:i});return o.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),o}_fetchFeaturesAndOpen(e){const{screenPoint:i,mapPoint:n}=e,{view:s}=this;this._fetchFeaturesWithController(i,e).then(o=>{const{clientOnlyGraphics:r,promisesPerLayerView:l,location:c}=o,h=[Promise.resolve(r),...l.map(p=>p.promise)];return s!=null&&s.popup&&"open"in s.popup&&s.popup.open({location:c||n,promises:h}),o})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,i){return await e.when(),e.whenLayerView(i)}_getHighlightLayer(e){const{layer:i,sourceLayer:n}=e;return n&&"layer"in n&&n.layer?n.layer:(n==null?void 0:n.type)==="map-notes"||(n==null?void 0:n.type)==="subtype-group"?n:i}_getHighlightTarget(e,i){const n=i.type==="imagery"?void 0:"objectIdField"in i?i.objectIdField||er:null,s=e.attributes;return s&&n&&s[n]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:i,view:n,activeFeature:s,visible:o}=this;if(!(s&&n&&i&&o))return;const r=this._getHighlightLayer(s);if(!(r&&r instanceof Zt))return;const l=this._getLayerView(n,r);this._highlightActiveFeaturePromise=l;const c=await l;if(!(c&&Ei(c)&&this._highlightActiveFeaturePromise===l&&this.activeFeature&&this.highlightEnabled))return;const h=c.highlight(this._getHighlightTarget(s,r));this._handles.add(h,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:i,highlightEnabled:n,view:s,visible:o}=this;if(!(i&&s&&n&&o))return;const r=this._getHighlightLayer(i);if(!(r&&r instanceof Zt))return;const l=this._getLayerView(s,r);this._highlightSelectedFeaturePromise=l;const c=await l;if(!(c&&Ei(c)&&this._highlightSelectedFeaturePromise===l&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const h=c.highlight(this._getHighlightTarget(i,r));this._handles.add(h,e)}_updateFeatures(e){const{features:i}=this;if(!e||!e.length)return;if(!i.length)return void(this.features=e);const n=e.filter(s=>!i.includes(s));this.features=i.concat(n)}};a([d()],A.prototype,"featurePage",void 0),a([d()],A.prototype,"isLoadingFeature",null),a([d({type:je})],A.prototype,"actions",void 0),a([d({readOnly:!0})],A.prototype,"active",null),a([d()],A.prototype,"activeFeature",void 0),a([d({readOnly:!0})],A.prototype,"allActions",null),a([d({type:Boolean})],A.prototype,"defaultPopupTemplateEnabled",void 0),a([d()],A.prototype,"autoCloseEnabled",void 0),a([d()],A.prototype,"autoOpenEnabled",void 0),a([d()],A.prototype,"browseClusterEnabled",void 0),a([d()],A.prototype,"content",void 0),a([d({type:je,readOnly:!0})],A.prototype,"defaultActions",null),a([d({readOnly:!0})],A.prototype,"featureCount",null),a([d()],A.prototype,"features",null),a([d()],A.prototype,"featuresPerPage",void 0),a([d()],A.prototype,"featureMenuOpen",void 0),a([d()],A.prototype,"featureViewModelAbilities",void 0),a([d({readOnly:!0})],A.prototype,"featureViewModels",void 0),a([d()],A.prototype,"highlightEnabled",void 0),a([d()],A.prototype,"includeDefaultActions",void 0),a([d({type:Kn})],A.prototype,"location",null),a([d({readOnly:!0})],A.prototype,"pendingPromisesCount",null),a([d({readOnly:!0})],A.prototype,"selectedClusterBoundaryFeature",void 0),a([d({readOnly:!0})],A.prototype,"waitingForResult",null),a([d({readOnly:!0})],A.prototype,"promiseCount",null),a([d()],A.prototype,"promises",null),a([d({value:null,readOnly:!0})],A.prototype,"selectedFeature",null),a([d({value:-1})],A.prototype,"selectedFeatureIndex",null),a([d({readOnly:!0})],A.prototype,"selectedFeatureViewModel",null),a([d({readOnly:!0})],A.prototype,"state",null),a([d()],A.prototype,"title",void 0),a([d()],A.prototype,"updateLocationEnabled",void 0),a([d()],A.prototype,"view",void 0),a([d()],A.prototype,"visible",void 0),a([d()],A.prototype,"zoomFactor",void 0),a([d()],A.prototype,"zoomToLocation",void 0),a([d()],A.prototype,"centerAtLocation",null),A=a([L("esri.widgets.Popup.PopupViewModel")],A);const mn=A,xi="selected-index",sr=0,Ti="popup-spinner",ki={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Li="esri-popup";function ne(t,e){return e===void 0?`${Li}__${t}`:`${Li}__${t}-${e}`}const Pi={closeButton:!0,featureNavigation:!0};let v=class extends ln(Z){constructor(t,e){super(t,e),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new dt,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([i])=>{i!=null&&i.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=Oe(()=>this._displaySpinner(),sr),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new he,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new mn,this.visibleElements={...Pi},this._handleOpenRelatedFeature=i=>{this._openRelatedFeature(i)},this._addSelectedFeatureIndexHandle(),this.addHandles([M(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),M(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),M(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,n)=>{!!i!=!!n&&this.reposition()}),M(()=>{var i,n,s,o,r,l;return[(n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.padding,(o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.size,(r=this.viewModel)==null?void 0:r.active,(l=this.viewModel)==null?void 0:l.location,this.alignment]},()=>this.reposition()),M(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),M(()=>{var i,n;return(n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.size},(i,n)=>this._updateDockEnabledForViewSize(i,n)),M(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,n)=>this._viewChange(i,n)),M(()=>{var i,n;return(n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.ready},(i,n)=>this._viewReadyChange(i??!1,n??!1)),M(()=>{var i,n;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(n=this.viewModel)==null?void 0:n.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),M(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),M(()=>{var i,n,s,o;return[(n=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:n.title,(o=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:o.state]},()=>this._setTitleFromFeatureWidget()),M(()=>{var i,n,s,o;return[(n=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:n.content,(o=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:o.state]},()=>this._setContentFromFeatureWidget()),ot(()=>!this.collapsed,()=>{var i,n;((n=(i=this.viewModel)==null?void 0:i.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),pe(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),M(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),D),M(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop()),pe(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),M(()=>{var i,n,s,o;return[(n=(i=this._activeFlowItemWidget)==null?void 0:i.viewModel)==null?void 0:n.state,(o=(s=this._activeFlowItemWidget)==null?void 0:s.viewModel)==null?void 0:o.title]},()=>this.scheduleRender())])}loadDependencies(){return Qe({action:()=>w(()=>import("./calcite-action-a4b90df3.js"),["assets/calcite-action-a4b90df3.js","assets/action-d5f77e08.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/guid-a49a37f8.js","assets/loader-205e7e2d.js","assets/t9n-0db3c134.js","assets/observers-962e5802.js","assets/icon-f89dba00.js"]),flow:()=>w(()=>import("./calcite-flow-98e0d18d.js"),["assets/calcite-flow-98e0d18d.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/observers-962e5802.js"]),"flow-item":()=>w(()=>import("./calcite-flow-item-3860192b.js"),["assets/calcite-flow-item-3860192b.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/loader-205e7e2d.js","assets/guid-a49a37f8.js","assets/t9n-0db3c134.js","assets/observers-962e5802.js","assets/action-d5f77e08.js","assets/icon-f89dba00.js","assets/tooltip-d3a8a25b.js","assets/debounce-222042af.js","assets/scrim-60feed88.js"]),icon:()=>w(()=>import("./calcite-icon-5e4985c8.js"),["assets/calcite-icon-5e4985c8.js","assets/icon-f89dba00.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/observers-962e5802.js"]),tooltip:()=>w(()=>import("./calcite-tooltip-47dad20a.js"),["assets/calcite-tooltip-47dad20a.js","assets/tooltip-d3a8a25b.js","assets/index-298039cc.js","assets/index-001d3307.css","assets/debounce-222042af.js","assets/guid-a49a37f8.js"])})}destroy(){var t,e;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(t=this._handles)==null||t.destroy(),this._unobserveFeatureMenuObserver(),(e=this._featureMenuIntersectionObserver)==null||e.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:t,viewModel:e}=this;if(!t)return!!(e!=null&&e.content);const i=t.viewModel;if(i!=null&&i.waitingForContent||(i==null?void 0:i.state)==="error")return!0;const n=i==null?void 0:i.content;return Array.isArray(n)?!!n.length:!!n}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:t}=this;return t.getItemAt(t.length-1)||null}get actions(){return this.viewModel.actions}set actions(t){this.viewModel.actions=t}set actionsMenuOpen(t){this._set("actionsMenuOpen",!!t)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(t){this.viewModel.autoCloseEnabled=t}get autoOpenEnabled(){return ei(G.getLogger(this.declaredClass),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(t){ei(G.getLogger(this.declaredClass),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get content(){return this.viewModel.content}set content(t){this.viewModel.content=t}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||ki}set dockOptions(t){var l,c;const e={...ki},i=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.breakpoints,n={};i&&(n.width=i.xsmall,n.height=i.xsmall);const s={...e,...t},o={...e.breakpoint,...n},{breakpoint:r}=s;typeof r=="object"?s.breakpoint={...o,...r}:r&&(s.breakpoint=o),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(t){this.viewModel.featureMenuOpen=t}get features(){return this.viewModel.features}set features(t){this.viewModel.features=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(t){this.viewModel.highlightEnabled=t}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get promises(){return this.viewModel.promises}set promises(t){this.viewModel.promises=t}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(t){this.viewModel.selectedFeatureIndex=t}get selectedFeatureWidget(){const{_feature:t,visibleElements:e,headingLevel:i,_flowItems:n}=this,{selectedFeatureViewModel:s}=this.viewModel,o={...e,title:!1};return s?(t?(t.viewModel=s,t.visibleElements=o):this._feature=new Wo({flowItems:n,headingLevel:i+1,viewModel:s,visibleElements:o}),this._feature):null}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(t){this.viewModel.updateLocationEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}castVisibleElements(t){return{...Pi,...t}}blur(){const{active:t}=this.viewModel;t||G.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(t,e){return this.viewModel.fetchFeatures(t,e)}focus(){const{active:t}=this.viewModel;t||G.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(t){var s,o;this._handles.remove(xi);const e=!!t&&!!t.featureMenuOpen,i=!!t&&!!t.actionsMenuOpen,n={collapsed:!!t&&!!t.collapsed,actionsMenuOpen:i,featureMenuOpen:e};((o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.widthBreakpoint)==="xsmall"&&(n.collapsed=!0),this.set(n),this.viewModel.open(t),this._shouldFocus(t),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(t){return this.viewModel.triggerAction(t)}render(){var I,C,F,P;const{actionsMenuOpen:t,dockEnabled:e,featureMenuVisible:i,dividedActions:n,currentAlignment:s,currentDockPosition:o}=this,{active:r}=this.viewModel,{menuActions:l}=n,c=r&&l.length>1&&t,h=r&&e,p=r&&!e,m=(C=(I=this.selectedFeature)==null?void 0:I.layer)==null?void 0:C.title,_=(P=(F=this.selectedFeature)==null?void 0:F.layer)==null?void 0:P.id,y={[f.alignTopCenter]:s==="top-center",[f.alignBottomCenter]:s==="bottom-center",[f.alignTopLeft]:s==="top-left",[f.alignBottomLeft]:s==="bottom-left",[f.alignTopRight]:s==="top-right",[f.alignBottomRight]:s==="bottom-right",[f.isDocked]:h,[f.shadow]:p,[f.isDockedTopLeft]:o==="top-left",[f.isDockedTopCenter]:o==="top-center",[f.isDockedTopRight]:o==="top-right",[f.isDockedBottomLeft]:o==="bottom-left",[f.isDockedBottomCenter]:o==="bottom-center",[f.isDockedBottomRight]:o==="bottom-right",[f.isFeatureMenuOpen]:i,[f.isActionsMenuOpen]:c};return u("div",{class:this.classes(f.base,y),role:"presentation","data-layer-title":m,"data-layer-id":_,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},r?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return u("span",{"aria-hidden":"true",class:this.classes(f.icon,f.iconLoading,f.rotating)})}renderNavigationLoading(){const{messagesCommon:t}=this;return this.viewModel.pendingPromisesCount?u("div",{key:ne("loading-container"),role:"presentation",class:f.loadingContainer,"aria-label":t.loading,title:t.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const t=oe(this.container),e={[f.iconRightTriangleArrow]:t,[f.paginationPreviousIconRTL]:t,[f.iconLeftTriangleArrow]:!t,[f.paginationPreviousIconLTR]:!t};return u("span",{"aria-hidden":"true",class:this.classes(f.icon,e)})}renderPreviousButton(){const{messages:t}=this;return u("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(f.button,f.paginationPrevious),"aria-label":t.previous,title:t.previous},this.renderPreviousIcon())}renderNextIcon(){const t=oe(this.container),e={[f.iconLeftTriangleArrow]:t,[f.paginationNextIconRTL]:t,[f.iconRightTriangleArrow]:!t,[f.paginationNextIconLTR]:!t};return u("span",{"aria-hidden":"true",class:this.classes(f.icon,e)})}renderNextButton(){const{messages:t}=this;return u("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(f.button,f.paginationNext),"aria-label":t.next,title:t.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:t,featureMenuId:e,messagesCommon:i}=this,{featureCount:n,selectedFeatureIndex:s}=this.viewModel;return u("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(f.button,f.featureMenuButton),"aria-haspopup":"true","aria-controls":e,"aria-expanded":t.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(n,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:t}=this,e=this._wouldDockTo(),i={[f.iconUndock]:t,[f.iconDock]:!t,[f.iconDockToRight]:!t&&(e==="top-right"||e==="bottom-right"),[f.iconDockToLeft]:!t&&(e==="top-left"||e==="bottom-left"),[f.iconDockToTop]:!t&&e==="top-center",[f.iconDockToBottom]:!t&&e==="bottom-center"};return u("span",{"aria-hidden":"true",class:this.classes(i,f.icon)})}renderDockButton(){var s,o,r;const{dockEnabled:t,messages:e}=this,i=(o=(s=this.viewModel)==null?void 0:s.view)==null?void 0:o.widthBreakpoint,n=t?e.undock:e.dock;return i!=="xsmall"&&((r=this.dockOptions)!=null&&r.buttonEnabled)?u("div",{role:"button","aria-label":n,title:n,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(f.button,f.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:t}=this.viewModel,{titleId:e,collapsible:i,contentCollapsed:n,messagesCommon:s}=this,o={[f.headerContainerButton]:i},r=u(Ht,{level:this.headingLevel,class:f.headerTitle,innerHTML:t??""}),l=i?u("button",{key:`${t}--collapsible`,id:e,title:n?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(f.headerContainer,o),"aria-expanded":n?"false":"true",onclick:this._toggleCollapsed,type:"button"},r,u("calcite-icon",{class:f.collapseIcon,key:"collapse-icon",icon:n?"chevron-down":"chevron-up",scale:"m"})):u("div",{key:t??"title",id:e,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(f.headerContainer,o)},r);return t?l:null}renderCloseIcon(){return u("span",{"aria-hidden":"true",class:this.classes(f.icon,f.iconClose)})}renderCloseButton(){const{visibleElements:t,messagesCommon:e}=this;return t.closeButton?u("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:f.button,"aria-label":e.close,title:e.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return u("header",{class:f.header},this.renderTitle(),u("div",{class:f.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:t,hasContent:e,contentCollapsed:i,_flowItems:n}=this,{content:s}=this.viewModel,o=n.toArray(),r={[f.contentHasFlows]:!!o.length};return e&&!i?u("div",{key:s??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:t,class:this.classes(f.content,r)},u("calcite-flow",{bind:this},u("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:st,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),o.map(l=>this.renderFlowItem(l))),o.map(l=>this.renderFlowItemTooltips(l))):null}renderFlowItem(t){const{messages:e}=this,i=Lt(),n="graphic"in t&&!t.isTable;return u("calcite-flow-item",{bind:this,class:this.classes({[f.calciteThemeDark]:!i,[f.calciteThemeLight]:i}),heading:t.title??"",description:this._getFlowItemDescription(t),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${t.viewModel.uid}`},u("calcite-action",{class:f.actionExit,icon:"move-up",label:e==null?void 0:e.exitRelatedRecords,text:e==null?void 0:e.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:s=>this._storeExitRelatedRecordsAction(t,s),onclick:this._destroyFlowItemWidgets}),n?u("calcite-action",{class:f.actionSelectFeature,icon:"zoom-to-object",label:e==null?void 0:e.selectFeature,text:e==null?void 0:e.selectFeature,slot:"header-actions-end",bind:this,afterCreate:s=>this._storeFeatureSelectionAction(t,s),onclick:()=>this._handleOpenRelatedFeature(t)}):null,u("div",{class:this.classes(f.contentFlowItem,{[f.calciteThemeDark]:i,[f.calciteThemeLight]:!i})},t.render()))}renderFlowItemTooltips(t){const{messages:e,_exitRelatedRecordsActions:i,_featureSelectionActions:n}=this,s=Lt(),o=n.get(t);return[u("calcite-tooltip",{class:this.classes({[f.calciteThemeDark]:!s,[f.calciteThemeLight]:s}),key:`exit-related-records-tooltip-${t.viewModel.uid}`,label:e==null?void 0:e.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:i.get(t),placement:"top"},e==null?void 0:e.exitRelatedRecords),o?u("calcite-tooltip",{class:this.classes({[f.calciteThemeDark]:!s,[f.calciteThemeLight]:s}),key:`select-related-record-tooltip-${t.viewModel.uid}`,label:e==null?void 0:e.selectFeature,overlayPositioning:"fixed",referenceElement:o,placement:"top"},e==null?void 0:e.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:t,actionsMenuButtonId:e,actionsMenuOpen:i,dividedActions:n,messagesCommon:s}=this,o=i?s.close:s.open,{menuActions:r}=n;return r.length?u("div",{key:ne("actions-menu-button"),class:this.classes(f.button,f.actionsMenuButton),role:"button",id:e,"aria-haspopup":"true","aria-controls":i?t:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},u("span",{"aria-hidden":"true",class:f.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:t,actionsMenuButtonId:e,actionsMenuOpen:i,dividedActions:n}=this,{menuActions:s}=n;return s.length&&i?u("ul",{id:t,role:"menu","aria-labelledby":e,key:ne("actions"),class:f.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(o=>this.renderAction({action:o,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:t}=this.dividedActions;return t.length?t.toArray().map(e=>this.renderAction({action:e,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:t,menuActions:e}=this.dividedActions,i=!!t.length,n=!!e.length;return i||n?u("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":n.toString(),class:f.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?u("section",{key:ne("navigation"),class:this.classes(f.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:t,dividedActions:e}=this,{inlineActions:i,menuActions:n}=e,s=!!i.length,o=!!n.length,r={[f.footerHasPagination]:t,[f.footerHasActions]:s,[f.footerHasActionsMenu]:o};return t||s?u("div",{key:ne("feature-buttons"),class:this.classes(f.footer,r)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:t}=this,{featureViewModels:e,isLoadingFeature:i}=this.viewModel,n=J(t.selectedFeatures,{total:e.length});return u("section",{key:ne("menu"),class:f.featureMenu},u("strong",{class:f.featureMenuHeader},n),u("nav",{bind:this,class:f.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:st},this.renderFeatureMenu(),u("div",{class:f.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?u("div",{class:f.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:u("div",{key:ne("pointer"),class:f.pointer,role:"presentation"},u("div",{class:this.classes(f.pointerDirection,f.shadow)}))}renderMainContainer(){const{dockEnabled:t,currentAlignment:e,currentDockPosition:i,titleId:n,contentId:s,collapsible:o,hasContent:r,contentCollapsed:l,visibleElements:c}=this,{title:h}=this.viewModel,p=e==="bottom-left"||e==="bottom-center"||e==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",m=e==="top-left"||e==="top-center"||e==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",_={[f.shadow]:t,[f.isCollapsible]:o,[f.isCollapsed]:l};return u("div",{class:this.classes(f.main,f.widget,_),tabIndex:c.closeButton?void 0:-1,role:"dialog","aria-labelledby":h?n:"","aria-describedby":r&&!l?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),m?this.renderFooter():null,m?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=(e=this.viewModel)==null?void 0:e.content;return t?typeof t=="string"?u("div",{class:k.contentNode,key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(t){return u("span",{key:"text",class:f.actionText},t)}renderActionCalciteIcon(t,e){return u("calcite-icon",{scale:"s",key:`calcite-icon-${e}`,icon:t})}renderActionIcon(t){const e=this._getActionClass(t),i=this._getActionImage(t),n={[f.iconLoading]:t.active,[f.rotating]:t.active,[f.icon]:!!e,[f.actionImage]:!t.active&&!!i};return e&&(n[e]=!t.active),u("span",{key:"icon","aria-hidden":"true",class:this.classes(f.icon,n),styles:this._getIconStyles(i)})}renderAction(t){const{action:e,type:i}=t,n=this._getActionTitle(e),s={[f.action]:e.type!=="toggle",[f.actionToggle]:e.type==="toggle",[f.actionToggleOn]:e.type==="toggle"&&e.value,[f.buttonDisabled]:e.disabled},o=[e.icon&&!e.active?this.renderActionCalciteIcon(e.icon,e.uid):this.renderActionIcon(e),this.renderActionText(n)],r=i==="menu-item"?u("li",{key:e.uid,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes(f.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":e.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o):u("div",{key:e.uid,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes(f.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":e.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return e.visible?r:null}renderFeatureMenuItem(t,e){const{messages:i,messagesCommon:n}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:o}=this.viewModel,r=t===o,l={[f.featureMenuSelected]:r},c=r?u("span",{key:ne(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:f.iconCheckMark}):null,h=u("span",{innerHTML:t.title||n.untitled});return u("li",{role:"menuitem",tabIndex:-1,key:ne(`feature-menu-feature-${s}`),class:this.classes(l,f.featureMenuItem),bind:this,"data-feature-index":e,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},u("span",{class:f.featureMenuTitle},h,c))}renderFeatureMenu(){const{featureMenuId:t}=this,{featureViewModels:e}=this.viewModel;return e.length>1?u("ol",{class:f.featureMenuList,id:t,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},e.filter(i=>!!i.graphic).map((i,n)=>this.renderFeatureMenuItem(i,n))):null}_storeFeatureSelectionAction(t,e){this._featureSelectionActions.set(t,e),this.scheduleRender()}_storeExitRelatedRecordsAction(t,e){this._exitRelatedRecordsActions.set(t,e),this.scheduleRender()}_getFlowItemDescription(t){return"featureCountDescription"in t?t.featureCountDescription:t.viewModel.description??""}async _openRelatedFeature(t){await t.viewModel.updateGeometry();const e=t.graphic,i=e==null?void 0:e.geometry;if(i==null||e==null)return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:i});const n=pn(i);this.open({features:[e],location:n??void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(t=>{"showAllEnabled"in t.viewModel&&(t.viewModel.showAllEnabled=!1),t.viewModel=null,t.destroy()})}_handleBackClick(){const t=this._flowItems.pop();t&&(this._exitRelatedRecordsActions.delete(t),this._featureSelectionActions.delete(t),"showAllEnabled"in t.viewModel&&(t.viewModel.showAllEnabled=!1),t&&(t.viewModel=null,t.destroy()))}_getActionTitle(t){const{messages:e,selectedFeature:i,messagesCommon:n}=this,{id:s}=t,o=i==null?void 0:i.attributes,r=t.title??"",l=s==="zoom-to-feature"?J(r,{messages:e}):s==="remove-selected-feature"?J(r,{messages:n}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?J(r,{messages:e}):t.title;return l&&o?J(l,o):l??""}_getActionClass(t){const{selectedFeature:e}=this,i=e==null?void 0:e.attributes,{className:n,image:s}=t,o=s||n?n:f.iconDefaultAction;return o&&i?J(o,i):o??""}_getActionImage(t){if(t.active)return"";const{selectedFeature:e}=this,i=e==null?void 0:e.attributes,{image:n}=t;return n&&i?J(n,i):n??""}_createFeatureUpdatedAnimation(){return Yn("enter",f.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:t,featureNavigationVisible:e}=this;if(typeof t!="number")return null;const i=Math.round(t);return Math.max(e?i-1:i,0)}_watchActions(){const{allActions:t}=this.viewModel;this.notifyChange("dividedActions");const e="actions";this._handles.remove(e),t&&t.forEach(i=>{this._handles.add(M(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),e)})}_divideActions(){const{allActions:t}=this.viewModel,e=t.filter(o=>o.visible),i=this._getInlineActionCount(),n=i===null,s=i===0;return{inlineActions:n?e.slice(0):s?new he:e.slice(0,i),menuActions:n?new he:s?e.slice(0):e.slice(i)}}_featureMenuOpenChanged(t){t?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(t){t?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,n;const{selectedFeatureWidget:t,messagesCommon:e}=this;t&&(this.viewModel.title=((i=t.viewModel)==null?void 0:i.state)==="error"?e.errorMessage:((n=t.viewModel)==null?void 0:n.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.content=t)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(t){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(t),this._featureMenuIntersectionObserverNode=t}_handleFeatureMenuKeyup(t){Te(t)==="Escape"&&(t.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(t){Te(t)==="Escape"&&(t.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(t){const{viewModel:e}=this,i=kt(t.currentTarget);e.activeFeature=e.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(t){const e=Te(t),{_featureMenuNode:i}=this,n=kt(t.currentTarget);if(!i)return;const s=i.querySelectorAll("li"),o=s.length;e!=="ArrowUp"?e!=="ArrowDown"?e!=="Home"?e!=="End"||(t.stopPropagation(),s[s.length-1].focus()):(t.stopPropagation(),s[0].focus()):(t.stopPropagation(),s[(n+1+o)%o].focus()):(t.stopPropagation(),s[(n-1+o)%o].focus())}_handleActionMenuItemKeyup(t){const e=Te(t),{_actionsMenuNode:i}=this,n=t.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,o=s.findIndex(c=>c.uid===n);if(!i)return;const r=i.querySelectorAll("li"),l=r.length;e!=="ArrowUp"?e!=="ArrowDown"?e!=="Home"?e!=="End"||(t.stopPropagation(),r[r.length-1].focus()):(t.stopPropagation(),r[0].focus()):(t.stopPropagation(),r[(o+1+l)%l].focus()):(t.stopPropagation(),r[(o-1+l)%l].focus())}_handleMainKeyup(t){const e=Te(t);e==="ArrowLeft"&&(t.stopPropagation(),this.previous()),e==="ArrowRight"&&(t.stopPropagation(),this.next())}_spinnerEnabledChange(t){if(this._destroySpinner(),!t)return;const e=this.get("viewModel.view");this._createSpinner(e)}_hideSpinner(){const{_spinner:t}=this;t&&(t.location=null,t.hide())}_displaySpinner(){const{_spinner:t}=this;if(!t)return;const{location:e,waitingForResult:i}=this.viewModel;i&&e?t.show({location:e}):t.hide()}_getIconStyles(t){return{"background-image":t?`url(${t})`:""}}async _shouldFocus(t){t!=null&&t.shouldFocus&&(await Xn(()=>{var e;return((e=this.viewModel)==null?void 0:e.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const t=M(()=>{var e;return(e=this.viewModel)==null?void 0:e.selectedFeatureIndex},(e,i)=>this._selectedFeatureIndexUpdated(e,i));this._handles.add(t,xi)}_selectedFeatureIndexUpdated(t,e){const{featureCount:i}=this;i&&t!==e&&t!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:t}=this;t&&(t.viewModel=null,t&&!t.destroyed&&t.destroy()),this._feature=null}_isScreenLocationWithinView(t,e){return t.x>-1&&t.y>-1&&t.x<=e.width&&t.y<=e.height}_isOutsideView(t){const{popupHeight:e,popupWidth:i,screenLocation:n,side:s,view:o}=t;if(isNaN(i)||isNaN(e)||!o||!n)return!1;const r=o.padding;return s==="right"&&n.x+i/2>o.width-r.right||s==="left"&&n.x-i/2<r.left||s==="top"&&n.y-e<r.top||s==="bottom"&&n.y+e>o.height-r.bottom}_calculateAutoAlignment(t){if(t!=="auto")return t;const{_pointerOffsetInPx:e,_containerNode:i,_mainContainerNode:n,viewModel:s}=this,{screenLocation:o,view:r}=s;if(o==null||!r||!i)return"top-center";if(!this._isScreenLocationWithinView(o,r))return this._get("currentAlignment")||"top-center";function l(ae){return parseInt(ae.replace(/[^-\d\.]/g,""),10)}const c=n?window.getComputedStyle(n,null):null,h=c?l(c.getPropertyValue("max-height")):0,p=c?l(c.getPropertyValue("height")):0,{height:m,width:_}=i.getBoundingClientRect(),y=_+e,I=Math.max(m,h,p)+e,C=this._isOutsideView({popupHeight:I,popupWidth:y,screenLocation:o,side:"right",view:r}),F=this._isOutsideView({popupHeight:I,popupWidth:y,screenLocation:o,side:"left",view:r}),P=this._isOutsideView({popupHeight:I,popupWidth:y,screenLocation:o,side:"top",view:r}),Q=this._isOutsideView({popupHeight:I,popupWidth:y,screenLocation:o,side:"bottom",view:r});return F?P?"bottom-right":"top-right":C?P?"bottom-left":"top-left":P?Q?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(t){return typeof t=="function"?t.call(this):t}_getCurrentAlignment(){const{alignment:t,dockEnabled:e}=this;return e||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(t)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(t){const e=["left","right"];return oe(this.container)&&e.reverse(),t.replace(/leading/gi,e[0]).replace(/trailing/gi,e[1])}_callDockPosition(t){return typeof t=="function"?t.call(this):t}_getDockPosition(){var t;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((t=this.dockOptions)==null?void 0:t.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(t){var r;if(t!=="auto")return t;const e=(r=this.viewModel)==null?void 0:r.view,i=oe(this.container)?"top-left":"top-right";if(!e)return i;const n=e.padding||{left:0,right:0,top:0,bottom:0},s=e.width-n.left-n.right,{breakpoints:o}=e;return o&&s<=o.xsmall?"bottom-center":i}_positionContainer(t=this._containerNode){if(t&&(this._containerNode=t),!this._containerNode)return;const{screenLocation:e}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),n=this._calculatePositionStyle(e,i);n&&Object.assign(this._containerNode.style,n)}_calculateFullWidth(t){const{currentAlignment:e,_pointerOffsetInPx:i}=this;return e==="top-left"||e==="bottom-left"||e==="top-right"||e==="bottom-right"?t+i:t}_calculateAlignmentPosition(t,e,i,n){const{currentAlignment:s,_pointerOffsetInPx:o}=this;if(!i)return;const{padding:r}=i,l=n/2,c=i.height-e,h=i.width-t;return s==="bottom-center"?{top:e+o-r.top,left:t-l-r.left}:s==="top-left"?{bottom:c+o-r.bottom,right:h+o-r.right}:s==="bottom-left"?{top:e+o-r.top,right:h+o-r.right}:s==="top-right"?{bottom:c+o-r.bottom,left:t+o-r.left}:s==="bottom-right"?{top:e+o-r.top,left:t+o-r.left}:s==="top-center"?{bottom:c+o-r.bottom,left:t-l-r.left}:void 0}_calculatePositionStyle(t,e){const{dockEnabled:i,view:n}=this;if(!n)return;if(i)return{left:"",top:"",right:"",bottom:""};if(t==null||!e)return;const s=this._calculateFullWidth(e),o=this._calculateAlignmentPosition(t.x,t.y,n,s);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(t,e){t&&e&&(this.close(),this.clear())}_viewReadyChange(t,e){if(t){const i=this.get("viewModel.view");this._wireUpView(i)}else e&&(this.close(),this.clear())}_wireUpView(t){if(this._destroySpinner(),!t)return;const{spinnerEnabled:e}=this;e&&this._createSpinner(t),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(t,e,i){const[n,s]=t,[o,r]=e,{width:l=0,height:c=0}=i??{};return n<=l&&o>l||n>l&&o<=l||s<=c&&r>c||s>c&&r<=c}_updateDockEnabledForViewSize(t,e){if(!t||!e)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=i.left+i.right,s=i.top+i.bottom,o=[],r=[];o[0]=t[0]-n,o[1]=t[1]-s,r[0]=e[0]-n,r[1]=e[1]-s;const{dockOptions:l}=this,c=l.breakpoint;this._dockingThresholdCrossed(o,r,c)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(t){this._focusDockButton&&(this._focusDockButton=!1,t.focus())}_closeButtonNodeUpdated(t){return this._focusClose?(this._focusClose=!1,void t.focus()):this._blurClose?(this._blurClose=!1,void t.blur()):void 0}_mainContainerNodeUpdated(t){return this._mainContainerNode=t,this._focusContainer?(this._focusContainer=!1,void t.focus()):this._blurContainer?(this._blurContainer=!1,void t.blur()):void 0}_featureMenuNodeUpdated(t){if(this._featureMenuNode=t,!t||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const e=t.querySelectorAll("li");e.length&&e[0].focus()}_actionsMenuNodeUpdated(t){if(this._actionsMenuNode=t,!t||!this._focusFirstAction)return;this._focusFirstAction=!1;const e=t.querySelectorAll("li");e.length&&e[0].focus()}_focusFeatureMenuButtonNode(t){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,t.focus())}_focusActionsMenuButtonNode(t){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,t.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:t,viewModel:e}=this;if(!e)return;const i=e.active&&!t;e.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(t){var l,c;const e=t.breakpoint,i=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.ui;if(!i)return!1;const{width:n,height:s}=i;if(isNaN(n)||isNaN(s)||!e)return!1;const o=e.hasOwnProperty("width")&&n<=(e.width??0),r=e.hasOwnProperty("height")&&s<=(e.height??0);return o||r}_setDockEnabledForViewSize(t){t.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(t))}_getPageText(t,e){return this.featureNavigationVisible?J(this.messages.pageText,{index:e+1,total:t}):null}_destroySpinner(){const{_spinner:t,view:e}=this;t&&(e&&e.ui&&e.ui.remove(t,Ti),t.destroy(),this._spinner=null)}_createSpinner(t){t&&(this._spinner=new jo({view:t}),t.ui.add(this._spinner,{key:Ti,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const t=!this.featureMenuOpen;this._featureMenuOpenChanged(t),this.actionsMenuOpen=!1,this.featureMenuOpen=t}_toggleActionsMenu(){const t=!this.actionsMenuOpen;this._actionsMenuOpenChanged(t),this.featureMenuOpen=!1,this.actionsMenuOpen=t}_triggerAction(t){const e=t.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,n=i.findIndex(o=>o.uid===e),s=i.getItemAt(n);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(n)}_selectFeature(t){const e=kt(t.currentTarget);e==null||isNaN(e)||(this.viewModel.selectedFeatureIndex=e),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};function kt(t){return t==null?void 0:t["data-feature-index"]}a([d({readOnly:!0})],v.prototype,"actionsMenuId",null),a([d({readOnly:!0})],v.prototype,"actionsMenuButtonId",null),a([d({readOnly:!0})],v.prototype,"featureMenuId",null),a([d({readOnly:!0})],v.prototype,"titleId",null),a([d({readOnly:!0})],v.prototype,"contentId",null),a([d({readOnly:!0})],v.prototype,"hasContent",null),a([d({readOnly:!0})],v.prototype,"featureNavigationVisible",null),a([d({readOnly:!0})],v.prototype,"collapsible",null),a([d({readOnly:!0})],v.prototype,"featureMenuVisible",null),a([d({readOnly:!0})],v.prototype,"contentCollapsed",null),a([d({readOnly:!0})],v.prototype,"dividedActions",null),a([d({readOnly:!0,dependsOn:["_flowItems.length"]})],v.prototype,"_activeFlowItemWidget",null),a([d()],v.prototype,"actions",null),a([d()],v.prototype,"actionsMenuOpen",null),a([d()],v.prototype,"alignment",void 0),a([d()],v.prototype,"autoCloseEnabled",null),a([d()],v.prototype,"autoOpenEnabled",null),a([d()],v.prototype,"defaultPopupTemplateEnabled",null),a([d()],v.prototype,"content",null),a([d()],v.prototype,"collapsed",void 0),a([d()],v.prototype,"collapseEnabled",void 0),a([d({readOnly:!0})],v.prototype,"currentAlignment",null),a([d({readOnly:!0})],v.prototype,"currentDockPosition",null),a([d()],v.prototype,"dockOptions",null),a([d()],v.prototype,"dockEnabled",void 0),a([d({readOnly:!0})],v.prototype,"featureCount",null),a([d()],v.prototype,"featureMenuOpen",null),a([d()],v.prototype,"features",null),a([d()],v.prototype,"goToOverride",null),a([d()],v.prototype,"headingLevel",void 0),a([d()],v.prototype,"highlightEnabled",null),a([d()],v.prototype,"location",null),a([d()],v.prototype,"label",null),a([d()],v.prototype,"maxInlineActions",void 0),a([d(),K("esri/widgets/Popup/t9n/Popup")],v.prototype,"messages",void 0),a([d(),K("esri/t9n/common")],v.prototype,"messagesCommon",void 0),a([d()],v.prototype,"promises",null),a([d({readOnly:!0})],v.prototype,"selectedFeature",null),a([d()],v.prototype,"selectedFeatureIndex",null),a([d({readOnly:!0})],v.prototype,"selectedFeatureWidget",null),a([d()],v.prototype,"spinnerEnabled",void 0),a([d()],v.prototype,"title",null),a([d()],v.prototype,"updateLocationEnabled",null),a([d()],v.prototype,"view",null),a([d({type:mn}),Jn(["triggerAction","trigger-action"])],v.prototype,"viewModel",void 0),a([d()],v.prototype,"visible",null),a([d()],v.prototype,"visibleElements",void 0),a([Fe("visibleElements")],v.prototype,"castVisibleElements",null),a([de()],v.prototype,"_close",null),a([de()],v.prototype,"_toggleDockEnabled",null),a([de()],v.prototype,"_toggleFeatureMenu",null),a([de()],v.prototype,"_toggleActionsMenu",null),a([de()],v.prototype,"_triggerAction",null),a([de()],v.prototype,"_selectFeature",null),a([de()],v.prototype,"_next",null),a([de()],v.prototype,"_previous",null),v=a([L("esri.widgets.Popup")],v);const ja=v;export{ja as default};
