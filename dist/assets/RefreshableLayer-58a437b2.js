import{V as c,fe as d,ae as i,af as o,ai as m,be as p,aN as v,J as g}from"./index-14d2dda4.js";const n=new c,a=new WeakMap;function y(e){l(e)&&n.push(e)}function I(e){l(e)&&n.includes(e)&&n.remove(e)}function l(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function u(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:u(t,e%t):0}let f=0,h=0;function b(){const e=Date.now();for(const t of n)t.refreshInterval&&e-(a.get(t)??0)+5>=6e4*t.refreshInterval&&(a.set(t,e),t.refresh(e))}d(()=>{const e=Date.now();let t=0;for(const r of n)t=u(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?a.get(r)||a.set(r,e):a.delete(r);if(t!==h){if(h=t,clearInterval(f),h===0)return void(f=0);f=setInterval(b,h)}});const w=e=>{let t=class extends e{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=p(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||y(this)},()=>{})}destroy(){I(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){v(this._debounceHasDataChanged()).then(s=>{s&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:s})},s=>{g.getLogger(this.declaredClass).error(s),this.emit("refresh",{dataChanged:!1,error:s})})}async hasDataChanged(){return!0}};return i([o({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),i([o({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),i([o()],t.prototype,"refreshParameters",null),t=i([m("esri.layers.mixins.RefreshableLayer")],t),t};export{w as p};
