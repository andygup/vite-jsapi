(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function h(t,e,r,i){var s,n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function kot(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}const s1e="modulepreload",n1e=function(t){return"/vite-jsapi/dist/"+t},mj={},he=function(e,r,i){if(!r||r.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=n1e(n),n in mj)return;mj[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=s.length-1;u>=0;u--){const d=s[u];if(d.href===n&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":s1e,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())};function o1e(t){return t&&t.release&&typeof t.release=="function"}function a1e(t){return t&&t.acquire&&typeof t.acquire=="function"}let po=class TF{constructor(e,r,i,s=1,n=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let r;if(TF.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):a1e(r)&&r.acquire(...e),r}release(e){e&&!TF.test.disabled&&(this._releaseFunction?this._releaseFunction(e):o1e(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};po.test={disabled:!1};function l1e(t){t.length=0}let wl=class{constructor(e=50,r=50){this._pool=new po(Array,void 0,l1e,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return BD.acquire()}static release(e){return BD.release(e)}static prune(){BD.prune()}};const BD=new wl(100);function Vot(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function c1e(t,e){for(const r of t)if(r!=null&&e(r))return r}function SF(t){return t!=null&&typeof t[Symbol.iterator]=="function"}function fo(t,e){return t!=null?e(t):null}function gl(t,e){return CI(t,e),t}function CI(t,e){if(t==null)throw new Error(e??"value is None")}function Oe(t){return t==null||t.destroy(),null}function Ue(t){return t==null||t.dispose(),null}function bi(t){return t==null||t.remove(),null}function yc(t){return t==null||t.abort(),null}function vi(t){return t==null||t.release(),null}function Got(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function Wx(t){return null}function jot(t,e){const r=new Array;for(const i of t)r.push(i!=null?e(i):null);return r}function Hot(t,e){for(const r of t)fo(r,e)}function Wot(t){return t}let Oi=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(SF(e)){const i=this._getOrCreateGroup(r);for(const s of e)this._isHandle(s)&&i.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&SF(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){e.forEach(r=>r.remove())}};const ste=Symbol("Accessor-beforeDestroy");function Zw(t){return ha(()=>t.forEach(e=>e!=null&&e.remove()))}function ha(t){return{remove:()=>{t&&(t(),t=void 0)}}}function Yot(t){return ha(t!=null?()=>t.destroy():void 0)}let WS=class Yy{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Yy._m}getInt(){return this._seed=(Yy._a*this._seed+Yy._c)%Yy._m,this._seed}getFloat(){return this.getInt()/(Yy._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/Yy._m*i}};WS._m=2147483647,WS._a=48271,WS._c=0;const AI=1.5,u1e=1/AI,h1e=.5;function OI(t,e){return e?t.filter((r,i,s)=>s.findIndex(e.bind(null,r))===i):t.filter((r,i,s)=>s.indexOf(r)===i)}function Kf(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Yz(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function d1e(t,e,r){let i,s;return r?(i=e.filter(n=>!t.some(o=>r(o,n))),s=t.filter(n=>!e.some(o=>r(o,n)))):(i=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:i,removed:s}}function p1e(t){return t&&typeof t.length=="number"}function Xot(t,e){const r=t.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=e)i.push(t.slice(s,s+e));return i}const f1e=!!Array.prototype.fill;function Zot(t,e){if(f1e)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function m1e(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function g1e(t,e,r){const i=t.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return r?e>=t[i-1]?-1:o===e?s:s-1:o===e?s:-1}let nte=class{constructor(){this.last=0}};const ote=new nte;function EF(t,e,r,i){i=i||ote;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(t[o]===e)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(t[o]===e)return i.last=o,o;return-1}function FE(t,e,r,i){const s=r??t.length,n=EF(t,e,s,i);if(n!==-1)return t[n]=t[s-1],r==null&&t.pop(),e}const ju=new Set;function y1e(t,e,r=t.length,i=e.length,s,n){if(i===0||r===0)return r;ju.clear();for(let a=0;a<i;++a)ju.add(e[a]);s=s||ote;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(ju.has(t[a])&&(n&&n.push(t[a]),ju.delete(t[a]),t[a]=t[r-1],--r,--a,ju.size===0||r===0))return ju.clear(),r;for(let a=0;a<o;++a)if(ju.has(t[a])&&(n&&n.push(t[a]),ju.delete(t[a]),t[a]=t[r-1],--r,--a,ju.size===0||r===0))return ju.clear(),r;return ju.clear(),r}function _1e(t,e){let r=0;for(let i=0;i<t.length;++i){const s=t[i];e(s,i)&&(t[r]=s,r++)}t.length=r}function v1e(t){return t?(gj.seed=t,()=>gj.getFloat()):Math.random}function Qot(t,e){const r=v1e(e);for(let i=t.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=t[i];t[i]=t[s],t[s]=n}return t}const gj=new WS;function Xz(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function Kot(t,e){const r=new Map,i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e(n,s,t),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function em(t,e){return t!=null}const b1e=[];let s0;function ie(t){return typeof s0[t]=="function"?s0[t]=s0[t](globalThis):s0[t]}var Zee,Jee,Qee,Kee;s0=(Zee=globalThis.dojoConfig)!=null&&Zee.has||(Jee=globalThis.esriConfig)!=null&&Jee.has?{...(Qee=globalThis.dojoConfig)==null?void 0:Qee.has,...(Kee=globalThis.esriConfig)==null?void 0:Kee.has}:{},ie.add=(t,e,r,i)=>((i||s0[t]===void 0)&&(s0[t]=e),r&&ie(t)),ie.cache=s0,ie.add("esri-deprecation-warnings",!0),ie.add("esri-force-fullscreen-debug",!1),(()=>{var e;ie.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ie.add("host-browser",t),ie.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),ie.add("dom",t),ie("host-browser")){const r=navigator,i=r.userAgent,s=r.appVersion,n=parseFloat(s);if(ie.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),ie.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),ie.add("khtml",s.includes("Konqueror")?n:void 0),ie.add("edge",parseFloat(i.split("Edge/")[1])||void 0),ie.add("opr",parseFloat(i.split("OPR/")[1])||void 0),ie.add("webkit",!ie("wp")&&!ie("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),ie.add("chrome",!ie("edge")&&!ie("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),ie.add("android",!ie("wp")&&parseFloat(i.split("Android ")[1])||void 0),ie.add("safari",!s.includes("Safari")||ie("wp")||ie("chrome")||ie("android")||ie("edge")||ie("opr")?void 0:parseFloat(s.split("Version/")[1])),ie.add("mac",s.includes("Macintosh")),!ie("wp")&&/(iPhone|iPod|iPad)/.test(i)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));ie.add(o,l),ie.add("ios",l)}ie("webkit")||(!i.includes("Gecko")||ie("wp")||ie("khtml")||ie("edge")||ie.add("mozilla",n),ie("mozilla")&&ie.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&ie.add("esri-mobile",e),r&&ie.add("esri-iPhone",r),ie.add("esri-geolocation",!!navigator.geolocation)}ie.add("esri-wasm","WebAssembly"in globalThis),ie.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ie.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ie.add("esri-atomics","Atomics"in globalThis),ie.add("esri-workers","Worker"in globalThis),ie.add("web-feat:cache","caches"in globalThis),ie.add("esri-workers-arraybuffer-transfer",!ie("safari")||Number(ie("safari"))>=12),ie.add("workers-pool-size",8),ie.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ie.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ie.add("featurelayer-animation-enabled",!0),ie.add("featurelayer-snapshot-enabled",!0),ie.add("featurelayer-snapshot-point-min-threshold",8e4),ie.add("featurelayer-snapshot-point-max-threshold",4e5),ie.add("featurelayer-snapshot-point-coverage",.1),ie.add("featurelayer-advanced-symbols",!1),ie.add("featurelayer-pbf",!0),ie.add("featurelayer-pbf-statistics",!1),ie.add("feature-layers-workers",!0),ie.add("feature-polyline-generalization-factor",1),ie.add("mapview-transitions-duration",200),ie.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ie.add("mapserver-pbf-version-support",10.81),ie.add("mapservice-popup-identify-max-tolerance",20),ie.add("heatmap-allow-raster-fallback",!1),ie.add("heatmap-force-raster",!1),ie("host-webworker")||ie("host-browser")&&(ie.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ie.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ie.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ie.add("esri-image-decode",!1,!0,!0)})}return!1}),ie.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function E2(t){return t instanceof ArrayBuffer}function Zz(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function Zg(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function ate(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function Jz(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function RI(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function Qz(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function PI(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function qx(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function Yx(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function Yh(t){return!("buffer"in t)}function ow(t){return t!=null?Yh(t)?8*t.length+12:t.byteLength+145:0}const _c=1024;function w1e(t){return Yx(t)||qx(t)||Qz(t)||Jz(t)||Zz(t)}function x1e(t){return Yx(t)||qx(t)}function T1e(t){return Yx(t)?179769e303:qx(t)?3402823e32:PI(t)?4294967295:RI(t)?65535:Zg(t)||ate(t)?255:Qz(t)?2147483647:Jz(t)?32767:Zz(t)?127:256}function lte(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&lte(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function ye(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=hte(t);if(e!=null)return e;if(sM(t))return t.clone();if(cte(t))return t.map(ye);if(ute(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=ye(t[i]);return r}function CF(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=hte(t);if(e!=null)return e;if(cte(t)){let r=!0;const i=t.map(s=>{const n=CF(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(sM(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!ute(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const s=t[i],n=CF(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function sM(t){return typeof t.clone=="function"}function cte(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function ute(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function yj(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function hte(t){if(Zz(t)||Zg(t)||ate(t)||Jz(t)||RI(t)||Qz(t)||PI(t)||qx(t)||Yx(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,ye(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(ye(r));return e}return null}function Kz(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function dte(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&Kf(t,e):t instanceof Set?e instanceof Set&&E1e(t,e):t instanceof Map?e instanceof Map&&C1e(t,e):!!yj(t)&&yj(e)&&S1e(t,e))}function S1e(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function E1e(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function C1e(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s!==i||s===void 0&&!e.has(r))return!1}return!0}function O0(t){return t.__accessor__??null}function A1e(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function RR(t,e,r){return r?nM(t,e,{policy:r,path:""}):nM(t,e,null)}function nM(t,e,r){return e?Object.keys(e).reduce((i,s)=>{const n=s;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${s}`:s,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=ye(e[n]),i;let l=i[n],c=e[n];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[n]=l.concat():i[n]=[l]:i[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(r){const u=r.path;r.path=o,i[n]=nM(l,c,r),r.path=u}else i[n]=nM(l,c,null);else i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[n]=c);return i},t||{}):t}function pte(t){return Array.isArray(t)?t:t.split(".")}function _j(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function O1e(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(..._j(r));return e}return _j(t)}function fte(t,e,r,i){const s=O1e(e);if(s.length!==1){const n=s.map(o=>i(t,o,r));return Zw(n)}return i(t,s[0],r)}function ek(t){let e=!1;return()=>{e||(e=!0,t())}}function mte(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.getItemAt(s)}const i=O0(e);return A1e(i,r)?i.get(r):e[r]}function gte(t,e,r){if(t==null)return t;const i=mte(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:gte(i,e,r+1)}function VC(t,e,r=0){return typeof e!="string"||e.includes(".")?gte(t,pte(e),r):mte(e,t)}function oM(t,e){return VC(t,e)}function vj(t,e){return VC(e,t)!==void 0}function GC(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=ye(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function MI(t,e){const r=GC(t);let i=r[e];return i||(i=r[e]={}),i}function R1e(t,e){return RR(t,e,M1e)}const P1e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function M1e(t){return P1e.test(t)?"replace":"merge"}function $1e(t,e,r=!1){return _te(t,e,r)}function jC(t,e){if(e!=null)return e[t]||yte(t.split("."),!1,e)}function Xx(t,e,r){const i=t.split("."),s=i.pop(),n=yte(i,!0,r);n&&s&&(n[s]=e)}function yte(t,e,r){let i=r;for(const s of t){if(i==null)return;if(!(s in i)){if(!e)return;i[s]={}}i=i[s]}return i}function _te(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=i[s],o=e[s];return n===o?i:n===void 0?(i[s]=ye(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=_te(n,o,r):i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=o),i)},t||{}):t}const $I="20230503",vte="a9d5c385838c023765bfab0b98aebd3ea4a501c9";var ete;const Er={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(ete=globalThis.location)==null?void 0:ete.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&($1e(Er,globalThis.esriConfig,!0),delete Er.has),!Er.assetsPath){{const t="4.27.0";Er.assetsPath=`https://cdn.jsdelivr.net/npm/@arcgis/core@${t}-next.${$I}/assets`}Er.defaultAssetsPath=Er.assetsPath}const I1e=/\{([^\}]+)\}/g;function bj(t){return t??""}function II(t,e){return t.replaceAll(I1e,typeof e=="object"?(r,i)=>bj(jC(i,e)):(r,i)=>bj(e(i)))}function eat(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function bte(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function tat(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}const wj={info:0,warn:1,error:2,none:3};let ne=class qo{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,qo._loggers[this.module]=this;const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=qo.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const r=qo._loggers;return qo._loggers=e,r},set throttlingDisabled(e){qo._throttlingDisabled=e}}}static getLogger(e){let r=qo._loggers[e];return r||(r=new qo({module:e})),r}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!qo._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[e].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=qo._tickCounter)return;this._loggedMessages[e].set(s,qo._tickCounter),qo._scheduleTickCounterIncrement()}for(const s of Er.log.interceptors)if(s(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const s=i[e];if(s!=null)return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=Er.log.level||"warn";return wj[this._parentWithMember("level",r)]<=wj[e]}_argsToKey(...e){return bte(JSON.stringify(e,(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){qo._tickCounterScheduled||(qo._tickCounterScheduled=!0,Promise.resolve().then(()=>{qo._tickCounter++,qo._tickCounterScheduled=!1}))}};ne._loggers={},ne._tickCounter=0,ne._tickCounterScheduled=!1,ne._throttlingDisabled=!1;var If;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(If||(If={}));let L1e=class{constructor(e,r){this._observers=e,this._observer=r}remove(){Xz(this._observers,this._observer)}},wte=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return D1e;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===e){i=!0;break}}return i||(r.push(e),s&&this._removeDestroyedObservers()),new L1e(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&e[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;e[s]=e[s+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const D1e=ha();var ai;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.USER=6]="USER"})(ai||(ai={}));const sat=ai.USER+1;function xte(t){switch(t){case"defaults":return ai.DEFAULTS;case"service":return ai.SERVICE;case"portal-item":return ai.PORTAL_ITEM;case"web-scene":return ai.WEB_SCENE;case"web-map":return ai.WEB_MAP;case"user":return ai.USER;default:return null}}function AF(t){switch(t){case ai.DEFAULTS:return"defaults";case ai.SERVICE:return"service";case ai.PORTAL_ITEM:return"portal-item";case ai.WEB_SCENE:return"web-scene";case ai.WEB_MAP:return"web-map";case ai.USER:return"user"}return void 0}function N1e(t){return AF(t)}var fi;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(fi||(fi={}));const aM={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},$T=[];let qS=aM;function Zt(t){qS.onObservableAccessed(t)}let PR=!1,MR=!1;function tm(t,e,r){if(PR)return tk(t,e,r);Tte(t);const i=e.call(r);return Ste(),i}function F1e(t,e){return tm(aM,t,e)}function tk(t,e,r){const i=PR;PR=!0,Tte(t);let s=null;try{s=e.call(r)}catch(n){MR&&ne.getLogger("esri.core.accessorSupport.tracking").error(n)}return Ste(),PR=i,s}function Tte(t){qS=t,$T.push(t)}function Ste(){const t=$T.length;if(t>1){const e=$T.pop();qS=$T[t-2],e.onTrackingEnd()}else if(t===1){const e=$T.pop();qS=aM,e.onTrackingEnd()}else qS=aM}function Ete(t,e){const r=e.observerObject;if(r.flags&fi.DepTrackingInitialized)return;const i=MR;MR=!1,r.flags&fi.AutoTracked?tk(e,e.metadata.get,t):Cte(t,e),MR=i}const U1e=[];function Cte(t,e){const r=e.observerObject;r.flags&fi.ExplicitlyTracking||(r.flags|=fi.ExplicitlyTracking,tk(e,()=>{const i=e.metadata.dependsOn||U1e;for(const s of i)if(typeof s!="string"||s.includes(".")){const n=pte(s);for(let o=0,a=t;o<n.length&&a!=null&&typeof a=="object";++o)a=xj(a,n[o],o!==n.length-1)}else xj(t,s,!1)}),r.flags&=~fi.ExplicitlyTracking)}function xj(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.getItemAt(n)}const s=O0(t);if(s){const n=s.propertiesByName.get(i);n&&(Zt(n.observerObject),Ete(t,n))}return r?t[i]:void 0}let Tj=class{constructor(e,r){this.propertyName=e,this.metadata=r,this.observerObject=new z1e,this._accessed=null,this._handles=null,this.observerObject.flags=fi.Dirty|(r.nonNullable?fi.NonNullable:0)|(r.hasOwnProperty("value")?fi.HasDefaultValue:0)|(r.get===void 0?fi.DepTrackingInitialized:0)|(r.dependsOn===void 0?fi.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){const r=this.observerObject;Zt(r);const i=e.store,s=this.propertyName,n=r.flags,o=i.get(s);if(n&fi.Computing||~n&fi.Dirty&&i.has(s))return o;r.flags|=fi.Computing;const a=e.host;let l;n&fi.AutoTracked?l=tm(this,this.metadata.get,a):(Cte(a,this),l=this.metadata.get.call(a)),i.set(s,l,ai.COMPUTED);const c=i.get(s);return c===o?r.flags&=~fi.Dirty:F1e(this.commit,this),r.flags&=~fi.Computing,c}onObservableAccessed(e){if(e===this.observerObject)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=fi.DepTrackingInitialized;const r=this._accessed;if(r==null||r.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let s=0;s<r.length;++s)i.push(r[s].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~fi.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},z1e=class extends wte{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&fi.Overriden&&(this.flags|=fi.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&fi.Dirty&&this.onCommitted(),super.destroy()}},k1e=class Ate{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new Ate;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,ye(i))}),r}get(e){return this._values.get(e)}originOf(){return ai.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function BA(t,e,r){return t!==void 0}function Sj(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&fi.NonNullable)||(i.lifecycle,If.INITIALIZING,!1))}function B1e(t){return t&&typeof t.destroy=="function"}ne.getLogger("esri.core.accessorSupport.Properties");let V1e=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=If.INITIALIZING,this.store=new k1e,this._origin=ai.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new Tj(i,r[i]);this.propertiesByName.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=If.CONSTRUCTING}constructed(){this.lifecycle=If.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&B1e(i)&&(i.destroy(),~r.observerObject.flags&fi.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==If.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);Zt(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.observerObject.flags&fi.HasDefaultValue)return"defaults"}return AF(r)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(BA(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);BA(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const s=this.propertiesByName.get(r);if(!BA(s))return"";const n=new Set,o=tm({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n)l instanceof Tj&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const s=this.propertiesByName.get(e);if(BA(s))return this._setAtOrigin(s,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.observerObject.flags&fi.Overriden)}clearOverride(e){const r=this.propertiesByName.get(e),i=r==null?void 0:r.observerObject;i&&i.flags&fi.Overriden&&(i.flags&=~fi.Overriden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!Sj(i,e,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(VD.release(n),!o)return;r=a}i.observerObject.flags|=fi.Overriden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!Sj(i,e,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(VD.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=xte(e)}getDefaultOrigin(){return AF(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==If.INITIALIZING?this._origin:ai.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const s=this.store,n=e.propertyName;s.has(n,i)&&Kz(r,s.get(n))&&~e.observerObject.flags&fi.Overriden&&i===s.originOf(n)||(e.invalidate(),s.set(n,r,i),e.commit(),Ete(this.host,e))}_cast(e,r){const i=VD.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},G1e=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const VD=new po(G1e);function j1e(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(jC(i,e)??"").toString())}let Ote=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&j1e(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},X=class Rte extends Ote{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return ye(r)}catch{return"[object]"}}))}}catch(e){throw ne.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Rte(e.name,e.message,e.details)}};X.prototype.type="error";function lM(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))lM(t,i,e[i]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(s.length-1,1)[0];return void lM(oM(t,s),n,r)}const i=t.__accessor__;i!=null&&H1e(e,i),t[e]=r}}function H1e(t,e){if(ie("esri-unknown-property-errors")&&!W1e(t,e))throw new X("set:unknown-property",q1e(t,e))}function W1e(t,e){return e.metadatas[t]!=null}function q1e(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let Y1e;function X1e(){return Y1e}let Pte=class extends po{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=Wx(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const VA=[];function Jw(t){VA.push(t),VA.length===1&&queueMicrotask(()=>{const e=VA.slice();VA.length=0;for(const r of e)r()})}let Uf=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var OF;(function(t){const e=(n,o,a,l)=>{let c=o,u=o;const d=a>>>1,p=n[c-1];for(;u<=d;){u=c<<1,u<a&&l(n[u-1],n[u])<0&&++u;const g=n[u-1];if(l(g,p)<=0)break;n[c-1]=g,c=u}n[c-1]=p},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(n,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(n,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l),yield}}t.sort=i,t.iterableSort=s})(OF||(OF={}));const Ej=OF,Z1e=1.5,J1e=1.1;let Nt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new nte,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>Cj(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];e(s)&&r.push(s)}return r}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,Cj(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=EF(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(EF(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=y1e(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){Ej.sort(this.data,0,this.length,e)}iterableSort(e){return Ej.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(e.call(r,s,i))return s}}filterInPlace(e,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)e.call(r,s[n],n,s)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=e.call(r,this.data[s],s,this.data);return i}reduce(e,r){let i=r;for(let s=0;s<this.length;++s)i=e(i,this.data[s],s,this.data);return i}has(e){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===e)return!0;return!1}};function Cj(t){t.data.length>Z1e*t.length&&(t.data.length=Math.floor(t.length*J1e))}function Q1e(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const Qw=Q1e(globalThis);function LI(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function HC(t,e,r){if(!LI(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const s of i)t.addEventListener(s,r);return{remove(){for(const s of i)t.removeEventListener(s,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function Mte(t,e,r){if(!LI(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=HC(t,e,s=>{i.remove(),r.call(t,s)});return{remove(){i.remove()}}}const K1e={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function eve({key:t}){return K1e[t]||t}function wr(t="Aborted"){return new X("AbortError",t)}function qt(t,e="Aborted"){if(Js(t))throw wr(e)}function DI(t){return t!=null?"aborted"in t?t:t.signal:t}function Js(t){const e=DI(t);return e!=null&&e.aborted}function K1(t){if(gs(t))throw t}function Aj(t){if(!gs(t))throw t}function Uo(t,e){const r=DI(t);if(r!=null){if(!r.aborted)return Mte(r,"abort",()=>e());e()}}function rk(t,e){const r=DI(t);if(r!=null)return qt(r),Mte(r,"abort",()=>e(wr()))}function tve(t,e){return DI(e)==null?t:new Promise((r,i)=>{let s=Uo(e,()=>i(wr()));const n=()=>s=bi(s);t.then(n,n),t.then(r,i)})}function gs(t){return(t==null?void 0:t.name)==="AbortError"}async function cM(t){try{return await t}catch(e){if(!gs(e))throw e;return}}async function pat(t,e=ne.getLogger("esri")){try{return await t}catch(r){gs(r)||e.error(r)}}async function X0(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),s=await X0(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,s)=>{const n=r[s];return n.status==="fulfilled"?{promise:i,value:n.value}:{promise:i,error:n.reason}}))}async function RF(t){return(await X0(t)).filter(e=>!!e.value).map(e=>e.value)}function UE(t,e=void 0,r){const i=new AbortController;return Uo(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);Uo(i,()=>{o&&(clearTimeout(o),n(wr()))})})}function Sc(t){return t&&typeof t.then=="function"}function PF(t){return Sc(t)?t:Promise.resolve(t)}function ik(t,e=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(wr()),n=vo();const p=n.promise;if(o){const g=o;o=null,g.abort()}return p}if(s=n||vo(),n=null,e>0){const p=new AbortController;r=PF(t(...l,p.signal));const g=r;UE(e).then(()=>{r===g&&(n?p.abort():o=p)})}else r=1,r=PF(t(...l));const c=()=>{const p=i;i=s=r=o=null,p!=null&&a(...p)},u=r,d=s;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function vo(){let t,e;const r=new Promise((s,n)=>{t=s,e=n}),i=s=>{t(s)};return i.resolve=s=>t(s),i.reject=s=>e(s),i.timeout=(s,n)=>Qw.setTimeout(()=>i.reject(n),s),i.promise=r,i}function fat(t,e){return t.then(e,e)}async function Oj(t){await Promise.resolve(),qt(t)}function mat(t){return t}function $te(t){return 1e3*t}function sk(t){return .001*t}let rve=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},ive=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},MF=0,$F=0;const C2={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},IF=["prepare","preRender","render","postRender","update","finish"],LF=[],f1=new Nt;let sve=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const uM={frameTasks:f1,willDispatch:!1,clearFrameTasks:nve,dispatch:Dte,executeFrameTasks:ave};function WC(t){const e=new ive(t);return LF.push(e),uM.willDispatch||(uM.willDispatch=!0,Jw(Dte)),e}function Kw(t){const e=new rve(t);return f1.push(e),hM==null&&(MF=performance.now(),hM=requestAnimationFrame(Ite)),new sve(e)}let hM=null;function nve(t=!1){f1.forAll(e=>{e.removed=!0}),t&&Lte()}function ove(t){$F=Math.max(0,t)}function Ite(){const t=performance.now();hM=null,hM=f1.length>0?requestAnimationFrame(Ite):null,uM.executeFrameTasks(t)}function ave(t){const e=t-MF;MF=t;const r=$F>0?$F:1e3/60,i=Math.max(0,e-r);C2.time=t,C2.frameDuration=r-i;for(let s=0;s<IF.length;s++){const n=performance.now(),o=IF[s];f1.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(C2.elapsedFrameTime=performance.now()-t,C2.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,C2)))}),lve[s].record(performance.now()-n)}Lte(),cve.record(performance.now()-t)}const GA=new Nt;function Lte(){f1.forAll(t=>{t.removed&&GA.push(t)}),f1.removeUnorderedMany(GA.data,GA.length),GA.clear()}function Dte(){for(;LF.length;){const t=LF.shift();t.isActive&&t.callback()}uM.willDispatch=!1}function vat(t=1,e){const r=vo(),i=()=>{Js(e)?r.reject(wr()):t===0?r():(--t,Jw(()=>i()))};return i(),r.promise}const lve=IF.map(t=>new Uf(t)),cve=new Uf("total");function $R(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let uve=0;const hve=0;function Rl(){return++uve}let NI=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new dve(e),Rj.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;Rj.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)e.push(r[s].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},dve=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=pve}};const Rj=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function pve(){}let Ew=!1;const dM=[];function Nte(t,e){let r=new NI(n),i=null,s=!1;function n(){if(!r||s)return;if(Ew)return void zte(n);const a=i;r.clear(),Ew=!0,s=!0,i=tm(r,t),s=!1,Ew=!1,e(i,a),kte()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=tm(r,t),s=!1,{remove:o}}function Fte(t,e){let r=new NI(s),i=null;function s(){e(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=tm(r,t),i):null}return o(),{remove:n}}function Ute(t){let e=new NI(i),r=!1;function i(){e&&!r&&(Ew?zte(i):(e.clear(),Ew=!0,r=!0,tm(e,t),r=!1,Ew=!1,kte()))}function s(){e&&(e.destroy(),e=null)}return r=!0,tm(e,t),r=!1,{remove:s}}function zte(t){dM.includes(t)||dM.unshift(t)}function kte(){for(;dM.length;)dM.pop()()}var YS;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(YS||(YS={}));let zE=class{constructor(){this.uid=Rl(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,s,n){return this.pool.acquire(YS.Untracked,e,r,i,s,n,Kz)}static acquireTracked(e,r,i,s){return this.pool.acquire(YS.Tracked,e,r,i,null,null,s)}notify(e,r){this.type===YS.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,s,n,o,a){this.uid=Rl(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Rl(),this.removed=!0}};zE.pool=new Pte(zE);const IR=new wl,Vf=new Set;let pM;function fM(t){Vf.delete(t),Vf.add(t),pM||(pM=WC(gve))}function fve(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function mve(t){for(const e of Vf.values())e.target===t&&(e.removed=!0)}function gve(){let t=10;for(;pM&&t--;){pM=null;const e=yve(),r=IR.acquire();for(const i of e){const s=i.uid;fve(i),s===i.uid&&i.removed&&r.push(i)}for(const i of Vf)i.removed&&(r.push(i),Vf.delete(i));for(const i of r)zE.pool.release(i);IR.release(r),IR.release(e),DF.forEach(i=>i())}}function yve(){const t=IR.acquire();t.length=Vf.size;let e=0;for(const r of Vf)t[e]=r,++e;return Vf.clear(),t}const DF=new Set;function Bte(t){return DF.add(t),{remove(){DF.delete(t)}}}function _ve(t,e,r){let i=fte(t,e,r,(s,n,o)=>{let a,l,c=Fte(()=>VC(s,n),(u,d)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=zE.acquireUntracked(u,o,d,s,n),l=a.uid),fM(a))});return{remove:ek(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,fM(a)),a=null),i=c=null})}});return i}function vve(t,e,r){const i=fte(t,e,r,(s,n,o)=>{let a=!1;return Nte(()=>VC(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,Kz(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function bve(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?vve(t,e,r):_ve(t,e,r)}function wve(t,e,r){let i,s,n=Fte(t,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=zE.acquireTracked(o,e,a,r),s=i.uid),fM(i))});return{remove:ek(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,fM(i)),i=null),n=null})}}function xve(t,e,r){let i=!1;return Nte(t,(s,n)=>{i||(i=!0,r(n,s)||e(s,n),i=!1)})}function Tve(t,e,r=!1,i=dte){return r?xve(t,e,i):wve(t,e,i)}function Pj(t){return $R(Vf,e=>e.oldValue===t)}function ao(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function Tat(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function Vte(t,e,r){const i=t.get(e);if(i!==void 0)return i;const s=r();return t.set(e,s),s}const Cw=ne.getLogger("esri.core.accessorSupport.ensureTypes");function Sve(t){return t==null?t:new Date(t)}function Eve(t){return t==null?t:!!t}function Cve(t){return t==null?t:t.toString()}function Rh(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function nk(t){return t==null?t:Math.round(parseFloat(t))}function Gte(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function mM(t,e){return e!=null&&t&&!(e instanceof t)}function jte(t){return t&&"isCollection"in t}function Mj(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function Ave(t,e){if(!e||!e.constructor||!jte(e.constructor))return NF(t,e)?e:new t(e);const r=Mj(t.prototype.itemType),i=Mj(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(NF(t,e),e):new t(e):e}function NF(t,e){return!!Gte(e)&&(Cw.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+FI(t)+"'"),!0)}function ex(t,e){return e==null?e:jte(t)?Ave(t,e):mM(t,e)?NF(t,e)?e:new t(e):e}function FI(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const Ove=new WeakMap;function Rve(t){switch(t){case Number:return Rh;case Qs:return nk;case Boolean:return Eve;case String:return Cve;case Date:return Sve;default:return Vte(Ove,t,()=>ex.bind(null,t))}}function tn(t,e){const r=Rve(t);return arguments.length===1?r:r(e)}function kE(t,e,r){return arguments.length===1?kE.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function Pve(t,e){return arguments.length===1?kE(r=>tn(t,r)):kE(r=>tn(t,r),e)}function Hte(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>Hte(t,e-1,i)):t(r)}function gM(t,e,r){if(arguments.length===2)return n=>gM(t,e,n);if(!r)return r;r=Hte(t,e,r);let i=e,s=r;for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function Mve(t,e,r){return arguments.length===2?gM(i=>tn(t,i),e):gM(i=>tn(t,i),e,r)}function Wte(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function FF(t,e){if(arguments.length===2)return FF(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(r.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!mM(a,d))?a:(u&&i.length?(n||(n=i.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),Cw.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>FI(d)).join(", ")),Cw.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):Cw.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function R0(t,e){if(arguments.length===2)return R0(t).call(null,e);const r={},i=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=tn(c),i.push(FI(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!mM(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=r[c];if(!u)return Cw.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!mM(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!Gte(l)){const d={};for(const p in l)p!==t.key&&(d[p]=l[p]);return u(d)}return u(l)}}let Qs=class{};const Eat={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function $ve(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function qte(t){switch(t.type){case"native":return tn(t.value);case"array":return kE(qte(t.value));case"one-of":return Ive(t);default:return null}}function Ive(t){let e=null;return(r,i)=>zF(r,t)?r:(e==null&&(e=UF(t)),Cw.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function UF(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Qs:return"integer";case Date:return"date";default:return FI(t.value)}case"array":return`array of ${UF(t.value)}`;case"one-of":{const e=t.values.map(r=>UF(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function zF(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Qs:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!zF(r,e.value));case"one-of":return e.values.some(r=>zF(t,r))}}function f(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),s=MI(e,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in t&&ne.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=i.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let u;s.dependsOn=[l],s.get=function(){let d=oM(this,l);if(typeof d=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=oM(this,u);p&&(d=d.bind(p))}return d},s.readOnly||(s.set=c?function(d){this._override(r,d)}:function(d){lM(this,l,d)})}const o=t.type,a=t.types;s.cast||(o?s.cast=Lve(o):a&&(Array.isArray(a)?s.cast=kE(R0(a[0])):s.cast=R0(a))),R1e(s,t),t.range&&(s.cast=Dve(s.cast,t.range))}}function Yte(t,e,r){const i=MI(t,r);i.json||(i.json={});let s=i.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function Lve(t){let e=0,r=t;if($ve(t))return qte(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(Wte(i))return e===0?FF(i):gM(FF(i),e);if(e===1)return Pve(i);if(e>1)return Mve(i,e);const s=t;return s.from?s.from:tn(s)}function Dve(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function Nve(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const s=e[i];r[i].forEach(n=>{e[n]=s}),delete e[i]}}}let m1=class extends Ote{constructor(e,r,i){super(e,r,i)}};m1.prototype.type="warning";function Xte(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const kF=ne.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function $j(t,e,r){var i,s;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((s=e.read)==null?void 0:s.enabled)===!1||zve(t)&&Xx("read.reader",Zte(t),e))}function Zte(t){var r,i;const e=t.ndimArray??0;if(e>1)return Uve(t);if(e===1)return Ij(t);if("type"in t&&Qte(t.type)){const s=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,n=Ij(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return ok(t)}function ok(t){return"type"in t?Fve(t.type):kve(t.types)}function Fve(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void kF.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,i),n}:t.fromJSON}function Jte(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(s=>Jte(t,s,r,i-1)):t(e,void 0,r)}function Uve(t){const e=ok(t),r=Jte.bind(null,e),i=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function Ij(t){const e=ok(t);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(r,void 0,s);return n!==void 0?[n]:void 0}}function Qte(t){if(!Xte(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?ak(e.Type):Kte(e.Type))}function zve(t){return"types"in t?Kte(t.types):ak(t.type)}function ak(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Qte(t))}function Kte(t){for(const e in t.typeMap)if(!ak(t.typeMap[e]))return!1;return!0}function kve(t){let e=null;const r=t.errorContext??"type";return(i,s,n)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void kF.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=Bve(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const d=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&i&&n.messages.push(new m1(`${r}:unsupported`,d,{definition:i,context:n})),void kF.error(d)}const u=new c;return u.read(i,n),u}}function Bve(t){var r,i;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=GC(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=n);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){e[s]=n;continue}const c=l.target,u=typeof c=="string"?c:t.key,d={};l.writer(s,d,u),d[u]&&(e[d[u]]=n)}return e}function Vve(t){if(t.json||(t.json={}),Dj(t.json),Nj(t.json),Lj(t.json),t.json.origins)for(const e in t.json.origins)Dj(t.json.origins[e]),Nj(t.json.origins[e]),Lj(t.json.origins[e]);return!0}function Lj(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Dj(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Nj(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Fj(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&Xte(t.type))?e.write.writer=Hve:r>1?e.write.writer=Wve(r):e.types?Array.isArray(e.types)?e.write.writer=jve(e.types[0]):e.write.writer=Gve(e.types):e.write.writer=BE}function Gve(t){return(e,r,i,s)=>e?ere(e,t,s)?BE(e,r,i,s):void 0:BE(e,r,i,s)}function ere(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new X(`${i}:unsupported`,s,{definition:t,context:r})),ne.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function jve(t){return(e,r,i,s)=>!e||!Array.isArray(e)?BE(e,r,i,s):BE(e.filter(n=>ere(n,t,s)),r,i,s)}function BE(t,e,r,i){Xx(r,yM(t,i),e)}function yM(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?_M(t):t}function _M(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function Hve(t,e,r,i){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>yM(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[yM(t,i)],Xx(r,s,e)}function tre(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>tre(i,e,r-1)):yM(t,e)}function Wve(t){return(e,r,i,s)=>{let n;if(e===null)n=null;else{n=tre(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Xx(i,n,r)}}function BF(t,e){return lk(t,"read",e)}function rre(t,e){return lk(t,"write",e)}function lk(t,e,r){let i=t&&t.json;if(t&&t.json&&t.json.origins&&r){const s=r.origin&&t.json.origins[r.origin];s&&(e==="any"||e in s)&&(i=s)}return i}function qve(t){const e=Yve(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],s=i.types?Xve(i):e;$j(s,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),Fj(s,i)}$j(e,t.json,!0),Fj(e,t.json)}function Yve(t){return t.json.types?VF(t.json):t.type?ire(t):VF(t)}function Xve(t){return t.type?ire(t):VF(t)}function ire(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!Wte(r);)r=r[0],e++;return{type:r,ndimArray:e}}function VF(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function Zve(t){Vve(t)&&(Nve(t),qve(t))}const GD=new Set,jD=new Set;function F(t){return e=>{e.prototype.declaredClass=t,Qve(e);const r=[],i=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!GD.has(s.initialize)&&(GD.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!jD.has(s.destroy)&&(jD.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);GD.clear(),jD.clear();class n extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[ste];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<i.length;u++)i[u].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=GC(e.prototype),n.prototype.declaredClass=t,n}}function Jve(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;Zt(i.observerObject);const s=r.store;return s.has(t)?s.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function Qve(t){const e=t.prototype,r=GC(e),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];Zve(n),i[s]={enumerable:!0,configurable:!0,get:Jve(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===If.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var sre,nre;function Kve(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const yg=Symbol("Accessor-Handles"),GF=Symbol("Accessor-Initialized");let we=class ore{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}GC(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let d;this.inherited=function(...p){if(n.prototype[a])return n.prototype[a].apply(this,p)};try{d=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,d}:e[a]}for(const a in r){const l=Kve(r[a]);f(l)(o.prototype,a)}return F(i)(o)}constructor(...e){if(this[sre]=null,this[nre]=!1,this.constructor===ore)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new V1e(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e)),Uj.register(this,r.propertiesByName,this)}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[GF]=!0}initialize(){}[ste](){this[yg]=Oe(this[yg])}destroy(){var e;this.destroyed||(Uj.unregister(this),mve(this),this.__accessor__.destroy(),(e=X1e())==null||e.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[GF]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return oM(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return lM(this,e,r),this}watch(e,r,i){return bve(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){if(this.destroyed){const s=Array.isArray(e)?e:[e];for(const n of s)n.remove();return}let i=this[yg];i==null&&(i=this[yg]=new Oi),i.add(e,r)}removeHandles(e){const r=this[yg];r!=null&&r.remove(e)}removeAllHandles(){const e=this[yg];e!=null&&e.removeAll()}hasHandles(e){const r=this[yg];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};sre=yg,nre=GF;const Uj=new FinalizationRegistry(t=>{for(const e of t.values())e.destroy()});let LR=class are{constructor(){this._emitter=new are.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return Zw(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=h([F("esri.core.Evented")],s),s};let r=class extends we{constructor(){super(...arguments),this._emitter=new LR.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=h([F("esri.core.Evented")],r),t.EventedAccessor=r})(LR||(LR={}));const ys=LR;var jr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(jr||(jr={}));function lre(t){return(e,r)=>{e[r]=t}}let ck=class extends wte{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var Rf;let ebe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const Oc=new po(ebe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),tbe=()=>{};function HD(t){return t?t instanceof I_?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function WD(t){if(t&&t.length)return t[0]}function rbe(t,e,r,i){const s=Math.min(t.length-r,e.length-i);let n=0;for(;n<s&&t[r+n]===e[i+n];)n++;return n}function cre(t,e,r,i){e&&e.forEach((s,n,o)=>{t.push(s),cre(t,r.call(i,s,n,o),r,i)})}const Lm=new Set,Dm=new Set,Nm=new Set,qD=new Map;let ibe=0,I_=Rf=class extends ys.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Rf}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new ck,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:ibe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Rf?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Zt(this._observable),this._items}set items(t){this._emitBeforeChanges(jr.ADD)||(this._splice(0,this.length,HD(t)),this._emitAfterChanges(jr.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=tbe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(Zt(this._observable),this._emitBeforeChanges(jr.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(jr.ADD),this}addMany(t,e=this._items.length){if(Zt(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(jr.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,HD(t)),this._emitAfterChanges(jr.ADD),this}at(t){if(Zt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Zt(this._observable),!this.length||this._emitBeforeChanges(jr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(jr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Zt(this._observable),this._createNewInstance({items:this._items.map(ye)})}concat(...t){Zt(this._observable);const e=t.map(HD);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Zt(this._observable),!this.length||this._emitBeforeChanges(jr.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)t.call(e,r[s],s,r);this._emitAfterChanges(jr.REMOVE)}every(t,e){return Zt(this._observable),this._items.every(t,e)}filter(t,e){let r;return Zt(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Zt(this._observable),this._items.find(t,e)}findIndex(t,e){return Zt(this._observable),this._items.findIndex(t,e)}flatten(t,e){Zt(this._observable);const r=[];return cre(r,this,t,e),new Rf(r)}forEach(t,e){return Zt(this._observable),this._items.forEach(t,e)}getItemAt(t){return Zt(this._observable),this._items[t]}getNextIndex(t){Zt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Zt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Zt(this._observable),this._items.indexOf(t,e)}join(t=","){return Zt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Zt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Zt(this._observable);const r=this._items.map(t,e);return new Rf({items:r})}reorder(t,e=this.length-1){Zt(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(jr.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(jr.MOVE)}return t}}pop(){if(Zt(this._observable),!this.length||this._emitBeforeChanges(jr.REMOVE))return;const t=WD(this._splice(this.length-1,1));return this._emitAfterChanges(jr.REMOVE),t}push(...t){return Zt(this._observable),this._emitBeforeChanges(jr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(jr.ADD)),this.length}reduce(t,e){Zt(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Zt(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Zt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Zt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(jr.REMOVE))return;const e=WD(this._splice(t,1));return this._emitAfterChanges(jr.REMOVE),e}removeMany(t){if(Zt(this._observable),!t||!t.length||this._emitBeforeChanges(jr.REMOVE))return[];const e=t instanceof Rf?t.toArray():t,r=this._items,i=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=r.indexOf(o);if(a>-1){const l=1+rbe(e,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(jr.REMOVE),i}reverse(){if(Zt(this._observable),this._emitBeforeChanges(jr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(jr.MOVE),this}shift(){if(Zt(this._observable),!this.length||this._emitBeforeChanges(jr.REMOVE))return;const t=WD(this._splice(0,1));return this._emitAfterChanges(jr.REMOVE),t}slice(t=0,e=this.length){return Zt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Zt(this._observable),this._items.some(t,e)}sort(t){if(Zt(this._observable),!this.length||this._emitBeforeChanges(jr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(jr.MOVE),this}splice(t,e,...r){Zt(this._observable);const i=(e?jr.REMOVE:0)|(r.length?jr.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(t,e,r)||[];return this._emitAfterChanges(i),s}toArray(){return Zt(this._observable),this._items.slice()}toJSON(){return Zt(this._observable),this.toArray()}toLocaleString(){return Zt(this._observable),this._items.toLocaleString()}toString(){return Zt(this._observable),this._items.toString()}unshift(...t){return Zt(this._observable),!t.length||this._emitBeforeChanges(jr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(jr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=WC(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=Oc.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,n),t+=1,l-=1,c-=1);Oc.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Oc.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Oc.release(a)}}if(r&&r.length){if(s){const u=[];for(const d of r){const p=s.ensureType(d);p==null&&d!=null||u.push(p)}r=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=Oc.acquire();u.target=this,u.cancellable=!0;const d=Oc.acquire();d.target=this,d.cancellable=!1;for(const p of r)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),l&&(d.reset(p),this.emit("after-add",d)))):(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),d.reset(p),this.emit("after-add",d));Oc.release(d),Oc.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=Oc.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,Oc.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Oc.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Oc.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;Lm.clear(),Dm.clear(),Nm.clear();for(const{added:l,removed:c}of r){if(l)if(Nm.size===0&&Dm.size===0)for(const u of l)Lm.add(u);else for(const u of l)Dm.has(u)?(Nm.add(u),Dm.delete(u)):Nm.has(u)||Lm.add(u);if(c)if(Nm.size===0&&Lm.size===0)for(const u of c)Dm.add(u);else for(const u of c)Lm.has(u)?Lm.delete(u):(Nm.delete(u),Dm.add(u))}const i=wl.acquire();Lm.forEach(l=>{i.push(l)});const s=wl.acquire();Dm.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=wl.acquire();if(Nm.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const d=e.listeners[u];d.removed||d.callback.call(this,l)}}wl.release(i),wl.release(s),wl.release(a)}Lm.clear(),Dm.clear(),Nm.clear()}};I_.ofType=t=>{if(!t)return Rf;if(qD.has(t))return qD.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const s=t.typeMap[i].prototype.declaredClass;e?e+=` | ${s}`:e=s}let r=class extends Rf{};return h([lre({Type:t,ensureType:typeof t=="function"?tn(t):R0(t)})],r.prototype,"itemType",void 0),r=h([F(`esri.core.Collection<${e}>`)],r),qD.set(t,r),r},h([f()],I_.prototype,"length",void 0),h([f()],I_.prototype,"items",null),I_=Rf=h([F("esri.core.Collection")],I_);const er=I_;function g1(t,e,r=er){return e||(e=new r),e===t||(e.removeAll(),sbe(t)?e.addMany(t):t&&e.add(t)),e}function ure(t){return t}function sbe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const zj=new Set;function nbe(t,e,r=!1){r&&zj.has(e)||(r&&zj.add(e),t.warn(`🛑 DEPRECATED - ${e}`))}function ap(t,e,r={}){if(ie("esri-deprecation-warnings")){const{moduleName:i}=r;vM(t,`Property: ${(i?i+"::":"")+e}`,r)}}function vM(t,e,r={}){if(ie("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=e;i&&(a+=`
	🛠️ Replacement: ${i}`),s&&(a+=`
	⚙️ Version: ${s}`),n&&(a+=`
	🔗 See ${n} for more details.`),nbe(t,a,o)}}let obe=class hre{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new hre;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,ye(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??ai.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var s;return((s=this._values.get(i))==null?void 0:s.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===ai.DEFAULTS){const s=this._values.get(e);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(e,new abe(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===ai.DEFAULTS?e:ai.USER}},abe=class{constructor(e,r){this.value=e,this.origin=r}};function lbe(t,e,r){e.keys().forEach(s=>{r.set(s,e.get(s),ai.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(s=>{t.internalGet(s)&&r.set(s,t.internalGet(s),ai.DEFAULTS)})}function cbe(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&vj(i,r))return!0}else for(const s of i)if(s===e||s.includes(".")&&s.indexOf(e)===0&&vj(s,r))return!0;return!1}function ube(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function hbe(t,e,r,i,s){let n=BF(e[r],s);ube(n)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))n=BF(e[o],s),cbe(n,r,i)&&(t[o]=!0)}function dbe(t,e,r,i){const s=r.metadatas,n=lk(s[e],"any",i),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const dre={origin:"service"};function pbe(t,e,r=dre){if(!e||typeof e!="object")return;const i=O0(t),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))hbe(n,s,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=BF(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?VC(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||dbe(t,o,i,r)}i.setDefaultOrigin("user")}function Pat(t,e,r,i=dre){var n;const s={...i,messages:[]};r(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function fbe(t,e,r,i,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,n,r,s),n}function pre(t,e,r,i,s,n){if(!i||!i.write)return!1;const o=t.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,n??void 0);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new X("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&n&&n.messages?n.messages.push(a):a&&!n&&ne.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!e.store.multipleOriginsSupported||e.store.originOf(r)===ai.DEFAULTS)&&mbe(t,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<xte(n.origin))}function mbe(t,e,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,r??void 0);return Kf(o,s)}return!1}return n===s}function Mat(t,e,r,i){const s=O0(t),n=s.metadatas,o=rre(n[e],i);return!!o&&pre(t,s,e,o,r,i)}function gbe(t,e,r){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return RR(e,t.toJSON(r));const i=O0(t),s=i.metadatas;for(const a in s){const l=rre(s[a],r);if(!pre(t,i,a,l,void 0,r))continue;const c=t.get(a),u=fbe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(u).length>0&&(e=RR(e,u),(o=(n=r==null?void 0:r.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>RR(e,u,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:N1e(i.store.originOf(a)),newOrigin:r.origin}))}return e}const qC=t=>{let e=class extends t{constructor(...r){super(...r);const i=O0(this),s=i.store,n=new obe;i.store=n,lbe(i,s,n)}read(r,i){pbe(this,r,i)}write(r,i){return gbe(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return ybe.call(this,r,i)}};return e=h([F("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function ybe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let Ke=class extends qC(we){};Ke=h([F("esri.core.JSONSupport")],Ke);var Vg;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(Vg||(Vg={}));let _be=class{constructor(){this._resolver=vo(),this._status=Vg.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Vg.RESOLVED,this._cleanUp()},()=>{this._status=Vg.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===Vg.RESOLVED}isRejected(){return this._status===Vg.REJECTED}isFulfilled(){return this._status!==Vg.PENDING}abort(){this._resolver.reject(wr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=vo(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==i||gs(s)||this._resolver.reject(s)}),e.resolve()}};const uk=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new _be,this.addResolvingPromise(Promise.resolve())}destroy(){var r;(r=this._promiseProps)==null||r.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=h([F("esri.core.Promise")],e),e};let bM=class extends uk(we){};bM=h([F("esri.core.Promise")],bM);const vbe="not-loaded",bbe="loading",wbe="failed",kj="loaded",fre=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=rk(n,l);this.destroyed&&l(new X("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===vbe){this._set("loadStatus",bbe);const a=this._loadController=new AbortController;s({signal:a.signal}),Uo(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",kj),this._loadController=null},i=>{this._set("loadStatus",wbe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController=yc(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===kj}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new X("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return h([f({readOnly:!0})],e.prototype,"loaded",null),h([f({readOnly:!0})],e.prototype,"loadError",void 0),h([f({clonable:!1})],e.prototype,"loadStatus",void 0),h([f({type:[m1],readOnly:!0})],e.prototype,"loadWarnings",null),e=h([F("esri.core.Loadable")],e),e};let IT=class extends fre(bM){};IT=h([F("esri.core.Loadable")],IT),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=fre,t.isLoadable=e}(IT||(IT={}));const P0=IT;function UI(t,e,r){return X0(t.map((i,s)=>e.apply(r,[i,s])))}async function xbe(t,e,r){return(await X0(t.map((i,s)=>e.apply(r,[i,s])))).map(i=>i.value)}function hk(t){return{ok:!0,value:t}}function dk(t){return{ok:!1,error:t}}function Tbe(t){return t!=null&&t.ok===!0?t.value:null}function Sbe(t){return t!=null&&t.ok===!1?t.error:null}async function rm(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return hk(await t)}catch(e){return dk(e)}}async function Nat(t){try{return hk(await t)}catch(e){return K1(e),dk(e)}}function Fat(t){if(t.ok===!0)return t.value;throw t.error}function Zx(t,e){return new _g(t,e)}let _g=class extends we{get value(){return Tbe(this._result)}get error(){return Sbe(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=yc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(s=>{this._result=hk(s),this._cleanup()},s=>{this._result=dk(s),this._cleanup()}),this._abortHandle=Uo(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=bi(this._abortHandle),this._abortController=null}};h([f()],_g.prototype,"value",null),h([f()],_g.prototype,"error",null),h([f()],_g.prototype,"finished",null),h([f()],_g.prototype,"promise",void 0),h([f()],_g.prototype,"_result",void 0),_g=h([F("esri.core.asyncUtils.ReactiveTask")],_g);async function mre(t,e){return await t.load(),Ebe(t,e)}async function Ebe(t,e){const r=[],i=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?i(...o):er.isCollection(o)?o.forEach(a=>i(a)):P0.isLoadable(o)&&r.push(o))};e(i);let s=null;if(await xbe(r,async n=>{const o=await rm(Cbe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function Cbe(t){return"loadAll"in t&&typeof t.loadAll=="function"}const Abe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,Obe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Bj(t){const e=t==null?void 0:t.match(Abe);if(!e)return null;const[,r,i,s]=e;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:u}=Obe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function Rbe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}const Pbe=ne.getLogger("esri.core.urlUtils"),Jx=Er.request,Vj="esri/config: esriConfig.request.proxyUrl is not set.",gre=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,yre=/^\s*http:/i,Mbe=/^\s*https:/i,$be=/^\s*file:/i,Ibe=/:\d+$/,Lbe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,Dbe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),Nbe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let Aw=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(Dbe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(Nbe),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const jA={},Fbe=new Aw(Er.applicationUrl);let oa=Fbe;const Ube=zbe();let pk=Ube;const fk=()=>oa,kat=()=>pk;function zbe(){const t=oa.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${oa.scheme}://${oa.host}${oa.port!=null?`:${oa.port}`:""}`}${e}`}function da(t){if(!t)return null;const e={path:null,query:null},r=new Aw(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=_re(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function _re(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function Gj(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function VE(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=e&&e[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>Gj(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):Gj(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function kbe(t=!1){let e,r=Jx.proxyUrl;if(typeof t=="string"){e=Wbe(t);const i=zI(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw Pbe.warn(Vj),new X("urlutils:proxy-not-set",Vj);return e&&jF()&&(r=bk(r)),da(r)}function Bat(t){const e=zI(t);let r,i;if(e){const s=mk(e.proxyUrl);r=s.path,i=s.query?_re(s.query):null}if(r){const s=da(t);t=r+"?"+s.path;const n=VE({...i,...s.query});n&&(t=`${t}?${n}`)}return t}const A2={path:"",query:""};function mk(t){const e=t.indexOf("?");return e!==-1?(A2.path=t.slice(0,e),A2.query=t.slice(e+1)):(A2.path=t,A2.query=null),A2}function vre(t){return t=(t=xM(t=Jbe(t=mk(t).path),!0)).toLowerCase()}function Bbe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:vre(t.urlPrefix)},r=Jx.proxyRules,i=e.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,e),s}function zI(t){const e=Jx.proxyRules,r=vre(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function Vat(t,e){if(!t||!e)return!1;t=wM(t),e=wM(e);const r=Bj(t),i=Bj(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&tx(t,e,!0)}function Vbe(t,e){return t=wM(t),e=wM(e),xM(t)===xM(e)}function wM(t){const e=(t=Gf(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function bre(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=Jx.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function tx(t,e,r=!1){if(!t||!e)return!1;const i=WF(t),s=WF(e);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function gk(t){if(typeof t=="string"){if(!dc(t))return!0;t=WF(t)}if(tx(t,oa))return!0;const e=Jx.trustedServers||[];for(let r=0;r<e.length;r++){const i=Gbe(e[r]);for(let s=0;s<i.length;s++)if(tx(t,i[s]))return!0}return!1}function Gbe(t){return jA[t]||(vk(t)||Ep(t)?jA[t]=[new Aw(ac(t))]:jA[t]=[new Aw(`http://${t}`),new Aw(`https://${t}`)]),jA[t]}function ac(t,e=pk,r){return Ep(t)?r&&r.preserveProtocolRelative?t:oa.scheme==="http"&&oa.authority===Vh(t).slice(2)?`http:${t}`:`https:${t}`:vk(t)?t:kI(t[0]==="/"?Zbe(e):e,t)}function yk(t,e=pk,r){if(t==null||!dc(t))return t;const i=Gf(t),s=i.toLowerCase(),n=Gf(e).toLowerCase().replace(/\/+$/,""),o=r?Gf(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,p,g)=>(g=d.indexOf(p,g))===-1?d.length:g;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const u=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)t=`../${t}`;else t=`./${t}`;return t}function Gf(t){return t=ewe(t=Kbe(t=Qbe(t=ac(t=t.trim()))))}function kI(...t){const e=t.filter(em);if(!e||!e.length)return;const r=[];if(dc(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),Ybe(e[0])&&(r[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function Vh(t,e=!1){if(t==null||GE(t)||Ip(t))return null;let r=t.indexOf("://");if(r===-1&&Ep(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=xM(t,!0)),t}function dc(t){return Ep(t)||vk(t)}function GE(t){return t!=null&&t.slice(0,5)==="blob:"}function Ip(t){return t!=null&&t.slice(0,5)==="data:"}function _k(t){const e=y1(t);if(!e||!e.isBase64)return null;const r=atob(e.data),i=new Uint8Array(r.length);for(let s=0;s<r.length;s++)i[s]=r.charCodeAt(s);return i.buffer}function Gat(t){return btoa(String.fromCharCode.apply(null,t)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const jbe=/^data:(.*?)(;base64)?,(.*)$/;function y1(t){const e=t.match(jbe);if(!e)return null;const[,r,i,s]=e;return{mediaType:r,isBase64:!!i,data:s}}function wre(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function jat(t){const e=_k(t);if(!e)return null;const r=y1(t);return new Blob([e],{type:r.mediaType})}function Hat(t,e){Hbe(t,e)}function Hbe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function Ep(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function vk(t){return t!=null&&gre.test(t)}function Wbe(t){return t!=null&&Mbe.test(t)||oa.scheme==="https"&&Ep(t)}function qbe(t){return t!=null&&yre.test(t)||oa.scheme==="http"&&Ep(t)}function Ybe(t){return t!=null&&$be.test(t)}function bk(t){return Ep(t)?`https:${t}`:t.replace(yre,"https:")}function Xbe(){return oa.scheme==="http"}function jF(){return oa.scheme==="https"}function xM(t,e=!1){return Ep(t)?t.slice(2):(t=t.replace(gre,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function Zbe(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function wk(t){let e=0;if(dc(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function Wat(t,e){if(!t)return"";const r=da(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const s=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(s,"")}function Jbe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function xre(t){return t.replace(/\/+$/,"")}function Qbe(t){if(/^https?:\/\//i.test(t)){const e=mk(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function Kbe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function ewe(t){const e=Jx.httpsDomains;if(!qbe(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),Ibe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return Xbe()&&i===oa.authority&&!Lbe.test(t)||(jF()&&i===oa.authority||e&&e.some(s=>i===s||i.endsWith(`.${s}`))||jF()&&!zI(t))&&(t=bk(t)),t}function HF(t,e,r){if(!(e&&r&&t&&dc(t)))return t;const i=t.indexOf("//"),s=t.indexOf("/",i+2),n=t.indexOf(":",i+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function WF(t){return typeof t=="string"?new Aw(ac(t)):(t.scheme||(t.scheme=oa.scheme),t)}function Tre(t){return twe.test(t)}function Sre(t,e){const r=da(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function Ere(t,e,r){const i=da(t),s=i.query||{};return s[e]=String(r),`${i.path}?${VE(s)}`}function YD(t,e){const r=da(t),i=r.query||{};for(const n in e)i[n]=e[n];const s=VE(i);return s?`${r.path}?${s}`:r.path}function qat(t){if(t==null)return null;const e=t.match(Cre);return e?e[2]:null}function jj(t){if(t==null)return null;const e=t.match(Cre);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function Yat(t){return typeof t=="string"?y1(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(y1(i.result)),i.onerror=s=>r(s)})}const Cre=/([^.]*)\.([^\/]*)$/,twe=/(^data:image\/svg|\.svg$)/i;function qr(t,e,r){let i,s;return e===void 0?(s=t,i=[void 0]):typeof e!="string"?(s=t,i=[void 0],r=e):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=Yte(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let Tn=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&Xx(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function Ec(){return function(t,e){return new Tn(t,{ignoreUnknown:!0,...e})}}let xk=class{constructor(e,r,i,s){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Yt=new xk(6378137,1/298.257223563,3e5,.006694379990137799),pp=new xk(3396190,1/169.8944472236118,23e4),im=new xk(1737400,0,0);var pu;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(pu||(pu={}));let m;const P={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(m=2e3;m<=2045;m++)P[m]=0;for(m=2056;m<=2065;m++)P[m]=0;for(m=2067;m<=2135;m++)P[m]=0;for(m=2137;m<=2154;m++)P[m]=0;for(m=2161;m<=2170;m++)P[m]=0;for(m=2172;m<=2193;m++)P[m]=0;for(m=2195;m<=2198;m++)P[m]=0;for(m=2200;m<=2203;m++)P[m]=0;for(m=2205;m<=2217;m++)P[m]=0;for(m=2222;m<=2224;m++)P[m]=1;for(m=2225;m<=2250;m++)P[m]=2;for(m=2251;m<=2253;m++)P[m]=1;for(m=2257;m<=2264;m++)P[m]=2;for(m=2274;m<=2279;m++)P[m]=2;for(m=2280;m<=2282;m++)P[m]=1;for(m=2283;m<=2289;m++)P[m]=2;for(m=2290;m<=2292;m++)P[m]=0;for(m=2308;m<=2313;m++)P[m]=0;for(m=2315;m<=2491;m++)P[m]=0;for(m=2494;m<=2866;m++)P[m]=0;for(m=2867;m<=2869;m++)P[m]=1;for(m=2870;m<=2888;m++)P[m]=2;for(m=2891;m<=2895;m++)P[m]=2;for(m=2896;m<=2898;m++)P[m]=1;for(m=2902;m<=2908;m++)P[m]=2;for(m=2915;m<=2920;m++)P[m]=2;for(m=2921;m<=2923;m++)P[m]=1;for(m=2924;m<=2930;m++)P[m]=2;for(m=2931;m<=2962;m++)P[m]=0;for(m=2964;m<=2968;m++)P[m]=2;for(m=2969;m<=2973;m++)P[m]=0;for(m=2975;m<=2991;m++)P[m]=0;for(m=2995;m<=3051;m++)P[m]=0;for(m=3054;m<=3079;m++)P[m]=0;for(m=3081;m<=3088;m++)P[m]=0;for(m=3092;m<=3101;m++)P[m]=0;for(m=3106;m<=3138;m++)P[m]=0;for(m=3146;m<=3151;m++)P[m]=0;for(m=3153;m<=3166;m++)P[m]=0;for(m=3168;m<=3172;m++)P[m]=0;for(m=3174;m<=3203;m++)P[m]=0;for(m=3294;m<=3358;m++)P[m]=0;for(m=3367;m<=3403;m++)P[m]=0;for(m=3408;m<=3416;m++)P[m]=0;for(m=3417;m<=3438;m++)P[m]=2;for(m=3441;m<=3446;m++)P[m]=2;for(m=3447;m<=3450;m++)P[m]=0;for(m=3451;m<=3459;m++)P[m]=2;for(m=3460;m<=3478;m++)P[m]=0;for(m=3554;m<=3559;m++)P[m]=0;for(m=3560;m<=3570;m++)P[m]=2;for(m=3571;m<=3581;m++)P[m]=0;for(m=3594;m<=3597;m++)P[m]=0;for(m=3601;m<=3604;m++)P[m]=0;for(m=3637;m<=3639;m++)P[m]=0;for(m=3665;m<=3667;m++)P[m]=0;for(m=3693;m<=3695;m++)P[m]=0;for(m=3701;m<=3727;m++)P[m]=0;for(m=3728;m<=3739;m++)P[m]=2;for(m=3740;m<=3751;m++)P[m]=0;for(m=3753;m<=3760;m++)P[m]=2;for(m=3761;m<=3773;m++)P[m]=0;for(m=3775;m<=3777;m++)P[m]=0;for(m=3779;m<=3781;m++)P[m]=0;for(m=3783;m<=3785;m++)P[m]=0;for(m=3788;m<=3791;m++)P[m]=0;for(m=3797;m<=3802;m++)P[m]=0;for(m=3814;m<=3816;m++)P[m]=0;for(m=3825;m<=3829;m++)P[m]=0;for(m=3832;m<=3841;m++)P[m]=0;for(m=3844;m<=3852;m++)P[m]=0;for(m=3873;m<=3885;m++)P[m]=0;for(m=3890;m<=3893;m++)P[m]=0;for(m=3907;m<=3912;m++)P[m]=0;for(m=3942;m<=3950;m++)P[m]=0;for(m=3968;m<=3970;m++)P[m]=0;for(m=3973;m<=3976;m++)P[m]=0;for(m=3986;m<=3989;m++)P[m]=0;for(m=3994;m<=3997;m++)P[m]=0;for(m=4048;m<=4051;m++)P[m]=0;for(m=4056;m<=4063;m++)P[m]=0;for(m=4093;m<=4096;m++)P[m]=0;for(m=4390;m<=4398;m++)P[m]=0;for(m=4399;m<=4413;m++)P[m]=2;for(m=4418;m<=4433;m++)P[m]=2;for(m=4455;m<=4457;m++)P[m]=2;for(m=4484;m<=4489;m++)P[m]=0;for(m=4491;m<=4554;m++)P[m]=0;for(m=4568;m<=4589;m++)P[m]=0;for(m=4652;m<=4656;m++)P[m]=0;for(m=4766;m<=4800;m++)P[m]=0;for(m=5014;m<=5016;m++)P[m]=0;for(m=5069;m<=5072;m++)P[m]=0;for(m=5105;m<=5130;m++)P[m]=0;for(m=5173;m<=5188;m++)P[m]=0;for(m=5253;m<=5259;m++)P[m]=0;for(m=5269;m<=5275;m++)P[m]=0;for(m=5292;m<=5311;m++)P[m]=0;for(m=5329;m<=5331;m++)P[m]=0;for(m=5343;m<=5349;m++)P[m]=0;for(m=5355;m<=5357;m++)P[m]=0;for(m=5387;m<=5389;m++)P[m]=0;for(m=5459;m<=5463;m++)P[m]=0;for(m=5479;m<=5482;m++)P[m]=0;for(m=5518;m<=5520;m++)P[m]=0;for(m=5530;m<=5539;m++)P[m]=0;for(m=5550;m<=5552;m++)P[m]=0;for(m=5562;m<=5583;m++)P[m]=0;for(m=5623;m<=5625;m++)P[m]=2;for(m=5631;m<=5639;m++)P[m]=0;for(m=5649;m<=5653;m++)P[m]=0;for(m=5663;m<=5680;m++)P[m]=0;for(m=5682;m<=5685;m++)P[m]=0;for(m=5875;m<=5877;m++)P[m]=0;for(m=5896;m<=5899;m++)P[m]=0;for(m=5921;m<=5940;m++)P[m]=0;for(m=6050;m<=6125;m++)P[m]=0;for(m=6244;m<=6275;m++)P[m]=0;for(m=6328;m<=6348;m++)P[m]=0;for(m=6350;m<=6356;m++)P[m]=0;for(m=6366;m<=6372;m++)P[m]=0;for(m=6381;m<=6387;m++)P[m]=0;for(m=6393;m<=6404;m++)P[m]=0;for(m=6480;m<=6483;m++)P[m]=0;for(m=6511;m<=6514;m++)P[m]=0;for(m=6579;m<=6581;m++)P[m]=0;for(m=6619;m<=6624;m++)P[m]=0;for(m=6625;m<=6627;m++)P[m]=2;for(m=6628;m<=6632;m++)P[m]=0;for(m=6634;m<=6637;m++)P[m]=0;for(m=6669;m<=6692;m++)P[m]=0;for(m=6707;m<=6709;m++)P[m]=0;for(m=6720;m<=6723;m++)P[m]=0;for(m=6732;m<=6738;m++)P[m]=0;for(m=6931;m<=6933;m++)P[m]=0;for(m=6956;m<=6959;m++)P[m]=0;for(m=7005;m<=7007;m++)P[m]=0;for(m=7057;m<=7070;m++)P[m]=2;for(m=7074;m<=7082;m++)P[m]=0;for(m=7109;m<=7118;m++)P[m]=0;for(m=7119;m<=7127;m++)P[m]=1;for(m=7374;m<=7376;m++)P[m]=0;for(m=7528;m<=7586;m++)P[m]=0;for(m=7587;m<=7645;m++)P[m]=2;for(m=7692;m<=7696;m++)P[m]=0;for(m=7755;m<=7787;m++)P[m]=0;for(m=7791;m<=7795;m++)P[m]=0;for(m=7799;m<=7801;m++)P[m]=0;for(m=7803;m<=7805;m++)P[m]=0;for(m=7825;m<=7831;m++)P[m]=0;for(m=7845;m<=7859;m++)P[m]=0;for(m=8013;m<=8032;m++)P[m]=0;for(m=8065;m<=8068;m++)P[m]=1;for(m=8518;m<=8529;m++)P[m]=2;for(m=8533;m<=8536;m++)P[m]=2;for(m=8538;m<=8540;m++)P[m]=2;for(m=8677;m<=8679;m++)P[m]=0;for(m=8836;m<=8840;m++)P[m]=0;for(m=8857;m<=8859;m++)P[m]=0;for(m=8908;m<=8910;m++)P[m]=0;for(m=9154;m<=9159;m++)P[m]=0;for(m=9205;m<=9218;m++)P[m]=0;for(m=9271;m<=9273;m++)P[m]=0;for(m=9295;m<=9297;m++)P[m]=0;for(m=9356;m<=9360;m++)P[m]=0;for(m=9404;m<=9407;m++)P[m]=0;for(m=9476;m<=9482;m++)P[m]=0;for(m=9487;m<=9494;m++)P[m]=0;for(m=9697;m<=9699;m++)P[m]=0;for(m=9821;m<=9865;m++)P[m]=0;for(m=20002;m<=20032;m++)P[m]=0;for(m=20047;m<=20049;m++)P[m]=0;for(m=20062;m<=20092;m++)P[m]=0;for(m=20135;m<=20138;m++)P[m]=0;for(m=20248;m<=20258;m++)P[m]=0;for(m=20348;m<=20358;m++)P[m]=0;for(m=20436;m<=20440;m++)P[m]=0;for(m=20822;m<=20824;m++)P[m]=0;for(m=20904;m<=20932;m++)P[m]=0;for(m=20934;m<=20936;m++)P[m]=0;for(m=21004;m<=21032;m++)P[m]=0;for(m=21035;m<=21037;m++)P[m]=0;for(m=21095;m<=21097;m++)P[m]=0;for(m=21148;m<=21150;m++)P[m]=0;for(m=21207;m<=21264;m++)P[m]=0;for(m=21307;m<=21364;m++)P[m]=0;for(m=21413;m<=21423;m++)P[m]=0;for(m=21453;m<=21463;m++)P[m]=0;for(m=21473;m<=21483;m++)P[m]=0;for(m=21780;m<=21782;m++)P[m]=0;for(m=21891;m<=21894;m++)P[m]=0;for(m=21896;m<=21899;m++)P[m]=0;for(m=22171;m<=22177;m++)P[m]=0;for(m=22181;m<=22187;m++)P[m]=0;for(m=22191;m<=22197;m++)P[m]=0;for(m=22207;m<=22222;m++)P[m]=0;for(m=22234;m<=22236;m++)P[m]=0;for(m=22243;m<=22250;m++)P[m]=0;for(m=22262;m<=22265;m++)P[m]=0;for(m=22307;m<=22322;m++)P[m]=0;for(m=22348;m<=22357;m++)P[m]=0;for(m=22407;m<=22422;m++)P[m]=0;for(m=22462;m<=22465;m++)P[m]=0;for(m=22521;m<=22525;m++)P[m]=0;for(m=22607;m<=22622;m++)P[m]=0;for(m=22641;m<=22646;m++)P[m]=0;for(m=22648;m<=22657;m++)P[m]=0;for(m=22707;m<=22722;m++)P[m]=0;for(m=22762;m<=22765;m++)P[m]=0;for(m=22991;m<=22994;m++)P[m]=0;for(m=23028;m<=23038;m++)P[m]=0;for(m=23830;m<=23853;m++)P[m]=0;for(m=23866;m<=23872;m++)P[m]=0;for(m=23877;m<=23884;m++)P[m]=0;for(m=23886;m<=23894;m++)P[m]=0;for(m=23946;m<=23948;m++)P[m]=0;for(m=24311;m<=24313;m++)P[m]=0;for(m=24342;m<=24347;m++)P[m]=0;for(m=24370;m<=24374;m++)P[m]=10;for(m=24375;m<=24381;m++)P[m]=0;for(m=24718;m<=24721;m++)P[m]=0;for(m=24817;m<=24821;m++)P[m]=0;for(m=24877;m<=24882;m++)P[m]=0;for(m=24891;m<=24893;m++)P[m]=0;for(m=25391;m<=25395;m++)P[m]=0;for(m=25828;m<=25838;m++)P[m]=0;for(m=26191;m<=26195;m++)P[m]=0;for(m=26391;m<=26393;m++)P[m]=0;for(m=26701;m<=26722;m++)P[m]=0;for(m=26729;m<=26799;m++)P[m]=2;for(m=26801;m<=26803;m++)P[m]=2;for(m=26811;m<=26813;m++)P[m]=2;for(m=26847;m<=26870;m++)P[m]=2;for(m=26891;m<=26899;m++)P[m]=0;for(m=26901;m<=26923;m++)P[m]=0;for(m=26929;m<=26946;m++)P[m]=0;for(m=26948;m<=26998;m++)P[m]=0;for(m=27037;m<=27040;m++)P[m]=0;for(m=27205;m<=27232;m++)P[m]=0;for(m=27258;m<=27260;m++)P[m]=0;for(m=27391;m<=27398;m++)P[m]=0;for(m=27561;m<=27564;m++)P[m]=0;for(m=27571;m<=27574;m++)P[m]=0;for(m=27581;m<=27584;m++)P[m]=0;for(m=27591;m<=27594;m++)P[m]=0;for(m=28191;m<=28193;m++)P[m]=0;for(m=28348;m<=28358;m++)P[m]=0;for(m=28402;m<=28432;m++)P[m]=0;for(m=28462;m<=28492;m++)P[m]=0;for(m=29118;m<=29122;m++)P[m]=0;for(m=29168;m<=29172;m++)P[m]=0;for(m=29177;m<=29185;m++)P[m]=0;for(m=29187;m<=29195;m++)P[m]=0;for(m=29900;m<=29903;m++)P[m]=0;for(m=30161;m<=30179;m++)P[m]=0;for(m=30491;m<=30494;m++)P[m]=0;for(m=30729;m<=30732;m++)P[m]=0;for(m=31251;m<=31259;m++)P[m]=0;for(m=31265;m<=31268;m++)P[m]=0;for(m=31275;m<=31279;m++)P[m]=0;for(m=31281;m<=31297;m++)P[m]=0;for(m=31461;m<=31469;m++)P[m]=0;for(m=31491;m<=31495;m++)P[m]=0;for(m=31917;m<=31922;m++)P[m]=0;for(m=31965;m<=32e3;m++)P[m]=0;for(m=32001;m<=32003;m++)P[m]=2;for(m=32005;m<=32031;m++)P[m]=2;for(m=32033;m<=32060;m++)P[m]=2;for(m=32064;m<=32067;m++)P[m]=2;for(m=32074;m<=32077;m++)P[m]=2;for(m=32081;m<=32086;m++)P[m]=0;for(m=32107;m<=32130;m++)P[m]=0;for(m=32133;m<=32159;m++)P[m]=0;for(m=32164;m<=32167;m++)P[m]=2;for(m=32180;m<=32199;m++)P[m]=0;for(m=32201;m<=32260;m++)P[m]=0;for(m=32301;m<=32360;m++)P[m]=0;for(m=32601;m<=32662;m++)P[m]=0;for(m=32664;m<=32667;m++)P[m]=2;for(m=32701;m<=32761;m++)P[m]=0;for(m=53001;m<=53004;m++)P[m]=0;for(m=53008;m<=53019;m++)P[m]=0;for(m=53021;m<=53032;m++)P[m]=0;for(m=53034;m<=53037;m++)P[m]=0;for(m=53042;m<=53046;m++)P[m]=0;for(m=53074;m<=53080;m++)P[m]=0;for(m=54001;m<=54004;m++)P[m]=0;for(m=54008;m<=54019;m++)P[m]=0;for(m=54021;m<=54032;m++)P[m]=0;for(m=54034;m<=54037;m++)P[m]=0;for(m=54042;m<=54046;m++)P[m]=0;for(m=54048;m<=54053;m++)P[m]=0;for(m=54074;m<=54080;m++)P[m]=0;for(m=54098;m<=54101;m++)P[m]=0;for(m=102001;m<=102040;m++)P[m]=0;for(m=102042;m<=102063;m++)P[m]=0;for(m=102065;m<=102067;m++)P[m]=0;for(m=102070;m<=102117;m++)P[m]=0;for(m=102122;m<=102216;m++)P[m]=0;for(m=102221;m<=102377;m++)P[m]=0;for(m=102382;m<=102388;m++)P[m]=0;for(m=102389;m<=102398;m++)P[m]=2;for(m=102399;m<=102444;m++)P[m]=0;for(m=102445;m<=102447;m++)P[m]=2;for(m=102448;m<=102458;m++)P[m]=0;for(m=102459;m<=102468;m++)P[m]=2;for(m=102469;m<=102499;m++)P[m]=0;for(m=102500;m<=102519;m++)P[m]=1;for(m=102520;m<=102524;m++)P[m]=0;for(m=102525;m<=102529;m++)P[m]=2;for(m=102530;m<=102588;m++)P[m]=0;for(m=102590;m<=102598;m++)P[m]=0;for(m=102601;m<=102603;m++)P[m]=0;for(m=102605;m<=102628;m++)P[m]=0;for(m=102629;m<=102646;m++)P[m]=2;for(m=102648;m<=102700;m++)P[m]=2;for(m=102701;m<=102703;m++)P[m]=0;for(m=102707;m<=102730;m++)P[m]=2;for(m=102733;m<=102758;m++)P[m]=2;for(m=102767;m<=102900;m++)P[m]=0;for(m=102901;m<=102933;m++)P[m]=2;for(m=102934;m<=102950;m++)P[m]=13;for(m=102951;m<=102955;m++)P[m]=0;for(m=102961;m<=102963;m++)P[m]=0;for(m=102965;m<=102969;m++)P[m]=0;for(m=102971;m<=102973;m++)P[m]=0;for(m=102975;m<=102989;m++)P[m]=0;for(m=102990;m<=102992;m++)P[m]=1;for(m=102997;m<=103002;m++)P[m]=0;for(m=103003;m<=103008;m++)P[m]=2;for(m=103009;m<=103011;m++)P[m]=0;for(m=103012;m<=103014;m++)P[m]=2;for(m=103019;m<=103021;m++)P[m]=0;for(m=103022;m<=103024;m++)P[m]=2;for(m=103029;m<=103031;m++)P[m]=0;for(m=103032;m<=103034;m++)P[m]=2;for(m=103065;m<=103068;m++)P[m]=0;for(m=103074;m<=103076;m++)P[m]=0;for(m=103077;m<=103079;m++)P[m]=1;for(m=103080;m<=103082;m++)P[m]=0;for(m=103083;m<=103085;m++)P[m]=2;for(m=103090;m<=103093;m++)P[m]=0;for(m=103097;m<=103099;m++)P[m]=0;for(m=103100;m<=103102;m++)P[m]=2;for(m=103107;m<=103109;m++)P[m]=0;for(m=103110;m<=103112;m++)P[m]=2;for(m=103113;m<=103116;m++)P[m]=0;for(m=103117;m<=103120;m++)P[m]=2;for(m=103153;m<=103157;m++)P[m]=0;for(m=103158;m<=103162;m++)P[m]=2;for(m=103163;m<=103165;m++)P[m]=0;for(m=103166;m<=103168;m++)P[m]=1;for(m=103169;m<=103171;m++)P[m]=2;for(m=103186;m<=103188;m++)P[m]=0;for(m=103189;m<=103191;m++)P[m]=2;for(m=103192;m<=103195;m++)P[m]=0;for(m=103196;m<=103199;m++)P[m]=2;for(m=103200;m<=103224;m++)P[m]=0;for(m=103225;m<=103227;m++)P[m]=1;for(m=103232;m<=103237;m++)P[m]=0;for(m=103238;m<=103243;m++)P[m]=2;for(m=103244;m<=103246;m++)P[m]=0;for(m=103247;m<=103249;m++)P[m]=2;for(m=103254;m<=103256;m++)P[m]=0;for(m=103257;m<=103259;m++)P[m]=2;for(m=103264;m<=103266;m++)P[m]=0;for(m=103267;m<=103269;m++)P[m]=2;for(m=103300;m<=103375;m++)P[m]=0;for(m=103381;m<=103383;m++)P[m]=0;for(m=103384;m<=103386;m++)P[m]=1;for(m=103387;m<=103389;m++)P[m]=0;for(m=103390;m<=103392;m++)P[m]=2;for(m=103397;m<=103399;m++)P[m]=0;for(m=103400;m<=103471;m++)P[m]=2;for(m=103476;m<=103478;m++)P[m]=0;for(m=103479;m<=103481;m++)P[m]=2;for(m=103486;m<=103488;m++)P[m]=0;for(m=103489;m<=103491;m++)P[m]=2;for(m=103492;m<=103495;m++)P[m]=0;for(m=103496;m<=103499;m++)P[m]=2;for(m=103528;m<=103543;m++)P[m]=0;for(m=103544;m<=103548;m++)P[m]=2;for(m=103549;m<=103551;m++)P[m]=0;for(m=103552;m<=103554;m++)P[m]=1;for(m=103555;m<=103557;m++)P[m]=2;for(m=103558;m<=103560;m++)P[m]=0;for(m=103571;m<=103573;m++)P[m]=0;for(m=103574;m<=103576;m++)P[m]=2;for(m=103577;m<=103580;m++)P[m]=0;for(m=103581;m<=103583;m++)P[m]=2;for(m=103595;m<=103694;m++)P[m]=0;for(m=103696;m<=103699;m++)P[m]=0;for(m=103700;m<=103793;m++)P[m]=2;for(m=103794;m<=103890;m++)P[m]=0;for(m=103891;m<=103896;m++)P[m]=2;for(m=103900;m<=103971;m++)P[m]=2;for(m=103972;m<=103977;m++)P[m]=0;for(m=112e3;m<=112101;m++)P[m]=0;const rwe={102113:!0,102100:!0,3857:!0,3785:!0},iwe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},Hj='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',HA=[-20037508342788905e-9,20037508342788905e-9],WA=[-20037508342787e-6,20037508342787e-6],Are={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:HA,origin:WA,dx:1e-5},102100:{wkTemplate:Hj,valid:HA,origin:WA,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:HA,origin:WA,dx:1e-5},3857:{wkTemplate:Hj,valid:HA,origin:WA,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Sn(t,e){return t===e||t!=null&&e!=null&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||_1(t)&&_1(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function e1(t){return No(t)&&t.wkid&&Are[t.wkid]||null}function Ore(t){return!!No(t)&&(t.wkid?P[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function jE(t){return!(Lp(t)||Dp(t))}function HE(t){return No(t)&&t.wkid===4326}function Rre(t){return No(t)&&t.wkid===pu.CGCS2000}function _1(t){return No(t)&&t.wkid!=null&&rwe[t.wkid]===!0}function Tk(t){return No(t)&&t.wkid===32662}function Sk(t){return t===pu.GCSMARS2000||t===pu.GCSMARS2000_SPHERE}function Lp(t){return No(t)&&t.wkid!=null&&Sk(t.wkid)}function Ek(t){return t===pu.GCSMOON2000}function Dp(t){return No(t)&&t.wkid!=null&&Ek(t.wkid)}function swe(t){return No(t)&&t.wkid!=null&&iwe[t.wkid]===!0}function No(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const nwe={wkid:4326,wkt:II(Are[4326].wkTemplate,{Central_Meridian:"0.0"})},owe={wkid:102100,latestWkid:3857},awe={wkid:32662};function Ck(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Pre=Ck(Yt),Ak=Ck(pp),Ok=Ck(im),Mre={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Yt.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Cr(t){return t!=null&&(Lp(t)||Sn(t,Ak))?pp:t!=null&&(Dp(t)||Sn(t,Ok))?im:Yt}function Jat(t){return Sk(t)?pp:Ek(t)?im:Yt}const Rk=39.37,lwe=Yt.radius*Math.PI/200,$re=/UNIT\[([^\]]+)\]\]$/i,t1=P,Ire=/UNIT\[([^\]]+)\]/i,cwe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),uwe=Ec()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),cd=t=>t*t,Fm=t=>t*t*t,WE={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:cd(.001)},"square-centimeters":{inBaseUnits:cd(.01)},"square-decimeters":{inBaseUnits:cd(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:cd(1e3)},"square-inches":{inBaseUnits:cd(.0254)},"square-feet":{inBaseUnits:cd(.3048)},"square-yards":{inBaseUnits:cd(.9144)},"square-miles":{inBaseUnits:cd(1609.344)},"square-us-feet":{inBaseUnits:cd(1200/3937)},acres:{inBaseUnits:.0015625*cd(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*Fm(.001)},"cubic-centimeters":{inBaseUnits:1e3*Fm(.01)},"cubic-decimeters":{inBaseUnits:1e3*Fm(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*Fm(1e3)},"cubic-inches":{inBaseUnits:1e3*Fm(.0254)},"cubic-feet":{inBaseUnits:1e3*Fm(.3048)},"cubic-yards":{inBaseUnits:1e3*Fm(.9144)},"cubic-miles":{inBaseUnits:1e3*Fm(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},hwe=(()=>{const t={};for(const e in WE)for(const r in WE[e].units)t[r]=e;return t})();function dwe(t,e,r){return t*WE[r].units[e].inBaseUnits}function pwe(t,e,r){return t/WE[r].units[e].inBaseUnits}const fwe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function qF(t){const e=hwe[t];if(!e)throw new Error("unknown type");return e}function Wj(t,e=null){return e=e||qF(t),WE[e].baseUnit===t}function so(t,e,r){if(e===r)return t;const i=qF(e);if(i!==qF(r))throw new Error("incompatible units");const s=Wj(e,i)?t:dwe(t,e,i);return Wj(r,i)?s:pwe(s,r,i)}function Qat(t,e,r){switch(r){case"metric":return mwe(t,e);case"imperial":return ywe(t,e);default:return r}}function Kat(t,e,r){switch(r){case"metric":return gwe(t,e);case"imperial":return _we(t,e);default:return r}}function mwe(t,e){const r=so(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function gwe(t,e){const r=so(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function ywe(t,e){const r=so(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function _we(t,e){const r=so(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function elt(t,e){const r=so(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function tlt(t,e){const r=so(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function vwe(t,e,r){return so(t,e,"meters")/(r*Math.PI/180)}function Lre(t){return uwe.fromJSON(t.toLowerCase())||null}function YF(t){if(t!=null&&!jE(t))return 1;const e=fa(t);return e>1e5?1:e}function bwe(t){return fa(t)>=Cr(t).metersPerDegree?"meters":BI(t)}function fa(t,e=Yt.metersPerDegree){return wwe(t,!0)??e}function wwe(t,e=!1){const r=t!=null?t.wkid:null,i=t!=null?t.wkt:null;let s=null;if(r){if(Sk(r))return pp.metersPerDegree;if(Ek(r))return im.metersPerDegree;s=t1.values[t1[r]],!s&&e&&cwe.has(r)&&(s=lwe)}else i&&(Fre(i)?s=qj($re.exec(i),s):Nre(i)&&(s=qj(Ire.exec(i),s)));return s}function qj(t,e){return t&&t[1]?Dre(t[1]):e}function Dre(t){return parseFloat(t.split(",")[1])}function BI(t){const e=t!=null?t.wkid:null,r=t!=null?t.wkt:null;let i=null;if(e)i=t1.units[t1[e]];else if(r){const s=Fre(r)?$re:Nre(r)?Ire:null;if(s){const n=s.exec(r);n&&n[1]&&(i=Twe(n[1]))}}return i!=null?Lre(i):null}function rlt(t){const e=BI(t);return e!=null&&fwe.includes(e)?e:null}function Nre(t){return/^GEOCCS/i.test(t)}function Fre(t){return/^PROJCS/i.test(t)}const xwe=1e-7;function Twe(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!t1.units.includes(r)){const i=Dre(t);r=null;const s=t1.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<xwe){r=t1.units[n];break}}return r}function ilt(t){const e=BI(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const Swe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Ewe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},Cwe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},slt=Ec()(Swe),nlt=Ec()(Ewe),olt=Ec()(Cwe);var Pd;let si=Pd=class extends Ke{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Pd.WebMercator;if(t.wkid===4326)return Pd.WGS84}const e=new Pd;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return HE(this)}get isWebMercator(){return _1(this)}get isGeographic(){return Ore(this)}get isWrappable(){return swe(this)}get metersPerUnit(){return fa(this)}get unit(){return BI(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Pd.WGS84)return Pd.WGS84;if(this===Pd.WebMercator)return Pd.WebMercator;const t=new Pd;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ye(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||i?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):r?s.id===e&&s.referenceServiceName===r:s.id===e}return Sn(this,t)}toJSON(t){return this.write(void 0,t)}};si.GCS_NAD_1927=null,si.WGS84=null,si.WebMercator=null,si.PlateCarree=null,h([f({readOnly:!0})],si.prototype,"isWGS84",null),h([f({readOnly:!0})],si.prototype,"isWebMercator",null),h([f({readOnly:!0})],si.prototype,"isGeographic",null),h([f({readOnly:!0})],si.prototype,"isWrappable",null),h([f({type:Qs,json:{write:!0}})],si.prototype,"latestWkid",void 0),h([f({readOnly:!0})],si.prototype,"metersPerUnit",null),h([f({readOnly:!0})],si.prototype,"unit",null),h([f({type:Qs,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],si.prototype,"wkid",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],si.prototype,"wkt",void 0),h([qr("wkt"),qr("web-scene","wkt")],si.prototype,"writeWkt",null),h([f({type:Qs,json:{write:!0}})],si.prototype,"vcsWkid",void 0),h([f({type:Qs,json:{write:!0}})],si.prototype,"latestVcsWkid",void 0),h([f()],si.prototype,"imageCoordinateSystem",void 0),si=Pd=h([F("esri.geometry.SpatialReference")],si),si.prototype.toJSON.isDefaultToJSON=!0,si.GCS_NAD_1927=new si({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),si.WGS84=new si(nwe),si.WebMercator=new si(owe),si.PlateCarree=new si(awe),Object.freeze&&(Object.freeze(si.GCS_NAD_1927),Object.freeze(si.WGS84),Object.freeze(si.WebMercator));const yt=si,Awe="4.27";let YC=Awe;YC=`4.27.0-next.${$I}`;const Owe={async request(t,e){var a,l;const{default:r}=await he(()=>Promise.resolve().then(()=>jwe),void 0),i=t.options,s=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&((a=bre(t.url))!=null&&a.after)?s:"array-buffer";const n=await r(t.url,i),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((l=n.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Hi;function alt(t){Hi=t}function llt(t){const e=Hi==null?void 0:Hi.findCredential(t);return e!=null&&e.token?Ere(t,"token",e.token):t}ie("host-webworker");const Rwe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function Ure(t){const e=Vh(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!Rwe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function zre(t,e,r=!1,i){return new Promise((s,n)=>{if(Js(i))return void n(Yj());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),s(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",n(Yj())};const c=()=>{ie("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i!=null&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i!=null&&i.addEventListener("abort",l),ie("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function Yj(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}function Pwe(t){Er.request.crossOriginNoCorsDomains||(Er.request.crossOriginNoCorsDomains={});const e=Er.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[Vh(r)??""]=0:(e[Vh("http://"+r)??""]=0,e[Vh("https://"+r)??""]=0)}function Mwe(t){const e=Er.request.crossOriginNoCorsDomains;if(e){let r=Vh(t);if(r)return r=r.toLowerCase(),!tx(r,fk())&&e[r]<Date.now()-36e5}return!1}async function $we(t){var s;const e=Er.request.crossOriginNoCorsDomains,r=Vh(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=da(t);t=i.path,((s=i.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Es(t,e){var c;const r=Ip(t),i=GE(t);i||r||(t=Gf(t));const s={url:t,requestOptions:{...e}};let n=bre(t);if(n){const u=await kwe(n,s);if(u!=null)return{data:u,getHeader:Pk,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(ie("host-webworker")||ie("host-node")))throw fp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw fp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw fp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await Fwe(),TM)return TM.execute(t,e);const o=new AbortController;Uo(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Eh.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await Vwe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let TM;const Eh=Er.request,kre="FormData"in globalThis,Iwe=[499,498,403,401],Lwe=["COM_0056","COM_0057","SB_0008"],Dwe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],Pk=()=>null,SM=Symbol();function Nwe(t){const e=Vh(t);e&&!Es._corsServers.includes(e)&&Es._corsServers.push(e)}function Xj(t){const e=Vh(t);return!e||e.endsWith(".arcgis.com")||Es._corsServers.includes(e)||gk(e)}function fp(t,e,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:Pk,ssl:!1};if(e instanceof X)return e.details?(e.details=ye(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=n,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i==null?void 0:i.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=SM in e?e[SM]:e}return gs(e)?wr():new X(t,s,n)}async function Fwe(){ie("host-webworker")?TM||(TM=await he(()=>import("./request-fd575ccf.js"),[])):Es._abortableFetch||(Es._abortableFetch=globalThis.fetch.bind(globalThis))}async function XF(){Hi||await he(()=>import("./IdentityManager-ddf06395.js"),["assets/IdentityManager-ddf06395.js","assets/widget-ebe44be8.js"])}async function Uwe(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,s=r.body;let n=null,o=null;if(kre&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:r.cacheBust&&!("polyfill"in Es._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Eh.priority,redirect:"follow",signal:i},(n||o)&&(t.fetchOptions.body=n||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&Er.apiKey&&Ure(e)&&(r.query||(r.query={}),r.query.token=Er.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!Bre(e)&&!Js(i)){let l;r.authMode==="immediate"?(await XF(),l=await Hi.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await XF(),l=await Hi.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):Hi&&(l=Hi.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function Bre(t){return Dwe.some(e=>e.test(t))}async function zwe(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},s=GE(e)||Ip(e),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Eh.timeout;let a=!1;if(!s){t.useSSL&&(e=bk(e)),r.cacheBust&&i.cache==="default"&&(e=Ere(e,"request.preventCache",Date.now()));let p={...r.query};t.credentialToken&&(p.token=t.credentialToken);let g=VE(p);ie("esri-url-encodes-apostrophe")&&(g=g.replaceAll("'","%27"));const y=e.length+1+g.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||y>Eh.maxUrlLength;const v=r.useProxy||!!zI(e);if(v){const w=kbe(e);_=w.path,!a&&_.length+1+y>Eh.maxUrlLength&&(a=!0),w.query&&(p={...w.query,...p})}if(i.method==="HEAD"&&(a||v)){if(a)throw y>Eh.maxUrlLength?fp("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):fp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw fp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=YD(e,p):(i.body=VE(p),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=YD(e,p),v&&(t.useProxy=!0,e=`${_}?${e}`),p.token&&kre&&i.body instanceof FormData&&!Rbe(e)&&i.body.set("token",p.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!tx(e,fk())){if(gk(e))t.withCredentials=!0;else if(Hi){const w=Hi.findServerInfo(e);w!=null&&w.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",Mwe(e)&&await $we(a?YD(e,p):e))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||Bwe(r.headers)||!s&&!t.useProxy&&Eh.proxyUrl&&!Xj(e)){if(l=await Es._abortableFetch(e,i),t.useProxy||Nwe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Zj(c,"application/xml");break;case"document":c=Zj(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[n==="blob"?"size":"byteLength"]<=750)try{const g=await new Response(c).json();g.error&&(c=g)}catch{}}n==="image"&&c instanceof Blob&&(c=await Jj(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Jj(e,t)}catch(p){if(p.name==="AbortError")throw d?new Error("Timeout exceeded"):wr("Request canceled");if(!(!l&&p instanceof TypeError&&Eh.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||Xj(e))throw p;t.redoRequest=!0,Bbe({proxyUrl:Eh.proxyUrl,urlPrefix:Vh(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function kwe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(s){r=fp("request:interceptor",s,e)}if((i instanceof Error||i instanceof X)&&(r=fp("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function Bwe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Zj(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function Vwe(t){var n,o;let e,r;await Uwe(t);try{do[e,r]=await zwe(t);while(!await Gwe(t,e,r))}catch(a){const l=fp("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(n=t.interceptor)!=null&&n.error&&t.interceptor.error(l),l}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((o=r.user)!=null&&o.username)&&!gk(i)){const a=Vh(i,!0);a&&Eh.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&Pwe(r.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Hi){const a=Hi.findServerInfo(s.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Hi.findCredential(l,s.userId);c&&Hi._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getHeader:e?a=>e==null?void 0:e.headers.get(a):Pk,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function Gwe(t,e,r){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[SM]=r,s.details=r.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[SM]=r,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o==null?void 0:o.toUpperCase());const l=i.authMode;if(n===403&&(a===4||(c=s.message)!=null&&c.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&Iwe.includes(n)&&!Bre(t.params.url)&&(n!==403||o&&!Lwe.includes(o)&&(a==null||a===2&&t.credentialToken))){await XF();try{const u=await Hi.getCredential(t.params.url,{error:fp("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=u}}if(s)throw s;return!0}function Jj(t,e,r=!1){const i=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Eh.priority,s.src=t,zre(s,t,r,i)}Es._abortableFetch=null,Es._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const jwe=Object.freeze(Object.defineProperty({__proto__:null,default:Es},Symbol.toStringTag,{value:"Module"}));function Ur(t,e,r){let i,s;return e===void 0||Array.isArray(e)?(s=t,r=e,i=[void 0]):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=Yte(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let Md=class extends Ke{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=yt.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof yt)return e;if(e!=null){const i=new yt;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};h([f()],Md.prototype,"type",void 0),h([f({readOnly:!0})],Md.prototype,"cache",null),h([f({readOnly:!0})],Md.prototype,"extent",null),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Md.prototype,"hasM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Md.prototype,"hasZ",void 0),h([f({type:yt,json:{write:!0},value:yt.WGS84})],Md.prototype,"spatialReference",void 0),h([Ur("spatialReference")],Md.prototype,"readSpatialReference",null),Md=h([F("esri.geometry.Geometry")],Md);const Z0=Md,Hwe=Object.prototype.toString;function Wwe(t){const e="__accessorMetadata__"in t?tn(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return qwe.apply(this,r)}}function qwe(t,e,r,i){MI(t,e).cast=i}function Ywe(t){return(e,r)=>{MI(e,t).cast=e[r]}}function Gi(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&Hwe.call(t[0])==="[object Function]"?Wwe(t[0]):t.length===1&&typeof t[0]=="string"?Ywe(t[0]):void 0}function Xwe(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+s*s)}const Zwe=57.29577951308232,Jwe=.017453292519943;function Qj(t){return t*Zwe}function Kj(t){return t*Jwe}function eH(t){return t/Yt.radius}function EM(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Yt.radius))}function ZF(t){return t.wkid!=null||t.wkt!=null}const XD=[0,0];function CM(t,e,r,i,s){const n=t,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,XD,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,XD,i),[o.xmax,o.ymax]=e(n.xmax,n.ymax,XD,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let u=0;u<a.length;u++){const d=a[u];c=[],l.push(c);for(let p=0;p<d.length;p++)c.push(e(d[p][0],d[p][1],[0,0],i)),d[p].length>2&&c[p].push(d[p][2]),d[p].length>3&&c[p].push(d[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function v0(t,e){const r=t&&(ZF(t)?t:t.spatialReference),i=e&&(ZF(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!Sn(i,r)||_1(i)&&HE(r)||_1(r)&&HE(i))}function ev(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(ZF(e)?e:e.spatialReference);return v0(r,i)?Sn(r,i)?ye(t):_1(i)?CM(t,aw,yt.WebMercator,!1,ye(t)):HE(i)?CM(t,XS,yt.WGS84,!1,ye(t)):null:null}function aw(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=Kj(e);return r[0]=Kj(t)*Yt.radius,r[1]=Yt.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function XS(t,e,r=[0,0],i=!1){const s=Qj(t/Yt.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=Qj(Math.PI/2-2*Math.atan(Math.exp(-e/Yt.radius))),r}function Ow(t,e=!1,r=ye(t)){return CM(t,aw,yt.WebMercator,e,r)}function qA(t,e=!1,r=ye(t)){return CM(t,XS,yt.WGS84,e,r)}var DR;const O2=[0,0];function tH(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Ca=DR=class extends Z0{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],r=n[2],i=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new yt(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)ne.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)ne.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=aw(n.longitude,n.latitude,O2);t=a[0],e=a[1]}}}else tH(r)?(s=r,r=null):tH(i)&&(s=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?ne.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&ne.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return XS(e,r,O2)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",aw(r,t,O2)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return XS(t,e,O2)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",aw(t,e,O2)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new DR;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return DR.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!n.equals(u))if(n.isWebMercator&&u.isWGS84)[l,c]=aw(l,c),u=n;else{if(!n.isWGS84||!u.isWebMercator)return!1;[l,c]=XS(l,c),u=n}return e===l&&r===c&&i===o&&s===a&&n.wkid===u.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=e1(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,s=2*i;let n;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s),this._set("x",e),this}distance(t){return Xwe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],Ca.prototype,"cache",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ca.prototype,"hasM",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ca.prototype,"hasZ",null),h([f({type:Number})],Ca.prototype,"latitude",null),h([f({type:Number})],Ca.prototype,"longitude",null),h([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Gi(t=>isNaN(t)?t:Rh(t))],Ca.prototype,"x",void 0),h([qr("x")],Ca.prototype,"writeX",null),h([Ur("x")],Ca.prototype,"readX",null),h([f({type:Number,json:{write:!0}})],Ca.prototype,"y",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ca.prototype,"z",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ca.prototype,"m",void 0),Ca=DR=h([F("esri.geometry.Point")],Ca),Ca.prototype.toJSON.isDefaultToJSON=!0;const at=Ca,ZD=[0,0];function Mk(t,e){return e!=null&&ra(t,e.x,e.y,e.z)}function ult(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!rx(t,r))return!1;return!0}function Qwe(t,e){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?ra(t,r,i,s)&&ra(t,r,o,s)&&ra(t,n,o,s)&&ra(t,n,i,s)&&ra(t,r,i,a)&&ra(t,r,o,a)&&ra(t,n,o,a)&&ra(t,n,i,a):ra(t,r,i)&&ra(t,r,o)&&ra(t,n,o)&&ra(t,n,i)}function rx(t,e){return ra(t,e[0],e[1])}function Kwe(t,e){return ra(t,e[0],e[1],e[2])}function ra(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function exe(t,e){return ZD[1]=e.y,ZD[0]=e.x,txe(t,ZD)}function txe(t,e){return Vre(t.rings,e)}function Vre(t,e){if(!t)return!1;if(rxe(t))return rH(!1,t,e);let r=!1;for(let i=0,s=t.length;i<s;i++)r=rH(r,t[i],e);return r}function rxe(t){return!Array.isArray(t[0][0])}function rH(t,e,r){const[i,s]=r;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[d,p]=e[o];(u<s&&p>=s||p<s&&u>=s)&&c+(s-u)/(p-u)*(d-c)<i&&(n=!n)}return n}function ixe(t,e){return Mk(t,e)}function sxe(t,e){const r=t.hasZ&&e.hasZ;let i,s,n;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function nxe(t,e){const{points:r,hasZ:i}=e,s=i?Kwe:rx;for(const n of r)if(s(t,n))return!0;return!1}const v1=[0,0],b1=[0,0],w1=[0,0],x1=[0,0],oxe=[v1,b1,w1,x1],Gre=[[w1,v1],[v1,b1],[b1,x1],[x1,w1]];function axe(t,e){return lxe(t,e.rings)}function lxe(t,e){v1[0]=t.xmin,v1[1]=t.ymax,b1[0]=t.xmax,b1[1]=t.ymax,w1[0]=t.xmin,w1[1]=t.ymin,x1[0]=t.xmax,x1[1]=t.ymin;for(const r of oxe)if(Vre(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(rx(t,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(rx(t,n)||jre(i,n,Gre))return!0;i=n}}return!1}function cxe(t,e){v1[0]=t.xmin,v1[1]=t.ymax,b1[0]=t.xmax,b1[1]=t.ymax,w1[0]=t.xmin,w1[1]=t.ymin,x1[0]=t.xmax,x1[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(rx(t,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(rx(t,o)||jre(s,o,Gre))return!0;s=o}}return!1}const Qn=[0,0];function uxe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(JF(n,o,c,u,Qn)&&!(Qn[0]===n[0]&&Qn[1]===n[1]||Qn[0]===c[0]&&Qn[1]===c[1]||Qn[0]===o[0]&&Qn[1]===o[1]||Qn[0]===u[0]&&Qn[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],u=r[l+1];if(JF(o,a,c,u,Qn)&&!(Qn[0]===o[0]&&Qn[1]===o[1]||Qn[0]===c[0]&&Qn[1]===c[1]||Qn[0]===a[0]&&Qn[1]===a[1]||Qn[0]===u[0]&&Qn[1]===u[1]))return!0}}}return!1}function jre(t,e,r){for(let i=0;i<r.length;i++)if(JF(t,e,r[i][0],r[i][1]))return!0;return!1}function JF(t,e,r,i,s){const[n,o]=t,[a,l]=e,[c,u]=r,[d,p]=i,g=d-c,y=n-c,_=a-n,v=p-u,w=o-u,T=l-o,x=v*_-g*T;if(x===0)return!1;const E=(g*w-v*y)/x,O=(_*w-T*y)/x;return E>=0&&E<=1&&O>=0&&O<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function hxe(t){switch(t){case"esriGeometryEnvelope":case"extent":return sxe;case"esriGeometryMultipoint":case"multipoint":return nxe;case"esriGeometryPoint":case"point":return ixe;case"esriGeometryPolygon":case"polygon":return axe;case"esriGeometryPolyline":case"polyline":return cxe}}var kc;function dxe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function Um(t,e,r){return e==null?r:r==null?e:t(e,r)}let Mn=kc=class extends Z0{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,s){return dxe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?yt.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:s??yt.WGS84}}static fromBounds(t,e){return new kc({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new kc({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new at({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new kc;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&v0(e,r)&&(t=e.isWebMercator?Ow(t):qA(t,!0)),t.type==="point"?Mk(this,t):t.type==="extent"&&Qwe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&v0(e,r)&&(t=e.isWebMercator?Ow(t):qA(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!Sn(e,r)&&v0(e,r)&&(t=e.isWebMercator?Ow(t):qA(t,!0)),hxe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Um(Math.min,this.zmin,t.zmin),this.zmax=Um(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Um(Math.min,this.mmin,t.mmin),this.mmax=Um(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Um(Math.max,this.zmin,t.zmin),this.zmax=Um(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Um(Math.max,this.mmin,t.mmin),this.mmax=Um(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=e1(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?qA(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new yt(II((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const s=r??e1(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||e1(o);const[d,p]=t.valid;u=this._normalizeX(this.xmin,t);const g=u.x,y=u.frameId;u=this._normalizeX(this.xmax,t);const _=u.x,v=u.frameId,w=g===_&&a>0;if(a>2*p){const T=new kc(l<c?g:_,s,p,n,o),x=new kc(d,s,l<c?_:g,n,o),E=new kc(0,s,p,n,o),O=new kc(d,s,0,n,o),A=[],$=[];T.contains(E)&&A.push(y),T.contains(O)&&$.push(y),x.contains(E)&&A.push(v),x.contains(O)&&$.push(v);for(let M=y+1;M<v;M++)A.push(M),$.push(M);e.push({extent:T,frameIds:[y]},{extent:x,frameIds:[v]},{extent:E,frameIds:A},{extent:O,frameIds:$})}else g>_||w?e.push({extent:new kc(g,s,p,n,o),frameIds:[y]},{extent:new kc(d,s,_,n,o),frameIds:[v]}):e.push({extent:new kc(g,s,_,n,o),frameIds:[y]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[r,i]=e.valid,s=2*i;let n,o=0;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s,o=n):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s,o=-n),{x:t,frameId:o}}};h([f({readOnly:!0})],Mn.prototype,"cache",null),h([f({readOnly:!0})],Mn.prototype,"center",null),h([f({readOnly:!0})],Mn.prototype,"extent",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Mn.prototype,"hasM",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Mn.prototype,"hasZ",null),h([f({readOnly:!0})],Mn.prototype,"height",null),h([f({readOnly:!0})],Mn.prototype,"width",null),h([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Mn.prototype,"xmin",void 0),h([f({type:Number,json:{write:!0}})],Mn.prototype,"ymin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Mn.prototype,"mmin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Mn.prototype,"zmin",void 0),h([f({type:Number,json:{write:!0}})],Mn.prototype,"xmax",void 0),h([f({type:Number,json:{write:!0}})],Mn.prototype,"ymax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Mn.prototype,"mmax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Mn.prototype,"zmax",void 0),Mn=kc=h([F("esri.geometry.Extent")],Mn),Mn.prototype.toJSON.isDefaultToJSON=!0;const Wr=Mn;let ZS;var tte,rte;const pxe=((tte=globalThis.esriConfig)==null?void 0:tte.locale)??((rte=globalThis.dojoConfig)==null?void 0:rte.locale);function Hre(){var t;return pxe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function Gh(){return ZS===void 0&&(ZS=Hre()),ZS}const JS=[];function Wre(t){return JS.push(t),{remove(){JS.splice(JS.indexOf(t),1)}}}const QF=[];function $k(t){return QF.push(t),{remove(){JS.splice(QF.indexOf(t),1)}}}function fxe(){const t=Hre();ZS!==t&&(ZS=t,[...QF].forEach(e=>{e.call(null,t)}),[...JS].forEach(e=>{e.call(null,t)}))}var ite;(ite=globalThis.addEventListener)==null||ite.call(globalThis,"languagechange",fxe);let YA;function mxe(t){return YA&&!YA.destroyed||(YA=t()),YA}var KF;const gxe=new Tn({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Bc=KF=class extends we{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new KF({categories:this.categories?ye(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=ev(this.extent,yt.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>gxe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};h([f()],Bc.prototype,"categories",void 0),h([f()],Bc.prototype,"disableExtraQuery",void 0),h([f({type:Wr})],Bc.prototype,"extent",void 0),h([f()],Bc.prototype,"filter",void 0),h([f()],Bc.prototype,"num",void 0),h([f()],Bc.prototype,"query",void 0),h([f()],Bc.prototype,"sortField",void 0),h([f()],Bc.prototype,"sortOrder",null),h([f()],Bc.prototype,"start",void 0),Bc=KF=h([F("esri.portal.PortalQueryParams")],Bc);const Lf=Bc;let Xy=class extends we{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};h([f()],Xy.prototype,"nextQueryParams",void 0),h([f()],Xy.prototype,"queryParams",void 0),h([f()],Xy.prototype,"results",void 0),h([f()],Xy.prototype,"total",void 0),Xy=h([F("esri.portal.PortalQueryResult")],Xy);const yxe=Xy;let uf=class extends Ke{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new X("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};h([f({type:Date})],uf.prototype,"created",void 0),h([f()],uf.prototype,"id",void 0),h([f()],uf.prototype,"portal",void 0),h([f()],uf.prototype,"title",void 0),h([f({readOnly:!0})],uf.prototype,"url",null),h([f()],uf.prototype,"username",void 0),uf=h([F("esri.portal.PortalFolder")],uf);const _xe=uf;let $n=class extends Ke{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,r=this.thumbnail;return e&&r&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return gl(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(s=>s.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return gl(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new X("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=tn(Lf,e);const s=gl(this.portal);return parseFloat(s.currentVersion)>5?(i=i||new Lf,s.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new Lf,i.query="group:"+this.id+(i.query?" "+i.query:""),s.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=gl(this.portal);return i.fetchSelf(i.authMode,!0,r).then(s=>{const n=s.contentCategorySetsGroupQuery;if(n){const o=new Lf;return o.disableExtraQuery=!0,o.num=1,o.query=n,i.queryGroups(o,r)}throw new X("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(s=>{if(s.total){const n=s.results[0],o=new Lf;return o.num=1,o.query=`typekeywords:"${e}"`,n.queryItems(o,r)}throw new X("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(s=>s.total?s.results[0].fetchData("json",r).then(n=>{const o=n&&n.categorySchema;return o&&o.length?o:[]}):[])}};h([f()],$n.prototype,"access",void 0),h([f({type:Date})],$n.prototype,"created",void 0),h([f()],$n.prototype,"description",void 0),h([f()],$n.prototype,"id",void 0),h([f()],$n.prototype,"isInvitationOnly",void 0),h([f({type:Date})],$n.prototype,"modified",void 0),h([f()],$n.prototype,"owner",void 0),h([f()],$n.prototype,"portal",void 0),h([f()],$n.prototype,"snippet",void 0),h([f()],$n.prototype,"sortField",void 0),h([f()],$n.prototype,"sortOrder",void 0),h([f()],$n.prototype,"tags",void 0),h([f()],$n.prototype,"thumbnail",void 0),h([f({readOnly:!0})],$n.prototype,"thumbnailUrl",null),h([f()],$n.prototype,"title",void 0),h([f({readOnly:!0})],$n.prototype,"url",null),$n=h([F("esri.portal.PortalGroup")],$n);const e6=$n,vxe=Object.freeze(Object.defineProperty({__proto__:null,default:e6},Symbol.toStringTag,{value:"Module"}));var t6;let Qi=t6=class extends Ke{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const s=_xe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=e6.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),he(()=>Promise.resolve().then(()=>Xre),void 0).then(({default:s})=>{r=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new e6({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new X("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new X("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new t6;return e.sourceJSON=t,e.read(t),e}};h([f()],Qi.prototype,"access",void 0),h([f({type:Date})],Qi.prototype,"created",void 0),h([f()],Qi.prototype,"culture",void 0),h([f()],Qi.prototype,"description",void 0),h([f()],Qi.prototype,"email",void 0),h([f()],Qi.prototype,"favGroupId",void 0),h([f()],Qi.prototype,"fullName",void 0),h([f({type:Date})],Qi.prototype,"modified",void 0),h([f()],Qi.prototype,"orgId",void 0),h([f()],Qi.prototype,"portal",void 0),h([f()],Qi.prototype,"preferredView",void 0),h([f()],Qi.prototype,"privileges",void 0),h([f()],Qi.prototype,"region",void 0),h([f()],Qi.prototype,"role",void 0),h([f()],Qi.prototype,"roleId",void 0),h([f()],Qi.prototype,"sourceJSON",void 0),h([f()],Qi.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Qi.prototype,"thumbnailUrl",null),h([f()],Qi.prototype,"units",void 0),h([f({readOnly:!0})],Qi.prototype,"userContentUrl",null),h([f({readOnly:!0})],Qi.prototype,"url",null),h([f()],Qi.prototype,"username",void 0),h([f()],Qi.prototype,"userType",void 0),Qi=t6=h([F("esri.portal.PortalUser")],Qi);const qre=Qi,bxe=Object.freeze(Object.defineProperty({__proto__:null,default:qre},Symbol.toStringTag,{value:"Module"}));var hf;let JD;const iH={PortalGroup:()=>he(()=>Promise.resolve().then(()=>vxe),void 0),PortalItem:()=>he(()=>Promise.resolve().then(()=>Xre),void 0),PortalUser:()=>he(()=>Promise.resolve().then(()=>bxe),void 0)};let Pe=hf=class extends qC(P0){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Er.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){sH.unregister(this),this.defaultBasemap=Oe(this.defaultBasemap),this.defaultDevBasemap=Oe(this.defaultDevBasemap),this.defaultVectorBasemap=Oe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=bi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Er.request.trustedServers.includes(e)||Er.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=qre.fromJSON(t),e.portal=this),e}load(t){const e=he(()=>Promise.resolve().then(()=>Wxe),void 0).then(({default:r})=>{qt(t),JD=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{var i;if(Hi){const s=Hi;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==hf.AUTH_MODE_AUTO||((i=this._esriIdCredentialCreateHandle)==null||i.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",wxe(new WeakRef(this))),sH.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await he(()=>import("./ElevationLayer-d6e8a686.js"),["assets/ElevationLayer-d6e8a686.js","assets/MultiOriginJSONSupport-d8471874.js","assets/ArcGISCachedService-be03d268.js","assets/TilemapCache-76a61a0f.js","assets/LRUCache-2af9f319.js","assets/ArcGISService-60eebca2.js","assets/OperationalLayer-abee1819.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/PortalLayer-9cdb0d77.js","assets/portalItemUtils-3c9a4460.js"])).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}fetchBasemaps(t,e){const r=new Lf;return r.query=t||(Er.apiKey&&Ure(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,e).then(i=>{if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',i.total){const s=i.results[0];return r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc",s.queryItems(r,e)}return null}).then(i=>{let s;return s=i&&i.total?i.results.filter(n=>n.type==="Web Map").map(n=>new JD({portalItem:n})):[],s})}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Js(t)?Promise.reject(wr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new Lf;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const s of e)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(s=>s.results)}return Js(t)?Promise.reject(wr()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Gh();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Gh();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return mxe(()=>new hf)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",s={authMode:t,query:{culture:Gh().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(i,s)}queryPortal(t,e,r,i){const s=tn(Lf,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new yxe({nextQueryParams:l,queryParams:s,total:a.total,results:hf._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(K1(l),a)));return r&&iH[r]?iH[r]().then(({default:o})=>(qt(i),n(o))):n()}signIn(){if(this.authMode===hf.AUTH_MODE_ANONYMOUS)return Promise.reject(new X("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Hi?Hi.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const s=hf._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===hf.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return Es(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new X("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new hf({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new X("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=JD.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let s=[];if(r){const n=i!=null?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Pe.AUTH_MODE_ANONYMOUS="anonymous",Pe.AUTH_MODE_AUTO="auto",Pe.AUTH_MODE_IMMEDIATE="immediate",h([f()],Pe.prototype,"access",void 0),h([f()],Pe.prototype,"allSSL",void 0),h([f()],Pe.prototype,"authMode",void 0),h([f()],Pe.prototype,"authorizedCrossOriginDomains",void 0),h([Ur("authorizedCrossOriginDomains")],Pe.prototype,"readAuthorizedCrossOriginDomains",null),h([f()],Pe.prototype,"basemapGalleryGroupQuery",void 0),h([f()],Pe.prototype,"bingKey",void 0),h([f()],Pe.prototype,"canListApps",void 0),h([f()],Pe.prototype,"canListData",void 0),h([f()],Pe.prototype,"canListPreProvisionedItems",void 0),h([f()],Pe.prototype,"canProvisionDirectPurchase",void 0),h([f()],Pe.prototype,"canSearchPublic",void 0),h([f()],Pe.prototype,"canShareBingPublic",void 0),h([f()],Pe.prototype,"canSharePublic",void 0),h([f()],Pe.prototype,"canSignInArcGIS",void 0),h([f()],Pe.prototype,"canSignInIDP",void 0),h([f()],Pe.prototype,"colorSetsGroupQuery",void 0),h([f()],Pe.prototype,"commentsEnabled",void 0),h([f({type:Date})],Pe.prototype,"created",void 0),h([f()],Pe.prototype,"credential",void 0),h([f()],Pe.prototype,"culture",void 0),h([f()],Pe.prototype,"currentVersion",void 0),h([f()],Pe.prototype,"customBaseUrl",void 0),h([f()],Pe.prototype,"defaultBasemap",void 0),h([Ur("defaultBasemap")],Pe.prototype,"readDefaultBasemap",null),h([f()],Pe.prototype,"defaultDevBasemap",void 0),h([Ur("defaultDevBasemap")],Pe.prototype,"readDefaultDevBasemap",null),h([f({type:Wr})],Pe.prototype,"defaultExtent",void 0),h([f()],Pe.prototype,"defaultVectorBasemap",void 0),h([Ur("defaultVectorBasemap")],Pe.prototype,"readDefaultVectorBasemap",null),h([f()],Pe.prototype,"description",void 0),h([f()],Pe.prototype,"devBasemapGalleryGroupQuery",void 0),h([f()],Pe.prototype,"eueiEnabled",void 0),h([f({readOnly:!0})],Pe.prototype,"extraQuery",null),h([f()],Pe.prototype,"featuredGroups",void 0),h([f()],Pe.prototype,"featuredItemsGroupQuery",void 0),h([f()],Pe.prototype,"galleryTemplatesGroupQuery",void 0),h([f()],Pe.prototype,"livingAtlasGroupQuery",void 0),h([f()],Pe.prototype,"hasCategorySchema",void 0),h([f()],Pe.prototype,"helpBase",void 0),h([f()],Pe.prototype,"helperServices",void 0),h([f()],Pe.prototype,"helpMap",void 0),h([f()],Pe.prototype,"homePageFeaturedContent",void 0),h([f()],Pe.prototype,"homePageFeaturedContentCount",void 0),h([f()],Pe.prototype,"httpPort",void 0),h([f()],Pe.prototype,"httpsPort",void 0),h([f()],Pe.prototype,"id",void 0),h([f()],Pe.prototype,"ipCntryCode",void 0),h([f({readOnly:!0})],Pe.prototype,"isOrganization",null),h([f()],Pe.prototype,"isPortal",void 0),h([f()],Pe.prototype,"isReadOnly",void 0),h([f({readOnly:!0})],Pe.prototype,"itemPageUrl",null),h([f()],Pe.prototype,"layerTemplatesGroupQuery",void 0),h([f()],Pe.prototype,"maxTokenExpirationMinutes",void 0),h([f({type:Date})],Pe.prototype,"modified",void 0),h([f()],Pe.prototype,"name",void 0),h([f()],Pe.prototype,"portalHostname",void 0),h([f()],Pe.prototype,"portalMode",void 0),h([f()],Pe.prototype,"portalProperties",void 0),h([f()],Pe.prototype,"region",void 0),h([f({readOnly:!0})],Pe.prototype,"restUrl",null),h([f()],Pe.prototype,"rotatorPanels",void 0),h([f()],Pe.prototype,"showHomePageDescription",void 0),h([f()],Pe.prototype,"sourceJSON",void 0),h([f()],Pe.prototype,"staticImagesUrl",void 0),h([f({json:{name:"2DStylesGroupQuery"}})],Pe.prototype,"stylesGroupQuery2d",void 0),h([f({json:{name:"stylesGroupQuery"}})],Pe.prototype,"stylesGroupQuery3d",void 0),h([f()],Pe.prototype,"supportsHostedServices",void 0),h([f()],Pe.prototype,"symbolSetsGroupQuery",void 0),h([f()],Pe.prototype,"templatesGroupQuery",void 0),h([f()],Pe.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Pe.prototype,"thumbnailUrl",null),h([f()],Pe.prototype,"units",void 0),h([f()],Pe.prototype,"url",void 0),h([f()],Pe.prototype,"urlKey",void 0),h([Ur("urlKey")],Pe.prototype,"readUrlKey",null),h([f()],Pe.prototype,"user",void 0),h([Ur("user")],Pe.prototype,"readUser",null),h([f()],Pe.prototype,"useStandardizedQuery",void 0),h([f()],Pe.prototype,"useVectorBasemaps",void 0),h([f()],Pe.prototype,"vectorBasemapGalleryGroupQuery",void 0),Pe=hf=h([F("esri.portal.Portal")],Pe);const vc=Pe,sH=new FinalizationRegistry(t=>{t.remove()});function wxe(t){const e=Hi;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}const xxe=ne.getLogger("esri.assets");function Txe(t,e){return Es(Rr(t),e)}function Rr(t){if(!Er.assetsPath)throw xxe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new X("assets:path-not-set","config.assetsPath is not set");return kI(Er.assetsPath,t)}let df=class extends we{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&dc(e)?ne.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new X("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r==null?void 0:r.signal})}async update(e,r){const{addOrUpdateResource:i}=await he(()=>import("./resourceUtils-5040f552.js"),[]);return i(this,"update",e,r)}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&dc(e)&&(e=yk(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};h([f()],df.prototype,"portalItem",void 0),h([f({type:String,value:null})],df.prototype,"path",null),h([Gi("path")],df.prototype,"_castPath",null),h([f({type:String,readOnly:!0})],df.prototype,"url",null),h([f({type:String,readOnly:!0})],df.prototype,"cdnUrl",null),h([f({type:String,readOnly:!0})],df.prototype,"itemRelativeUrl",null),df=h([F("esri.portal.PortalItemResource")],df);const Sxe=df;let LT=class extends we{constructor(e){super(e),this.created=null,this.rating=null}};h([f()],LT.prototype,"created",void 0),h([f()],LT.prototype,"rating",void 0),LT=h([F("esri.portal.PortalRating")],LT);const QD=LT;var Zy;const Exe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),Cxe=new Set(["KML","GeoJson","CSV"]);let Xt=Zy=class extends qC(P0){static from(t){return ex(Zy,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"&&(r="Insights Report"),r}readExtent(t){return t&&t.length?new Wr(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,u=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":u?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?"mediaservice":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):s=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="360 vr experience"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":t==="data pipeline"?"datapipelines":"maps",s?Rr(r+s+i+".png"):null}get isLayer(){return this.type!=null&&Exe.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&Hi&&!Hi.findCredential(t)&&(t=Hi._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=vc.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof QD&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new QD({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ye(this.applicationProxies),avgRating:this.avgRating,categories:ye(this.categories),created:ye(this.created),culture:this.culture,description:this.description,extent:ye(this.extent),groupCategories:ye(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ye(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ye(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Zy({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var r;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(r=t[i])==null?void 0:r.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await gl(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return gl(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await gl(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new QD(e)):null}fetchRelatedItems(t,e){return gl(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Zy)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return gl(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>gl(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new X("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new X("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await gl(e).signIn();const{copyResources:i,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!i,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new Zy({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")Ip(e)?i.query={data:e}:i.query={url:ac(e)},r!=null&&(i.query.filename=r);else{const s=new FormData;r!=null?s.append("file",e,r):s.append("file",e),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new X("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await he(()=>import("./resourceUtils-5040f552.js"),[]);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResource:i}=await he(()=>import("./resourceUtils-5040f552.js"),[]);return t.portalItem=this,i(t,"add",e,r)}async removeResource(t,e){const{removeResource:r}=await he(()=>import("./resourceUtils-5040f552.js"),[]);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new X("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await he(()=>import("./resourceUtils-5040f552.js"),[]);return e(this,t)}resourceFromPath(t){return new Sxe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:ye(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};return lte(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Zy({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};h([f({type:["private","shared","org","public"]})],Xt.prototype,"access",void 0),h([f()],Xt.prototype,"accessInformation",void 0),h([f({type:String})],Xt.prototype,"apiKey",void 0),h([f({json:{read:{source:"appProxies"}}})],Xt.prototype,"applicationProxies",void 0),h([f()],Xt.prototype,"avgRating",void 0),h([f()],Xt.prototype,"categories",void 0),h([f({type:Date})],Xt.prototype,"created",void 0),h([f()],Xt.prototype,"culture",void 0),h([f()],Xt.prototype,"description",void 0),h([f({readOnly:!0})],Xt.prototype,"displayName",null),h([f({type:Wr})],Xt.prototype,"extent",void 0),h([Ur("extent")],Xt.prototype,"readExtent",null),h([f()],Xt.prototype,"groupCategories",void 0),h([f({readOnly:!0})],Xt.prototype,"iconUrl",null),h([f()],Xt.prototype,"id",void 0),h([f({readOnly:!0})],Xt.prototype,"isLayer",null),h([f({type:Boolean,readOnly:!0})],Xt.prototype,"isOrgItem",void 0),h([f()],Xt.prototype,"itemControl",void 0),h([f({readOnly:!0})],Xt.prototype,"itemPageUrl",null),h([f({readOnly:!0})],Xt.prototype,"itemUrl",null),h([f()],Xt.prototype,"licenseInfo",void 0),h([f({type:Date})],Xt.prototype,"modified",void 0),h([f()],Xt.prototype,"name",void 0),h([f()],Xt.prototype,"numComments",void 0),h([f()],Xt.prototype,"numRatings",void 0),h([f()],Xt.prototype,"numViews",void 0),h([f()],Xt.prototype,"owner",void 0),h([f()],Xt.prototype,"ownerFolder",void 0),h([f({type:vc})],Xt.prototype,"portal",void 0),h([f()],Xt.prototype,"screenshots",void 0),h([f()],Xt.prototype,"size",void 0),h([f()],Xt.prototype,"snippet",void 0),h([f()],Xt.prototype,"sourceJSON",void 0),h([f({type:String})],Xt.prototype,"sourceUrl",void 0),h([f({type:String})],Xt.prototype,"spatialReference",void 0),h([f()],Xt.prototype,"tags",void 0),h([f()],Xt.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Xt.prototype,"thumbnailUrl",null),h([f()],Xt.prototype,"title",void 0),h([f()],Xt.prototype,"type",void 0),h([f()],Xt.prototype,"typeKeywords",void 0),h([f({type:String,json:{read(t,e){var r;if(Cxe.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],Xt.prototype,"url",void 0),h([f({readOnly:!0})],Xt.prototype,"userItemUrl",null),Xt=Zy=h([F("esri.portal.PortalItem")],Xt);const Yre=Xt,Xre=Object.freeze(Object.defineProperty({__proto__:null,default:Yre},Symbol.toStringTag,{value:"Module"})),nH=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,Axe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function oH(t){return t in Axe}const DT=[],Rw=new Map;function aH(t){for(const e of Rw.keys())Jre(t.pattern,e)&&Rw.delete(e)}function Oxe(t){return DT.includes(t)||(aH(t),DT.unshift(t)),{remove(){const e=DT.indexOf(t);e>-1&&(DT.splice(e,1),aH(t))}}}async function Zre(t){const e=Gh();Rw.has(t)||Rw.set(t,Pxe(t,e));const r=Rw.get(t);return r&&await Mxe.add(r),r}function Rxe(t){if(!nH.test(t))return null;const e=nH.exec(t);if(e===null)return null;const[,r,i]=e,s=r+(i?"-"+i.toUpperCase():"");return oH(s)?s:oH(r)?r:null}async function Pxe(t,e){const r=[];for(const i of DT)if(Jre(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(s){r.push(s)}throw r.length?new X("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new X("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Jre(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}$k(()=>{Rw.clear()});const Mxe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=vo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function $xe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await Zre("esri/t9n/basemaps");return r[t]||r[e]}const r6={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Rr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Rr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Rr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Rr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Rr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Rr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Rr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Rr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Rr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Rr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Rr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Rr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Rr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Rr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Rr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Rr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function QS(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function ix(t){return t!=null&&"type"in t&&t.type==="group"}const glt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function Ixe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function lH(t){return(t==null?void 0:t.type)==="voxel"}function cH(t){return(t==null?void 0:t.type)==="imagery-tile"}function Qre(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function Ik(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function ylt(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function Lxe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function _lt(t,e){const r=Hi==null?void 0:Hi.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${t.substring(0,i)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await Es(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function Dxe(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function Nxe(t){return Dxe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function Fxe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function Uxe(t){return!!Fxe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const zxe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),kxe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function Bxe(t){return t.layerContainerType==="basemap"?zxe:t.layerContainerType==="operational-layers"?kxe:null}function Vxe(t,e){if(e.restrictedWebMapWriting){const r=Bxe(e);return r==null||r.has(t.type)&&!Ik(t)}return!0}function Gxe(t,e){if(e)if(Ik(t)){const r=jC("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&KD(t,i)}else t.type==="stream"?KD(t,e.layerDefinition=e.layerDefinition||{}):t.type!=="group"&&KD(t,e)}function KD(t,e){"maxScale"in t&&(e.maxScale=_M(t.maxScale)??void 0),"minScale"in t&&(e.minScale=_M(t.minScale)??void 0)}function jxe(t,e){if(Gxe(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=_M(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(Ik(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function uH(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new X("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(Vxe(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&jxe(t,e=ye(e)),e}var NR;let Hxe=0;const Kre="esri.Basemap";let Vc=NR=class extends qC(P0){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+Hxe++,this.baseLayers=new er,this.referenceLayers=new er;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&ne.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{ne.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const t=this.baseLayers.removeAll();for(const i of t)i.destroy();const e=this.referenceLayers.removeAll();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",g1(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=uH(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=uH(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",g1(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return mre(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>sM(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>sM(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new NR({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=ye(r);return i.url&&Ep(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&Ep(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;qt(t);const i=[];if(e){const s=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const n=e.data.id;i.push($xe(n).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=i&&i.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await he(()=>import("./layersCreator-3127e596.js"),["assets/layersCreator-3127e596.js","assets/lazyLayerLoader-16d72703.js","assets/portalLayers-356c3218.js","assets/layersLoader-abd1d0db.js","assets/fetchService-3aa7ae50.js","assets/jsonContext-4de38f48.js","assets/portalItemUtils-3c9a4460.js","assets/styleUtils-c09586c0.js"]),a=[];if(qt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=p=>n==="web-scene"&&p.layerType==="ArcGISSceneServiceLayer"||p.isReference,u=o(this.baseLayers,t.baseMapLayers.filter(p=>!c(p)),l);a.push(u);const d=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(d)}await X0(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),s=da(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:t.type==="Web Scene"?"web-scene":"web-map",portal:t.portal||vc.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||vc.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=r6[t];if(!e)return null;if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),vM(ne.getLogger(Kre),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return NR.fromJSON(e)}};h([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:er}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],Vc.prototype,"baseLayers",null),h([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],Vc.prototype,"id",void 0),h([f({type:Yre})],Vc.prototype,"portalItem",void 0),h([f()],Vc.prototype,"referenceLayers",null),h([f({readOnly:!0})],Vc.prototype,"resourceInfo",void 0),h([f({type:yt})],Vc.prototype,"spatialReference",void 0),h([f()],Vc.prototype,"thumbnailUrl",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Vc.prototype,"title",void 0),h([qr("title")],Vc.prototype,"writeTitle",null),Vc=NR=h([F(Kre)],Vc);const AM=Vc,Wxe=Object.freeze(Object.defineProperty({__proto__:null,default:AM},Symbol.toStringTag,{value:"Module"})),OM={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function eie(t){return!!OM[t]||!!OM[t.toLowerCase()]}function Lk(t){return OM[t]??OM[t.toLowerCase()]}function qxe(t){return[...Lk(t)]}function eN(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function tie(t,e,r,i=1){const s=(t%360+360)%360/360,n=r<=.5?r*(e+1):r+e-r*e,o=2*r-n;return[Math.round(255*eN(o,n,s+1/3)),Math.round(255*eN(o,n,s)),Math.round(255*eN(o,n,s-1/3)),i]}function Yxe(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function C(){return[0,0,0]}function ms(t){return[t[0],t[1],t[2]]}function Ce(t,e,r){return[t,e,r]}function yl(t){const e=C(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Dk(t,e){return new Float64Array(t,e,3)}function rie(){return C()}function iie(){return Ce(1,1,1)}function sie(){return Ce(1,0,0)}function nie(){return Ce(0,1,0)}function Nk(){return Ce(0,0,1)}const Va=rie(),zf=iie(),oie=sie(),aie=nie(),Fk=Nk();Object.freeze(Object.defineProperty({__proto__:null,ONES:zf,UNIT_X:oie,UNIT_Y:aie,UNIT_Z:Fk,ZEROS:Va,clone:ms,create:C,createView:Dk,fromArray:yl,fromValues:Ce,ones:iie,unitX:sie,unitY:nie,unitZ:Nk,zeros:rie},Symbol.toStringTag,{value:"Module"}));let Uk=1e-6;function ma(){return Uk}function Xxe(t){Uk=t}const XC=Math.random,Zxe=Math.PI/180,Jxe=180/Math.PI;function VI(t){return t*Zxe}function Qxe(t){return t*Jxe}function Kxe(t,e){return Math.abs(t-e)<=Uk*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:XC,equals:Kxe,getEpsilon:ma,setEpsilon:Xxe,toDegree:Qxe,toRadian:VI},Symbol.toStringTag,{value:"Module"}));function Te(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function te(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function oe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function le(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function GI(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function RM(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function e2e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function lie(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function PM(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function cie(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function zk(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function t2e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function r2e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ee(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function W_(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function ei(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}function Hn(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function lo(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function zo(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function i2e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function fe(t,e){const r=e[0],i=e[1],s=e[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function pe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Qe(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];return t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o,t}function Pr(t,e,r,i){const s=e[0],n=e[1],o=e[2];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t}function s2e(t,e,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return t[0]=e[0]*a+r[0]*l+i[0]*c+s[0]*u,t[1]=e[1]*a+r[1]*l+i[1]*c+s[1]*u,t[2]=e[2]*a+r[2]*l+i[2]*c+s[2]*u,t}function n2e(t,e,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,d=3*l*o,p=l*n;return t[0]=e[0]*c+r[0]*u+i[0]*d+s[0]*p,t[1]=e[1]*c+r[1]*u+i[1]*d+s[1]*p,t[2]=e[2]*c+r[2]*u+i[2]*d+s[2]*p,t}function o2e(t,e){e=e||1;const r=XC,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=s*e,t}function De(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12],t[1]=r[1]*i+r[5]*s+r[9]*n+r[13],t[2]=r[2]*i+r[6]*s+r[10]*n+r[14],t}function El(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=i*r[0]+s*r[3]+n*r[6],t[1]=i*r[1]+s*r[4]+n*r[7],t[2]=i*r[2]+s*r[5]+n*r[8],t}function vu(t,e,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let u=s*c-n*l,d=n*a-i*c,p=i*l-s*a,g=s*p-n*d,y=n*u-i*p,_=i*d-s*u;const v=2*o;return u*=v,d*=v,p*=v,g*=2,y*=2,_*=2,t[0]=a+u+g,t[1]=l+d+y,t[2]=c+p+_,t}function a2e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function l2e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function c2e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function uie(t,e){te(XA,t),te(ZA,e),fe(XA,XA),fe(ZA,ZA);const r=pe(XA,ZA);return r>1?0:r<-1?Math.PI:Math.acos(r)}const XA=C(),ZA=C();function u2e(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ca(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function M0(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=ma();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function fm(t,e,r){const i=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const _n=le,h2e=GI,d2e=RM,ZC=ei,jI=Hn,pl=Te,i6=lo,hH=Object.freeze(Object.defineProperty({__proto__:null,abs:PM,add:oe,angle:uie,bezier:n2e,ceil:e2e,copy:te,cross:Qe,direction:fm,dist:ZC,distance:ei,div:d2e,divide:RM,dot:pe,equals:M0,exactEquals:ca,floor:lie,hermite:s2e,inverse:i2e,len:pl,length:Te,lerp:Pr,max:t2e,min:zk,mul:h2e,multiply:GI,negate:zo,normalize:fe,random:o2e,rotateX:a2e,rotateY:l2e,rotateZ:c2e,round:r2e,scale:ee,scaleAndAdd:W_,set:se,sign:cie,sqrDist:jI,sqrLen:i6,squaredDistance:Hn,squaredLength:lo,str:u2e,sub:_n,subtract:le,transformMat3:El,transformMat4:De,transformQuat:vu},Symbol.toStringTag,{value:"Module"}));function gu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function oi(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function kk(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function hie(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function die(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function pie(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function p2e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function f2e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function m2e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function g2e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function y2e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Qx(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function _2e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function fie(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function MM(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+s*s+n*n}function Bk(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function Vk(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function v2e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function b2e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function mie(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=s*o,t[3]=n*o),t}function gie(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Gk(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function w2e(t,e){const r=XC;let i,s,n,o,a,l;e=e||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function uc(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,t[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,t[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,t[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,t}function x2e(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*n-l*s,d=c*s+l*i-o*n,p=c*n+o*s-a*i,g=-o*i-a*s-l*n;return t[0]=u*c+g*-o+d*-l-p*-a,t[1]=d*c+g*-a+p*-o-u*-l,t[2]=p*c+g*-l+u*-a-d*-o,t[3]=e[3],t}function T2e(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Pw(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function jk(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=ma();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}const S2e=hie,E2e=die,C2e=pie,A2e=fie,O2e=MM,R2e=Bk,P2e=Vk,yie=Object.freeze(Object.defineProperty({__proto__:null,add:kk,ceil:p2e,copy:gu,dist:A2e,distance:fie,div:C2e,divide:pie,dot:gie,equals:jk,exactEquals:Pw,floor:f2e,inverse:b2e,len:R2e,length:Bk,lerp:Gk,max:g2e,min:m2e,mul:E2e,multiply:die,negate:v2e,normalize:mie,random:w2e,round:y2e,scale:Qx,scaleAndAdd:_2e,set:oi,sqrDist:O2e,sqrLen:P2e,squaredDistance:MM,squaredLength:Vk,str:T2e,sub:S2e,subtract:hie,transformMat4:uc,transformQuat:x2e},Symbol.toStringTag,{value:"Module"})),dH=new Float32Array(1);function Hk(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function me(t,e,r){return Math.min(Math.max(t,e),r)}function T1(t){return(t&t-1)==0}function vlt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function blt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function _t(t,e,r){return t+(e-t)*r}function At(t){return t*Math.PI/180}function pa(t){return 180*t/Math.PI}function s6(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function rn(t){return Math.acos(me(t,-1,1))}function Cu(t){return Math.asin(me(t,-1,1))}function Mw(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const $M=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function M2e(t){return $M.setFloat64(0,t),$M.getBigInt64(0)}function $2e(t){return $M.setBigInt64(0,t),$M.getFloat64(0)}const tN=BigInt("1000000");I2e(1);function I2e(t){const e=M2e(t=Math.abs(t)),r=$2e(e<=tN?tN:e-tN);return Math.abs(t-r)}function L2e(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function D2e(t){return _ie(Math.max(-n6,Math.min(t,n6)))}function _ie(t){return dH[0]=t,dH[0]}function qE(t,e,r){const i=me((r-t)/(e-t),0,1);return i*i*(3-2*i)}function pH(t,e){const r=Te(t),i=Cu(t[2]/r),s=Math.atan2(t[1]/r,t[0]/r);return se(e,r,i,s),e}function wlt(t,e,r){return oi(t,e[0],e[1],e[2],e[3]*r)}function xlt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(Mw(e,1)&&Mw(r,1)&&Mw(i,1))}const n6=_ie(34028234663852886e22);function JA(t){return me(nk(t),0,255)}function QA(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let FR=class Ao{static blendColors(e,r,i,s=new Ao){return s.r=Math.round(e.r+(r.r-e.r)*i),s.g=Math.round(e.g+(r.g-e.g)*i),s.b=Math.round(e.b+(r.b-e.b)*i),s.a=e.a+(r.a-e.a)*i,s._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Ao.fromArray(a,r)}return Ao.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Ao.fromArray(tie(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(e,r=new Ao){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,s=(1<<i)-1;let n=+("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new Ao){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=eie(e)?Lk(e):null;return i&&Ao.fromArray(i,r)||Ao.fromRgb(e,r)||Ao.fromHex(e,r)}static fromJSON(e){return e&&new Ao([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Ao.fromString(e,this):Array.isArray(e)?Ao.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Ao||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Ao.AlphaMode.ALWAYS){const r=JA(this.r),i=JA(this.g),s=JA(this.b);return e===Ao.AlphaMode.ALWAYS||this.a!==1?[r,i,s,JA(255*this.a)]:[r,i,s]}clone(){return new Ao(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(QA(this.r,0,255)),this.g=Math.round(QA(this.g,0,255)),this.b=Math.round(QA(this.b,0,255)),this.a=QA(this.a,0,1),this}_set(e,r,i,s){this.r=e,this.g=r,this.b=i,this.a=s}};FR.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(FR||(FR={}));const ht=FR;function Tlt(t){}function N2e(t){return()=>t}function Kt(t,e={}){const r=t instanceof Tn?t:new Tn(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),f(i)}var o6;let UR=o6=class extends Ke{constructor(t){super(t),this.type="none"}clone(){return new o6({type:this.type})}};h([Kt({none:"none",stayAbove:"stay-above"})],UR.prototype,"type",void 0),UR=o6=h([F("esri.ground.NavigationConstraint")],UR);function vie(t){const e=nk(100*(1-t));return Math.max(0,Math.min(e,100))}function bie(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var a6;let pf=a6=class extends qC(P0){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new er;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&ne.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{gs(t)||ne.getLogger(this.declaredClass).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",g1(t,this._get("layers")))}writeLayers(t,e,r,i){const s=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};N2e(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new X("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return mre(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await he(()=>import("./ElevationQuery-ff07f756.js"),[]);qt(e);const i=new r,s=this.layers.filter(fH).toArray();return i.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await he(()=>import("./ElevationQuery-ff07f756.js"),[]);qt(e);const i=new r,s=this.layers.filter(fH).toArray();return i.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ye(this.surfaceColor),navigationConstraint:ye(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new a6({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return he(()=>import("./layersCreator-3127e596.js"),["assets/layersCreator-3127e596.js","assets/lazyLayerLoader-16d72703.js","assets/portalLayers-356c3218.js","assets/layersLoader-abd1d0db.js","assets/fetchService-3aa7ae50.js","assets/jsonContext-4de38f48.js","assets/portalItemUtils-3c9a4460.js","assets/styleUtils-c09586c0.js"]).then(({populateOperationalLayers:o})=>{qt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return X0(a)}).then(()=>{})}};function F2e(t){return t&&"createElevationSampler"in t}function fH(t){return t.type==="elevation"||F2e(t)}h([f({json:{read:!1}})],pf.prototype,"layers",null),h([qr("layers")],pf.prototype,"writeLayers",null),h([f({readOnly:!0})],pf.prototype,"resourceInfo",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Qs,read:{reader:bie,source:"transparency"},write:{writer:(t,e)=>{e.transparency=vie(t)},target:"transparency"}}})],pf.prototype,"opacity",void 0),h([f({type:ht,json:{type:[Qs],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],pf.prototype,"surfaceColor",void 0),h([f({type:UR,json:{write:!0}})],pf.prototype,"navigationConstraint",void 0),pf=a6=h([F("esri.Ground")],pf);const IM=pf;let Sb=class extends er{constructor(e){super(e),this.getCollections=null}initialize(){this.own(Ute(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new er(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(s=>!!s);for(const s of r)if(s){if(i(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};h([f()],Sb.prototype,"getCollections",void 0),h([f()],Sb.prototype,"getChildrenFunction",void 0),h([f()],Sb.prototype,"itemFilterFunction",void 0),Sb=h([F("esri.core.CollectionFlattener")],Sb);const YE=Sb;function U2e(t){var e,r;return!(!(t!=null&&t.loaded)||!((r=(e=Nxe(t))==null?void 0:e.operations)!=null&&r.supportsEditing)||"editingEnabled"in t&&!Uxe(t))}const mH=ne.getLogger("esri.support.basemapUtils");function z2e(){return{}}function k2e(t){for(const e in t){const r=t[e];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete t[e]}}function B2e(t,e){let r;if(typeof t=="string"){if(!(t in r6)){const i=Object.entries(r6).filter(([s,n])=>Er.apiKey&&!n.classic||!Er.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return mH.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=AM.fromId(t),e&&(e[t]=r))}else r=tn(AM,t);return r!=null&&r.destroyed&&(mH.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function V2e(t){return new YE({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function rN(t){for(const e of t.values())e==null||e.destroy();t.clear()}const gH={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function G2e(t){let e=null;if(typeof t=="string")if(t in gH){const r=gH[t];e=new IM({resourceInfo:{data:{layers:[r]}}})}else ne.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=tn(IM,t);return e}function sx(t,e,r=!1){let{hasM:i,hasZ:s}=t;Array.isArray(e)?e.length!==4||i||s?e.length===3&&r&&!i?(s=!0,i=!1):e.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=i}var l6;function yH(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function j2e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let vg=l6=class extends Z0{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):j2e(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new Wr,r=this.hasZ,i=this.hasM,s=r?3:2,n=t[0],o=yH(Math.min),a=yH(Math.max);let l,c,u,d,[p,g]=n,[y,_]=n;for(let v=0,w=t.length;v<w;v++){const T=t[v],[x,E]=T;if(p=o(p,x),g=o(g,E),y=a(y,x),_=a(_,E),r&&T.length>2){const O=T[2];l=o(l,O),u=a(u,O)}if(i&&T.length>s){const O=T[s];c=o(c,O),d=a(d,O)}}return e.xmin=p,e.ymin=g,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ye(this.points)}addPoint(t){return sx(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ye(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new l6(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new at(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new at(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(sx(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};h([f({readOnly:!0})],vg.prototype,"cache",null),h([f()],vg.prototype,"extent",null),h([f({type:[[Number]],json:{write:{isRequired:!0}}})],vg.prototype,"points",void 0),h([qr("points")],vg.prototype,"writePoints",null),vg=l6=h([F("esri.geometry.Multipoint")],vg),vg.prototype.toJSON.isDefaultToJSON=!0;const JC=vg;function Elt(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return e}function H2e(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return e}function HI(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function wie(t,e,r){const i=t[0]+r*(e[0]-t[0]),s=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,s,t[2]+r*(e[2]-t[2])]:[i,s]}function Clt(t,e,r,i){const[s,n]=e,[o,a]=r[i],[l,c]=r[i+1],u=l-o,d=c-a,p=u*u+d*d,g=(s-o)*u+(n-a)*d,y=Math.min(1,Math.max(0,g/p));return t[0]=o+u*y,t[1]=a+d*y,t}function Alt(t,e,r){let i,s,n,o,a=!1,l=1/0;for(r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,s=r.y;r.nextPoint();)n=r.x,o=r.y,s>e!=o>e&&t<(n-i)*(e-s)/(o-s)+i&&(a=!a),l=Math.min(l,W2e(t,e,i,s,n,o)),i=n,s=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function W2e(t,e,r,i,s,n){let o=r,a=i,l=s-o,c=n-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=s,a=n):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function xie(t,e){return wie(t,e,.5)}function Tie(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=HI(t[i],t[i+1]);return r}function Sie(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let s=0;s<r-1;++s){const n=HI(t[s],t[s+1]);if(e-i<n){const o=(e-i)/n;return wie(t[s],t[s+1],o)}i+=n}return t[r-1]}function Eie(t,e,r){const i=t.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let u=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&e&&(o+=l[0]*c[u]-c[0]*l[u])}return s<=0&&n<=0&&o<=0}function q2e(t){const e=t.length;return e>2&&Kf(t[0],t[e-1])}function Olt(t){if("rings"in t)for(const e of t.rings)q2e(e)||e.push(e[0].slice())}function Rlt(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function Cie(t){if(!t||t.numPoints<3)return 0;let e,r,i=0;if(t.seekPathFront(),!t.nextPoint())return 0;e=t.x,r=t.y;const s=e,n=r;for(;t.nextPoint();)i+=(e-t.x)*(r+t.y),e=t.x,r=t.y;return i+=(e-s)*(r+n),-.5*i}function Plt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function Y2e(t){return t?Aie(t.rings,t.hasZ??!1):null}function Aie(t,e){if(!t||!t.length)return null;const r=[],i=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=Oie(t[n],e,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=t[0]&&t[0].length?X2e(t[0],e):null;if(!n)return null;r[0]=n[0],r[1]=n[1],e&&n.length>2&&(r[2]=n[2])}return r}function Oie(t,e,r){let i=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const g=t[p],y=t[(p+1)%t.length],[_,v,w]=g,T=_-l,x=v-c,[E,O,A]=y,$=E-l,M=O-c,U=T*M-$*x;if(o+=U,i+=(T+$)*U,s+=(x+M)*U,e&&g.length>2&&y.length>2){const k=w-u,B=A-u,z=T*B-$*k;n+=(k+B)*z,a+=z}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(w<r[4]&&(r[4]=w),w>r[5]&&(r[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[i/(6*o)+l,s/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(d[3]=(r[4]+r[5])/2,d[4]=0):(d[3]=n/(6*a)+u,d[4]=a)),d}function X2e(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],d=t[l+1];if(u&&d){r[0]=u[0],r[1]=u[1],i[0]=d[0],i[1]=d[1],e&&u.length>2&&d.length>2&&(r[2]=u[2],i[2]=d[2]);const p=HI(r,i);if(p){s+=p;const g=xie(u,d);n+=p*g[0],o+=p*g[1],e&&g.length>2&&(a+=p*g[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function Z2e(t){const{hasZ:e,numPaths:r}=t;if(r===0)return null;const i=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=Oie(H2e(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(i[0]=s[0][0],i[1]=s[0][1],e&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.numPoints?J2e(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function J2e(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const d=t.x,p=t.y,g=t.z;r[0]=l,r[1]=c,i[0]=d,i[1]=p,e&&(r[2]=u,i[2]=g);const y=HI(r,i);if(y){s+=y;const _=xie(r,i);n+=y*_[0],o+=y*_[1],e&&_.length>2&&(a+=y*_[2])}l=d,c=p,u=g}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.numPoints?(t.seekPathFront(),t.nextPoint(),[t.x,t.y]):null}const Q2e=1e-6;function Mlt(t){let e=0;for(t.reset();t.nextPath();)e+=Cie(t);if(e<Q2e){const s=Z2e(t);return s?[s[0],s[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)eTe(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const K2e=1/3;function eTe(t,e,r){if(!t||!r||r.numPoints<3)return null;r.nextPoint();const i=r.x,s=r.y;r.nextPoint();let n,o=r.x-i,a=r.y-s,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-s,n=.5*K2e*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const u=Cie(r),d=[i,s];return d[0]-=e[0],d[1]-=e[1],d[0]*=u,d[1]*=u,t[0]+=d[0],t[1]+=d[1],t}function Ut(t=sTe){return[t[0],t[1],t[2],t[3]]}function $lt(t){return[t[0],t[1],t[2],t[3]]}function sm(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function Wk(t,e,r,i,s=Ut()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Rie(t,e=Ut()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function WI(t,e){return new Wr({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function qk(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function b0(t,e,r){if(e!=null)if("length"in e)h6(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else sm(r,t)}function iN(t,e,r=t){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function c6(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function lc(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Xh(t){return t[1]>=t[3]?0:t[3]-t[1]}function Pie(t){return lc(t)*Xh(t)}function Yk(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Mie(t,e){return qI(t,e[0],e[1])}function _H(t,e){const r=e[3],i=.5*(t[0]+t[2]),s=Math.abs(e[0]-i),n=.5*(t[2]-t[0]);if(s>r+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=r*r}function Ilt(t,e,r){const i=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=r,d=(v,w)=>(u-l)*v+(a-c)*w+(c*l-a*u)<0,p=d(i,o),g=d(n,o),y=d(n,s),_=d(i,s);return!(p===g&&g===y&&y===_&&_===p||a<i&&c<i||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function Llt(t,e){return qI(t,e.x,e.y)}function qI(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function tTe(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function YI(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function vH(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function u6(t,e,r){if(e==null)return sm(r,t);const i=e[0],s=e[1],n=e[2],o=e[3];return r[0]=me(t[0],i,n),r[1]=me(t[1],s,o),r[2]=me(t[2],i,n),r[3]=me(t[3],s,o),r}function rTe(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-r)-lc(t)/2,0),n=Math.max(Math.abs(e[1]-i)-Xh(t)/2,0);return Math.sqrt(s*s+n*n)}function LM(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function Au(t){return t?sm(t,d6):Ut(d6)}function h6(t){return t!=null&&t.length===4}function iTe(t){return!(lc(t)!==0&&isFinite(t[0])||Xh(t)!==0&&isFinite(t[1]))}function r1(t,e){return h6(t)&&h6(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const Dlt=[-1/0,-1/0,1/0,1/0],d6=[1/0,1/0,-1/0,-1/0],sTe=[0,0,0,0];function $ie(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Iie(t){return t.points!==void 0}function Lie(t){return t.x!==void 0&&t.y!==void 0}function Die(t){return t.paths!==void 0}function Nie(t){return t.rings!==void 0}function Fie(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const n0=Fie(Math.min),o0=Fie(Math.max);function Nlt(t,e){return Die(e)?nx(t,e.paths,!1,!1):Nie(e)?nx(t,e.rings,!1,!1):Iie(e)?Xk(t,e.points,!1,!1,!1,!1):$ie(e)?Uie(t,e):(Lie(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function Flt(t){let e,r,i,s;for(t.reset(),e=i=1/0,r=s=-1/0;t.nextPath();){const n=nTe(t);e=Math.min(n[0],e),i=Math.min(n[1],i),r=Math.max(n[2],r),s=Math.max(n[3],s)}return Ut([e,i,r,s])}function nTe(t){let e,r,i,s;for(e=i=1/0,r=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),s=Math.max(t.y,s);return Ut([e,i,r,s])}function Ult(t,e){return Die(e)?nx(t,e.paths,!0,!1):Nie(e)?nx(t,e.rings,!0,!1):Iie(e)?Xk(t,e.points,!0,!1,!0,!1):$ie(e)?Uie(t,e,!0,!1,!0,!1):(Lie(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function nx(t,e,r,i){const s=r?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,u]=e[0][0],[d,p]=e[0][0];for(let g=0;g<e.length;g++){const y=e[g];for(let _=0;_<y.length;_++){const v=y[_],[w,T]=v;if(c=n0(c,w),u=n0(u,T),d=o0(d,w),p=o0(p,T),r&&v.length>2){const x=v[2];n=n0(n,x),o=o0(o,x)}if(i&&v.length>s){const x=v[s];a=n0(n,x),l=o0(o,x)}}}return r?i?(t[0]=c,t[1]=u,t[2]=n,t[3]=a,t[4]=d,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=n,t[3]=d,t[4]=p,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=u,t[2]=a,t[3]=d,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=d,t[3]=p,t.length=4,t)}function Uie(t,e,r,i,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,d=e.zmax,p=e.mmin,g=e.mmax;return s?(u=u||0,d=d||0,n?(p=p||0,g=g||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=d,t[7]=g,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=d,t)):n?(p=p||0,g=g||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=g,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function Xk(t,e,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!e.length||!e[0].length)return null;let c,u,d,p,[g,y]=e[0],[_,v]=e[0];for(let w=0;w<e.length;w++){const T=e[w],[x,E]=T;if(g=n0(g,x),y=n0(y,E),_=o0(_,x),v=o0(v,E),l&&T.length>2){const O=T[2];c=n0(c,O),u=o0(u,O)}if(a&&T.length>o){const O=T[o];d=n0(c,O),p=o0(u,O)}}return s?(c=c||0,u=u||0,n?(d=d||0,p=p||0,t[0]=g,t[1]=y,t[2]=c,t[3]=d,t[4]=_,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=g,t[1]=y,t[2]=c,t[3]=_,t[4]=v,t[5]=u,t)):n?(d=d||0,p=p||0,t[0]=g,t[1]=y,t[2]=d,t[3]=_,t[4]=v,t[5]=p,t):(t[0]=g,t[1]=y,t[2]=_,t[3]=v,t)}function oTe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function aTe(t){return t.points!==void 0}function lTe(t){return t.x!==void 0&&t.y!==void 0}function cTe(t){return t.paths!==void 0}function uTe(t){return t.rings!==void 0}const Zk=[];function zie(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function kie(t,e,r,i,s,n){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:s,zmax:n}}function Bie(t,e,r,i,s,n){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:s,mmax:n}}function Vie(t,e,r,i,s,n,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function Jk(t,e=!1,r=!1){return e?r?Vie(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):kie(t[0],t[1],t[2],t[3],t[4],t[5]):r?Bie(t[0],t[1],t[2],t[3],t[4],t[5]):zie(t[0],t[1],t[2],t[3])}function zlt(t){return t?oTe(t)?t:lTe(t)?dTe(t):uTe(t)?Gie(t):cTe(t)?jie(t):aTe(t)?hTe(t):null:null}function hTe(t){const{hasZ:e,hasM:r,points:i}=t;return Jk(Xk(Zk,i,e??!1,r??!1),e,r)}function dTe(t){const{x:e,y:r,z:i,m:s}=t,n=s!=null;return i!=null?n?Vie(e,r,i,s,e,r,i,s):kie(e,r,i,e,r,i):n?Bie(e,r,s,e,r,s):zie(e,r,e,r)}function Gie(t){const{hasZ:e,hasM:r,rings:i}=t,s=nx(Zk,i,e??!1,r??!1);return s?Jk(s,e,r):null}function jie(t){const{hasZ:e,hasM:r,paths:i}=t,s=nx(Zk,i,e??!1,r??!1);return s?Jk(s,e,r):null}var zR;function bH(t){return!Array.isArray(t[0])}let $d=zR=class extends Z0{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,s=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new zR(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||yt.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=Y2e(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new at;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=Gie(this);if(!e)return null;const r=new Wr(e);return r.spatialReference=t,r}get isSelfIntersecting(){return uxe(this.rings)}writeRings(t,e){e.rings=ye(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(bH(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new zR;return t.spatialReference=this.spatialReference,t.rings=ye(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([s,n,o,a],[l,c,u,d])=>s===l&&n===c&&(o==null&&u==null||o===u)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!Kf(n,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=ev(t,this.spatialReference);return exe(this,e??t)}isClockwise(t){let e;return e=bH(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,Eie(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new at(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new at(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new at(r[0],r[1],r[2],r[3],this.spatialReference):new at(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(sx(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new at(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new at(s,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(sx(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],$d.prototype,"cache",null),h([f({readOnly:!0})],$d.prototype,"centroid",null),h([f({readOnly:!0})],$d.prototype,"extent",null),h([f({readOnly:!0})],$d.prototype,"isSelfIntersecting",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],$d.prototype,"rings",void 0),h([qr("rings")],$d.prototype,"writeRings",null),$d=zR=h([F("esri.geometry.Polygon")],$d),$d.prototype.toJSON.isDefaultToJSON=!0;const tv=$d;var p6;function pTe(t){return!Array.isArray(t[0])}let bg=p6=class extends Z0{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||yt.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=jie(this);if(!e)return null;const r=new Wr(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=ye(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(pTe(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new p6;return t.spatialReference=this.spatialReference,t.paths=ye(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new at(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new at(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new at(r[0],r[1],r[2],r[3],this.spatialReference):new at(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(sx(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new at(s,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new at(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(sx(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],bg.prototype,"cache",null),h([f({readOnly:!0})],bg.prototype,"extent",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],bg.prototype,"paths",void 0),h([qr("paths")],bg.prototype,"writePaths",null),bg=p6=h([F("esri.geometry.Polyline")],bg),bg.prototype.toJSON.isDefaultToJSON=!0;const Kx=bg,fTe=Ec()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),klt=Ec()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Hie(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Qk(t){return t.points!==void 0}function Kk(t){return t.x!==void 0&&t.y!==void 0}function eB(t){return t.paths!==void 0}function tB(t){return t.rings!==void 0}function Ou(t){return t==null?null:t instanceof Z0?t:Kk(t)?at.fromJSON(t):eB(t)?Kx.fromJSON(t):tB(t)?tv.fromJSON(t):Qk(t)?JC.fromJSON(t):Hie(t)?Wr.fromJSON(t):null}function rB(t){return t?Kk(t)?"esriGeometryPoint":eB(t)?"esriGeometryPolyline":tB(t)?"esriGeometryPolygon":Hie(t)?"esriGeometryEnvelope":Qk(t)?"esriGeometryMultipoint":null:null}const mTe={esriGeometryPoint:at,esriGeometryPolyline:Kx,esriGeometryPolygon:tv,esriGeometryEnvelope:Wr,esriGeometryMultipoint:JC};function gTe(t){return t&&mTe[t]||null}const iB={base:Z0,key:"type",typeMap:{extent:Wr,multipoint:JC,point:at,polyline:Kx,polygon:tv}};R0(iB);let Wie=0;const sB=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+Wie++})}};return e=h([F("esri.core.Identifiable")],e),e},Blt=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Wie++})}};return e=h([F("esri.core.NumericIdentifiable")],e),e};let wH=class extends sB(class{}){};wH=h([F("esri.core.Identifiable")],wH);async function yTe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await he(()=>import("./portalLayers-356c3218.js"),["assets/portalLayers-356c3218.js","assets/lazyLayerLoader-16d72703.js","assets/layersLoader-abd1d0db.js","assets/fetchService-3aa7ae50.js","assets/jsonContext-4de38f48.js","assets/portalItemUtils-3c9a4460.js","assets/styleUtils-c09586c0.js"]);try{return await r(e)}catch(i){const s=e&&e.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Er.portalUrl;throw ne.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let _Te=0,In=class extends ys.EventedMixin(sB(P0)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Wr(-180,-90,180,90,yt.WGS84),this.id=Date.now().toString(16)+"-layer-"+_Te++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=yt.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await he(()=>import("./arcgisLayers-e4bf23de.js"),["assets/arcgisLayers-e4bf23de.js","assets/fetchService-3aa7ae50.js","assets/lazyLayerLoader-16d72703.js"])).fromUrl(r)}static fromPortalItem(e){return yTe(e)}initialize(){this.when().catch(e=>{gs(e)||ne.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return da(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Es(e,{query:{f:"json"},responseType:"json"})).data;throw new X("layer:no-attribution-data","Layer does not have attribution data")}};h([f({type:String})],In.prototype,"attributionDataUrl",void 0),h([f({type:Wr})],In.prototype,"fullExtent",void 0),h([f({readOnly:!0})],In.prototype,"hasAttributionData",null),h([f({type:String,clonable:!1})],In.prototype,"id",void 0),h([f({type:Boolean,nonNullable:!0})],In.prototype,"legendEnabled",void 0),h([f({type:["show","hide","hide-children"]})],In.prototype,"listMode",void 0),h([f({type:Number,range:{min:0,max:1},nonNullable:!0})],In.prototype,"opacity",void 0),h([f({clonable:!1})],In.prototype,"parent",void 0),h([f({readOnly:!0})],In.prototype,"parsedUrl",null),h([f({type:Boolean})],In.prototype,"popupEnabled",void 0),h([f({type:Boolean})],In.prototype,"attributionVisible",void 0),h([f({type:yt})],In.prototype,"spatialReference",void 0),h([f({type:String})],In.prototype,"title",void 0),h([f({readOnly:!0,json:{read:!1}})],In.prototype,"type",void 0),h([f()],In.prototype,"url",void 0),h([f({type:Boolean,nonNullable:!0})],In.prototype,"visible",void 0),In=h([F("esri.layers.Layer")],In);const vTe=In;function f6(t,e,r){let i,s;if(t)for(let n=0,o=t.length;n<o;n++){if(i=t.getItemAt(n),i[e]===r)return i;if((i==null?void 0:i.type)==="group"&&(s=f6(i.layers,e,r),s))return s}}const bTe=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new er;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||ne.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",g1(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof vTe){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else Sc(r)?r.then(n=>{this.destroyed||this.add(n,i)}):ne.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return f6(this.layers,"id",r)}findLayerByUid(r){return f6(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return h([f()],e.prototype,"layers",null),e=h([F("esri.support.LayersMixin")],e),e};function m6(t,e,r){if(t)for(let i=0,s=t.length;i<s;i++){const n=t.getItemAt(i);if(n[e]===r)return n;if((n==null?void 0:n.type)==="group"){const o=m6(n.tables,e,r);if(o)return o}}}const wTe=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new er,this.addHandles([this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&ne.getLogger(this.declaredClass).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",g1(r,this._get("tables")))}findTableById(r){return m6(this.tables,"id",r)}findTableByUid(r){return m6(this.tables,"uid",r)}};return h([f()],e.prototype,"tables",null),e=h([F("esri.support.TablesMixin")],e),e};let Id=class extends wTe(bTe(ys.EventedMixin(we))){constructor(e){super(e),this.allLayers=new YE({getCollections:()=>{var r,i,s;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=V2e(this),this.basemap=null,this.editableLayers=new YE({getCollections:()=>[this.allLayers],itemFilterFunction:U2e}),this.ground=new IM,this._basemapCache=z2e()}destroy(){var e,r;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(r=this.basemap)==null||r.destroy(),k2e(this._basemapCache),this._basemapCache=null}castBasemap(e){return B2e(e,this._basemapCache)}castGround(e){return G2e(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};h([f({readOnly:!0,dependsOn:[]})],Id.prototype,"allLayers",void 0),h([f({readOnly:!0})],Id.prototype,"allTables",void 0),h([f({type:AM})],Id.prototype,"basemap",void 0),h([Gi("basemap")],Id.prototype,"castBasemap",null),h([f({readOnly:!0})],Id.prototype,"editableLayers",void 0),h([f({type:IM,nonNullable:!0})],Id.prototype,"ground",void 0),h([Gi("ground")],Id.prototype,"castGround",null),Id=h([F("esri.Map")],Id);const qie=Id,mm=t=>{let e=class extends t{clone(){var l;const r=gl(O0(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const c in i){const u=i[c],d=s==null?void 0:s.originOf(c),p=u.clonable;if(u.readOnly||p===!1||d!==ai.USER&&d!==ai.DEFAULTS&&d!==ai.WEB_MAP&&d!==ai.WEB_SCENE)continue;const g=this[c];let y=null;y=typeof p=="function"?p(g):p==="reference"?g:CF(g),g!=null&&y==null||(d===ai.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=O0(a))==null?void 0:l.store;if(c)for(const[u,d]of o)c.set(u,d,ai.DEFAULTS)}return a}};return e=h([F("esri.core.Clonable")],e),e};let xH=class extends mm(we){};xH=h([F("esri.core.Clonable")],xH);let $0=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,s=0,n=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=e),i+s}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return me(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,s=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function nB(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const xTe=nB(new $0(0,2*Math.PI)),I0=nB(new $0(-Math.PI,Math.PI)),oB=nB(new $0(0,360));let ff=class extends mm(Ke){constructor(...e){super(...e),this.position=new at([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return r!=null&&(n.heading=r),i!=null&&(n.tilt=i),s!=null&&(n.fov=s),n}return e}writePosition(e,r,i,s){const n=e.clone();n.x=Rh(e.x||0),n.y=Rh(e.y||0),n.z=e.hasZ?Rh(e.z||0):e.z,r[i]=n.write({},s)}readPosition(e,r){const i=new at;return i.read(e,r),i.x=Rh(i.x||0),i.y=Rh(i.y||0),i.z=i.hasZ?Rh(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};h([f({type:at,json:{write:{isRequired:!0}}})],ff.prototype,"position",void 0),h([qr("position")],ff.prototype,"writePosition",null),h([Ur("position")],ff.prototype,"readPosition",null),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Gi(t=>oB.normalize(Rh(t)))],ff.prototype,"heading",void 0),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Gi(t=>me(Rh(t),-180,180))],ff.prototype,"tilt",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],ff.prototype,"fov",void 0),ff=h([F("esri.Camera")],ff);const Ru=ff;var ox;function TTe(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return ox.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return ox.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(ox||(ox={}));const STe=ne.getLogger("esri.support.arcadeOnDemand");let sN;function aB(){return sN||(sN=(async()=>{const t=await he(()=>import("./arcadeUtils-d8abb51f.js").then(e=>e.ax),["assets/arcadeUtils-d8abb51f.js","assets/arcadeTimeUtils-ff24d7d1.js","assets/executionError-c92d3b85.js","assets/FieldsIndex-f92177f9.js","assets/number-554c04c9.js","assets/hash-6f442295.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),sN}const ETe=(t,e,r)=>lB.create(t,e,r,null,["$feature"]),CTe=(t,e,r)=>lB.create(t,e,r,null,["$feature","$view"]),Ylt=(t,e,r,i)=>lB.create(t,e,r,i,["$feature","$view"]);let lB=class Yie{constructor(e,r,i,s,n,o,a){this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await aB(),u=yt.fromJSON(r);let d;try{d=a.parseScript(e,o)}catch(M){return STe.error(new X("arcade-bad-expression","Failed to parse arcade script",{script:e,error:M})),null}const p=n.reduce((M,U)=>({...M,[U]:null}),{});let g=null;s!=null&&(g=new c(s),g.immutable=!0,p.$config=null);const y=a.scriptUsesGeometryEngine(d),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(d),T=w&&a.enableAsyncSupport(),x={vars:p,spatialReference:u,useAsync:!!T};await Promise.all([_,v,T]);const E=new Set;await a.loadDependentModules(E,d,null,w,y);const O=new c;O.immutable=!1,O.setField("scale",0);const A=a.compileScript(d,x),$=M=>("$view"in M&&M.$view&&(O.setField("scale",typeof M.$view=="object"&&"scale"in M.$view?M.$view.scale:void 0),M.$view=O),g&&(M.$config=g),A({vars:M,spatialReference:u}));return new Yie(e,a,d,$,new l,i,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const ATe=/^([0-9])/,OTe=/[^a-z0-9_\u0080-\uffff]/gi,RTe=/_{2,}/g,PTe=/^_/,MTe=/_$/;function Xlt(t){return t==null?null:t.trim().replaceAll(OTe,"_").replaceAll(RTe,"_").replace(PTe,"").replace(MTe,"").replace(ATe,"F$1")||null}const $Te=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],ITe=["field","normalizationField"];function Zlt(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(TH($Te,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)TH(ITe,i,e)}}function TH(t,e,r){if(t)for(const i of t){const s=jC(i,e),n=s&&typeof s!="function"&&r.get(s);n&&Xx(i,n.name,e)}}function Jlt(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),s=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const i=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const nN=new Set;function LTe(t,e){return t&&e?(nN.clear(),XE(nN,t,e),Array.from(nN).sort()):[]}function XE(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of r)XI(t,e,s);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const s of r)s!=null&&t.add(s)}}function XI(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function Qlt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function S1(t,e,r){var n;if(!r)return;const{arcadeUtils:i}=await aB(),s=i.extractFieldNames(r,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)XI(t,e,o)}async function Xie(t,e,r){if(r&&r!=="1=1"){const{WhereClause:i}=await he(()=>import("./WhereClause-bfeee3cb.js").then(n=>n.W),["assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js"]),s=i.create(r,e);if(!s.isStandardized)throw new X("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});XE(t,e,s.fieldNames)}}function Klt({displayField:t,fields:e}){return t||(e&&e.length?oN(e,"name-or-title")||oN(e,"unique-identifier")||oN(e,"type-or-category")||DTe(e):null)}function DTe(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function oN(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function ect(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function NTe(t,e,r){r.onStatisticExpression?S1(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function tct(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(FTe(t,e,s)),r.fields&&i.push(...r.fields.map(async n=>NTe(t,e.fieldsIndex,n))),await Promise.all(i)}async function FTe(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(n=>S1(t,e.fieldsIndex,n.expression)));const s=r==null?void 0:r.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(S1(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function rct(t,e,r){e&&(e.timeInfo&&r!=null&&r.timeExtent&&XE(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&XE(t,e.fieldsIndex,[e.floorInfo.floorField]),r!=null&&r.where!=null&&await Xie(t,e.fieldsIndex,r.where))}async function ict(t,e,r){e&&r&&await Promise.all(r.map(i=>UTe(t,e,i)))}async function UTe(t,e,r){e&&r&&(r.valueExpression?await S1(t,e.fieldsIndex,r.valueExpression):r.field&&XI(t,e.fieldsIndex,r.field))}function sct(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;return e?LTe(t.fieldsIndex,[e.creatorField,e.creationDateField,e.editorField,e.editDateField]):[]}async function nct(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(s=>zTe(t,i,s)))}async function zTe(t,e,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await S1(t,e,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{XI(t,e,o.slice(1,-1))})}await Xie(t,e,s)}function oct(t){const e=t.defaultValue;return e!==void 0&&Qie(t,e)?e:t.nullable?null:void 0}function Zie(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function kTe(t){return t===null||Zie(t)}const cB="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function BTe(t){return t===null||cB(t)}function Jie(t){return t!=null&&typeof t=="string"}function VTe(t){return t===null||Jie(t)}function GTe(){return!0}function Qie(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?BTe:cB;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?kTe:Zie;break;case"string":case"esriFieldTypeString":r=t.nullable?VTe:Jie;break;default:r=GTe}return arguments.length===1?r:r(e)}const jTe=["integer","small-integer","single","double"],HTe=new Set([...jTe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function Kie(t){return t!=null&&HTe.has(t.type)}function act(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}var DM,NM;function lct(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function cct(t,e){return t==null||t.nullable&&e===null?null:Kie(t)&&!WTe(t.type,Number(e))?DM.OUT_OF_RANGE:Qie(t,e)?t.domain?TTe(t.domain,e):null:NM.INVALID_TYPE}function WTe(t,e){const r=typeof t=="string"?ese(t):t;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?cB(e)&&e>=i&&e<=s:e>=i&&e<=s}function ese(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return qTe;case"esriFieldTypeInteger":case"integer":return YTe;case"esriFieldTypeBigInteger":case"big-integer":return XTe;case"esriFieldTypeSingle":case"single":return ZTe;case"esriFieldTypeDouble":case"double":return JTe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(DM||(DM={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(NM||(NM={}));const qTe={min:-32768,max:32767,isInteger:!0},YTe={min:-2147483648,max:2147483647,isInteger:!0},XTe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},ZTe={min:-34e37,max:12e37,isInteger:!1},JTe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function uct(t,e,r){switch(t){case ox.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case ox.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case NM.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case DM.OUT_OF_RANGE:{const{min:i,max:s}=ese(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${s}`}}}function hct(t,e){return!QTe(t,e,null)}function QTe(t,e,r){if(!e||!e.attributes||!t){if(r!=null)for(const n of t??[])r.add(n);return!0}const i=e.attributes;let s=!1;for(const n of t)if(!(n in i)){if(s=!0,r==null)break;r.add(n)}return s}function dct(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let kR=class extends Ke{constructor(e){super(e),this.type=null}};h([f({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],kR.prototype,"type",void 0),kR=h([F("esri.popup.content.Content")],kR);const J0=kR;var g6;let Jy=g6=class extends J0{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new g6({description:this.description,displayType:this.displayType,title:this.title})}};h([f({type:String,json:{write:!0}})],Jy.prototype,"description",void 0),h([f({type:["auto","preview","list"],json:{write:!0}})],Jy.prototype,"displayType",void 0),h([f({type:String,json:{write:!0}})],Jy.prototype,"title",void 0),h([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Jy.prototype,"type",void 0),Jy=g6=h([F("esri.popup.content.AttachmentsContent")],Jy);const FM=Jy;var y6;let Qy=y6=class extends J0{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new y6({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ye(this.outFields):null})}};h([f()],Qy.prototype,"creator",void 0),h([f()],Qy.prototype,"destroyer",void 0),h([f()],Qy.prototype,"outFields",void 0),h([f({type:["custom"],readOnly:!0})],Qy.prototype,"type",void 0),Qy=y6=h([F("esri.popup.content.CustomContent")],Qy);const KTe=Qy;var _6;let Eb=_6=class extends Ke{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new _6({title:this.title,expression:this.expression})}};h([f({type:String,json:{write:!0}})],Eb.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],Eb.prototype,"expression",void 0),h([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],Eb.prototype,"returnType",void 0),Eb=_6=h([F("esri.popup.ElementExpressionInfo")],Eb);const eSe=Eb;var v6;let NT=v6=class extends J0{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new v6({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};h([f({type:eSe,json:{write:!0}})],NT.prototype,"expressionInfo",void 0),h([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],NT.prototype,"type",void 0),NT=v6=h([F("esri.popup.content.ExpressionContent")],NT);const uB=NT;class rv extends Error{}class tSe extends rv{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class rSe extends rv{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class iSe extends rv{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class FT extends rv{}class tse extends rv{constructor(e){super(`Invalid unit ${e}`)}}class ou extends rv{}class zm extends rv{constructor(){super("Zone is an abstract class")}}const Be="numeric",Zh="short",pc="long",UM={year:Be,month:Be,day:Be},rse={year:Be,month:Zh,day:Be},sSe={year:Be,month:Zh,day:Be,weekday:Zh},ise={year:Be,month:pc,day:Be},sse={year:Be,month:pc,day:Be,weekday:pc},nse={hour:Be,minute:Be},ose={hour:Be,minute:Be,second:Be},ase={hour:Be,minute:Be,second:Be,timeZoneName:Zh},lse={hour:Be,minute:Be,second:Be,timeZoneName:pc},cse={hour:Be,minute:Be,hourCycle:"h23"},use={hour:Be,minute:Be,second:Be,hourCycle:"h23"},hse={hour:Be,minute:Be,second:Be,hourCycle:"h23",timeZoneName:Zh},dse={hour:Be,minute:Be,second:Be,hourCycle:"h23",timeZoneName:pc},pse={year:Be,month:Be,day:Be,hour:Be,minute:Be},fse={year:Be,month:Be,day:Be,hour:Be,minute:Be,second:Be},mse={year:Be,month:Zh,day:Be,hour:Be,minute:Be},gse={year:Be,month:Zh,day:Be,hour:Be,minute:Be,second:Be},nSe={year:Be,month:Zh,day:Be,weekday:Zh,hour:Be,minute:Be},yse={year:Be,month:pc,day:Be,hour:Be,minute:Be,timeZoneName:Zh},_se={year:Be,month:pc,day:Be,hour:Be,minute:Be,second:Be,timeZoneName:Zh},vse={year:Be,month:pc,day:Be,weekday:pc,hour:Be,minute:Be,timeZoneName:pc},bse={year:Be,month:pc,day:Be,weekday:pc,hour:Be,minute:Be,second:Be,timeZoneName:pc};class QC{get type(){throw new zm}get name(){throw new zm}get ianaName(){return this.name}get isUniversal(){throw new zm}offsetName(e,r){throw new zm}formatOffset(e,r){throw new zm}offset(e){throw new zm}equals(e){throw new zm}get isValid(){throw new zm}}let aN=null;class ZI extends QC{static get instance(){return aN===null&&(aN=new ZI),aN}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return xse(e,r,i)}formatOffset(e,r){return eE(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let BR={};function oSe(t){return BR[t]||(BR[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),BR[t]}const aSe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function lSe(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,u]=i;return[o,s,n,a,l,c,u]}function cSe(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=aSe[n];n==="era"?i[a]=o:Hr(a)||(i[a]=parseInt(o,10))}return i}let KA={};class nm extends QC{static create(e){return KA[e]||(KA[e]=new nm(e)),KA[e]}static resetCache(){KA={},BR={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=nm.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return xse(e,r,i,this.name)}formatOffset(e,r){return eE(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=oSe(this.name);let[s,n,o,a,l,c,u]=i.formatToParts?cSe(i,r):lSe(i,r);a==="BC"&&(s=-Math.abs(s)+1);const p=pB({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let g=+r;const y=g%1e3;return g-=y>=0?y:1e3+y,(p-g)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let SH={};function uSe(t,e={}){const r=JSON.stringify([t,e]);let i=SH[r];return i||(i=new Intl.ListFormat(t,e),SH[r]=i),i}let b6={};function w6(t,e={}){const r=JSON.stringify([t,e]);let i=b6[r];return i||(i=new Intl.DateTimeFormat(t,e),b6[r]=i),i}let x6={};function hSe(t,e={}){const r=JSON.stringify([t,e]);let i=x6[r];return i||(i=new Intl.NumberFormat(t,e),x6[r]=i),i}let T6={};function dSe(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let n=T6[s];return n||(n=new Intl.RelativeTimeFormat(t,e),T6[s]=n),n}let UT=null;function pSe(){return UT||(UT=new Intl.DateTimeFormat().resolvedOptions().locale,UT)}function fSe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,s;try{i=w6(t).resolvedOptions(),s=t}catch{const l=t.substring(0,r);i=w6(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function mSe(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function gSe(t){const e=[];for(let r=1;r<=12;r++){const i=lr.utc(2016,r,1);e.push(t(i))}return e}function ySe(t){const e=[];for(let r=1;r<=7;r++){const i=lr.utc(2016,11,13+r);e.push(t(i))}return e}function e3(t,e,r,i,s){const n=t.listingMode(r);return n==="error"?null:n==="en"?i(e):s(e)}function _Se(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class vSe{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=hSe(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):dB(e,3);return gn(r,this.padTo)}}}class bSe{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&nm.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=w6(r,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class wSe{constructor(e,r,i){this.opts={style:"long",...i},!r&&wse()&&(this.rtf=dSe(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):USe(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class cs{static fromOpts(e){return cs.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,s=!1){const n=e||fn.defaultLocale,o=n||(s?"en-US":pSe()),a=r||fn.defaultNumberingSystem,l=i||fn.defaultOutputCalendar;return new cs(o,a,l,n)}static resetCache(){UT=null,b6={},x6={},T6={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return cs.create(e,r,i)}constructor(e,r,i,s){const[n,o,a]=fSe(e);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=mSe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=_Se(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:cs.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return e3(this,e,i,Ese,()=>{const s=r?{month:e,day:"numeric"}:{month:e},n=r?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=gSe(o=>this.extract(o,s,"month"))),this.monthsCache[n][e]})}weekdays(e,r=!1,i=!0){return e3(this,e,i,Ose,()=>{const s=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=r?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=ySe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(e=!0){return e3(this,void 0,e,()=>Rse,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[lr.utc(2016,11,13,9),lr.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return e3(this,e,r,Pse,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[lr.utc(-40,1,1),lr.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new vSe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new bSe(e,this.intl,r)}relFormatter(e={}){return new wSe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return uSe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let lN=null;class ua extends QC{static get utcInstance(){return lN===null&&(lN=new ua(0)),lN}static instance(e){return e===0?ua.utcInstance:new ua(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new ua(QI(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${eE(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${eE(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return eE(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class xSe extends QC{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Jg(t,e){if(Hr(t)||t===null)return e;if(t instanceof QC)return t;if(TSe(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?ZI.instance:r==="utc"||r==="gmt"?ua.utcInstance:ua.parseSpecifier(r)||nm.create(t)}else return i1(t)?ua.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new xSe(t)}let EH=()=>Date.now(),CH="system",AH=null,OH=null,RH=null,PH=60,MH;class fn{static get now(){return EH}static set now(e){EH=e}static set defaultZone(e){CH=e}static get defaultZone(){return Jg(CH,ZI.instance)}static get defaultLocale(){return AH}static set defaultLocale(e){AH=e}static get defaultNumberingSystem(){return OH}static set defaultNumberingSystem(e){OH=e}static get defaultOutputCalendar(){return RH}static set defaultOutputCalendar(e){RH=e}static get twoDigitCutoffYear(){return PH}static set twoDigitCutoffYear(e){PH=e%100}static get throwOnInvalid(){return MH}static set throwOnInvalid(e){MH=e}static resetCaches(){cs.resetCache(),nm.resetCache()}}function Hr(t){return typeof t>"u"}function i1(t){return typeof t=="number"}function JI(t){return typeof t=="number"&&t%1===0}function TSe(t){return typeof t=="string"}function SSe(t){return Object.prototype.toString.call(t)==="[object Date]"}function wse(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function ESe(t){return Array.isArray(t)?t:[t]}function $H(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const n=[e(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function CSe(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function ax(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function kf(t,e,r){return JI(t)&&t>=e&&t<=r}function ASe(t,e){return t-e*Math.floor(t/e)}function gn(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function Gg(t){if(!(Hr(t)||t===null||t===""))return parseInt(t,10)}function dy(t){if(!(Hr(t)||t===null||t===""))return parseFloat(t)}function hB(t){if(!(Hr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function dB(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function KC(t){return t%4===0&&(t%100!==0||t%400===0)}function KS(t){return KC(t)?366:365}function zM(t,e){const r=ASe(e-1,12)+1,i=t+(e-r)/12;return r===2?KC(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function pB(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function kM(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function S6(t){return t>99?t:t>fn.twoDigitCutoffYear?1900+t:2e3+t}function xse(t,e,r,i=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function QI(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function Tse(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new ou(`Invalid unit value ${t}`);return e}function BM(t,e){const r={};for(const i in t)if(ax(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=Tse(s)}return r}function eE(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${gn(r,2)}:${gn(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${gn(r,2)}${gn(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function KI(t){return CSe(t,["hour","minute","second","millisecond"])}const OSe=["January","February","March","April","May","June","July","August","September","October","November","December"],Sse=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],RSe=["J","F","M","A","M","J","J","A","S","O","N","D"];function Ese(t){switch(t){case"narrow":return[...RSe];case"short":return[...Sse];case"long":return[...OSe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Cse=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ase=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],PSe=["M","T","W","T","F","S","S"];function Ose(t){switch(t){case"narrow":return[...PSe];case"short":return[...Ase];case"long":return[...Cse];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Rse=["AM","PM"],MSe=["Before Christ","Anno Domini"],$Se=["BC","AD"],ISe=["B","A"];function Pse(t){switch(t){case"narrow":return[...ISe];case"short":return[...$Se];case"long":return[...MSe];default:return null}}function LSe(t){return Rse[t.hour<12?0:1]}function DSe(t,e){return Ose(e)[t.weekday-1]}function NSe(t,e){return Ese(e)[t.month-1]}function FSe(t,e){return Pse(e)[t.year<0?0:1]}function USe(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],u=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function IH(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const zSe={D:UM,DD:rse,DDD:ise,DDDD:sse,t:nse,tt:ose,ttt:ase,tttt:lse,T:cse,TT:use,TTT:hse,TTTT:dse,f:pse,ff:mse,fff:yse,ffff:vse,F:fse,FF:gse,FFF:_se,FFFF:bse};class aa{static create(e,r={}){return new aa(e,r)}static parseFormat(e){let r=null,i="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(e){return zSe[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return gn(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(g,y)=>this.loc.extract(e,g,y),o=g=>e.isOffsetFixed&&e.offset===0&&g.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,g.format):"",a=()=>i?LSe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(g,y)=>i?NSe(e,g):n(y?{month:g}:{month:g,day:"numeric"},"month"),c=(g,y)=>i?DSe(e,g):n(y?{weekday:g}:{weekday:g,month:"long",day:"numeric"},"weekday"),u=g=>{const y=aa.macroTokenToFormatOpts(g);return y?this.formatWithSystemDefault(e,y):g},d=g=>i?FSe(e,g):n({era:g},"era"),p=g=>{switch(g){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(g)}};return IH(aa.parseFormat(r),p)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},n=aa.parseFormat(r),o=n.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return IH(n,s(a))}}class Lh{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Mse=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function e2(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function t2(...t){return e=>t.reduce(([r,i,s],n)=>{const[o,a,l]=n(e,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function r2(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function $se(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=Gg(e[r+s]);return[i,null,r+s]}}const Ise=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,kSe=`(?:${Ise.source}?(?:\\[(${Mse.source})\\])?)?`,fB=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Lse=RegExp(`${fB.source}${kSe}`),mB=RegExp(`(?:T${Lse.source})?`),BSe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,VSe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,GSe=/(\d{4})-?(\d{3})/,jSe=$se("weekYear","weekNumber","weekDay"),HSe=$se("year","ordinal"),WSe=/(\d{4})-(\d\d)-(\d\d)/,Dse=RegExp(`${fB.source} ?(?:${Ise.source}|(${Mse.source}))?`),qSe=RegExp(`(?: ${Dse.source})?`);function $w(t,e,r){const i=t[e];return Hr(i)?r:Gg(i)}function YSe(t,e){return[{year:$w(t,e),month:$w(t,e+1,1),day:$w(t,e+2,1)},null,e+3]}function i2(t,e){return[{hours:$w(t,e,0),minutes:$w(t,e+1,0),seconds:$w(t,e+2,0),milliseconds:hB(t[e+3])},null,e+4]}function eA(t,e){const r=!t[e]&&!t[e+1],i=QI(t[e+1],t[e+2]),s=r?null:ua.instance(i);return[{},s,e+3]}function tA(t,e){const r=t[e]?nm.create(t[e]):null;return[{},r,e+1]}const XSe=RegExp(`^T?${fB.source}$`),ZSe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function JSe(t){const[e,r,i,s,n,o,a,l,c]=t,u=e[0]==="-",d=l&&l[0]==="-",p=(g,y=!1)=>g!==void 0&&(y||g&&u)?-g:g;return[{years:p(dy(r)),months:p(dy(i)),weeks:p(dy(s)),days:p(dy(n)),hours:p(dy(o)),minutes:p(dy(a)),seconds:p(dy(l),l==="-0"),milliseconds:p(hB(c),d)}]}const QSe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function gB(t,e,r,i,s,n,o){const a={year:e.length===2?S6(Gg(e)):Gg(e),month:Sse.indexOf(r)+1,day:Gg(i),hour:Gg(s),minute:Gg(n)};return o&&(a.second=Gg(o)),t&&(a.weekday=t.length>3?Cse.indexOf(t)+1:Ase.indexOf(t)+1),a}const KSe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function eEe(t){const[,e,r,i,s,n,o,a,l,c,u,d]=t,p=gB(e,s,i,r,n,o,a);let g;return l?g=QSe[l]:c?g=0:g=QI(u,d),[p,new ua(g)]}function tEe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const rEe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,iEe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,sEe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function LH(t){const[,e,r,i,s,n,o,a]=t;return[gB(e,s,i,r,n,o,a),ua.utcInstance]}function nEe(t){const[,e,r,i,s,n,o,a]=t;return[gB(e,a,r,i,s,n,o),ua.utcInstance]}const oEe=e2(BSe,mB),aEe=e2(VSe,mB),lEe=e2(GSe,mB),cEe=e2(Lse),Nse=t2(YSe,i2,eA,tA),uEe=t2(jSe,i2,eA,tA),hEe=t2(HSe,i2,eA,tA),dEe=t2(i2,eA,tA);function pEe(t){return r2(t,[oEe,Nse],[aEe,uEe],[lEe,hEe],[cEe,dEe])}function fEe(t){return r2(tEe(t),[KSe,eEe])}function mEe(t){return r2(t,[rEe,LH],[iEe,LH],[sEe,nEe])}function gEe(t){return r2(t,[ZSe,JSe])}const yEe=t2(i2);function _Ee(t){return r2(t,[XSe,yEe])}const vEe=e2(WSe,qSe),bEe=e2(Dse),wEe=t2(i2,eA,tA);function xEe(t){return r2(t,[vEe,Nse],[bEe,wEe])}const TEe="Invalid Duration",Fse={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},SEe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Fse},Rc=146097/400,yv=146097/4800,EEe={years:{quarters:4,months:12,weeks:Rc/7,days:Rc,hours:Rc*24,minutes:Rc*24*60,seconds:Rc*24*60*60,milliseconds:Rc*24*60*60*1e3},quarters:{months:3,weeks:Rc/28,days:Rc/4,hours:Rc*24/4,minutes:Rc*24*60/4,seconds:Rc*24*60*60/4,milliseconds:Rc*24*60*60*1e3/4},months:{weeks:yv/7,days:yv,hours:yv*24,minutes:yv*24*60,seconds:yv*24*60*60,milliseconds:yv*24*60*60*1e3},...Fse},Ky=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],CEe=Ky.slice(0).reverse();function km(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Jr(i)}function AEe(t){return t<0?Math.floor(t):Math.ceil(t)}function Use(t,e,r,i,s){const n=t[s][r],o=e[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?AEe(o):Math.trunc(o);i[s]+=l,e[r]-=l*n}function OEe(t,e){CEe.reduce((r,i)=>Hr(e[i])?r:(r&&Use(t,e,r,e,i),i),null)}function REe(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class Jr{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?EEe:SEe;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||cs.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return Jr.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new ou(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Jr({values:BM(e,Jr.normalizeUnit),loc:cs.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(i1(e))return Jr.fromMillis(e);if(Jr.isDuration(e))return e;if(typeof e=="object")return Jr.fromObject(e);throw new ou(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=gEe(e);return i?Jr.fromObject(i,r):Jr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=_Ee(e);return i?Jr.fromObject(i,r):Jr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new ou("need to specify a reason the Duration is invalid");const i=e instanceof Lh?e:new Lh(e,r);if(fn.throwOnInvalid)throw new iSe(i);return new Jr({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new tse(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?aa.create(this.loc,i).formatDurationFromString(this,e):TEe}toHuman(e={}){const r=Ky.map(i=>{const s=this.values[i];return Hr(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=dB(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=Jr.fromDurationLike(e),i={};for(const s of Ky)(ax(r.values,s)||ax(this.values,s))&&(i[s]=r.get(s)+this.get(s));return km(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=Jr.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=Tse(e(this.values[i],i));return km(this,{values:r},!0)}get(e){return this[Jr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...BM(e,Jr.normalizeUnit)};return km(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:s,conversionAccuracy:i};return km(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return OEe(this.matrix,e),km(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=REe(this.normalize().shiftToAll().toObject());return km(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Jr.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of Ky)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;i1(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)Ky.indexOf(c)>Ky.indexOf(o)&&Use(this.matrix,s,c,r,o)}else i1(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return km(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return km(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of Ky)if(!r(this.values[i],e.values[i]))return!1;return!0}}const _v="Invalid Interval";function PEe(t,e){return!t||!t.isValid?$s.invalid("missing or invalid start"):!e||!e.isValid?$s.invalid("missing or invalid end"):e<t?$s.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class $s{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new ou("need to specify a reason the Interval is invalid");const i=e instanceof Lh?e:new Lh(e,r);if(fn.throwOnInvalid)throw new rSe(i);return new $s({invalid:i})}static fromDateTimes(e,r){const i=M2(e),s=M2(r),n=PEe(i,s);return n??new $s({start:i,end:s})}static after(e,r){const i=Jr.fromDurationLike(r),s=M2(e);return $s.fromDateTimes(s,s.plus(i))}static before(e,r){const i=Jr.fromDurationLike(r),s=M2(e);return $s.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let n,o;try{n=lr.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=lr.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return $s.fromDateTimes(n,a);if(o){const c=Jr.fromISO(s,r);if(c.isValid)return $s.after(n,c)}else if(l){const c=Jr.fromISO(i,r);if(c.isValid)return $s.before(a,c)}}return $s.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?$s.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(M2).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push($s.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(e){const r=Jr.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push($s.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:$s.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return $s.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push($s.fromDateTimes(r,l.time)),r=null);return $s.merge(s)}difference(...e){return $s.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:_v}toLocaleString(e=UM,r={}){return this.isValid?aa.create(this.s.loc.clone(r),e).formatInterval(this):_v}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:_v}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:_v}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:_v}toFormat(e,{separator:r=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:_v}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):Jr.invalid(this.invalidReason)}mapEndpoints(e){return $s.fromDateTimes(e(this.s),e(this.e))}}class t3{static hasDST(e=fn.defaultZone){const r=lr.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return nm.isValidZone(e)}static normalizeZone(e){return Jg(e,fn.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||cs.create(r,i,n)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||cs.create(r,i,n)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||cs.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||cs.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return cs.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return cs.create(r,null,"gregory").eras(e)}static features(){return{relative:wse()}}}function DH(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(Jr.fromMillis(i).as("days"))}function MEe(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=DH(l,c);return(u-u%7)/7}],["days",DH]],s={},n=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s)):t=a);return[t,s,a,o]}function $Ee(t,e,r,i){let[s,n,o,a]=MEe(t,e,r);const l=e-s,c=r.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const u=Jr.fromObject(n,i);return c.length>0?Jr.fromMillis(l,i).shiftTo(...c).plus(u):u}const yB={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},NH={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},IEe=yB.hanidec.replace(/[\[|\]]/g,"").split("");function LEe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(yB.hanidec)!==-1)e+=IEe.indexOf(t[r]);else for(const s in NH){const[n,o]=NH[s];i>=n&&i<=o&&(e+=i-n)}}return parseInt(e,10)}else return e}function Hu({numberingSystem:t},e=""){return new RegExp(`${yB[t||"latn"]}${e}`)}const DEe="missing Intl.DateTimeFormat.formatToParts support";function di(t,e=r=>r){return{regex:t,deser:([r])=>e(LEe(r))}}const NEe=String.fromCharCode(160),zse=`[ ${NEe}]`,kse=new RegExp(zse,"g");function FEe(t){return t.replace(/\./g,"\\.?").replace(kse,zse)}function FH(t){return t.replace(/\./g,"").replace(kse," ").toLowerCase()}function Wu(t,e){return t===null?null:{regex:RegExp(t.map(FEe).join("|")),deser:([r])=>t.findIndex(i=>FH(r)===FH(i))+e}}function UH(t,e){return{regex:t,deser:([,r,i])=>QI(r,i),groups:e}}function r3(t){return{regex:t,deser:([e])=>e}}function UEe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function zEe(t,e){const r=Hu(e),i=Hu(e,"{2}"),s=Hu(e,"{3}"),n=Hu(e,"{4}"),o=Hu(e,"{6}"),a=Hu(e,"{1,2}"),l=Hu(e,"{1,3}"),c=Hu(e,"{1,6}"),u=Hu(e,"{1,9}"),d=Hu(e,"{2,4}"),p=Hu(e,"{4,6}"),g=v=>({regex:RegExp(UEe(v.val)),deser:([w])=>w,literal:!0}),_=(v=>{if(t.literal)return g(v);switch(v.val){case"G":return Wu(e.eras("short",!1),0);case"GG":return Wu(e.eras("long",!1),0);case"y":return di(c);case"yy":return di(d,S6);case"yyyy":return di(n);case"yyyyy":return di(p);case"yyyyyy":return di(o);case"M":return di(a);case"MM":return di(i);case"MMM":return Wu(e.months("short",!0,!1),1);case"MMMM":return Wu(e.months("long",!0,!1),1);case"L":return di(a);case"LL":return di(i);case"LLL":return Wu(e.months("short",!1,!1),1);case"LLLL":return Wu(e.months("long",!1,!1),1);case"d":return di(a);case"dd":return di(i);case"o":return di(l);case"ooo":return di(s);case"HH":return di(i);case"H":return di(a);case"hh":return di(i);case"h":return di(a);case"mm":return di(i);case"m":return di(a);case"q":return di(a);case"qq":return di(i);case"s":return di(a);case"ss":return di(i);case"S":return di(l);case"SSS":return di(s);case"u":return r3(u);case"uu":return r3(a);case"uuu":return di(r);case"a":return Wu(e.meridiems(),0);case"kkkk":return di(n);case"kk":return di(d,S6);case"W":return di(a);case"WW":return di(i);case"E":case"c":return di(r);case"EEE":return Wu(e.weekdays("short",!1,!1),1);case"EEEE":return Wu(e.weekdays("long",!1,!1),1);case"ccc":return Wu(e.weekdays("short",!0,!1),1);case"cccc":return Wu(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return UH(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return UH(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return r3(/[a-z_+-/]{1,256}?/i);case" ":return r3(/[^\S\n\r]/);default:return g(v)}})(t)||{invalidReason:DEe};return _.token=t,_}const kEe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function BEe(t,e){const{type:r,value:i}=t;if(r==="literal"){const o=/^\s+$/.test(i);return{literal:!o,val:o?" ":i}}const s=e[r];let n=kEe[r];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function VEe(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function GEe(t,e,r){const i=t.match(e);if(i){const s={};let n=1;for(const o in r)if(ax(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function jEe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return Hr(t.z)||(r=nm.create(t.z)),Hr(t.Z)||(r||(r=new ua(t.Z)),i=t.Z),Hr(t.q)||(t.M=(t.q-1)*3+1),Hr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Hr(t.u)||(t.S=hB(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),r,i]}let cN=null;function HEe(){return cN||(cN=lr.fromMillis(1555555555555)),cN}function WEe(t,e){if(t.literal)return t;const r=aa.macroTokenToFormatOpts(t.val),i=Gse(r,e);return i==null||i.includes(void 0)?t:i}function Bse(t,e){return Array.prototype.concat(...t.map(r=>WEe(r,e)))}function Vse(t,e,r){const i=Bse(aa.parseFormat(r),t),s=i.map(o=>zEe(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:i,invalidReason:n.invalidReason};{const[o,a]=VEe(s),l=RegExp(o,"i"),[c,u]=GEe(e,l,a),[d,p,g]=u?jEe(u):[null,null,void 0];if(ax(u,"a")&&ax(u,"H"))throw new FT("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:u,result:d,zone:p,specificOffset:g}}}function qEe(t,e,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=Vse(t,e,r);return[i,s,n,o]}function Gse(t,e){return t?aa.create(e,t).formatDateTimeParts(HEe()).map(s=>BEe(s,t)):null}const jse=[0,31,59,90,120,151,181,212,243,273,304,334],Hse=[0,31,60,91,121,152,182,213,244,274,305,335];function yu(t,e){return new Lh("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Wse(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function qse(t,e,r){return r+(KC(t)?Hse:jse)[e-1]}function Yse(t,e){const r=KC(t)?Hse:jse,i=r.findIndex(n=>n<e),s=e-r[i];return{month:i+1,day:s}}function E6(t){const{year:e,month:r,day:i}=t,s=qse(e,r,i),n=Wse(e,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=kM(a)):o>kM(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...KI(t)}}function zH(t){const{weekYear:e,weekNumber:r,weekday:i}=t,s=Wse(e,1,4),n=KS(e);let o=r*7+i-s-3,a;o<1?(a=e-1,o+=KS(a)):o>n?(a=e+1,o-=KS(e)):a=e;const{month:l,day:c}=Yse(a,o);return{year:a,month:l,day:c,...KI(t)}}function uN(t){const{year:e,month:r,day:i}=t,s=qse(e,r,i);return{year:e,ordinal:s,...KI(t)}}function kH(t){const{year:e,ordinal:r}=t,{month:i,day:s}=Yse(e,r);return{year:e,month:i,day:s,...KI(t)}}function YEe(t){const e=JI(t.weekYear),r=kf(t.weekNumber,1,kM(t.weekYear)),i=kf(t.weekday,1,7);return e?r?i?!1:yu("weekday",t.weekday):yu("week",t.week):yu("weekYear",t.weekYear)}function XEe(t){const e=JI(t.year),r=kf(t.ordinal,1,KS(t.year));return e?r?!1:yu("ordinal",t.ordinal):yu("year",t.year)}function Xse(t){const e=JI(t.year),r=kf(t.month,1,12),i=kf(t.day,1,zM(t.year,t.month));return e?r?i?!1:yu("day",t.day):yu("month",t.month):yu("year",t.year)}function Zse(t){const{hour:e,minute:r,second:i,millisecond:s}=t,n=kf(e,0,23)||e===24&&r===0&&i===0&&s===0,o=kf(r,0,59),a=kf(i,0,59),l=kf(s,0,999);return n?o?a?l?!1:yu("millisecond",s):yu("second",i):yu("minute",r):yu("hour",e)}const hN="Invalid DateTime",BH=864e13;function i3(t){return new Lh("unsupported zone",`the zone "${t.name}" is not supported`)}function dN(t){return t.weekData===null&&(t.weekData=E6(t.c)),t.weekData}function R2(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new lr({...r,...e,old:r})}function Jse(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function VH(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function VR(t,e,r){return Jse(pB(t),e,r)}function GH(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:i,month:s,day:Math.min(t.c.day,zM(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Jr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=pB(n);let[l,c]=Jse(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function P2(t,e,r,i,s,n){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=lr.fromObject(t,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return lr.invalid(new Lh("unparsable",`the input "${s}" can't be parsed as ${i}`))}function s3(t,e,r=!0){return t.isValid?aa.create(cs.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function pN(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=gn(t.c.year,r?6:4),e?(i+="-",i+=gn(t.c.month),i+="-",i+=gn(t.c.day)):(i+=gn(t.c.month),i+=gn(t.c.day)),i}function jH(t,e,r,i,s,n){let o=gn(t.c.hour);return e?(o+=":",o+=gn(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=gn(t.c.minute),(t.c.second!==0||!r)&&(o+=gn(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=gn(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=gn(Math.trunc(-t.o/60)),o+=":",o+=gn(Math.trunc(-t.o%60))):(o+="+",o+=gn(Math.trunc(t.o/60)),o+=":",o+=gn(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const Qse={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},ZEe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},JEe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Kse=["year","month","day","hour","minute","second","millisecond"],QEe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],KEe=["year","ordinal","hour","minute","second","millisecond"];function HH(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new tse(t);return e}function WH(t,e){const r=Jg(e.zone,fn.defaultZone),i=cs.fromObject(e),s=fn.now();let n,o;if(Hr(t.year))n=s;else{for(const c of Kse)Hr(t[c])&&(t[c]=Qse[c]);const a=Xse(t)||Zse(t);if(a)return lr.invalid(a);const l=r.offset(s);[n,o]=VR(t,l,r)}return new lr({ts:n,zone:r,loc:i,o})}function qH(t,e,r){const i=Hr(r.round)?!0:r.round,s=(o,a)=>(o=dB(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,r.units[r.units.length-1])}function YH(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class lr{constructor(e){const r=e.zone||fn.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Lh("invalid input"):null)||(r.isValid?null:i3(r));this.ts=Hr(e.ts)?fn.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,n]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=VH(this.ts,a),i=Number.isNaN(s.year)?new Lh("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=e.loc||cs.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new lr({})}static local(){const[e,r]=YH(arguments),[i,s,n,o,a,l,c]=r;return WH({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=YH(arguments),[i,s,n,o,a,l,c]=r;return e.zone=ua.utcInstance,WH({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=SSe(e)?e.valueOf():NaN;if(Number.isNaN(i))return lr.invalid("invalid input");const s=Jg(r.zone,fn.defaultZone);return s.isValid?new lr({ts:i,zone:s,loc:cs.fromObject(r)}):lr.invalid(i3(s))}static fromMillis(e,r={}){if(i1(e))return e<-BH||e>BH?lr.invalid("Timestamp out of range"):new lr({ts:e,zone:Jg(r.zone,fn.defaultZone),loc:cs.fromObject(r)});throw new ou(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(i1(e))return new lr({ts:e*1e3,zone:Jg(r.zone,fn.defaultZone),loc:cs.fromObject(r)});throw new ou("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=Jg(r.zone,fn.defaultZone);if(!i.isValid)return lr.invalid(i3(i));const s=fn.now(),n=Hr(r.specificOffset)?i.offset(s):r.specificOffset,o=BM(e,HH),a=!Hr(o.ordinal),l=!Hr(o.year),c=!Hr(o.month)||!Hr(o.day),u=l||c,d=o.weekYear||o.weekNumber,p=cs.fromObject(r);if((u||a)&&d)throw new FT("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new FT("Can't mix ordinal dates with month/day");const g=d||o.weekday&&!u;let y,_,v=VH(s,n);g?(y=QEe,_=ZEe,v=E6(v)):a?(y=KEe,_=JEe,v=uN(v)):(y=Kse,_=Qse);let w=!1;for(const M of y){const U=o[M];Hr(U)?w?o[M]=_[M]:o[M]=v[M]:w=!0}const T=g?YEe(o):a?XEe(o):Xse(o),x=T||Zse(o);if(x)return lr.invalid(x);const E=g?zH(o):a?kH(o):o,[O,A]=VR(E,n,i),$=new lr({ts:O,zone:i,o:A,loc:p});return o.weekday&&u&&e.weekday!==$.weekday?lr.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${$.toISO()}`):$}static fromISO(e,r={}){const[i,s]=pEe(e);return P2(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=fEe(e);return P2(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=mEe(e);return P2(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(Hr(e)||Hr(r))throw new ou("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=cs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,u]=qEe(o,e,r);return u?lr.invalid(u):P2(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return lr.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=xEe(e);return P2(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new ou("need to specify a reason the DateTime is invalid");const i=e instanceof Lh?e:new Lh(e,r);if(fn.throwOnInvalid)throw new tSe(i);return new lr({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=Gse(e,cs.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(e,r={}){return Bse(aa.parseFormat(e),cs.fromObject(r)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?dN(this).weekYear:NaN}get weekNumber(){return this.isValid?dN(this).weekNumber:NaN}get weekday(){return this.isValid?dN(this).weekday:NaN}get ordinal(){return this.isValid?uN(this.c).ordinal:NaN}get monthShort(){return this.isValid?t3.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?t3.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?t3.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?t3.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return KC(this.year)}get daysInMonth(){return zM(this.year,this.month)}get daysInYear(){return this.isValid?KS(this.year):NaN}get weeksInWeekYear(){return this.isValid?kM(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=aa.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(ua.instance(e),r)}toLocal(){return this.setZone(fn.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=Jg(e,fn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const n=e.offset(this.ts),o=this.toObject();[s]=VR(o,n,e)}return R2(this,{ts:s,zone:e})}else return lr.invalid(i3(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return R2(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=BM(e,HH),i=!Hr(r.weekYear)||!Hr(r.weekNumber)||!Hr(r.weekday),s=!Hr(r.ordinal),n=!Hr(r.year),o=!Hr(r.month)||!Hr(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new FT("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new FT("Can't mix ordinal dates with month/day");let c;i?c=zH({...E6(this.c),...r}):Hr(r.ordinal)?(c={...this.toObject(),...r},Hr(r.day)&&(c.day=Math.min(zM(c.year,c.month),c.day))):c=kH({...uN(this.c),...r});const[u,d]=VR(c,this.o,this.zone);return R2(this,{ts:u,o:d})}plus(e){if(!this.isValid)return this;const r=Jr.fromDurationLike(e);return R2(this,GH(this,r))}minus(e){if(!this.isValid)return this;const r=Jr.fromDurationLike(e).negate();return R2(this,GH(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=Jr.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?aa.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):hN}toLocaleString(e=UM,r={}){return this.isValid?aa.create(this.loc.clone(r),e).formatDateTime(this):hN}toLocaleParts(e={}){return this.isValid?aa.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=pN(this,o);return a+="T",a+=jH(this,o,r,i,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?pN(this,e==="extended"):null}toISOWeekDate(){return s3(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+jH(this,o==="extended",r,e,i,n):null}toRFC2822(){return s3(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return s3(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?pN(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),s3(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():hN}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return Jr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=ESe(r).map(Jr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=$Ee(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(lr.now(),e,r)}until(e){return this.isValid?$s.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||lr.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),qH(r,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?qH(e.base||lr.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(lr.isDateTime))throw new ou("min requires all arguments be DateTimes");return $H(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(lr.isDateTime))throw new ou("max requires all arguments be DateTimes");return $H(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=cs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return Vse(o,e,r)}static fromStringExplain(e,r,i={}){return lr.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return UM}static get DATE_MED(){return rse}static get DATE_MED_WITH_WEEKDAY(){return sSe}static get DATE_FULL(){return ise}static get DATE_HUGE(){return sse}static get TIME_SIMPLE(){return nse}static get TIME_WITH_SECONDS(){return ose}static get TIME_WITH_SHORT_OFFSET(){return ase}static get TIME_WITH_LONG_OFFSET(){return lse}static get TIME_24_SIMPLE(){return cse}static get TIME_24_WITH_SECONDS(){return use}static get TIME_24_WITH_SHORT_OFFSET(){return hse}static get TIME_24_WITH_LONG_OFFSET(){return dse}static get DATETIME_SHORT(){return pse}static get DATETIME_SHORT_WITH_SECONDS(){return fse}static get DATETIME_MED(){return mse}static get DATETIME_MED_WITH_SECONDS(){return gse}static get DATETIME_MED_WITH_WEEKDAY(){return nSe}static get DATETIME_FULL(){return yse}static get DATETIME_FULL_WITH_SECONDS(){return _se}static get DATETIME_HUGE(){return vse}static get DATETIME_HUGE_WITH_SECONDS(){return bse}}function M2(t){if(lr.isDateTime(t))return t;if(t&&t.valueOf&&i1(t.valueOf()))return lr.fromJSDate(t);if(t&&typeof t=="object")return lr.fromObject(t);throw new ou(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const eCe={year:void 0,month:void 0,day:void 0,weekday:void 0},tCe={hour:void 0,minute:void 0,second:void 0},rCe={timeZoneName:"short"},iCe={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},_B={timeZone:"Etc/UTC"},ud={year:"numeric",month:"numeric",day:"numeric"},$2={year:"numeric",month:"long",day:"numeric"},I2={year:"numeric",month:"short",day:"numeric"},L2={year:"numeric",month:"long",weekday:"long",day:"numeric"},Gc={hour:"numeric",minute:"numeric"},qu={...Gc,second:"numeric"},vB={"short-date":ud,"short-date-short-time":{...ud,...Gc},"short-date-short-time-24":{...ud,...Gc,hour12:!1},"short-date-long-time":{...ud,...qu},"short-date-long-time-24":{...ud,...qu,hour12:!1},"short-date-le":ud,"short-date-le-short-time":{...ud,...Gc},"short-date-le-short-time-24":{...ud,...Gc,hour12:!1},"short-date-le-long-time":{...ud,...qu},"short-date-le-long-time-24":{...ud,...qu,hour12:!1},"long-month-day-year":$2,"long-month-day-year-short-time":{...$2,...Gc},"long-month-day-year-short-time-24":{...$2,...Gc,hour12:!1},"long-month-day-year-long-time":{...$2,...qu},"long-month-day-year-long-time-24":{...$2,...qu,hour12:!1},"day-short-month-year":I2,"day-short-month-year-short-time":{...I2,...Gc},"day-short-month-year-short-time-24":{...I2,...Gc,hour12:!1},"day-short-month-year-long-time":{...I2,...qu},"day-short-month-year-long-time-24":{...I2,...qu,hour12:!1},"long-date":L2,"long-date-short-time":{...L2,...Gc},"long-date-short-time-24":{...L2,...Gc,hour12:!1},"long-date-long-time":{...L2,...qu},"long-date-long-time-24":{...L2,...qu,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Gc,"long-time":qu},sCe=Ec()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),ene={ar:"ar-u-nu-latn-ca-gregory"};let C6=new WeakMap,tne=vB["short-date-short-time"];function nCe(t){const e=t||tne;let r=C6.get(e);if(!r){const i=Gh(),s=ene[i]||i;r=new Intl.DateTimeFormat(s,e),C6.set(e,r)}return r}function zT(t){return t?vB[t]:null}function L0(t,e){return nCe(e).format(t)}function oCe(t,e){return L0(new Date(t),{...e,..._B,...tCe})}function aCe(t,e){return L0(new Date(`1970-01-01T${t}Z`),{...e,..._B,...eCe})}function lCe(t,e){const r=lr.fromISO(t,{setZone:!0}),i=Gh(),s=ene[i]??i;return r.toLocaleString(e,{locale:s})}$k(()=>{C6=new WeakMap,tne=vB["short-date-short-time"]});const cCe={ar:"ar-u-nu-latn"};let GR=new WeakMap,rne={};function uCe(t){const e=t||rne;if(!GR.has(e)){const r=Gh(),i=cCe[Gh()]||r;GR.set(e,new Intl.NumberFormat(i,t))}return GR.get(e)}function hCe(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function lx(t,e){return Object.is(t,-0)&&(t=0),uCe(e).format(t)}$k(()=>{GR=new WeakMap,rne={}});let Cb=class extends mm(Ke){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return lx(e,hCe(this))}formatDate(e,r=!1){return this.dateFormat?L0(e,{...zT(this.dateFormat),...r&&_B}):this.formatNumber(e)}formatDateOnly(e){return oCe(e,{...zT(this.dateFormat)})}formatTimeOnly(e){return aCe(e,{...zT(this.dateFormat)})}formatTimestamp(e){return lCe(e,{...zT(this.dateFormat),...iCe,...rCe})}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,r,i){return e&&r&&i?e.trim().split(r).map(s=>this.formatNumber(Number(s))).join(i):e}};h([Kt(sCe)],Cb.prototype,"dateFormat",void 0),h([f({type:Boolean,json:{write:!0}})],Cb.prototype,"digitSeparator",void 0),h([f({type:Qs,json:{write:!0}})],Cb.prototype,"places",void 0),Cb=h([F("esri.popup.support.FieldInfoFormat")],Cb);const dCe=Cb;var A6;let ih=A6=class extends Ke{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new A6({fieldName:this.fieldName,format:this.format?ye(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};h([f({type:String,json:{write:!0}})],ih.prototype,"fieldName",void 0),h([f({type:dCe,json:{write:!0}})],ih.prototype,"format",void 0),h([f({type:Boolean,json:{write:!0,default:!1}})],ih.prototype,"isEditable",void 0),h([f({type:String,json:{write:!0}})],ih.prototype,"label",void 0),h([Kt(new Tn({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],ih.prototype,"stringFieldOption",void 0),h([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],ih.prototype,"statisticType",void 0),h([f({type:String,json:{write:!0}})],ih.prototype,"tooltip",void 0),h([f({type:Boolean,json:{write:!0}})],ih.prototype,"visible",void 0),ih=A6=h([F("esri.popup.FieldInfo")],ih);const ine=ih;var O6;let mf=O6=class extends J0{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new O6(ye({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};h([f({type:Object,json:{write:!0}})],mf.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],mf.prototype,"description",void 0),h([f({type:[ine]})],mf.prototype,"fieldInfos",void 0),h([qr("fieldInfos")],mf.prototype,"writeFieldInfos",null),h([f({type:String,json:{write:!0}})],mf.prototype,"title",void 0),h([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],mf.prototype,"type",void 0),mf=O6=h([F("esri.popup.content.FieldsContent")],mf);const VM=mf;let e_=class extends Ke{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};h([f({type:String,json:{write:!0}})],e_.prototype,"altText",void 0),h([f({type:String,json:{write:!0}})],e_.prototype,"caption",void 0),h([f({type:String,json:{write:!0}})],e_.prototype,"title",void 0),h([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],e_.prototype,"type",void 0),e_=h([F("esri.popup.content.mixins.MediaInfo")],e_);const bB=e_;var R6;let Ab=R6=class extends we{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new R6({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};h([f()],Ab.prototype,"fieldName",void 0),h([f()],Ab.prototype,"tooltip",void 0),h([f()],Ab.prototype,"value",void 0),Ab=R6=h([F("esri.popup.content.support.ChartMediaInfoValueSeries")],Ab);const pCe=Ab;var P6;let t_=P6=class extends Ke{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new P6({fields:ye(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};h([f({type:[String],json:{write:!0}})],t_.prototype,"fields",void 0),h([f({type:String,json:{write:!0}})],t_.prototype,"normalizeField",void 0),h([f({type:[pCe],json:{read:!1}})],t_.prototype,"series",void 0),h([f({type:String,json:{write:!0}})],t_.prototype,"tooltipField",void 0),t_=P6=h([F("esri.popup.content.support.ChartMediaInfoValue")],t_);const fCe=t_;let kT=class extends bB{constructor(e){super(e),this.type=null,this.value=null}};h([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],kT.prototype,"type",void 0),h([f({type:fCe,json:{write:!0}})],kT.prototype,"value",void 0),kT=h([F("esri.popup.content.mixins.ChartMediaInfo")],kT);const eL=kT,tL=Ec()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var M6;let jR=M6=class extends eL{constructor(t){super(t),this.type="bar-chart"}clone(){return new M6({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:tL.write}})],jR.prototype,"type",void 0),jR=M6=h([F("esri.popup.content.BarChartMediaInfo")],jR);const sne=jR;var $6;let HR=$6=class extends eL{constructor(t){super(t),this.type="column-chart"}clone(){return new $6({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:tL.write}})],HR.prototype,"type",void 0),HR=$6=h([F("esri.popup.content.ColumnChartMediaInfo")],HR);const nne=HR;var I6;let BT=I6=class extends Ke{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new I6({linkURL:this.linkURL,sourceURL:this.sourceURL})}};h([f({type:String,json:{write:!0}})],BT.prototype,"linkURL",void 0),h([f({type:String,json:{write:!0}})],BT.prototype,"sourceURL",void 0),BT=I6=h([F("esri.popup.content.support.ImageMediaInfoValue")],BT);const mCe=BT;var L6;let Ob=L6=class extends bB{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new L6({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};h([f({type:Number,json:{write:!0}})],Ob.prototype,"refreshInterval",void 0),h([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],Ob.prototype,"type",void 0),h([f({type:mCe,json:{write:!0}})],Ob.prototype,"value",void 0),Ob=L6=h([F("esri.popup.content.ImageMediaInfo")],Ob);const one=Ob;var D6;let WR=D6=class extends eL{constructor(t){super(t),this.type="line-chart"}clone(){return new D6({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:tL.write}})],WR.prototype,"type",void 0),WR=D6=h([F("esri.popup.content.LineChartMediaInfo")],WR);const ane=WR;var N6;let qR=N6=class extends eL{constructor(t){super(t),this.type="pie-chart"}clone(){return new N6({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:tL.write}})],qR.prototype,"type",void 0),qR=N6=h([F("esri.popup.content.PieChartMediaInfo")],qR);const lne=qR,cne={base:bB,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":sne,"column-chart":nne,"line-chart":ane,"pie-chart":lne,image:one}};var F6;let sh=F6=class extends J0{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?one.fromJSON(e):e.type==="barchart"?sne.fromJSON(e):e.type==="columnchart"?nne.fromJSON(e):e.type==="linechart"?ane.fromJSON(e):e.type==="piechart"?lne.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new F6(ye({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};h([f()],sh.prototype,"activeMediaInfoIndex",void 0),h([f({type:Object,json:{write:!0}})],sh.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],sh.prototype,"description",void 0),h([f({types:[cne]})],sh.prototype,"mediaInfos",void 0),h([Ur("mediaInfos")],sh.prototype,"readMediaInfos",null),h([qr("mediaInfos")],sh.prototype,"writeMediaInfos",null),h([f({type:String,json:{write:!0}})],sh.prototype,"title",void 0),h([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],sh.prototype,"type",void 0),sh=F6=h([F("esri.popup.content.MediaContent")],sh);const GM=sh;var U6;let VT=U6=class extends Ke{constructor(t){super(t),this.field=null,this.order=null}clone(){return new U6({field:this.field,order:this.order})}};h([f({type:String,json:{write:!0}})],VT.prototype,"field",void 0),h([f({type:["asc","desc"],json:{write:!0}})],VT.prototype,"order",void 0),VT=U6=h([F("esri.popup.support.RelatedRecordsInfoFieldOrder")],VT);const une=VT;let Ld=class extends mm(J0){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};h([f({type:String,json:{write:!0}})],Ld.prototype,"description",void 0),h([f({type:Number,json:{type:Qs,write:!0}})],Ld.prototype,"displayCount",void 0),h([f({type:["list"],json:{write:!0}})],Ld.prototype,"displayType",void 0),h([f({type:[une],json:{write:!0}})],Ld.prototype,"orderByFields",void 0),h([f({type:Number,json:{type:Qs,write:!0}})],Ld.prototype,"relationshipId",void 0),h([f({type:String,json:{write:!0}})],Ld.prototype,"title",void 0),h([f({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Ld.prototype,"type",void 0),Ld=h([F("esri.popup.content.RelationshipContent")],Ld);const jM=Ld;var z6;let GT=z6=class extends J0{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new z6({text:this.text})}};h([f({type:String,json:{write:!0}})],GT.prototype,"text",void 0),h([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],GT.prototype,"type",void 0),GT=z6=h([F("esri.popup.content.TextContent")],GT);const HM=GT,gCe={base:null,key:"type",typeMap:{attachment:FM,media:GM,text:HM,expression:uB,field:VM,relationship:jM}};var k6;let r_=k6=class extends Ke{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new k6({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([f({type:String,json:{write:!0}})],r_.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],r_.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],r_.prototype,"expression",void 0),h([f({type:["string","number"],json:{write:!0}})],r_.prototype,"returnType",void 0),r_=k6=h([F("esri.popup.ExpressionInfo")],r_);const yCe=r_;var B6;let jT=B6=class extends Ke{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new B6({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};h([f({type:Boolean,json:{write:!0}})],jT.prototype,"returnTopmostRaster",void 0),h([f({type:Boolean,json:{write:!0}})],jT.prototype,"showNoDataRecords",void 0),jT=B6=h([F("esri.popup.LayerOptions")],jT);const _Ce=jT;var V6;let HT=V6=class extends Ke{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new V6({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ye(this.orderByFields):null})}};h([f({type:Boolean,json:{write:!0}})],HT.prototype,"showRelatedRecords",void 0),h([f({type:[une],json:{write:!0}})],HT.prototype,"orderByFields",void 0),HT=V6=h([F("esri.popup.RelatedRecordsInfo")],HT);const vCe=HT;var G6;let jc=G6=class extends sB(we){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new G6({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};h([f()],jc.prototype,"active",void 0),h([f()],jc.prototype,"className",void 0),h([f()],jc.prototype,"disabled",void 0),h([f()],jc.prototype,"icon",void 0),h([f()],jc.prototype,"id",void 0),h([f()],jc.prototype,"indicator",void 0),h([f()],jc.prototype,"title",void 0),h([f()],jc.prototype,"type",void 0),h([f()],jc.prototype,"visible",void 0),jc=G6=h([F("esri.support.actions.ActionBase")],jc);const wB=jc;var j6;let YR=j6=class extends wB{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new j6({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};h([f()],YR.prototype,"image",void 0),YR=j6=h([F("esri.support.Action.ActionButton")],YR);const bCe=YR;var H6;let WT=H6=class extends wB{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new H6({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};h([f()],WT.prototype,"image",void 0),h([f()],WT.prototype,"value",void 0),WT=H6=h([F("esri.support.Action.ActionToggle")],WT);const wCe=WT,xCe="esri.PopupTemplate",TCe=ne.getLogger(xCe),D2="relationships/",XH="expression/",SCe=er.ofType({key:"type",defaultKeyValue:"button",base:wB,typeMap:{button:bCe,toggle:wCe}}),ECe={base:J0,key:"type",typeMap:{media:GM,custom:KTe,text:HM,attachments:FM,fields:VM,expression:uB,relationship:jM}},CCe=["attachments","fields","media","text","expression","relationship"];let Ln=class extends mm(Ke){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>R0(ECe,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Sc(e)?e:(TCe.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(n=>CCe.includes(n.type)).map(n=>n&&n.toJSON(s)),r.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(r):n.type==="media"?this._writeMediaContent(n,r):n.type==="text"?this._writeTextContent(n,r):n.type==="relationship"&&this._writeRelationshipContent(n,r)})):r.description=e}writeFieldInfos(e,r,i,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});r.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(s);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,s){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),XE(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ye(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(s=>{const n=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:r.fieldInfos.push(s)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var n,o;const i=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ye(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const s={description:!1,mediaInfos:!1};return i.map(n=>n.type==="media"?(n.mediaInfos||!r||s.mediaInfos||(n.mediaInfos=r,s.mediaInfos=!0),GM.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),HM.fromJSON(n)):n.type==="attachments"?FM.fromJSON(n):n.type==="fields"?VM.fromJSON(n):n.type==="expression"?uB.fromJSON(n):n.type==="relationship"?jM.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(D2)))return null;const s=r.replace(D2,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?jM.fromJSON({relationshipId:n,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:s}=e;return{field:`${D2}${r}/${s}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new HM({text:e})):n.push(new VM),Array.isArray(r)&&r.length&&n.push(GM.fromJSON({mediaInfos:r})),i&&n.push(FM.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=n,d=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,s)=>[...i,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(s=>S1(e,r,s.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(D2)&&!r.startsWith(XH)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const s=/\{(\w+):.+\}/,n=i.filter(o=>!(o.indexOf(`{${D2}`)===0||o.indexOf(`{${XH}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};h([f({type:SCe})],Ln.prototype,"actions",void 0),h([f()],Ln.prototype,"content",void 0),h([Gi("content")],Ln.prototype,"castContent",null),h([Ur("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Ln.prototype,"readContent",null),h([qr("content",{popupElements:{type:er.ofType(gCe)},showAttachments:{type:Boolean},mediaInfos:{type:er.ofType(cne)},description:{type:String},relatedRecordsInfo:{type:vCe}})],Ln.prototype,"writeContent",null),h([f({type:[yCe],json:{write:!0}})],Ln.prototype,"expressionInfos",void 0),h([f({type:[ine]})],Ln.prototype,"fieldInfos",void 0),h([qr("fieldInfos")],Ln.prototype,"writeFieldInfos",null),h([f({type:_Ce})],Ln.prototype,"layerOptions",void 0),h([qr("layerOptions")],Ln.prototype,"writeLayerOptions",null),h([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Ln.prototype,"lastEditInfoEnabled",void 0),h([f()],Ln.prototype,"outFields",void 0),h([f()],Ln.prototype,"overwriteActions",void 0),h([f()],Ln.prototype,"returnGeometry",void 0),h([f({json:{type:String}})],Ln.prototype,"title",void 0),h([qr("title")],Ln.prototype,"writeTitle",null),Ln=h([F("esri.PopupTemplate")],Ln);const ACe=Ln,ZH=new Tn({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let OCe=0,Rb=class extends Ke{constructor(e){super(e),this.id="sym"+OCe++,this.type=null,this.color=new ht([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};h([f({type:ZH.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:ZH.write}}})],Rb.prototype,"type",void 0),h([f({type:ht,json:{write:{allowNull:!0}}})],Rb.prototype,"color",void 0),h([Ur("color")],Rb.prototype,"readColor",null),Rb=h([F("esri.symbols.Symbol")],Rb);const Cc=Rb;var W6;let wg=W6=class extends Cc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const s=i.map(n=>{const o=n.valueExpressionInfo;return S1(t,e,o.expression)});await Promise.all(s)}}}clone(){return new W6({data:ye(this.data)})}hash(){return bte(JSON.stringify(this.data)).toString()}};h([f({json:{write:!1}})],wg.prototype,"color",void 0),h([f({json:{write:!0}})],wg.prototype,"data",void 0),h([Ur("data",["symbol"])],wg.prototype,"readData",null),h([qr("data",{})],wg.prototype,"writeData",null),h([Kt({CIMSymbolReference:"cim"},{readOnly:!0})],wg.prototype,"type",void 0),wg=W6=h([F("esri.symbols.CIMSymbol")],wg);const s2=wg;let Pb=class extends Ke{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};h([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],Pb.prototype,"enabled",void 0),h([qr("enabled")],Pb.prototype,"writeEnabled",null),h([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],Pb.prototype,"type",void 0),Pb=h([F("esri.symbols.Symbol3DLayer")],Pb);const Np=Pb,RCe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,PCe="screenUtils.toPt: input not recognized!",hne=96;function Fo(t){return t?t/72*hne:0}function Jh(t){return t?72*t/hne:0}function bs(t){if(typeof t=="string"){const e=t.match(RCe);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=i==="px"?Jh(r):r;return s?-n:n}return console.warn(PCe),null}return t}function Pu(t=0,e=0){return{x:t,y:e}}function Li(t=0,e=0){return[t,e]}function dne(t=0,e=0){return[t,e]}function mo(t=0,e=0,r=0){return[t,e,r]}function wct(t){return t}function xct(t){return t}function Tct(t){return t}function tp(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function MCe(t,e){const r=e.transparency!=null?bie(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new ht([i[0]||0,i[1]||0,i[2]||0,r]):null}function $Ce(t,e){e.color=t.toJSON().slice(0,3);const r=vie(t.a);r!==0&&(e.transparency=r)}const gm={type:ht,json:{type:[Qs],default:null,read:{source:["color","transparency"],reader:MCe},write:{target:{color:{type:[Qs]},transparency:{type:Qs}},writer:$Ce}}},Cp={type:Number,cast:bs,json:{write:!0}};let i_=class extends Ke{constructor(e){super(e),this.color=new ht([0,0,0,1]),this.extensionLength=0,this.size=Jh(1)}clone(){}cloneProperties(){return{color:ye(this.color),size:this.size,extensionLength:this.extensionLength}}};h([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],i_.prototype,"type",void 0),h([f(gm)],i_.prototype,"color",void 0),h([f({...Cp,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],i_.prototype,"extensionLength",void 0),h([f(Cp)],i_.prototype,"size",void 0),i_=h([F("esri.symbols.edges.Edges3D")],i_);const xB=i_;var q6;let XR=q6=class extends xB{constructor(t){super(t),this.type="sketch"}clone(){return new q6(this.cloneProperties())}};h([Kt({sketch:"sketch"},{readOnly:!0})],XR.prototype,"type",void 0),XR=q6=h([F("esri.symbols.edges.SketchEdges3D")],XR);const ICe=XR;var Y6;let ZR=Y6=class extends xB{constructor(t){super(t),this.type="solid"}clone(){return new Y6(this.cloneProperties())}};h([Kt({solid:"solid"},{readOnly:!0})],ZR.prototype,"type",void 0),ZR=Y6=h([F("esri.symbols.support.SolidEdges3D")],ZR);const LCe=ZR,pne={types:{key:"type",base:xB,typeMap:{solid:LCe,sketch:ICe}},json:{write:!0}};var X6;let fc=X6=class extends Ke{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new X6(t)}};h([f(gm)],fc.prototype,"color",void 0),fc=X6=h([F("esri.symbols.support.Symbol3DMaterial")],fc);var Z6;let xg=Z6=class extends Np{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new Z6({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};h([Kt({Extrude:"extrude"},{readOnly:!0})],xg.prototype,"type",void 0),h([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],xg.prototype,"size",void 0),h([f({type:fc,json:{write:!0}})],xg.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],xg.prototype,"castShadows",void 0),h([f(pne)],xg.prototype,"edges",void 0),xg=Z6=h([F("esri.symbols.ExtrudeSymbol3DLayer")],xg);const fne=xg;let qT=class extends Cc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};h([Kt({esriSLS:"simple-line"},{readOnly:!0})],qT.prototype,"type",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],qT.prototype,"width",void 0),qT=h([F("esri.symbols.LineSymbol")],qT);const DCe=qT,NCe=["begin","end","begin-end"],mne=["arrow","circle","square","diamond","cross","x"];var J6;let Dd=J6=class extends Ke{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new J6({color:ye(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};h([f({type:["begin","end","begin-end"],json:{write:!0}})],Dd.prototype,"placement",void 0),h([Kt({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],Dd.prototype,"type",void 0),h([f({type:mne})],Dd.prototype,"style",void 0),h([qr("style")],Dd.prototype,"writeStyle",null),h([f({type:ht,value:null,json:{write:{allowNull:!0}}})],Dd.prototype,"color",null),h([Ur("color")],Dd.prototype,"readColor",null),h([qr("color")],Dd.prototype,"writeColor",null),Dd=J6=h([F("esri.symbols.LineSymbolMarker")],Dd);const FCe=Dd;var Q6;const fN=new Tn({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let gf=Q6=class extends DCe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=bs(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=bs(n)),o}clone(){var t;return new Q6({color:ye(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};h([Kt({esriSLS:"simple-line"},{readOnly:!0})],gf.prototype,"type",void 0),h([f({type:fN.apiValues,json:{read:fN.read,write:fN.write}})],gf.prototype,"style",void 0),h([f({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],gf.prototype,"cap",void 0),h([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],gf.prototype,"join",void 0),h([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":FCe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],gf.prototype,"marker",void 0),h([f({type:Number,json:{read:!1,write:!1}})],gf.prototype,"miterLimit",void 0),gf=Q6=h([F("esri.symbols.SimpleLineSymbol")],gf);const iv=gf;let YT=class extends Cc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":iv}},json:{default:null,write:!0}})],YT.prototype,"outline",void 0),h([f({type:["simple-fill","picture-fill"],readOnly:!0})],YT.prototype,"type",void 0),YT=h([F("esri.symbols.FillSymbol")],YT);const gne=YT;let JR=class extends Ke{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],JR.prototype,"type",void 0),JR=h([F("esri.symbols.patterns.LinePattern3D")],JR);const yne=JR,UCe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var K6;const zCe=Ec()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let XT=K6=class extends yne{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new K6(t)}};h([f({type:["style"]})],XT.prototype,"type",void 0),h([Kt(zCe),f({type:UCe})],XT.prototype,"style",void 0),XT=K6=h([F("esri.symbols.patterns.LineStylePattern3D")],XT);const TB=XT;let QR=class extends Ke{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],QR.prototype,"type",void 0),QR=h([F("esri.symbols.patterns.Pattern3D")],QR);const _ne=QR,kCe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var e9;let ZT=e9=class extends _ne{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new e9(t)}};h([f({type:["style"]})],ZT.prototype,"type",void 0),h([f({type:kCe,json:{read:!0,write:!0}})],ZT.prototype,"style",void 0),ZT=e9=h([F("esri.symbols.patterns.StylePattern3D")],ZT);const vne=ZT,BCe={types:{key:"type",base:_ne,typeMap:{style:vne}},json:{write:!0}},bne={types:{key:"type",base:yne,typeMap:{style:TB}},json:{write:!0}},tE=new ht("white");new ht("black");const VCe=new ht([255,255,255,0]);function GCe(t){return t.r===0&&t.g===0&&t.b===0}var t9;let rE=t9=class extends fc{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new t9(t)}};h([Kt({multiply:"multiply",replace:"replace",tint:"tint"})],rE.prototype,"colorMixMode",void 0),rE=t9=h([F("esri.symbols.support.Symbol3DFillMaterial")],rE);function Bs(t=Ene){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function E1(t,e,r,i,s,n,o=Bs()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function Rct(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new Wr(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function cx(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function jCe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Ap(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function hc(t,e,r=0,i=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<i;u++)s=Math.min(s,e[r+3*u]),n=Math.min(n,e[r+3*u+1]),o=Math.min(o,e[r+3*u+2]),a=Math.max(a,e[r+3*u]),l=Math.max(l,e[r+3*u+1]),c=Math.max(c,e[r+3*u+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function mN(t,e,r){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let u=0;u<i;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let u=0;u<i;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function HCe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function sv(t){return t[0]>=t[3]?0:t[3]-t[0]}function nv(t){return t[1]>=t[4]?0:t[4]-t[1]}function Q0(t){return t[2]>=t[5]?0:t[5]-t[2]}function wne(t){const e=sv(t),r=Q0(t),i=nv(t);return Math.sqrt(e*e+r*r+i*i)}function Dh(t,e=[0,0,0]){return e[0]=t[0]+sv(t)/2,e[1]=t[1]+nv(t)/2,e[2]=t[2]+Q0(t)/2,e}function n3(t,e=[0,0,0]){return e[0]=sv(t),e[1]=nv(t),e[2]=Q0(t),e}function SB(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function Pct(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function WCe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Nh(t,e){return e==null||WCe(t,e)}function xne(t,e,r,i,s=t){return s[0]=t[0]+e,s[1]=t[1]+r,s[2]=t[2]+i,s[3]=t[3]+e,s[4]=t[4]+r,s[5]=t[5]+i,s}function Mct(t,e,r=t){const i=t[0]+sv(t)/2,s=t[1]+nv(t)/2,n=t[2]+Q0(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=s+(t[1]-s)*e,r[2]=n+(t[2]-n)*e,r[3]=i+(t[3]-i)*e,r[4]=s+(t[4]-s)*e,r[5]=n+(t[5]-n)*e,r}function Tne(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function Sne(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function rL(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function li(t){return t?rL(t,JH):Bs(JH)}function EB(t,e){return e||(e=Ut()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function $ct(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function qCe(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function r9(t){return t.length===6}function CB(t){return sv(t)===0&&nv(t)===0&&Q0(t)===0}function Ict(t,e,r){if(t==null||e==null)return t===e;if(!r9(t)||!r9(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function YCe(t,e,r,i,s,n){return E1(t,e,r,i,s,n,XCe)}const Lct=[-1/0,-1/0,-1/0,1/0,1/0,1/0],JH=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Ene=[0,0,0,0,0,0],XCe=Bs();function gN(t,{isPrimitive:e,width:r,depth:i,height:s}){const n=e?10:1;if(r==null&&s==null&&i==null)return[n*t[0],n*t[1],n*t[2]];const o=Ce(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const ZCe=E1(-.5,-.5,-.5,.5,.5,.5),JCe=E1(-.5,-.5,0,.5,.5,1),QCe=E1(-.5,-.5,0,.5,.5,.5);function KCe(t){switch(t){case"sphere":case"cube":case"diamond":return ZCe;case"cylinder":case"cone":case"inverted-cone":return JCe;case"tetrahedron":return QCe;default:return}}const AB=["butt","square","round"],eAe=[...AB,"none"],Cne=["miter","bevel","round"];var i9;let s_=i9=class extends Ke{constructor(t){super(t),this.color=new ht([0,0,0,1]),this.size=Jh(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new i9(t)}};h([f(gm)],s_.prototype,"color",void 0),h([f(Cp)],s_.prototype,"size",void 0),h([f(bne)],s_.prototype,"pattern",void 0),h([f({type:AB,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],s_.prototype,"patternCap",void 0),s_=i9=h([F("esri.symbols.support.Symbol3DOutline")],s_);var KR;let yf=KR=class extends Np{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new KR(t)}static fromSimpleFillSymbol(t){var i,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new TB({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((s=t.outline)==null?void 0:s.color)??tE).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(r.patternCap=t.outline.cap),new KR({material:new rE({color:(t.color??VCe).clone()}),pattern:t.style&&t.style!=="solid"?new vne({style:t.style}):null,outline:r})}};h([Kt({Fill:"fill"},{readOnly:!0})],yf.prototype,"type",void 0),h([f({type:rE,json:{write:!0}})],yf.prototype,"material",void 0),h([f(BCe)],yf.prototype,"pattern",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],yf.prototype,"castShadows",void 0),h([f({type:s_,json:{write:!0}})],yf.prototype,"outline",void 0),h([f(pne)],yf.prototype,"edges",void 0),yf=KR=h([F("esri.symbols.FillSymbol3DLayer")],yf);const rA=yf,tAe=["none","underline","line-through"],rAe=["normal","italic","oblique"],iAe=["normal","lighter","bold","bolder"],Ane={type:Number,cast:t=>{const e=Rh(t);return e===0?1:me(e,.1,4)},nonNullable:!0},sAe=["left","right","center"],nAe=["baseline","top","middle","bottom"],One={type:sAe,nonNullable:!0},Rne={type:nAe,nonNullable:!0};var s9;let _f=s9=class extends Ke{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return bs(t)}clone(){return new s9({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};h([f({type:tAe,json:{default:"none",write:!0}})],_f.prototype,"decoration",void 0),h([f({type:String,json:{write:!0}})],_f.prototype,"family",void 0),h([f({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],_f.prototype,"size",void 0),h([Gi("size")],_f.prototype,"castSize",null),h([f({type:rAe,json:{default:"normal",write:!0}})],_f.prototype,"style",void 0),h([f({type:iAe,json:{default:"normal",write:!0}})],_f.prototype,"weight",void 0),_f=s9=h([F("esri.symbols.Font")],_f);const iL=_f;function C1(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=ac(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=yk(t,e.portalItem.itemUrl);i!=null&&oAe.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return n9(t,e&&e.portal)}function ux(t,e,r=ZE.YES){if(t==null)return t;!dc(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=ac(t);if(e){const s=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(s){const n=n9(s,e.portal),o=n9(i,e.portal);i=yk(o,n,n),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=Mne(i,e==null?void 0:e.portal),dc(i)&&(i=Gf(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!dc(i)&&!Ip(i)&&r===ZE.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function OB(t,e,r){return C1(t,r)}function A1(t,e,r,i){const s=ux(t,i);s!==void 0&&(e[r]=s)}const Pne=/\/items\/([^\/]+)\/resources\/(.*)/,oAe=/^\.\/resources\//;function aAe(t){const e=(t==null?void 0:t.match(Pne))??null;return(e==null?void 0:e[1])??null}function lAe(t){const e=(t==null?void 0:t.match(Pne))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=jj(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=jj(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function Mne(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?HF(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function n9(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=fk();return tx(i,`${i.scheme}://${r}`)?HF(t,e.portalHostname,r):HF(t,r,e.portalHostname)}var ZE;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(ZE||(ZE={}));const Dct=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return ZE},ensureMainOnlineDomain:Mne,fromJSON:C1,itemIdFromResourceUrl:aAe,prefixAndFilenameFromResourceUrl:lAe,read:OB,toJSON:ux,write:A1},Symbol.toStringTag,{value:"Module"}));var o9;const cAe=Ec()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let n_=o9=class extends Ke{constructor(t){super(t)}readHref(t,e,r){return t?C1(t,r):e.dataURI}writeHref(t,e,r,i){t&&(Ip(t)?e.dataURI=t:(e.href=ux(t,i),dc(e.href)&&(e.href=Gf(e.href))))}clone(){return new o9({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],n_.prototype,"href",void 0),h([Ur("href")],n_.prototype,"readHref",null),h([qr("href",{href:{type:String},dataURI:{type:String}})],n_.prototype,"writeHref",null),h([Kt(cAe)],n_.prototype,"primitive",void 0),n_=o9=h([F("esri.symbols.support.IconSymbol3DLayerResource")],n_);const uAe="circle";var a9;let lw=a9=class extends we{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new a9({x:this.x,y:this.y})}};h([f({type:Number})],lw.prototype,"x",void 0),h([f({type:Number})],lw.prototype,"y",void 0),lw=a9=h([F("esri.symbols.support.Symbol3DAnchorPosition2D")],lw);var l9;let JT=l9=class extends Ke{constructor(t){super(t),this.color=new ht([0,0,0,1]),this.size=Jh(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new l9(t)}};h([f(gm)],JT.prototype,"color",void 0),h([f(Cp)],JT.prototype,"size",void 0),JT=l9=h([F("esri.symbols.support.Symbol3DIconOutline")],JT);var Mb;const $ne="esri.symbols.IconSymbol3DLayer";let Nd=Mb=class extends Np{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new Mb({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||tE,r=QH(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||tE).clone()}:null;return new Mb({size:t.size,resource:{primitive:dAe(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||GCe(t.color)?tE:t.color,r=QH(t);return new Mb({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new Mb({resource:{href:wre({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function QH(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=KH(t.xoffset),s=KH(t.yoffset);return(i||s)&&e&&r?{x:-i/e,y:s/r}:null}function KH(t){return isFinite(t)?t:0}h([f({type:fc,json:{write:!0}})],Nd.prototype,"material",void 0),h([f({type:n_,json:{write:!0}})],Nd.prototype,"resource",void 0),h([Kt({Icon:"icon"},{readOnly:!0})],Nd.prototype,"type",void 0),h([f(Cp)],Nd.prototype,"size",void 0),h([Kt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),f({json:{default:"center"}})],Nd.prototype,"anchor",void 0),h([f({type:lw,json:{type:[Number],read:{reader:t=>new lw({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Nd.prototype,"anchorPosition",void 0),h([f({type:JT,json:{write:!0}})],Nd.prototype,"outline",void 0),Nd=Mb=h([F($ne)],Nd);const hAe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function dAe(t){return hAe[t]||(ne.getLogger($ne).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const a0=Nd;let o_=class extends mm(Ke){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],o_.prototype,"type",void 0),h([f({type:NCe,json:{default:"begin-end",write:!0}})],o_.prototype,"placement",void 0),h([f({type:mne,json:{default:"arrow",write:!0}})],o_.prototype,"style",void 0),h([f({type:ht,json:{type:[Qs],default:null,write:!0}})],o_.prototype,"color",void 0),o_=h([F("esri.symbols.LineStyleMarker3D")],o_);const c9=o_;var eP;let Fd=eP=class extends Np{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Jh(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new eP(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??Jh(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new TB({style:t.style}):null,material:new fc({color:(t.color||tE).clone()}),marker:t.marker?new c9({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new eP(e)}};h([f({type:fc,json:{write:!0}})],Fd.prototype,"material",void 0),h([Kt({Line:"line"},{readOnly:!0})],Fd.prototype,"type",void 0),h([f({type:Cne,json:{write:!0,default:"miter"}})],Fd.prototype,"join",void 0),h([f({type:AB,json:{write:!0,default:"butt"}})],Fd.prototype,"cap",void 0),h([f(Cp)],Fd.prototype,"size",void 0),h([f(bne)],Fd.prototype,"pattern",void 0),h([f({types:{key:"type",base:c9,typeMap:{style:c9}},json:{write:!0}})],Fd.prototype,"marker",void 0),Fd=eP=h([F("esri.symbols.LineSymbol3DLayer")],Fd);const iA=Fd;var u9;const pAe=Ec()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let QT=u9=class extends Ke{clone(){return new u9({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{read:OB,write:A1}})],QT.prototype,"href",void 0),h([Kt(pAe)],QT.prototype,"primitive",void 0),QT=u9=h([F("esri.symbols.support.ObjectSymbol3DLayerResource")],QT);const Ine="sphere";var h9;let L_=h9=class extends we{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new h9({x:this.x,y:this.y,z:this.z})}};h([f({type:Number})],L_.prototype,"x",void 0),h([f({type:Number})],L_.prototype,"y",void 0),h([f({type:Number})],L_.prototype,"z",void 0),L_=h9=h([F("esri.symbols.support.Symbol3DAnchorPosition3D")],L_);var d9;let Yo=d9=class extends Np{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new d9({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};h([f({type:fc,json:{write:!0}})],Yo.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Yo.prototype,"castShadows",void 0),h([f({type:QT,json:{write:!0}})],Yo.prototype,"resource",void 0),h([Kt({Object:"object"},{readOnly:!0})],Yo.prototype,"type",void 0),h([f({type:Number,json:{write:!0}})],Yo.prototype,"width",void 0),h([f({type:Number,json:{write:!0}})],Yo.prototype,"height",void 0),h([f({type:Number,json:{write:!0}})],Yo.prototype,"depth",void 0),h([Kt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),f({json:{default:"origin"}})],Yo.prototype,"anchor",void 0),h([f({type:L_,json:{type:[Number],read:{reader:t=>new L_({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Yo.prototype,"anchorPosition",void 0),h([f({type:Number,json:{write:!0}})],Yo.prototype,"heading",void 0),h([f({type:Number,json:{write:!0}})],Yo.prototype,"tilt",void 0),h([f({type:Number,json:{write:!0}})],Yo.prototype,"roll",void 0),h([f({readOnly:!0})],Yo.prototype,"isPrimitive",null),Yo=d9=h([F("esri.symbols.ObjectSymbol3DLayer")],Yo);const RB=Yo;var p9;let Aa=p9=class extends Np{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new p9({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};h([f({type:fc,json:{write:!0}})],Aa.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Aa.prototype,"castShadows",void 0),h([Kt({Path:"path"},{readOnly:!0})],Aa.prototype,"type",void 0),h([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],Aa.prototype,"profile",void 0),h([f({type:Cne,json:{write:!0,default:"miter"}})],Aa.prototype,"join",void 0),h([f({type:eAe,json:{write:!0,default:"butt"}})],Aa.prototype,"cap",void 0),h([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Aa.prototype,"width",void 0),h([Ur("width",["width","size","height"])],Aa.prototype,"readWidth",null),h([f({type:Number,json:{write:!0}})],Aa.prototype,"height",void 0),h([Ur("height",["height","size","width"])],Aa.prototype,"readHeight",null),h([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Aa.prototype,"anchor",void 0),h([f({type:["heading","all"],json:{write:!0,default:"all"}})],Aa.prototype,"profileRotation",void 0),Aa=p9=h([F("esri.symbols.PathSymbol3DLayer")],Aa);const PB=Aa;var f9;let cw=f9=class extends Ke{constructor(){super(...arguments),this.color=new ht([0,0,0,1]),this.size=0}clone(){const t={color:ye(this.color),size:this.size};return new f9(t)}};h([f(gm)],cw.prototype,"color",void 0),h([f(Cp)],cw.prototype,"size",void 0),cw=f9=h([F("esri.symbols.support.Symbol3DHalo")],cw);let iE=class extends mm(Ke){constructor(e){super(e),this.color=null}};h([f(gm)],iE.prototype,"color",void 0),iE=h([F("esri.symbols.support.Symbol3DTextBackground")],iE);var tP;let nl=tP=class extends Np{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const s={...i,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new tP({enabled:this.enabled,font:this.font&&ye(this.font),halo:this.halo&&ye(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ye(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new tP({font:t.font!=null?t.font.clone():new iL,halo:fAe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new fc({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new iE({color:t.backgroundColor.clone()}):null})}};function fAe(t,e){return t&&e!=null&&e>0?new cw({color:ye(t),size:e}):null}h([f({type:iL,json:{write:!0}})],nl.prototype,"font",null),h([qr("font")],nl.prototype,"writeFont",null),h([f({type:cw,json:{write:!0}})],nl.prototype,"halo",void 0),h([f({...One,json:{default:"center",write:!0}})],nl.prototype,"horizontalAlignment",void 0),h([f({...Ane,json:{default:1,write:!0}})],nl.prototype,"lineHeight",void 0),h([f({type:fc,json:{write:!0}})],nl.prototype,"material",void 0),h([f({type:iE,json:{write:!0}})],nl.prototype,"background",void 0),h([f(Cp)],nl.prototype,"size",null),h([f({type:String,json:{write:!0}})],nl.prototype,"text",void 0),h([Kt({Text:"text"},{readOnly:!0})],nl.prototype,"type",void 0),h([f({...Rne,json:{default:"baseline",write:!0}})],nl.prototype,"verticalAlignment",void 0),nl=tP=h([F("esri.symbols.TextSymbol3DLayer")],nl);const ov=nl;var m9;let Tg=m9=class extends Np{constructor(t){super(t),this.color=g9.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new m9({color:ye(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};h([f({type:ht,nonNullable:!0,json:{type:[Qs],write:(t,e,r)=>e[r]=t.toArray(ht.AlphaMode.UNLESS_OPAQUE),default:()=>g9.clone(),defaultEquals:t=>t.toCss(!0)===g9.toCss(!0)}})],Tg.prototype,"color",void 0),h([Kt({Water:"water"},{readOnly:!0})],Tg.prototype,"type",void 0),h([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Tg.prototype,"waterbodySize",void 0),h([f({type:Number,json:{write:!0,default:null}})],Tg.prototype,"waveDirection",void 0),h([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Tg.prototype,"waveStrength",void 0),Tg=m9=h([F("esri.symbols.WaterSymbol3DLayer")],Tg);const g9=new ht([0,119,190]),Lne=Tg;var y9;let a_=y9=class extends we{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new y9({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};h([f({type:String})],a_.prototype,"name",void 0),h([f({type:String})],a_.prototype,"styleUrl",void 0),h([f({type:String})],a_.prototype,"styleName",void 0),h([f({type:vc})],a_.prototype,"portal",void 0),a_=y9=h([F("esri.symbols.support.StyleOrigin")],a_);const JE=a_;var _9;let s1=_9=class extends we{constructor(){super(...arguments),this.url=""}clone(){return new _9({url:this.url})}};h([f({type:String})],s1.prototype,"url",void 0),s1=_9=h([F("esri.symbols.support.Thumbnail")],s1);const Dne={icon:a0,object:RB,line:iA,path:PB,fill:rA,extrude:fne,text:ov,water:Lne},mAe=er.ofType({base:Np,key:"type",typeMap:Dne,errorContext:"symbol-layer"});let Ud=class extends Cc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||er;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&ne.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){g1(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const s=C1(e.styleUrl,i);return new JE({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new JE({portal:i&&i.portal||vc.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new m1("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,s){if(e.styleUrl&&e.name){let n=ux(e.styleUrl,s);dc(n)&&(n=Gf(n)),r.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s&&s.portal&&!Vbe(e.portal.restUrl,s.portal.restUrl)?s&&s.messages&&s.messages.push(new m1("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Np||e&&Dne[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};h([f({json:{read:!1,write:!1}})],Ud.prototype,"color",null),h([f({type:mAe,nonNullable:!0,json:{write:!0}}),Gi(ure)],Ud.prototype,"symbolLayers",null),h([f({type:JE})],Ud.prototype,"styleOrigin",void 0),h([Ur("styleOrigin")],Ud.prototype,"readStyleOrigin",null),h([qr("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Ud.prototype,"writeStyleOrigin",null),h([f({type:s1,json:{read:!1}})],Ud.prototype,"thumbnail",void 0),h([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Ud.prototype,"type",void 0),Ud=h([F("esri.symbols.Symbol3D")],Ud);const n2=Ud;let KT=class extends Ke{constructor(e){super(e),this.visible=!0}clone(){}};h([f({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],KT.prototype,"type",void 0),h([f({readOnly:!0})],KT.prototype,"visible",void 0),KT=h([F("esri.symbols.callouts.Callout3D")],KT);const Nne=KT;var v9;let rP=v9=class extends Ke{constructor(){super(...arguments),this.color=new ht("white")}clone(){return new v9({color:ye(this.color)})}};h([f(gm)],rP.prototype,"color",void 0),rP=v9=h([F("esri.symbols.callouts.LineCallout3DBorder")],rP);const Fne=rP;Object.freeze(Object.defineProperty({__proto__:null,default:Fne},Symbol.toStringTag,{value:"Module"}));var b9;let Sg=b9=class extends Nne{constructor(t){super(t),this.type="line",this.color=new ht([0,0,0,1]),this.size=Jh(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new b9({color:ye(this.color),size:this.size,border:ye(this.border)})}};h([Kt({line:"line"},{readOnly:!0})],Sg.prototype,"type",void 0),h([f(gm)],Sg.prototype,"color",void 0),h([f(Cp)],Sg.prototype,"size",void 0),h([f({type:Fne,json:{write:!0}})],Sg.prototype,"border",void 0),h([f({readOnly:!0})],Sg.prototype,"visible",null),Sg=b9=h([F("esri.symbols.callouts.LineCallout3D")],Sg);const gAe=Sg;function MB(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function Une(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!MB(t)}function $B(t){return t.type==="point-3d"||t.type==="label-3d"}function zne(t){return t.horizontalAlignment==="center"}const kne={types:{key:"type",base:Nne,typeMap:{line:gAe}},json:{write:!0}};var w9;let $b=w9=class extends Ke{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new w9({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};h([f(Cp)],$b.prototype,"screenLength",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0,default:0}})],$b.prototype,"minWorldLength",void 0),h([f({type:Number,json:{write:!0}})],$b.prototype,"maxWorldLength",void 0),$b=w9=h([F("esri.symbols.support.Symbol3DVerticalOffset")],$b);const Bne=$b;var iP;const Vne=er.ofType({base:null,key:"type",typeMap:{text:ov}});let Eg=iP=class extends n2{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new Vne,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Une(this)}hasVisibleVerticalOffset(){return MB(this)}clone(){return new iP({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail),callout:ye(this.callout),verticalOffset:ye(this.verticalOffset)})}static fromTextSymbol(t){return new iP({symbolLayers:[ov.fromTextSymbol(t)]})}};h([f({type:Bne,json:{write:!0}})],Eg.prototype,"verticalOffset",void 0),h([f(kne)],Eg.prototype,"callout",void 0),h([f({json:{read:!1,write:!1}})],Eg.prototype,"styleOrigin",void 0),h([f({type:Vne})],Eg.prototype,"symbolLayers",void 0),h([Kt({LabelSymbol3D:"label-3d"},{readOnly:!0})],Eg.prototype,"type",void 0),Eg=iP=h([F("esri.symbols.LabelSymbol3D")],Eg);const sL=Eg;var sP;const Gne=er.ofType({base:null,key:"type",typeMap:{line:iA,path:PB}}),yAe=er.ofType({base:null,key:"type",typeMap:{line:iA,path:PB}});let eS=sP=class extends n2{constructor(t){super(t),this.symbolLayers=new Gne,this.type="line-3d"}clone(){return new sP({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleLineSymbol(t){return new sP({symbolLayers:[iA.fromSimpleLineSymbol(t)]})}};h([f({type:Gne,json:{type:yAe}})],eS.prototype,"symbolLayers",void 0),h([Kt({LineSymbol3D:"line-3d"},{readOnly:!0})],eS.prototype,"type",void 0),eS=sP=h([F("esri.symbols.LineSymbol3D")],eS);const nL=eS;let Cg=class extends Cc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Cg.prototype,"angle",void 0),h([f({type:["simple-marker","picture-marker"],readOnly:!0})],Cg.prototype,"type",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],Cg.prototype,"xoffset",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],Cg.prototype,"yoffset",void 0),h([f({type:Number,cast:t=>t==="auto"?t:bs(t),json:{write:!0}})],Cg.prototype,"size",void 0),Cg=h([F("esri.symbols.MarkerSymbol")],Cg);const jne=Cg;var nP;const Hne=er.ofType({base:null,key:"type",typeMap:{fill:rA}});let tS=nP=class extends n2{constructor(t){super(t),this.symbolLayers=new Hne,this.type="mesh-3d"}clone(){return new nP({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleFillSymbol(t){return new nP({symbolLayers:[rA.fromSimpleFillSymbol(t)]})}};h([f({type:Hne})],tS.prototype,"symbolLayers",void 0),h([Kt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],tS.prototype,"type",void 0),tS=nP=h([F("esri.symbols.MeshSymbol3D")],tS);const oL=tS;function _Ae(t,e,r){return e.imageData?wre({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):Wne(e.url,r)}function Wne(t,e){var r;return bAe(e)&&!dc(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?kI(e.layer.parsedUrl.path,"images",t):C1(t,e)}function vAe(t,e,r,i){if(Ip(t)){const s=y1(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,r&&r.imageData===e.imageData&&r.url&&A1(r.url,e,"url",i)}else A1(t,e,"url",i)}const qne={json:{read:{source:["imageData","url"],reader:_Ae},write:{writer(t,e,r,i){vAe(t,e,this.source,i)}}}},Yne={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=Wne(e.url,r)),i}}}};function bAe(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var x9;let Hc=x9=class extends gne{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),r!=null&&(s.width=bs(r)),i!=null&&(s.height=bs(i)),s}clone(){const t=new x9({color:ye(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ye(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};h([Kt({esriPFS:"picture-fill"},{readOnly:!0})],Hc.prototype,"type",void 0),h([f(qne)],Hc.prototype,"url",void 0),h([f({type:Number,json:{write:!0}})],Hc.prototype,"xscale",void 0),h([f({type:Number,json:{write:!0}})],Hc.prototype,"yscale",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],Hc.prototype,"width",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],Hc.prototype,"height",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],Hc.prototype,"xoffset",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],Hc.prototype,"yoffset",void 0),h([f(Yne)],Hc.prototype,"source",void 0),Hc=x9=h([F("esri.symbols.PictureFillSymbol")],Hc);const Xne=Hc;var T9;let nh=T9=class extends jne{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=bs(e)),r!=null&&(i.height=bs(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new T9({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ye(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};h([f({json:{write:!1}})],nh.prototype,"color",void 0),h([Kt({esriPMS:"picture-marker"},{readOnly:!0})],nh.prototype,"type",void 0),h([f(qne)],nh.prototype,"url",void 0),h([f(Yne)],nh.prototype,"source",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],nh.prototype,"height",void 0),h([Ur("height",["height","size"])],nh.prototype,"readHeight",null),h([f({type:Number,cast:bs,json:{write:!0}})],nh.prototype,"width",void 0),h([f({json:{write:!1}})],nh.prototype,"size",void 0),nh=T9=h([F("esri.symbols.PictureMarkerSymbol")],nh);const aL=nh;var l_;const Zne=er.ofType({base:null,key:"type",typeMap:{icon:a0,object:RB,text:ov}});let c_=l_=class extends n2{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new Zne,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Une(this)}hasVisibleVerticalOffset(){return MB(this)}clone(){return new l_({verticalOffset:ye(this.verticalOffset),callout:ye(this.callout),styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new l_({symbolLayers:[a0.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new l_({symbolLayers:[a0.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var i,s;if(((s=(i=t.data)==null?void 0:i.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new l_(r!=null&&r.callout?{symbolLayers:[a0.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[a0.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new l_({symbolLayers:[ov.fromTextSymbol(t)]})}};h([f({type:Bne,json:{write:!0}})],c_.prototype,"verticalOffset",void 0),h([f(kne)],c_.prototype,"callout",void 0),h([f({type:Zne,json:{origins:{"web-scene":{write:!0}}}})],c_.prototype,"symbolLayers",void 0),h([Kt({PointSymbol3D:"point-3d"},{readOnly:!0})],c_.prototype,"type",void 0),c_=l_=h([F("esri.symbols.PointSymbol3D")],c_);const l0=c_;var rS;const Jne=er.ofType({base:null,key:"type",typeMap:{extrude:fne,fill:rA,icon:a0,line:iA,object:RB,text:ov,water:Lne}});let iS=rS=class extends n2{constructor(t){super(t),this.symbolLayers=new Jne,this.type="polygon-3d"}clone(){return new rS({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromJSON(t){const e=new rS;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.getItemAt(0).type==="fill"&&e.symbolLayers.getItemAt(1).type==="line"){const r=e.symbolLayers.getItemAt(0),i=e.symbolLayers.getItemAt(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:i.material!=null?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new rS({symbolLayers:[rA.fromSimpleFillSymbol(t)]})}};h([f({type:Jne,json:{write:!0}})],iS.prototype,"symbolLayers",void 0),h([Kt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],iS.prototype,"type",void 0),iS=rS=h([F("esri.symbols.PolygonSymbol3D")],iS);const lL=iS;var S9;const yN=new Tn({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let u_=S9=class extends gne{constructor(...t){super(...t),this.color=new ht([0,0,0,.25]),this.outline=new iv,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new S9({color:ye(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};h([f()],u_.prototype,"color",void 0),h([f()],u_.prototype,"outline",void 0),h([Kt({esriSFS:"simple-fill"},{readOnly:!0})],u_.prototype,"type",void 0),h([f({type:yN.apiValues,json:{read:yN.read,write:yN.write}})],u_.prototype,"style",void 0),u_=S9=h([F("esri.symbols.SimpleFillSymbol")],u_);const IB=u_;var E9;const _N=new Tn({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let zd=E9=class extends jne{constructor(...t){super(...t),this.color=new ht([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new iv}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=bs(e)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new E9({angle:this.angle,color:ye(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};h([f()],zd.prototype,"color",void 0),h([qr("color")],zd.prototype,"writeColor",null),h([Kt({esriSMS:"simple-marker"},{readOnly:!0})],zd.prototype,"type",void 0),h([f()],zd.prototype,"size",void 0),h([f({type:_N.apiValues,json:{read:_N.read,write:_N.write}})],zd.prototype,"style",void 0),h([f({type:String,json:{write:!0}})],zd.prototype,"path",null),h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":iv}},json:{default:null,write:!0}})],zd.prototype,"outline",void 0),zd=E9=h([F("esri.symbols.SimpleMarkerSymbol")],zd);const cL=zd;var C9;let ns=C9=class extends Cc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new iL,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return bs(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new C9({angle:this.angle,backgroundColor:ye(this.backgroundColor),borderLineColor:ye(this.borderLineColor),borderLineSize:this.borderLineSize,color:ye(this.color),font:this.font&&this.font.clone(),haloColor:ye(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};h([f({type:ht,json:{write:!0}})],ns.prototype,"backgroundColor",void 0),h([f({type:ht,json:{write:!0}})],ns.prototype,"borderLineColor",void 0),h([f({type:Number,json:{write:!0},cast:bs})],ns.prototype,"borderLineSize",void 0),h([f({type:iL,json:{write:!0}})],ns.prototype,"font",void 0),h([f({...One,json:{write:!0}})],ns.prototype,"horizontalAlignment",void 0),h([f({type:Boolean,json:{write:!0}})],ns.prototype,"kerning",void 0),h([f({type:ht,json:{write:!0}})],ns.prototype,"haloColor",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],ns.prototype,"haloSize",void 0),h([f({type:Boolean,json:{write:!0}})],ns.prototype,"rightToLeft",void 0),h([f({type:Boolean,json:{write:!0}})],ns.prototype,"rotated",void 0),h([f({type:String,json:{write:!0}})],ns.prototype,"text",void 0),h([Kt({esriTS:"text"},{readOnly:!0})],ns.prototype,"type",void 0),h([f({...Rne,json:{write:!0}})],ns.prototype,"verticalAlignment",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],ns.prototype,"xoffset",void 0),h([f({type:Number,cast:bs,json:{write:!0}})],ns.prototype,"yoffset",void 0),h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],ns.prototype,"angle",void 0),h([f({type:Number,json:{write:!0}})],ns.prototype,"width",void 0),h([f({type:Number})],ns.prototype,"lineWidth",void 0),h([qr("lineWidth")],ns.prototype,"writeLineWidth",null),h([Gi("lineWidth")],ns.prototype,"castLineWidth",null),h([f(Ane)],ns.prototype,"lineHeight",void 0),h([qr("lineHeight")],ns.prototype,"writeLineHeight",null),ns=C9=h([F("esri.symbols.TextSymbol")],ns);const sA=ns;var A9;let oh=A9=class extends Cc{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:vc.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new A9({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await he(()=>Promise.resolve().then(()=>OHe),void 0);qt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{ne.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r!=null&&r.set(i,o.clone()),o):null}};h([f({json:{write:!1}})],oh.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],oh.prototype,"styleName",void 0),h([f({type:vc,json:{write:!1}})],oh.prototype,"portal",void 0),h([f({type:String,json:{read:OB,write:A1}})],oh.prototype,"styleUrl",void 0),h([f({type:s1,json:{read:!1}})],oh.prototype,"thumbnail",void 0),h([f({type:String,json:{write:!0}})],oh.prototype,"name",void 0),h([Kt({styleSymbolReference:"web-style"},{readOnly:!0})],oh.prototype,"type",void 0),h([f()],oh.prototype,"_fetchCacheKey",null),oh=A9=h([F("esri.symbols.WebStyleSymbol")],oh);const o2=oh;function uL(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function O1(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const LB={base:Cc,key:"type",typeMap:{"simple-fill":IB,"picture-fill":Xne,"picture-marker":aL,"simple-line":iv,"simple-marker":cL,text:sA,"label-3d":sL,"line-3d":nL,"mesh-3d":oL,"point-3d":l0,"polygon-3d":lL,"web-style":o2,cim:s2},errorContext:"symbol"},Bct={base:Cc,key:"type",typeMap:{"picture-marker":aL,"simple-marker":cL,text:sA,"web-style":o2,cim:s2},errorContext:"symbol"},wAe=Zte({types:LB}),Vct={base:Cc,key:"type",typeMap:{"simple-fill":IB,"picture-fill":Xne,"picture-marker":aL,"simple-line":iv,"simple-marker":cL,text:sA,"line-3d":nL,"mesh-3d":oL,"point-3d":l0,"polygon-3d":lL,"web-style":o2,cim:s2},errorContext:"symbol"},Gct={base:Cc,key:"type",typeMap:{text:sA,"label-3d":sL},errorContext:"symbol"},jct={base:Cc,key:"type",typeMap:{"line-3d":nL,"mesh-3d":oL,"point-3d":l0,"polygon-3d":lL,"web-style":o2,cim:s2},errorContext:"symbol"},Hct={base:Cc,key:"type",typeMap:{"label-3d":sL},errorContext:"symbol"},Wct=R0(LB);function xAe(t){if(!t)return null;const e={};for(const r in t){const i=Ou(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function TAe(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let ol=class extends mm(Ke){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Rl(),configurable:!0})}normalizeCtorArgs(e,r,i,s){return e&&!e.declaredClass?e:{geometry:e,symbol:r,attributes:i,popupTemplate:s}}set aggregateGeometries(e){const r=this._get("aggregateGeometries");JSON.stringify(r)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const r=this._get("attributes");r!==e&&(this._set("attributes",e),this._notifyLayer("attributes",r,e))}set geometry(e){const r=this._get("geometry");r!==e&&(this._set("geometry",e),this._notifyLayer("geometry",r,e))}set symbol(e){const r=this._get("symbol");r!==e&&(this._set("symbol",e),this._notifyLayer("symbol",r,e))}set visible(e){const r=this._get("visible");r!==e&&(this._set("visible",e),this._notifyLayer("visible",r,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const r of[this.sourceLayer,this.layer])if(r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(e&&"defaultPopupTemplate"in r&&r.defaultPopupTemplate!=null)return r.defaultPopupTemplate}return null}getAttribute(e){var r;return(r=this.attributes)==null?void 0:r[e]}setAttribute(e,r){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=r,this._notifyLayer("attributes",i,r,e)}else this.attributes={[e]:r},this._notifyLayer("attributes",void 0,r,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:TAe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){this.geometry!=null&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,r,i,s){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:r,newValue:i};e==="attributes"&&(n.attributeName=s),this.layer.graphicChanged(n)}};h([f({value:null,json:{read:xAe}})],ol.prototype,"aggregateGeometries",null),h([f({value:null})],ol.prototype,"attributes",null),h([f({value:null,types:iB,json:{read:Ou}})],ol.prototype,"geometry",null),h([f({type:Boolean})],ol.prototype,"isAggregate",void 0),h([f({clonable:"reference"})],ol.prototype,"layer",void 0),h([f({type:ACe})],ol.prototype,"popupTemplate",void 0),h([f({clonable:"reference"})],ol.prototype,"sourceLayer",void 0),h([f({value:null,types:LB})],ol.prototype,"symbol",null),h([f({type:Boolean,value:!0})],ol.prototype,"visible",null),ol=h([F("esri.Graphic")],ol),function(t){t.generateUID=Rl}(ol||(ol={}));const om=ol;var O9;let Ag=O9=class extends Ke{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new O9({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function vN(){return{enabled:!this.camera}}h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:vN}}}}})],Ag.prototype,"rotation",void 0),h([Gi("rotation")],Ag.prototype,"castRotation",null),h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:vN}}}}})],Ag.prototype,"scale",void 0),h([f({types:iB,json:{read:Ou,write:!0,origins:{"web-scene":{read:Ou,write:{overridePolicy:vN}}}}})],Ag.prototype,"targetGeometry",void 0),h([f({type:Ru,json:{write:!0}})],Ag.prototype,"camera",void 0),Ag=O9=h([F("esri.Viewpoint")],Ag);const Qh=Ag;function hL(t){return typeof t=="string"?document.getElementById(t):t??null}function Qne(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function eW(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function tW(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}function ce(t,e,r={}){return DB(t,e,r,Kne)}function Mu(t,e,r={}){return DB(t,e,r,eoe)}function DB(t,e,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(bi(s),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(s=Tve(t,n,r.sync,r.equals),r.initial){const o=t();n(o,o)}return s}function Ga(t,e,r,i={}){let s=null,n=null,o=null;function a(){var u;s&&n&&(n.remove(),(u=i.onListenerRemove)==null||u.call(i,s),s=null,n=null)}function l(u){i.once&&i.once&&bi(o),r(u)}const c=ce(t,(u,d)=>{var p;a(),LI(u)&&(s=u,n=HC(u,e,l),(p=i.onListenerAdd)==null||p.call(i,u))},{sync:i.sync,initial:!0});return o=ha(()=>{c.remove(),a()}),o}function QE(t,e){return SAe(t,eoe,e)}function SAe(t,e,r){if(Js(r))return Promise.reject(wr());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let s=null;function n(){s=bi(s)}return new Promise((o,a)=>{s=Zw([Uo(r,()=>{n(),a(wr())}),DB(t,l=>{n(),o(l)},{sync:!1,once:!0},e??Kne)])})}function Kne(t){return!0}function eoe(t){return!!t}const Nr={sync:!0},Tr={initial:!0},Ss={sync:!0,initial:!0};let R9=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let e;for(e of this._items);return e}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach(r=>{e(r)||this._items.delete(r)}),this}};const EAe={statsWorker:()=>he(()=>import("./statsWorker-9763410a.js"),["assets/statsWorker-9763410a.js","assets/heatmapUtils-b7e5e306.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js"]),geometryEngineWorker:()=>he(()=>import("./geometryEngineWorker-a3874017.js"),["assets/geometryEngineWorker-a3874017.js","assets/geometryEngineJSON-6cc20e67.js","assets/geometryEngineBase-4f4260d8.js","assets/json-48e3ea08.js"]),CSVSourceWorker:()=>he(()=>import("./CSVSourceWorker-8a88bf14.js"),["assets/CSVSourceWorker-8a88bf14.js","assets/json-48e3ea08.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FieldsIndex-f92177f9.js","assets/number-554c04c9.js","assets/clientSideDefaults-3f6f7f8c.js","assets/defaultsJSON-59981e75.js"]),EdgeProcessingWorker:()=>he(()=>import("./EdgeProcessingWorker-6f31ec75.js"),[]),ElevationSamplerWorker:()=>he(()=>import("./ElevationSamplerWorker-0cb916a8.js"),["assets/ElevationSamplerWorker-0cb916a8.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/georeference-fc071834.js"]),FeatureServiceSnappingSourceWorker:()=>he(()=>import("./FeatureServiceSnappingSourceWorker-fd3c51cf.js"),["assets/FeatureServiceSnappingSourceWorker-fd3c51cf.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FieldsIndex-f92177f9.js","assets/Query-02316d46.js","assets/ElevationInfo-568c6f07.js","assets/symbologySnappingCandidates-5d86c7dd.js","assets/LRUCache-2af9f319.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/query-2ef7b393.js","assets/queryZScale-a900b0db.js"]),GeoJSONSourceWorker:()=>he(()=>import("./GeoJSONSourceWorker-91d1ea96.js"),["assets/GeoJSONSourceWorker-91d1ea96.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FieldsIndex-f92177f9.js","assets/geojson-de98b15e.js","assets/clientSideDefaults-3f6f7f8c.js","assets/defaultsJSON-59981e75.js","assets/sourceUtils-d8b6406b.js"]),LercWorker:()=>he(()=>import("./LercWorker-f6acc8e5.js"),[]),MemorySourceWorker:()=>he(()=>import("./MemorySourceWorker-fc146acc.js"),["assets/MemorySourceWorker-fc146acc.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FieldsIndex-f92177f9.js","assets/clientSideDefaults-3f6f7f8c.js","assets/defaultsJSON-59981e75.js","assets/sourceUtils-d8b6406b.js"]),PBFDecoderWorker:()=>he(()=>import("./PBFDecoderWorker-1f59b81b.js"),["assets/PBFDecoderWorker-1f59b81b.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js"]),Pipeline:()=>he(()=>import("./Pipeline-702794e0.js").then(t=>t.P),["assets/Pipeline-702794e0.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FieldsIndex-f92177f9.js","assets/StreamFeatureManager-019f710c.js","assets/quickselect-6ad44cba.js","assets/diffUtils-149561ab.js","assets/arcadeTimeUtils-ff24d7d1.js","assets/centroid-8e8cfa47.js","assets/ogcFeatureUtils-ca1443a6.js","assets/geojson-de98b15e.js","assets/clientSideDefaults-3f6f7f8c.js","assets/defaultsJSON-59981e75.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/Query-02316d46.js","assets/createConnection-00c95ac2.js","assets/enums-9bbe4bf0.js","assets/TileInfoView-53e9727d.js","assets/number-954e4ab6.js"]),PointCloudWorker:()=>he(()=>import("./PointCloudWorker-bd8a6a24.js"),["assets/PointCloudWorker-bd8a6a24.js","assets/PointCloudWorkerUtil-af44c128.js","assets/PointCloudUniqueValueRenderer-cf07861e.js","assets/ColorStop-c9dfec3d.js","assets/I3SBinaryReader-e6f3c30e.js"]),RasterWorker:()=>he(()=>import("./RasterWorker-a7851997.js"),["assets/RasterWorker-a7851997.js","assets/dataUtils-8e6a5d39.js","assets/colorUtils-c0f43caf.js","assets/utils-2c723779.js","assets/colorRamps-5cc134e8.js","assets/rasterProjectionHelper-aacc5bb4.js"]),SceneLayerSnappingSourceWorker:()=>he(()=>import("./SceneLayerSnappingSourceWorker-cffdfe83.js"),[]),SceneLayerWorker:()=>he(()=>import("./SceneLayerWorker-bcf78eda.js").then(t=>t.S),["assets/SceneLayerWorker-bcf78eda.js","assets/I3SNode-8036f288.js"]),WFSSourceWorker:()=>he(()=>import("./WFSSourceWorker-8f887026.js"),["assets/WFSSourceWorker-8f887026.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FieldsIndex-f92177f9.js","assets/geojson-de98b15e.js","assets/sourceUtils-d8b6406b.js","assets/wfsUtils-cb75b743.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>he(()=>import("./WorkerTileHandler-aa6416de.js"),["assets/WorkerTileHandler-aa6416de.js","assets/TileClipper-ae6eca9e.js","assets/StyleRepository-1e02df5b.js","assets/enums-9bbe4bf0.js","assets/colorUtils-c0f43caf.js","assets/Rect-98da58d6.js","assets/pbf-94fe703e.js","assets/TurboLine-4d72b187.js","assets/BidiEngine-9a40f2f4.js"])};var oo;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(oo||(oo={}));let CAe=0;function toe(){return CAe++}function AAe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function KE(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function NB(t,e,r,i){if(e.type===oo.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==oo.INVOKE&&e.type!==oo.RESPONSE)return void t.postMessage(e);let s;if(AAe(r)?(s=rW(r.transferList),e.data=r.result):(s=rW(i),e.data=r),s){if(ie("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case oo.INVOKE:throw o;case oo.RESPONSE:return void NB(t,{type:oo.RESPONSE,jobId:e.jobId,error:KE(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function eC(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function rW(t){if(!t||!t.length)return null;if(ie("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!OAe(r));return e.length?e:null}function OAe(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}const{CLOSE:iW,ABORT:sW,INVOKE:nW,RESPONSE:N2,OPEN_PORT:oW,ON:RAe}=oo,PAe=2;let MAe=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===oo.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},D0=class Ib{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new Ib(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),Ib.clients.set(s,i),r.port2}static loadWorker(e){const r=EAe[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new MAe(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:iW}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const s=i==null?void 0:i.signal,n=i==null?void 0:i.transferList;if(!this._port)return Promise.reject(new X("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=toe();return new Promise((a,l)=>{if(Js(s))return this._processWork(),void l(wr());const c=Uo(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),bi(d.abortHandle),this._post({type:sW,jobId:o}),l(wr()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:nW,jobId:o,methodName:e,abortable:s!=null},r,n)})}on(e,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:oo.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:oo.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:oW,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=PAe)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:s,resolver:n}=e;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{bi(e.abortHandle),e.reject(wr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=eC(e);if(r)switch(r.type){case N2:this._onResponseMessage(r);break;case nW:this._invokeQueue.push(r);break;case sW:this._onAbortMessage(r);break;case iW:this._onCloseMessage();break;case oW:this._onOpenPortMessage(r);break;case RAe:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&Ib.clients.get(this)===e&&e.destroy(),Ib.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const d=r.split(".");for(let p=0;p<d.length-1;p++)c=c[d[p]],u=c[d[p+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);l=u.call(c,s,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:N2,jobId:i,error:KE(d)})}Sc(l)?(a.set(i,{controller:o,promise:l}),l.then(d=>{a.has(i)&&(a.delete(i),this._post({type:N2,jobId:i},d))},d=>{a.has(i)&&(a.delete(i),gs(d)||this._post({type:N2,jobId:i,error:KE(d||{message:`Error encountered at method ${r}`})}))})):this._post({type:N2,jobId:i},l)}_onOpenPortMessage(e){new Ib(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,n=>{r.postMessage(n)}),s=HC(e.port,"message",n=>{const o=eC(n);(o==null?void 0:o.type)===oo.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),bi(o.abortHandle),i?o.reject(X.fromJSON(JSON.parse(i))):o.resolve(s)}_post(e,r,i){return NB(this._port,e,r,i)}};D0.kernelInfo={buildDate:$I,fullVersion:YC,revision:vte},D0.clients=new Map;let $Ae=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new R9}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,s)=>{let n=!0;const o=a=>{qt(r.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Sc(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new D0(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new D0(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(wr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(e,r,i){let s;Array.isArray(i)?(ne.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=vo();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:s,resolver:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>Zw(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const roe=ne.getLogger("esri.intl.substitute");function Jct(t,e,r={}){const{format:i={}}=r;return II(t,s=>IAe(s,e,i))}function IAe(t,e,r){let i,s;const n=t.indexOf(":");if(n===-1?i=t.trim():(i=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!i)return"";const o=jC(i,e);if(o==null)return"";const a=(s?r==null?void 0:r[s]:null)??(r==null?void 0:r[i]);return a?LAe(o,a):s?DAe(o,s):FB(o)}function LAe(t,e){switch(e.type){case"date":return L0(t,e.intlOptions);case"number":return lx(t,e.intlOptions);default:return roe.warn("missing format descriptor for key {key}"),FB(t)}}function DAe(t,e){switch(e.toLowerCase()){case"dateformat":return L0(t);case"numberformat":return lx(t);default:return roe.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?L0(t):/^numberformat/i.test(e)?lx(t):FB(t)}}function FB(t){switch(typeof t){case"string":return t;case"number":return lx(t);case"boolean":return""+t;default:return t instanceof Date?L0(t):""}}async function NAe(t,e,r,i){const s=e.exec(r);if(!s)throw new X("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=Rxe(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let u;try{u=await aW(t(c))}catch(d){if(c===l)throw new X("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:d});try{u=await aW(t(l))}catch(p){throw new X("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p})}}return u}async function aW(t){if(lW.fetchBundleAsset!=null)return lW.fetchBundleAsset(t);const e=await Es(t,{responseType:"text"});return JSON.parse(e.data)}let FAe=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return NAe(this.getAssetUrl,this.matcher,e,r)}};function UAe(t){return new FAe(t)}const lW={};Oxe(UAe({pattern:"esri/",location:Rr}));const zAe={};function kAe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=zAe.baseUrl),e}let BAe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},oP=class{constructor(){this._dispatcher=new BAe,this._workerPostMessage({type:oo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){Jw(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){Jw(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=eC(e);if(r&&r.type===oo.OPEN){const{modulePath:i,jobId:s}=r;let n=await D0.loadWorker(i);n||(n=await he(()=>import(i),[]));const o=D0.connect(n);this._workerPostMessage({type:oo.OPENED,jobId:s,data:o})}}};const P9=ne.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:VAe}=oo,GAe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let o3,a3;const cW="Failed to create Worker. Fallback to execute module in main thread";async function jAe(){if(!ie("esri-workers")||(ie("mozilla"),0))return uW(new oP);if(!o3&&!a3)try{const e=GAe.split('"{CONFIGURATION}"').join(`'${HAe()}'`);o3=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){a3=e||{}}let t;if(o3)try{t=new Worker(o3,{name:"esri-worker-"+WAe++})}catch{P9.warn(cW,a3),t=new oP}else P9.warn(cW,a3),t=new oP;return uW(t)}async function uW(t){return new Promise(e=>{function r(s){const n=eC(s);n&&n.type===VAe&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(s){s.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),P9.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new oP).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function HAe(){let t;if(Er.default!=null){const s={...Er};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Er));t.assetsPath=ac(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?ac(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Gh(),t.has={"esri-csp-restrictions":ie("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ie("esri-2d-update-debug"),"esri-2d-log-updating":ie("esri-2d-log-updating"),"featurelayer-pbf":ie("featurelayer-pbf"),"featurelayer-simplify-thresholds":ie("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ie("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ie("featurelayer-simplify-mobile-factor"),"esri-atomics":ie("esri-atomics"),"esri-shared-array-buffer":ie("esri-shared-array-buffer"),"esri-tiles-debug":ie("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ie("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ie("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":ie("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=ac(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=ac(t.workers.workerPath):t.workers.workerPath=ac(Rr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Er.workers.loaderConfig,r=kAe({baseUrl:e==null?void 0:e.baseUrl,locale:Gh(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:$I,fullVersion:YC,revision:vte}})}let WAe=0;const{ABORT:hW,INVOKE:qAe,OPEN:YAe,OPENED:XAe,RESPONSE:F2}=oo;let ZAe=class ioe{static async create(e){const r=await jAe();return new ioe(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),ne.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,s=toe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:rk(i,()=>{this._outJobs.delete(s),this._post({type:hW,jobId:s})})};this._outJobs.set(s,a),this._post({type:YAe,jobId:s,modulePath:e})})}_onMessage(e){const r=eC(e);if(r)switch(r.type){case XAe:this._onOpenedMessage(r);break;case F2:this._onResponseMessage(r);break;case hW:this._onAbortMessage(r);break;case qAe:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=Owe[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(u){return void this._post({type:F2,jobId:i,error:KE(u)})}Sc(c)?(a.set(i,{controller:o,promise:c}),c.then(u=>{a.has(i)&&(a.delete(i),this._post({type:F2,jobId:i},u))},u=>{a.has(i)&&(a.delete(i),u||(u={message:"Error encountered at method"+r}),gs(u)||this._post({type:F2,jobId:i,error:KE(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:F2,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),bi(s.abortHandle),s.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),bi(n.abortHandle),i?n.reject(X.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,r,i){return NB(this.worker,e,r,i)}};const dW=Math.min(navigator.hardwareConcurrency-1,ie("workers-pool-size"));let q_=ie("esri-mobile")?Math.min(dW,3):ie("host-browser")?dW:0;q_||(q_=ie("safari")&&ie("mac")?7:2);let pW=0;const aP=[];function JAe(){soe()}async function l3(t,e){const r=new $Ae;return await r.open(t,e),r}async function QAe(t,e={}){if(typeof t!="string")throw new X("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(ie("host-webworker")&&!ie("esri-workers")&&(r="local"),r==="local"){let i=await D0.loadWorker(t);i||(i=await he(()=>import(t),[])),qt(e.signal);const s=e.client||i;return l3([D0.connect(i)],{...e,client:s})}if(await soe(),qt(e.signal),r==="dedicated"){const i=pW++%q_;return l3([await aP[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,q_);if(i<q_){const s=new Array(i);for(let n=0;n<i;++n){const o=pW++%q_;s[n]=aP[o].open(t,e)}return l3(s,e)}}return l3(aP.map(i=>i.open(t,e)),e)}let c3=null;async function soe(){if(c3)return c3;new AbortController;const t=[];for(let e=0;e<q_;e++){const r=ZAe.create(e).then(i=>(aP[e]=i,i));t.push(r)}return c3=Promise.all(t),c3}let mp=class extends we{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Oi,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,ce)}addWhen(e,r,i={}){return this._installWatch(e,r,i,Mu)}addOnCollectionChange(e,r,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this._handles.add([Ga(e,"after-changes",this._createSyncUpdatingCallback(),Nr),Ga(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>r({added:[],removed:o.toArray()}):void 0})],n),ha(()=>this._handles.remove(n))}addPromise(e){if(e==null)return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(u3)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,r,i);return this._handles.add(o,n),ha(()=>this._handles.remove(n))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),s=ce(e,i,{sync:!0,equals:()=>!1});return this._handles.add(s,r),s}_createSyncUpdatingCallback(){return()=>{this._handles.remove(u3),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(WC(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(u3))}),u3)}}};h([f({readOnly:!0})],mp.prototype,"updating",void 0),mp=h([F("esri.core.support.WatchUpdatingTracking")],mp);const u3=-42,UB=t=>{let e=class extends t{constructor(){super(...arguments),this._handles=new Oi,this._updatingHandles=new mp}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return h([f({readOnly:!0})],e.prototype,"handles",null),h([f({readOnly:!0})],e.prototype,"updatingHandles",null),e=h([F("esri.core.HandleOwner")],e),e};let tC=class extends UB(we){};tC=h([F("esri.core.HandleOwner")],tC);let sE=class extends UB(er){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(er.ofType(this.itemType.Type))(e):new er(e)}};function M9(t,e){return{type:t,cast:ure,set(r){const i=g1(r,this._get(e),t);i.owner=this,this._set(e,i)}}}h([f()],sE.prototype,"owner",null),sE=h([F("esri.core.support.OwningCollection")],sE);var sS;const WM=Ec()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),noe=WM.jsonValues.slice();FE(noe,"orthometric");const nE=Ec()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let ah=sS=class extends Ke{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return WM.write(t,e,r)}readHeightModel(t,e,r){return WM.read(t)||(r&&r.messages&&r.messages.push(KAe(t,{context:r})),null)}readHeightUnit(t,e,r){return nE.read(t)||(r&&r.messages&&r.messages.push(fW(t,{context:r})),null)}readHeightUnitService(t,e,r){return Lre(t)||nE.read(t)||(r&&r.messages&&r.messages.push(fW(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new sS({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=bwe(e);return new sS({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new sS;return e.read(t,{origin:"web-scene"}),e}};function fW(t,e){return new m1("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function KAe(t,e){return new m1("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}h([f({type:WM.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:noe,default:"ellipsoidal"}}}})],ah.prototype,"heightModel",void 0),h([qr("web-scene","heightModel")],ah.prototype,"writeHeightModel",null),h([Ur(["web-scene","service"],"heightModel")],ah.prototype,"readHeightModel",null),h([f({type:nE.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:nE.jsonValues,write:nE.write}}}})],ah.prototype,"heightUnit",void 0),h([Ur("web-scene","heightUnit")],ah.prototype,"readHeightUnit",null),h([Ur("service","heightUnit")],ah.prototype,"readHeightUnitService",null),h([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],ah.prototype,"vertCRS",void 0),h([Ur("service","vertCRS",["vertCRS","ellipsoid","geoid"])],ah.prototype,"readVertCRS",null),ah=sS=h([F("esri.geometry.HeightModelInfo")],ah);const nA=ah;function en(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Fp(t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=d,t[11]=p,t[12]=g,t[13]=y,t[14]=_,t[15]=v,t}function $u(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $l(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function a2(t,e){return Wn(t,e)||$u(t),t}function Wn(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],g=e[11],y=e[12],_=e[13],v=e[14],w=e[15],T=r*a-i*o,x=r*l-s*o,E=r*c-n*o,O=i*l-s*a,A=i*c-n*a,$=s*c-n*l,M=u*_-d*y,U=u*v-p*y,k=u*w-g*y,B=d*v-p*_,z=d*w-g*_,Y=p*w-g*v;let W=T*Y-x*z+E*B+O*k-A*U+$*M;return W?(W=1/W,t[0]=(a*Y-l*z+c*B)*W,t[1]=(s*z-i*Y-n*B)*W,t[2]=(_*$-v*A+w*O)*W,t[3]=(p*A-d*$-g*O)*W,t[4]=(l*k-o*Y-c*U)*W,t[5]=(r*Y-s*k+n*U)*W,t[6]=(v*E-y*$-w*x)*W,t[7]=(u*$-p*E+g*x)*W,t[8]=(o*z-a*k+c*M)*W,t[9]=(i*k-r*z-n*M)*W,t[10]=(y*A-_*E+w*T)*W,t[11]=(d*E-u*A-g*T)*W,t[12]=(a*U-o*B-l*M)*W,t[13]=(r*B-i*U+s*M)*W,t[14]=(_*x-y*O-v*T)*W,t[15]=(u*O-d*x+p*T)*W,t):null}function e3e(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],g=e[11],y=e[12],_=e[13],v=e[14],w=e[15];return t[0]=a*(p*w-g*v)-d*(l*w-c*v)+_*(l*g-c*p),t[1]=-(i*(p*w-g*v)-d*(s*w-n*v)+_*(s*g-n*p)),t[2]=i*(l*w-c*v)-a*(s*w-n*v)+_*(s*c-n*l),t[3]=-(i*(l*g-c*p)-a*(s*g-n*p)+d*(s*c-n*l)),t[4]=-(o*(p*w-g*v)-u*(l*w-c*v)+y*(l*g-c*p)),t[5]=r*(p*w-g*v)-u*(s*w-n*v)+y*(s*g-n*p),t[6]=-(r*(l*w-c*v)-o*(s*w-n*v)+y*(s*c-n*l)),t[7]=r*(l*g-c*p)-o*(s*g-n*p)+u*(s*c-n*l),t[8]=o*(d*w-g*_)-u*(a*w-c*_)+y*(a*g-c*d),t[9]=-(r*(d*w-g*_)-u*(i*w-n*_)+y*(i*g-n*d)),t[10]=r*(a*w-c*_)-o*(i*w-n*_)+y*(i*c-n*a),t[11]=-(r*(a*g-c*d)-o*(i*g-n*d)+u*(i*c-n*a)),t[12]=-(o*(d*v-p*_)-u*(a*v-l*_)+y*(a*p-l*d)),t[13]=r*(d*v-p*_)-u*(i*v-s*_)+y*(i*p-s*d),t[14]=-(r*(a*v-l*_)-o*(i*v-s*_)+y*(i*l-s*a)),t[15]=r*(a*p-l*d)-o*(i*p-s*d)+u*(i*l-s*a),t}function t3e(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11],g=t[12],y=t[13],_=t[14],v=t[15];return(e*o-r*n)*(d*v-p*_)-(e*a-i*n)*(u*v-p*y)+(e*l-s*n)*(u*_-d*y)+(r*a-i*o)*(c*v-p*g)-(r*l-s*o)*(c*_-d*g)+(i*l-s*a)*(c*y-u*g)}function qi(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=e[9],g=e[10],y=e[11],_=e[12],v=e[13],w=e[14],T=e[15];let x=r[0],E=r[1],O=r[2],A=r[3];return t[0]=x*i+E*a+O*d+A*_,t[1]=x*s+E*l+O*p+A*v,t[2]=x*n+E*c+O*g+A*w,t[3]=x*o+E*u+O*y+A*T,x=r[4],E=r[5],O=r[6],A=r[7],t[4]=x*i+E*a+O*d+A*_,t[5]=x*s+E*l+O*p+A*v,t[6]=x*n+E*c+O*g+A*w,t[7]=x*o+E*u+O*y+A*T,x=r[8],E=r[9],O=r[10],A=r[11],t[8]=x*i+E*a+O*d+A*_,t[9]=x*s+E*l+O*p+A*v,t[10]=x*n+E*c+O*g+A*w,t[11]=x*o+E*u+O*y+A*T,x=r[12],E=r[13],O=r[14],A=r[15],t[12]=x*i+E*a+O*d+A*_,t[13]=x*s+E*l+O*p+A*v,t[14]=x*n+E*c+O*g+A*w,t[15]=x*o+E*u+O*y+A*T,t}function Wa(t,e,r){const i=r[0],s=r[1],n=r[2];if(e===t)t[12]=e[0]*i+e[4]*s+e[8]*n+e[12],t[13]=e[1]*i+e[5]*s+e[9]*n+e[13],t[14]=e[2]*i+e[6]*s+e[10]*n+e[14],t[15]=e[3]*i+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],d=e[5],p=e[6],g=e[7],y=e[8],_=e[9],v=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=d,t[6]=p,t[7]=g,t[8]=y,t[9]=_,t[10]=v,t[11]=w,t[12]=o*i+u*s+y*n+e[12],t[13]=a*i+d*s+_*n+e[13],t[14]=l*i+p*s+v*n+e[14],t[15]=c*i+g*s+w*n+e[15]}return t}function dL(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Cl(t,e,r,i){let s,n,o,a,l,c,u,d,p,g,y,_,v,w,T,x,E,O,A,$,M,U,k,B,z=i[0],Y=i[1],W=i[2],j=Math.sqrt(z*z+Y*Y+W*W);return j<ma()?null:(j=1/j,z*=j,Y*=j,W*=j,s=Math.sin(r),n=Math.cos(r),o=1-n,a=e[0],l=e[1],c=e[2],u=e[3],d=e[4],p=e[5],g=e[6],y=e[7],_=e[8],v=e[9],w=e[10],T=e[11],x=z*z*o+n,E=Y*z*o+W*s,O=W*z*o-Y*s,A=z*Y*o-W*s,$=Y*Y*o+n,M=W*Y*o+z*s,U=z*W*o+Y*s,k=Y*W*o-z*s,B=W*W*o+n,t[0]=a*x+d*E+_*O,t[1]=l*x+p*E+v*O,t[2]=c*x+g*E+w*O,t[3]=u*x+y*E+T*O,t[4]=a*A+d*$+_*M,t[5]=l*A+p*$+v*M,t[6]=c*A+g*$+w*M,t[7]=u*A+y*$+T*M,t[8]=a*U+d*k+_*B,t[9]=l*U+p*k+v*B,t[10]=c*U+g*k+w*B,t[11]=u*U+y*k+T*B,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function hx(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*i,t[5]=o*s+u*i,t[6]=a*s+d*i,t[7]=l*s+p*i,t[8]=c*s-n*i,t[9]=u*s-o*i,t[10]=d*s-a*i,t[11]=p*s-l*i,t}function pL(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*i,t[1]=o*s-u*i,t[2]=a*s-d*i,t[3]=l*s-p*i,t[8]=n*i+c*s,t[9]=o*i+u*s,t[10]=a*i+d*s,t[11]=l*i+p*s,t}function dx(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],d=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*i,t[1]=o*s+u*i,t[2]=a*s+d*i,t[3]=l*s+p*i,t[4]=c*s-n*i,t[5]=u*s-o*i,t[6]=d*s-a*i,t[7]=p*s-l*i,t}function fL(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function r3e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bc(t,e,r){if(e===0)return $u(t);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<ma()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*i,t[2]=l*o*n-a*i,t[3]=0,t[4]=o*a*n-l*i,t[5]=a*a*n+s,t[6]=l*a*n+o*i,t[7]=0,t[8]=o*l*n+a*i,t[9]=a*l*n-o*i,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function ooe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i3e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function aoe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function loe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=i+i,l=s+s,c=n+n,u=i*a,d=i*l,p=i*c,g=s*l,y=s*c,_=n*c,v=o*a,w=o*l,T=o*c;return t[0]=1-(g+_),t[1]=d+T,t[2]=p-w,t[3]=0,t[4]=d-T,t[5]=1-(u+_),t[6]=y+v,t[7]=0,t[8]=p+w,t[9]=y-v,t[10]=1-(u+g),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function s3e(t,e){const r=n3e,i=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=i*i+s*s+n*n+o*o;return d>0?(r[0]=2*(a*o+u*i+l*n-c*s)/d,r[1]=2*(l*o+u*s+c*i-a*n)/d,r[2]=2*(c*o+u*n+a*s-l*i)/d):(r[0]=2*(a*o+u*i+l*n-c*s),r[1]=2*(l*o+u*s+c*i-a*n),r[2]=2*(c*o+u*n+a*s-l*i)),loe(t,e,r),t}const n3e=C();function o3e(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function coe(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function a3e(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function l3e(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,u=o+o,d=s*l,p=s*c,g=s*u,y=n*c,_=n*u,v=o*u,w=a*l,T=a*c,x=a*u,E=i[0],O=i[1],A=i[2];return t[0]=(1-(y+v))*E,t[1]=(p+x)*E,t[2]=(g-T)*E,t[3]=0,t[4]=(p-x)*O,t[5]=(1-(d+v))*O,t[6]=(_+w)*O,t[7]=0,t[8]=(g+T)*A,t[9]=(_-w)*A,t[10]=(1-(d+y))*A,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function c3e(t,e,r,i,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,u=o+o,d=a+a,p=n*c,g=n*u,y=n*d,_=o*u,v=o*d,w=a*d,T=l*c,x=l*u,E=l*d,O=i[0],A=i[1],$=i[2],M=s[0],U=s[1],k=s[2],B=(1-(_+w))*O,z=(g+E)*O,Y=(y-x)*O,W=(g-E)*A,j=(1-(p+w))*A,Z=(v+T)*A,R=(y+x)*$,I=(v-T)*$,N=(1-(p+_))*$;return t[0]=B,t[1]=z,t[2]=Y,t[3]=0,t[4]=W,t[5]=j,t[6]=Z,t[7]=0,t[8]=R,t[9]=I,t[10]=N,t[11]=0,t[12]=r[0]+M-(B*M+W*U+R*k),t[13]=r[1]+U-(z*M+j*U+I*k),t[14]=r[2]+k-(Y*M+Z*U+N*k),t[15]=1,t}function u3e(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,u=i*o,d=i*a,p=s*o,g=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-d-y,t[1]=u+w,t[2]=p-v,t[3]=0,t[4]=u-w,t[5]=1-c-y,t[6]=g+_,t[7]=0,t[8]=p+v,t[9]=g-_,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uoe(t,e,r,i,s,n,o){const a=1/(r-e),l=1/(s-i),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function h3e(t,e,r,i,s){const n=1/Math.tan(e/2);let o;return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function d3e(t,e,r,i){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function hoe(t,e,r,i,s,n,o){const a=1/(e-r),l=1/(i-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*l,t[14]=(o+n)*c,t[15]=1,t}function mL(t,e,r,i){const s=e[0],n=e[1],o=e[2];let a=s-r[0],l=n-r[1],c=o-r[2];const u=ma();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void $u(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const p=i[0],g=i[1],y=i[2];let _=g*c-y*l,v=y*a-p*c,w=p*l-g*a;d=Math.sqrt(_*_+v*v+w*w),d?(d=1/d,_*=d,v*=d,w*=d):(_=0,v=0,w=0);let T=l*w-c*v,x=c*_-a*w,E=a*v-l*_;d=Math.sqrt(T*T+x*x+E*E),d?(d=1/d,T*=d,x*=d,E*=d):(T=0,x=0,E=0),t[0]=_,t[1]=T,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=w,t[9]=E,t[10]=c,t[11]=0,t[12]=-(_*s+v*n+w*o),t[13]=-(T*s+x*n+E*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function doe(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let u=s-r[0],d=n-r[1],p=o-r[2],g=u*u+d*d+p*p;g>0&&(g=1/Math.sqrt(g),u*=g,d*=g,p*=g);let y=l*p-c*d,_=c*u-a*p,v=a*d-l*u;return g=y*y+_*_+v*v,g>0&&(g=1/Math.sqrt(g),y*=g,_*=g,v*=g),t[0]=y,t[1]=_,t[2]=v,t[3]=0,t[4]=d*v-p*_,t[5]=p*y-u*v,t[6]=u*_-d*y,t[7]=0,t[8]=u,t[9]=d,t[10]=p,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function p3e(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function f3e(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function m3e(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function poe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function g3e(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function y3e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function foe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function zB(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],g=t[11],y=t[12],_=t[13],v=t[14],w=t[15],T=e[0],x=e[1],E=e[2],O=e[3],A=e[4],$=e[5],M=e[6],U=e[7],k=e[8],B=e[9],z=e[10],Y=e[11],W=e[12],j=e[13],Z=e[14],R=e[15],I=ma();return Math.abs(r-T)<=I*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-x)<=I*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-E)<=I*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-O)<=I*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(o-A)<=I*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-$)<=I*Math.max(1,Math.abs(a),Math.abs($))&&Math.abs(l-M)<=I*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-U)<=I*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(u-k)<=I*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(d-B)<=I*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(p-z)<=I*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(g-Y)<=I*Math.max(1,Math.abs(g),Math.abs(Y))&&Math.abs(y-W)<=I*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(_-j)<=I*Math.max(1,Math.abs(_),Math.abs(j))&&Math.abs(v-Z)<=I*Math.max(1,Math.abs(v),Math.abs(Z))&&Math.abs(w-R)<=I*Math.max(1,Math.abs(w),Math.abs(R))}function kB(t){const e=ma(),r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}function gL(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const _3e=qi,v3e=poe;Object.freeze(Object.defineProperty({__proto__:null,add:m3e,adjoint:e3e,copy:en,determinant:t3e,equals:zB,exactEquals:foe,frob:f3e,fromQuat:u3e,fromQuat2:s3e,fromRotation:bc,fromRotationTranslation:loe,fromRotationTranslationScale:l3e,fromRotationTranslationScaleOrigin:c3e,fromScaling:r3e,fromTranslation:fL,fromXRotation:ooe,fromYRotation:i3e,fromZRotation:aoe,frustum:uoe,getRotation:a3e,getScaling:coe,getTranslation:o3e,hasIdentityRotation:gL,identity:$u,invert:Wn,invertOrIdentity:a2,isOrthoNormal:kB,lookAt:mL,mul:_3e,multiply:qi,multiplyScalar:g3e,multiplyScalarAndAdd:y3e,ortho:hoe,perspective:h3e,perspectiveFromFieldOfView:d3e,rotate:Cl,rotateX:hx,rotateY:pL,rotateZ:dx,scale:dL,set:Fp,str:p3e,sub:v3e,subtract:poe,targetTo:doe,translate:Wa,transpose:$l},Symbol.toStringTag,{value:"Module"}));let bN,Q=null;function moe(){return!!Q}function b3e(){return!!ie("esri-wasm")}function goe(){return bN||(bN=he(()=>import("./pe-wasm-6cae1dca.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>Rr(`esri/geometry/support/${e}`)})).then(t=>{_oe(t)}),bN)}var $9,ls,I9;(function(t){function e(n,o,a){Q.ensureCache.prepare();const l=D_(a),c=a===l,u=Q.ensureFloat64(l),d=Q._pe_geog_to_proj(Q.getPointer(n),o,u);return d&&Qg(a,o,u,c),d}function r(n,o,a,l){switch(l){case ls.PE_TRANSFORM_P_TO_G:return i(n,o,a);case ls.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){Q.ensureCache.prepare();const c=D_(a),u=a===c,d=Q.ensureFloat64(c),p=Q._pe_proj_to_geog_center(Q.getPointer(n),o,d,l);return p&&Qg(a,o,d,u),p}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=s})($9||($9={})),function(t){function e(){t.PE_BUFFER_MAX=Q.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=Q.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=Q.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=Q.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=Q.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=Q.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=Q.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=Q.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=Q.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=Q.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=Q.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=Q.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=Q.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=Q.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=Q.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=Q.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=Q.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=Q.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=Q.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=Q.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=Q.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=Q.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=Q.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=Q.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=Q.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=Q.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=Q.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=Q.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=Q.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=Q.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(ls||(ls={})),function(t){const e={},r={},i=g=>{if(g){const y=g.getType();switch(y){case ls.PE_TYPE_GEOGCS:g=Q.castObject(g,Q.PeGeogcs);break;case ls.PE_TYPE_PROJCS:g=Q.castObject(g,Q.PeProjcs);break;case ls.PE_TYPE_GEOGTRAN:g=Q.castObject(g,Q.PeGeogtran);break;default:y&ls.PE_TYPE_UNIT&&(g=Q.castObject(g,Q.PeUnit))}}return g};function s(){Q.PeFactory.prototype.initialize(null)}function n(g){return o(ls.PE_TYPE_COORDSYS,g)}function o(g,y){let _=null,v=e[g];if(v||(v={},e[g]=v),v.hasOwnProperty(String(y)))_=v[y];else{const w=Q.PeFactory.prototype.factoryByType(g,y);Q.compare(w,Q.NULL)||(_=w,v[y]=_)}return _=i(_),_}function a(g,y){let _=null,v=r[g];if(v||(v={},r[g]=v),v.hasOwnProperty(y))_=v[y];else{const w=Q.PeFactory.prototype.fromString(g,y);Q.compare(w,Q.NULL)||(_=w,v[y]=_)}return _=i(_),_}function l(g){return o(ls.PE_TYPE_GEOGCS,g)}function c(g){return o(ls.PE_TYPE_GEOGTRAN,g)}function u(g){return Q.PeFactory.prototype.getCode(g)}function d(g){return o(ls.PE_TYPE_PROJCS,g)}function p(g){return o(ls.PE_TYPE_UNIT,g)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=d,t.unit=p}(I9||(I9={}));let yoe=null;var qM,L9,D9,N9,YM,F9,XM,ZM,U9;function _oe(t){function e(n,o,a){n[o]=a(n[o])}Q=t,ls.init(),qM.init(),YM.init(),XM.init(),ZM.init(),yoe=class extends Q.PeGCSExtent{destroy(){Q.destroy(this)}};const r=[Q.PeDatum,Q.PeGeogcs,Q.PeGeogtran,Q.PeObject,Q.PeParameter,Q.PePrimem,Q.PeProjcs,Q.PeSpheroid,Q.PeUnit];for(const n of r)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(ls.PE_NAME_MAX))});for(const n of[Q.PeGeogtran,Q.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(ls.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=Q.getValue(l,"*");a[c]=u?Q.wrapPointer(u,Q.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(Q.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return Qg(a,o,n.call(this)),a}),e(Q.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=Q._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!Q.compare(l,Q.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=Q.getPointer(l);for(let d=1;d<c;d++)a.push(Q.wrapPointer(u+o*d,Q.PeGTlistExtendedGTs))}}return a}});const i=Q._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!Q.compare(l,Q.NULL)){a=[l];const c=l.getNump();if(c>1){const u=Q.getPointer(l);for(let d=1;d<c;d++)a.push(Q.wrapPointer(u+i*d,Q.PeHorizon))}}return o.set(n,a),a};e(Q.PeProjcs.prototype,"horizonGcsGenerate",s),e(Q.PeProjcs.prototype,"horizonPcsGenerate",s),Q.PeObject.prototype.toString=function(n=ls.PE_STR_OPTS_NONE){Q.ensureCache.prepare();const o=Q.getPointer(this),a=Q.ensureInt8(new Array(ls.PE_BUFFER_MAX));return Q.UTF8ToString(Q._pe_object_to_string_ext(o,n,a))}}function Hp(t){if(!t)return;const e=Q.getClass(t);if(!e)return;const r=Q.getCache(e);if(!r)return;const i=Q.getPointer(t);i&&delete r[i]}function h3(t,e){const r=[],i=new Array(e);for(let s=0;s<t;s++)r.push(Q.ensureInt8(i));return r}function D_(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function Qg(t,e,r,i=!1){if(i)for(let s=0;s<2*e;s++)t[s]=Q.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=Q.getValue(r,"double"),t[n][1]=Q.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=Q.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=Q._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let u=null;const d=new Q.PeInteger(c);try{const p=Q.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(u=[p],c>1)){const g=Q.getPointer(p);for(let y=1;y<c;y++)u.push(Q.wrapPointer(g+e*y,Q.PeGTlistExtendedEntry))}}finally{Q.destroy(d)}return u}t.init=r,t.getGTlist=i})(qM||(qM={})),function(t){function e(r){if(r&&r.length){for(const i of r)Hp(i),i.getEntries().forEach(s=>{Hp(s);const n=s.getGeogtran();Hp(n),n.getParameters().forEach(Hp),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Hp(o);const a=o.getDatum();Hp(a),Hp(a.getSpheroid()),Hp(o.getPrimem()),Hp(o.getUnit())})});Q.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(L9||(L9={})),function(t){function e(r,i,s,n,o){Q.ensureCache.prepare();const a=D_(s),l=s===a,c=Q.ensureFloat64(a);let u=0;n&&(u=Q.ensureFloat64(n));const d=Q._pe_geog_to_geog(Q.getPointer(r),i,c,u,o);return d&&Qg(s,i,c,l),d}t.geogToGeog=e}(D9||(D9={})),function(t){const e=(c,u,d,p,g,y)=>{let _,v;switch(Q.ensureCache.prepare(),c){case"dd":_=Q._pe_geog_to_dd,v=ls.PE_DD_MAX;break;case"ddm":_=Q._pe_geog_to_ddm,v=ls.PE_DDM_MAX;break;case"dms":_=Q._pe_geog_to_dms,v=ls.PE_DMS_MAX}let w=0;u&&(w=Q.getPointer(u));const T=D_(p),x=Q.ensureFloat64(T),E=h3(d,v),O=_(w,d,x,g,Q.ensureInt32(E));if(O)for(let A=0;A<d;A++)y[A]=Q.UTF8ToString(E[A]);return O},r=(c,u,d,p,g)=>{let y;switch(Q.ensureCache.prepare(),c){case"dd":y=Q._pe_dd_to_geog;break;case"ddm":y=Q._pe_ddm_to_geog;break;case"dms":y=Q._pe_dms_to_geog}let _=0;u&&(_=Q.getPointer(u));const v=p.map(E=>Q.ensureString(E)),w=Q.ensureInt32(v),T=Q.ensureFloat64(new Array(2*d)),x=y(_,d,w,T);return x&&Qg(g,d,T),x};function i(c,u,d,p,g){return e("dms",c,u,d,p,g)}function s(c,u,d,p){return r("dms",c,u,d,p)}function n(c,u,d,p,g){return e("ddm",c,u,d,p,g)}function o(c,u,d,p){return r("ddm",c,u,d,p)}function a(c,u,d,p,g){return e("dd",c,u,d,p,g)}function l(c,u,d,p){return r("dd",c,u,d,p)}t.geogToDms=i,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(N9||(N9={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=Q.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=Q.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,u){Q.ensureCache.prepare();let d=0;s&&(d=Q.getPointer(s));const p=D_(o),g=Q.ensureFloat64(p),y=h3(n,ls.PE_MGRS_MAX),_=Q.ensureInt32(y),v=Q._pe_geog_to_mgrs_extended(d,n,g,a,l,c,_);if(v)for(let w=0;w<n;w++)u[w]=Q.UTF8ToString(y[w]);return v}function i(s,n,o,a,l){Q.ensureCache.prepare();let c=0;s&&(c=Q.getPointer(s));const u=o.map(y=>Q.ensureString(y)),d=Q.ensureInt32(u),p=Q.ensureFloat64(new Array(2*n)),g=Q._pe_mgrs_to_geog_extended(c,n,d,a,p);return g&&Qg(l,n,p),g}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(YM||(YM={})),function(t){function e(i,s,n,o,a,l,c){Q.ensureCache.prepare();let u=0;i&&(u=Q.getPointer(i));const d=D_(n),p=Q.ensureFloat64(d),g=h3(s,ls.PE_MGRS_MAX),y=Q.ensureInt32(g),_=Q._pe_geog_to_usng(u,s,p,o,a,l,y);if(_)for(let v=0;v<s;v++)c[v]=Q.UTF8ToString(g[v]);return _}function r(i,s,n,o){Q.ensureCache.prepare();let a=0;i&&(a=Q.getPointer(i));const l=n.map(p=>Q.ensureString(p)),c=Q.ensureInt32(l),u=Q.ensureFloat64(new Array(2*s)),d=Q._pe_usng_to_geog(a,s,c,u);return d&&Qg(o,s,u),d}t.geogToUsng=e,t.usngToGeog=r}(F9||(F9={})),function(t){function e(){t.PE_UTM_OPTS_NONE=Q.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=Q.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=Q.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){Q.ensureCache.prepare();let c=0;s&&(c=Q.getPointer(s));const u=D_(o),d=Q.ensureFloat64(u),p=h3(n,ls.PE_UTM_MAX),g=Q.ensureInt32(p),y=Q._pe_geog_to_utm(c,n,d,a,g);if(y)for(let _=0;_<n;_++)l[_]=Q.UTF8ToString(p[_]);return y}function i(s,n,o,a,l){Q.ensureCache.prepare();let c=0;s&&(c=Q.getPointer(s));const u=o.map(y=>Q.ensureString(y)),d=Q.ensureInt32(u),p=Q.ensureFloat64(new Array(2*n)),g=Q._pe_utm_to_geog(c,n,d,a,p);return g&&Qg(l,n,p),g}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(XM||(XM={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=Q.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=Q.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=Q.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=Q.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=Q.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=r,t.generate=i}(ZM||(ZM={})),function(t){function e(){return Q.PeVersion.prototype.version_string()}t.versionString=e}(U9||(U9={}));const w3e=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return $9},get PeDefs(){return ls},get PeFactory(){return I9},get PeGCSExtent(){return yoe},get PeGTTransformations(){return D9},get PeGTlistExtended(){return qM},get PeGTlistExtendedEntry(){return L9},get PeNotationDms(){return N9},get PeNotationMgrs(){return YM},get PeNotationUsng(){return F9},get PeNotationUtm(){return XM},get PePCSInfo(){return ZM},get PeVersion(){return U9},_init:_oe,get _pe(){return Q},isLoaded:moe,isSupported:b3e,load:goe},Symbol.toStringTag,{value:"Module"})),sut=Math.PI/180,nut=/SPHEROID\[([^\]]+)]/i,Bm=Yt.radius,Yu=Yt.eccentricitySquared,x3e={a1:Bm*Yu,a2:Bm*Yu*Bm*Yu,a3:Bm*Yu*Yu/2,a4:Bm*Yu*Bm*Yu*2.5,a5:Bm*Yu+Bm*Yu*Yu/2,a6:1-Yu},out={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Yt.radius,f:Yt.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:im.radius,f:im.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:pp.radius,f:pp.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:pp.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let d3=0,wN=class z9{static fromGE(e){const r=new z9;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=d3++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=d3++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=d3++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=d3++}getInverse(){const e=new z9;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},k9=class nS{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new nS;let i="";for(const s of e.steps){const n=wN.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof wN?this.steps.push(r):this.steps.push(new wN({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new nS;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[nS.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[nS.cacheKey(e,r)];return s===void 0?null:s}};function T3e(t,e,r){if(e==null||r==null||r.vcsWkid||Sn(e,r))return null;const i=YF(e)/YF(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>S3e(s,i);case"polyline":case"esriGeometryPolyline":return s=>C3e(s,i);case"polygon":case"esriGeometryPolygon":return s=>E3e(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>A3e(s,i);case"extent":case"esriGeometryEnvelope":return s=>O3e(s,i);default:return null}}function S3e(t,e){t&&t.z!=null&&(t.z*=e)}function E3e(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function C3e(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function A3e(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function O3e(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let w0=null,rC=null,xN=null,TN={};const voe=new ck;function BB(){return!!w0&&moe()}function JM(t){return xN==null&&(xN=Promise.all([goe(),he(()=>import("./geometryEngineBase-4f4260d8.js"),[]).then(e=>e.g),he(()=>import("./hydrated-82b0583a.js"),[])])),xN.then(([,e,{hydratedAdapter:r}])=>{qt(t),rC=r,w0=e.default,w0._enableProjection(w3e),voe.notify()})}function oA(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:mW(rC,t,t[0].spatialReference,e,r,i):mW(rC,[t],t.spatialReference,e,r,i)[0]}function mW(t,e,r,i,s=null,n=null){if(r==null||i==null)return e;if(R1(r,i,s))return e.map(o=>boe(o,r,i));if(s==null){const o=k9.cacheKey(r,i);TN[o]!==void 0?s=TN[o]:((s=P3e(r,i,void 0))==null&&(s=new k9),TN[o]=s)}if(w0==null||t==null)throw new VB;return n!=null?w0._project(t,e,r,i,s,n):w0._project(t,e,r,i,s)}function aut(t,e){const r=R3e([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function R3e(t,e){if(!BB()){for(const r of t)if(r!=null&&!Sn(r.spatialReference,e)&&No(r.spatialReference)&&No(e)&&!R1(r.spatialReference,e))return Zt(voe),{pending:JM(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:Sn(r.spatialReference,e)?r:No(r.spatialReference)&&No(e)?M3e(r,e):null)}}function P3e(t,e,r=null){if(t==null||e==null)return null;if(w0==null||rC==null)throw new VB;const i=w0._getTransformation(rC,t,e,r,r==null?void 0:r.spatialReference);return i!==null?k9.fromGE(i):null}class VB extends X{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var H;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(H||(H={}));function M3e(t,e){try{const r=oA(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=T3e(r.type,t.spatialReference,e);return i!=null&&i(r),r}catch(r){if(!(r instanceof VB))throw r;return null}}function R1(t,e,r){return!r&&(!!Sn(t,e)||No(t)&&No(e)&&!!WB(t,e,YB))}async function lut(t,e,r,i){if(BB())return Oj(i);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!R1(s,n,o))return JM(i)}else if(!R1(t,e,r))return JM(i);return Oj(i)}function cut(t,e){switch(WB(t,e,YB)){case pi:return"copy3";case u0:return"wgs84ToSphericalECEF";case P1:return"wgs84ToWebMercator";case c0:return"wgs84ToPlateCarree";case d0:return"wgs84ToWGS84ECEF";case n1:return"webMercatorToWGS84";case Coe:return"webMercatorToSphericalECEF";case Aoe:return"webMercatorToWGS84ECEF";case Ooe:return"webMercatorToPlateCarree";case p0:return"wgs84ECEFToWGS84";case Moe:return"wgs84ECEFToSphericalECEF";case $oe:return"wgs84ECEFToWebMercator";case h0:return"sphericalECEFToWGS84";case Roe:return"sphericalECEFToWebMercator";case j9:return"sphericalMarsPCPFToMars2000";case G9:return"sphericalMoonPCPFToMoon2000";case Poe:return"sphericalECEFToWGS84ECEF";case V9:return"mars2000ToSphericalPCPF";case B9:return"moon2000ToSphericalPCPF";default:return null}}function boe(t,e,r){return t?"x"in t?woe(t,e,new at,r,0):"xmin"in t?D3e(t,e,new Wr,r,0):"rings"in t?xoe(t,e,new tv,r,0):"paths"in t?L3e(t,e,new Kx,r,0):"points"in t?I3e(t,e,new JC,r,0):null:null}function $3e(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&woe(t,t.spatialReference,e,r,i)!=null}function woe(t,e,r,i,s){$r[0]=t.x,$r[1]=t.y;const n=t.z;return $r[2]=n!==void 0?n:s,Xi($r,e,0,$r,i,0,1)?(r.x=$r[0],r.y=$r[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=$r[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function I3e(t,e,r,i,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,u=[];for(const d of n)u.push(d[0],d[1],o?d[2]:s);if(!Xi(u,e,0,u,i,0,c))return null;for(let d=0;d<c;++d){const p=3*d,g=u[p],y=u[p+1];o&&a?l.push([g,y,u[p+2],n[d][3]]):o?l.push([g,y,u[p+2]]):a?l.push([g,y,n[d][2]]):l.push([g,y])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function L3e(t,e,r,i,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];return Soe(n,o??!1,a??!1,e,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function uut(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&xoe(t,t.spatialReference,e,r,i)!=null}function xoe(t,e,r,i,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];return Soe(n,o??!1,a??!1,e,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function D3e(t,e,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t;return gW(n,o,c?t.zmin:s,e,$r,i)?(r.xmin=$r[0],r.ymin=$r[1],c&&(r.zmin=$r[2]),gW(a,l,c?t.zmax:s,e,$r,i)?(r.xmax=$r[0],r.ymax=$r[1],c&&(r.zmax=$r[2]),u&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function N0(t,e,r){if(e==null||r==null)return null;const i=new at({spatialReference:r});return Xi(t,e,0,$r,r,0,1)?(i.x=$r[0],i.y=$r[1],i.z=$r[2],i):null}function Toe(t,e,r){return Xi(t,e,0,$r,r.spatialReference,0,1)?(r.x=$r[0],r.y=$r[1],r.z=$r[2],r):null}function bo(t,e,r,i=0){$r[0]=t.x,$r[1]=t.y;const s=t.z;return $r[2]=s!==void 0?s:i,Xi($r,t.spatialReference,0,e,r,0,1)}function gW(t,e,r,i,s,n){return ki[0]=t,ki[1]=e,ki[2]=r,Xi(ki,i,0,s,n,0,1)}function wn(t,e,r,i){return!(e==null||i==null||t.length<2)&&(t.length===2&&(ki[0]=t[0],ki[1]=t[1],ki[2]=0,t=ki),Xi(t,e,0,r,i,0,1))}function N3e(t,e){$r[0]=t.x,$r[1]=t.y;const r=t.z;return $r[2]=r!==void 0?r:0,F3e($r,t.spatialReference,e)}function F3e(t,e,r){return U3e(t,e,r)}function U3e(t,e,r){if(e==null)return!1;const i=F0(e,_L),s=lp[i][H.WGS84_COMPARABLE_LON_LAT];return s!=null&&(s(t,0,ki,0),r!==ki&&(r[0]=ki[0],r[1]=ki[1],r.length>2&&(r[2]=ki[2])),!0)}function Xi(t,e,r,i,s,n,o=1){const a=WB(e,s,YB);if(a==null)return!1;if(a===pi){if(t===i&&r===n)return!0;const c=r+3*o;for(let u=r,d=n;u<c;u++,d++)i[d]=t[u];return!0}const l=r+3*o;for(let c=r,u=n;c<l;c+=3,u+=3)a(t,c,i,u);return!0}function hut(t,e,r,i,s){te($r,t),oe(p3,t,e),wn($r,r,$r,s),wn(p3,r,p3,s),le(i,p3,$r),fe(i,i)}function Soe(t,e,r,i,s,n,o=0){const a=new Array;for(const c of t)for(const u of c)a.push(u[0],u[1],e?u[2]:o);if(!Xi(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of t){const u=new Array;for(const d of c)e&&r?u.push([a[l++],a[l++],a[l++],d[3]]):e?u.push([a[l++],a[l++],a[l++]]):r?(u.push([a[l++],a[l++],d[2]]),l++):(u.push([a[l++],a[l++]]),l++);s.push(u)}return!0}function dut(t,e,r,i){if(e==null||i==null)return!1;const s=Ioe(e,i,q3e);if(s.projector===pi)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(s.projector==null)return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===H.WEB_MERCATOR){const a=lp[n.spatialReferenceId][H.WGS84];return a!=null&&(a(t,0,Th,0),P1(Th,0,r,0),r[3]=yW(Th[1],t[2],t[3],Yt.radius),!0)}if(n.spatialReferenceId!==H.WGS84&&n.spatialReferenceId!==H.CGCS2000||o.spatialReferenceId!==H.PLATE_CARREE){s.projector(t,0,r,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=lp[n.spatialReferenceId][H.SPHERICAL_ECEF],l=lp[H.SPHERICAL_ECEF][H.PLATE_CARREE];let c=t[3];a!=null&&l!=null&&(c=yW(t[1],t[2],t[3],Yt.radius)),s.projector(t,0,r,0),r[3]=c}return!0}function yW(t,e,r,i){const s=i+e;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(Fh*t)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function yL(t,e,r,i){return t!=null&&(Sn(e,i)?(sm(r,t),!0):(ki[0]=t[0],ki[1]=t[1],ki[2]=0,!!Xi(ki,e,0,ki,i,0,1)&&(r[0]=ki[0],r[1]=ki[1],ki[0]=t[2],ki[1]=t[3],ki[2]=0,!!Xi(ki,e,0,ki,i,0,1)&&(r[2]=ki[0],r[3]=ki[1],!0))))}function put(t,e,r,i){if(e==null||i==null)return!1;const s=F0(e,_L),n=F0(i,Loe);if(s===n&&s!==H.UNKNOWN||Sn(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===H.SPHERICAL_ECEF){const o=Te(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/Yt.radius;if(n===H.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===H.WGS84||n===H.CGCS2000){const c=oE;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===H.PLATE_CARREE){if(n===H.WGS84||n===H.CGCS2000)return r[0]=oE,r[1]=oE,r[2]=1,!0;if(n===H.WEB_MERCATOR){const o=t[1]/Yt.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function bu(t,e,r,i){if(t==null||i==null)return!1;const s=F0(t,_L),n=F0(i,Loe);if(s===n&&!_W(n)&&(s!==H.UNKNOWN||Sn(t,i)))return fL(r,e),!0;if(_W(n)){const o=lp[s][H.LON_LAT],a=lp[H.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Th,0),a(Th,0,Vm,0),Eoe(Fh*Th[0],Fh*Th[1],r),r[12]=Vm[0],r[13]=Vm[1],r[14]=Vm[2],!0)}if((n===H.WEB_MERCATOR||n===H.PLATE_CARREE)&&(s===H.WGS84||s===H.CGCS2000&&n===H.PLATE_CARREE||s===H.SPHERICAL_ECEF||s===H.WEB_MERCATOR)){const o=lp[s][H.LON_LAT],a=lp[H.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Th,0),a(Th,0,Vm,0),s===H.SPHERICAL_ECEF?z3e(Fh*Th[0],Fh*Th[1],r):$u(r),r[12]=Vm[0],r[13]=Vm[1],r[14]=Vm[2],!0)}return!1}function _W(t){return t===H.SPHERICAL_ECEF||t===H.SPHERICAL_MARS_PCPF||t===H.SPHERICAL_MOON_PCPF}function Eoe(t,e,r){const i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function z3e(t,e,r){return Eoe(t,e,r),$l(r,r),r}function F0(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=fa(t,1)),t.wkt===Pre.wkt?e.spatialReferenceId=H.SPHERICAL_ECEF:HE(t)?e.spatialReferenceId=H.WGS84:_1(t)?e.spatialReferenceId=H.WEB_MERCATOR:Tk(t)?e.spatialReferenceId=H.PLATE_CARREE:t.wkt===Mre.wkt?e.spatialReferenceId=H.WGS84_ECEF:t.wkid===pu.CGCS2000?e.spatialReferenceId=H.CGCS2000:t.wkt===Ak.wkt?e.spatialReferenceId=H.SPHERICAL_MARS_PCPF:t.wkt===Ok.wkt?e.spatialReferenceId=H.SPHERICAL_MOON_PCPF:Lp(t)?e.spatialReferenceId=H.GCSMARS2000:Dp(t)?e.spatialReferenceId=H.GCSMOON2000:e.spatialReferenceId=H.UNKNOWN):H.UNKNOWN}function pi(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function n1(t,e,r,i){r[i++]=px*(t[e++]/Yt.radius),r[i++]=px*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/Yt.radius))),r[i]=t[e]}function Coe(t,e,r,i){n1(t,e,r,i),u0(r,i,r,i)}function Aoe(t,e,r,i){n1(t,e,r,i),d0(r,i,r,i)}function GB(t,e,r,i,s){const n=.4999999*Math.PI,o=me(Fh*t[e+1],-n,n),a=Math.sin(o);r[i++]=Fh*t[e]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function P1(t,e,r,i){GB(t,e,r,i,Yt)}const vW=Yt.radius*Math.PI/180,oE=180/(Yt.radius*Math.PI);function c0(t,e,r,i){r[i]=t[e]*vW,r[i+1]=t[e+1]*vW,r[i+2]=t[e+2]}function Y_(t,e,r,i){r[i]=t[e]*oE,r[i+1]=t[e+1]*oE,r[i+2]=t[e+2]}function Ooe(t,e,r,i){n1(t,e,r,i),c0(r,i,r,i)}function k3e(t,e,r,i){p0(t,e,r,i),c0(r,i,r,i)}function B3e(t,e,r,i){h0(t,e,r,i),c0(r,i,r,i)}function V3e(t,e,r,i){Y_(t,e,r,i),u0(r,i,r,i)}function G3e(t,e,r,i){Y_(t,e,r,i),P1(r,i,r,i)}function j3e(t,e,r,i){Y_(t,e,r,i),d0(r,i,r,i)}function M1(t){if(t==null)return!1;const e=F0(t,_L);return!!lp[e][H.WGS84_COMPARABLE_LON_LAT]}function H3e(t,e,r,i){const s=Math.cos(r);t[0]=Math.cos(e)*s*i,t[1]=Math.sin(e)*s*i,t[2]=Math.sin(r)*i}function jB(t,e,r,i,s){const n=s+t[e+2],o=Fh*t[e+1],a=Fh*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function B9(t,e,r,i){jB(t,e,r,i,im.radius)}function V9(t,e,r,i){jB(t,e,r,i,pp.radius)}function u0(t,e,r,i){jB(t,e,r,i,Yt.radius)}function HB(t,e,r,i,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=Cu(a/(l===0?1:l)),u=Math.atan2(o,n);r[i++]=px*u,r[i++]=px*c,r[i]=l-s}function G9(t,e,r,i){HB(t,e,r,i,im.radius)}function j9(t,e,r,i){HB(t,e,r,i,pp.radius)}function h0(t,e,r,i){HB(t,e,r,i,Yt.radius)}function Roe(t,e,r,i){h0(t,e,r,i),P1(r,i,r,i)}function Poe(t,e,r,i){h0(t,e,r,i),d0(r,i,r,i)}function W3e(t,e,r,i,s){const n=Fh*t[e],o=Fh*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(n),r[i++]=(u+a)*c*Math.sin(n),r[i++]=(u*(1-s.eccentricitySquared)+a)*l}function d0(t,e,r,i){W3e(t,e,r,i,Yt)}function p0(t,e,r,i){const s=x3e,n=t[e],o=t[e+1],a=t[e+2];let l,c,u,d,p,g,y,_,v,w,T,x,E,O,A,$,M,U,k,B,z;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),d=c+a*a,p=Math.sqrt(d),B=Math.atan2(o,n),g=a*a/d,y=c/d,O=s.a2/p,A=s.a3-s.a4/p,y>.3?(_=l/p*(1+y*(s.a1+O+g*A)/p),k=Math.asin(_),w=_*_,v=Math.sqrt(1-w)):(v=u/p*(1-g*(s.a5-O-y*A)/p),k=Math.acos(v),w=1-v*v,_=Math.sqrt(w)),T=1-Yt.eccentricitySquared*w,x=Yt.radius/Math.sqrt(T),E=s.a6*x,O=u-x*v,A=l-E*_,M=v*O+_*A,$=v*A-_*O,U=$/(E/T+M),k+=U,z=M+$*U/2,a<0&&(k=-k),r[i++]=px*B,r[i++]=px*k,r[i]=z}function Moe(t,e,r,i){p0(t,e,r,i),u0(r,i,r,i)}function $oe(t,e,r,i){p0(t,e,r,i),P1(r,i,r,i)}const lp={[H.WGS84]:{[H.CGCS2000]:null,[H.GCSMARS2000]:null,[H.GCSMOON2000]:null,[H.LON_LAT]:pi,[H.WGS84_COMPARABLE_LON_LAT]:pi,[H.SPHERICAL_ECEF]:u0,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:P1,[H.PLATE_CARREE]:c0,[H.WGS84]:pi,[H.WGS84_ECEF]:d0},[H.CGCS2000]:{[H.CGCS2000]:pi,[H.GCSMARS2000]:null,[H.GCSMOON2000]:null,[H.LON_LAT]:pi,[H.WGS84_COMPARABLE_LON_LAT]:pi,[H.SPHERICAL_ECEF]:u0,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:null,[H.PLATE_CARREE]:c0,[H.WGS84]:null,[H.WGS84_ECEF]:d0},[H.GCSMARS2000]:{[H.CGCS2000]:null,[H.GCSMARS2000]:pi,[H.GCSMOON2000]:null,[H.LON_LAT]:pi,[H.WGS84_COMPARABLE_LON_LAT]:null,[H.SPHERICAL_ECEF]:null,[H.SPHERICAL_MARS_PCPF]:V9,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:null,[H.PLATE_CARREE]:null,[H.WGS84]:null,[H.WGS84_ECEF]:null},[H.GCSMOON2000]:{[H.CGCS2000]:null,[H.GCSMARS2000]:null,[H.GCSMOON2000]:pi,[H.LON_LAT]:pi,[H.WGS84_COMPARABLE_LON_LAT]:null,[H.SPHERICAL_ECEF]:null,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:B9,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:null,[H.PLATE_CARREE]:null,[H.WGS84]:null,[H.WGS84_ECEF]:null},[H.WEB_MERCATOR]:{[H.CGCS2000]:null,[H.GCSMARS2000]:null,[H.GCSMOON2000]:null,[H.LON_LAT]:n1,[H.WGS84_COMPARABLE_LON_LAT]:n1,[H.SPHERICAL_ECEF]:Coe,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:pi,[H.PLATE_CARREE]:Ooe,[H.WGS84]:n1,[H.WGS84_ECEF]:Aoe},[H.WGS84_ECEF]:{[H.CGCS2000]:p0,[H.GCSMARS2000]:null,[H.GCSMOON2000]:null,[H.LON_LAT]:p0,[H.WGS84_COMPARABLE_LON_LAT]:p0,[H.SPHERICAL_ECEF]:Moe,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:$oe,[H.PLATE_CARREE]:k3e,[H.WGS84]:p0,[H.WGS84_ECEF]:pi},[H.SPHERICAL_ECEF]:{[H.CGCS2000]:h0,[H.GCSMARS2000]:null,[H.GCSMOON2000]:null,[H.LON_LAT]:h0,[H.WGS84_COMPARABLE_LON_LAT]:h0,[H.SPHERICAL_ECEF]:pi,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:Roe,[H.PLATE_CARREE]:B3e,[H.WGS84]:h0,[H.WGS84_ECEF]:Poe},[H.SPHERICAL_MARS_PCPF]:{[H.CGCS2000]:null,[H.GCSMARS2000]:j9,[H.GCSMOON2000]:null,[H.LON_LAT]:j9,[H.WGS84_COMPARABLE_LON_LAT]:null,[H.SPHERICAL_ECEF]:null,[H.SPHERICAL_MARS_PCPF]:pi,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:null,[H.PLATE_CARREE]:null,[H.WGS84]:null,[H.WGS84_ECEF]:null},[H.SPHERICAL_MOON_PCPF]:{[H.CGCS2000]:null,[H.GCSMARS2000]:null,[H.GCSMOON2000]:G9,[H.LON_LAT]:G9,[H.WGS84_COMPARABLE_LON_LAT]:null,[H.SPHERICAL_ECEF]:null,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:pi,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:null,[H.PLATE_CARREE]:null,[H.WGS84]:null,[H.WGS84_ECEF]:null},[H.UNKNOWN]:{[H.CGCS2000]:null,[H.GCSMARS2000]:null,[H.GCSMOON2000]:null,[H.LON_LAT]:null,[H.WGS84_COMPARABLE_LON_LAT]:null,[H.SPHERICAL_ECEF]:null,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:pi,[H.WEB_MERCATOR]:null,[H.PLATE_CARREE]:null,[H.WGS84]:null,[H.WGS84_ECEF]:null},[H.LON_LAT]:{[H.CGCS2000]:pi,[H.GCSMARS2000]:pi,[H.GCSMOON2000]:pi,[H.LON_LAT]:pi,[H.WGS84_COMPARABLE_LON_LAT]:pi,[H.SPHERICAL_ECEF]:u0,[H.SPHERICAL_MARS_PCPF]:V9,[H.SPHERICAL_MOON_PCPF]:B9,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:P1,[H.PLATE_CARREE]:c0,[H.WGS84]:pi,[H.WGS84_ECEF]:d0},[H.WGS84_COMPARABLE_LON_LAT]:{[H.CGCS2000]:null,[H.GCSMARS2000]:null,[H.GCSMOON2000]:null,[H.LON_LAT]:pi,[H.WGS84_COMPARABLE_LON_LAT]:pi,[H.SPHERICAL_ECEF]:u0,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:null,[H.PLATE_CARREE]:c0,[H.WGS84]:pi,[H.WGS84_ECEF]:d0},[H.PLATE_CARREE]:{[H.CGCS2000]:Y_,[H.GCSMARS2000]:null,[H.GCSMOON2000]:null,[H.LON_LAT]:Y_,[H.WGS84_COMPARABLE_LON_LAT]:Y_,[H.SPHERICAL_ECEF]:V3e,[H.SPHERICAL_MARS_PCPF]:null,[H.SPHERICAL_MOON_PCPF]:null,[H.UNKNOWN]:null,[H.WEB_MERCATOR]:G3e,[H.PLATE_CARREE]:pi,[H.WGS84]:Y_,[H.WGS84_ECEF]:j3e}};function WB(t,e,r=qB()){return t==null||e==null?null:Ioe(t,e,r).projector}function Ioe(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=F0(t,r.source),s=F0(e,r.dest);return i===H.UNKNOWN&&s===H.UNKNOWN?Sn(t,e)?r.projector=pi:r.projector=null:r.projector=lp[i][s],r}function qB(){return{source:{spatialReference:null,spatialReferenceId:H.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:H.UNKNOWN,metersPerUnit:1},projector:pi}}const _L={spatialReference:null,spatialReferenceId:H.UNKNOWN},Loe={spatialReference:null,spatialReferenceId:H.UNKNOWN},YB=qB(),q3e=qB(),Fh=At(1),px=pa(1),ki=C(),Th=C(),Vm=C(),$r=C(),p3=C();let ym=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&Jw(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*bW);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,bW));e++)this._items.push(this._allocator())}};const bW=1024;function xe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fx(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function XB(t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_){return[t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_]}function Doe(t,e){return new Float64Array(t,e,16)}const qa=xe();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:qa,clone:fx,create:xe,createView:Doe,fromValues:XB},Symbol.toStringTag,{value:"Module"}));var Al;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Al||(Al={}));var QM;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(QM||(QM={}));function Zi(){return[1,0,0,0,1,0,0,0,1]}function Noe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function Y3e(t,e,r,i,s,n,o,a,l){return[t,e,r,i,s,n,o,a,l]}function Foe(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Noe,create:Zi,createView:Foe,fromValues:Y3e},Symbol.toStringTag,{value:"Module"}));function zu(){return[0,0,0,1]}function X3e(t){return[t[0],t[1],t[2],t[3]]}function Z3e(t,e,r,i){return[t,e,r,i]}function Uoe(t,e){return new Float64Array(t,e,4)}const J3e=zu();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:J3e,clone:X3e,create:zu,createView:Uoe,fromValues:Z3e},Symbol.toStringTag,{value:"Module"}));function Ie(){return[0,0]}function oS(t){return[t[0],t[1]]}function ir(t,e){return[t,e]}function zoe(t){const e=Ie(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function koe(t,e){return new Float64Array(t,e,2)}function Boe(){return Ie()}function Voe(){return ir(1,1)}function Goe(){return ir(1,0)}function joe(){return ir(0,1)}const Kh=Boe(),Q3e=Voe(),Hoe=Goe(),K3e=joe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Q3e,UNIT_X:Hoe,UNIT_Y:K3e,ZEROS:Kh,clone:oS,create:Ie,createView:koe,fromArray:zoe,fromValues:ir,ones:Voe,unitX:Goe,unitY:joe,zeros:Boe},Symbol.toStringTag,{value:"Module"}));function Ht(){return[0,0,0,0]}function aA(t){return[t[0],t[1],t[2],t[3]]}function Ct(t,e,r,i){return[t,e,r,i]}function ZB(t){const e=Ht(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Woe(t,e){return new Float64Array(t,e,4)}function qoe(){return Ht()}function Yoe(){return Ct(1,1,1,1)}function Xoe(){return Ct(1,0,0,0)}function Zoe(){return Ct(0,1,0,0)}function Joe(){return Ct(0,0,1,0)}function Qoe(){return Ct(0,0,0,1)}const gp=qoe(),fu=Yoe(),eOe=Xoe(),tOe=Zoe(),rOe=Joe(),iOe=Qoe();Object.freeze(Object.defineProperty({__proto__:null,ONES:fu,UNIT_W:iOe,UNIT_X:eOe,UNIT_Y:tOe,UNIT_Z:rOe,ZEROS:gp,clone:aA,create:Ht,createView:Woe,fromArray:ZB,fromValues:Ct,ones:Yoe,unitW:Qoe,unitX:Xoe,unitY:Zoe,unitZ:Joe,zeros:qoe},Symbol.toStringTag,{value:"Module"}));let l2=class h_{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&Jw(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=vv){return new h_(16,koe,e)}static createVec3f64(e=vv){return new h_(24,Dk,e)}static createVec4f64(e=vv){return new h_(32,Woe,e)}static createMat3f64(e=vv){return new h_(72,Foe,e)}static createMat4f64(e=vv){return new h_(128,Doe,e)}static createQuatf64(e=vv){return new h_(32,Uoe,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const vv=4*QM.KILOBYTES,mut=l2.createVec2f64(),$e=l2.createVec3f64(),JB=l2.createVec4f64();l2.createMat3f64();const QB=l2.createMat4f64(),gut=l2.createQuatf64();function id(t){return t?{origin:ms(t.origin),vector:ms(t.vector)}:{origin:C(),vector:C()}}function sOe(t,e){const r=oOe.get();return r.origin=t,r.vector=e,r}function yut(t,e=id()){return nOe(t.origin,t.vector,e)}function nOe(t,e,r=id()){return te(r.origin,t),te(r.vector,e),r}function o1(t,e,r=id()){return te(r.origin,t),le(r.vector,e,t),r}function KB(t,e){const r=le($e.get(),e,t.origin),i=pe(t.vector,r),s=pe(t.vector,t.vector),n=me(i/s,0,1),o=le($e.get(),ee($e.get(),t.vector,n),r);return pe(o,o)}function _ut(t,e,r){return H9(t,e,0,1,r)}function vut(t,e,r){return oe(r,t.origin,ee(r,t.vector,e))}function H9(t,e,r,i,s){const{vector:n,origin:o}=t,a=le($e.get(),e,o),l=pe(n,a)/lo(n);return ee(s,n,me(l,r,i)),oe(s,s,t.origin)}function but(t,e){if(eae(t,sOe(e.origin,e.direction),!1,KM)){const{tA:r,pB:i,distance2:s}=KM;if(r>=0&&r<=1)return s;if(r<0)return Hn(t.origin,i);if(r>1)return Hn(oe($e.get(),t.origin,t.vector),i)}return null}function Koe(t,e,r){return!!eae(t,e,!0,KM)&&(te(r,KM.pA),!0)}function eae(t,e,r,i){const n=t.origin,o=oe($e.get(),n,t.vector),a=e.origin,l=oe($e.get(),a,e.vector),c=$e.get(),u=$e.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const d=$e.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],g=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],y=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],_=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*_-g*g;if(Math.abs(v)<1e-6)return!1;let w=(p*g-y*_)/v,T=(p+g*w)/_;r&&(w=me(w,0,1),T=me(T,0,1));const x=$e.get(),E=$e.get();return x[0]=n[0]+w*d[0],x[1]=n[1]+w*d[1],x[2]=n[2]+w*d[2],E[0]=a[0]+T*u[0],E[1]=a[1]+T*u[1],E[2]=a[2]+T*u[2],i.tA=w,i.tB=T,i.pA=x,i.pB=E,i.distance2=Hn(x,E),!0}const KM={tA:0,tB:0,pA:C(),pB:C(),distance2:0},oOe=new ym(()=>id());function vn(t){return t?wW(ms(t.origin),ms(t.direction)):wW(C(),C())}function wW(t,e){return{origin:t,direction:e}}function wut(t,e){return Kf(t.origin,e.origin)&&Kf(t.direction,e.direction)}function wc(t,e){const r=uOe.get();return r.origin=t,r.direction=e,r}function e$(t,e=vn()){return tae(t.origin,t.direction,e)}function aOe(t,e,r=vn()){return te(r.origin,t),le(r.direction,e,t),r}function tae(t,e,r=vn()){return te(r.origin,t),te(r.direction,e),r}function lOe(t,e){const r=Qe($e.get(),fe($e.get(),t.direction),le($e.get(),e,t.origin));return pe(r,r)}function cOe(t,e,r){const i=pe(t.direction,le(r,e,t.origin));return oe(r,t.origin,ee(r,t.direction,i)),r}const uOe=new ym(()=>vn());function aE(t,e){return pe(t,e)/Te(t)}function vL(t,e){const r=pe(t,e)/(Te(t)*Te(e));return-rn(r)}function rae(t,e,r){fe(f3,t),fe(SN,e);const i=pe(f3,SN),s=rn(i),n=Qe(f3,f3,SN);return pe(n,r)<0?2*Math.PI-s:s}const f3=C(),SN=C(),iae=ss();function ss(){return Ht()}function mx(t,e=ss()){return gu(e,t)}function sae(t,e){return Ct(t[0],t[1],t[2],e)}function hOe(t){return t}function dOe(t){t[0]=t[1]=t[2]=t[3]=0}function bL(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function jf(t){return t[3]}function pOe(t){return t}function nae(t,e,r,i){return Ct(t,e,r,i)}function fOe(t,e,r){return t!==r&&te(r,t),r[3]=t[3]+e,r}function mOe(t,e,r){return ne.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:mx(t,r)}function K0(t,e,r){if(e==null)return!1;const{origin:i,direction:s}=e,n=gOe;n[0]=i[0]-t[0],n[1]=i[1]-t[1],n[2]=i[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let u=(-a-c)/(2*o);const d=(-a+c)/(2*o);return(u<0||d<u&&d>0)&&(u=d),!(u<0)&&(r&&(r[0]=i[0]+s[0]*u,r[1]=i[1]+s[1]*u,r[2]=i[2]+s[2]*u),!0)}const gOe=C();function W9(t,e){return K0(t,e,null)}function yOe(t,e,r){if(K0(t,e,r))return r;const i=c2(t,e,$e.get());return oe(r,e.origin,ee($e.get(),e.direction,ei(e.origin,i)/Te(e.direction))),r}function c2(t,e,r){const i=$e.get(),s=QB.get();Qe(i,e.origin,e.direction);const n=jf(t);Qe(r,i,e.origin),ee(r,r,1/Te(r)*n);const o=lae(t,e.origin),a=vL(e.origin,r);return bc(s,a+o,i),De(r,r,s),r}function _Oe(t,e,r){return K0(t,e,r)?r:(cOe(e,t,r),oae(t,r,r))}function oae(t,e,r){const i=le($e.get(),e,t),s=ee($e.get(),i,t[3]/Te(i));return oe(r,s,t)}function aae(t,e){const r=le($e.get(),e,t),i=lo(r),s=t[3]*t[3];return Math.sqrt(Math.abs(i-s))}function lae(t,e){const r=le($e.get(),e,t),i=Te(r),s=jf(t),n=s+Math.abs(s-i);return rn(s/n)}const EN=C();function cae(t,e,r,i){const s=le(EN,e,t);switch(r){case Al.X:{const n=pH(s,EN)[2];return se(i,-Math.sin(n),Math.cos(n),0)}case Al.Y:{const n=pH(s,EN),o=n[1],a=n[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Al.Z:return fe(i,s);default:return}}function uae(t,e){const r=le(q9,e,t);return Te(r)-t[3]}function vOe(t,e,r,i){const s=uae(t,e),n=cae(t,e,Al.Z,q9),o=ee(q9,n,r-s);return oe(i,e,o)}function bOe(t,e){const r=Hn(t,e),i=jf(t);return r<=i*i}function wOe(t,e,r=ss()){const i=ei(t,e),s=t[3],n=e[3];return i+n<s?(gu(r,t),r):i+s<n?(gu(r,e),r):(Pr(r,t,e,(i+n-s)/(2*i)),r[3]=(i+s+n)/2,r)}const q9=C(),wL=ss(),xOe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:iae,altitudeAt:uae,angleToSilhouette:lae,axisAt:cae,clear:dOe,closestPoint:_Oe,closestPointOnSilhouette:c2,containsPoint:bOe,copy:mx,create:ss,distanceToSilhouette:aae,elevate:fOe,fromCenterAndRadius:sae,fromRadius:bL,fromValues:nae,getCenter:pOe,getRadius:jf,intersectRay:K0,intersectRayClosestSilhouette:yOe,intersectsRay:W9,projectPoint:oae,setAltitudeAt:vOe,setExtent:mOe,tmpSphere:wL,union:wOe,wrap:hOe},Symbol.toStringTag,{value:"Module"}));function gx(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function TOe(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,r,i,s),t}function xut(t,e,r){r=r||t;const i=pe(t,e);se(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),fe(r,r)}function Tut(t,e,r){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),Qe(r,t,e),fe(e,e),Qe(e,r,t),fe(r,r)}function m3(t,e,r,i,s,n){const o=t+(e-t)*s;return o+(r+(i-r)*s-o)*n}function SOe(t,e,r,i=C()){const s=Te(t),n=Te(e),o=pe(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),u=l/n*Math.sin(r*a);return ee(X_,t,c),ee(Z_,e,u),oe(i,X_,Z_)}return Pr(i,t,e,r)}function Sut(t,e,r,i=C(),s=C()){const n=Te(t),o=Te(e),a=pe(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(r*l),d=Math.sin((1-r)*l),p=(1-r)*n+r*o;{const g=p/c,y=g/o*u;ee(X_,t,g/n*d),ee(Z_,e,y),oe(i,X_,Z_)}{const g=1/n*(-Math.cos((1-r)*l)*l*p+d*(-n+o));ee(X_,t,g);const y=1/o*(Math.cos(r*l)*l*p+u*(-n+o));ee(Z_,e,y),oe(s,X_,Z_),ee(s,s,1/c)}return s}return Pr(i,t,e,r),le(s,e,t),fe(s,s),s}function lP(t,e,r){t=fe(X_,t),e=fe(Z_,e);const i=rn(pe(t,e));if(r){const s=Qe(EOe,t,e);if(pe(s,r)<0)return-i}return i}function cP(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const s=t[i-1][0],n=t[i][0],o=(n-r)/(n-s);return o*t[i-1][1]+(1-o)*t[i][1]}}function Eut(t,e,r,i){le(xW,e,t),le(TW,r,t),Qe(i,xW,TW),fe(i,i),i[3]=-pe(t,i)}const xW=C(),TW=C(),EOe=C(),X_=C(),Z_=C();function _r(t=aS){return[t[0],t[1],t[2],t[3]]}function COe(t=aS[0],e=aS[1],r=aS[2],i=aS[3]){return e7(t,e,r,i,JB.get())}function xL(t,e){return e7(e[0],e[1],e[2],e[3],t)}function e7(t,e,r,i,s=_r()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function hae(t,e,r){return te(r,t),r[3]=e,r}function lA(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function Io(t,e,r,i=_r()){const s=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=n*c-o*l,d=o*a-s*c,p=s*l-n*a,g=u*u+d*d+p*p,y=Math.abs(g-1)>1e-5&&g>1e-12?1/Math.sqrt(g):1;return i[0]=u*y,i[1]=d*y,i[2]=p*y,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function dae(t,e,r,i,s){const n=t.length/3;if(n<3)return!1;se(U2,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<n-1&&!a;){const l=3*o;se(bv,t[l],t[l+1],t[l+2]),o++,a=!ca(U2,bv)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;se(N_,t[l],t[l+1],t[l+2]),o++,le(g3,U2,bv),fe(g3,g3),le(y3,bv,N_),fe(y3,y3),a=!ca(U2,N_)&&!ca(bv,N_)&&Math.abs(pe(g3,y3))<AOe}return a?(Io(U2,bv,N_,e),!0):(r!==0||i!==1||s!==2)&&dae(t,e,0,1,2)}const AOe=.99619469809,U2=C(),bv=C(),N_=C(),g3=C(),y3=C();function Y9(t,e,r){return e!==t&&xL(t,e),t[3]=-pe(t,r),t}function X9(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function iC(t,e,r,i){return Qe(N_,e,t),lA(r,N_,i)}function Cut(t,e,r,i){return TL(t,e,le($e.get(),r,e),IOe,i)}function av(t,e,r){return e!=null&&TL(t,e.origin,e.direction,LOe,r)}function OOe(t,e,r){return TL(t,e.origin,e.vector,yp.NONE,r)}function ROe(t,e,r){return TL(t,e.origin,e.vector,yp.CLAMP,r)}function pae(t,e){return Kr(t,e)>=0}function POe(t,e){const r=pe(t,e.ray.direction),i=-Kr(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function MOe(t,e){const r=pe(t,e.ray.direction),i=-Kr(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function $Oe(t,e,r){const i=ee($e.get(),t,-t[3]),s=Z9(t,le($e.get(),e,i),$e.get());return oe(r,s,i),r}function Z9(t,e,r){const i=ee($e.get(),t,pe(t,e));return le(r,e,i),r}function Kr(t,e){return pe(t,e)+t[3]}function TL(t,e,r,i,s){const n=pe(t,r);if(n===0)return!1;let o=-(pe(t,e)+t[3])/n;return i&yp.CLAMP&&(o=me(o,0,1)),!(!(i&yp.INFINITE_MIN)&&o<0||!(i&yp.INFINITE_MAX)&&o>1)&&(oe(s,e,ee(s,r,o)),!0)}function Aut(t){return t}const aS=[0,0,1,0];var yp;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(yp||(yp={}));const IOe=yp.INFINITE_MIN|yp.INFINITE_MAX,LOe=yp.INFINITE_MAX,CN=ne.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let DOe=class{constructor(){this.plane=_r(),this.origin=C(),this.basis1=C(),this.basis2=C()}};const fae=DOe;function _m(t=Eae){return{plane:_r(t.plane),origin:ms(t.origin),basis1:ms(t.basis1),basis2:ms(t.basis2)}}function NOe(t,e,r){const i=YOe.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=COe(0,0,0,0),SL(i),i}function lv(t,e=_m()){return t7(t.origin,t.basis1,t.basis2,e)}function FOe(t,e){te(e.origin,t.origin),te(e.basis1,t.basis1),te(e.basis2,t.basis2),xL(e.plane,t.plane)}function t7(t,e,r,i=_m()){return te(i.origin,t),te(i.basis1,e),te(i.basis2,r),SL(i),WOe(i,"fromValues()"),i}function SL(t){iC(t.basis2,t.basis1,t.origin,t.plane)}function mae(t,e,r){t!==r&&lv(t,r);const i=ee($e.get(),am(t),e);return oe(r.origin,r.origin,i),r.plane[3]-=e,r}function UOe(t,e,r){return gae(e,r),mae(r,n7(t,t.origin),r),r}function gae(t,e=_m()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return se(e.origin,t[0]+r,t[1]+i,0),se(e.basis1,r,0,0),se(e.basis2,0,i,0),e7(0,0,1,0,e.plane),e}function r7(t,e,r){return!!av(t.plane,e,r)&&Tae(t,r)}function zOe(t,e,r){if(r7(t,e,r))return r;const i=yae(t,e,$e.get());return oe(r,e.origin,ee($e.get(),e.direction,ei(e.origin,i)/Te(e.direction))),r}function yae(t,e,r){const i=t$.get();Sae(t,e,i,t$.get());let s=Number.POSITIVE_INFINITY;for(const n of a7){const o=o7(t,n,EL.get()),a=$e.get();if(OOe(i,o,a)){const l=fm($e.get(),e.origin,a),c=Math.abs(rn(pe(e.direction,l)));c<s&&(s=c,te(r,a))}}return s===Number.POSITIVE_INFINITY?_ae(t,e,r):r}function _ae(t,e,r){if(r7(t,e,r))return r;const i=t$.get(),s=t$.get();Sae(t,e,i,s);let n=Number.POSITIVE_INFINITY;for(const o of a7){const a=o7(t,o,EL.get()),l=$e.get();if(ROe(i,a,l)){const c=lOe(e,l);if(!pae(s,l))continue;c<n&&(n=c,te(r,l))}}return i7(t,e.origin)<n&&vae(t,e.origin,r),r}function vae(t,e,r){const i=$Oe(t.plane,e,$e.get()),s=H9(SW(t,t.basis1),i,-1,1,$e.get()),n=H9(SW(t,t.basis2),i,-1,1,$e.get());return le(r,oe($e.get(),s,n),t.origin),r}function bae(t,e,r){const{origin:i,basis1:s,basis2:n}=t,o=le($e.get(),e,i),a=aE(s,o),l=aE(n,o),c=aE(am(t),o);return se(r,a,l,c)}function i7(t,e){const r=bae(t,e,$e.get()),{basis1:i,basis2:s}=t,n=Te(i),o=Te(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function kOe(t,e){return Math.sqrt(i7(t,e))}function BOe(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of a7){const s=o7(t,i,EL.get()),n=KB(s,e);n>r&&(r=n)}return Math.sqrt(r)}function s7(t,e){return pae(t.plane,e)&&Tae(t,e)}function VOe(t,e,r,i){return HOe(t,r,i)}function n7(t,e){const r=-t.plane[3];return aE(am(t),e)-r}function GOe(t,e,r,i){const s=n7(t,e),n=ee(qOe,am(t),r-s);return oe(i,e,n),i}function wae(t,e){return ca(t.basis1,e.basis1)&&ca(t.basis2,e.basis2)&&ca(t.origin,e.origin)}function xae(t,e,r){return t!==r&&lv(t,r),Wn(wv,e),$l(wv,wv),De(r.basis1,t.basis1,wv),De(r.basis2,t.basis2,wv),De(r.plane,t.plane,wv),De(r.origin,t.origin,e),Y9(r.plane,r.plane,r.origin),r}function jOe(t,e,r,i){return t!==i&&lv(t,i),bc(AN,e,r),De(i.basis1,t.basis1,AN),De(i.basis2,t.basis2,AN),SL(i),i}function am(t){return t.plane}function HOe(t,e,r){switch(e){case Al.X:te(r,t.basis1),fe(r,r);break;case Al.Y:te(r,t.basis2),fe(r,r);break;case Al.Z:te(r,am(t))}return r}function Tae(t,e){const r=le($e.get(),e,t.origin),i=lo(t.basis1),s=lo(t.basis2),n=pe(t.basis1,r),o=pe(t.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function SW(t,e){const r=EL.get();return te(r.origin,t.origin),te(r.vector,e),r}function o7(t,e,r){const{basis1:i,basis2:s,origin:n}=t,o=ee($e.get(),i,e.origin[0]),a=ee($e.get(),s,e.origin[1]);oe(r.origin,o,a),oe(r.origin,r.origin,n);const l=ee($e.get(),i,e.direction[0]),c=ee($e.get(),s,e.direction[1]);return ee(r.vector,oe(l,l,c),2),r}function WOe(t,e){Math.abs(pe(t.basis1,t.basis2)/(Te(t.basis1)*Te(t.basis2)))>1e-6&&CN.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(pe(t.basis1,am(t)))>1e-6&&CN.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-pe(am(t),t.origin)-t.plane[3])>1e-6&&CN.warn(e,"Plane offset is not consistent with plane origin")}function Sae(t,e,r,i){const s=am(t);iC(s,e.direction,e.origin,r),iC(r,s,e.origin,i)}const Eae={plane:_r(),origin:Ce(0,0,0),basis1:Ce(1,0,0),basis2:Ce(0,1,0)},t$=new ym(_r),EL=new ym(id),qOe=C(),YOe=new ym(()=>_m()),a7=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],wv=xe(),AN=xe(),XOe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:fae,UP:Eae,altitudeAt:n7,axisAt:VOe,closestPoint:_ae,closestPointOnSilhouette:yae,copy:lv,copyWithoutVerify:FOe,create:_m,distance:kOe,distance2:i7,distanceToSilhouette:BOe,elevate:mae,equals:wae,extrusionContainsPoint:s7,fromAABoundingRect:gae,fromValues:t7,intersectRay:r7,intersectRayClosestSilhouette:zOe,normal:am,projectPoint:vae,projectPointLocal:bae,rotate:jOe,setAltitudeAt:GOe,setExtent:UOe,transform:xae,updateUnboundedPlane:SL,wrap:NOe},Symbol.toStringTag,{value:"Module"})),ZOe=new yt(Pre),EW=new yt(Ak),CW=new yt(Ok),Rut=new yt(Mre);function CL(t){return t&&(Lp(t)||Sn(t,EW))?EW:t&&(Dp(t)||Sn(t,CW))?CW:ZOe}function JOe(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function QOe(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function KOe(t){return{operations:t,value:t.create()}}function Cae(t,e,r=KOe(t)){return r.operations=t,t.copy(e,r.value),r}function eRe(t){return Cae(xOe,nae(0,0,0,Cr(t).radius))}const AW=2**50;function tRe(){return Cae(XOe,t7([0,0,0],[AW,0,0],[0,AW,0]))}function rRe(t,e,r){return t.operations.axisAt(t.value,e,Al.Z,r)}function iRe(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function sRe(t,e,r){return t.operations.intersectRay(t.value,e,r)}function nRe(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function oRe(t,e){return t.operations.altitudeAt(t.value,e)}function Aae(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function aRe(t,e,r,i){return e!==i&&en(i,e),se(xv,i[12],i[13],i[14]),Aae(t,xv,r,xv),i[12]=xv[0],i[13]=xv[1],i[14]=xv[2],i}function ON(t,e,r){return t.operations.elevate(t.value,e,r.value)}const xv=C();function OW(t,e,r,i,s){return s[0]=pe(t,e),s[1]=pe(t,r),s[2]=pe(t,i),s}function J9(t,e,r,i,s){te(r,t),te(_3,e),fe(_3,_3),Qe(i,_3,r),Qe(s,i,r)}function Oae(t,e){return t?CL(e):e.isGeographic?yt.PlateCarree:e}const _3=C(),l7=96;function Put(t,e){const r=e||t.extent,i=t.width,s=fa(r&&r.spatialReference);return r&&i?r.width/i*s*Rk*l7:0}function lRe(t,e){return t/(fa(e)*Rk*l7)}function cRe(t){return t/(Rk*l7)}const uRe="OBJECTID";let yx=class extends sE{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(ne.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};yx=h([F("esri.support.AnalysesCollection")],yx);const uP={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},RN={xsmall:544,small:768,medium:992,large:1200};function hRe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function PN(t,e){return e?uP[t].valueToClassName[e].split(" "):[]}const dRe=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new Oi,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=RN}initialize(){this._breakpointsHandles.add(ce(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Tr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Oe(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=hRe(r);if(!i){const s=JSON.stringify(RN,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:RN,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=wl.acquire(),i=wl.acquire();let s,n=!1;for(s in uP){const o=this[s],a=uP[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,PN(s,o).forEach(l=>i.push(l)),PN(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),wl.release(r),wl.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in uP)PN(i,this[i]).forEach(s=>r.classList.remove(s))}};return h([f()],e.prototype,"breakpoints",null),h([f()],e.prototype,"orientation",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),h([f()],e.prototype,"heightBreakpoint",void 0),e=h([F("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var pRe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},F_={exports:{}},Ps={},sC={exports:{}},cv={};function Rae(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function fRe(t,e,r){}function mRe(t,e,r){}var gRe=/javascript\s*\:/img;function yRe(t,e){return gRe.test(e)?"":e}cv.whiteList=Rae();cv.getDefaultWhiteList=Rae;cv.onAttr=fRe;cv.onIgnoreAttr=mRe;cv.safeAttrValue=yRe;var _Re={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},z2=_Re;function vRe(t,e){t=z2.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,s=0,n=0,o="";function a(){if(!i){var u=z2.trim(t.slice(s,n)),d=u.indexOf(":");if(d!==-1){var p=z2.trim(u.slice(0,d)),g=z2.trim(u.slice(d+1));if(p){var y=e(s,o.length,p,g,u);y&&(o+=y+"; ")}}}s=n+1}for(;n<r;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return z2.trim(o)}var bRe=vRe,v3=cv,wRe=bRe;function RW(t){return t==null}function xRe(t){var e={};for(var r in t)e[r]=t[r];return e}function Pae(t){t=xRe(t||{}),t.whiteList=t.whiteList||v3.whiteList,t.onAttr=t.onAttr||v3.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||v3.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||v3.safeAttrValue,this.options=t}Pae.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=wRe(t,function(l,c,u,d,p){var g=i[u],y=!1;if(g===!0?y=g:typeof g=="function"?y=g(d):g instanceof RegExp&&(y=g.test(d)),y!==!0&&(y=!1),d=o(u,d),!!d){var _={position:c,sourcePosition:l,source:p,isWhite:y};if(y){var v=s(u,d,_);return RW(v)?u+":"+d:v}else{var v=n(u,d,_);if(!RW(v))return v}}});return a};var TRe=Pae;(function(t,e){var r=cv,i=TRe;function s(o,a){var l=new i(a);return l.process(o)}e=t.exports=s,e.FilterCSS=i;for(var n in r)e[n]=r[n]})(sC,sC.exports);var c7={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},SRe=sC.exports.FilterCSS,ERe=sC.exports.getDefaultWhiteList,r$=c7;function Mae(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var $ae=new SRe;function CRe(t,e,r){}function ARe(t,e,r){}function ORe(t,e,r){}function RRe(t,e,r){}function Iae(t){return t.replace(MRe,"&lt;").replace($Re,"&gt;")}function PRe(t,e,r,i){if(r=zae(r),e==="href"||e==="src"){if(r=r$.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(b3.lastIndex=0,b3.test(r))return""}else if(e==="style"){if(PW.lastIndex=0,PW.test(r)||(MW.lastIndex=0,MW.test(r)&&(b3.lastIndex=0,b3.test(r))))return"";i!==!1&&(i=i||$ae,r=i.process(r))}return r=kae(r),r}var MRe=/</g,$Re=/>/g,IRe=/"/g,LRe=/&quot;/g,DRe=/&#([a-zA-Z0-9]*);?/gim,NRe=/&colon;?/gim,FRe=/&newline;?/gim,b3=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,PW=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,MW=/u\s*r\s*l\s*\(.*/gi;function Lae(t){return t.replace(IRe,"&quot;")}function Dae(t){return t.replace(LRe,'"')}function Nae(t){return t.replace(DRe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function Fae(t){return t.replace(NRe,":").replace(FRe," ")}function Uae(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return r$.trim(e)}function zae(t){return t=Dae(t),t=Nae(t),t=Fae(t),t=Uae(t),t}function kae(t){return t=Lae(t),t=Iae(t),t}function URe(){return""}function zRe(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:r$.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return s.push([n!==!1?n:l.position,u]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return r$.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function kRe(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var s=t.indexOf("-->",i);if(s===-1)break;r=s+3}return e}function BRe(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}Ps.whiteList=Mae();Ps.getDefaultWhiteList=Mae;Ps.onTag=CRe;Ps.onIgnoreTag=ARe;Ps.onTagAttr=ORe;Ps.onIgnoreTagAttr=RRe;Ps.safeAttrValue=PRe;Ps.escapeHtml=Iae;Ps.escapeQuote=Lae;Ps.unescapeQuote=Dae;Ps.escapeHtmlEntities=Nae;Ps.escapeDangerHtml5Entities=Fae;Ps.clearNonPrintableCharacter=Uae;Ps.friendlyAttrValue=zae;Ps.escapeAttrValue=kae;Ps.onIgnoreTagStripAll=URe;Ps.StripTagBody=zRe;Ps.stripCommentTag=kRe;Ps.stripBlankChar=BRe;Ps.cssFilter=$ae;Ps.getDefaultCSSWhiteList=ERe;var AL={},jg=c7;function VRe(t){var e=jg.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=jg.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function GRe(t){return t.slice(0,2)==="</"}function jRe(t,e,r){var i="",s=0,n=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){i+=r(t.slice(s,a)),n=a,s=a;continue}if(d===">"){i+=r(t.slice(s,n)),u=t.slice(n,a+1),c=VRe(u),i+=e(n,i.length,c,u,GRe(u)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var p=1,g=t.charAt(a-p);g.trim()===""||g==="=";){if(g==="="){o=d;continue e}g=t.charAt(a-++p)}}else if(d===o){o=!1;continue}}return s<t.length&&(i+=r(t.substr(s))),i}var HRe=/[^a-zA-Z0-9\\_:.-]/gim;function WRe(t,e){var r=0,i=0,s=[],n=!1,o=t.length;function a(p,g){if(p=jg.trim(p),p=p.replace(HRe,"").toLowerCase(),!(p.length<1)){var y=e(p,g||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,d;if(n===!1&&c==="="){n=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:YRe(t,l+1);continue}if(n!==!1&&l===i){if(d=t.indexOf(c,l+1),d===-1)break;u=jg.trim(t.slice(i+1,d)),a(n,u),n=!1,l=d,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=qRe(t,l),d===-1){u=jg.trim(t.slice(r,l)),a(u),n=!1,r=l+1;continue}else{l=d-1;continue}else if(d=XRe(t,l-1),d===-1){u=jg.trim(t.slice(r,l)),u=$W(u),a(n,u),n=!1,r=l+1;continue}else continue}return r<t.length&&(n===!1?a(t.slice(r)):a(n,$W(jg.trim(t.slice(r))))),jg.trim(s.join(" "))}function qRe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function YRe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function XRe(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function ZRe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function $W(t){return ZRe(t)?t.substr(1,t.length-2):t}AL.parseTag=jRe;AL.parseAttr=WRe;var JRe=sC.exports.FilterCSS,Sh=Ps,Bae=AL,QRe=Bae.parseTag,KRe=Bae.parseAttr,hP=c7;function w3(t){return t==null}function ePe(t){var e=hP.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=hP.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=hP.trim(t.slice(0,-1))),{html:t,closing:r}}function tPe(t){var e={};for(var r in t)e[r]=t[r];return e}function rPe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function Vae(t){t=tPe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Sh.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=rPe(t.whiteList||t.allowList):t.whiteList=Sh.whiteList,t.onTag=t.onTag||Sh.onTag,t.onTagAttr=t.onTagAttr||Sh.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Sh.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Sh.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Sh.safeAttrValue,t.escapeHtml=t.escapeHtml||Sh.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new JRe(t.css))}Vae.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=e.cssFilter;r.stripBlankChar&&(t=Sh.stripBlankChar(t)),r.allowCommentTag||(t=Sh.stripCommentTag(t));var d=!1;r.stripIgnoreTagBody&&(d=Sh.StripTagBody(r.stripIgnoreTagBody,n),n=d.onIgnoreTag);var p=QRe(t,function(g,y,_,v,w){var T={sourcePosition:g,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(i,_)},x=s(_,v,T);if(!w3(x))return x;if(T.isWhite){if(T.isClosing)return"</"+_+">";var E=ePe(v),O=i[_],A=KRe(E.html,function($,M){var U=hP.indexOf(O,$)!==-1,k=o(_,$,M,U);return w3(k)?U?(M=l(_,$,M,u),M?$+'="'+M+'"':$):(k=a(_,$,M,U),w3(k)?void 0:k):k});return v="<"+_,A&&(v+=" "+A),E.closing&&(v+=" /"),v+=">",v}else return x=n(_,v,T),w3(x)?c(v):x},c);return d&&(p=d.remove(p)),p};var iPe=Vae;(function(t,e){var r=Ps,i=AL,s=iPe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(F_,F_.exports);var sPe=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):F_.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!r?s=e:e&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new F_.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?F_.exports.escapeAttrValue(e):!n&&!s?F_.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,s):F_.exports.safeAttrValue(e,r,i,s)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(pRe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],u=i.validate(c,r);return u.isValid?a[l]=c:(s=!0,a[l]=u.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const OL=new Map;function Gae(){OL.clear()}function nPe(t){return OL.get(t)}function oPe(t,e){OL.set(t,e)}function MN(t){OL.delete(t)}var $1,_x,aPe=function(t){if("WebkitTransition"in t.style)$1="webkitTransitionEnd",_x="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");$1="transitionend",_x="animationend"}},jae=function(t){$1||aPe(t)},lPe=function(t,e){return e===void 0&&(e=t+"-active"),function(r){jae(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener($1,s),r.removeEventListener(_x,s),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener($1,s),r.addEventListener(_x,s),requestAnimationFrame(function(){r.classList.add(e)})}},cPe=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){jae(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener($1,n),r.removeEventListener(_x,n),i())};r.classList.add(t),r.addEventListener($1,n),r.addEventListener(_x,n),requestAnimationFrame(function(){r.classList.add(e)})}};const uPe=ne.getLogger("esri.widgets.support.widgetUtils");function hPe(t){const e=wl.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const r=e.join(" ");return wl.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(r=>{var i;Gae();for(const s of r)(i=t.get(s.target))==null||i(s)});return(r,i,s)=>(t.has(r)&&uPe.error("Already observing element",r),t.set(r,i),e.observe(r,s),ha(()=>{e.unobserve(r),t.delete(r)}))})();function dPe(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function $ut(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function Iut(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function Lut(t,e){return(t==="enter"?lPe:cPe)(e)}const pPe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],fPe=pPe.reduce((t,e)=>(t[e]=[],t),{}),mPe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Hae=new sPe({whiteList:fPe,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(mPe.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function gPe(t){return t==="Enter"||t===" "}const Wae="http://www.w3.org/",RL=`${Wae}2000/svg`,qae=`${Wae}1999/xlink`;let IW=[],u7=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},h7=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Yae=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},yPe=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(h7(t[i],e))return i}return-1},$N=(t,e,r,i)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(h7(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},_Pe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},Q9=[],K9=!1,Xae=t=>{(t.children||[]).forEach(Xae),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},LW=()=>{K9=!1,Q9.forEach(Xae),Q9.length=0},DW=t=>{Q9.push(t),K9||(K9=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(LW,{timeout:16}):setTimeout(LW,16))},NW=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),DW(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),DW(t))},vPe=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")e8(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d],g=l[p];g&&(Yae(g),r.styleApplyer(t,p,g))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(d){u.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):r.namespace===RL?a==="href"?t.setAttributeNS(qae,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=Hae.sanitize(l):Zae(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function Zae(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let i$,bPe=(t,e,r)=>{if(e)for(let i of e)uw(i,t,void 0,r)},Jae=(t,e,r)=>{bPe(t,e.children,r),e.text&&(t.textContent=e.text),vPe(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},uw=(t,e,r,i)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(s,r):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(n-1),d=o.slice(n,l);u==="."?s.classList.add(d):u==="#"?s.id=d:(d==="svg"&&(i=u7(i,{namespace:RL})),i.namespace!==void 0?s=t.domNode=a.createElementNS(i.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(s,r):s.parentNode!==e&&e.appendChild(s)),n=l+1}}Jae(s,t,i)}},e8=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},wPe=(t,e,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],u=e[l];if(l==="class")u!==c&&(e8(t,u,!1),e8(t,c,!0));else if(l==="classes"){let d=t.classList,p=Object.keys(c),g=p.length;for(let y=0;y<g;y++){let _=p[y],v=!!c[_];v!==!!u[_]&&(s=!0,v?d.add(_):d.remove(_))}}else if(l==="styles"){let d=Object.keys(c),p=d.length;for(let g=0;g<p;g++){let y=d[g],_=c[y];_!==u[y]&&(s=!0,_?(Yae(_),i.styleApplyer(t,y,_)):i.styleApplyer(t,y,""))}}else if(c||typeof u!="string"||(c=""),l==="value"){let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(s=!0)}else if(c!==u){let d=typeof c;d==="function"&&i.eventHandlerInterceptor||(i.namespace===RL?l==="href"?t.setAttributeNS(qae,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=Hae.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):Zae(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}return s},xPe=(t,e,r,i,s)=>{if(r===i)return!1;i=i||IW;let n,o=(r=r||IW).length,a=i.length,l=0,c=0,u=!1;for(;c<a;){let d=l<o?r[l]:void 0,p=i[c];if(d!==void 0&&h7(d,p))u=i$(d,p,s)||u,l++;else{let g=yPe(r,p,l+1);if(g>=0){for(n=l;n<g;n++)NW(r[n]),$N(r,n,t,"removed");u=i$(r[g],p,s)||u,l=g+1}else uw(p,e,l<o?r[l].domNode:void 0,s),_Pe(p),$N(i,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)NW(r[n]),$N(r,n,t,"removed");return u};i$=(t,e,r)=>{let i=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,s=!0,s}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=u7(r,{namespace:RL})),t.text!==e.text&&(n=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,n=xPe(e,i,t.children,e.children,r)||n,n=wPe(i,t.properties,e.properties,r)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),s};let k2=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,i$(i,r,e)},domNode:t.domNode});const TPe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let Lb=t=>u7(TPe,t),f0={create:(t,e)=>(e=Lb(e),uw(t,document.createElement("div"),void 0,e),k2(t,e)),append:(t,e,r)=>(r=Lb(r),uw(e,t,void 0,r),k2(e,r)),insertBefore:(t,e,r)=>(r=Lb(r),uw(e,t.parentNode,t,r),k2(e,r)),merge:(t,e,r)=>(r=Lb(r),e.domNode=t,Jae(t,e,r),k2(e,r)),replace:(t,e,r)=>(r=Lb(r),uw(e,t.parentNode,t,r),t.parentNode.removeChild(t),k2(e,r))},Qae,SPe=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};Qae=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let EPe=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?Qae(r.children,s=>s.domNode===i):void 0}),r},CPe=(t,e,r)=>{let i=function(s){r("domEvent",s);let n=e(),o=SPe(s.currentTarget,n.domNode);o.reverse();let a,l=EPe(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},FW=t=>{let e,r,i=Lb(t),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,p,g)=>{let y,_=()=>y;i.eventHandlerInterceptor=CPe(e,_,s),y=d(p,g(),i),a.push(y),l.push(g)},u=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let p=l[d]();s("rendered",void 0),a[d].update(p),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:u,scheduleRender:()=>{r||o||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,p)=>{c(f0.append,d,p)},insertBefore:(d,p)=>{c(f0.insertBefore,d,p)},merge:(d,p)=>{c(f0.merge,d,p)},replace:(d,p)=>{c(f0.replace,d,p)},detach:d=>{for(let p=0;p<l.length;p++)if(l[p]===d)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},Og=class extends we{constructor(){super(...arguments),this.items=new er,this._watchUpdatingTracking=new mp,this._callbacks=new Map,this._projector=FW(),this._hiddenProjector=FW()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(const i of r.removed){const s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);i.append(r,n),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(n);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),s=this.computeBoundingRect(r);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};h([f({readOnly:!0})],Og.prototype,"surface",void 0),h([f({readOnly:!0})],Og.prototype,"items",void 0),h([f({readOnly:!0})],Og.prototype,"needsRender",null),h([f({readOnly:!0})],Og.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],Og.prototype,"updating",null),Og=h([F("esri.views.overlay.ViewOverlay")],Og);const UW=Og,IN=[0,0];function APe(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return IN[0]=r.left+((e==null?void 0:e.pageXOffset)??0),IN[1]=r.top+((e==null?void 0:e.pageYOffset)??0),IN}function zW(t){t&&(Qne(t),t.parentNode&&t.parentNode.removeChild(t))}function OPe(t){const e=document.createElement("div");return t.appendChild(e),e}const B2=16,x3=750,RPe=512,PPe=2,MPe=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:B2,time:x3},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([ce(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),ce(()=>this.navigating,i=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",i.toString())})])}initialize(){this.addHandles([ce(()=>this.ui,(r,i)=>this._handleUIChange(r,i),Tr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Oe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=hL(r);if(s||typeof r!="string"||ne.getLogger(this.declaredClass).error("#container",`element with id '${r}' not found`),i===s)return;const n="dom-size";if(this.removeHandles(n),this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(zW(this.root),this._set("root",null)),this.userContent&&(tW(this.userContent,i),zW(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",tW(s,o),s.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",s.insertBefore(a,s.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new UW;a.appendChild(c.surface),this._set("overlay",c),this.addHandles(ce(()=>c.needsRender,u=>{u&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Kw({render:()=>{var d;return(d=this.overlay)==null?void 0:d.render()}}):this._overlayRenderTaskHandle=bi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this.addHandles(ce(()=>this.size,u=>{const[d,p]=u,g="esri-view-surface--inset-outline";d>=document.body.clientWidth||p>=document.body.clientHeight?l.classList.add(g):l.classList.remove(g)},Tr),n),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(ce(()=>this.root,s=>{r.container=s?OPe(s):null},Tr),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=B2,r.time=x3,this.addHandles([(()=>{const i=()=>{r.freq=B2,r.time=x3};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),Kw({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=B2,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?B2:Math.min(x3,n.freq*PPe),!s&&n.freq>=RPe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&APe(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return h([f()],e.prototype,"container",null),h([f({readOnly:!0})],e.prototype,"focused",null),h([f({readOnly:!0})],e.prototype,"height",void 0),h([f({type:UW})],e.prototype,"overlay",void 0),h([f({readOnly:!0})],e.prototype,"position",void 0),h([f({readOnly:!0})],e.prototype,"resizing",void 0),h([f({readOnly:!0})],e.prototype,"root",void 0),h([f({value:null,readOnly:!0})],e.prototype,"size",null),h([f({readOnly:!0})],e.prototype,"surface",void 0),h([f({readOnly:!0})],e.prototype,"suspended",void 0),h([f()],e.prototype,"ui",void 0),h([f({readOnly:!0})],e.prototype,"userContent",void 0),h([f({readOnly:!0})],e.prototype,"width",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),e=h([F("esri.views.DOMContainer")],e),e},d7=ne.getLogger("esri.layers.support.ElevationSampler");let Kae=class{queryElevation(e){return ele(e.clone(),this)}on(){return NPe}projectIfRequired(e,r){return tle(e,r)}},$Pe=class extends Kae{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const s=e.tile.extent;this.extent=WI(s,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=fa(r.spatialReference),o=r.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return qI(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return d7.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},Uut=class extends Kae{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?e.map(o=>new $Pe(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=WI(Ut(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return d7.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function ele(t,e){const r=tle(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":IPe(t,r,e);break;case"polyline":LPe(t,r,e);break;case"multipoint":DPe(t,r,e)}return t}function tle(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=ev(t,e);return i||d7.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function IPe(t,e,r){t.z=r.elevationAt(e.x,e.y)}function LPe(t,e,r){rp.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];rp.x=c[0],rp.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(rp.x,rp.y)}}t.hasZ=!0}function DPe(t,e,r){rp.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];rp.x=o[0],rp.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(rp.x,rp.y)}t.hasZ=!0}const rp=new at,NPe={remove(){}};var t8;let kd=t8=class extends Ke{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new t8({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],kd.prototype,"cols",void 0),h([f({type:Qs,json:{write:!0}})],kd.prototype,"level",void 0),h([f({type:String,json:{write:!0}})],kd.prototype,"levelValue",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],kd.prototype,"origin",void 0),h([f({type:Number,json:{write:!0}})],kd.prototype,"resolution",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],kd.prototype,"rows",void 0),h([f({type:Number,json:{write:!0}})],kd.prototype,"scale",void 0),kd=t8=h([F("esri.layers.support.LOD")],kd);const Ph=kd;let FPe=class{constructor(e,r,i,s,n=void 0){this.id=e,this.level=r,this.row=i,this.col=s,this.extent=n}};var Rg;const kW=new Tn({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Dn=Rg=class extends Ke{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:s=yt.WebMercator,numLODs:n=24}=t;if(!No(s)){const d=[];if(r)for(let p=0;p<r.length;p++){const g=r[p];d.push(new Ph({level:p,scale:g,resolution:g}))}else{let p=5e-4;for(let g=n-1;g>=0;g--)d.unshift(new Ph({level:g,scale:p,resolution:p})),p*=2}return new Rg({dpi:96,lods:d,origin:new at(0,0,s),size:[i,i],spatialReference:s})}const o=e1(s),a=t.origin?new at({x:t.origin.x,y:t.origin.y,spatialReference:s}):new at(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(fa(s)*39.37*l),u=[];if(r)for(let d=0;d<r.length;d++){const p=r[d],g=p*c;u.push(new Ph({level:d,scale:p,resolution:g}))}else{let d=Ore(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const p=Math.ceil(n/e);u.push(new Ph({level:0,scale:d,resolution:d*c}));for(let g=1;g<p;g++){const y=d/2**e,_=y*c;u.push(new Ph({level:g,scale:y,resolution:_})),d=y}}return new Rg({dpi:l,lods:u,origin:a,size:[i,i],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=e1(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return at.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],s=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(n=>{i.push(n.scale),e=n.scale>e?n.scale:e,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("minScale",e),this._set("maxScale",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const s=e[i],n=e[i+1];if(s<=t)return i;if(n===t)return i+1;if(s>t&&n<t)return i+Math.log(s/t)/Math.log(s/n)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=r;else if(Sn(e.spatialReference,this.spatialReference))n=e.x,o=e.y,i=r;else{const c=ev(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new FPe(null,0,0,0,Ut())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=Rg.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===Rg.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Ut()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return Rg.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*e;r.push(new Ph({level:n.level,scale:n.scale,resolution:o}))}return new Rg({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};h([f({type:Number,json:{write:!0}})],Dn.prototype,"compressionQuality",void 0),h([f({type:Number,json:{write:!0}})],Dn.prototype,"dpi",void 0),h([f({type:String,json:{read:kW.read,write:kW.write,origins:{"web-scene":{read:!1,write:!1}}}})],Dn.prototype,"format",void 0),h([f({readOnly:!0})],Dn.prototype,"isWrappable",null),h([f({type:at,json:{write:!0}})],Dn.prototype,"origin",void 0),h([Ur("origin")],Dn.prototype,"readOrigin",null),h([f({type:[Ph],value:null,json:{write:!0}})],Dn.prototype,"lods",null),h([f({readOnly:!0})],Dn.prototype,"minScale",void 0),h([f({readOnly:!0})],Dn.prototype,"maxScale",void 0),h([f({readOnly:!0})],Dn.prototype,"scales",void 0),h([f({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Dn.prototype,"size",void 0),h([Ur("size",["rows","cols"])],Dn.prototype,"readSize",null),h([qr("size",{cols:{type:Qs},rows:{type:Qs}})],Dn.prototype,"writeSize",null),h([f({type:yt,json:{write:!0}})],Dn.prototype,"spatialReference",void 0),Dn=Rg=h([F("esri.layers.support.TileInfo")],Dn),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Dn||(Dn={}));const dP=Dn,UPe=12;let xl=class Oa{constructor(e){const r=Oa.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=M1(this.spatialReference)||Lp(this.spatialReference)||Dp(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,u,d)=>(u.level<c.min&&(c.min=u.level,c.minIndex=d),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new Oa(this.toTileInfo())}toTileInfo(){return new dP({dpi:this.dpi,origin:new at({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new Ph({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=eH(e[0]),r[1]=EM(e[1]),r[2]=eH(e[2]),r[3]=EM(e[3])):this._isGCS&&(r[0]=At(e[0]),r[1]=At(e[1]),r[2]=At(e[2]),r[3]=At(e[3]))}getExtentGeometry(e,r,i,s=new Wr){return this.getExtent(e,r,i,hd),s.spatialReference=this.spatialReference,s.xmin=hd[0],s.ymin=hd[1],s.xmax=hd[2],s.ymax=hd[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof Oa)){if(Oa.checkUnsupported(e))return!1;e=new Oa(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!Mw(e.origin[0],this.origin[0],s)||!Mw(e.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*UPe,Mw(i,e.levels[r].resolution,s))}rootTilesInExtent(e,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;Oa.computeRowColExtent(e,n,this.origin,hd);let o=hd[1],a=hd[3],l=hd[0],c=hd[2];const u=c-l,d=a-o;if(u*d>i){const p=Math.floor(Math.sqrt(i));d>p&&(o=o+Math.floor(.5*d)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let g=l;g<c;g++)s.push([0,p,g]);return r!=null&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,r,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!L2e(s.resolution,i/2**s.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new X("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?p7():e.lods.length<1?new X("tilingscheme:generic","Tiling scheme must have at least one level"):Oa.isPowerOfTwo(e)?Oa.hasGapInLevels(e)?new X("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Oa.tileSizeSupported(e)?Oa.hasOriginPerLODs(e)?new X("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new X("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new X("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],s=e[3]-e[1],n=fa(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,u=new Oa(new dP({size:[a,a],origin:new at({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new Ph({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const r=new Oa(Oa.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const s=256/r,n=new Oa(new dP({size:[r,r],origin:new at({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Ph({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function p7(){return new X("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}xl.WebMercatorAuxiliarySphereTileInfo=new dP({size:[256,256],origin:new at({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:yt.WebMercator}),spatialReference:yt.WebMercator,lods:[new Ph({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),xl.WebMercatorAuxiliarySphere=xl.makeWebMercatorAuxiliarySphere(19);const hd=Ut(),hw=64,lS=512,zPe=2.5,nC=D2e(n6/10),rle=2,ile=Ut();xl.WebMercatorAuxiliarySphere.getExtent(0,0,0,ile);const kPe=Ut([-180,-90,180,90]),BPe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",VPe="Surface extent is too large for tile resolution at level 0.",GPe=3;let jPe=GPe;function r8(t){return t<4?3:jPe}let Pg=class extends ys.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=nC}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const r=WI(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??yt.WGS84}elevationAt(e,r){var i;if(this.extent==null||!ra(this.extent,e,r)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ne.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return ele(e.clone(),this)}};h([f({readOnly:!0})],Pg.prototype,"demResolution",void 0),h([f({readOnly:!0})],Pg.prototype,"extent",null),h([f({readOnly:!0})],Pg.prototype,"noDataValue",void 0),h([f()],Pg.prototype,"spatialReference",null),h([f({constructOnly:!0})],Pg.prototype,"view",void 0),Pg=h([F("esri.views.support.GroundViewElevationSampler")],Pg);const HPe=Pg;let Mg=class extends we{constructor(e){super(e),this.view=null,this.layerViews=new er}initialize(){this.addHandles(Mu(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new HPe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>ce(()=>e.updating,()=>this._updateUpdating(),Nr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([f({readOnly:!0})],Mg.prototype,"elevationSampler",null),h([f({type:Boolean,readOnly:!0})],Mg.prototype,"updating",null),h([f({constructOnly:!0})],Mg.prototype,"view",void 0),h([f({type:er,readOnly:!0})],Mg.prototype,"layerViews",void 0),h([f({readOnly:!0})],Mg.prototype,"suspended",null),Mg=h([F("esri.views.GroundView")],Mg);const WPe=Mg;let lm=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],n=new Pte(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=Bte(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)Pj(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const s of r.acquired)Pj(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}};const qPe=ie("mac")?"Meta":"Ctrl",PL={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)PL[t]=String.fromCharCode(t);for(let t=1;t<25;t++)PL[111+t]=`F${t}`;for(let t=65;t<91;t++)PL[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function YPe(t){if(t.key!==void 0)return eve(t);const e=PL[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function XPe(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let ZPe=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const BW=ne.getLogger("esri.views.input.InputHandler");let Zn=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?BW.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof e=="string"?new ZPe(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const d=this._incoming[u.match.eventType];if(d){const p=d.indexOf(u);d.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new JPe(n,i,{onPause:a,onRemove:a,onResume:u=>{const d=this._incoming[u.match.eventType];d&&!d.includes(u)&&(d.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new QPe(e,{onEmit:(i,s,n,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,s,n,o)},onRemove:i=>{var s;delete this._outgoing[i.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):BW.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const s of r)if(s.match.matches(e)&&((i=s.callback)==null||i.call(s,e),e.shouldStopPropagation()))break}}},JPe=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},QPe=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},KPe=class extends Zn{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=e;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}},eMe=class{constructor(e,r){this._observable=new ck,this._value=e,this._equalityFunction=r}get value(){return Zt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function oC(t,e=dte){return new eMe(t,e)}let tMe=class extends Zn{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=oC(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},Wc=class extends we{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=qPe,this._latestPointerType="mouse",this._propertiesPool=new lm({latestPointerLocation:sMe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=x0.INTERNAL){if(this._nameToGroup[e])return void ne.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void ne.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const s={name:e,handlers:r.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var s;i.removed=!0,(s=i.uninstallCallback)==null||s.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ne.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const s=this._handlers[i];s.priorityIndex=i,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)XPe(a)||r.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==r||s.y!==i){const n=this._propertiesPool.get("latestPointerLocation");n.x=r,n.y=i,this._set("latestPointerLocation",n)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const n=r;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,s=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,s)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const s=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=r.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new KPe((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new tMe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],x0.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,x0.INTERNAL)}_setPointerCapture(e,r,i,s){const n=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,s){this._emitInputEvent(0,e,r,i,s)}_emitInputEvent(e,r,i,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new rMe(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new R9,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:s,priorityIndex:n}=e.events.pop(),o=s.data&&s.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[n];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((i=(r=e.currentHandler).eventCallback)==null||i.call(r,s)),s.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new R9;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const s of r.handler.incomingEventMatches){if(i.eventType!==s.eventType)continue;const n=i.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===i.keyModifiers.length!=(n.length===s.keyModifiers.length))return i.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let s=0;for(;s<r.length&&this._compareHandlerPriority(i,r[s])>=0;)s++;r.splice(s,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};h([f({readOnly:!0})],Wc.prototype,"hasPendingInputs",null),h([f({constructOnly:!0})],Wc.prototype,"eventSource",void 0),h([f({constructOnly:!0})],Wc.prototype,"recognizers",void 0),h([f()],Wc.prototype,"_latestPointerType",void 0),h([f()],Wc.prototype,"latestPointerType",null),h([f()],Wc.prototype,"multiTouchActive",null),h([f({readOnly:!0})],Wc.prototype,"latestPointerLocation",void 0),h([f()],Wc.prototype,"_paused",void 0),h([f({readOnly:!0})],Wc.prototype,"updating",null),Wc=h([F("esri.views.input.InputManager")],Wc);let rMe=class{constructor(e,r,i,s,n){this.type=e,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=Hg.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Hg.STOPPED}shouldStopPropagation(){return(this._propagationState&Hg.STOPPED)!=0}async(e){this._propagationState|=Hg.PAUSED;const r=(i,s)=>{this._propagationState&=~Hg.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&Hg.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var Hg;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(Hg||(Hg={}));const x0={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let iMe=class{};const sMe=iMe;function dd(t){return t!=null&&"open"in t&&"declaredClass"in t}const nMe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([ce(()=>[this.ui,this.popup],([r,i],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&dd(l)&&(l.view=null,a.remove(l,n))}r&&dd(i)&&(i.view=this,r.add(i,{key:n,position:o}))},Tr),this.on("click",r=>{var i;this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(dd(this.popup)||((i=this.popup)==null?void 0:i.autoOpenEnabled)!==!1)&&(dd(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),dd(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)}))},x0.WIDGET)]),QE(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{he(()=>import("./Popup-b0feca85.js"),["assets/Popup-b0feca85.js","assets/unitFormatUtils-233032b0.js","assets/AttachmentInfo-20b89832.js","assets/AttachmentQuery-ec55429b.js","assets/widget-ebe44be8.js","assets/ColorStop-c9dfec3d.js","assets/jsonUtils-a30c08d1.js","assets/UniqueValueRenderer-6bfde73c.js","assets/diffUtils-149561ab.js","assets/colorRamps-5cc134e8.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/Query-02316d46.js","assets/executeQueryJSON-e0c13ce5.js","assets/query-2ef7b393.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/FeatureSet-b4c3ebab.js","assets/RelationshipQuery-7bc28ffc.js","assets/TopFeaturesQuery-78393f5a.js","assets/FeatureLayer-1b9cadb4.js","assets/MultiOriginJSONSupport-d8471874.js","assets/sql-6b2d38b4.js","assets/FeatureLayerBase-eb1910ef.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/serviceCapabilitiesUtils-daf60906.js","assets/editsZScale-d39634ea.js","assets/APIKeyMixin-4e2720f9.js","assets/ArcGISService-60eebca2.js","assets/BlendLayer-6b704ca4.js","assets/jsonUtils-5b32189b.js","assets/CustomParametersMixin-238bf6a3.js","assets/EditBusLayer-f0fa7c71.js","assets/FeatureReductionLayer-1b796ac3.js","assets/FeatureEffect-2095f3f9.js","assets/FeatureFilter-ee8bfdef.js","assets/labelingInfo-59a7cf3b.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/OperationalLayer-abee1819.js","assets/OrderedLayer-d05fc281.js","assets/PortalLayer-9cdb0d77.js","assets/portalItemUtils-3c9a4460.js","assets/ScaleRangeLayer-4ea69c96.js","assets/TemporalLayer-bcd2e667.js","assets/FeatureTemplate-7817a164.js","assets/FeatureType-ef13726a.js","assets/fieldProperties-4d9f93fc.js","assets/versionUtils-dd7c16a5.js","assets/styleUtils-c09586c0.js","assets/popupUtils-30b722d9.js"])})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){dd(this.popup)&&this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void ne.getLogger(this.declaredClass).error(new X("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){var r;(r=this._popupSetupTask)==null||r.abort(),dd(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),u=c.map(d=>d.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:RF([l,...u]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}async setupPopup(){var r;if((r=this._popupSetupTask)==null||r.abort(),this.popup&&!dd(this.popup))return this._popupSetupTask=Zx(async i=>{const{default:s}=await he(()=>import("./Popup-b0feca85.js"),["assets/Popup-b0feca85.js","assets/unitFormatUtils-233032b0.js","assets/AttachmentInfo-20b89832.js","assets/AttachmentQuery-ec55429b.js","assets/widget-ebe44be8.js","assets/ColorStop-c9dfec3d.js","assets/jsonUtils-a30c08d1.js","assets/UniqueValueRenderer-6bfde73c.js","assets/diffUtils-149561ab.js","assets/colorRamps-5cc134e8.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/Query-02316d46.js","assets/executeQueryJSON-e0c13ce5.js","assets/query-2ef7b393.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/FeatureSet-b4c3ebab.js","assets/RelationshipQuery-7bc28ffc.js","assets/TopFeaturesQuery-78393f5a.js","assets/FeatureLayer-1b9cadb4.js","assets/MultiOriginJSONSupport-d8471874.js","assets/sql-6b2d38b4.js","assets/FeatureLayerBase-eb1910ef.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/serviceCapabilitiesUtils-daf60906.js","assets/editsZScale-d39634ea.js","assets/APIKeyMixin-4e2720f9.js","assets/ArcGISService-60eebca2.js","assets/BlendLayer-6b704ca4.js","assets/jsonUtils-5b32189b.js","assets/CustomParametersMixin-238bf6a3.js","assets/EditBusLayer-f0fa7c71.js","assets/FeatureReductionLayer-1b796ac3.js","assets/FeatureEffect-2095f3f9.js","assets/FeatureFilter-ee8bfdef.js","assets/labelingInfo-59a7cf3b.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/OperationalLayer-abee1819.js","assets/OrderedLayer-d05fc281.js","assets/PortalLayer-9cdb0d77.js","assets/portalItemUtils-3c9a4460.js","assets/ScaleRangeLayer-4ea69c96.js","assets/TemporalLayer-bcd2e667.js","assets/FeatureTemplate-7817a164.js","assets/FeatureType-ef13726a.js","assets/fieldProperties-4d9f93fc.js","assets/versionUtils-dd7c16a5.js","assets/styleUtils-c09586c0.js","assets/popupUtils-30b722d9.js"]);if(qt(i),!this.popup||dd(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new s(n)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:s!=null?s.event:void 0,signal:s!=null?s.signal:void 0,defaultPopupTemplateEnabled:s!=null&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return h([f({cast(r){return!r||dd(r)||typeof r=="object"&&(r.open=i=>(vM(ne.getLogger(this.declaredClass),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(vM(ne.getLogger(this.declaredClass),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),h([f()],e.prototype,"popupEnabled",void 0),e=h([F("esri.views.PopupView")],e),e},VW={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},oMe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function aMe(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function LN(t,e,r){const i=new Date(t.getTime());if(e&&r){const s=oMe[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=aMe(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+e*a)}return i}function GW(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function eht(t,e,r){return t===0?0:t*VW[e]/VW[r]}var lh;let Jl=lh=class extends Ke{static get allTime(){return jW}static get empty(){return lMe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(lh.allTime)}get isEmpty(){return this.equals(lh.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new lh({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start!=null?this.start.getTime():this.start,r=this.end!=null?this.end.getTime():this.end,i=t.start!=null?t.start.getTime():t.start,s=t.end!=null?t.end.getTime():t.end;return e===i&&r===s}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=fo(this.start,i=>GW(i,t)),r=fo(this.end,i=>{const s=GW(i,t);return i.getTime()===s.getTime()?s:LN(s,1,t)});return new lh({start:e,end:r})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return lh.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,r=((l=this.end)==null?void 0:l.getTime())??1/0,i=((c=t.start)==null?void 0:c.getTime())??-1/0,s=((u=t.end)==null?void 0:u.getTime())??1/0;let n,o;if(i>=e&&i<=r?n=i:e>=i&&e<=s&&(n=e),r>=i&&r<=s?o=r:s>=e&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const d=new lh;return d.start=n===-1/0?null:new Date(n),d.end=o===1/0?null:new Date(o),d}return lh.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new lh,{start:i,end:s}=this;return i!=null&&(r.start=LN(i,t,e)),s!=null&&(r.end=LN(s,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return jW.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new lh({start:e,end:r})}};h([f({type:Date,json:{write:{allowNull:!0}}})],Jl.prototype,"end",void 0),h([Ur("end")],Jl.prototype,"readEnd",null),h([qr("end")],Jl.prototype,"writeEnd",null),h([f({readOnly:!0,json:{read:!1}})],Jl.prototype,"isAllTime",null),h([f({readOnly:!0,json:{read:!1}})],Jl.prototype,"isEmpty",null),h([f({type:Date,json:{write:{allowNull:!0}}})],Jl.prototype,"start",void 0),h([Ur("start")],Jl.prototype,"readStart",null),h([qr("start")],Jl.prototype,"writeStart",null),Jl=lh=h([F("esri.TimeExtent")],Jl);const jW=new Jl,lMe=new Jl({start:void 0,end:void 0}),cMe=Jl;let lE=class extends sE{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};h([lre({Type:om,ensureType:tn(om)})],lE.prototype,"itemType",void 0),lE=h([F("esri.support.GraphicsCollection")],lE);const HW=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function uMe(t,e="system"){if(!t||!HW.has(t.timeZone))return e;const r=HW.get(t.timeZone);return dMe(t.timeZone)||t.respectsDaylightSaving?r:hMe(r)}function hMe(t){const e=lr.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${ua.instance(-r).formatOffset(0,"narrow")}`}function dMe(t){return t.startsWith("UTC")}let $g=class extends mm(Ke){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:s}=r;return{timeZone:i,respectsDaylightSaving:s}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:uMe(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};h([f()],$g.prototype,"legacy",void 0),h([Ur("legacy",["timeZone"])],$g.prototype,"readLegacy",null),h([f({type:String,nonNullable:!0})],$g.prototype,"timeZone",void 0),h([Ur("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],$g.prototype,"readTimeZone",null),h([qr("timeZone")],$g.prototype,"writeTimeZone",null),$g=h([F("esri.time.TimeReference")],$g);const sle=$g;let Ig=class extends we{constructor(e){super(e),this.view=null,this.baseLayerViews=new er,this.referenceLayerViews=new er,this._loadingHandle=ce(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},Tr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};h([f({constructOnly:!0})],Ig.prototype,"view",void 0),h([f({readOnly:!0})],Ig.prototype,"baseLayerViews",void 0),h([f({readOnly:!0})],Ig.prototype,"referenceLayerViews",void 0),h([f({readOnly:!0})],Ig.prototype,"suspended",null),h([f({type:Boolean,readOnly:!0})],Ig.prototype,"updating",null),Ig=h([F("esri.views.BasemapView")],Ig);function pMe(t){return"tryRecycleWith"in t}let fMe=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=vo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Uo(this._controller.signal,()=>{const s=new X("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!pMe(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(qt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>Uo(this._controller.signal,()=>u(wr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,n,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let a,l;if(await r.load({signal:e}),"prefetchResources"in r&&await((s=r.prefetchResources)==null?void 0:s.call(r,{signal:e})),gMe(r))a=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new X("layer:view-not-supported","No layerview implementation was found");const d=await this.layerViewImporter.importLayerView(r);qt(e),a="default"in d?new d.default({layer:r,view:i}):new d({layer:r,view:i})}const c=()=>{l=bi(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=Uo(e,c),qt(e);try{await a.when()}catch(d){throw c(),d}if(!((o=(n=this._map)==null?void 0:n.allLayers)==null?void 0:o.includes(r)))return c(),void this._deferred.reject(new X("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new X("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}},qc=class extends we{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new mp,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const s of r)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=vo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(WC(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,s=[],n=this.view.ready,o=d=>{if(d!=null){for(const p of d)if(p){i.add(p);const g=this._layerLayerViewInfoMap.get(p);g&&n?g.start():g||this._recyclingInfoMap.has(p)||s.push(p),"layers"in p&&p.layers&&o(p.layers)}}};for(const d of this._rootCollectionNames)o(this.get(d));for(const[d,p]of this._layerLayerViewInfoMap)if(!i.has(d)){this._layerLayerViewInfoMap.delete(p.layer);const g=p.tryRecycle(s);g?(this._recyclingInfoMap.set(p.layer,p),g.then(()=>{this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[d,p]of this._recyclingInfoMap)i.has(d)||(this._recyclingInfoMap.delete(p.layer),p.destroy());for(const d of s)this._createLayerView(d);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(u=r==null?void 0:r.basemap)==null?void 0:u.referenceLayers,r==null?void 0:r.layers].filter(d=>!!d);i.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Ga(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ce(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Ss)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),rN(this._recyclingInfoMap),rN(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(wr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||ao(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(rN(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new X("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=n,a.parent=i,r.getItemAt(s)!==a&&r.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<r.length&&r.splice(s,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new fMe(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(gs(i)||i.name==="cancelled:layerview-create")||ne.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};h([f()],qc.prototype,"_workPromise",void 0),h([f({readOnly:!0})],qc.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],qc.prototype,"_layersToLayerViews",null),h([f({readOnly:!0})],qc.prototype,"_rootCollectionNames",null),h([f()],qc.prototype,"layerViewImporter",void 0),h([f()],qc.prototype,"supportsGround",void 0),h([f({readOnly:!0})],qc.prototype,"updating",null),h([f({readOnly:!0})],qc.prototype,"updatingRemaining",null),h([f({constructOnly:!0})],qc.prototype,"view",void 0),qc=h([F("esri.views.LayerViewManager")],qc);const mMe=qc;function gMe(t){return"createLayerView"in t&&t.createLayerView!=null}let Hl=class extends we{constructor(e){super(e),this.factor=1.5,this.offset=Pu(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};h([f({type:Number})],Hl.prototype,"factor",void 0),h([f({nonNullable:!0})],Hl.prototype,"offset",void 0),h([f()],Hl.prototype,"position",void 0),h([f({type:Number,range:{min:0}})],Hl.prototype,"size",void 0),h([f()],Hl.prototype,"maskUrl",void 0),h([f()],Hl.prototype,"maskEnabled",void 0),h([f()],Hl.prototype,"overlayUrl",void 0),h([f()],Hl.prototype,"overlayEnabled",void 0),h([f({readOnly:!0})],Hl.prototype,"version",null),h([f({type:Boolean})],Hl.prototype,"visible",void 0),Hl=h([F("esri.views.Magnifier")],Hl);const nle=Hl;let yMe=class{constructor(){this._tasks=new Array,this._running=oC(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.push(new WW(s,n,e,r,i)))}unshift(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.unshift(new WW(s,n,e,r,i)))}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const s=Js(r.signal);if(s&&!r.abortCallback)r.reject(wr());else{const n=s?(i=r.abortCallback)==null?void 0:i.call(r,wr()):r.callback(e);Sc(n)?n.then(r.resolve,r.reject):r.resolve(n)}}catch(s){r.reject(s)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=wr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.value=!1}},WW=class{constructor(e,r,i,s=void 0,n=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}},cS=class extends we{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};h([f()],cS.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),h([f()],cS.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),cS=h([F("esri.views.support.DebugFlags")],cS);const _Me=new cS;var vr;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(vr||(vr={}));function vMe(){return new s$.Scheduler}var _o,nt;(function(t){t[t.YIELD=1]="YIELD"})(_o||(_o={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(nt||(nt={}));const Qd=0,qW=new Map([[nt.RESOURCE_CONTROLLER_IMMEDIATE,Qd],[nt.RESOURCE_CONTROLLER,4],[nt.SLIDE,Qd],[nt.STREAM_DATA_LOADER,Qd],[nt.ELEVATION_QUERY,Qd],[nt.TERRAIN_SURFACE,1],[nt.SURFACE_GEOMETRY_UPDATES,1],[nt.LOD_RENDERER,2],[nt.GRAPHICS_CORE,2],[nt.I3S_CONTROLLER,2],[nt.POINT_CLOUD_LAYER,2],[nt.FEATURE_TILE_FETCHER,2],[nt.OVERLAY,4],[nt.STAGE,4],[nt.GRAPHICS_DECONFLICTOR,4],[nt.FILTER_VISIBILITY,4],[nt.SCALE_VISIBILITY,4],[nt.FRUSTUM_VISIBILITY,4],[nt.CLOUDS_GENERATOR,4],[nt.POINT_OF_INTEREST_FREQUENT,6],[nt.POINT_OF_INTEREST_INFREQUENT,30],[nt.LABELER,8],[nt.FEATURE_QUERY_ENGINE,8],[nt.FEATURE_TILE_TREE,16],[nt.FEATURE_TILE_TREE_ACTIVE,Qd],[nt.ELEVATION_ALIGNMENT,12],[nt.TEXT_TEXTURE_ATLAS,12],[nt.TEXTURE_UNLOAD,12],[nt.LINE_OF_SIGHT_TOOL,16],[nt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Qd],[nt.SNAPPING,Qd],[nt.SHADOW_ACCUMULATOR,30]]);function YW(t){return qW.has(t)?qW.get(t):typeof t=="number"?t:1}const XW=6.5,ZW=1,bMe=30,JW=1e3/30,QW=100,KW=.9;var s$,py;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=oC(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Uf("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=vr.INTERACTING,this._tasks=new Nt,this._runQueue=new Nt,this._load=0,this._idleStateCallbacks=new Nt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ce(()=>_Me.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Tr);for(const o of Object.keys(nt))this.performanceInfo.tasks.set(nt[o],new Uf(nt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:XW,INTERACTING_BUDGET:JW,IDLE_BUDGET:QW,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),bi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=YW(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new Uf(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===vr.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===vr.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==vr.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=XW,a=n.frameDuration,l=ZW;switch(this.state){case vr.IDLE:o=0,a=Math.max(QW,n.frameDuration),l=bMe;break;case vr.INTERACTING:a=Math.max(JW,n.frameDuration);case vr.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==vr.IDLE&&a<ZW&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case vr.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case vr.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return py.SCHEDULED;let o=py.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=py.READY:o!==py.READY&&(o=py.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*KW+n*(1-KW)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Qd&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Qd&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===_o.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){ne.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,nt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(nt))this._frameTaskTimes.set(nt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new yMe,this._handles=new Oi,this.schedulePriority=this._basePriority,this._task=oC(a??this._queue),this._handles.add(Mu(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(la),this._scheduler.removeTask(this),this.schedule=vx.schedule,this.reschedule=vx.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=YW(n);this._basePriority!==Qd&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=vr.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(s$||(s$={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(py||(py={}));const la=(()=>{const t=new s$.Budget;return t.enabled=!1,t})();let wMe=class{remove(){}processQueue(){}schedule(e,r,i){try{if(Js(r)){const s=wr();return i?Promise.resolve(i(s)):Promise.reject(s)}return PF(e(la))}catch(s){return Promise.reject(s)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const vx=new wMe;let dw=class extends we{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(nt.TEXTURE_UNLOAD))??vx}normalizeCtorArgs(){return{}}destroy(){var e,r,i;super.destroy(),(e=this._frameTask)==null||e.remove(),(r=this._textureRequests)==null||r.forEach(s=>this._releaseTextureRequest(s)),(i=this._textureRequests)==null||i.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const o=r();n={referenceCount:0,texture:o,textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(o),this._stage.loadImmediate(o)),this._textureRequests.set(s,n)}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.onRemove&&e.onRemove(),e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};h([f()],dw.prototype,"_frameTask",void 0),h([f()],dw.prototype,"updating",null),dw=h([F("esri.views.3d.support.TextureCollection")],dw);var eq;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(eq||(eq={}));const ole=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],ale={};function lle(t){return!!ale[t]}function xMe(t){for(const e of t)if(!lle(e))return!1;return!0}ole.forEach(t=>{ale[t]=!0});let TMe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,s){const n=Array.isArray(e)?e:e.split(",");if(!xMe(n))return n.some(lle)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??x0.DEFAULT;const l=this._createUniqueGroupName(),c=new SMe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const u of n){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},SMe=class extends Zn{constructor(e,r,i,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:u,screenPoint:Pu(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(Pu(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:d}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:p,pointerType:o,button:a,buttons:c,radius:r.radius,angle:pa(r.angle),native:l,timestamp:d,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:d,timestamp:p}=e;return{type:r,x:i,y:s,pointerId:c,pointerType:u,button:n,buttons:o,native:a,timestamp:p,eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:p,timestamp:g}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:u,origin:d,native:n,timestamp:g,eventId:o,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var aC,tq,rq;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(aC||(aC={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(tq||(tq={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(rq||(rq={}));function EMe(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return ne.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function i8(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(aC.USER)&&t.getEditableFlag(aC.MANAGER)}function Bd(t){return Pu(t.x,t.y)}function fht(t){return Li(t.x,t.y)}function cle(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?Pu(e.clientX-r.left,e.clientY-r.top):Pu(0,0)}function iq(t,e){return e instanceof Event?cle(t,e):Bd(e)}function sq(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let CMe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}isInteracting(){return this._hoveredManipulators.size>0||this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":nq(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!oq(e))break;const s=Bd(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!oq(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=fo(s,({manipulator:u})=>u),o=fo(s,({tool:u})=>u);if(n==null||o==null)break;const a=Bd(e);a.x=me(a.x,0,r.view.width),a.y=me(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const s=Bd(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(AMe(e)||r.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=Bd(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const s=Bd(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=Bd(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:Bd(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=fo(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Bd(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return ao(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),e(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=c1e(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let s=null;return i(n=>{if(n.manipulators==null||!i8(n))return!1;const o=n.manipulators.intersect(e,r);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Pu(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!nq(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Bd(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,s){let n=this._intersect(e,i,s);const o=fo(this._hoveredManipulators.get(r),({manipulator:a})=>a);n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function nq(t){return t==="mouse"}function oq(t){return t.pointerType!=="mouse"||t.button===0}function AMe(t){return!!t.native.shiftKey}const aq="attached",DN="tools",OMe=100;let ch=class extends tC{constructor(e){super(e),this._clock=Qw,this._manipulatorState=new CMe,this.tools=new er,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return},this._clock=e.clock??Qw}normalizeCtorArgs(e){const{clock:r,...i}=e;return i}initialize(){this.handles.add([this.view.on(ole,e=>{this._handleInputEvent(e)},x0.TOOL),...EMe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void ne.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r!=null&&r.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const s=i8(i);this.activeTool!=null&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=bi(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,OMe)}attach(){var e;this.view.type==="3d"?(this._set("textures",new dw(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ce(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r))),ha(()=>this._set("textures",Oe(this.textures)))],aq)):this.handles.add(ce(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(aq),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!r&&s.visible&&s.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),(this._manipulatorState.isInteracting()||r||this.activeTool!=null&&this.activeTool.interacting)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(DN),this._forEachTool(e=>{if(e instanceof we){const r=ce(()=>[e.cursor,e.visible,e.editable],()=>{i8(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,DN)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],DN)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,aC.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}};h([f({constructOnly:!0,nonNullable:!0})],ch.prototype,"view",void 0),h([f({readOnly:!0,nonNullable:!0})],ch.prototype,"textures",void 0),h([f({value:null})],ch.prototype,"activeTool",null),h([f({readOnly:!0,type:er})],ch.prototype,"tools",void 0),h([f({readOnly:!0})],ch.prototype,"cursor",void 0),h([f({readOnly:!0})],ch.prototype,"updating",null),h([f()],ch.prototype,"_interacting",void 0),h([f({readOnly:!0})],ch.prototype,"interacting",null),ch=h([F("esri.views.ToolViewManager")],ch);const RMe=ch;let Db=class extends we{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":PMe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return MMe[this.deviceType]}};h([f({nonNullable:!0,readOnly:!0})],Db.prototype,"nativeIndex",void 0),h([f({type:String,readOnly:!0})],Db.prototype,"deviceType",null),h([f({type:Number,readOnly:!0})],Db.prototype,"axisThreshold",null),Db=h([F("esri.views.input.gamepad.GamepadInputDevice")],Db);const PMe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),MMe={standard:.15,spacemouse:.025,unknown:0},f7=Db;let uS=class extends we{constructor(...e){super(...e),this.devices=new er,this.enabledFocusMode="document"}};h([f({type:er.ofType(f7),readOnly:!0})],uS.prototype,"devices",void 0),h([f({type:["document","view","none"]})],uS.prototype,"enabledFocusMode",void 0),uS=h([F("esri.views.input.gamepad.GamepadSettings")],uS);const $Me=uS;let pP=class extends we{constructor(){super(...arguments),this.gamepad=new $Me}};h([f({readOnly:!0})],pP.prototype,"gamepad",void 0),pP=h([F("esri.views.input.Input")],pP);const IMe=pP;let Lg=class extends we{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};h([f({type:Boolean,nonNullable:!0})],Lg.prototype,"enabled",void 0),h([f({type:f7})],Lg.prototype,"device",void 0),h([f({type:["pan","zoom"],nonNullable:!0})],Lg.prototype,"mode",void 0),h([f({type:["forward-down","forward-up"],nonNullable:!0})],Lg.prototype,"tiltDirection",void 0),h([f({type:Number,nonNullable:!0})],Lg.prototype,"velocityFactor",void 0),Lg=h([F("esri.views.navigation.gamepad.GamepadSettings")],Lg);const ule=Lg;let d_=class extends we{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new ule,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};h([f({type:Boolean})],d_.prototype,"browserTouchPanEnabled",void 0),h([f({type:ule,nonNullable:!0})],d_.prototype,"gamepad",void 0),h([f({type:Boolean})],d_.prototype,"momentumEnabled",void 0),h([f({type:Boolean})],d_.prototype,"mouseWheelZoomEnabled",void 0),d_=h([F("esri.views.navigation.Navigation")],d_);const hle=d_,dle={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},ple=Object.values(dle),fle=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${ple.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),LMe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${ple.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),DMe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function xht(t){return!!fle.test(t)}function m7(t){if(t==null)return null;const e=da(t),r=e.path.match(fle)||e.path.match(LMe);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:mle(a!==-1?s.slice(a+1):s),serverType:dle[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function NMe(t){const e=da(t).path.match(DMe);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function mle(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function Tht(t,e){const r=[];if(t){const i=m7(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=mle(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function Sht(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(s);return n&&o}function Eht(t,e){return t&&xre(Sre(t,e))}function Cht(t){let{url:e}=t;if(!e)return{url:e};e=Sre(e,t.logger);const r=da(e),i=m7(r.path);let s;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(s=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const n=NMe(r.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:xre(e),layerId:s}}function Aht(t,e,r,i,s){A1(e,i,"url",s),i.url&&t.layerId!=null&&(i.url=kI(i.url,r,t.layerId.toString()))}function Oht(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return r&&(i||s||n)}function Rht(t,e,r){const i=gle(t),s=e,n=FMe(i,s,r);if(i){const o=nA.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new X("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new X("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!UMe(t)||n===fl.Unsupported)return new X("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case fl.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new X("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new X("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case fl.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new X("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new X("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case fl.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new X("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new X("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function FMe(t,e,r){if(!lq(t)||!lq(e))return fl.Unsupported;if(t==null||e==null)return fl.Ok;if(!r&&t.heightUnit!==e.heightUnit)return fl.Units;if(t.heightModel!==e.heightModel)return fl.HeightModel;switch(t.heightModel){case"gravity-related-height":return fl.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?fl.Ok:fl.CRS;default:return fl.Unsupported}}var fl;function lq(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function UMe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!vle(t)}function gle(t){var i;const e=t.url?m7(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&yle(t)&&t.heightModelInfo?t.heightModelInfo:vle(t)?nA.deriveUnitFromSR(kMe,t.spatialReference):null}function yle(t){return"heightModelInfo"in t}function _le(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function vle(t){return _le(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):ble(t)}function zMe(t){return t.layers!=null||ble(t)||_le(t)||yle(t)}function ble(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(fl||(fl={}));const kMe=new nA({heightModel:"gravity-related-height"});var Re;function cq(t){return t==="global"?Re.Global:Re.Local}function NN(t){return t===Re.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Re||(Re={}));let s8,FN=null;async function BMe(t){FN||(FN=he(()=>Promise.resolve().then(()=>zYe),void 0).then(e=>s8=e)),await FN,qt(t)}async function wle(t,e,r,i){if(!t)return null;const s=t.spatialReference;return BB()||R1(s,e)?oA(t,e):s8?s8.projectGeometry(t,e,r,i):(await Promise.race([BMe(i),JM(i)]),wle(t,e,r,i))}let Si=class extends we{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=yc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,s,n,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(i);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(s=(i=this.map)==null?void 0:i.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(zMe(o)){const a=gle(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)i.push({extent:l,layer:s})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=yc(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:Zx(async n=>{try{const o=await wle(i.extent,s,"portalItem"in i.layer?i.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Js(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],s=(n,o)=>n!=null?o!=null?n===o&&n:n:o;for(const n of e)for(const o of r){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:n.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==Re.Local)&&(e=e.filter(({viewingMode:i})=>i!==Re.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const s of r){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(n!=null){const o=n.constraints!=null?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r=new VMe;for(const s of e)if(this._collectCollection(s,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{gs(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};h([f()],Si.prototype,"required",void 0),h([f({constructOnly:!0})],Si.prototype,"map",void 0),h([f({constructOnly:!0})],Si.prototype,"getSpatialReferenceSupport",void 0),h([f()],Si.prototype,"defaultSpatialReference",void 0),h([f()],Si.prototype,"userSpatialReference",void 0),h([f()],Si.prototype,"sourcePreloadCount",void 0),h([f()],Si.prototype,"priorityCollection",void 0),h([f()],Si.prototype,"requiresExtentInSpatialReference",void 0),h([f()],Si.prototype,"suspended",void 0),h([f({readOnly:!0})],Si.prototype,"ready",null),h([f({readOnly:!0})],Si.prototype,"heightModelInfoReady",null),h([f({readOnly:!0})],Si.prototype,"spatialReference",null),h([f({readOnly:!0})],Si.prototype,"extent",null),h([f({readOnly:!0})],Si.prototype,"heightModelInfo",null),h([f({readOnly:!0})],Si.prototype,"vcsWkid",null),h([f({readOnly:!0})],Si.prototype,"latestVcsWkid",null),h([f({readOnly:!0})],Si.prototype,"viewingMode",null),h([f({readOnly:!0})],Si.prototype,"tileInfo",null),h([f({readOnly:!0})],Si.prototype,"mapCollections",null),h([f({readOnly:!0})],Si.prototype,"_allLayers",null),h([f({readOnly:!0})],Si.prototype,"_spatialReferenceTask",null),h([f({readOnly:!0})],Si.prototype,"_tileInfoTask",null),h([f({readOnly:!0})],Si.prototype,"_heightModelInfoTask",null),h([f({readOnly:!0})],Si.prototype,"_extentCandidatesTask",null),h([f()],Si.prototype,"_extentTask",null),h([f()],Si.prototype,"_projectExtentTask",void 0),Si=h([F("esri.views.support.DefaultsFromMap")],Si);let VMe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var hS;let St=hS=class extends UB(ys.EventedMixin(uk(we))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new YE({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:jMe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new lE,this.analyses=new yx,this.typeSpecificPreconditionsReady=!0,this.layerViews=new er,this.magnifier=new nle,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new sle,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new IMe,this.navigation=new hle,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new TMe(this),this.persistableViewModels=new er,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(ce(()=>this.preconditionsReady,e=>{var r,i;e?(this._currentSpatialReference=this.spatialReference,hS.views.add(this)):(this._currentSpatialReference=null,hS.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Nr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,QE(()=>this.ready)))),this.basemapView=new Ig({view:this}),this.layerViewManager=new mMe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new RMe({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ce(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ce(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ce(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([ce(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const s=ha(()=>t=yc(t));t=Zx(async n=>{try{await UE(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}ne.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(hS.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Oe(this.graphics),this.analyses=Oe(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Oe(this.analysisViewManager),this.toolViewManager=Oe(this.toolViewManager),this.layerViewManager=Oe(this.layerViewManager),this.basemapView=Oe(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(r=>r.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=Oe(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ne.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Si({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||P0.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(ne.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:t}),t=null),P0.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Sn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return t??(this._cursor||"default")}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new X("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&ne.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Mu(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};St.views=new er,h([f()],St.prototype,"_userSpatialReference",void 0),h([f()],St.prototype,"activeTool",null),h([f({readOnly:!0})],St.prototype,"allLayerViews",void 0),h([f()],St.prototype,"groundView",void 0),h([f()],St.prototype,"animation",null),h([f()],St.prototype,"basemapView",void 0),h([f()],St.prototype,"center",null),h([f({readOnly:!0})],St.prototype,"_defaultsFromMapSettings",null),h([f()],St.prototype,"defaultsFromMap",null),h([f()],St.prototype,"fatalError",void 0),h([f({type:Wr})],St.prototype,"extent",null),h([f(M9(lE,"graphics"))],St.prototype,"graphics",void 0),h([f(M9(yx,"analyses"))],St.prototype,"analyses",void 0),h([f({readOnly:!0,type:nA})],St.prototype,"heightModelInfo",null),h([f({readOnly:!0})],St.prototype,"interacting",null),h([f({readOnly:!0})],St.prototype,"navigating",null),h([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],St.prototype,"preconditionsReady",null),h([f({readOnly:!0})],St.prototype,"typeSpecificPreconditionsReady",void 0),h([f({type:er,readOnly:!0})],St.prototype,"layerViews",void 0),h([f()],St.prototype,"resolution",null),h([f({type:nle})],St.prototype,"magnifier",void 0),h([f({value:null,type:qie})],St.prototype,"map",null),h([f()],St.prototype,"padding",void 0),h([f({readOnly:!0})],St.prototype,"ready",void 0),h([f({type:yt})],St.prototype,"spatialReference",null),h([f()],St.prototype,"spatialReferenceWarningDelay",void 0),h([f()],St.prototype,"stationary",null),h([f({readOnly:!0})],St.prototype,"supportsGround",void 0),h([f({type:cMe})],St.prototype,"timeExtent",void 0),h([f({type:sle,nonNullable:!0})],St.prototype,"timeReference",void 0),h([f()],St.prototype,"tools",null),h([f()],St.prototype,"toolViewManager",void 0),h([f({readOnly:!0})],St.prototype,"type",void 0),h([f({type:Number})],St.prototype,"scale",void 0),h([f({readOnly:!0})],St.prototype,"updating",void 0),h([f({readOnly:!0})],St.prototype,"initialExtentRequired",void 0),h([f({readOnly:!0})],St.prototype,"initialExtent",null),h([f()],St.prototype,"cursor",null),h([f({readOnly:!0})],St.prototype,"input",void 0),h([f({type:hle,nonNullable:!0})],St.prototype,"navigation",void 0),h([f()],St.prototype,"layerViewManager",void 0),h([f()],St.prototype,"analysisViewManager",void 0),h([f()],St.prototype,"width",void 0),h([f()],St.prototype,"height",void 0),h([f({readOnly:!0})],St.prototype,"resizing",void 0),h([f({value:null,readOnly:!0})],St.prototype,"size",null),h([f({readOnly:!0})],St.prototype,"suspended",void 0),h([f({readOnly:!0})],St.prototype,"viewEvents",void 0),h([f({readOnly:!0})],St.prototype,"persistableViewModels",void 0),h([f()],St.prototype,"_isValid",void 0),h([f()],St.prototype,"_readyCycleForced",void 0),h([f()],St.prototype,"_currentSpatialReference",void 0),St=hS=h([F("esri.views.View")],St);const GMe=St;function jMe(t){return t.layerViews}let Dg=class extends bM{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=vo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new X("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,r){r||(r=Sc(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};h([f({readOnly:!0})],Dg.prototype,"done",null),h([f({readOnly:!0,type:String})],Dg.prototype,"state",void 0),h([f()],Dg.prototype,"target",void 0),Dg=h([F("esri.views.ViewAnimation")],Dg),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Dg||(Dg={}));const bx=Dg,V2=()=>he(()=>import("./TileLayerView3D-76f8de1e.js"),["assets/TileLayerView3D-76f8de1e.js","assets/LayerView3D-93dbb0dd.js","assets/TiledLayerView3D-078c22f4.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/MapServiceLayerViewHelper-fc30f6cf.js","assets/floorFilterUtils-080a7cd2.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/sql-6b2d38b4.js","assets/sublayerUtils-3b57766e.js","assets/popupUtils-af5ad903.js","assets/drapedUtils-9ea64187.js"]),uq=()=>he(()=>import("./ElevationLayerView3D-3fdc1091.js"),["assets/ElevationLayerView3D-3fdc1091.js","assets/LayerView3D-93dbb0dd.js","assets/TiledLayerView3D-078c22f4.js","assets/LayerView-923813e2.js"]),hq={"base-dynamic":()=>he(()=>import("./BaseDynamicLayerView3D-b4726f68.js"),["assets/BaseDynamicLayerView3D-b4726f68.js","assets/DynamicLayerView3D-49117113.js","assets/LayerView3D-93dbb0dd.js","assets/projectExtentUtils-7b3ec1cc.js","assets/ImageMaterial-be81a34f.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js"]),"base-elevation":uq,"base-tile":V2,"bing-maps":V2,"building-scene":()=>he(()=>import("./BuildingSceneLayerView3D-d73de16e.js"),["assets/BuildingSceneLayerView3D-d73de16e.js","assets/BuildingGroupSublayer-522341d3.js","assets/BuildingComponentSublayer-717cff30.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/diffUtils-149561ab.js","assets/colorRamps-5cc134e8.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/FeatureLayer-1b9cadb4.js","assets/MultiOriginJSONSupport-d8471874.js","assets/sql-6b2d38b4.js","assets/FeatureLayerBase-eb1910ef.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/AttachmentQuery-ec55429b.js","assets/Query-02316d46.js","assets/RelationshipQuery-7bc28ffc.js","assets/serviceCapabilitiesUtils-daf60906.js","assets/editsZScale-d39634ea.js","assets/queryZScale-a900b0db.js","assets/FeatureSet-b4c3ebab.js","assets/APIKeyMixin-4e2720f9.js","assets/ArcGISService-60eebca2.js","assets/BlendLayer-6b704ca4.js","assets/jsonUtils-5b32189b.js","assets/CustomParametersMixin-238bf6a3.js","assets/EditBusLayer-f0fa7c71.js","assets/FeatureReductionLayer-1b796ac3.js","assets/FeatureEffect-2095f3f9.js","assets/FeatureFilter-ee8bfdef.js","assets/labelingInfo-59a7cf3b.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/OperationalLayer-abee1819.js","assets/OrderedLayer-d05fc281.js","assets/PortalLayer-9cdb0d77.js","assets/portalItemUtils-3c9a4460.js","assets/ScaleRangeLayer-4ea69c96.js","assets/TemporalLayer-bcd2e667.js","assets/FeatureTemplate-7817a164.js","assets/FeatureType-ef13726a.js","assets/fieldProperties-4d9f93fc.js","assets/versionUtils-dd7c16a5.js","assets/styleUtils-c09586c0.js","assets/TopFeaturesQuery-78393f5a.js","assets/popupUtils-30b722d9.js","assets/capabilities-c13ec1a4.js","assets/I3SIndexInfo-6f803979.js","assets/I3SLayerDefinitions-8b982943.js","assets/I3SUtil-255530b6.js","assets/I3SBinaryReader-e6f3c30e.js","assets/popupUtils-af5ad903.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/I3SMeshView3D-cb4bf241.js","assets/I3SOverrides-416d62d8.js","assets/I3SNode-8036f288.js","assets/RenderTexture-fb0e3709.js","assets/meshFeatureSet-733d074b.js","assets/georeference-fc071834.js","assets/External-12af36db.js","assets/infoFor3D-5881142c.js","assets/FeatureLayerView3D-9092aed7.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/EventedSet-af67fc30.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/SceneModification-f161a7eb.js","assets/persistable-f5746569.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-ea46dd67.js","assets/SceneLayerWorker-bcf78eda.js","assets/I3SQueryFeatureStore-730a7092.js","assets/DefinitionExpressionSceneLayerView-60fa2b73.js"]),csv:()=>he(()=>import("./CSVLayerView3D-727e458b.js"),["assets/CSVLayerView3D-727e458b.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/Query-02316d46.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/FeatureFilter-ee8bfdef.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/EventedSet-af67fc30.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/FeatureEffect-2095f3f9.js","assets/jsonUtils-5b32189b.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js"]),dimension:()=>he(()=>import("./DimensionLayerView3D-c8019f9d.js"),["assets/DimensionLayerView3D-c8019f9d.js","assets/LayerView3D-93dbb0dd.js","assets/LayerView-923813e2.js"]),elevation:uq,feature:()=>he(()=>import("./FeatureLayerView3D-9092aed7.js"),["assets/FeatureLayerView3D-9092aed7.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/Query-02316d46.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/FeatureFilter-ee8bfdef.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/EventedSet-af67fc30.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/FeatureEffect-2095f3f9.js","assets/jsonUtils-5b32189b.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js"]),geojson:()=>he(()=>import("./GeoJSONLayerView3D-e250dd19.js"),["assets/GeoJSONLayerView3D-e250dd19.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/Query-02316d46.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/FeatureFilter-ee8bfdef.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/EventedSet-af67fc30.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/FeatureEffect-2095f3f9.js","assets/jsonUtils-5b32189b.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js"]),graphics:()=>he(()=>import("./GraphicsLayerView3D-c6c45e5e.js"),["assets/GraphicsLayerView3D-c6c45e5e.js","assets/LayerView3D-93dbb0dd.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/GraphicsProcessor-5c0bb4fd.js","assets/diffUtils-149561ab.js","assets/Query-02316d46.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView-923813e2.js"]),group:()=>he(()=>import("./GroupLayerView-7cf37d3b.js"),["assets/GroupLayerView-7cf37d3b.js","assets/LayerView-923813e2.js"]),imagery:()=>he(()=>import("./ImageryLayerView3D-de8cf89c.js"),["assets/ImageryLayerView3D-de8cf89c.js","assets/DynamicLayerView3D-49117113.js","assets/LayerView3D-93dbb0dd.js","assets/projectExtentUtils-7b3ec1cc.js","assets/ImageMaterial-be81a34f.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/Query-02316d46.js","assets/popupUtils-af5ad903.js"]),"integrated-mesh":()=>he(()=>import("./IntegratedMeshLayerView3D-0e3fe197.js"),["assets/IntegratedMeshLayerView3D-0e3fe197.js","assets/I3SMeshView3D-cb4bf241.js","assets/I3SOverrides-416d62d8.js","assets/I3SNode-8036f288.js","assets/I3SUtil-255530b6.js","assets/Query-02316d46.js","assets/I3SBinaryReader-e6f3c30e.js","assets/RenderTexture-fb0e3709.js","assets/meshFeatureSet-733d074b.js","assets/georeference-fc071834.js","assets/External-12af36db.js","assets/infoFor3D-5881142c.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureLayerView3D-9092aed7.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/FeatureFilter-ee8bfdef.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/EventedSet-af67fc30.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/FeatureEffect-2095f3f9.js","assets/jsonUtils-5b32189b.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/SceneModification-f161a7eb.js","assets/persistable-f5746569.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-ea46dd67.js","assets/SceneLayerWorker-bcf78eda.js"]),"line-of-sight":()=>he(()=>import("./LineOfSightLayerView3D-533de88e.js"),["assets/LineOfSightLayerView3D-533de88e.js","assets/LayerView3D-93dbb0dd.js","assets/LayerView-923813e2.js"]),"map-image":()=>he(()=>import("./MapImageLayerView3D-840392c2.js"),["assets/MapImageLayerView3D-840392c2.js","assets/DynamicLayerView3D-49117113.js","assets/LayerView3D-93dbb0dd.js","assets/projectExtentUtils-7b3ec1cc.js","assets/ImageMaterial-be81a34f.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/ExportImageParameters-a9b99bad.js","assets/sql-6b2d38b4.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-3b57766e.js","assets/MapServiceLayerViewHelper-fc30f6cf.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/popupUtils-af5ad903.js","assets/drapedUtils-9ea64187.js"]),media:()=>he(()=>import("./MediaLayerView3D-761cdbcd.js"),["assets/MediaLayerView3D-761cdbcd.js","assets/MediaElementView-3bb86dc9.js","assets/normalizeUtilsSync-4e86052e.js","assets/normalizeUtilsCommon-6017271d.js","assets/LayerView3D-93dbb0dd.js","assets/ImageMaterial-be81a34f.js","assets/LayerView-923813e2.js"]),"ogc-feature":()=>he(()=>import("./OGCFeatureLayerView3D-9adea548.js"),["assets/OGCFeatureLayerView3D-9adea548.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/Query-02316d46.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/FeatureFilter-ee8bfdef.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/EventedSet-af67fc30.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/FeatureEffect-2095f3f9.js","assets/jsonUtils-5b32189b.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js"]),"open-street-map":V2,"oriented-imagery":()=>he(()=>import("./FeatureLayerView3D-9092aed7.js"),["assets/FeatureLayerView3D-9092aed7.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/Query-02316d46.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/FeatureFilter-ee8bfdef.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/EventedSet-af67fc30.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/FeatureEffect-2095f3f9.js","assets/jsonUtils-5b32189b.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js"]),"point-cloud":()=>he(()=>import("./PointCloudLayerView3D-7e52504f.js").then(t=>t.P),["assets/PointCloudLayerView3D-7e52504f.js","assets/LayerView3D-93dbb0dd.js","assets/I3SUtil-255530b6.js","assets/Query-02316d46.js","assets/I3SBinaryReader-e6f3c30e.js","assets/PointCloudWorkerUtil-af44c128.js","assets/PointCloudUniqueValueRenderer-cf07861e.js","assets/ColorStop-c9dfec3d.js","assets/PopupSceneLayerView-10349169.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js"]),voxel:()=>he(()=>import("./VoxelLayerView3D-e4ce7c20.js"),["assets/VoxelLayerView3D-e4ce7c20.js","assets/LayerView3D-93dbb0dd.js","assets/PopupSceneLayerView-10349169.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js"]),route:()=>he(()=>import("./RouteLayerView3D-68b03369.js"),["assets/RouteLayerView3D-68b03369.js","assets/Stop-f01d4bba.js","assets/LayerView3D-93dbb0dd.js","assets/GraphicsProcessor-5c0bb4fd.js","assets/diffUtils-149561ab.js","assets/Query-02316d46.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/projectExtentUtils-7b3ec1cc.js","assets/EventedSet-af67fc30.js","assets/LayerView-923813e2.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?he(()=>import("./SceneLayerView3D-ff198924.js"),["assets/SceneLayerView3D-ff198924.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/FeatureFilter-ee8bfdef.js","assets/Query-02316d46.js","assets/floorFilterUtils-080a7cd2.js","assets/I3SMeshView3D-cb4bf241.js","assets/I3SOverrides-416d62d8.js","assets/I3SNode-8036f288.js","assets/I3SUtil-255530b6.js","assets/I3SBinaryReader-e6f3c30e.js","assets/RenderTexture-fb0e3709.js","assets/meshFeatureSet-733d074b.js","assets/georeference-fc071834.js","assets/External-12af36db.js","assets/infoFor3D-5881142c.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureLayerView3D-9092aed7.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/EventedSet-af67fc30.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/FeatureEffect-2095f3f9.js","assets/jsonUtils-5b32189b.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/SceneModification-f161a7eb.js","assets/persistable-f5746569.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-ea46dd67.js","assets/SceneLayerWorker-bcf78eda.js","assets/SceneLayerView-2f58f654.js","assets/DefinitionExpressionSceneLayerView-60fa2b73.js","assets/I3SQueryFeatureStore-730a7092.js","assets/PopupSceneLayerView-10349169.js"]):he(()=>import("./SceneLayerGraphicsView3D-bb5ca57d.js"),["assets/SceneLayerGraphicsView3D-bb5ca57d.js","assets/I3SOverrides-416d62d8.js","assets/I3SNode-8036f288.js","assets/I3SUtil-255530b6.js","assets/Query-02316d46.js","assets/I3SBinaryReader-e6f3c30e.js","assets/RenderTexture-fb0e3709.js","assets/meshFeatureSet-733d074b.js","assets/georeference-fc071834.js","assets/External-12af36db.js","assets/infoFor3D-5881142c.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureLayerView3D-9092aed7.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/FeatureFilter-ee8bfdef.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/EventedSet-af67fc30.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/FeatureEffect-2095f3f9.js","assets/jsonUtils-5b32189b.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/SceneLayerView-2f58f654.js","assets/DefinitionExpressionSceneLayerView-60fa2b73.js","assets/PopupSceneLayerView-10349169.js"]),stream:()=>he(()=>import("./StreamLayerView3D-c6ea201e.js"),["assets/StreamLayerView3D-c6ea201e.js","assets/StreamFeatureManager-019f710c.js","assets/createConnection-00c95ac2.js","assets/query-2ef7b393.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/Query-02316d46.js","assets/EventedSet-af67fc30.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/FeatureFilter-ee8bfdef.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/LayerView-923813e2.js"]),tile:V2,"imagery-tile":()=>he(()=>import("./ImageryTileLayerView3D-3a8d04e3.js"),["assets/ImageryTileLayerView3D-3a8d04e3.js","assets/LayerView3D-93dbb0dd.js","assets/TiledLayerView3D-078c22f4.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/rasterProjectionHelper-aacc5bb4.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/drapedUtils-9ea64187.js"]),"vector-tile":()=>he(()=>import("./VectorTileLayerView3D-f573d703.js"),["assets/VectorTileLayerView3D-f573d703.js","assets/Rect-98da58d6.js","assets/pbf-94fe703e.js","assets/rasterizingUtils-ae6c4413.js","assets/StyleRepository-1e02df5b.js","assets/enums-9bbe4bf0.js","assets/colorUtils-c0f43caf.js","assets/TileClipper-ae6eca9e.js","assets/TileInfoView-53e9727d.js","assets/number-954e4ab6.js","assets/GeometryUtils-0258f920.js","assets/LayerView3D-93dbb0dd.js","assets/TiledLayerView3D-078c22f4.js","assets/LayerView-923813e2.js"]),wcs:()=>he(()=>import("./ImageryTileLayerView3D-3a8d04e3.js"),["assets/ImageryTileLayerView3D-3a8d04e3.js","assets/LayerView3D-93dbb0dd.js","assets/TiledLayerView3D-078c22f4.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/rasterProjectionHelper-aacc5bb4.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/drapedUtils-9ea64187.js"]),"web-tile":V2,wfs:()=>he(()=>import("./WFSLayerView3D-2d8d851e.js"),["assets/WFSLayerView3D-2d8d851e.js","assets/FeatureLayerViewBase3D-1e0f49bf.js","assets/FeatureLikeLayerView3D-a7fe98a3.js","assets/Query-02316d46.js","assets/dehydratedFeatureComparison-9b093626.js","assets/queryForSymbologySnapping-ac08536a.js","assets/elevationInfoUtils-77250170.js","assets/hash-6f442295.js","assets/diffUtils-149561ab.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js","assets/FeatureFilter-ee8bfdef.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-059f149f.js","assets/normalizeUtils-4068a3de.js","assets/normalizeUtilsCommon-6017271d.js","assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bcda6eea.js","assets/generateRendererUtils-9b13adb9.js","assets/FeatureSet-b4c3ebab.js","assets/FeatureStore-f7e2c654.js","assets/BoundsStore-0665b530.js","assets/projectExtentUtils-7b3ec1cc.js","assets/LayerView3D-93dbb0dd.js","assets/query-2ef7b393.js","assets/pbfQueryUtils-90f86c54.js","assets/pbf-94fe703e.js","assets/queryZScale-a900b0db.js","assets/EventedSet-af67fc30.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/FeatureEffect-2095f3f9.js","assets/jsonUtils-5b32189b.js","assets/popupUtils-af5ad903.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js"]),wms:()=>he(()=>import("./WMSLayerView3D-44c11379.js"),["assets/WMSLayerView3D-44c11379.js","assets/DynamicLayerView3D-49117113.js","assets/LayerView3D-93dbb0dd.js","assets/projectExtentUtils-7b3ec1cc.js","assets/ImageMaterial-be81a34f.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/ExportWMSImageParameters-5d939278.js"]),wmts:()=>he(()=>import("./WMTSLayerView3D-d9c26891.js"),["assets/WMTSLayerView3D-d9c26891.js","assets/LayerView3D-93dbb0dd.js","assets/TiledLayerView3D-078c22f4.js","assets/LayerView-923813e2.js","assets/RefreshableLayerView-a8bd5216.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function HMe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new X(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const dq={hasLayerViewModule:t=>hq[t.type]!=null,importLayerView:t=>{const e=hq[t.type];if(e==null)throw HMe(t);return e(t)}},pq="analyses-owner-handles";var pw,U_;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(pw||(pw={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(U_||(U_={}));let p_=class extends tC{constructor(e){super(e),this._allAnalysisViews=new er,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=fq(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(wr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(wr()),this._attachedToViewResolver=fq()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===U_.REMOVED)throw new X("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),pq)}_disconnectOwners(){this.handles.remove(pq),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const r=e.on("after-add",s=>this._addAnalysis(s.item)),i=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{r.remove(),i.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:pw.PENDING,list:U_.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=Zx(s=>this._createAnalysisViewPromise(i,s))}else r.state.list=U_.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=U_.REMOVED,this._scheduleUpdate()):ne.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=WC(()=>this._update()))}_update(){this._scheduledUpdateHandle=bi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===U_.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case pw.PENDING:e.createAnalysisViewTask=yc(e.createAnalysisViewTask);break;case pw.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Oe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,s=i.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(Js(r))throw this._creatingViewCount-=1,wr("AnalysisView creation aborted");const o=new n.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Js(r))throw this._creatingViewCount-=1,o.destroy(),wr("AnalysisView creation aborted");return e.view=o,e.state.view=pw.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return he(()=>import("./AreaMeasurementAnalysisView3D-8e1966b1.js").then(r=>r.A),["assets/AreaMeasurementAnalysisView3D-8e1966b1.js","assets/UnitNormalizer-f7f273c1.js","assets/Segment-1413661a.js","assets/unitFormatUtils-233032b0.js","assets/LineVisualElement-db91c665.js","assets/elevationInfoUtils-77250170.js","assets/geometryEngine-cfc072f3.js","assets/geometryEngineBase-4f4260d8.js","assets/hydrated-82b0583a.js","assets/EditGeometryOperations-31ebd7de.js"]);case"dimension":return he(()=>import("./DimensionAnalysisView3D-266d967a.js").then(r=>r.D),["assets/DimensionAnalysisView3D-266d967a.js","assets/LineVisualElement-db91c665.js","assets/LengthDimension-1fe5a076.js","assets/Segment-1413661a.js","assets/unitFormatUtils-233032b0.js","assets/elevationInfoUtils-77250170.js","assets/analysisViewUtils-c120a7c9.js","assets/ImageMaterial-be81a34f.js","assets/Factory-71ec2c06.js","assets/RightAngleQuadVisualElement-62adb2cd.js","assets/VisualElementResources-0bc87c86.js","assets/PointVisualElement-df95dd99.js","assets/colorUtils-c0f43caf.js","assets/EditGeometryOperations-31ebd7de.js","assets/dehydratedFeatureComparison-9b093626.js","assets/RenderTexture-fb0e3709.js"]);case"direct-line-measurement":return he(()=>import("./DirectLineMeasurementAnalysisView3D-8c7fc0e1.js").then(r=>r.D),["assets/DirectLineMeasurementAnalysisView3D-8c7fc0e1.js","assets/UnitNormalizer-f7f273c1.js","assets/Segment-1413661a.js","assets/unitFormatUtils-233032b0.js","assets/LineVisualElement-db91c665.js","assets/elevationInfoUtils-77250170.js","assets/geometryEngine-cfc072f3.js","assets/geometryEngineBase-4f4260d8.js","assets/hydrated-82b0583a.js","assets/RightAngleQuadVisualElement-62adb2cd.js","assets/VisualElementResources-0bc87c86.js"]);case"line-of-sight":return he(()=>import("./LineOfSightAnalysisView3D-e500952e.js"),["assets/LineOfSightAnalysisView3D-e500952e.js","assets/LineVisualElement-db91c665.js","assets/LineOfSightAnalysisTarget-9571da7c.js","assets/persistable-f5746569.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-ea46dd67.js","assets/ElevationInfo-568c6f07.js","assets/elevationInfoUtils-77250170.js","assets/analysisViewUtils-c120a7c9.js","assets/ImageMaterial-be81a34f.js","assets/PointVisualElement-df95dd99.js","assets/VisualElementResources-0bc87c86.js"]);case"slice":return he(()=>import("./SliceAnalysisView3D-d8dea38e.js").then(r=>r.S),["assets/SliceAnalysisView3D-d8dea38e.js","assets/LineVisualElement-db91c665.js","assets/persistable-f5746569.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-ea46dd67.js","assets/BuildingComponentSublayer-717cff30.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/diffUtils-149561ab.js","assets/colorRamps-5cc134e8.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/FeatureLayer-1b9cadb4.js","assets/MultiOriginJSONSupport-d8471874.js","assets/sql-6b2d38b4.js","assets/FeatureLayerBase-eb1910ef.js","assets/commonProperties-4511a72e.js","assets/ElevationInfo-568c6f07.js","assets/AttachmentQuery-ec55429b.js","assets/Query-02316d46.js","assets/RelationshipQuery-7bc28ffc.js","assets/serviceCapabilitiesUtils-daf60906.js","assets/editsZScale-d39634ea.js","assets/queryZScale-a900b0db.js","assets/FeatureSet-b4c3ebab.js","assets/APIKeyMixin-4e2720f9.js","assets/ArcGISService-60eebca2.js","assets/BlendLayer-6b704ca4.js","assets/jsonUtils-5b32189b.js","assets/CustomParametersMixin-238bf6a3.js","assets/EditBusLayer-f0fa7c71.js","assets/FeatureReductionLayer-1b796ac3.js","assets/FeatureEffect-2095f3f9.js","assets/FeatureFilter-ee8bfdef.js","assets/labelingInfo-59a7cf3b.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/OperationalLayer-abee1819.js","assets/OrderedLayer-d05fc281.js","assets/PortalLayer-9cdb0d77.js","assets/portalItemUtils-3c9a4460.js","assets/ScaleRangeLayer-4ea69c96.js","assets/TemporalLayer-bcd2e667.js","assets/FeatureTemplate-7817a164.js","assets/FeatureType-ef13726a.js","assets/fieldProperties-4d9f93fc.js","assets/versionUtils-dd7c16a5.js","assets/styleUtils-c09586c0.js","assets/TopFeaturesQuery-78393f5a.js","assets/popupUtils-30b722d9.js","assets/capabilities-c13ec1a4.js","assets/I3SIndexInfo-6f803979.js","assets/I3SLayerDefinitions-8b982943.js","assets/I3SUtil-255530b6.js","assets/I3SBinaryReader-e6f3c30e.js","assets/popupUtils-af5ad903.js","assets/analysisViewUtils-c120a7c9.js","assets/ImageMaterial-be81a34f.js","assets/Factory-71ec2c06.js"])}}};function fq(){const t=vo();return t.promise.catch(()=>{}),t}h([f()],p_.prototype,"updating",null),h([f({constructOnly:!0})],p_.prototype,"view",void 0),h([f()],p_.prototype,"_allAnalysisViews",void 0),h([f()],p_.prototype,"_creatingViewCount",void 0),p_=h([F("esri.views.3d.analysis.AnalysisViewManager3D")],p_);const WMe=p_;let vf=class extends we{constructor(e){super(e),this.collision=new dS,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Re.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Re.Local?this._set("altitude",e):ne.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?me(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return me(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Re.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=UN)=>(i.min=no.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?cP([[4e3,no.max],[1e4,At(88)],[6e6,At(88)]]):()=>no.max;return(r,i=UN)=>(i.min=no.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?cP([[4e3,no.max],[5e4,At(88)],[6e6,At(88)],[2e7,no.min]]):cP([[3e5,no.max],[3e6,At(88)],[6e6,At(88)],[2e7,no.min]]);return(r,i=UN)=>(i.min=no.min,i.max=e(r),i)}};function qMe(t){return{min:-2e5,max:4*t.radius}}h([f()],vf.prototype,"altitude",null),h([f({readOnly:!0})],vf.prototype,"collision",void 0),h([f()],vf.prototype,"distance",void 0),h([f({readOnly:!0})],vf.prototype,"minimumPoiDistance",void 0),h([f()],vf.prototype,"tilt",void 0),h([f({constructOnly:!0})],vf.prototype,"mode",void 0),vf=h([F("esri.views.3d.state.Constraints")],vf);const mq=qMe(Yt),no={min:At(.5),max:At(179.5)},UN={min:0,max:0};let dS=class extends we{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([f({type:Boolean})],dS.prototype,"enabled",void 0),h([f({type:Number})],dS.prototype,"elevationMargin",void 0),dS=h([F("esri.views.3d.state.Constraints.CollisionConstraint")],dS);let fw=class extends we{constructor(){super(...arguments),this.min=mq.min,this.max=mq.max}};h([f({type:Number})],fw.prototype,"min",void 0),h([f({type:Number})],fw.prototype,"max",void 0),fw=h([F("esri.views.3d.constraints.AltitudeConstraint")],fw);let Cf=class extends we{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};h([f({type:Number,value:1e-8})],Cf.prototype,"near",null),h([Gi("near")],Cf.prototype,"castNear",null),h([f({type:Number,value:1e-8})],Cf.prototype,"far",null),h([Gi("far")],Cf.prototype,"castFar",null),h([f({type:["auto","manual"]})],Cf.prototype,"mode",void 0),Cf=h([F("esri.views.3d.constraints.ClipDistanceConstraint")],Cf);const n8={min:pa(no.min),max:pa(no.max)};let z_=class extends we{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return me(e,n8.min,n8.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([f({type:["auto","manual"]})],z_.prototype,"mode",void 0),h([f({type:Number,value:n8.max})],z_.prototype,"max",null),h([Gi("max")],z_.prototype,"castMax",null),z_=h([F("esri.views.3d.constraints.TiltConstraint")],z_);let k_=class extends we{constructor(){super(...arguments),this.tilt=new z_,this.altitude=new fw,this.clipDistance=new Cf}};h([f({type:z_})],k_.prototype,"tilt",void 0),h([f({type:fw})],k_.prototype,"altitude",void 0),h([f({type:Cf})],k_.prototype,"clipDistance",void 0),k_=h([F("esri.views.3d.constraints.Constraints")],k_);var o8;let Yc=o8=class extends Ke{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new o8(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};h([f({readOnly:!0,type:["sun"],json:{write:!0}})],Yc.prototype,"type",void 0),h([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],Yc.prototype,"date",void 0),h([Ur("date",["datetime"])],Yc.prototype,"readDate",null),h([qr("date")],Yc.prototype,"writeDate",null),h([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Yc.prototype,"directShadowsEnabled",void 0),h([Ur("directShadowsEnabled",["directShadows"])],Yc.prototype,"readDirectShadowsEnabled",null),h([qr("directShadowsEnabled")],Yc.prototype,"writedirectShadowsEnabled",null),h([f({type:Number,json:{write:!0}})],Yc.prototype,"displayUTCOffset",void 0),h([qr("displayUTCOffset")],Yc.prototype,"writeDisplayUTCOffset",null),Yc=o8=h([F("esri.webscene.SunLighting")],Yc);const lC=Yc;var Nb;const xle="esri.views.3d.environment.SunLighting",T3=ne.getLogger(xle);let Vd=Nb=class extends ys.EventedMixin(lC){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return ap(T3,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){ap(T3,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return ap(T3,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){ap(T3,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new Nb(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=Nb.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=Nb.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(S3.target=this,S3.timezoneOffset=s,this.emit("timezone-will-change",S3),S3.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new Nb({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],Vd.prototype,"cameraTrackingEnabled",void 0),h([f({type:Boolean})],Vd.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],Vd.prototype,"waterReflectionEnabled",null),h([f({type:Date})],Vd.prototype,"defaultDate",null),h([f({type:Date})],Vd.prototype,"date",null),Vd=Nb=h([F(xle)],Vd),function(t){function e({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}t.calculateTimezoneOffset=e}(Vd||(Vd={}));const S3={target:null,timezoneOffset:0},Ng=Vd;var a8;let pS=a8=class extends Ke{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new a8(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};h([f({readOnly:!0,type:["virtual"],json:{write:!0}})],pS.prototype,"type",void 0),h([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],pS.prototype,"directShadowsEnabled",void 0),pS=a8=h([F("esri.webscene.VirtualLighting")],pS);const ML=pS;var fP;const Tle="esri.views.3d.environment.VirtualLighting",E3=ne.getLogger(Tle);let Fb=fP=class extends ys.EventedMixin(ML){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return ap(E3,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){ap(E3,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return ap(E3,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){ap(E3,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new fP({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new fP(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],Fb.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],Fb.prototype,"waterReflectionEnabled",null),h([f({type:Boolean})],Fb.prototype,"cameraTrackingEnabled",void 0),Fb=fP=h([F(Tle)],Fb);const fS=Fb,YMe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Ng,virtual:fS}};var l8;let cE=l8=class extends we{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new l8({quality:this.quality})}};h([f({type:["low","high"],value:"low"})],cE.prototype,"quality",null),cE=l8=h([F("esri.views.3d.environment.SceneViewAtmosphere")],cE);var c8;let mS=c8=class extends Ke{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new c8({cloudCover:this.cloudCover})}};h([Kt({sunny:"sunny"})],mS.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],mS.prototype,"cloudCover",void 0),mS=c8=h([F("esri.views.3d.environment.SunnyWeather")],mS);const u8=mS;var h8;let gS=h8=class extends Ke{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new h8({cloudCover:this.cloudCover})}};h([Kt({cloudy:"cloudy"})],gS.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],gS.prototype,"cloudCover",void 0),gS=h8=h([F("esri.views.3d.environment.CloudyWeather")],gS);const XMe=gS;var d8;let yS=d8=class extends Ke{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new d8({fogStrength:this.fogStrength})}};h([Kt({foggy:"foggy"})],yS.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],yS.prototype,"fogStrength",void 0),yS=d8=h([F("esri.views.3d.environment.FoggyWeather")],yS);const ZMe=yS;var p8;let Ub=p8=class extends Ke{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new p8({cloudCover:this.cloudCover,precipitation:this.precipitation})}};h([Kt({rainy:"rainy"})],Ub.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ub.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ub.prototype,"precipitation",void 0),Ub=p8=h([F("esri.views.3d.environment.RainyWeather")],Ub);const JMe=Ub;var f8;let f_=f8=class extends Ke{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new f8({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};h([Kt({snowy:"snowy"})],f_.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f_.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f_.prototype,"precipitation",void 0),h([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],f_.prototype,"snowCover",void 0),f_=f8=h([F("esri.views.3d.environment.SnowyWeather")],f_);const QMe=f_,Sle={key:"type",base:u8,typeMap:{sunny:u8,cloudy:XMe,rainy:JMe,snowy:QMe,foggy:ZMe}},KMe=Object.keys(Sle.typeMap);function e$e(t,e){return!!KMe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const Kd=1e4,t$e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:lC,virtual:ML}};let mP=class extends Ke{constructor(e){super(e)}clone(){}};h([f({readOnly:!0,json:{read:!1}})],mP.prototype,"type",void 0),mP=h([F("esri.webscene.background.Background")],mP);const Ele=mP;var m8;const r$e={...gm,nonNullable:!0};let _S=m8=class extends Ele{constructor(t){super(t),this.type="color",this.color=new ht([0,0,0,1])}clone(){return new m8(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};h([Kt({color:"color"},{readOnly:!0})],_S.prototype,"type",void 0),h([f(r$e)],_S.prototype,"color",void 0),_S=m8=h([F("esri.webscene.background.ColorBackground")],_S);const Cle=_S,gq={base:Ele,key:"type",typeMap:{color:Cle}};function i$e(t){return(e,r,i)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,i),n}}}const s$e={types:gq,json:{read:i$e(gq),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var g8;const Ale="esri.webscene.Environment",n$e=ne.getLogger(Ale),yq=(t,e,r)=>({enabled:!r||!r.isPresentation});let Fg=g8=class extends Ke{constructor(t){super(t),this.lighting=new lC,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){e$e(t==null?void 0:t.type,n$e)&&this._set("weather",t)}clone(){return new g8(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?ML.prototype.clone.call(this.lighting):lC.prototype.clone.call(this.lighting),background:ye(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};h([f({types:t$e,nonNullable:!0,json:{write:!0}})],Fg.prototype,"lighting",void 0),h([f(s$e)],Fg.prototype,"background",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:yq}}})],Fg.prototype,"atmosphereEnabled",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:yq}}})],Fg.prototype,"starsEnabled",void 0),h([f({types:Sle,nonNullable:!0,json:{write:!0},value:new u8})],Fg.prototype,"weather",null),Fg=g8=h([F(Ale)],Fg);const Ole=Fg;var vS;let zb=vS=class extends Ole{constructor(t){super(t),this.atmosphere=new cE,this.lighting=new Ng,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new vS({...e,lighting:e.lighting?e.lighting.type==="virtual"?fS.fromWebsceneLighting(e.lighting):Ng.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,r;return t?t instanceof Ng||t instanceof fS?t:t instanceof lC?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Ng({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof ML?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new fS({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):R0(YMe,t):new Ng}clone(){return new vS({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background)})}cloneWithWebsceneEnvironment(t){return new vS({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Ng.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):fS.fromWebsceneLighting(t.lighting);default:return t.lighting,Ng.fromWebsceneLighting(t.lighting)}}};h([f({type:cE,json:{read:!1},nonNullable:!0})],zb.prototype,"atmosphere",void 0),h([f({nonNullable:!0})],zb.prototype,"lighting",void 0),h([Gi("lighting")],zb.prototype,"castLighting",null),zb=vS=h([F("esri.views.3d.environment.SceneViewEnvironment")],zb);const kb=zb;var Ro;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Ro||(Ro={}));function Vs(t,e){return t[0]=e[0],t[1]=e[1],t}function Qt(t,e,r){return t[0]=e,t[1]=r,t}function Ch(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function ip(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Rle(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Ple(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function o$e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function a$e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function l$e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function c$e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function u$e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Tl(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function h$e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function I1(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function n$(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function g7(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Mle(t){const e=t[0],r=t[1];return e*e+r*r}function y7(t,e){return t[0]=-e[0],t[1]=-e[1],t}function d$e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function cC(t,e){const r=e[0],i=e[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Is(t,e){return t[0]*e[0]+t[1]*e[1]}function p$e(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function au(t,e,r,i){const s=e[0],n=e[1];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t}function f$e(t,e){e=e||1;const r=2*XC()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function $le(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function m_(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function m$e(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function g$e(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}function y$e(t,e,r,i){const s=e[0]-r[0],n=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-n*o+r[0],t[1]=s*o+n*a+r[1],t}function _$e(t,e){const r=t[0],i=t[1],s=e[0],n=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function v$e(t){return"vec2("+t[0]+", "+t[1]+")"}function Ile(t,e){return t[0]===e[0]&&t[1]===e[1]}function Lle(t,e){const r=t[0],i=t[1],s=e[0],n=e[1],o=ma();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function b$e(t,e,r,i,s){let n=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const w$e=g7,x$e=ip,T$e=Rle,S$e=Ple,Dle=I1,E$e=n$,C$e=Mle;Object.freeze(Object.defineProperty({__proto__:null,add:Ch,angle:_$e,ceil:o$e,copy:Vs,cross:p$e,dist:Dle,distance:I1,div:S$e,divide:Ple,dot:Is,equals:Lle,exactEquals:Ile,floor:a$e,inverse:d$e,len:w$e,length:g7,lerp:au,max:c$e,min:l$e,mul:T$e,multiply:Rle,negate:y7,normalize:cC,projectAndScale:b$e,random:f$e,rotate:y$e,round:u$e,scale:Tl,scaleAndAdd:h$e,set:Qt,sqrDist:E$e,sqrLen:C$e,squaredDistance:n$,squaredLength:Mle,str:v$e,sub:x$e,subtract:ip,transformMat2:$le,transformMat2d:m_,transformMat3:m$e,transformMat4:g$e},Symbol.toStringTag,{value:"Module"}));function _7(t){return me((t-1e5)/(1e6-1e5),0,1)}const y8=1e4,A$e=.085,uE=1e5;let O$e=class{};const Ar=O$e;function b(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(b||(b={}));var S;(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(S||(S={}));var ps;function _p(t,e){switch(e.textureCoordinateType){case ps.Default:return t.attributes.add(S.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case ps.Compressed:return t.attributes.add(S.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case ps.Atlas:return t.attributes.add(S.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(S.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case ps.None:return void t.vertex.code.add(b`void forwardTextureCoordinates() {}`);case ps.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(ps||(ps={}));function Ll(t){t.code.add(b`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function xc(t){t.include(Ll),t.code.add(b`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function $L(t){t.fragment.code.add(b`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var zr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(zr||(zr={}));let Ji=class{constructor(e,r,i,s,n=null){this.name=e,this.type=r,this.arraySize=n,this.bind={[zr.Pass]:null,[zr.Draw]:null},i!=null&&s!=null&&(this.bind[i]=s)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Mt=class extends Ji{constructor(e,r){super(e,"vec3",zr.Pass,(i,s,n)=>i.setUniform3fv(e,r(s,n)))}};function vm(t){t.uniforms.add(new Mt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function Up(t){t.uniforms.add(new Mt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function o$(t){vm(t.fragment),Up(t.fragment),t.fragment.code.add(b`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let mr=class extends Ji{constructor(e,r){super(e,"vec2",zr.Pass,(i,s,n)=>i.setUniform2fv(e,r(s,n)))}},Wt=class extends Ji{constructor(e,r){super(e,"vec4",zr.Pass,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}},Se=class extends Ji{constructor(e,r){super(e,"float",zr.Pass,(i,s,n)=>i.setUniform1f(e,r(s,n)))}},wi=class extends Ji{constructor(e,r){super(e,"mat4",zr.Pass,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};const Ho=Ht();let R$e=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function He(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new R$e(`${e} at ${r}`)}}function Tv(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function _q(t,e,r,i){let s,n=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o)&&(u<o&&(o=u),!(o<0))}function C3(t,e,r,i,s,n=Ie()){const o=(i[s]-r[s])*(e[0]-t[0])-(i[0]-r[0])*(e[s]-t[s]),a=(i[0]-r[0])*(t[s]-r[s])-(i[s]-r[s])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function vq(t,e,r,i,s){Ho[0]=t[0],Ho[1]=t[1],Ho[2]=t[2],Ho[3]=1,uc(Ho,Ho,e),s.length>2&&(s[2]=-Ho[2]),uc(Ho,Ho,r),He(Ho[3]!==0),s[0]=Ho[0]/Ho[3],s[1]=Ho[1]/Ho[3],s[2]=Ho[2]/Ho[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function P$e(t,e){return Math.log(t)/Math.log(e)}function M$e(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function Nle(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Fle=ne.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let Ule=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){Fle.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))i[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${e[n]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},ur=class extends Ule{constructor(){super(...arguments),this.vertex=new bq,this.fragment=new bq,this.attributes=new L$e,this.varyings=new D$e,this.extensions=new _8,this.constants=new zle}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?F$e:N$e,c=this.constants.generateSource().concat(n.constants.generateSource());return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}},$$e=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new X(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Fle.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},I$e=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},bq=class extends Ule{constructor(){super(...arguments),this.uniforms=new $$e,this.code=new I$e,this.constants=new zle}get builder(){return this}},L$e=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},D$e=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&He(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,s)=>r.push(e==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),r}},_8=class v8{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?v8.ALLOWLIST_VERTEX:v8.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};_8.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],_8.ALLOWLIST_VERTEX=[];let zle=class Ms{constructor(){this._entries=new Set}add(e,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=Ms._numberToFloatStr(i);break;case"int":s=Ms._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${Ms._numberToFloatStr(i[0])},                            ${Ms._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${Ms._numberToFloatStr(i[0])},                            ${Ms._numberToFloatStr(i[1])},                            ${Ms._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${Ms._numberToFloatStr(i[0])},                            ${Ms._numberToFloatStr(i[1])},                            ${Ms._numberToFloatStr(i[2])},                            ${Ms._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${Ms._numberToIntStr(i[0])},                             ${Ms._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${Ms._numberToIntStr(i[0])},                             ${Ms._numberToIntStr(i[1])},                             ${Ms._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${Ms._numberToIntStr(i[0])},                             ${Ms._numberToIntStr(i[1])},                             ${Ms._numberToIntStr(i[2])},                             ${Ms._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>Ms._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const N$e=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,F$e=`precision highp float;
precision highp sampler2D;`;let We=class extends Ji{constructor(e,r){super(e,"sampler2D",zr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};const hE=Ce(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),zN=3,kN=Ce(zN*parseFloat(65e-8.toFixed(6)),zN*parseFloat(1881e-9.toFixed(6)),zN*parseFloat(85e-9.toFixed(6))),U$e=3996e-9,z$e=Ce(parseFloat(Number(hE[0]+kN[0]).toFixed(6)),parseFloat(Number(hE[1]+kN[1]).toFixed(6)),parseFloat(Number(hE[2]+kN[2]).toFixed(6)));function k$e(t){const e=new ur;e.attributes.add(S.POSITION,"vec2"),e.include(_p,{textureCoordinateType:ps.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new wi("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new wi("inverseViewMatrix",(s,n)=>a2(B$e,n.camera.viewMatrix))),r.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new mr("radii",s=>s.radii),new Mt("cameraPosition",(s,n)=>n.camera.eye),new Wt("heightParameters",s=>s.heightParameters),new Se("innerFadeDistance",s=>s.innerFadeDistance),new Se("altitudeFade",s=>s.altitudeFade),new We("depthTex",s=>s.depthTex),new Se("hazeStrength",s=>s.hazeStrength),new mr("renderScale",s=>s.renderScale)),i.constants.add("betaRayleigh","vec3",hE),i.constants.add("betaCombined","vec3",z$e),i.constants.add("betaMie","float",U$e),i.constants.add("scaleHeight","float",A$e*uE),vm(i),e.include($L),t.haze&&(i.include(xc),i.uniforms.add(new mr("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(b`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(b`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(b`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?b`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":b`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":b`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?b`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:b`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":b`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, scaleFract);

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = dot(rayDir, lightDir);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?b`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTex, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTex, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?b`
          vec4 depthSample = texture(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?b`cameraSpaceRay *= -textureBilinear(vuv0);`:b`cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:b`${t.reduced?"":b`
                float depthSample = texture(depthTex, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?b`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:b`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":b`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const B$e=xe(),V$e=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:hE,build:k$e},Symbol.toStringTag,{value:"Module"}));let dr=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var mi,vt,_e,Op,gt,Uh,wx,Ye,Br,is,wt,Ot,ji,Pt,ft,Cs,xs,hr,nc,Bn;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(mi||(mi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(vt||(vt={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(_e||(_e={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Op||(Op={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(gt||(gt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Uh||(Uh={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(wx||(wx={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Ye||(Ye={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Br||(Br={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(is||(is={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(wt||(wt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Ot||(Ot={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(ji||(ji={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Pt||(Pt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(ft||(ft={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Cs||(Cs={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(xs||(xs={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(hr||(hr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(nc||(nc={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Bn||(Bn={}));const BN=33984;var Ks,Ql;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(Ks||(Ks={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Ql||(Ql={}));const wq=33306;var Ki,xq,Tq,Sq,a$,b8,Eq;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Ki||(Ki={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(xq||(xq={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Tq||(Tq={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(Sq||(Sq={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(a$||(a$={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(b8||(b8={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Eq||(Eq={}));let gr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Ue(this._program),this._pipeline=this._configuration=null}reload(e){Ue(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return vt.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const cr=new Map([[S.POSITION,0],[S.NORMAL,1],[S.NORMALCOMPRESSED,1],[S.UV0,2],[S.COLOR,3],[S.COLORFEATUREATTRIBUTE,3],[S.SIZE,4],[S.TANGENT,4],[S.AUXPOS1,5],[S.SYMBOLCOLOR,5],[S.AUXPOS2,6],[S.FEATUREATTRIBUTE,6],[S.INSTANCEFEATUREATTRIBUTE,6],[S.INSTANCECOLOR,7],[S.OBJECTANDLAYERIDCOLOR,7],[S.INSTANCEOBJECTANDLAYERIDCOLOR,7],[S.MODEL,8],[S.MODELNORMAL,12],[S.MODELORIGINHI,11],[S.MODELORIGINLO,15]]),G$e=ne.getLogger("esri.views.webgl.checkWebGLError");function j$e(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const kle=!!ie("enable-feature:webgl-debug");function tu(){return kle}function w8(){return kle}function Pf(t){if(tu()){const e=t.getError();if(e){const r=j$e(t,e),i=new Error().stack;G$e.error(new X("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let pr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Nt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(zr.Pass,this),this.bindDraw=r.generateBind(zr.Draw,this),this._fragmentUniforms=tu()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(r==null||r.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var ti,L1,ts,Hf,ja,cm,xx,Fr,D1,Df;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(ti||(ti={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(L1||(L1={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(ts||(ts={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Hf||(Hf={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(ja||(ja={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(cm||(cm={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(xx||(xx={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Fr||(Fr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(D1||(D1={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(Df||(Df={}));function Il(t,e,r=Op.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Xn(t,e,r,i,s=Op.ADD,n=Op.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const v7={face:Uh.BACK,mode:wx.CCW},Ble={face:Uh.FRONT,mode:wx.CCW},IL=t=>t===ti.Back?v7:t===ti.Front?Ble:null,Ya={zNear:0,zFar:1},$t={r:!0,g:!0,b:!0,a:!0};function H$e(t){return K$e.intern(t)}function W$e(t){return eIe.intern(t)}function q$e(t){return tIe.intern(t)}function Y$e(t){return rIe.intern(t)}function X$e(t){return iIe.intern(t)}function Z$e(t){return sIe.intern(t)}function J$e(t){return nIe.intern(t)}function Q$e(t){return oIe.intern(t)}function xt(t){return aIe.intern(t)}let bm=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function wm(t){return"["+t.join(",")+"]"}const K$e=new bm(Vle,t=>({__tag:"Blending",...t}));function Vle(t){return t?wm([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const eIe=new bm(Gle,t=>({__tag:"Culling",...t}));function Gle(t){return t?wm([t.face,t.mode]):null}const tIe=new bm(jle,t=>({__tag:"PolygonOffset",...t}));function jle(t){return t?wm([t.factor,t.units]):null}const rIe=new bm(Hle,t=>({__tag:"DepthTest",...t}));function Hle(t){return t?wm([t.func]):null}const iIe=new bm(Wle,t=>({__tag:"StencilTest",...t}));function Wle(t){return t?wm([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const sIe=new bm(qle,t=>({__tag:"DepthWrite",...t}));function qle(t){return t?wm([t.zNear,t.zFar]):null}const nIe=new bm(Yle,t=>({__tag:"ColorWrite",...t}));function Yle(t){return t?wm([t.r,t.g,t.b,t.a]):null}const oIe=new bm(Xle,t=>({__tag:"StencilWrite",...t}));function Xle(t){return t?wm([t.mask]):null}const aIe=new bm(lIe,t=>({blending:H$e(t.blending),culling:W$e(t.culling),polygonOffset:q$e(t.polygonOffset),depthTest:Y$e(t.depthTest),stencilTest:X$e(t.stencilTest),depthWrite:Z$e(t.depthWrite),colorWrite:J$e(t.colorWrite),stencilWrite:Q$e(t.stencilWrite)}));function lIe(t){return t?wm([Vle(t.blending),Gle(t.culling),jle(t.polygonOffset),Hle(t.depthTest),Wle(t.stencilTest),qle(t.depthWrite),Yle(t.colorWrite),Xle(t.stencilWrite)]):null}let cIe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,s){return(i||e!==r)&&(s(e),this._pipelineInvalid=!0),e}},uIe=class extends Ar{constructor(){super(...arguments),this.heightParameters=Ht(),this.radii=Ie(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ie()}},bS=class Zle extends gr{initializeProgram(e){return new pr(e.rctx,Zle.shader.get().build(this.configuration),cr)}initializePipeline(){return this.configuration.reduced?xt({blending:Il(_e.ONE,_e.ZERO),depthTest:{func:Br.ALWAYS},colorWrite:$t}):this.configuration.haze?xt({blending:Xn(_e.ONE,_e.ZERO,_e.ONE_MINUS_SRC_COLOR,_e.ONE),colorWrite:$t}):xt({blending:Il(_e.ONE,_e.ONE_MINUS_SRC_ALPHA),depthTest:{func:Br.LEQUAL},colorWrite:$t})}};bS.shader=new dr(V$e,()=>he(()=>import("./ChapmanAtmosphere.glsl-ab7bf80d.js"),[]));let Bo=class extends Ar{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function D(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,r,{get(){return this[i]},set(u){if(this[i]!==u&&(this[i]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof u)}})}}}let l$=class extends Bo{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};h([D()],l$.prototype,"haze",void 0),h([D()],l$.prototype,"reduced",void 0);let qn=class{constructor(e,r,i,s,n,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new qn(S.POSITION,3,Ye.FLOAT,0,12);new qn(S.POSITION,3,Ye.FLOAT,0,20),new qn(S.UV0,2,Ye.FLOAT,12,20);new qn(S.POSITION,3,Ye.FLOAT,0,32),new qn(S.NORMAL,3,Ye.FLOAT,12,32),new qn(S.UV0,2,Ye.FLOAT,24,32);new qn(S.POSITION,3,Ye.FLOAT,0,16),new qn(S.COLOR,4,Ye.UNSIGNED_BYTE,12,16);const b7=[new qn(S.POSITION,2,Ye.FLOAT,0,8)],cA=[new qn(S.POSITION,2,Ye.FLOAT,0,16),new qn(S.UV0,2,Ye.FLOAT,8,16)];function Cq(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function co(t,e){return t.vertexBuffers[e].size/hIe(t.layout[e])}function hIe(t){return t[0].stride}function w7(t,e,r,i,s=0){const n=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)n.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)n.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function x7(t,e,r,i){const s=t.gl,n=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(gt.ARRAY_BUFFER)}function Jle(t){switch(t){case Pt.ALPHA:case Pt.LUMINANCE:case Pt.RED:case Pt.RED_INTEGER:case ft.R8:case ft.R8I:case ft.R8UI:case ft.R8_SNORM:case xs.STENCIL_INDEX8:return 1;case Pt.LUMINANCE_ALPHA:case Pt.RG:case Pt.RG_INTEGER:case ft.RGBA4:case ft.R16F:case ft.R16I:case ft.R16UI:case ft.RG8:case ft.RG8I:case ft.RG8UI:case ft.RG8_SNORM:case ft.RGB565:case ft.RGB5_A1:case xs.DEPTH_COMPONENT16:return 2;case Pt.DEPTH_COMPONENT:case Pt.RGB:case Pt.RGB_INTEGER:case ft.RGB8:case ft.RGB8I:case ft.RGB8UI:case ft.RGB8_SNORM:case ft.SRGB8:case xs.DEPTH_COMPONENT24:return 3;case Pt.DEPTH_STENCIL:case Pt.DEPTH24_STENCIL8:case Pt.RGBA:case Pt.RGBA_INTEGER:case ft.RGBA8:case ft.R32F:case ft.R11F_G11F_B10F:case ft.RG16F:case ft.R32I:case ft.R32UI:case ft.RG16I:case ft.RG16UI:case ft.RGBA8I:case ft.RGBA8UI:case ft.RGBA8_SNORM:case ft.SRGB8_ALPHA8:case ft.RGB9_E5:case ft.RGB10_A2UI:case ft.RGB10_A2:case xs.DEPTH_STENCIL:case xs.DEPTH_COMPONENT32F:case xs.DEPTH24_STENCIL8:return 4;case xs.DEPTH32F_STENCIL8:return 5;case ft.RGB16F:case ft.RGB16I:case ft.RGB16UI:return 6;case ft.RG32F:case ft.RG32I:case ft.RG32UI:case ft.RGBA16F:case ft.RGBA16I:case ft.RGBA16UI:return 8;case ft.RGB32F:case ft.RGB32I:case ft.RGB32UI:return 12;case ft.RGBA32F:case ft.RGBA32I:case ft.RGBA32UI:return 16;case Ki.COMPRESSED_RGB_S3TC_DXT1_EXT:case Ki.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Ki.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Ki.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Ki.COMPRESSED_R11_EAC:case Ki.COMPRESSED_SIGNED_R11_EAC:case Ki.COMPRESSED_RGB8_ETC2:case Ki.COMPRESSED_SRGB8_ETC2:case Ki.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Ki.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Ki.COMPRESSED_RG11_EAC:case Ki.COMPRESSED_SIGNED_RG11_EAC:case Ki.COMPRESSED_RGBA8_ETC2_EAC:case Ki.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function N1(t){if(t==null)return 0;if("descriptor"in t)return t.glName?N1(t.descriptor):0;const e=t.internalFormat||"pixelFormat"in t&&t.pixelFormat;if(!e)return 0;const r="hasMipmap"in t&&t.hasMipmap?1.3:1,i=t.width*t.height;return Jle(e)*i*r}const fy=ne.getLogger("esri.views.webgl.VertexArrayObject");let Iu=class{constructor(e,r,i,s,n=null){this._context=e,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(Ks.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].size,this._indexBuffer!=null?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){var r,i,s;if(!this._context)return void((this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&fy.warn("Leaked WebGL VAO"));if(this._glName){const n=(i=(r=this._context)==null?void 0:r.capabilities)==null?void 0:i.vao;n?(n.deleteVertexArray(this._glName),this._glName=null):fy.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const n in this._buffers)(s=this._buffers[n])==null||s.dispose(),delete this._buffers[n];this._indexBuffer=Ue(this._indexBuffer)}this._context.instanceCounter.decrement(Ks.VertexArrayObject,this),this._context=Wx(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||fy.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||fy.error("Vertex buffer is uninitialized!");const a=r[n];a||fy.error("Vertex element descriptor is empty!"),w7(this._context,this._locations,o,a)}i!=null&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||fy.error("Vertex buffer dictionary is empty!");for(const i in e){const s=e[i];s||fy.error("Vertex buffer is uninitialized!");const n=r[i];x7(this._context,this._locations,s,n)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},sd=class extends Iu{};var Jt;function x8(t,e,r={}){const i=e===Jt.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const s of i){const n=t.getContext(s,r);if(n)return n}return null}function dIe(t,e,r={}){const i=Qle(t);for(const s of i){const n=x8(e,s,r);if(n)return n}return null}function Qle(t){if(t==="3d")return[Jt.WEBGL2];const e=ie("esri-force-webgl");return e===Jt.WEBGL1||e===Jt.WEBGL2?[e]:ie("mac")&&ie("chrome")?[Jt.WEBGL1,Jt.WEBGL2]:[Jt.WEBGL2,Jt.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(Jt||(Jt={}));const pd=ne.getLogger("esri.views.webgl.BufferObject");let br=class Bb{static createIndex(e,r,i){return new Bb(e,gt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new Bb(e,gt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==Jt.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new Bb(e,gt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=hr.STREAM_READ,i){if(e.type!==Jt.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new Bb(e,gt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(e,r=hr.STREAM_DRAW,i){if(e.type!==Jt.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new Bb(e,gt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,s){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Ks.BufferObject,this),this._glName=this._context.gl.createBuffer(),Pf(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===gt.ELEMENT_ARRAY_BUFFER?this._indexType===Ye.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===gt.ELEMENT_ARRAY_BUFFER||this.bufferType===gt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Ks.BufferObject,this),this._context=Wx(this._context)):this._glName&&pd.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&pd.error("Buffer size needs to be positive!"),this.bufferType===gt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case Ye.UNSIGNED_SHORT:e*=2;break;case Ye.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===gt.ELEMENT_ARRAY_BUFFER&&(RI(e)&&(r/=2,this._indexType=Ye.UNSIGNED_SHORT),PI(e)&&(r/=4,this._indexType=Ye.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r!=null?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,e,this.usage),Pf(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,s){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteSize)&&pd.error("offset is out of range!"),i>=s&&pd.error("end must be bigger than start!"),(r+(s-i))*e.BYTES_PER_ELEMENT>this.byteSize&&pd.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===Jt.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,s-i);else{const a=i===0&&s===e.length?e:e.subarray(i,s);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}Pf(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,r=0,i,s){if(this._context.type!==Jt.WEBGL2)return void pd.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void pd.error("Problem getting subdata: offset and length were less than zero!");const n=pIe(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void pd.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.byteSize&&pd.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,gt.COPY_READ_BUFFER),o.getBufferSubData(gt.COPY_READ_BUFFER,r,e,i,s),this._context.unbindBuffer(gt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,s){this._context.type===Jt.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,s)):pd.error("Get buffer subdata is supported in WebGL2 only!")}};function pIe(t){return p1e(t)}let xr=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=ji.TEXTURE_2D,this.pixelFormat=Pt.RGBA,this.dataType=Cs.UNSIGNED_BYTE,this.samplingMode=wt.LINEAR,this.wrapMode=Ot.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}},fIe=class Kle extends xr{constructor(e,r){super(),this.context=e,Object.assign(this,r)}static validate(e,r){return new Kle(e,r)}};const Aq=4;let bt=class{constructor(e,r=null,i=null){if(this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const s=fIe.validate(e,r);if(!s)throw new X("Texture descriptor invalid");this._descriptor=s}if(this._descriptor.context.instanceCounter.increment(Ks.Texture,this),this._descriptor.context.type!==Jt.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),g_(this._descriptor.target)))throw new X("3D and array textures are not supported in WebGL1");this._descriptor.target===ji.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(Ks.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new X("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===ji.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=ji.TEXTURE_CUBE_MAP_POSITIVE_X;r<=ji.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._descriptor.context||!this._descriptor.context.gl)return;const i=this._descriptor.context.gl;Pf(i),this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const s=this._descriptor,n=r??s.target,o=g_(n);e===null&&(s.width=s.width||Aq,s.height=s.height||Aq,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,bt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(bt.TEXTURE_UNIT_FOR_UPDATES),VN(this._descriptor.context,s),this._configurePixelStorage(),Pf(i);const l=s.pixelFormat;let c=s.internalFormat??this._deriveInternalFormat(l,s.dataType);if(GN(e)){let u=e.width,d=e.height;const p=1;e instanceof HTMLVideoElement&&(u=e.videoWidth,d=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,u,d,p),this._texImage(n,0,c,u,d,p,e),Pf(i),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=u),s.height||(s.height=d),o&&!s.depth&&(s.depth=p)}else{const{width:u,height:d,depth:p}=s;if(u==null||d==null)throw new X("Width and height must be specified!");if(o&&p==null)throw new X("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,u,d,p),i.DEPTH24_STENCIL8&&c===i.DEPTH_STENCIL&&(c=i.DEPTH24_STENCIL8),gP(e)){const g=e.levels,y=Pq(n,u,d,p),_=Math.min(y-1,g.length-1);this._descriptor.context.gl2!=null?i.texParameteri(s.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,_):s.hasMipmap=s.hasMipmap&&y===g.length;const v=c;if(!yIe(v))throw new X("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((w,T,x,E)=>{const O=g[Math.min(w,g.length-1)];this._compressedTexImage(n,w,v,T,x,E,O)},_)}else e!=null?(this._texImage(n,0,c,u,d,p,e),Pf(i),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((g,y,_,v)=>{this._texImage(n,g,c,y,_,v,null),Pf(i)})}Oq(i,this._descriptor),Rq(i,this._descriptor),mIe(this._descriptor.context,this._descriptor),Pf(i),this._descriptor.context.bindTexture(a,bt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,u=this._descriptor,{pixelFormat:d,dataType:p,target:g,isImmutable:y}=u,_=u.internalFormat??this._deriveInternalFormat(d,p);if(y&&!this._wasImmutablyAllocated)throw new X("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,bt.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||s>u.width||n>u.height||r+s>u.width||i+n>u.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(GN(o)?c?c.texSubImage2D(g,e,r,i,s,n,d,p,o):l.texSubImage2D(g,e,r,i,d,p,o):gP(o)?l.compressedTexSubImage2D(g,e,r,i,s,n,_,o.levels[e]):l.texSubImage2D(g,e,r,i,s,n,d,p,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,bt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new X("3D textures are not supported in WebGL1");const u=this._descriptor,{pixelFormat:d,dataType:p,isImmutable:g,target:y}=u,_=u.internalFormat??this._deriveInternalFormat(d,p);if(g&&!this._wasImmutablyAllocated)throw new X("Cannot update immutable texture before allocation!");g_(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,bt.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(bt.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>u.width||o>u.height||a>u.depth||r+n>u.width||i+o>u.height||s+a>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),gP(l))l=l.levels[e],c.compressedTexSubImage3D(y,e,r,i,s,n,o,a,_,l);else{const w=l;c.texSubImage3D(y,e,r,i,s,n,o,a,d,p,w)}this._descriptor.context.bindTexture(v,bt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new X("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,VN(this._descriptor.context,e)}e.samplingMode===wt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=wt.LINEAR_MIPMAP_NEAREST):e.samplingMode===wt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=wt.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,bt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(bt.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,bt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,VN(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,r=this._descriptor;this._samplingModeDirty&&(Oq(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(Rq(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(e,r){if(this._descriptor.context.type===Jt.WEBGL1)return e;switch(r){case Cs.FLOAT:switch(e){case Pt.RGBA:return ft.RGBA32F;case Pt.RGB:return ft.RGB32F;default:throw new X("Unable to derive format")}case Cs.UNSIGNED_BYTE:switch(e){case Pt.RGBA:return ft.RGBA8;case Pt.RGB:return ft.RGB8}default:return e}}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,r,i,s,n,o){const a=this._descriptor.context.gl2;if(a==null)throw new X("Immutable textures are not supported in WebGL1");if(!gIe(r))throw new X("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?Pq(e,s,n,o):1;if(g_(e)){if(o==null)throw new X("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,s,n,o)}else a.texStorage2D(e,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl,c=g_(e),{isImmutable:u,pixelFormat:d,dataType:p}=this._descriptor,g=this._descriptor.context.type===Jt.WEBGL2,y=g?l:null;if(g||!GN(a))if(u){if(a!=null){const _=a;if(c){if(o==null)throw new X("Missing depth dimension for 3D texture upload");y.texSubImage3D(e,r,0,0,0,s,n,o,d,p,_)}else l.texSubImage2D(e,r,0,0,s,n,d,p,_)}}else{const _=a;if(c){if(o==null)throw new X("Missing depth dimension for 3D texture upload");y.texImage3D(e,r,i,s,n,o,0,d,p,_)}else l.texImage2D(e,r,i,s,n,0,d,p,_)}else l.texImage2D(e,0,i,d,p,a)}_compressedTexImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl;let c=null;const u=g_(e),d=this._descriptor.isImmutable;if(u){if(this._descriptor.context.type!==Jt.WEBGL2)throw new X("3D textures are not supported in WebGL1");c=l}if(d){if(a!=null)if(u){if(o==null)throw new X("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,s,n,i,a)}else if(u){if(o==null)throw new X("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,s,n,o,0,a)}else l.compressedTexImage2D(e,r,i,s,n,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===ji.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new X("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function VN(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=t.type===Jt.WEBGL2;r||!e.isImmutable&&!g_(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(e.width!=null&&T1(e.width)&&e.height!=null&&T1(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Ot.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Ot.CLAMP_TO_EDGE&&e.wrapMode.t===Ot.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function Oq(t,e){let r=e.samplingMode,i=e.samplingMode;r===wt.LINEAR_MIPMAP_NEAREST||r===wt.LINEAR_MIPMAP_LINEAR?(r=wt.LINEAR,e.hasMipmap||(i=wt.LINEAR)):r!==wt.NEAREST_MIPMAP_NEAREST&&r!==wt.NEAREST_MIPMAP_LINEAR||(r=wt.NEAREST,e.hasMipmap||(i=wt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function Rq(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function mIe(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function gIe(t){return t in ft}function yIe(t){return t in Ki}function gP(t){return t!=null&&"type"in t&&t.type==="compressed"}function _Ie(t){return t!=null&&"byteLength"in t}function GN(t){return t!=null&&!gP(t)&&!_Ie(t)}function g_(t){return t===ji.TEXTURE_3D||t===ji.TEXTURE_2D_ARRAY}function Pq(t,e,r,i=1){let s=Math.max(e,r);return t===ji.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}bt.TEXTURE_UNIT_FOR_UPDATES=0;function Xa(t,e=b7,r=cr,i=-1,s=1){let n=null;return e===cA?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new sd(t,r,{geometry:e},{geometry:br.createVertex(t,hr.STATIC_DRAW,n)})}function vIe(t,e=b7,r=cr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new sd(t,r,{geometry:e},{geometry:br.createVertex(t,hr.STATIC_DRAW,i)})}const ece=4;function tce(t,e=ece){const r=new xr;return r.samplingMode=wt.NEAREST,r.width=r.height=e,new bt(t,r)}function bIe(t,e,r=ece){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n]=255*e[0],i[n+1]=255*e[1],i[n+2]=255*e[2],i[n+3]=255*e[3];const s=new xr;return s.samplingMode=wt.NEAREST,s.width=s.height=r,new bt(t,s,i)}function rce(t){const e=new xr;return e.samplingMode=wt.NEAREST,e.width=e.height=1,new bt(t,e,new Uint8Array([255,255,255,255]))}let Mq=class{constructor(e,r){this._view=e,this.type=Ro.Realistic,this._handles=new Oi,this._passParameters=new uIe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Yt.radius,this._fadeHaze=0,this._renderScale=Ie(),this._updateRadius(Yt.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ce(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateRootTileElevationBounds():null}),ce(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateVisibleElevationBounds():null})]);const s=new l$;s.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(bS,s),s.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(bS,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=r.techniqueRepository.acquire(bS,s),s.haze=!0,this._atmosphereHazeReducedTechnique=r.techniqueRepository.acquire(bS,s),this._vao=Xa(i,cA)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.offscreenRenderingHelper.linearDepthTexture,i,!0)}_render(e,r,i,s,n){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTex=i;const a=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);if(s)o.renderDepthDetached(()=>this._renderCommon(a,e));else{const l=e.rctx.getViewport(),c=lo(e.bindParameters.camera.eye),u=Math.sqrt(c),d=Math.min(1,Math.max(0,(u-Yt.radius)/uE)),p=n?_t(.4,.5,d):_t(.2,.3,d),g={width:Math.floor(p*e.bindParameters.camera.fullViewport[2]),height:Math.floor(p*e.bindParameters.camera.fullViewport[3])};Qt(this._renderScale,g.width/e.bindParameters.camera.fullViewport[2],g.height/e.bindParameters.camera.fullViewport[3]),this._passParameters.renderScale=this._renderScale,e.rctx.setViewport(0,0,g.width,g.height),o.renderToTargets(()=>this._renderCommon(a,e),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),e.rctx.setViewport(l.x,l.y,l.width,l.height),o.compositeAtmosphereToMain(e.bindParameters,n,i,this._renderScale)}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(vt.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Yt.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Yt.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Qt(this._passParameters.radii,e,e+uE),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-y8)*y8)}_update(e){if(!e)return;const r=lo(e.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=me((i-this._passParameters.radii[0])/uE,0,1);oi(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=_7(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=_t(_t(.6,1,qE(9500,10500,i-Yt.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function Vi(){return new Float32Array(3)}function c$(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Mr(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function ice(t,e){return new Float32Array(t,e,3)}function T7(){return Vi()}function sce(){return Mr(1,1,1)}function nce(){return Mr(1,0,0)}function oce(){return Mr(0,1,0)}function ace(){return Mr(0,0,1)}const wIe=T7(),xIe=sce(),TIe=nce(),SIe=oce(),EIe=ace();Object.freeze(Object.defineProperty({__proto__:null,ONES:xIe,UNIT_X:TIe,UNIT_Y:SIe,UNIT_Z:EIe,ZEROS:wIe,clone:c$,create:Vi,createView:ice,fromValues:Mr,ones:sce,unitX:nce,unitY:oce,unitZ:ace,zeros:T7},Symbol.toStringTag,{value:"Module"}));function lce(t){t.fragment.code.add(b`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function S7(t,e){switch(t.include(_p,e),e.textureCoordinateType){case ps.Default:case ps.Compressed:return void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case ps.Atlas:return t.include(lce),void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case ps.None:case ps.COUNT:return}}let mc=class extends Ji{constructor(e,r){super(e,"vec3",zr.Draw,(i,s,n,o)=>i.setUniform3fv(e,r(s,n,o)))}},wu=class extends Ji{constructor(e,r){super(e,"sampler2D",zr.Draw,(i,s,n)=>i.bindTexture(e,r(s,n)))}},ey=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return Hf.LOADED}},E7=class extends ey{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=vi(this._texture),this._textureNormal=vi(this._textureNormal),this._textureEmissive=vi(this._textureEmissive),this._textureOcclusion=vi(this._textureOcclusion),this._textureMetallicRoughness=vi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Hf.LOADED:Hf.LOADING}get textureBindParameters(){return new cce(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=vi(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(Sc(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return vi(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}},cce=class extends Ar{constructor(e=null,r=null,i=null,s=null,n=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}};const xdt=Mr(0,.6,.2);var Xe;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Xe||(Xe={}));function C7(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===Xe.Normal&&i&&t.include(S7,e),e.pbrMode!==Xe.Schematic)if(e.pbrMode!==Xe.Disabled){if(e.pbrMode===Xe.Normal){r.code.add(b`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===zr.Pass?new We("texMetallicRoughness",n=>n.textureMetallicRoughness):new wu("texMetallicRoughness",n=>n.textureMetallicRoughness)),r.code.add(b`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===zr.Pass?new We("texEmission",n=>n.textureEmissive):new wu("texEmission",n=>n.textureEmissive)),r.code.add(b`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===zr.Pass?new We("texOcclusion",n=>n.textureOcclusion):new wu("texOcclusion",n=>n.textureOcclusion)),r.code.add(b`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(b`float getBakedOcclusion() { return 1.0; }`),s===zr.Pass?r.uniforms.add(new Mt("emissionFactor",n=>n.emissiveFactor),new Mt("mrrFactors",n=>n.mrrFactors)):r.uniforms.add(new mc("emissionFactor",n=>n.emissiveFactor),new mc("mrrFactors",n=>n.mrrFactors)),r.code.add(b`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?b`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?b`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?b`applyEmission(${e.hasEmissiveTextureTransform?b`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?b`applyOcclusion(${e.hasOcclusionTextureTransform?b`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(b`float getBakedOcclusion() { return 1.0; }`);else r.code.add(b`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function A7(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Mt("lightingAmbientSH0",(s,n)=>se($q,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new Wt("lightingAmbientSH_R",(s,n)=>oi(Wp,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new Wt("lightingAmbientSH_G",(s,n)=>oi(Wp,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new Wt("lightingAmbientSH_B",(s,n)=>oi(Wp,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new Mt("lightingAmbientSH0",(s,n)=>se($q,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new Wt("lightingAmbientSH_R1",(s,n)=>oi(Wp,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new Wt("lightingAmbientSH_G1",(s,n)=>oi(Wp,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new Wt("lightingAmbientSH_B1",(s,n)=>oi(Wp,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new Wt("lightingAmbientSH_R2",(s,n)=>oi(Wp,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new Wt("lightingAmbientSH_G2",(s,n)=>oi(Wp,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new Wt("lightingAmbientSH_B2",(s,n)=>oi(Wp,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Xe.Normal&&e.pbrMode!==Xe.Schematic||r.code.add(b`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const $q=C(),Wp=Ht();function uA(t){t.vertex.code.add(b`const float PI = 3.141592653589793;`),t.fragment.code.add(b`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var hs,F1;function CIe(t){return(t==null?void 0:t.cubeMap)!=null}function O7(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(hs||(hs={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(F1||(F1={}));let AIe=class{constructor(){this.readChannels=F1.RG,this.renderingStage=hs.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=C(),this.isCameraPositionFinal=!0,this.parallax=new Iq,this.parallaxNew=new Iq,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:Hs.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:_l.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:U0.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===Hs.FADE_OUT||this.fadeInOut.stage===Hs.FADE_IN||this.fadeIn.stage===_l.FADE_IN||this.fadeInOutHeight.stage!==U0.FINISHED||this.renderingStage===hs.FADING_TEXTURE_CHANNELS}};var _l,Hs,U0;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(_l||(_l={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(Hs||(Hs={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(U0||(U0={}));let Iq=class{constructor(){this.anchorPointClouds=C(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=xe()}},vp=class extends Ji{constructor(e,r){super(e,"bool",zr.Pass,(i,s,n)=>i.setUniform1b(e,r(s,n)))}},OIe=class extends Ji{constructor(e,r){super(e,"samplerCube",zr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function uce(t){const e=t.fragment;e.uniforms.add(new wi("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new wi("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Mt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Mt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Se("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Se("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Se("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===Hs.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Se("crossFadeAnchorFactor",(r,i)=>me(i.cloudsFade.crossFade.factor,0,1)),new OIe("cubeMap",(r,i)=>{var s;return(s=i.cloudsFade.data)!=null&&s.cubeMap?i.cloudsFade.data.cubeMap.colorTexture:null}),new vp("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new vp("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===F1.RG),new vp("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===hs.FADING_TEXTURE_CHANNELS)),e.constants.add("planetRadius","float",Yt.radius),e.code.add(b`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(b`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(b`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),vm(e),Up(e),e.code.add(b`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(b`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(b`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(b`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(b`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function zp(t){t.code.add(b`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function RIe(){const t=new ur;t.attributes.add(S.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new wi("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new wi("inverseViewMatrix",(i,s)=>a2(PIe,s.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(zp),r.include(Ll),t.include(A7,{pbrMode:Xe.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(uA),t.include($L),t.include(o$),t.include(uce,{instancedDoublePrecision:!1}),r.uniforms.add(new Mt("cameraPosition",(i,s)=>s.camera.eye)),r.code.add(b`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const PIe=xe(),MIe=Object.freeze(Object.defineProperty({__proto__:null,build:RIe},Symbol.toStringTag,{value:"Module"}));let hce=class dce extends gr{constructor(e){super(e,new Bo,()=>this.destroy())}initializeProgram(e){return new pr(e.rctx,dce.shader.get().build(),cr)}initializePipeline(){return xt({blending:Xn(_e.ONE,_e.ZERO,_e.SRC_ALPHA,_e.ONE),depthTest:{func:Br.LEQUAL},colorWrite:$t})}};hce.shader=new dr(MIe,()=>he(()=>import("./CloudsComposition.glsl-9ab610d8.js"),[]));let y_=class extends we{constructor(e){super(e),this._technique=new hce(e),this._vao=Xa(e.rctx)}destroy(){this._technique=vi(this._technique),this._vao=Ue(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,$Ie,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(vt.TRIANGLE_STRIP,0,4)}};h([f({constructOnly:!0})],y_.prototype,"rctx",void 0),h([f({constructOnly:!0})],y_.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],y_.prototype,"planetRadius",void 0),h([f({constructOnly:!0})],y_.prototype,"requestRender",void 0),y_=h([F("esri.views.3d.environment.CloudsComposition")],y_);const $Ie=new Ar;function Lu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function IIe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function R7(t,e,r,i,s,n,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function P7(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Du(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function uv(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,p=-u*n+a*l,g=c*n-o*l;let y=r*d+i*p+s*g;return y?(y=1/y,t[0]=d*y,t[1]=(-u*i+s*c)*y,t[2]=(a*i-s*o)*y,t[3]=p*y,t[4]=(u*r-s*l)*y,t[5]=(-a*r+s*n)*y,t[6]=g*y,t[7]=(-c*r+i*l)*y,t[8]=(o*r-i*n)*y,t):null}function LIe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=s*c-i*u,t[2]=i*a-s*o,t[3]=a*l-n*u,t[4]=r*u-s*l,t[5]=s*n-r*a,t[6]=n*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*n,t}function DIe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function Tx(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],g=r[1],y=r[2],_=r[3],v=r[4],w=r[5],T=r[6],x=r[7],E=r[8];return t[0]=p*i+g*o+y*c,t[1]=p*s+g*a+y*u,t[2]=p*n+g*l+y*d,t[3]=_*i+v*o+w*c,t[4]=_*s+v*a+w*u,t[5]=_*n+v*l+w*d,t[6]=T*i+x*o+E*c,t[7]=T*s+x*a+E*u,t[8]=T*n+x*l+E*d,t}function u$(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],g=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=p*i+g*o+c,t[7]=p*s+g*a+u,t[8]=p*n+g*l+d,t}function M7(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=Math.sin(r),g=Math.cos(r);return t[0]=g*i+p*o,t[1]=g*s+p*a,t[2]=g*n+p*l,t[3]=g*o-p*i,t[4]=g*a-p*s,t[5]=g*l-p*n,t[6]=c,t[7]=u,t[8]=d,t}function $7(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function NIe(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function FIe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function UIe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function zIe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function kIe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function I7(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,u=i*o,d=i*a,p=s*o,g=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-d-y,t[3]=u-w,t[6]=p+v,t[1]=u+w,t[4]=1-c-y,t[7]=g-_,t[2]=p-v,t[5]=g+_,t[8]=1-c-d,t}function pce(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],d=u*o-a*c,p=-u*n+a*l,g=c*n-o*l,y=r*d+i*p+s*g;if(!y)return null;const _=1/y;return t[0]=d*_,t[1]=(-u*i+s*c)*_,t[2]=(a*i-s*o)*_,t[3]=p*_,t[4]=(u*r-s*l)*_,t[5]=(-a*r+s*n)*_,t[6]=g*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*n)*_,t}function Sx(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],g=e[11],y=e[12],_=e[13],v=e[14],w=e[15],T=r*a-i*o,x=r*l-s*o,E=r*c-n*o,O=i*l-s*a,A=i*c-n*a,$=s*c-n*l,M=u*_-d*y,U=u*v-p*y,k=u*w-g*y,B=d*v-p*_,z=d*w-g*_,Y=p*w-g*v;let W=T*Y-x*z+E*B+O*k-A*U+$*M;return W?(W=1/W,t[0]=(a*Y-l*z+c*B)*W,t[1]=(l*k-o*Y-c*U)*W,t[2]=(o*z-a*k+c*M)*W,t[3]=(s*z-i*Y-n*B)*W,t[4]=(r*Y-s*k+n*U)*W,t[5]=(i*k-r*z-n*M)*W,t[6]=(_*$-v*A+w*O)*W,t[7]=(v*E-y*$-w*x)*W,t[8]=(y*A-_*E+w*T)*W,t):null}function BIe(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function VIe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function GIe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function jIe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function fce(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function HIe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function WIe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function qIe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function YIe(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=e[0],p=e[1],g=e[2],y=e[3],_=e[4],v=e[5],w=e[6],T=e[7],x=e[8],E=ma();return Math.abs(r-d)<=E*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-p)<=E*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-g)<=E*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(n-y)<=E*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=E*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=E*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-w)<=E*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-T)<=E*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-x)<=E*Math.max(1,Math.abs(u),Math.abs(x))}function L7(t){const e=ma(),r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}const XIe=Tx,ZIe=fce;Object.freeze(Object.defineProperty({__proto__:null,add:jIe,adjoint:LIe,copy:IIe,determinant:DIe,equals:YIe,exactEquals:qIe,frob:GIe,fromMat2d:kIe,fromMat4:Lu,fromQuat:I7,fromRotation:UIe,fromScaling:zIe,fromTranslation:FIe,identity:P7,invert:uv,isOrthoNormal:L7,mul:XIe,multiply:Tx,multiplyScalar:HIe,multiplyScalarAndAdd:WIe,normalFromMat4:Sx,normalFromMat4Legacy:pce,projection:BIe,rotate:M7,scale:$7,scaleByVec2:NIe,set:R7,str:VIe,sub:ZIe,subtract:fce,translate:u$,transpose:Du},Symbol.toStringTag,{value:"Module"}));var ka;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(ka||(ka={}));let yP=class extends Bo{constructor(){super(...arguments),this.steps=ka.SIXTEEN,this.writeTextureChannels=F1.RG}};h([D({count:ka.COUNT})],yP.prototype,"steps",void 0),h([D({constValue:ie("esri-mobile")?1024:2048})],yP.prototype,"cubeMapSize",void 0),h([D()],yP.prototype,"writeTextureChannels",void 0);let wS=class{constructor(e,r,i,s,n,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Lq=new wS([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],ka.SIXTEEN),Oo={sunny:Lq,cloudy:new wS([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],ka.TWOHUNDRED,.6),rainy:new wS([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],ka.TWOHUNDRED,.4),snowy:new wS([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],ka.HUNDRED,.65),foggy:new wS([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],ka.SIXTEEN),default:Lq},nu=ie("esri-mobile")?64:128,JIe=nu/128,wh=Math.ceil(Math.sqrt(nu)),T0=(nu+2)*wh,QIe=1e5,jN=128,KIe=T0/1560;function Ac(t,e=!0){t.attributes.add(S.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(b`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?b`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let uC=class extends Ji{constructor(e,r){super(e,"mat3",zr.Draw,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}},mce=class extends Ar{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Oo.default.raymarchingSteps,this.weatherTile=Ie()}},gce=class extends Ar{constructor(){super(...arguments),this.viewMatrix=Zi()}};function eLe(t){const e=new ur;e.include(Ac,!1);const r=e.fragment;return r.uniforms.add(new Se("cloudRadius",i=>i.cloudRadius),new Se("power",i=>_t(35,120,i.absorption)),new Se("sigmaE",i=>1+i.absorption),new Se("density",i=>_t(0,.3,i.density)),new Se("cloudSize",i=>_t(0,.02,Math.max(.01,1-i.cloudSize))),new Se("detailSize",i=>_t(0,.2,Math.max(.01,1-i.detailSize))),new Se("smoothness",i=>_t(0,.5,1-i.smoothness)),new Se("cloudHeight",i=>_t(0,1500,i.cloudHeight)),new Se("coverage",i=>i.coverage),new uC("view",i=>i.viewMatrix),new We("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new mr("cloudVariables",i=>Qt(tLe,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(b`
    const int STEPS = ${t.steps===ka.SIXTEEN?b`16`:t.steps===ka.HUNDRED?b`100`:b`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(b`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${b.float(T0)};
      const float dataWidth = ${b.float(T0)};
      const float tileRows = ${b.float(wh)};
      const vec3 atlasDimensions = vec3(${b.float(nu)}, ${b.float(nu)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${b.float(JIe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${b.float(KIe)} * p) / ${b.float(T0)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(b`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(b`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(b`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(b`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(b`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const tLe=Ie(),rLe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:gce,CloudsPassParameters:mce,build:eLe},Symbol.toStringTag,{value:"Module"}));let yce=class _ce extends gr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new pr(e.rctx,_ce.shader.get().build(this.configuration),cr)}initializePipeline(){return xt({blending:Il(_e.CONSTANT_COLOR,_e.ONE_MINUS_CONSTANT_COLOR,Op.ADD,this.configuration.writeTextureChannels===F1.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Br.LEQUAL},colorWrite:$t})}};yce.shader=new dr(rLe,()=>he(()=>import("./Clouds.glsl-ed025f18.js"),[]));var cc;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(cc||(cc={}));let T8=class extends Bo{constructor(){super(...arguments),this.mode=cc.Full}};h([D({count:cc.COUNT})],T8.prototype,"mode",void 0);let vce=class extends Ar{constructor(){super(...arguments),this.weatherTile=ir(0,0)}};function iLe(t){const e=new ur;return e.include(Ac,!1),e.fragment.code.add(b`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===cc.Full&&e.fragment.code.add(b`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${b.float(wh)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${b.float(8)});

      float worley0 = worley(p, ${b.float(2)} * 2.0);
      float worley1 = worley(p, ${b.float(2)} * 8.0);
      float worley2 = worley(p, ${b.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${b.float(2)});
      float worley1 = worley(p, ${b.float(2)} * 2.0);
      float worley2 = worley(p, ${b.float(2)} * 4.0);
      float worley3 = worley(p, ${b.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new mr("weatherTile",r=>r.weatherTile)),e.fragment.code.add(b`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${b.float(jN)});

      // Get global coordinates of p
      p += weatherTile * ${b.float(jN)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${b.float(QIe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(b`void main() {`),t.mode===cc.Full&&e.fragment.code.add(b`
        float padWidth = 1.0;
        float paddedSize = ${b.float(nu)} + 2.0 * padWidth;
        float tileCount = ${b.float(wh)} * ${b.float(wh)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${b.float(nu)};
          }

          if (startPadY) {
            pixel.y += ${b.float(nu)};
          }

          if (endPadX) {
            pixel.x -= ${b.float(nu)};
          }

          if (endPadY) {
            pixel.y -= ${b.float(nu)};
          }

          uv = vec2(pixel.xy / ${b.float(nu)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${b.float(nu)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${b.float(wh)} * ${b.float(wh)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${b.float(wh)} * ${b.float(wh)});
        p = p_;
        p.z /= (${b.float(wh)} * ${b.float(wh)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(b`
      vec2 mapUV = ${b.float(jN)} * (gl_FragCoord.xy / ${b.float(T0)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===cc.Full?b`fragColor.ba = vec2(0.0, map);`:b`fragColor = vec4(map);`};
    }
  `),e}const sLe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:vce,build:iLe},Symbol.toStringTag,{value:"Module"}));let S8=class bce extends gr{initializeProgram(e){return new pr(e.rctx,bce.shader.get().build(this.configuration),cr)}initializePipeline(){return xt({blending:this.configuration.mode===cc.Full?Il(_e.ONE,_e.ZERO):Xn(_e.ZERO,_e.ONE,_e.ONE,_e.ZERO),depthTest:{func:Br.ALWAYS},colorWrite:$t})}};S8.shader=new dr(sLe,()=>he(()=>import("./NoiseTextureAtlas.glsl-be4fddb2.js"),[]));let nLe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type="renderbuffer",this._context.instanceCounter.increment(Ks.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==Jt.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Ks.Renderbuffer,this),this._context=Wx(this._context))}};const oLe=ne.getLogger("esri.views.webgl.FramebufferObject");let As=class Vb{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Ks.FramebufferObject,this);const s=_P(r)?r:new bt(this._context,r);if(this._colorAttachments.set(Ql.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(Ql.COLOR_ATTACHMENT0),i!=null)if(lLe(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=_P(i)?i:new bt(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=aLe(i)?i:new nLe(this._context,i),o=n.descriptor;o.internalFormat===xs.STENCIL_INDEX8?this._stencilBuffer=n:this._depthBuffer=n,this._validateRenderBufferDescriptor(o)}}dispose(){var r,i;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((s,n)=>{var o;return(o=this.detachColorTexture(n))==null?void 0:o.dispose()}),(r=this.detachDepthStencilBuffer())==null||r.dispose(),(i=this.detachDepthStencilTexture())==null||i.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Ks.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Ql.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var r;const e=this._colorAttachments.get(Ql.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.width)??0}get height(){var r;const e=this._colorAttachments.get(Ql.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.height)??0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((e,[r,i])=>e+N1(i),0)+N1(this.depthStencilAttachment)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&_P(r)?r:null}attachColorTexture(e,r=Ql.COLOR_ATTACHMENT0){var s;if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),(s=this.detachColorTexture(r))==null||s.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=Ql.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}setColorTextureTarget(e,r=Ql.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case"texture":return this._attachDepthStencilTexture(e);case"renderbuffer":return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var i;if(e==null)return;const r=e.descriptor;r.pixelFormat!==Pt.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Cs.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,wq)),(i=this._depthStencilTexture)==null||i.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,wq)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){var i;if(e==null)return;const r=e.descriptor;if(r.internalFormat!==xs.DEPTH_STENCIL&&r.internalFormat!==xs.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const s=this._context.gl,n=this._getGLAttachmentPoint(r);s.framebufferRenderbuffer(Bn.FRAMEBUFFER,n,s.RENDERBUFFER,e.glName)}(i=this._depthBuffer)==null||i.dispose(),this._depthBuffer=e}detachDepthStencilBuffer(){const e=this._depthBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(Bn.FRAMEBUFFER,i,r.RENDERBUFFER,null),e.dispose()}return this._depthBuffer=null,e}copyToTexture(e,r,i,s,n,o,a){(e<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==ji.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+i>this.width||r+s>this.height||n+i>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,bt.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(bt.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(ji.TEXTURE_2D,0,n,o,e,r,i,s),c.bindTexture(u,bt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,s,n,o,a)}async readPixelsAsync(e,r,i,s,n,o,a){if(this._context.type!==Jt.WEBGL2)return tu()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,s,n,o,a);const l=this._context.gl,c=br.createPixelPack(this._context,hr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,s,n,o,0),this._context.unbindBuffer(gt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){var s,n,o;if(this.width===e&&this.height===r)return;const i={width:e,height:r};J_(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(a=>a.resize(i.width,i.height)),(s=this._depthStencilTexture)==null||s.resize(i.width,i.height),this._initialized&&(J_(i,this._context.parameters.maxRenderbufferSize),(n=this._depthBuffer)==null||n.resize(i.width,i.height),(o=this._stencilBuffer)==null||o.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Bn.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();r.bindFramebuffer(e,i),this._colorAttachments.forEach((n,o)=>this._framebufferTexture2D(n.glName,o,Dq(n),e));const s=this._depthBuffer||this._stencilBuffer;if(s){const n=this._getGLAttachmentPoint(s.descriptor);r.framebufferRenderbuffer(e,n,r.RENDERBUFFER,s.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,Dq(this._depthStencilTexture),e);tu()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=Ql.COLOR_ATTACHMENT0,i=ji.TEXTURE_2D,s=Bn.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);e.framebufferRenderbuffer(Bn.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthBuffer=Ue(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(Bn.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilBuffer=Ue(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Ue(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==ji.TEXTURE_2D&&e.target!==ji.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),J_(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){J_(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case xs.DEPTH_COMPONENT16:case xs.DEPTH_COMPONENT24:case xs.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case xs.DEPTH24_STENCIL8:case xs.DEPTH32F_STENCIL8:case xs.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case xs.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(Vb._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;Vb._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else Vb._MAX_COLOR_ATTACHMENTS=1}const r=e-Ql.COLOR_ATTACHMENT0;r+1>Vb._MAX_COLOR_ATTACHMENTS&&ne.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${Vb._MAX_COLOR_ATTACHMENTS} color attachments`)}};function _P(t){return t!=null&&"type"in t&&t.type==="texture"}function aLe(t){return t!=null&&"type"in t&&t.type==="renderbuffer"}function lLe(t){return _P(t)||t!=null&&"pixelFormat"in t}function J_(t,e){const r=Math.max(t.width,t.height);if(r>e){oLe.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;t.width=Math.round(t.width*i),t.height=Math.round(t.height*i)}}function Dq(t){return t.descriptor.target===ji.TEXTURE_CUBE_MAP?ji.TEXTURE_CUBE_MAP_POSITIVE_X:ji.TEXTURE_2D}As._MAX_COLOR_ATTACHMENTS=-1;let xS=class extends we{constructor(e){super(e),this._needsRender=!0,this._passParameters=new vce,this._frameBuffer=new As(e.context.renderContext.rctx,new xr(T0)),this._vao=Xa(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(cc.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(cc.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Vs(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=vi(this._fullTechniqueCached),this._weatherMapTechniqueCached=vi(this._weatherMapTechniqueCached),this._frameBuffer=Ue(this._frameBuffer),this._vao=Ue(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new T8;e.mode=cc.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(S8,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new T8;e.mode=cc.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(S8,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const r=e===cc.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,s=i.getViewport();i.setViewport(0,0,T0,T0),i.bindFramebuffer(this._frameBuffer);const n=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};h([f({constructOnly:!0})],xS.prototype,"context",void 0),h([f({readOnly:!0})],xS.prototype,"_techniqueRepository",null),xS=h([F("esri.views.3d.environment.NoiseTextureAtlas")],xS);function wce(t){t.include(xc),t.uniforms.add(new We("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new mr("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(b`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let cLe=class{constructor(){this.enabled=!1}};function Tc(t,e){e.hasMultipassTerrain&&(t.fragment.include(xc),t.fragment.uniforms.add(new We("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new mr("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new mr("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(b`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let uLe=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function hLe(t,e){const r=t.fragment;r.include(xc),r.uniforms.add(new mr("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new We("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new wi("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new Se("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new wi("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(b`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let dLe=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=xe()}};function LL(t){return t?{ray:vn(t.ray),c0:t.c0,c1:t.c1}:{ray:vn(),c0:0,c1:Number.MAX_VALUE}}function pLe(t,e=LL()){return e$(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function fLe(t,e,r=LL()){const i=Te(t.vector);return tae(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function kdt(t,e){return xce(t,t.c0,e)}function Bdt(t,e){return xce(t,t.c1,e)}function xce(t,e,r){return oe(r,t.ray.origin,ee(r,t.ray.direction,e))}new ym(()=>LL());function hC(t){return t?[_r(t[0]),_r(t[1]),_r(t[2]),_r(t[3]),_r(t[4]),_r(t[5])]:[_r(),_r(),_r(),_r(),_r(),_r()]}function Tce(){return[C(),C(),C(),C(),C(),C(),C(),C()]}function h$(t,e){for(let r=0;r<u2;r++)xL(t[r],e[r])}function Sce(t,e,r,i=bLe){const s=qi(QB.get(),e,t);Wn(s,s);for(let n=0;n<_Le;++n){const o=uc(JB.get(),vLe[n],s);se(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Ece(r,i)}function Ece(t,e){Io(e[je.FAR_BOTTOM_LEFT],e[je.NEAR_BOTTOM_LEFT],e[je.NEAR_TOP_LEFT],t[Qr.LEFT]),Io(e[je.NEAR_BOTTOM_RIGHT],e[je.FAR_BOTTOM_RIGHT],e[je.FAR_TOP_RIGHT],t[Qr.RIGHT]),Io(e[je.FAR_BOTTOM_LEFT],e[je.FAR_BOTTOM_RIGHT],e[je.NEAR_BOTTOM_RIGHT],t[Qr.BOTTOM]),Io(e[je.NEAR_TOP_LEFT],e[je.NEAR_TOP_RIGHT],e[je.FAR_TOP_RIGHT],t[Qr.TOP]),Io(e[je.NEAR_BOTTOM_LEFT],e[je.NEAR_BOTTOM_RIGHT],e[je.NEAR_TOP_RIGHT],t[Qr.NEAR]),Io(e[je.FAR_BOTTOM_RIGHT],e[je.FAR_BOTTOM_LEFT],e[je.FAR_TOP_LEFT],t[Qr.FAR])}function m0(t,e){for(let r=0;r<u2;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function mLe(t,e){return Ace(t,pLe(e,Oce.get()))}function Vdt(t,e){for(let r=0;r<u2;r++){const i=t[r];if(!MOe(i,e))return!1}return!0}function gLe(t,e,r){return Ace(t,fLe(e,r,Oce.get()))}function Cce(t,e){for(let r=0;r<u2;r++)if(Kr(t[r],e)>0)return!1;return!0}function Ace(t,e){for(let r=0;r<u2;r++)if(!POe(t[r],e))return!1;return!0}var Qr,je;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Qr||(Qr={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(je||(je={}));const yLe={bottom:[je.FAR_BOTTOM_RIGHT,je.NEAR_BOTTOM_RIGHT,je.NEAR_BOTTOM_LEFT,je.FAR_BOTTOM_LEFT],near:[je.NEAR_BOTTOM_LEFT,je.NEAR_BOTTOM_RIGHT,je.NEAR_TOP_RIGHT,je.NEAR_TOP_LEFT],far:[je.FAR_BOTTOM_RIGHT,je.FAR_BOTTOM_LEFT,je.FAR_TOP_LEFT,je.FAR_TOP_RIGHT],right:[je.NEAR_BOTTOM_RIGHT,je.FAR_BOTTOM_RIGHT,je.FAR_TOP_RIGHT,je.NEAR_TOP_RIGHT],left:[je.FAR_BOTTOM_LEFT,je.NEAR_BOTTOM_LEFT,je.NEAR_TOP_LEFT,je.FAR_TOP_LEFT],top:[je.FAR_TOP_LEFT,je.NEAR_TOP_LEFT,je.NEAR_TOP_RIGHT,je.FAR_TOP_RIGHT]},u2=6,_Le=8,vLe=[Ct(-1,-1,-1,1),Ct(1,-1,-1,1),Ct(1,1,-1,1),Ct(-1,1,-1,1),Ct(-1,-1,1,1),Ct(1,-1,1,1),Ct(1,1,1,1),Ct(-1,1,1,1)],Oce=new ym(LL),bLe=Tce();function wLe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function xLe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function TLe(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function SLe(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var E8;let ot=E8=class extends we{constructor(t={}){super(t),this._center=C(),this._up=C(),this._viewUp=C(),this._viewForward=C(),this._viewRight=C(),this._ray=vn(),this._viewport=Ct(0,0,1,1),this._padding=Ct(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ir(1,1e3),this._viewDirty=!0,this._viewMatrix=xe(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=xe(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=xe(),this._frustumDirty=!0,this._frustum=hC(),this._fullViewport=Ht(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return le(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){en(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=Qx(Ht(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&jk(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[Gt.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[Gt.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[Gt.RIGHT]+this._padding[Gt.LEFT]}set fullWidth(t){this.width=t-(this._padding[Gt.RIGHT]+this._padding[Gt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Gt.TOP]+this._padding[Gt.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Gt.TOP]+this._padding[Gt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Gt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Gt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){Pw(this._padding,t)||(this._viewport[0]+=t[Gt.LEFT]-this._padding[Gt.LEFT],this._viewport[1]+=t[Gt.BOTTOM]-this._padding[Gt.BOTTOM],this._viewport[2]-=t[Gt.RIGHT]+t[Gt.LEFT]-(this._padding[Gt.RIGHT]+this._padding[Gt.LEFT]),this._viewport[3]-=t[Gt.TOP]+t[Gt.BOTTOM]-(this._padding[Gt.TOP]+this._padding[Gt.BOTTOM]),gu(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(qi(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=uoe(xe(),-i*(1+2*this._padding[Gt.LEFT]/t),i*(1+2*this._padding[Gt.RIGHT]/t),-r*(1+2*this._padding[Gt.BOTTOM]/e),r*(1+2*this._padding[Gt.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&zB(n,s)?n:s}get inverseProjectionMatrix(){return Wn(xe(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||xe()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return TLe(this._fov,this.width,this.height)}set fovX(t){this._fov=wLe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return SLe(this._fov,this.width,this.height)}set fovY(t){this._fov=xLe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return ei(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Wn(this._viewInverseTransposeMatrix,this.viewMatrix),$l(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){te(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,gu(this._viewport,t.viewport),this.notifyChange("_viewport"),gu(this._padding,t.padding),this.notifyChange("_padding"),Vs(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(en(this._viewMatrix,t.viewMatrix),te(this._viewRight,t.viewRight),te(this._viewUp,t.viewUp),te(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(h$(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(en(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),gu(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new E8().copyFrom(this)}equals(t){return ca(this.eye,t.eye)&&ca(this.center,t.center)&&ca(this.up,t.up)&&Pw(this._viewport,t.viewport)&&Pw(this._padding,t.padding)&&Ile(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||MM(t.padding,this._padding)>=1||MM(this.screenViewport,t.screenViewport)>=1)return!1;_n(To,t.eye,t.center),_n(HN,this.eye,this.center);const e=pe(To,HN),r=i6(To),i=i6(HN),s=5e-4;return e*e>=(1-1e-10)*r*i&&jI(t.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(aE(this.viewForward,le(To,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Li()){return t[0]=(this.padding[Gt.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[Gt.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[Gt.LEFT]+this.width*e,t[1]=this.padding[Gt.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==Vt&&te(Vt,t),Vt[3]=1,uc(Vt,Vt,this.projectionMatrix);const r=Math.abs(Vt[3]);ee(Vt,Vt,1/r);const i=this.fullViewport;e[0]=_t(0,i[0]+i[2],.5+.5*Vt[0]),e[1]=_t(0,i[1]+i[3],.5+.5*Vt[1]),e[2]=.5*(Vt[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;Vt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Vt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Vt[2]=(2*t[2]-1)*t[3],Vt[3]=t[3],this.inverseProjectionMatrix!=null&&(uc(Vt,Vt,this.inverseProjectionMatrix),e[0]=Vt[0],e[1]=Vt[1],e[2]=Vt[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,WN),this.renderToScreen(WN,e),e}projectToRenderScreen(t,e){if(Vt[0]=t[0],Vt[1]=t[1],Vt[2]=t[2],Vt[3]=1,uc(Vt,Vt,this.viewProjectionMatrix),Vt[3]===0)return null;ee(Vt,Vt,1/Math.abs(Vt[3]));const r=this.fullViewport;return"x"in e?(e.x=_t(0,r[0]+r[2],.5+.5*Vt[0]),e.y=_t(0,r[1]+r[3],.5+.5*Vt[1])):(e[0]=_t(0,r[0]+r[2],.5+.5*Vt[0]),e[1]=_t(0,r[1]+r[3],.5+.5*Vt[1]),e.length>2&&(e[2]=.5*(Vt[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,WN),e)}unprojectFromRenderScreen(t,e){if(qi(A3,this.projectionMatrix,this.viewMatrix),!Wn(A3,A3))return null;const r=this.fullViewport;return Vt[0]=2*(t[0]-r[0])/r[2]-1,Vt[1]=2*(t[1]-r[1])/r[3]-1,Vt[2]=2*t[2]-1,Vt[3]=1,uc(Vt,Vt,A3),Vt[3]===0?null:(e[0]=Vt[0]/Vt[3],e[1]=Vt[1]/Vt[3],e[2]=Vt[2]/Vt[3],e)}constrainWindowSize(t,e,r,i){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(t){t===Re.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){le(To,this.center,this.eye);const t=Te(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(pe(To,this.center))>.9999*Te(To)*t||(Qe(this._up,To,this.center),Qe(this._up,this._up,To),fe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){fm(To,this.eye,this.center),Math.abs(To[2])<=.9999&&(ee(To,To,To[2]),se(this._up,-To[0],-To[1],1-To[2]),fe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ca(t,e)||(te(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):ne.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Sce(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(mL(this._viewMatrix,this.eye,this.center,this.up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};h([f()],ot.prototype,"_center",void 0),h([f()],ot.prototype,"_up",void 0),h([f()],ot.prototype,"_viewport",void 0),h([f()],ot.prototype,"_padding",void 0),h([f()],ot.prototype,"_fov",void 0),h([f()],ot.prototype,"_nearFar",void 0),h([f()],ot.prototype,"_pixelRatio",void 0),h([f()],ot.prototype,"pixelRatio",null),h([f()],ot.prototype,"eye",null),h([f()],ot.prototype,"center",null),h([f()],ot.prototype,"up",null),h([f({readOnly:!0})],ot.prototype,"nearFar",null),h([f()],ot.prototype,"near",null),h([f()],ot.prototype,"far",null),h([f()],ot.prototype,"viewport",null),h([f({readOnly:!0})],ot.prototype,"screenViewport",null),h([f()],ot.prototype,"x",null),h([f()],ot.prototype,"y",null),h([f()],ot.prototype,"width",null),h([f()],ot.prototype,"height",null),h([f()],ot.prototype,"fullWidth",null),h([f()],ot.prototype,"fullHeight",null),h([f({readOnly:!0})],ot.prototype,"_aspect",null),h([f()],ot.prototype,"padding",null),h([f({readOnly:!0})],ot.prototype,"projectionMatrix",null),h([f({readOnly:!0})],ot.prototype,"inverseProjectionMatrix",null),h([f()],ot.prototype,"fov",null),h([f()],ot.prototype,"fovX",null),h([f()],ot.prototype,"fovY",null),ot=E8=h([F("esri.views.3d.webgl-engine.lib.Camera")],ot);const Vt=Ht(),A3=xe(),To=C(),HN=C(),WN=mo();var Gt;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(Gt||(Gt={}));var ae;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(ae||(ae={}));var Ze;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(Ze||(Ze={}));let D7=class{constructor(e=C()){this.intensity=e}},Rce=class{constructor(e=C(),r=Ce(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},d$=class{constructor(e=C(),r=Ce(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}},Pce=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function ELe(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function qN(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function Iw(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function Mce(t){return(t+1)*(t+1)}function CLe(t){return me(Math.floor(Math.sqrt(t)-1),0,2)}function $ce(t,e,r){const i=t[0],s=t[1],n=t[2],o=r||[];return o.length=Mce(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function ALe(t,e){const r=Mce(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function OLe(t,e){const r=CLe(e.r.length);for(const i of t)zo(C8,i.direction),$ce(C8,r,Nf),ELe(Nf,vP),qN(Nf,i.intensity[0],Sv),Iw(e.r,Sv),qN(Nf,i.intensity[1],Sv),Iw(e.g,Sv),qN(Nf,i.intensity[2],Sv),Iw(e.b,Sv);return e}function RLe(t,e){$ce(C8,0,Nf);for(const r of t)e.r[0]+=Nf[0]*vP[0]*r.intensity[0]*4*Math.PI,e.g[0]+=Nf[0]*vP[0]*r.intensity[1]*4*Math.PI,e.b[0]+=Nf[0]*vP[0]*r.intensity[2]*4*Math.PI;return e}function PLe(t,e,r,i){ALe(e,i),se(r.intensity,0,0,0);let s=!1;const n=MLe,o=$Le,a=ILe;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof d$&&!s?(te(r.direction,l.direction),te(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof d$||l instanceof Rce?n.push(l):l instanceof D7?o.push(l):l instanceof Pce&&a.push(l);OLe(n,i),RLe(o,i);for(const l of a)Iw(i.r,l.r),Iw(i.g,l.g),Iw(i.b,l.b)}const MLe=[],$Le=[],ILe=[],Nf=[0],Sv=[0],C8=C(),vP=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Nq=class{constructor(){this.color=C(),this.intensity=1}},LLe=class{constructor(){this.direction=C(),this.ambient=new Nq,this.diffuse=new Nq}};const Ice=.4;let YN=class{constructor(){this._shOrder=2,this._legacy=new LLe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new Pce,this._mainLight=new d$(C(),Ce(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){PLe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),te(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,ee(this._legacy.diffuse.color,this._mainLight.intensity,r),te(O3,this._legacy.diffuse.color),ee(O3,O3,Ice*this.globalFactor),oe(this._legacy.ambient.color,this._legacy.ambient.color,O3)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),te(this._mainLight.direction,e.mainLight.direction),te(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(Pr(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=_t(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=_t(e.mainLight.specularStrength,r.mainLight.specularStrength,i),te(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=_t(e.globalFactor,r.globalFactor,i),this.noonFactor=_t(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=_t(e.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=_t(e.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=_t(e.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}};const O3=C();let DL=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=ae.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=Ze.NONE,this.alignPixelEnabled=!1,this._camera=new ot,this._inverseViewport=Ie(),this.oldLighting=new YN,this.newLighting=new YN,this._fadedLighting=new YN,this._lighting=this.newLighting,this.ssr=new dLe,this.multipassTerrain=new uLe,this.multipassGeometry=new cLe,this.overlays=[],this.cloudsFade=new AIe}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},Ra=class extends we{constructor(e){super(e),this._handles=new Oi,this._techniques=new Array,this._techniqueConfiguration=new yP,this._bindParameters=new DL(null,null,null),this._passParameters=new mce,this._drawParameters=new gce,this._weatherTile=Ie(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=_t(Oo.default.coverage[0],Oo.default.coverage[1],.5),this.density=_t(Oo.default.density[0],Oo.default.density[1],.5),this.absorption=_t(Oo.default.absorption[0],Oo.default.absorption[1],.5),this.cloudSize=_t(Oo.default.cloudSize[0],Oo.default.cloudSize[1],.5),this.detailSize=_t(Oo.default.detailSize[0],Oo.default.detailSize[1],.5),this.smoothness=_t(Oo.default.smoothness[0],Oo.default.smoothness[1],.5),this.cloudHeight=_t(Oo.default.cloudHeight[0],Oo.default.cloudHeight[1],.5),this.raymarchingSteps=Oo.default.raymarchingSteps,this._viewMatrix=xe(),this._dirty=!1,this.running=!1,this._vao=Xa(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===F1.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new yce({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;Qt(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),Lle(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Cr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(nt.CLOUDS_GENERATOR,this),ce(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Tr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>vi(e)),this._frameBufferCube=Ue(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Oe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case ka.SIXTEEN:return 1;case ka.HUNDRED:return 4;case ka.COUNT:case ka.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new xS({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new xr(e);r.target=ji.TEXTURE_CUBE_MAP,r.wrapMode=Ot.CLAMP_TO_EDGE,this._frameBufferCube=new As(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Ue(this._frameBufferCube)}applyPreset(e,r){const i=e.median,s=n=>{const o=_t(n[0],n[1],i);return r<.5?_t(n[0],o,2*r):_t(o,n[1],2*(r-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Vs(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return _o.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=hs.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,s=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const u=DLe[this._faceIndex],d=NLe[this._faceIndex];doe(this._viewMatrix,FLe,u,d),Lu(this._drawParameters.viewMatrix,this._viewMatrix);const p=ji.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(p),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=hs.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),_o.YIELD}};h([f({constructOnly:!0})],Ra.prototype,"context",void 0),h([f({constructOnly:!0})],Ra.prototype,"view",void 0),h([f({constructOnly:!0})],Ra.prototype,"requestRender",void 0),h([f()],Ra.prototype,"coverage",void 0),h([f()],Ra.prototype,"density",void 0),h([f()],Ra.prototype,"absorption",void 0),h([f()],Ra.prototype,"cloudSize",void 0),h([f()],Ra.prototype,"detailSize",void 0),h([f()],Ra.prototype,"smoothness",void 0),h([f()],Ra.prototype,"cloudHeight",void 0),h([f()],Ra.prototype,"raymarchingSteps",void 0),h([f()],Ra.prototype,"running",void 0),Ra=h([F("esri.views.3d.environment.CloudsGenerator")],Ra);const DLe=[Mr(1,0,0),Mr(-1,0,0),Mr(0,1,0),Mr(0,-1,0),Mr(0,0,1)],NLe=[Mr(0,1,0),Mr(0,1,0),Mr(0,0,-1),Mr(0,0,1),Mr(0,1,0)],FLe=T7();let Lce=class extends Ar{constructor(){super(...arguments),this.fogColor=C(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function ULe(){const t=new ur;t.attributes.add(S.POSITION,"vec2"),t.include(_p,{textureCoordinateType:ps.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new wi("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new wi("inverseViewMatrix",(i,s)=>a2(zLe,s.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Se("atmosphereC",i=>i.atmosphereC),new Mt("cameraPosition",(i,s)=>s.camera.eye),new mr("nearFar",(i,s)=>s.camera.nearFar),new We("depthTex",i=>i.depthTexture),new Se("fogStrength",i=>i.fogStrength),new Se("fogAmount",i=>i.fogAmount),new Mt("fogColor",i=>i.fogColor)),t.include($L),r.include(xc),r.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(b`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(b`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTex, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const zLe=xe(),kLe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Lce,build:ULe},Symbol.toStringTag,{value:"Module"}));let Dce=class Nce extends gr{constructor(e){super(e,new Bo,()=>this.destroy())}initializeProgram(e){return new pr(e.rctx,Nce.shader.get().build(),cr)}initializePipeline(){return xt({blending:Xn(_e.SRC_ALPHA,_e.ZERO,_e.ONE_MINUS_SRC_ALPHA,_e.ONE),colorWrite:$t})}};Dce.shader=new dr(kLe,()=>he(()=>import("./Fog.glsl-78b9bbdf.js"),[]));const BLe=.95,VLe=1;let __=class extends we{constructor(e){super(e),this._passParameters=new Lce;const r=e.context.renderContext.rctx;this._vao=Xa(r,cA),this._technique=new Dce(e);const i=Cr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+uE}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(vt.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;fe(Fq,i.eye);const s=Math.max(0,pe(Fq,e.bindParameters.lighting.mainLight.direction)),n=r.color;ee(Uq,n,.1),Pr(this._passParameters.fogColor,Uq,n,s);const o=Te(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-qE(BLe*Kd,VLe*Kd,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};h([f({constructOnly:!0})],__.prototype,"context",void 0),h([f({constructOnly:!0})],__.prototype,"view",void 0),h([f({constructOnly:!0})],__.prototype,"rctx",void 0),h([f({constructOnly:!0})],__.prototype,"viewingMode",void 0),__=h([F("esri.views.3d.environment.Fog")],__);let GLe=class{constructor(){this.color=C(),this.strength=0,this.amount=0}};const Fq=C(),Uq=C();let uo=class extends Bo{};h([D({constValue:!0})],uo.prototype,"hasSliceHighlight",void 0),h([D({constValue:!1})],uo.prototype,"hasSliceInVertexProgram",void 0),h([D({constValue:!1})],uo.prototype,"instancedDoublePrecision",void 0),h([D({constValue:!1})],uo.prototype,"hasModelTransformation",void 0),h([D({constValue:zr.Pass})],uo.prototype,"pbrTextureBindType",void 0);var Rp;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Rp||(Rp={}));let N7=class extends uo{constructor(){super(...arguments),this.geometry=Rp.Cone}};h([D({count:Rp.COUNT})],N7.prototype,"geometry",void 0);var L;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(L||(L={}));function hA(t){t.attributes.add(S.POSITION,"vec3"),t.vertex.code.add(b`vec3 positionModel() { return position; }`)}function p$({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(b`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(b`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let kp=class extends Ji{constructor(e,r){super(e,"mat3",zr.Pass,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}};function Lw(t,e){t.include(hA);const r=t.vertex;r.include(p$,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new Mt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Mt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new kp("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new wi("transformProjFromView",i=>i.transformProjFromView),new uC("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new mc("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new mc("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(b`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(b`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?b`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:b`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Mt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let Fce=class extends Ar{constructor(){super(...arguments),this.transformWorldFromViewTH=C(),this.transformWorldFromViewTL=C(),this.transformViewFromCameraRelativeRS=Zi(),this.transformProjFromView=xe()}},Uce=class extends Ar{constructor(){super(...arguments),this.transformWorldFromModelRS=Zi(),this.transformWorldFromModelTH=C(),this.transformWorldFromModelTL=C()}};function z0(t){t.varyings.add("linearDepth","float")}function U1(t){t.vertex.uniforms.add(new mr("nearFar",(e,r)=>r.camera.nearFar))}function NL(t){t.vertex.code.add(b`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function h2(t,e){const{vertex:r}=t;switch(e.output){case L.Color:if(e.receiveShadows)return z0(t),void r.code.add(b`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:return t.include(Lw,e),z0(t),U1(t),NL(t),void r.code.add(b`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(b`void forwardLinearDepth() {}`)}function Ba(t,e){if(NL(t),e.hasModelTransformation)return t.vertex.code.add(b`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void t.vertex.code.add(b`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.vertex.code.add(b`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(b`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let F7=class extends Ar{constructor(){super(...arguments),this.texV=Ie(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new zce}},zce=class{constructor(){this.center=C(),this.v1=C(),this.v2=C()}};function jLe(t){const e=new ur,{vertex:r,fragment:i}=e;if(vm(r),t.geometry===Rp.Underground)e.attributes.add(S.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new Mt("cameraPosition",(s,n)=>n.camera.eye),new Se("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),r.code.add(b`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(b`void main() {
fragColor = color;
}`);else{e.include(Ba,t),e.attributes.add(S.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===Rp.Cylinder;r.uniforms.add(new wi("proj",(a,l)=>l.camera.projectionMatrix),new wi("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),r.uniforms.add(new Mt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Mt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Mt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new mr("texV",a=>a.texV)),r.uniforms.add(new Se("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(b`
		void main(void) {
      ${s?b`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:b`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${b.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${b.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new We("tex",a=>a.texture)),s||i.uniforms.add(new Se("altitudeFade",a=>a.altitudeFade)),i.code.add(b`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?b`fragColor = atmosphereColor;`:b`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const HLe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:zce,SimpleAtmospherePassParameters:F7,build:jLe},Symbol.toStringTag,{value:"Module"}));let f$=class kce extends gr{initializeProgram(e){return new pr(e.rctx,kce.shader.get().build(this.configuration),cr)}initializePipeline(){return this.configuration.geometry===Rp.Cylinder?xt({blending:Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),culling:v7,depthTest:{func:Br.LEQUAL},colorWrite:$t}):xt({blending:Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),depthTest:{func:Br.LEQUAL},colorWrite:$t})}};f$.shader=new dr(HLe,()=>he(()=>import("./SimpleAtmosphere.glsl-873d0fbd.js"),[]));const WLe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Dl(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).filter(i=>{var n;const s=(n=t.fields.get(i))==null?void 0:n.optional;return!(s&&s.glPadding)}).map(i=>{const s=t.fields.get(i),n=s.constructor.ElementCount,o=qLe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new qn(i,n,o,a,r,l,e)})}function qLe(t){const e=YLe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const YLe={u8:Ye.UNSIGNED_BYTE,u16:Ye.UNSIGNED_SHORT,u32:Ye.UNSIGNED_INT,i8:Ye.BYTE,i16:Ye.SHORT,i32:Ye.INT,f32:Ye.FLOAT};let U7=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};U7.ElementCount=9;let z7=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};z7.ElementCount=16;let xm=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};xm.ElementCount=1;let Tm=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,Qt(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Tm.ElementCount=2;let Sm=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,se(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=s}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Sm.ElementCount=3;let Em=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,oi(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Em.ElementCount=4;let FL=class Bce extends xm{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}static fromTypedArray(e,r){return new Bce(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};FL.ElementType="f32";let ty=class A8 extends Tm{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(A8,e,r)}static fromTypedArray(e,r){return new A8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ty.ElementType="f32";let Os=class O8 extends Sm{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(O8,e,r)}static fromTypedArray(e,r){return new O8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Os.ElementType="f32";let ed=class R8 extends Em{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(R8,e,r)}static fromTypedArray(e,r){return new R8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ed.ElementType="f32";let k0=class P8 extends U7{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(P8,e,r)}static fromTypedArray(e,r){return new P8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};k0.ElementType="f32";let k7=class M8 extends U7{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(M8,e,r)}static fromTypedArray(e,r){return new M8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};k7.ElementType="f64";let B7=class $8 extends z7{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer($8,e,r)}static fromTypedArray(e,r){return new $8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};B7.ElementType="f32";let dC=class I8 extends z7{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(I8,e,r)}static fromTypedArray(e,r){return new I8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dC.ElementType="f64";let V7=class L8 extends xm{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(L8,e,r)}static fromTypedArray(e,r){return new L8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};V7.ElementType="f64";let G7=class D8 extends Tm{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(D8,e,r)}static fromTypedArray(e,r){return new D8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};G7.ElementType="f64";let Nu=class N8 extends Sm{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(N8,e,r)}static fromTypedArray(e,r){return new N8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Nu.ElementType="f64";let UL=class F8 extends Em{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(F8,e,r)}static fromTypedArray(e,r){return new F8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};UL.ElementType="f64";let Ex=class U8 extends xm{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(U8,e,r)}static fromTypedArray(e,r){return new U8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ex.ElementType="u8";let zL=class z8 extends Tm{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(z8,e,r)}static fromTypedArray(e,r){return new z8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zL.ElementType="u8";let kL=class k8 extends Sm{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(k8,e,r)}static fromTypedArray(e,r){return new k8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kL.ElementType="u8";let wo=class B8 extends Em{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(B8,e,r)}static fromTypedArray(e,r){return new B8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};wo.ElementType="u8";let BL=class V8 extends xm{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(V8,e,r)}static fromTypedArray(e,r){return new V8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};BL.ElementType="u16";let j7=class G8 extends Tm{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(G8,e,r)}static fromTypedArray(e,r){return new G8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};j7.ElementType="u16";let VL=class j8 extends Sm{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(j8,e,r)}static fromTypedArray(e,r){return new j8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};VL.ElementType="u16";let dA=class H8 extends Em{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(H8,e,r)}static fromTypedArray(e,r){return new H8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dA.ElementType="u16";let GL=class W8 extends xm{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(W8,e,r)}static fromTypedArray(e,r){return new W8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};GL.ElementType="u32";let H7=class q8 extends Tm{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(q8,e,r)}static fromTypedArray(e,r){return new q8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};H7.ElementType="u32";let Vce=class Y8 extends Sm{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Y8,e,r)}static fromTypedArray(e,r){return new Y8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Vce.ElementType="u32";let Gce=class X8 extends Em{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(X8,e,r)}static fromTypedArray(e,r){return new X8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Gce.ElementType="u32";let W7=class Z8 extends xm{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Z8,e,r)}static fromTypedArray(e,r){return new Z8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};W7.ElementType="i8";let jL=class J8 extends Tm{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(J8,e,r)}static fromTypedArray(e,r){return new J8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jL.ElementType="i8";let jce=class Q8 extends Sm{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Q8,e,r)}static fromTypedArray(e,r){return new Q8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jce.ElementType="i8";let Hce=class K8 extends Em{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(K8,e,r)}static fromTypedArray(e,r){return new K8(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Hce.ElementType="i8";let Wce=class eU extends xm{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(eU,e,r)}static fromTypedArray(e,r){return new eU(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Wce.ElementType="i16";let pA=class tU extends Tm{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(tU,e,r)}static fromTypedArray(e,r){return new tU(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pA.ElementType="i16";let qce=class rU extends Sm{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(rU,e,r)}static fromTypedArray(e,r){return new rU(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};qce.ElementType="i16";let Yce=class iU extends Em{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(iU,e,r)}static fromTypedArray(e,r){return new iU(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Yce.ElementType="i16";let Xce=class sU extends xm{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(sU,e,r)}static fromTypedArray(e,r){return new sU(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Xce.ElementType="i32";let Zce=class nU extends Tm{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(nU,e,r)}static fromTypedArray(e,r){return new nU(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Zce.ElementType="i32";let Jce=class oU extends Sm{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(oU,e,r)}static fromTypedArray(e,r){return new oU(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Jce.ElementType="i32";let Qce=class aU extends Em{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(aU,e,r)}static fromTypedArray(e,r){return new aU(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Qce.ElementType="i32";function zq(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let kq=class Kce{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const s=e.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new Kce(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}return this}},eue=class tue{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:JLe(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,ty,r),this}vec2f64(e,r){return this._appendField(e,G7,r),this}vec3f(e,r){return this._appendField(e,Os,r),this}vec3f64(e,r){return this._appendField(e,Nu,r),this}vec4f(e,r){return this._appendField(e,ed,r),this}vec4f64(e,r){return this._appendField(e,UL,r),this}mat3f(e,r){return this._appendField(e,k0,r),this}mat3f64(e,r){return this._appendField(e,k7,r),this}mat4f(e,r){return this._appendField(e,B7,r),this}mat4f64(e,r){return this._appendField(e,dC,r),this}vec4u8(e,r){return this._appendField(e,wo,r),this}f32(e,r){return this._appendField(e,FL,r),this}f64(e,r){return this._appendField(e,V7,r),this}u8(e,r){return this._appendField(e,Ex,r),this}u16(e,r){return this._appendField(e,BL,r),this}i8(e,r){return this._appendField(e,W7,r),this}vec2i8(e,r){return this._appendField(e,jL,r),this}vec2i16(e,r){return this._appendField(e,pA,r),this}vec2u8(e,r){return this._appendField(e,zL,r),this}vec4u16(e,r){return this._appendField(e,dA,r),this}u32(e,r){return this._appendField(e,GL,r),this}_appendField(e,r,i){if(this._fields.has(e))return void He(!1,`${e} already added to vertex buffer layout`);const s=r.ElementCount*zq(r.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:r,offset:n,optional:i})}createBuffer(e){return new kq(this,e)}createView(e){return new kq(this,e)}clone(){const e=new tue;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,zq(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Ri(){return new eue}let XLe=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const s={...r,constructor:rue(r.constructor)};this.fields.push([i,s])}),this.stride=e.stride}};const ZLe=[FL,ty,Os,ed,k0,B7,V7,G7,Nu,UL,k7,dC,Ex,zL,kL,wo,BL,j7,VL,dA,GL,H7,Vce,Gce,W7,jL,jce,Hce,Wce,pA,qce,Yce,Xce,Zce,Jce,Qce];function rue(t){return`${t.ElementType}_${t.ElementCount}`}function JLe(t){return iue.get(t)}const iue=new Map;ZLe.forEach(t=>iue.set(rue(t),t));function go(t,e=!1){return t<=_c?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function sue(t){return(Yh(t)?t.length:t.byteLength/8)<=_c?Array.from(t):new Float64Array(t)}function xu(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function Di(t,e=!1){return t<=_c?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function mpt(t){return Yh(t)?t.length<_c?t:new Float32Array(t):t.length<_c?Array.from(t):t}function Bq(t){return(Yh(t)?t.length:t.byteLength/8)<=_c?Array.from(t):new Float32Array(t)}function m$(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function bp(t){return Yh(t)?t.length<_c?t:Vq(t):t.length<_c?Array.from(t):t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:Vq(t)}function Vq(t){let e=!0;for(const r of t){if(r>=65536)return Yh(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function g$(t){return t<=_c?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function QLe(t){return t<=_c?new Array(t):new Uint32Array(t)}let Ev=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const nue=[0],XN=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function Cx(t){if(t===1)return nue;if(t<_c)return Array.from(new Uint16Array(XN.buffer,0,t));if(t<XN.length)return new Uint16Array(XN.buffer,0,t);if(t>Ev.length){const e=Math.max(2*Ev.length,t);Ev=new Uint32Array(e);for(let r=0;r<Ev.length;r++)Ev[r]=r}return new Uint32Array(Ev.buffer,0,t)}let R3=new Uint8Array(65536);function d2(t){if(t===1)return nue;if(t<_c)return new Array(t).fill(0);if(t>R3.length){const e=Math.max(2*R3.length,t);R3=new Uint8Array(e)}return new Uint8Array(R3.buffer,0,t)}let Le=class{constructor(e,r,i=!1,s=r){this.data=e,this.size=r,this.exclusive=i,this.stride=s}};var lU;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function r(o,a){const l=o[a],c=o[a+1],u=o[a+2],d=1/Math.sqrt(l*l+c*c+u*u);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]+l[c],u[d+1]=o[a+1]+l[c+1],u[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]-l[c],u[d+1]=o[a+1]-l[c+1],u[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=s,t.subtract=n})(lU||(lU={}));var Wi;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Wi||(Wi={}));function KLe(t){if(t.length<_c)return Array.from(t);if(Yh(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return RI(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let oue=class aue{constructor(e,r,i,s){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this._children=void 0,He(e.length>=1),He(i.length%this._numIndexPerPrimitive==0),He(i.length>=e.length*this._numIndexPerPrimitive),He(s.size===3||s.size===4);const{data:n,size:o}=s,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];my.clear(),my.push(l);const c=Ce(n[l],n[l+1],n[l+2]),u=ms(c);for(let g=0;g<a;++g){const y=this._numIndexPerPrimitive*e[g];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[y+_],my.push(l);let v=n[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=n[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=n[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const d=Pr(C(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let g=0;g<my.length;++g){l=my.getItemAt(g);const y=n[l]-d[0],_=n[l+1]-d[1],v=n[l+2]-d[2],w=y*y+_*_+v*v;if(w<=p)continue;const T=Math.sqrt(w),x=.5*(T-this.radius);this.radius=this.radius+x,p=this.radius*this.radius;const E=x/T;d[0]+=y*E,d[1]+=_*E,d[2]+=v*E}this.center=d,my.clear()}getChildren(){if(this._children||Hn(this.bbMin,this.bbMax)<=1)return this._children;const e=Pr(C(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let u=0;const d=this._numIndexPerPrimitive*this.primitiveIndices[c];let p=o*this.indices[d],g=n[p],y=n[p+1],_=n[p+2];for(let v=1;v<this._numIndexPerPrimitive;++v){p=o*this.indices[d+v];const w=n[p],T=n[p+1],x=n[p+2];w<g&&(g=w),T<y&&(y=T),x<_&&(_=x)}g<e[0]&&(u|=1),y<e[1]&&(u|=2),_<e[2]&&(u|=4),i[c]=u,++s[u]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const u=i[c];l[u][s[u]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new aue(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){my.prune()}};const my=new Nt({deallocator:null});let fA=class{constructor(){this.id=Rl()}unload(){}};function eDe(t){return t?{p0:ms(t.p0),p1:ms(t.p1),p2:ms(t.p2)}:{p0:C(),p1:C(),p2:C()}}function Gq(t,e,r){const i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-s*n)}function tDe(t,e,r){return le(ZN,e,t),le(jq,r,t),Te(Qe(ZN,ZN,jq))/2}new ym(id);new ym(()=>eDe());const ZN=C(),jq=C();function rDe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0),se(ru,0,0,0);let n=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a]*i,c=e[a+1]*i,u=e[a+2]*i;se(mn,s[l],s[l+1],s[l+2]),se(Ff,s[c],s[c+1],s[c+2]),se(P3,s[u],s[u+1],s[u+2]);const d=tDe(mn,Ff,P3);d?(oe(mn,mn,Ff),oe(mn,mn,P3),ee(mn,mn,1/3*d),oe(r,r,mn),n+=d):(oe(ru,ru,mn),oe(ru,ru,Ff),oe(ru,ru,P3),o+=3)}return(o!==0||n!==0)&&(n!==0?(ee(r,r,1/n),!0):o!==0&&(ee(r,ru,1/o),!0))}function iDe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0);let n=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;n!==l&&(r[0]+=s[l],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&ee(r,r,1/o),o>0}function sDe(t,e,r,i){if(!t)return!1;se(i,0,0,0),se(ru,0,0,0);let s=0,n=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let u=0;u<c;u+=2){const d=u<l?u:l,p=u<l?u+1:0,g=(e?e[d]:d)*o,y=(e?e[p]:p)*o;mn[0]=a[g],mn[1]=a[g+1],mn[2]=a[g+2],Ff[0]=a[y],Ff[1]=a[y+1],Ff[2]=a[y+2],ee(mn,oe(mn,mn,Ff),.5);const _=ZC(mn,Ff);_>0?(oe(i,i,ee(mn,mn,_)),s+=_):s===0&&(oe(ru,ru,mn),n++)}return s!==0?(ee(i,i,1/s),!0):n!==0&&(ee(i,ru,1/n),!0)}const mn=C(),Ff=C(),P3=C(),ru=C();let y$=class{constructor(e){this.channel=e,this.id=Rl()}};function cU(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function nDe(t,e){const r=t.length;for(let i=0;i<r;++i)mw[0]=t[i],e[i]=mw[0];return e}function oDe(t,e){const r=t.length;for(let i=0;i<r;++i)mw[0]=t[i],mw[1]=t[i]-mw[0],e[i]=mw[1];return e}const mw=new Float32Array(2);function uU(t,e){return t==null&&(t=[]),t.push(e),t}function hU(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function aDe(t,e,r,i,s){M3[0]=t.get(e,0),M3[1]=t.get(e,1),M3[2]=t.get(e,2),cU(M3,gy,3),r.set(s,0,gy[0]),i.set(s,0,gy[1]),r.set(s,1,gy[2]),i.set(s,1,gy[3]),r.set(s,2,gy[4]),i.set(s,2,gy[5])}const M3=C(),gy=new Float32Array(6);let Rs=class lue extends fA{constructor(e,r,i=[],s=null,n=Wi.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=lDe(this._vertexAttributes),c=Cx(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const u of this._vertexAttributes.keys())this._indices.set(u,c)}else for(const[l,c]of i)c&&(this._indices.set(l,bp(c)),l===S.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new lue(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,s)=>{i.exclusive=!1,r._vertexAttributes.set(s,i)}),this._indices.forEach((i,s)=>r._indices.set(s,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:KLe(r.data)},this._vertexAttributes.set(e,r)),r}setAttributeData(e,r){const i=this._vertexAttributes.get(e);i&&this._vertexAttributes.set(e,{...i,exclusive:!0,data:r})}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Wi.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Wi.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&De(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(S.POSITION),i=this.vertexAttributes.get(S.POSITION);return rDe(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(S.POSITION),i=this.indices.get(S.POSITION);return sDe(r,i,i&&cDe(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(S.POSITION),i=this.vertexAttributes.get(S.POSITION);return iDe(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(S.POSITION),r=this.vertexAttributes.get(S.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===Wi.Mesh?3:1;He(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const s=Cx(e.length/i);return new oue(s,i,e,r)}get transformation(){return this._transformation??qa}set transformation(e){this._transformation=e&&e!==qa?fx(e):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const e=new y$(cm.Highlight);return this.highlights=uU(this.highlights,e),e}removeHighlight(e){this.highlights=hU(this.highlights,e)}};function lDe(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function cDe(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const Cv=lU,JN=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],uDe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],hDe=[0,0,1,0,1,1,0,1],dDe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],cue=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)cue[6*t+e]=t;const v_=new Array(36);for(let t=0;t<6;t++)v_[6*t]=0,v_[6*t+1]=1,v_[6*t+2]=2,v_[6*t+3]=2,v_[6*t+4]=3,v_[6*t+5]=0;function pDe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=JN[i][0]*e[0],r[3*i+1]=JN[i][1]*e[1],r[3*i+2]=JN[i][2]*e[2];return new Rs(t,[[S.POSITION,new Le(r,3,!0)],[S.NORMAL,new Le(uDe,3)],[S.UV0,new Le(hDe,2)]],[[S.POSITION,dDe],[S.NORMAL,cue],[S.UV0,v_]])}const QN=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],fDe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],mDe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],gDe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function yDe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=QN[i][0]*e[0],r[3*i+1]=QN[i][1]*e[1],r[3*i+2]=QN[i][2]*e[2];return new Rs(t,[[S.POSITION,new Le(r,3,!0)],[S.NORMAL,new Le(fDe,3)]],[[S.POSITION,mDe],[S.NORMAL,gDe]])}const bP=Mr(-.5,0,-.5),wP=Mr(.5,0,-.5),xP=Mr(0,0,.5),TP=Mr(0,.5,0),Av=Vi(),Ov=Vi(),Dw=Vi(),Nw=Vi(),Fw=Vi();le(Av,bP,TP),le(Ov,bP,wP),Qe(Dw,Av,Ov),fe(Dw,Dw),le(Av,wP,TP),le(Ov,wP,xP),Qe(Nw,Av,Ov),fe(Nw,Nw),le(Av,xP,TP),le(Ov,xP,bP),Qe(Fw,Av,Ov),fe(Fw,Fw);const KN=[bP,wP,xP,TP],_De=[0,-1,0,Dw[0],Dw[1],Dw[2],Nw[0],Nw[1],Nw[2],Fw[0],Fw[1],Fw[2]],vDe=[0,1,2,3,1,0,3,2,1,3,0,2],bDe=[0,0,0,1,1,1,2,2,2,3,3,3];function wDe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=KN[i][0]*e[0],r[3*i+1]=KN[i][1]*e[1],r[3*i+2]=KN[i][2]*e[2];return new Rs(t,[[S.POSITION,new Le(r,3,!0)],[S.NORMAL,new Le(_De,3)]],[[S.POSITION,vDe],[S.NORMAL,bDe]])}function vpt(t,e,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),d=(c+1)*(u+1),p=Di(3*d),g=Di(3*d),y=Di(2*d),_=[];let v=0;for(let E=0;E<=u;E++){const O=[],A=E/u,$=a+A*l,M=Math.cos($);for(let U=0;U<=c;U++){const k=U/c,B=n+k*o,z=Math.cos(B)*M,Y=Math.sin($),W=-Math.sin(B)*M;p[3*v]=z*e,p[3*v+1]=Y*e,p[3*v+2]=W*e,g[3*v]=z,g[3*v+1]=Y,g[3*v+2]=W,y[2*v]=k,y[2*v+1]=A,O.push(v),++v}_.push(O)}const w=new Array;for(let E=0;E<u;E++)for(let O=0;O<c;O++){const A=_[E][O],$=_[E][O+1],M=_[E+1][O+1],U=_[E+1][O];E===0?(w.push(A),w.push(M),w.push(U)):E===u-1?(w.push(A),w.push($),w.push(M)):(w.push(A),w.push($),w.push(M),w.push(M),w.push(U),w.push(A))}const T=[[S.POSITION,w],[S.NORMAL,w]],x=[[S.POSITION,new Le(p,3,!0)],[S.NORMAL,new Le(g,3,!0)]];return s.uv&&(x.push([S.UV0,new Le(y,2,!0)]),T.push([S.UV0,w])),s.offset&&(T[0][0]=S.OFFSET,x[0][0]=S.OFFSET,T.push([S.POSITION,d2(w.length)]),x.push([S.POSITION,new Le(Float64Array.from(s.offset),3,!0)])),new Rs(t,x,T)}function xDe(t,e,r,i){const{vertexAttributes:s,indices:n}=uue(e,r,i);return new Rs(t,s,n)}function uue(t,e,r){const i=t;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const u=i*(1+Math.sqrt(5))/2;s=[-i,u,0,i,u,0,-i,-u,0,i,-u,0,0,-i,u,0,i,u,0,-i,-u,0,i,-u,u,0,-i,u,0,i,-u,0,-i,-u,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let u=0;u<s.length;u+=3)Cv.scale(s,u,t/Cv.length(s,u));let o={};function a(u,d){u>d&&([u,d]=[d,u]);const p=u.toString()+"."+d.toString();if(o[p])return o[p];let g=s.length;return s.length+=3,Cv.add(s,3*u,s,3*d,s,g),Cv.scale(s,g,t/Cv.length(s,g)),g/=3,o[p]=g,g}for(let u=0;u<e;u++){const d=n.length,p=new Array(4*d);for(let g=0;g<d;g+=3){const y=n[g],_=n[g+1],v=n[g+2],w=a(y,_),T=a(_,v),x=a(v,y),E=4*g;p[E]=y,p[E+1]=w,p[E+2]=x,p[E+3]=_,p[E+4]=T,p[E+5]=w,p[E+6]=v,p[E+7]=x,p[E+8]=T,p[E+9]=w,p[E+10]=T,p[E+11]=x}n=p,o={}}const l=Bq(s);for(let u=0;u<l.length;u+=3)Cv.normalize(l,u);const c=[[S.POSITION,n],[S.NORMAL,n]];return{vertexAttributes:[[S.POSITION,new Le(Bq(s),3,!0)],[S.NORMAL,new Le(l,3,!0)]],indices:c}}function dU(t,e,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],u=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const d=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],p=s!=null&&s.length===2?s:[1,1],g=[[S.POSITION,new Le(c,3,!0)],[S.NORMAL,new Le(u,3,!0)],[S.UV0,new Le(o,o.length)],[S.COLOR,new Le(d,4,!0)],[S.SIZE,new Le(p,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];g.push([S.AUXPOS1,new Le(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];g.push([S.AUXPOS2,new Le(y,4)])}return new Rs(t,g,null,null,Wi.Point,l)}const TDe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function bpt(t,e=TDe){const r=new Array(12);for(let u=0;u<4;u++)for(let d=0;d<3;d++)r[3*u+d]=e[u][d];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[S.POSITION,i],[S.NORMAL,n],[S.UV0,i],[S.COLOR,n]],c=[[S.POSITION,new Le(r,3,!0)],[S.NORMAL,new Le(s,3,!0)],[S.UV0,new Le(o,2,!0)],[S.COLOR,new Le(a,4,!0)]];return new Rs(t,c,l)}function Hq(t,e,r,i,s,n=!0,o=!0){let a=0;const l=r,c=e;let u=Mr(0,a,0),d=Mr(0,a+c,0),p=Mr(0,-1,0),g=Mr(0,1,0);s&&(a=c,d=Mr(0,0,0),u=Mr(0,a,0),p=Mr(0,1,0),g=Mr(0,-1,0));const y=[d,u],_=[p,g],v=i+2,w=Math.sqrt(c*c+l*l);if(s)for(let M=i-1;M>=0;M--){const U=M*(2*Math.PI/i),k=Mr(Math.cos(U)*l,a,Math.sin(U)*l);y.push(k);const B=Mr(c*Math.cos(U)/w,-l/w,c*Math.sin(U)/w);_.push(B)}else for(let M=0;M<i;M++){const U=M*(2*Math.PI/i),k=Mr(Math.cos(U)*l,a,Math.sin(U)*l);y.push(k);const B=Mr(c*Math.cos(U)/w,l/w,c*Math.sin(U)/w);_.push(B)}const T=new Array,x=new Array;if(n){for(let M=3;M<y.length;M++)T.push(1),T.push(M-1),T.push(M),x.push(0),x.push(0),x.push(0);T.push(y.length-1),T.push(2),T.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let M=3;M<y.length;M++)T.push(M),T.push(M-1),T.push(0),x.push(M),x.push(M-1),x.push(1);T.push(0),T.push(2),T.push(y.length-1),x.push(1),x.push(2),x.push(_.length-1)}const E=Di(3*v);for(let M=0;M<v;M++)E[3*M]=y[M][0],E[3*M+1]=y[M][1],E[3*M+2]=y[M][2];const O=Di(3*v);for(let M=0;M<v;M++)O[3*M]=_[M][0],O[3*M+1]=_[M][1],O[3*M+2]=_[M][2];const A=[[S.POSITION,T],[S.NORMAL,x]],$=[[S.POSITION,new Le(E,3,!0)],[S.NORMAL,new Le(O,3,!0)]];return new Rs(t,$,A)}function SDe(t,e,r,i,s,n,o){const a=s?c$(s):Mr(1,0,0),l=n?c$(n):Mr(0,0,0);o??(o=!0);const c=Vi();fe(c,a);const u=Vi();ee(u,c,Math.abs(e));const d=Vi();ee(d,u,-.5),oe(d,d,l);const p=Mr(0,1,0);Math.abs(1-pe(c,p))<.2&&se(p,0,0,1);const g=Vi();Qe(g,c,p),fe(g,g),Qe(p,g,c);const y=2*i+(o?2:0),_=i+(o?2:0),v=Di(3*y),w=Di(3*_),T=Di(2*y),x=new Array(3*i*(o?4:2)),E=new Array(3*i*(o?4:2));o&&(v[3*(y-2)]=d[0],v[3*(y-2)+1]=d[1],v[3*(y-2)+2]=d[2],T[2*(y-2)]=0,T[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+u[0],v[3*(y-1)+1]=v[3*(y-2)+1]+u[1],v[3*(y-1)+2]=v[3*(y-2)+2]+u[2],T[2*(y-1)]=1,T[2*(y-1)+1]=1,w[3*(_-2)]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const O=(B,z,Y)=>{x[B]=z,E[B]=Y};let A=0;const $=Vi(),M=Vi();for(let B=0;B<i;B++){const z=B*(2*Math.PI/i);ee($,p,Math.sin(z)),ee(M,g,Math.cos(z)),oe($,$,M),w[3*B]=$[0],w[3*B+1]=$[1],w[3*B+2]=$[2],ee($,$,r),oe($,$,d),v[3*B]=$[0],v[3*B+1]=$[1],v[3*B+2]=$[2],T[2*B]=B/i,T[2*B+1]=0,v[3*(B+i)]=v[3*B]+u[0],v[3*(B+i)+1]=v[3*B+1]+u[1],v[3*(B+i)+2]=v[3*B+2]+u[2],T[2*(B+i)]=B/i,T[2*B+1]=1;const Y=(B+1)%i;O(A++,B,B),O(A++,B+i,B),O(A++,Y,Y),O(A++,Y,Y),O(A++,B+i,B),O(A++,Y+i,Y)}if(o){for(let B=0;B<i;B++){const z=(B+1)%i;O(A++,y-2,_-2),O(A++,B,_-2),O(A++,z,_-2)}for(let B=0;B<i;B++){const z=(B+1)%i;O(A++,B+i,_-1),O(A++,y-1,_-1),O(A++,z+i,_-1)}}const U=[[S.POSITION,x],[S.NORMAL,E],[S.UV0,x]],k=[[S.POSITION,new Le(v,3,!0)],[S.NORMAL,new Le(w,3,!0)],[S.UV0,new Le(T,2,!0)]];return new Rs(t,k,U)}function wpt(t,e,r,i,s,n,o=Mr(0,0,0)){const a=e.length,l=Di(r.length*a*3+(6*i.length||0)),c=Di(r.length*a*3+(i?6:0)),u=new Array,d=new Array;let p=0,g=0;const y=Vi(),_=Vi(),v=Vi(),w=Vi(),T=Vi(),x=Vi(),E=Vi(),O=C(),A=Vi(),$=Vi(),M=Vi(),U=Vi(),k=Vi(),B=_r();se(A,0,1,0),le(_,r[1],r[0]),fe(_,_),n?(oe(O,r[0],o),fe(v,O)):se(v,0,0,1),_$(_,v,A,A,T,v,Wq),te(w,v),te(U,T);for(let N=0;N<i.length;N++)ee(x,T,i[N][0]),ee(O,v,i[N][2]),oe(x,x,O),oe(x,x,r[0]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];c[g++]=-_[0],c[g++]=-_[1],c[g++]=-_[2];for(let N=0;N<s.length;N++)u.push(s[N][0]>0?s[N][0]:-s[N][0]-1+i.length),u.push(s[N][1]>0?s[N][1]:-s[N][1]-1+i.length),u.push(s[N][2]>0?s[N][2]:-s[N][2]-1+i.length),d.push(0),d.push(0),d.push(0);let z=i.length;const Y=i.length-1;for(let N=0;N<r.length;N++){let V=!1;N>0&&(te(y,_),N<r.length-1?(le(_,r[N+1],r[N]),fe(_,_)):V=!0,oe($,y,_),fe($,$),oe(M,r[N-1],w),lA(r[N],$,B),av(B,wc(M,y),O)?(le(O,O,r[N]),fe(v,O),Qe(T,$,v),fe(T,T)):_$($,w,U,A,T,v,Wq),te(w,v),te(U,T)),n&&(oe(O,r[N],o),fe(k,O));for(let q=0;q<a;q++)if(ee(x,T,e[q][0]),ee(O,v,e[q][1]),oe(x,x,O),fe(E,x),c[g++]=E[0],c[g++]=E[1],c[g++]=E[2],oe(x,x,r[N]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2],!V){const J=(q+1)%a;u.push(z+q),u.push(z+a+q),u.push(z+J),u.push(z+J),u.push(z+a+q),u.push(z+a+J);for(let K=0;K<6;K++){const ge=u.length-6;d.push(u[ge+K]-Y)}}z+=a}const W=r[r.length-1];for(let N=0;N<i.length;N++)ee(x,T,i[N][0]),ee(O,v,i[N][1]),oe(x,x,O),oe(x,x,W),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];const j=g/3;c[g++]=_[0],c[g++]=_[1],c[g++]=_[2];const Z=z-a;for(let N=0;N<s.length;N++)u.push(s[N][0]>=0?z+s[N][0]:-s[N][0]-1+Z),u.push(s[N][2]>=0?z+s[N][2]:-s[N][2]-1+Z),u.push(s[N][1]>=0?z+s[N][1]:-s[N][1]-1+Z),d.push(j),d.push(j),d.push(j);const R=[[S.POSITION,u],[S.NORMAL,d]],I=[[S.POSITION,new Le(l,3,!0)],[S.NORMAL,new Le(c,3,!0)]];return new Rs(t,I,R)}function xpt(t,e,r,i){He(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),He(e[0].length===3,"createPolylineGeometry(): malformed vertex"),He(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),He(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=go(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let u=0;u<e.length;u++){for(let d=0;d<3;d++)s[o++]=e[u][d];u>0&&(n[a++]=u-1,n[a++]=u)}const l=[],c=[];if(l.push([S.POSITION,n]),c.push([S.POSITION,new Le(s,3,!0)]),r){const u=Di(3*r.length);let d=0;for(let p=0;p<e.length;p++)for(let g=0;g<3;g++)u[d++]=r[p][g];l.push([S.NORMAL,n]),c.push([S.NORMAL,new Le(u,3,!0)])}return i&&(c.push([S.COLOR,new Le(i,4)]),l.push([S.COLOR,Cx(i.length/4)])),new Rs(t,c,l,null,Wi.Line)}function EDe(t,e=t){const r=t.vertexAttributes,i=r.get(S.POSITION).data,s=r.get(S.NORMAL).data;if(s){const n=e.getMutableAttribute(S.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=e.getMutableAttribute(S.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function e4(t,e,r,i,s){return!(Math.abs(pe(e,t))>s)&&(Qe(r,t,e),fe(r,r),Qe(i,r,t),fe(i,i),!0)}function _$(t,e,r,i,s,n,o){return e4(t,e,s,n,o)||e4(t,r,s,n,o)||e4(t,i,s,n,o)}const Wq=.99619469809;let CDe=class{constructor(e,r){this.type=Ro.Local,this._configuration=new N7,this._passParameters=new F7,this._configuration.geometry=Rp.Cylinder,this._technique=r.techniqueRepository.acquire(f$,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=co(this._vao,"geometry");const s=new xr;s.wrapMode=Ot.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new bt(i,s,WLe)}destroy(){this._passParameters.texture=Ue(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);ADe(qq,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",qq),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(vt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=uue(1,2,!1),i=r.indices[0][1],s=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const n=s.data,o=Yq.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new sd(e,cr,{geometry:Dl(Yq)},{geometry:br.createVertex(e,hr.STATIC_DRAW,o.buffer)})}};function ADe(t,e){en(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const qq=xe(),Yq=Ri().vec3f(S.POSITION),ODe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),$3=128,Xq=-y8,Zq=0,t4=50,RDe=()=>1-511/512,PDe=cP([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let MDe=class{constructor(e,r){this.view=e,this.type=Ro.Mars,this._passParameters=new F7,this._vaoCount=0,this._texV1=1;const i=Cr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Xq)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Zq)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Zq/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=ce(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),Ss),this._vao=this._createRibbon(s),this._vaoCount=co(this._vao,"geometry"),this._fadeVao=Xa(s),this._fadeVaoCount=co(this._fadeVao,"geometry");const n=new xr;n.wrapMode=Ot.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new bt(s,n,ODe);const o=new N7;o.geometry=Rp.Cone,this._coneTechnique=this._techniqueRepository.acquire(f$,o),o.geometry=Rp.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(f$,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Ue(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(vt.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(vt.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=C(),i=this._planetRadius,s=Te(e.eye),n=s-i;if(n<0){const g=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=g}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(t4,n),a=i+Xq;this._passParameters.innerScale=$De(i+o,i,a)-1,this._passParameters.altitudeFade=_7(n),ee(r,e.eye,(i+t4)/s),Jq(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=RDe(),u=PDe(n);let d=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(n>t4){Jq(e.eye,e.center,e.up,i,this._passParameters.silhouette);const g=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=me((g-1.5)/(l-1.5),0,1);d=this._texV0+y*c*this._texVScale,p=this._texV0+_t(this._texV1,l*u,y)*this._texVScale}Qt(this._passParameters.texV,d,p)}_createRibbon(e){const r=Di(3+3*$3*3),i=new Uint32Array(3*$3*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<$3;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===$3-1?1:l+3,u=15*o;i[u]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const s=Qq.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new sd(e,cr,{geometry:Dl(Qq)},{geometry:br.createVertex(e,hr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,r,i,s){return oe(Rv,s.center,s.v2),ee(I3,Rv,this._outerRimFactor),mL(r4,r,Rv,i),vq(Rv,r4,e.projectionMatrix,e.viewport,Rv),vq(I3,r4,e.projectionMatrix,e.viewport,I3),ei(Rv,I3)/e.height}};function Jq(t,e,r,i,s){const n=Te(t),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return ee(s.center,t,a/n),Qe(l,t,e),lo(l)<1&&Qe(l,t,r),ee(l,l,o/Te(l)),Qe(c,l,t),ee(c,c,o/Te(c)),o}const r4=xe(),Rv=C(),I3=C();function $De(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const Qq=Ri().vec3f(S.POSITION);var um;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(um||(um={}));let pU=class extends Bo{constructor(){super(...arguments),this.type=um.Rain}};h([D({count:um.COUNT})],pU.prototype,"type",void 0);function IDe(t){const e=new ur;return e.attributes.add(S.POSITION,"vec3"),e.attributes.add(S.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Mt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new Mt("offset",(r,i)=>LDe(r,i))),e.vertex.uniforms.add(new Se("width",r=>r.width)),e.vertex.uniforms.add(new wi("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new wi("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Se("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(b`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===um.Rain?b`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Se("opacity",r=>r.opacity),new Mt("particleColor",(r,i)=>DDe(i,t))),e.fragment.code.add(b`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===um.Rain?b`d = 0.35 * smoothstep(0.5, 0.0, d);`:b`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function LDe(t,e){const r=e.camera.eye,i=.5*t.width,s=1/t.width,n=lie(fU,se(fU,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return _n(n,r,ee(n,n,t.width))}function DDe(t,e){const r=e.type===um.Rain?FDe:NDe,i=ee(fU,r,UDe),s=t.camera.eye;fe(Kq,s);const n=Math.max(0,pe(Kq,t.lighting.mainLight.direction));return Pr(i,i,r,n)}const fU=C(),Kq=C(),NDe=Ce(1,1,1),FDe=Ce(.85,.85,.85),UDe=.7,zDe=Object.freeze(Object.defineProperty({__proto__:null,build:IDe},Symbol.toStringTag,{value:"Module"}));let kDe=class extends Ar{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},mU=class hue extends gr{initializeProgram(e){return new pr(e.rctx,hue.shader.get().build(this.configuration),SP)}initializePipeline(){return xt({blending:Xn(_e.ONE,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),depthTest:{func:Br.LEQUAL},colorWrite:$t})}};mU.shader=new dr(zDe,()=>he(()=>import("./Precipitation.glsl-afd3d563.js"),[]));const SP=new Map([[S.POSITION,0],[S.INSTANCEFEATUREATTRIBUTE,1]]);let due=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},BDe=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},b_=class extends we{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new kDe,this._animation=new due,this._updatingTracking=new mp,this._passParameters.time=0,this._passParameters.radius=Cr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=vi(this._snowTechniqueCached),this._rainTechniqueCached=vi(this._rainTechniqueCached),this._vao=Ue(this._vao),this._instanceIdBuffer=Ue(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new pU;e.type=um.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(mU,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new pU;e.type=um.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(mU,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){var l;const s=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?_t(0,o,2*r):_t(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*sk(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),w7(n,SP,this._instanceIdBuffer,eY,0),(l=n.capabilities.instancing)==null||l.drawArraysInstanced(vt.TRIANGLES,0,3,this._numParticles*r),x7(n,SP,this._instanceIdBuffer,eY)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return br.createVertex(e,hr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new sd(e,SP,{geometry:Dl(VDe)},{geometry:br.createVertex(e,hr.STATIC_DRAW,r)})}};h([f({constructOnly:!0})],b_.prototype,"context",void 0),h([f({constructOnly:!0})],b_.prototype,"view",void 0),h([f({readOnly:!0})],b_.prototype,"updating",null),h([f()],b_.prototype,"_updatingTracking",void 0),b_=h([F("esri.views.3d.environment.Precipitation")],b_);const VDe=Ri().vec3f(S.POSITION),eY=Dl(Ri().f32(S.INSTANCEFEATUREATTRIBUTE),1);function GDe(){const t=new ur;return t.attributes.add(S.POSITION,"vec3"),t.attributes.add(S.COLOR,"vec4"),t.attributes.add(S.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new wi("transform",(e,r)=>jDe(e,r)),new Wt("viewport",(e,r)=>r.camera.fullViewport),new Se("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(b`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(b`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function jDe(t,e){return en(Gm,e.camera.projectionMatrix),Gm[10]=24e-8-1,Gm[11]=-1,Gm[14]=(24e-8-2)*e.camera.near,qi(Gm,Gm,e.camera.viewMatrix),qi(Gm,Gm,t.modelMatrix)}const Gm=xe(),HDe=Object.freeze(Object.defineProperty({__proto__:null,build:GDe},Symbol.toStringTag,{value:"Module"}));let WDe=class extends Ar{constructor(){super(...arguments),this.modelMatrix=xe()}},pue=class fue extends gr{constructor(e){super(e,new Bo,()=>this.destroy())}initializeProgram(e){return new pr(e.rctx,fue.shader.get().build(),cr)}initializePipeline(){return xt({blending:Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),depthTest:{func:Br.LEQUAL},colorWrite:$t})}};pue.shader=new dr(HDe,()=>he(()=>import("./Stars.glsl-564e518f.js"),[]));let Ug=class extends we{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new WDe,this._updatingTracking=new mp}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=yc(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=vi(this._technique),this._vao=Ue(this._vao),yy=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(vt.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||yy==null)return;this._technique=new pue({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=yy.byteLength/tY;const r=new Float32Array(yy,0,2*this._numPoints),i=new Uint8Array(yy,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Tr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),s=en(this._renderParameter.modelMatrix,XDe);dx(s,s,-i*Math.PI),qi(s,YDe,s),dx(s,s,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,s){const n=rY.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const u=r[2*c],d=r[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(d)),o.set(c,1,-Math.sin(u)*Math.sin(d)),o.set(c,2,-Math.cos(d));const p=this._unpackUint8Attributes(i[c]),g=this._hexToRGB(qDe[p[1]]);a.set(c,0,255*g[0]),a.set(c,1,255*g[1]),a.set(c,2,255*g[2]),a.set(c,3,255),l.set(c,p[0])}return new sd(e,cr,{geometry:Dl(rY)},{geometry:br.createVertex(e,hr.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(yy!=null)return null;const e=Zx(async r=>{const{data:i}=await Txe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),yy=i});return e.promise.catch(r=>{gs(r)||ne.getLogger(this.declaredClass).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new X("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/tY;if(r%1!=0||r>5e4||r<5e3)throw new X("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};h([f({constructOnly:!0})],Ug.prototype,"view",void 0),h([f({constructOnly:!0})],Ug.prototype,"requestRender",void 0),h([f({readOnly:!0})],Ug.prototype,"updating",null),h([f()],Ug.prototype,"_loadDataTask",void 0),h([f()],Ug.prototype,"_updatingTracking",void 0),Ug=h([F("esri.views.3d.environment.Stars")],Ug);const qDe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],YDe=XB(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),XDe=XB(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),tY=9,rY=Ri().vec3f(S.POSITION).vec4u8(S.COLOR).f32(S.SIZE);let yy=null;function ZDe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function v$(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function q7(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>ma()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function Y7(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+o*a+s*c-n*l,t[1]=s*u+o*l+n*a-i*c,t[2]=n*u+o*c+i*l-s*a,t[3]=o*u-i*a-s*l-n*c,t}function JDe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-i*a,t}function QDe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-n*a,t[1]=s*l+o*a,t[2]=n*l+i*a,t[3]=o*l-s*a,t}function KDe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function eNe(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function EP(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,u,d,p,g=r[0],y=r[1],_=r[2],v=r[3];return c=s*g+n*y+o*_+a*v,c<0&&(c=-c,g=-g,y=-y,_=-_,v=-v),1-c>ma()?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-i)*l)/u,p=Math.sin(i*l)/u):(d=1-i,p=i),t[0]=d*s+p*g,t[1]=d*n+p*y,t[2]=d*o+p*_,t[3]=d*a+p*v,t}function tNe(t){const e=XC,r=e(),i=e(),s=e(),n=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function rNe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=n*a,t}function B0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function mue(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+o]-e[3*o+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}function iNe(t,e,r,i){const s=.5*Math.PI/180;e*=s,r*=s,i*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return t[0]=n*l*u-o*a*c,t[1]=o*a*u+n*l*c,t[2]=o*l*c-n*a*u,t[3]=o*l*u+n*a*c,t}function sNe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const X7=gu,nNe=oi,oNe=kk,aNe=Y7,lNe=Qx,cNe=gie,uNe=Gk,gue=Bk,hNe=gue,yue=Vk,dNe=yue,Z7=mie,pNe=Pw,fNe=jk;function mNe(t,e,r){const i=pe(e,r);return i<-.999999?(Qe(fd,gNe,e),pl(fd)<1e-6&&Qe(fd,yNe,e),fe(fd,fd),v$(t,fd,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Qe(fd,e,r),t[0]=fd[0],t[1]=fd[1],t[2]=fd[2],t[3]=1+i,Z7(t,t))}const fd=C(),gNe=Ce(1,0,0),yNe=Ce(0,1,0);function _Ne(t,e,r,i,s,n){return EP(iY,e,s,n),EP(sY,r,i,n),EP(t,iY,sY,2*n*(1-n)),t}const iY=zu(),sY=zu();function vNe(t,e,r,i){const s=bNe;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],Z7(t,mue(t,s))}const bNe=Zi();Object.freeze(Object.defineProperty({__proto__:null,add:oNe,calculateW:eNe,conjugate:B0,copy:X7,dot:cNe,equals:fNe,exactEquals:pNe,fromEuler:iNe,fromMat3:mue,getAxisAngle:q7,identity:ZDe,invert:rNe,len:hNe,length:gue,lerp:uNe,mul:aNe,multiply:Y7,normalize:Z7,random:tNe,rotateX:JDe,rotateY:QDe,rotateZ:KDe,rotationTo:mNe,scale:lNe,set:nNe,setAxes:vNe,setAxisAngle:v$,slerp:EP,sqlerp:_Ne,sqrLen:dNe,squaredLength:yue,str:sNe},Symbol.toStringTag,{value:"Module"}));function Cm(t=xNe){return[t[0],t[1],t[2],t[3]]}function i4(t,e,r=Cm()){return te(r,t),r[3]=e,r}function nY(t,e,r=Cm()){return Qe(r,t,e),fe(r,r),r[3]=-uie(t,e),r}function oY(t,e,r=Cm()){return v$(L3,t,aY(t)),v$(lY,e,aY(e)),Y7(L3,lY,L3),wNe(r,pa(q7(r,L3)))}function $pt(t,e,r,i=Cm()){return i4(oie,t,D3),i4(aie,e,cY),i4(Fk,r,uY),oY(D3,cY,D3),oY(D3,uY,i),i}function Ipt(t){return t}function aY(t){return At(t[3])}function wNe(t,e){return t[3]=e,t}const xNe=[0,0,1,0],L3=zu(),lY=zu();Cm();const D3=Cm(),cY=Cm(),uY=Cm();function TNe(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===_l.FINISHED&&(t.fadeIn.factor=0,te(i,sp),t.fadeIn.stage=_l.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=Hs.FINISHED),t.fadeIn.stage===_l.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(O7(t.data)&&t.renderingStage!==hs.RENDERING||t.renderingStage===hs.FADING_TEXTURE_CHANNELS)&&(te(i,sp),t.fadeIn.stage=_l.FADE_IN,t.startTime=e,t.renderingStage===hs.FADING_TEXTURE_CHANNELS&&(t.renderingStage=hs.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===_l.FADE_IN?t.fadeIn.factor=r?me((e-t.startTime)/(_ue*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===_l.FADE_IN&&(t.fadeIn.stage=_l.FINISHED,t.fadeIn.factor=1)}function SNe(t,e,r){const{fadeInOut:i,crossFade:s}=t;i.stage===Hs.FINISHED&&(t.startTime=e,i.factor=1,i.stage=Hs.FADE_OUT),i.factor>0&&i.stage===Hs.FADE_OUT?i.factor=r?1-me((e-t.startTime)/(RNe*r),0,1):0:(i.factor<=0&&i.stage===Hs.FADE_OUT&&(i.factor=0,te(t.parallax.anchorPointClouds,sp)),i.factor<=0&&i.stage===Hs.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=Hs.SWITCH,t.crossFade.enabled=!1,s.factor=1),i.stage===Hs.SWITCH&&(O7(t.data)&&t.renderingStage!==hs.RENDERING||t.renderingStage===hs.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=Hs.FADE_IN,te(t.parallax.anchorPointClouds,sp),t.crossFade.enabled=!1,s.factor=1,t.renderingStage===hs.FADING_TEXTURE_CHANNELS&&(t.renderingStage=hs.SWITCH_CHANNELS)),i.factor<1&&i.stage===Hs.FADE_IN?i.factor=r?me((e-t.startTime)/(_ue*r),0,1):1:i.factor>=1&&i.stage===Hs.FADE_IN&&(i.stage=Hs.FINISHED,i.factor=1))}function ENe(t,e,r,i){const{crossFade:s}=t,n=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(te(t.parallaxNew.anchorPointClouds,sp),t.startTime=e,s.factor=0,t.crossFade.enabled=!0),s.factor<1&&t.crossFade.enabled?s.factor=r?me((e-t.startTime)/(PNe*r),0,1):1:s.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,s.factor=1,te(n,t.parallaxNew.anchorPointClouds),t.renderingStage===hs.FADING_TEXTURE_CHANNELS&&(t.renderingStage=hs.SWITCH_CHANNELS))}function hY(t,e,r,i){const s=t.fadeInOutHeight,n=s.stage===U0.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-n)/(MNe*i);s.factor+=e?-o:o}else s.factor=e?0:1;t.startTimeHeightFade=r,s.factor=me(s.factor,0,1),s.stage=U0.HEIGHT_FADE}function CNe(t,e,r,i,s){t.renderingStage===hs.FINISHED_RENDERING&&(t.renderingStage=hs.FADING_TEXTURE_CHANNELS);const n=Te(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=n-Yt.radius>Kd?1:0),t.isCameraPositionFinal=M0(t.cameraPositionLastFrame,e.eye),fe(sp,e.eye),ee(sp,sp,Yt.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&te(o.anchorPointClouds,sp);const a=Te(le(ONe,o.anchorPointClouds,sp));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==_l.FINISHED?TNe(t,i,s):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==Hs.FINISHED?SNe(t,i,s):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===hs.FADING_TEXTURE_CHANNELS?ENe(t,i,s,(r!==vr.IDLE||!O7(t.data))&&t.renderingStage!==hs.FADING_TEXTURE_CHANNELS):l=!1;const c=n-Yt.radius;if((c>1.7*Kd||c<-Kd)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>Kd||c<-.35*Kd)&&t.fadeInOutHeight.factor<1?hY(t,!1,i,s):c<Kd&&c>-.35*Kd&&t.fadeInOutHeight.factor>0?hY(t,!0,i,s):t.fadeInOutHeight.stage=U0.FINISHED,t.renderingStage===hs.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=hs.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-Yt.radius*Yt.radius,0))/n,nY(dY,o.anchorPointClouds,Pv),Cl(o.transform,qa,Pv[3],Pv),l){const{parallaxNew:u}=t;nY(dY,u.anchorPointClouds,Pv),Cl(u.transform,qa,Pv[3],Pv)}te(t.cameraPositionLastFrame,e.eye)}function ANe(t){return t.crossFade.enabled||t.fadeInOut.stage!==Hs.FINISHED||t.fadeIn.stage!==_l.FINISHED||t.fadeInOutHeight.stage!==U0.FINISHED||t.renderingStage!==hs.FINISHED}const dY=Ce(0,0,1),Pv=Cm(),sp=C(),ONe=C(),_ue=1,RNe=.5,PNe=1.3,MNe=1;let p2=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const s=this._outer.get(e);s?s.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Ts;function pY(t=ie("enable-feature:high-quality-idle")){const e=new p2;return t&&(e.set(vr.IDLE,Ts.Antialiasing,!0),e.set(vr.IDLE,Ts.HighQualityTransparency,!0),e.set(vr.IDLE,Ts.HighQualityAtmosphere,!0),e.set(vr.IDLE,Ts.SSAO,!0),e.set(vr.IDLE,Ts.WaterReflection,!0),e.set(vr.IDLE,Ts.PhysicalPixelRendering,!0)),e.set(vr.IDLE,Ts.HighQualityShadows,!0),e.set(vr.ANIMATING,Ts.HighQualityShadows,!0),e.set(vr.INTERACTING,Ts.HighQualityShadows,!0),e.set(vr.IDLE,Ts.HighQualityVoxel,!0),e}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighQualityVoxel=2]="HighQualityVoxel",t[t.HighQualityAtmosphere=3]="HighQualityAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighQualityShadows=6]="HighQualityShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Ts||(Ts={})),ie("disable-feature:high-quality-idle")?ie.add("enable-feature:high-quality-idle",!1,!0,!0):ie.add("enable-feature:high-quality-idle",!0);var Uw;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(Uw||(Uw={}));var TS;const $Ne=[ae.POSTPROCESSING_ENVIRONMENT_OPAQUE,ae.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let eo=TS=class extends we{constructor(t){super(t),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new s4,this._newWeatherParameters=new s4,this._fadedWeatherParameters=new s4,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin($Ne,this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Ro.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===Ro.Realistic}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Te(this.view.state.camera.eye)-Cr(this.view.spatialReference).radius<=Kd}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return e&&this._context!=null?r??new Ug({view:t,requestRender:()=>this._setNeedsRender()}):(Oe(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Oe(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Oe(t),new b_({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Oe(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Oe(t),new Ra({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Oe(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Cr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Oe(t),new y_({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Oe(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new __({context:r,view:e,rctx:i,viewingMode:s})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([ce(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,highQuality:this.view.qualitySettings.highQualityAtmosphere}),r=>this._updateAtmosphere(r),Ss),ce(()=>this._stars,e),ce(()=>this._precipitation,e),ce(()=>this._clouds,()=>this._updateWeather(),Tr),ce(()=>this._fog,()=>this._updateFogHaze(),Tr),ce(()=>this.view.state.mode,()=>{this._setNeedsRender()},Nr),ce(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Ss)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Oe(this._atmosphere),this._set("_stars",Oe(this._stars)),this._set("_precipitation",Oe(this._precipitation)),this._set("_clouds",Oe(this._clouds)),this._set("_cloudsComposition",Oe(this._cloudsComposition)),this._set("_fog",Oe(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=CIe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(CNe(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===hs.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){var e,r,i,s,n,o,a,l,c;if(t.output===L.Color)switch(t.bindParameters.slot){case ae.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,((e=this.view)==null?void 0:e.qualitySettings.highQualityAtmosphere)||((s=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer)==null?void 0:s.isFeatureEnabled(Ts.HighQualityAtmosphere))),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),ANe(t.bindParameters.cloudsFade)&&this._context!=null&&((n=t.bindParameters.cloudsFade.data)==null?void 0:n.cubeMap)!=null&&this._context.requestRender());break;case ae.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,((o=this.view)==null?void 0:o.qualitySettings.highQualityAtmosphere)||((c=(l=(a=this.view)==null?void 0:a._stage)==null?void 0:l.renderer)==null?void 0:c.isFeatureEnabled(Ts.HighQualityAtmosphere))),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const u=this.view.environment.weather;u.type!=="rainy"&&u.type!=="snowy"||this._precipitation.render(t,u.precipitation,u.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(t),i===Uw.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===_l.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===Hs.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(Oo[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=_t(3e-5,.005,t.weatherAdjustment**3),te(this._newWeatherParameters.fog.color,fY),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=_t(4e-6,2e-4,(t.effect??0)**3),te(this._newWeatherParameters.fog.color,INe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=_t(4e-6,2e-4,(t.effect??0)**3),te(this._newWeatherParameters.fog.color,fY),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==Ro.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Oe(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Oe(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case Ro.Realistic:return Mq;case Ro.Local:return CDe;case Ro.Mars:return MDe;default:case Ro.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||Dp(this.view.spatialReference)?Ro.None:r===Re.Local?Ro.Local:this._context!=null&&Mq.isSupported(this._context)&&jE(this.view.spatialReference)?Ro.Realistic:Lp(this.view.spatialReference)?Ro.Mars:Ro.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{mY=TS.prototype._getAtmosphereClass,TS.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{TS.prototype._getAtmosphereClass=mY}}}};h([f({constructOnly:!0})],eo.prototype,"view",void 0),h([f({readOnly:!0})],eo.prototype,"atmosphere",null),h([f({readOnly:!0})],eo.prototype,"_atmosphereType",null),h([f({type:Boolean,readOnly:!0})],eo.prototype,"updating",null),h([f({readOnly:!0})],eo.prototype,"weatherVisible",null),h([f()],eo.prototype,"_context",void 0),h([f()],eo.prototype,"_atmosphere",void 0),h([f({readOnly:!0})],eo.prototype,"_stars",null),h([f({readOnly:!0})],eo.prototype,"_precipitation",null),h([f({readOnly:!0})],eo.prototype,"_clouds",null),h([f({readOnly:!0})],eo.prototype,"_cloudsComposition",null),h([f({readOnly:!0})],eo.prototype,"_fog",null),h([f({readOnly:!0})],eo.prototype,"weatherEnabled",null),h([f({readOnly:!0})],eo.prototype,"_precipitationEnabled",null),h([f({readOnly:!0})],eo.prototype,"_weatherUpdateParameters",null),eo=TS=h([F("esri.views.3d.environment.EnvironmentRenderer")],eo);let s4=class{constructor(){this.fog=new GLe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,te(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=_t(e.fog.amount,r.fog.amount,i),this.hazeAmount=_t(e.hazeAmount,r.hazeAmount,i),this.fog.strength=_t(e.fog.strength,r.fog.strength,i),Pr(this.fog.color,e.fog.color,r.fog.color,i)}};const INe=Ce(.5,.5,.5),fY=Ce(1.5,1.5,1.5);let mY;function gY(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return LNe(t,e.longitude,e.latitude,r.longitude,r.latitude)}function LNe(t,e,r,i,s){const n=At(r),o=At(s),a=n-o,l=At(e)-At(i),c=Math.sin(a/2),u=Math.sin(l/2),d=2*Cu(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*t;return Math.round(1e4*d)/1e4}function DNe(t,e,r){const i=e.spatialReference,s=Cr(i),n=new at(e.x,t.y,i),o=new at(r.x,t.y,i),a=new at(t.x,e.y,i),l=new at(t.x,r.y,i);return{lon:gY(s.radius,n,o),lat:gY(s.radius,a,l)}}function NNe(t,e,r){const i=e/r,s=At(t),n=Math.sin(i/2),o=Math.cos(s),a=2*Cu(Math.sqrt(n*n/(o*o)));return pa(a)}function FNe(t,e){let r=t/15;return e||(r=Math.round(r)),r}function yY(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=FNe(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var Npt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mA(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var _Y,vY,bY,gU={exports:{}};gU.exports,_Y=gU,vY=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function p(R){return R.valueOf()/l-.5+c}function g(R){return new Date((R+.5-c)*l)}function y(R){return p(R)-u}var _=23.4397*a;function v(R,I){return n(e(R)*r(_)-i(I)*e(_),r(R))}function w(R,I){return s(e(I)*r(_)+r(I)*e(_)*e(R))}function T(R,I,N){return n(e(R),r(R)*e(I)-i(N)*r(I))}function x(R,I,N){return s(e(I)*e(N)+r(I)*r(N)*r(R))}function E(R,I){return a*(280.16+360.9856235*R)-I}function O(R){return a*(357.5291+.98560028*R)}function A(R){return a*(1.9148*e(R)+.02*e(2*R)+3e-4*e(3*R))}function $(R,I){return R+I+102.9372*a+t}function M(R,I){var N=O(R),V=$(N,A(N));return I||(I={dec:0,ra:0}),I.dec=w(V,0),I.ra=v(V,0),I}var U={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(R,I,N,V){var q=a*-N,J=a*I,K=y(R),ge=M(K,d),Me=E(K,q)-ge.ra;return V||(V={azimuth:0,altitude:0}),V.azimuth=T(Me,J,ge.dec),V.altitude=x(Me,J,ge.dec),V}},k=[[-.83,"sunrise","sunset"]];U.addTime=function(R,I,N){k.push([R,I,N])};var B=9e-4;function z(R,I){return Math.round(R-B-I/(2*t))}function Y(R,I,N){return B+(R+I)/(2*t)+N}function W(R,I,N){return u+R+.0053*e(I)-.0069*e(2*N)}function j(R,I,N){return o((e(R)-e(I)*e(N))/(r(I)*r(N)))}function Z(R){var I=a*(134.963+13.064993*R),N=a*(93.272+13.22935*R),V=a*(218.316+13.176396*R)+6.289*a*e(I),q=5.128*a*e(N),J=385001-20905*r(I);return{ra:v(V,q),dec:w(V,q),dist:J}}return U.getTimes=function(R,I,N){var V=a*-N,q=a*I,J=z(y(R),V),K=Y(0,V,J),ge=O(K),Me=A(ge),pt=$(ge,Me),Tt=w(pt,0),et=W(K,ge,pt);function tt(lt){return W(Y(j(lt,q,Tt),V,J),ge,pt)}function Ne(lt){var it=(e(lt)-e(q)*e(Tt))/(r(q)*r(Tt));return it<-1?U.PolarException.MIDNIGHT_SUN:it>1?U.PolarException.POLAR_NIGHT:U.PolarException.NORMAL}var de,rt,kt,Ee,Fe,ze={solarNoon:g(et),nadir:g(et-.5),polarException:U.PolarException.NORMAL};for(de=0,rt=k.length;de<rt;de+=1)Fe=et-((Ee=tt((kt=k[de])[0]*a))-et),ze[kt[1]]=g(Fe),ze[kt[2]]=g(Ee);return ze.polarException=Ne(k[0][0]*a),ze},U.getMoonPosition=function(R,I,N){var V=a*-N,q=a*I,J=y(R),K=Z(J),ge=E(J,V)-K.ra,Me=x(ge,q,K.dec);return Me+=.017*a/i(Me+10.26*a/(Me+5.1*a)),{azimuth:T(ge,q,K.dec),altitude:Me,distance:K.dist}},U.getMoonFraction=function(R){var I=y(R),N=M(I),V=Z(I),q=149598e3,J=o(e(N.dec)*e(V.dec)+r(N.dec)*r(V.dec)*r(N.ra-V.ra)),K=n(q*e(J),V.dist-q*r(J));return(1+r(K))/2},U},(bY=vY())!==void 0&&(_Y.exports=bY);const z1=mA(gU.exports),na={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let N3=class{constructor(e,r){this.direct=e,this.ambient=r}};function UNe(t,e,r,i,s,n){se(n.ambient.color,1,1,1),n.ambient.intensity=na.global.ambient,se(n.direct.color,1,1,1),n.direct.intensity=na.global.direct;const o=e[2],a=me((Math.abs(o)-na.local.altitude)/(na.global.altitude-na.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=z1.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=HNe(t,l,i);else{const u=wue(i);c={direct:{intensity:na.local.directAtNoon*u.direct,color:Ce(1,1,1)},ambient:{intensity:na.local.ambientAtNoon*u.ambient,color:Ce(1,1,1)},timeOfDay:"early afternoon"}}Pr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=_t(c.ambient.intensity,n.ambient.intensity,a),Pr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=_t(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=t!=null?jNe(t,l):1,t!=null?zNe(t,e,r,n.direct.directionToLightSource):vue(s,r,n.direct.directionToLightSource)}function vue(t,e,r){e===Re.Global?fe(l4,t.eye):se(l4,0,0,1),ee(c4,t.viewForward,-1);const i=lP(c4,l4),s=Math.max(i-2*u4,0),n=.85*s/(s+1),o=Math.max(u4,i-u4-n);bc(MY,-o,t.viewRight),De(r,c4,MY),oe(r,r,ee(WNe,t.viewRight,qNe)),fe(r,r)}function zNe(t,e,r,i){const s=GNe,n=$u(VNe);if(r===Re.Global)z1.getPosition(t,0,0,s),se(i,0,0,-1),hx(n,n,-s.azimuth),pL(n,n,-s.altitude),De(i,i,n);else{const o=na.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=me(c,0,1),c<1?(z1.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(i,0,-1,0),dx(n,n,-s.azimuth),hx(n,n,-s.altitude),De(i,i,n)}}function kNe(t,e){if(e===Re.Global)return!0;const r=na.planarDirection;return Math.abs(t)<r.localAltitude}const BNe=Ce(.5773502691896258,-.5773502691896258,.5773502691896258);let bue=class{constructor(){this.ambient={color:Ce(1,1,1),intensity:.55},this.direct={color:Ce(1,1,1),intensity:.55,directionToLightSource:ms(BNe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const VNe=xe(),GNe={azimuth:0,altitude:0};function jNe(t,e){const r=t.valueOf();let i,s;e.polarException===z1.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=i+432e6):e.polarException===z1.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=i+(s-i)/2;return 1-me(Math.abs(r-n)/432e5,0,1)}function wue(t){switch(t){case"disabled":case"sunny":case"cloudy":return new N3(1,1);case"rainy":return new N3(.4,1.2);case"snowy":return new N3(.5,1.3);case"foggy":return new N3(.2,1.6)}}function wY(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const n4=Ce(.01,.01,.01),yU=Ce(1,.6,.5),_U=Ce(1,.98,.98),xY=Ce(1,1,1),o4=Ce(.8,.8,1),vU=Ce(.8,.8,1),bU=Ce(.98,.98,1),TY=Ce(1,1,1),a4=ir(.01,na.local.ambientAtNight),wU=ir(na.local.directAtTwilight,na.local.ambientAtTwilight),xU=ir(.9*na.local.directAtNoon,na.local.ambientAtNoon),SY=ir(na.local.directAtNoon,na.local.ambientAtNoon),EY=xU,CY=_U,AY=bU,OY=wU,RY=yU,PY=vU;function HNe(t,e,r){const i=t.valueOf();let s,n;e.polarException===z1.PolarException.MIDNIGHT_SUN?(s=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===z1.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,d=.06*o,p=s-d/2,g=s+d/2,y=n-d/2,_=n+d/2,v=Ie(),w=C(),T=C();let x="";if(i<p||i>_)Vs(v,a4),te(w,n4),te(T,o4),x="night";else if(i<g){const A=(i-p)/(g-p);au(v,a4,wU,A),Pr(w,n4,yU,A),Pr(T,o4,vU,A),x="sun rising"}else if(i<c){const A=(i-g)/(c-g);au(v,wU,xU,A),Pr(w,yU,_U,A),Pr(T,vU,bU,A),x="early morning"}else if(i<a){const A=(i-c)/(a-c);au(v,xU,SY,A),Pr(w,_U,xY,A),Pr(T,bU,TY,A),x="late morning"}else if(i<u){const A=(i-a)/(u-a);au(v,SY,EY,A),Pr(w,xY,CY,A),Pr(T,TY,AY,A),x="early afternoon"}else if(i<y){const A=(i-u)/(y-u);au(v,EY,OY,A),Pr(w,CY,RY,A),Pr(T,AY,PY,A),x="late afternoon"}else if(i<_){const A=(i-y)/(_-y);au(v,OY,a4,A),Pr(w,RY,n4,A),Pr(T,PY,o4,A),x="sun setting"}let E=0;switch(r){case"rainy":case"foggy":E=.8;break;case"snowy":E=.5}E>0&&(wY(w,E),wY(T,E));const O=wue(r);return{direct:{intensity:v[0]*O.direct,color:w},ambient:{intensity:v[1]*O.ambient,color:T},timeOfDay:x}}const MY=xe(),l4=C(),c4=C(),WNe=C(),u4=.25,qNe=.2;let uh=class extends ys.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Oi,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new d$,this._ambientLight=new D7,this._moonLight=new Rce,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===Re.Global&&jE(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new eo({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([ce(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Nr),ce(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Nr),ce(()=>e.stationary,()=>this._interactingStationaryHandler()),ce(()=>e.environment.lighting.directShadowsEnabled,r,Nr),ce(()=>e.qualitySettings.ambientOcclusion,r,Nr),ce(()=>e.qualitySettings.reflections,r,Nr),ce(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},r,Nr),ce(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Nr),ce(()=>e.environment.weather.type,()=>this._updateLighting(null,Uw.Faded),Nr),ce(()=>this.weatherEnabled,()=>this._updateLighting(null,Uw.Faded),Nr),ce(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Ss),ce(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Ss),ce(()=>e.state.camera,i,Ss),ce(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Oe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!M1(i)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const s=yY(this._referencePosWGS84Comparable,$Y);s!=null&&(r.autoUpdate(null,s),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=jE(this._view.spatialReference);if(i&&!M1(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=C()),i?N3e(s,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=Uw.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=s!=null?YNe:XNe,o=this.weatherVisible?i.environment.weather.type:"disabled";s!=null?UNe(e,s,i.state.viewingMode,o,i.state.camera,n):i.environment.lighting.type==="virtual"&&vue(i.state.camera,i.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;ee(a.intensity,l.color,l.intensity*Math.PI),te(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;ee(c.intensity,n.ambient.color,n.ambient.intensity);const u=this._moonLight;Pr(u.intensity,JNe,QNe,n.globalFactor);const d=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));ee(u.intensity,u.intensity,d),te(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],n.noonFactor,n.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=ZNe;i.setTime((r||this._view.environment.lighting.date).getTime());const s=yY(e,$Y);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=i.getUTCHours()-(s.hours-n.hours),a=i.getUTCMinutes()-(s.minutes-n.minutes),l=i.getUTCSeconds()-(s.seconds-n.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||kNe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),i=this._view.environment.background,s=i instanceof Cle?{type:"color",color:ZB(ht.toUnitRGBA(i.color))}:{type:"color",color:Ct(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=UE(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const n=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=UE(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};h([f({type:Boolean,readOnly:!0})],uh.prototype,"updating",null),h([f()],uh.prototype,"disableQueries",void 0),h([f()],uh.prototype,"_disableWeather",void 0),h([f()],uh.prototype,"weatherEnabled",null),h([f()],uh.prototype,"weatherVisible",null),h([f()],uh.prototype,"referencePositionWGS84Comparable",null),h([f()],uh.prototype,"_renderer",void 0),h([f()],uh.prototype,"_referencePosWGS84Comparable",void 0),uh=h([F("esri.views.3d.environment.SceneViewEnvironmentManager")],uh);const YNe=new bue,XNe=new bue,ZNe=new Date,$Y={hours:0,minutes:0,seconds:0},JNe=Ce(.22,.22,.33),QNe=Ce(.22,.22,.22);var gi;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(gi||(gi={}));var zt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(zt||(zt={}));var xn;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(xn||(xn={}));function pC(t,e){return(t&e)!=0}function b$(t,e,r,i,s,n){t!==0&&(r?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):i!=null?(n.min-=Math.max(0,(e-n.min)*(1-i)),n.max+=Math.max(0,(e-n.max)*(1-i))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const V0={selection:gi.NONE,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:xn.TUMBLE};function xue(t,e,r,i){return e=e||t.viewForward,te(i,e),ee(i,i,Math.sign(pe(e,r))),i}function KNe(t,e,r,i){return s4e(t,e,r,r4e(i,e,r,!0))}function e4e(t,e,r,i){const s=pe(r,le(t,i,e));return oe(t,e,ee(t,r,s))}const t4e={dir:C(),len:0,clip:Ie()};function r4e(t,e,r,i){const s=t4e;return t?(r&&i&&(s.len=ei(e,r)),te(s.dir,t)):i?(s.len=ei(e,r),le(s.dir,r,e),ee(s.dir,s.dir,1/s.len)):(le(s.dir,r,e),fe(s.dir,s.dir)),s}function i4e(t,e,r){const i=pe(t,r.dir),s=-Kr(t,e);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function s4e(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!i4e(t[s],e,i))return!1;return!0}function n4e(t,e,r=V0){const i=J7(t,e,r);if(i===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+i,o=xue(e,r.interactionDirection,l4e(t,e,Math.sign(i),d4e),h4e),a=te(p4e,e.viewForward),l=s.intersectInfiniteManifold(wc(e.eye,o),n,h4);return e.eye=l??s.setAltitude(h4,n,e.eye),e.center=e4e(h4,e.eye,a,e.center),!0}function J7(t,e,r=V0){if(!o4e(t,r)||!t.state.constraints.altitude)return 0;const i=c4e(t.state.constraints.altitude,u4e);a4e(t,r,i);const s=t.renderCoordsHelper.getAltitude(e.eye),n=me(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function o4e(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==zt.TUMBLE||!pC(e.selection,gi.TILT))}function a4e(t,e,r){const i=e.interactionType;if(i===zt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===zt.TUMBLE||i===zt.ZOOM,c=J7(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,b$(c,u,l,a,.05*u,r)}function l4e(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),ee(i,i,r),i}function c4e(t,e){return e.min=t.min,e.max=t.max,e}const u4e={min:0,max:0},h4e=C(),d4e=C(),p4e=C(),h4=C();function Q7(t,e,r=V0){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;F3.min=0,F3.max=i,m4e(t,r,F3);const s=K7(t,e),n=F3.max-s;return n>=-1e-6?0:n}function f4e(t,e,r=V0){const i=Q7(t,e,r);if(i===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=K7(t,e)+i,o=te(y4e,e.eye),a=xue(e,r.interactionDirection,g4e(e,s.renderLocation,b4e),v4e);if(!K0(sae(s.renderLocation,n),wc(e.eye,a),U3))return!1;e.eye=U3;const l=le(_4e,e.eye,o);e.center=oe(U3,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,U3);return u!=null&&(e.center=u),!0}function m4e(t,e,r){const i=e.interactionType;if(i===zt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===zt.ZOOM||i===zt.PAN,c=Q7(t,o),u=c===0?0:K7(t,o);r.min=s,r.max=n,b$(c,u,l,a,.05*u,r)}function K7(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?ei(e.eye,r.renderLocation):0}function g4e(t,e,r){return fm(r,t.eye,e)}const F3={min:0,max:0},y4e=C(),_4e=C(),v4e=C(),b4e=C(),U3=C();var Ai,Yn;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Ai||(Ai={}));let w4e=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Yn.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Yn||(Yn={}));let x4e=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},T4e=class extends x4e{constructor(e,r,i,s){super(e,r,i),this.center=s!=null?ms(s):null}},Tue=class{constructor(e){this.layerUid=e}},HL=class extends Tue{constructor(e,r){super(e),this.graphicUid=r}};function nd(t){return t!=null&&t.dist!=null}function IY(t){return(e,r,i)=>(Pr(LY,e,r,i),!s7(t,LY))}function WL(t){return nd(t)&&t.intersector===Ai.OBJECT&&!!t.target}function qL(t){return nd(t)&&t.intersector===Ai.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const LY=C();let S4e=class{constructor(){this._transform=xe(),this._transformInverse=new z3({value:this._transform},Wn,xe),this._transformInverseTranspose=new z3(this._transformInverse,$l,xe),this._transformTranspose=new z3({value:this._transform},$l,xe),this._transformInverseRotation=new z3({value:this._transform},pce,Zi)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){en(this._transform,e)}multiplyTransform(e){qi(this._transform,this._transform,e)}set(e){en(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},z3=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},E4e=class{constructor(e=0){this.offset=e,this.tmpVertex=C()}applyToVertex(e,r,i){const s=e+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=e+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)jm[n]=e[0+n]+this.localOrigin[n],k3[n]=e[3+n]+this.localOrigin[n],G2[n]=jm[n];const r=this.applyToVertex(jm[0],jm[1],jm[2]);for(let n=0;n<3;++n)e[n]=r[n],e[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)e[a]=Math.min(e[a],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)G2[o]=n&1<<o?k3[o]:jm[o];i(G2)}let s=0;for(let n=0;n<3;++n)jm[n]*k3[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if(!(s&n)){for(let o=0;o<3;++o)G2[o]=s&1<<o?0:n&1<<o?jm[o]:k3[o];i(G2)}}for(let n=0;n<3;++n)e[n]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}};const jm=C(),k3=C(),G2=C();let C4e=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=C(),this._mbs=ss(),this._obb={center:C(),halfSize:Vi(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const s=e,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=e+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],s=e[2]+this.componentLocalOriginLength,n=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),u=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),d=Math.sqrt(l*l+c*c+u*u);if(d<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=s<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const p=Math.max(Math.abs(r),Math.abs(n)),g=Math.max(Math.abs(i),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(p*p+g*g+y*y),v=this._totalOffset/_,w=this._totalOffset/d;return e[0]+=r*(r>0?v:w),e[1]+=i*(i>0?v:w),e[2]+=s*(s>0?v:w),e[3]+=n*(n<0?v:w),e[4]+=o*(o<0?v:w),e[5]+=a*(a<0?v:w),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,vu(this._obb.halfSize,e.halfSize,e.quaternion),oe(this._obb.halfSize,this._obb.halfSize,e.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,le(this._obb.halfSize,this._obb.halfSize,e.center),B0(UY,e.quaternion),vu(this._obb.halfSize,this._obb.halfSize,UY),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},A4e=class{constructor(e=0){this.offset=e,this.sphere=ss(),this.tmpVertex=C()}applyToVertex(e,r,i){const s=this.objectTransform.transform;let n=s[0]*e+s[4]*r+s[8]*i+s[12],o=s[1]*e+s[5]*r+s[9]*i+s[13],a=s[2]*e+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const DY=new A4e;function TU(t){return t!=null?(DY.offset=t,DY):null}const NY=new C4e;function O4e(t){return t!=null?(NY.offset=t,NY):null}const FY=new E4e;function R4e(t){return t!=null?(FY.offset=t,FY):null}const Kg="terrain",UY=zu(),Ax=1e-5;let P4e=class{constructor(e){this.options=new w4e,this._results=new M4e,this.transform=new S4e,this.tolerance=Ax,this.verticalOffset=null,this._ray=vn(),this._rayEnd=C(),this._rayBeginTransformed=C(),this._rayEndTransformed=C(),this.viewingMode=e??Re.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(aOe(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&e$(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Re.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,oe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i??Ax;const o=TU(this.verticalOffset);if(e&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(u=>a(u))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.transformation,s=TU(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),De(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),De(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,d,p,g,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=p?this._results.hud:this._results,v=p?w=>{const T=new T4e(e,a,d,y);w.set(Ai.HUD,T,c,u,qa,g)}:w=>w.set(Ai.OBJECT,{object:e,geometryId:a,triangleNr:d},c,u,l,g);if((_.min.drapedLayerOrder==null||g>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==Yn.MIN&&(_.max.drapedLayerOrder==null||g<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===Yn.ALL)if(p){const w=new SU(this._ray);v(w),this._results.hud.all.push(w)}else{const w=new zw(this._ray);v(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function Fu(t){return new P4e(t)}let M4e=class{constructor(){this.min=new zw(vn()),this.max=new zw(vn()),this.hud={min:new SU(vn()),max:new SU(vn()),all:new Array},this.ground=new zw(vn()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},zw=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ee(B3,this.ray.direction,this.dist),Te(B3)):null}getIntersectionPoint(e){return!!nd(this)&&(ee(B3,this.ray.direction,this.dist),oe(e,this.ray.origin,B3),!0)}getTransformedNormal(e){return te(j2,this.normal),j2[3]=0,uc(j2,j2,this.transformation),te(e,j2),fe(e,e)}constructor(e){this.intersector=Ai.OBJECT,this.normal=C(),this.transformation=xe(),this._ray=vn(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Ai.OBJECT,e$(e,this._ray)}set(e,r,i,s,n,o,a){this.intersector=e,this.dist=i,te(this.normal,s??Fk),en(this.transformation,n??qa),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){e$(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,te(this.normal,e.normal),en(this.transformation,e.transformation)}},SU=class extends zw{constructor(){super(...arguments),this.intersector=Ai.HUD}};function eV(t){return new zw(t)}const B3=C(),j2=Ht();function Sue(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,w$,i)!=null&&Mie(r,w$)}function YL(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function hv(t,e,r,i){const s=t.state.camera.clone();e&&r&&i&&(s.eye=e,s.center=r,s.up=i),$4e(t,s.ray,Hm)||te(Hm,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(Hn(s.eye,Hm)<o){const a=n.collision.enabled;te(_y,s.viewForward),ee(_y,_y,o),a?s.eye=le(w$,Hm,_y):oe(Hm,s.eye,_y);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),u=n.collision.elevationMargin;a&&c<u&&(le(_y,Hm,s.eye),s.eye=l.setAltitude(w$,u,s.eye),oe(Hm,s.eye,_y))}return s.center=Hm,s}function zY(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=YL(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,r,t.renderDataExtent,i,L4e),o=n*n;return Hn(e,r)>o}function $4e(t,e,r){let i=kY[t.viewingMode];i||(i=Fu(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,kY[t.viewingMode]=i);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||zY(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||zY(t,e.origin,r))||!!s&&I4e(e,r,Cr(t.spatialReference).radius)}function I4e(t,e,r){const i=pe(t.origin,t.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return ee(e,t.direction,s/Te(t.direction)),oe(e,e,t.origin),!0}const kY={},w$=C(),Hm=C(),_y=C(),L4e={near:0,far:0};function f2(t,e,r=_u.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const s=YL(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Te(e.eye);if(le(V3,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(D4e,o,e.eye),r===_u.EYE_AND_CENTER)e.center=oe(V3,e.eye,V3);else if(r===_u.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=ee(V3,e.center,l)}return!0}var _u;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(_u||(_u={}));const V3=C(),D4e=C();function G0(t,e,r){t.worldUpAtPosition(e,BY),le(d4,r,e);const i=Te(d4);return i===0?0:rn(pe(d4,BY)/i)}const BY=C(),d4=C();function Eue(t,e,r=V0,i=!0){H2.eyeCenterDistance=0,H2.requiresTwoSteps=!1;const s=tV(t,e,r,void 0,H2);if(s===0)return!1;switch(bc(G3,-s,e.viewRight),r.tiltMode){case xn.LOOK_AROUND:De(Wm,e.viewForward,G3),ee(Wm,Wm,H2.eyeCenterDistance),e.center=oe(e0,e.eye,Wm);break;case xn.TUMBLE:le(Wm,e.center,e.eye),De(Wm,Wm,G3),e.eye=le(e0,e.center,Wm);break;default:r.tiltMode}return e.up=De(e0,e.up,G3),!H2.requiresTwoSteps||!i||Eue(t,e,r,!1)}function tV(t,e,r=V0,i=V0,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,H4e);return j4e(t,r,o),i.interactionType===zt.TUMBLE&&pC(i.selection,gi.ALTITUDE)&&Cue(t,i.interactionStartCamera,o),r.tiltMode===xn.LOOK_AROUND||i.tiltMode===xn.LOOK_AROUND?F4e(t,e,o,s):N4e(t,e,o)}function N4e(t,e,r){const i=G0(t.renderCoordsHelper,e.center,e.eye),s=i-me(i,r.min,r.max);return fC(s)?s:0}function F4e(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return z4e(t,e,r,i);case"local":return U4e(t,e,r,i)}}function U4e(t,e,r,i){const s=G0(t.renderCoordsHelper,e.center,e.eye),n=me(s,r.min,r.max),o=s-n;if(!fC(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function z4e(t,e,r,i){const s=k4e(t,e,W4e),n=me(s.tiltAtCenter,r.min,r.max);if(!fC(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=B4e(s),a=V4e(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=G4e(s,o)),i&&(i.eyeCenterDistance=EU(s,o)),a}function k4e(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Cr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,i,e0);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,n!=null?(r.eyeCenterDistance=ei(e.eye,n),r.tiltAtCenter=G0(t.renderCoordsHelper,n,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=G0(t.renderCoordsHelper,e.center,e.eye):(c2(bL(wL,s),e.ray,e0),r.eyeCenterDistance=ei(e.eye,e0),r.tiltAtCenter=rn(-pe(e.viewForward,fe(e0,e0)))),r.radius=s,r.eyeRadius=Te(e.eye),r.constraints=t.state.constraints,r}function fC(t){return Math.abs(t)>1e-9}function B4e(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let s=i,n=e.clampTilt(r,i);const o=EU(t,n);if(e.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&fC(n-s);){const l=(s+n)/2,c=EU(t,l);fC(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function EU(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-me(e,0,Math.PI),i=Cu(t.radius/t.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return n*t.eyeRadius}function V4e(t,e){const r=Cu(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=Cu(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function G4e(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function j4e(t,e,r){if(e.interactionType===zt.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=e;if(!i)return;const{min:n,max:o}=r,a=tV(t,i,V0,e),l=a===0?0:G0(t.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,e.interactionType===zt.TUMBLE?(pC(e.selection,gi.ALTITUDE)&&Cue(t,i,r),b$(a,l,!0,s,VY,r)):b$(a,l,!1,s,VY,r)}function Cue(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const s=lo(e.center),n=Math.sqrt(s),o=e.distance,a=Cr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-rn(d),r.max)),r.max=Math.min(r.max,Math.PI-rn(u))}const Wm=C(),G3=xe(),e0=C(),VY=At(5),H4e={min:0,max:0},W4e={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},H2={eyeCenterDistance:0,requiresTwoSteps:!1};function q4e(t){return t}const XL=t=>t*t,rV=t=>1-XL(1-t),Y4e=t=>t<.5?XL(2*t)/2:(rV(2*(t-.5))+1)/2,iV=t=>t*t*t,Aue=t=>1-iV(1-t),Oue=t=>t<.5?iV(2*t)/2:(Aue(2*(t-.5))+1)/2,sV=t=>t*t*t*t,Rue=t=>1-sV(1-t),X4e=t=>t<.5?sV(2*t)/2:(Rue(2*(t-.5))+1)/2,nV=t=>t*t*t*t*t,Pue=t=>1-nV(1-t),Z4e=t=>t<.5?nV(2*t)/2:(Pue(2*(t-.5))+1)/2,oV=t=>1-Math.cos(t*Math.PI/2),Mue=t=>1-oV(1-t),J4e=t=>t<.5?oV(2*t)/2:(Mue(2*(t-.5))+1)/2,aV=t=>2**(10*(t-1)),gA=t=>1-aV(1-t),Q4e=t=>t<.5?aV(2*t)/2:(gA(2*(t-.5))+1)/2,lV=t=>-(Math.sqrt(1-t*t)-1),$ue=t=>1-lV(1-t),K4e=t=>t<.5?lV(2*t)/2:($ue(2*(t-.5))+1)/2;function ku(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Bu(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const e5e=Bu(ku(1),1),t5e=Bu(ku(1),0),Iue=Bu(ku(1),.5),r5e=Bu(ku(2),1),i5e=Bu(ku(2),0),s5e=Bu(ku(2),.5),n5e=Bu(ku(3),1),o5e=Bu(ku(3),0),a5e=Bu(ku(3),.5),l5e=Bu(ku(4),1),c5e=Bu(ku(4),0),u5e=Bu(ku(4),.5),h5e={linear:q4e,"in-quad":XL,"out-quad":rV,"in-out-quad":Y4e,"in-coast-quad":e5e,"out-coast-quad":t5e,"in-out-coast-quad":Iue,"in-cubic":iV,"out-cubic":Aue,"in-out-cubic":Oue,"in-coast-cubic":r5e,"out-coast-cubic":i5e,"in-out-coast-cubic":s5e,"in-quart":sV,"out-quart":Rue,"in-out-quart":X4e,"in-coast-quart":n5e,"out-coast-quart":o5e,"in-out-coast-quart":a5e,"in-quint":nV,"out-quint":Pue,"in-out-quint":Z4e,"in-coast-quint":l5e,"out-coast-quint":c5e,"in-out-coast-quint":u5e,"in-sine":oV,"out-sine":Mue,"in-out-sine":J4e,"in-expo":aV,"out-expo":gA,"in-out-expo":Q4e,"in-circ":lV,"out-circ":$ue,"in-out-circ":K4e};function ds(t,e,r=m5e,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<g5e;a++){let l=0;for(const c of f5e)if(pC(r.selection,c.type)){const u=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(s=!0,l+=u)}if(l===0)break}const n=pC(r.selection,gi.COLLISION),o=d5e(r.interactionType,t);return n&&f2(t,i,o)&&(s=!0),s&&i.computeUp(t.state.viewingMode),s}function d5e(t,e){switch(t){case zt.PAN:return _u.EYE_AND_CENTER;case zt.ASCEND:return e.state.isGlobal?_u.EYE_AND_CENTER_SCALE:_u.EYE_AND_CENTER;default:return _u.EYE}}function Mh(t){const e=Math.min(1,t/150);return Oue(e)}function p5e(t,e,r){return tV(t,e,r)*e.distance}const f5e=[{type:gi.TILT,error:p5e,apply:Eue},{type:gi.ALTITUDE,error:J7,apply:n4e},{type:gi.DISTANCE,error:Q7,apply:f4e}],m5e={selection:gi.ALL,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:xn.TUMBLE},g5e=5,Nl=C(),Qa=C(),qm=C(),So=C(),vy=C(),y5e=C(),Fl={upward:Ce(0,0,1),forward:Ce(0,1,0),sideway:Ce(1,0,0)},GY=Zi();let jY=class{constructor(e=Re.Global){this.viewingMode=e,this.center=C(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=ms(Fl.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Re.Global){const n=(Te(this.center)+Te(e.center))/2;r.pan=lP(this.center,e.center)*n}else r.pan=ei(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===Re.Global?SOe(e.center,r.center,i.pan,this.center):Pr(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?_t(e.distance,r.distance,i.zoom):e.distance,this.pitch=_t(e.pitch,r.pitch,i.rotate);let s=e.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=_t(s,n,i.rotate)}copyFrom(e){te(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,te(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,GY);te(this.center,e.center),le(So,e.center,e.eye),El(So,So,r),El(vy,e.up,r),this.distance=Te(So),this.distance!==0&&(So[0]/=this.distance,So[1]/=this.distance,So[2]/=this.distance),this.pitch=this._eyeUpToPitch(So),this.yaw=this._eyeUpToYaw(So,vy),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,GY);Du(r,r),this._axisAngleVec3(Fl.sideway,this.pitch-Math.PI/2,Fl.forward,So),this._axisAngleVec3(Fl.upward,this.yaw,So),this._axisAngleVec3(Fl.sideway,this.pitch-Math.PI/2,Fl.upward,vy),this._axisAngleVec3(Fl.upward,this.yaw,vy),ee(So,So,this.distance),El(So,So,r),El(vy,vy,r),e.center=this.center,e.eye=le(So,this.center,So),e.up=vy}_axisAngleVec3(e,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return ee(Nl,i,n),Qe(Qa,e,i),ee(Qa,Qa,o),ee(qm,e,(1-n)*pe(e,i)),oe(s,oe(s,Nl,Qa),qm)}_lookAtOrientation(e,r=Zi()){return this._upAtLookAt(e,qm),Qe(Nl,this.lookAtDirection,qm),fe(Nl,Nl),Nl[0]===0&&Nl[1]===0&&Nl[2]===0&&te(Nl,Fl.sideway),Qe(Qa,qm,Nl),fe(Qa,Qa),r[0]=Nl[0],r[1]=Qa[0],r[2]=qm[0],r[3]=Nl[1],r[4]=Qa[1],r[5]=qm[1],r[6]=Nl[2],r[7]=Qa[2],r[8]=qm[2],r}_upAtLookAt(e,r){return this.viewingMode===Re.Local?te(r,Fl.upward):fe(r,e)}_eyeUpToPitch(e){return Math.PI-lP(Fl.upward,e)}_eyeUpToYaw(e,r){const i=y5e;return Math.abs(r[2])<.5?(te(i,r),e[2]>0&&ee(i,i,-1)):te(i,e),Qe(Qa,i,Fl.upward),fe(Qa,Qa),lP(Fl.sideway,Qa,Fl.upward)}};const x$={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let _5e=class Lue{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:x$.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Lue(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:x$.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},v5e=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-u)/(d-u)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},p4=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}};function b5e(t,e,r){const i=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function w5e(t,e,r){const i=1/e,s=Math.log(t.compared.sourceZoom*i),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function x5e(t,e,r){const i=e-t.compared.sourceZoom,s=1/i,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function T5e(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function S5e(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function E5e(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function C5e(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function A5e(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function O5e(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function R5e(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function P5e(t,e,r){const i=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*s*n*a+t.halfWindowSize*i*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function M5e(t,e,r){const i=e-t.compared.targetZoom,s=1/i,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function $5e(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function I5e(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function L5e(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function D5e(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-i):s*(e+i)}function N5e(t,e){let r=F5e(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?T5e:b5e,a=s?S5e:w5e,l=s?E5e:x5e,c=n?$5e:R5e,u=n?I5e:P5e,d=n?L5e:M5e,p=E=>o(t,E,i)+C5e(t,E,i)+c(t,E,i),g=E=>a(t,E,i)+A5e(t,E,i)+u(t,E,i),y=E=>l(t,E,i)+O5e(t,E,i)+d(t,E,i);let _=p(r);const v=D5e(t);let w;const T=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<T;w++){const O=(g(r)+1e-6)/y(r);if(isNaN(O)||r>=x&&O<0){if(!isFinite(x))return null;r=x,_=p(r);break}if(r-=O,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const A=p(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function F5e(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let U5e=class extends v5e{constructor(e,r){super(),this._preallocSegments=[new p4,new p4,new p4],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=N5e(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=rV(i.zoom):e===this._descensionSegment&&(i.zoom=XL(i.zoom)),i}_updateWithApex(e,r){const[i,s,n]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const z5e={zoom:0,pan:0,rotate:0};let k5e=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new _5e(e),this.path=new U5e}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings($te(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?Iue:gA)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,z5e);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const s=r.minDuration!=null?r.minDuration:x$.minDuration/i,n=r.maxDuration!=null?r.maxDuration:x$.maxDuration/i;return Math.min(Math.max(s,e),n)}};const B5e=C();let V5e=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new k5e(()=>new jY(e)),this._current=new jY(e)}update(e,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=le(B5e,r.center,e.center),a=Te(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),te(s.lookAtDirection,o),te(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new ot,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+$te(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var $i;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})($i||($i={}));let Mf=class extends we{constructor(e){super(e),this.state=$i.Ready}get active(){return this.state===$i.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=$i.Stopped,!0)}finishController(){this.state=$i.Finished}get steppingFinished(){return!1}};h([f({constructOnly:!0})],Mf.prototype,"view",void 0),h([f({readOnly:!0})],Mf.prototype,"active",null),h([f()],Mf.prototype,"state",void 0),h([f({readOnly:!0})],Mf.prototype,"isInteractive",null),Mf=h([F("esri.views.3d.state.controllers.CameraController")],Mf);let mC=class extends Mf{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(wr()),this._asyncResult=null),this.state===$i.Finished||this.state===$i.Stopped?(CI(e),this.state===$i.Finished?e.resolve():e.reject(wr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=$i.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==$i.Ready&&this.state!==$i.Running||(this.viewAnimation.state===bx.State.FINISHED?this.finish():this.viewAnimation.state===bx.State.STOPPED&&(this.state=$i.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===$i.Finished?this.viewAnimation.finish():this.state===$i.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===$i.Finished?this._asyncResult.resolve():this._asyncResult.reject(wr()))}finish(){this.finishController()}};mC=h([F("esri.views.3d.state.controllers.AnimationController")],mC);let Bf=class extends mC{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new V5e(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new bx}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);j3.copyFrom(this.view.state.camera);const s=Fu(this.view.state.viewingMode);this.intersectionHelper.intersectRay(j3.ray,s,HY)&&(j3.center=HY),this.animation.update(j3,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?h5e[e.easing]:e.easing}}};h([f({constructOnly:!0})],Bf.prototype,"mode",void 0),h([f({readOnly:!0})],Bf.prototype,"isInteractive",null),Bf=h([F("esri.views.3d.state.controllers.PointToPointAnimationController")],Bf);const j3=new ot,HY=C();function ZL(t=j5e){return[t[0],t[1],t[2],t[3]]}function gC(t,e){return G5e(t[0],t[1],t[2],e,JB.get())}function G5e(t,e,r,i,s=ZL()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function cV(t,e,r){return Qe(r,t,e),fe(r,r),r[3]=vL(t,e),r}const j5e=[0,0,1,0];function Due(t,e,r){return H5e(t,t.screenToRender(e,$e.get()),r)}function H5e(t,e,r){const i=Vs($e.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const s=Vs($e.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,$e.get());return n==null?null:(le(r.direction,n,r.origin),r)}function m2(t,e,r){return uV(t,t.screenToRender(e,$e.get()),r)}function uV(t,e,r){te(r.origin,t.eye);const i=se($e.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(i,$e.get());return s==null?null:(le(r.direction,s,r.origin),r)}function hV(t,e,r,i){const s=m2(e,r,W5e);return K0(t,s,i)}const W5e=vn();var Ox;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(Ox||(Ox={}));const Nue=30,T$=[1,3e8],JL=80,Fue=8,Uue=200,zue=1508e5,kue=5,Bue=50,q5e=5,Y5e=10,f4=90,dv={exclude:new Set([Kg])};function a1(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function CU(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function j0(t,e,r){const i=bc(QB.get(),r[3],r);i==null||foe(i,qa)||(le(Dr,t.eye,e),De(Dr,Dr,i),t.eye=oe(Dr,Dr,e),le(Dr,t.center,e),De(Dr,Dr,i),t.center=oe(Dr,Dr,e),t.up=De(Dr,t.up,i))}function X5e(t,e,r,i){return av(t,Due(e,r,fV),i)}function AU(t,e,r,i){return av(t,m2(e,r,fV),i)}function dV(t,e,r,i){const s=$e.get();let n=1-r;le(s,e,t.eye);const o=Te(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ee(s,s,n),t.eye=oe(Dr,t.eye,s),t.center=Pr(Dr,t.center,e,n))}function Vue(t,e,r){e.getScreenCenter(WY),hV(t,e,WY,Dr)&&(e.center=Dr);const i=e.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=ee($e.get(),e.viewForward,s);e.eye=le(Dr,e.center,n)}const WY=Li();function m4(t,e){se(e,0,0,0);for(const r of t)oe(e,e,r);ee(e,e,1/t.length)}function CP(t,e,r,i){return Math.sin(t/Te(e))*(r+i.radius)}function qY(t,e,r,i){return CP(Math.PI/2,e,r,i)+(t-Math.PI/2)}var bn;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(bn||(bn={}));const YY={Elevation:3e4,Angle:At(16)},H3={Pole:.95,Angle:At(18),Tilt:45},Gue=At(80);function jue(t,e,r,i,s,n){const o=C(),a=ss();let l=!0,c=!0;return t.intersectScreen(r,o,n)?a[3]=Te(o):(c=!1,e.aboveGround&&s!==Ox.Ellipsoid?a[3]=Math.max(Te(e.center),.9*i.radius):a[3]=Te(e.eye)-e.relativeElevation,s===Ox.Silhouette?yC(a,e,r,o):l=hV(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function QL(t,e,r){return Te(t.eye)-r.radius>YY.Elevation?bn.Horizontal:(m2(t,e,rX),-Math.sign(t.relativeElevation)*(.5*Math.PI+vL(t.eye,rX.direction))<YY.Angle?bn.Vertical:bn.Horizontal)}function Hue(t,e,r){le(g4,r,e),t.eye=le(Dr,t.eye,g4),t.center=le(Dr,t.center,g4)}const g4=C();function yC(t,e,r,i){const s=m2(e,r,fV);return s!=null&&(c2(t,s,W3),K0(t,s,i)?!(Hn(W3,s.origin)<Hn(i,s.origin))||(te(i,W3),!1):(le(Mv,e.eye,e.center),fe(Mv,Mv),hae(Mv,-pe(fe(Mv,Mv),W3),XY),av(XY,s,i),!1))}const W3=C(),Mv=C(),XY=_r();function Wue(t,e,r,i,s,n){let o=0;if(Qe(C$,t,e),le(Z3,t,e),Te(t)<=s||!i.aboveGround){Qe(r,Z3,i.eye);const a=pe(t,e)/(Te(t)*Te(e));if(a<.9999)o=rn(a);else{const c=Te(Qe(C(),t,e))/(Te(t)*Te(e));o=Cu(c)}const l=Math.cos(me(I0.normalize(At(n)),0,Gue));o=-o-Math.max(0,Te(e)-s)/(l*s)}else le(ZY,i.eye,i.center),Qe(r,Z3,ZY),o=-Te(Z3)/s;return fe(r,r),ee(r,r,Te(C$)),o}const ZY=C();function JY(t,e,r,i){let s,n;const o=Math.cos(me(I0.normalize(At(i)),0,Gue));return s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):rn(e/r),n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):rn(t/r),(n-s)*r}function Z5e(t,e,r,i,s,n,o,a,l,c){const u=JY(t[2],e[2],n[3],a),d=l?JY(t[0],e[0],n[3],180):e[0]-t[0],p=Math.sin(o)*d-Math.cos(o)*u,g=Math.cos(o)*d+Math.sin(o)*u;fe(Dr,s);const y=l?p/Math.sqrt(Math.abs(n[3]**2-pe(r,Dr)**2)):p/n[3],_=g/Math.sqrt(Math.abs(n[3]**2-pe(r,i)**2));Qt(c,y,_)}function que(t,e,r,i,s,n,o,a,l,c){Qe(C$,t,e),J9(n.up,n.eye,q3,Y3,X3),J9([0,0,1],n.eye,Wf,S0,Jue),te(r,S0),te(i,Wf),fe(r,r),ee(r,r,Te(C$)),OW(t,fe(Y3,Y3),fe(X3,X3),fe(q3,q3),QY),OW(e,Y3,X3,q3,KY),Z5e(QY,KY,t,Wf,S0,o,a,l,c,s)}function J5e(t,e,r,i,s,n,o){bc(S$,s,i),bc(E$,o,n),qi(gw,S$,E$),le(e,t,r),De(e,e,gw),oe(e,e,r)}function Yue(t,e,r,i,s,n){bc(S$,i,r),bc(E$,n,s),qi(gw,S$,E$),le(Dr,t.eye,e),De(Dr,Dr,gw),t.eye=oe(Dr,Dr,e),le(Dr,t.center,e),De(Dr,Dr,gw),t.center=oe(Dr,Dr,e),le(Dr,t.up,e),De(Dr,Dr,gw),t.up=oe(Dr,Dr,e)}function pV(t,e,r,i,s,n){return(Math.abs(i)>Math.PI-H3.Angle||Math.abs(i)<H3.Angle)&&(Math.abs(t[2])<r*H3.Pole||Math.abs(e)>r)&&n.aboveGround&&s<H3.Tilt}function Xue(t,e,r,i,s,n){if(n)cV(r,i,eX),j0(e,t,eX);else{const o=Wue(r,i,tX,e,t[3],s);j0(e,t,gC(tX,o))}}function Zue(t,e,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,u;te(by,i),J3.copyFrom(e);for(let d=0;d<a&&Hn(r,by)>l&&(c=Hn(r,by),que(r,by,S0,Wf,W2,J3,t,s,n,o),Yue(J3,t,Wf,W2[1],S0,W2[0]),J5e(by,by,t,Wf,W2[1],S0,W2[0]),u=Hn(r,by),u<c||d===0);d++)e.copyFrom(J3)}function Q5e(t,e,r,i,s,n,o){pV(r,pe(e.up,r),t[3],-I0.normalize(At(s)),n,e)?Zue(t,e,r,i,-I0.normalize(At(s)),n,o):Xue(t,e,r,i,n,o)}function K5e(t,e,r,i,s,n){const{eye:o}=t;J9([0,0,1],o,Wf,S0,Jue);const a=e.translation[0]*r.pan,l=s.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-pe(t.center,Wf)**2/Te(t.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(Cl(i.pan.matrix,i.pan.matrix,u,Wf),i.pan.enabled=!0,s.mode){case"pan":Cl(i.pan.matrix,i.pan.matrix,d,S0),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function eFe(t,e,r,i,s){const{eye:n,viewRight:o}=t,a=Qe($e.get(),o,n),l=e.translation[0]*r.pan;switch(l!==0&&(Cl(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(Cl(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function tFe(t,e,r,i,s,n,o,a,l){pV(t.center,pe(t.up,t.center),Te(t.center),-I0.normalize(At(n)),o,e)?K5e(e,r,i,a,l,-I0.normalize(At(s))):eFe(e,r,i,a,l)}const Wf=C(),S0=C(),Jue=C(),q3=C(),Y3=C(),X3=C(),QY=C(),KY=C(),W2=Ie(),eX=ZL(),S$=xe(),E$=xe(),gw=xe(),by=C(),Dr=C(),Z3=C(),J3=new ot,C$=C(),tX=C(),fV={origin:C(),direction:C()},rX={origin:C(),direction:C()},iX=.6,y4=4,rFe=60;let A$=class extends Bf{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new ot,this._tmpViewDir=C(),this._tmpRayDir={origin:C(),direction:C()},this._targetOnSphere=C(),this._tmpCenter=C(),this._constraintOptions={selection:gi.ALL_EXCEPT_COLLISION,interactionType:zt.ZOOM,interactionFactor:null,interactionStartCamera:new ot,interactionDirection:null,tiltMode:xn.TUMBLE},this._sphere=ss()}initialize(){this._intersector=Fu(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?dv:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:te(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:gA}}_updateCamera(e,r,i,s,n){const o=Cr(this.view.spatialReference),a=QL(e,s,o),l=Math.abs(this.view.camera.position.z);fe(K3,e.eye),ee(K3,K3,-1),m2(e,s,this._tmpRayDir),fe(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=me(Math.min(Fue,1/Math.abs(pe(K3,this._tmpRayDir.direction)))*l,Uue,zue);if(a===bn.Horizontal){let u=iX**r;this._sphere[3]=Te(i),le(this._tmpViewDir,e.center,e.eye);const d=Math.min(Te(this._tmpViewDir),c);let p=d*u;if(u<=1&&p<y4&&(p=y4,u=p/d),Math.abs(d-p)<1e-6)return;const g=Te(e.center);if(this._sphere[3]!==g){const y=this._sphere[3]+u*(g-this._sphere[3]);e.center=ee(Q3,e.center,y/g)}ee(this._tmpViewDir,this._tmpViewDir,-u),e.eye=oe(Q3,e.center,this._tmpViewDir),ds(this.view,e,this._constraintOptions),Hn(i,e.center)>1e-12&&hV(this._sphere,e,s,this._targetOnSphere)&&Q5e(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=iX**Math.abs(r);const d=r>0?1:-1;le(this._tmpViewDir,i,e.eye);const p=Te(this._tmpViewDir),g=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,rFe);let y=g??c;y=n&&r>0?Math.min(y,p):y,ee(this._tmpRayDir.direction,this._tmpRayDir.direction,y),oe(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*u;const v=Math.max(y4,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,u=_/y),Math.abs(y-_)<1e-6)return;ee(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-u)),e.eye=oe(Q3,e.eye,this._tmpRayDir.direction),e.center=oe(Q3,e.center,this._tmpRayDir.direction)}f2(this.view,e)}};A$=h([F("esri.views.3d.state.controllers.global.ZoomStepController")],A$);const Q3=C(),K3=C(),iFe=.6,sFe=4,nFe=60;let O$=class extends Bf{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new ot,this._tmpRayDir=C(),this._tmpCenter=C(),this._constraintOptions={selection:gi.ALL,interactionType:zt.ZOOM,interactionFactor:null,interactionStartCamera:new ot,interactionDirection:null,tiltMode:xn.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(i.camera);const n=Fu(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?dv:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:te(this._zoomLocation,this._tmpCamera.center);const a=iFe**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,nFe);le(eO,this._tmpCamera.eye,this._zoomLocation),fe(eO,eO);const c=me(Math.min(Fue,1/Math.abs(pe(oFe,eO)))*Math.abs(this.view.camera.position.z),Uue,zue);if(l=l??c,l){const u=C();le(u,this._zoomLocation,this._tmpCamera.eye),(l<Te(u)||!o)&&(fe(u,u),oe(this._zoomLocation,this._tmpCamera.eye,ee(u,u,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:gA}}_updateCamera(e,r,i){le(this._tmpRayDir,i,e.eye);const s=Te(this._tmpRayDir);let n=s*r;const o=r<=1,a=Math.max(sFe,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,r=n/s),Math.abs(s-n)<1e-6||(ee(this._tmpRayDir,this._tmpRayDir,r),e.eye=le(sX,i,this._tmpRayDir),e.center=Pr(sX,e.center,i,1-r),ds(this.view,e,this._constraintOptions)))}};O$=h([F("esri.views.3d.state.controllers.local.ZoomStepController")],O$);const sX=C(),oFe=Ce(0,0,1),eO=C();function aFe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function mV(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let lFe=class extends Zn{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(aFe(r,"primary")){const i=this._view.state.isGlobal?new A$({view:this._view,mode:"animation"}):new O$({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Li(r.x,r.y)),e.stopPropagation()}}};function cFe(t,e,r){return t===Re.Global?new hFe(r):new uFe(e,r)}let uFe=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Cr(r),this._unitInMeters=fa(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,s,n){var x;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(i=i??new Wr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},d=Math.max(u.x,u.y,u.z);le(wy,r,e),$v[0]=wy[0]>0?i.xmax:i.xmin,$v[1]=wy[1]>0?i.ymax:i.ymin,$v[2]=wy[2]>0?d/2:-d/2,le($v,$v,e),fe(wy,wy);const p=1.1*pe($v,wy)*this._unitInMeters,g=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=y*fFe*this._unitInMeters,v=y*mFe*this._unitInMeters,w=me((o-v)/(_-v),0,1)**3,T=Math.min(_t(g,p,w),g)*Math.max(Math.log(Math.abs(l)),1);return Que(Math.min(T,Math.max(34064e4,d))/this._unitInMeters,dFe,this._unitInMeters,n)}},hFe=class{constructor(e){this._referenceEllipsoid=Cr(e)}compute(e,r,i,s,n){n||(n={near:0,far:0});const o=Te(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),u=Math.max(c,Math.abs(a)),d=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return Que(1.2*_t(d,p,_7(u)),me(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function Que(t,e,r,i){const s=pFe/r;return t/e>s?(i.far=t,i.near=i.far/e):(i.near=s,i.far=i.near*e),i}const dFe=2e4,pFe=2,fFe=.001,mFe=1e-4,$v=C(),wy=C();let AP=class extends we{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&Sue(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>f2(this.view,e,_u.EYE_AND_CENTER))}};h([f({constructOnly:!0})],AP.prototype,"view",void 0),AP=h([F("esri.views.3d.state.ElevationCollisionConstraint")],AP);let SS=class extends we{constructor(e){super(e),this.nearFarHeuristic=cFe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ce(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(s=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),ce(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ce(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Nr),ce(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(s=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),Nr),ce(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),Nr),ce(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),Nr),ce(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Nr),ce(()=>{var e,r,i,s,n,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Nr)]),this.view.state.isLocal&&this.addHandles(ce(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Tr)),this._updateNearFar(),this.view.state.viewingMode!==Re.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new AP({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,YL(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(gi.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Re.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(At(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(pa(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,s=3*r/Math.atan(i.camera.fov/2);s!==i.constraints.distance&&(i.constraints.distance=s)}_reapplyConstraints(e=gi.ALL){this.view.state.updateCamera(r=>ds(this.view,r,{selection:e,interactionType:zt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:xn.TUMBLE}))}};h([f({constructOnly:!0})],SS.prototype,"view",void 0),h([f({readOnly:!0})],SS.prototype,"surfaceCollisionConstraint",void 0),SS=h([F("esri.views.3d.state.ConstraintsManager")],SS);let t0=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=hC(),this._points=Tce(),this.lines=new Array(12),this._origin=C(),this._direction=C(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:C(),endpoint:null}}update(e){Sce(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),te(this._origin,e.eye),te(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)te(this._points[r],e[r]);Ece(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return m0(this.frustum,e)}intersectsRay(e){return mLe(this.frustum,e)}intersectsLineSegment(e,r){return gLe(this.frustum,e,r)}intersectsPoint(e){return Cce(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;_4(this.lines[r],e[r],e[i]),_4(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),_4(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function _4(t,e,r){t.origin=e,t.endpoint=r,fm(t.direction,e,r)}t0.planePointIndices=yLe,t0.nearFarLineIndices=[[je.NEAR_BOTTOM_LEFT,je.FAR_BOTTOM_LEFT],[je.NEAR_BOTTOM_RIGHT,je.FAR_BOTTOM_RIGHT],[je.NEAR_TOP_RIGHT,je.FAR_TOP_RIGHT],[je.NEAR_TOP_LEFT,je.FAR_TOP_LEFT]];let dE=class extends Mf{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=$i.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||Sue(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),f2(this.view,e,_u.EYE_AND_CENTER)||this.constraintEnabled||(this.state=$i.Stopped)})}};h([f({constructOnly:!0})],dE.prototype,"desiredCamera",null),dE=h([F("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],dE);const gFe=C(),tO=C();function gV(){return{direction:C(),up:C()}}function Kue(t,e,r,i,s){let n=fe(gFe,t),o=pe(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(pe(e,i)),o<.99?(te(n,e),a&&ee(n,n,-1)):n=null);let l=0;if(n){ee(tO,i,pe(i,n)),le(n,n,tO);const u=pe(n,s)/(Te(n)*Te(s));Qe(tO,n,s),l=(pe(tO,i)>0?1:-1)*pa(rn(u))}const c=pa(rn(-pe(i,t)/Te(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const ehe=Ce(0,1,0),the=Ce(0,0,1),q2=xe(),qp=C(),Yp=C();function rhe(t,e,r,i=gV()){const{direction:s,up:n}=i;return aoe(q2,-At(e)),hx(q2,q2,At(r)),De(s,the,q2),ee(s,s,-1),De(n,ehe,q2),i}function yFe(t,e,r,i){return Kue(e,r,i,the,ehe)}function _Fe(t,e,r,i){const s=rhe(t,r,i),n=C();return ee(n,s.direction,-e),oe(n,n,t),{up:s.up,eye:n,heading:r,tilt:i}}function vFe(t){return pa(t)}function bFe(t){return At(t)}function ihe(t,e,r,i,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return bo(e,qp,n),bo(e,Yp,n),qp[0]-=r/2,Yp[0]+=r/2,qp[1]-=i/2,Yp[1]+=i/2,wn(qp,n,qp,o),wn(Yp,n,Yp,o),s?(s.xmin=qp[0],s.ymin=qp[1],s.xmax=Yp[0],s.ymax=Yp[1],s.spatialReference=o):s=new Wr(qp[0],qp[1],Yp[0],Yp[1],o),s}const wFe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:yFe,eyeForCenterWithHeadingTilt:_Fe,eyeTiltToLookAtTilt:bFe,headingTiltToDirectionUp:rhe,lookAtTiltToEyeTilt:vFe,toExtent:ihe},Symbol.toStringTag,{value:"Module"})),she=Ce(0,0,1),nhe=fe(C(),Ce(1,1,1)),xFe=new $0(-180,180),Y2=xe(),Wg=C(),Iv=C();function ohe(t,e,r,i=gV()){Qe(Wg,t,she),pe(Wg,Wg)===0&&Qe(Wg,t,nhe),bc(Y2,-At(e),t),Cl(Y2,Y2,-At(r),Wg);const{up:s,direction:n}=i;return Qe(s,Wg,t),fe(s,s),De(s,s,Y2),fe(n,t),zo(n,n),De(n,n,Y2),i}function TFe(t,e,r,i){const s=Wg,n=Iv;return fe(s,t),Qe(Iv,s,she),pe(Iv,Iv)===0&&Qe(Iv,s,nhe),Qe(n,Iv,s),Kue(e,r,i,s,n)}function SFe(t,e,r,i){const s={eye:C(),up:null,tilt:i,heading:r},n=Wg;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=At(r),l=At(i),c=Math.sin(a),u=Math.cos(a),d=Math.sin(l),p=Math.cos(l),g=Te(n);let y;if(Math.abs(l)<1e-8)y=o+g;else{const Z=g/d,R=Cu(o/Z),I=Math.PI-l-R;y=Z*Math.sin(I)}const _=p*o,v=o*o*(d*d),w=u*u*v,T=y-_,x=T*T,E=w*(w+x-n[1]*n[1]);if(E<0)return ee(s.eye,n,y/g),s.tilt=0,rO(s,t);const O=Math.sqrt(E),A=n[1]*T,$=w+x;let M;if(M=u>0?-O+A:O+A,Math.abs($)<1e-8)return g<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ee(s.eye,n,y/g),s.tilt=0,v4(s.eye),rO(s,t);s.eye[1]=M/$;const U=c*c*v,k=d*o,B=u*k*s.eye[1],z=s.eye[1]*s.eye[1],Y=1-z,W=Math.sqrt(Y),j=w*z+U-2*B*W*T+Y*x;return Math.abs(j)<1e-8?(ee(s.eye,n,y/g),s.tilt=0,v4(s.eye),rO(s,t)):(s.eye[0]=(Y*(y*n[0]-_*n[0])-k*W*(n[0]*s.eye[1]*u+n[2]*c))/j,s.eye[2]=(Y*(y*n[2]-_*n[2])-k*W*(n[2]*s.eye[1]*u-n[0]*c))/j,ee(s.eye,s.eye,y),v4(s.eye),rO(s,t))}function v4(t){const e=t[1];t[1]=-t[2],t[2]=e}function rO(t,e){const r=ohe(e,t.heading,t.tilt);return t.up=r.up,t}function EFe(t,e,r){const i=Te(e),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),n=Cu(r/(s/Math.sin(t)));return pa(t-n)}function CFe(t,e,r){const i=At(t),s=Te(e);return Cu(r/(s/Math.sin(i)))+i}function ahe(t,e,r,i,s){let n,o,a,l;const c=e.latitude,u=Cr(t.spatialReference).radius,d=e.longitude,p=NNe(c,r,u)/2;n=d-p,o=d+p;const g=At(c),y=(1+Math.sin(g))/(1-Math.sin(g)),_=(y+1)*Math.tan(i/u/2),v=_*_;function w(x){const E=Math.PI/2;return(x=xTe.normalize(x,-E))>E&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+i/u,a=w(a),l=w(l),l<a){const x=l;l=a,a=x}if(a=Math.max(pa(a),-90),l=Math.min(pa(l),90),o=xFe.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const T=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:yt.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=T):s=new Wr(n,a,o,l,T),t.spatialReference&&t.spatialReference.isWebMercator&&Ow(s,!1,s),s}const AFe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:TFe,eyeForCenterWithHeadingTilt:SFe,eyeTiltToLookAtTilt:CFe,headingTiltToDirectionUp:ohe,lookAtTiltToEyeTilt:EFe,toExtent:ahe},Symbol.toStringTag,{value:"Module"}));function R$(t){return t.type==="point"}let yV=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function lhe(t){return"array"in t}function cp(t,e,r="ground"){if(R$(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(lhe(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function P$(t,e){return t!=null&&(e==null||(e===Re.Local?!t.isGeographic||t.isWGS84||t.wkid===pu.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===pu.CGCS2000||t.wkid===pu.GCSMARS2000||t.wkid===pu.GCSMARS2000_SPHERE||t.wkid===pu.GCSMOON2000))}const che=ne.getLogger("esri.views.3d.support.cameraUtils"),uhe=39.37,hhe=96,OU=1,OFe=8,RFe=5,dhe=1,nX=C(),PFe={heading:0,tilt:0},r0=new at,MFe=new $0(-20037508342788905e-9,20037508342788905e-9),$Fe=new $0(-180,180);var yo;function yA(t){return t.spatialReference||yt.WGS84}function g2(t){return t.viewingMode==="global"?AFe:wFe}function IFe(t,e,r,i,s){return g2(t).headingTiltToDirectionUp(e,r,i,s)}function Af(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=g2(t).headingTiltToDirectionUp,s=C();if(!bo(e.position,s,r))return null;const n=i(s,e.heading,e.tilt);ee(n.direction,n.direction,t.state.camera.distance),oe(n.direction,n.direction,s);const o=hv(t,s,n.direction,n.up);return o.fov=At(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(yo||(yo={}));const Lv=C();function Rx(t,e,r){const i=t.renderSpatialReference,s=KL(t,e.eye,e.viewForward,e.up,PFe);let n=yA(t);return wn(e.eye,i,Lv,n)||(n=yt.WGS84,wn(e.eye,i,Lv,n)),r==null?new Ru(new at(Lv,n),s.heading,s.tilt,pa(e.fov)):(r.position.x=Lv[0],r.position.y=Lv[1],r.position.z=Lv[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=pa(e.fov),r)}function _V(t,e,r){const i=t.state.camera,s=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===Re.Global&&r!=null&&(e*=Math.cos(At(r))),e/=t.renderCoordsHelper.unitInMeters,s/(hhe*uhe/e)/Math.tan(i.fovX/2)}function k1(t,e,r){const i=t.state.camera,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=hhe*uhe/(n/s);return t.renderCoordsHelper.viewingMode===Re.Global&&r!=null&&(o/=Math.cos(At(r))),o*t.renderCoordsHelper.unitInMeters}function phe(t,e,r,i,s,n){return fhe(t,e,_V(t,r,e.latitude),i,s,n)}function fhe(t,e,r,i,s,n){if(l1(n)){const a=new y2(n.signal);return _C(t,i.heading,i.tilt,e,r,s,a),void a.resolver.promise.then(l=>{const c=$$(t,l,i.fov);if(c!=null)return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=_C(t,i.heading,i.tilt,e,r,s);return $$(t,o,i.fov,n)}function KL(t,e,r,i,s){return g2(t).directionToHeadingTilt(e,r,i,s)}function LFe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,r0,t.spatialReference)&&t.elevationProvider&&(cp(t.elevationProvider,r0)??0)>(r0.z??0)-dhe)}async function DFe(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,r0,t.spatialReference)||!t.elevationProvider)return!1;const i=r0.z??0;return(await t.elevationProvider.queryElevation(r0.x,r0.y,i,r0.spatialReference,"ground",r)??0)>i-dhe}async function NFe(t,e,r){const i=C();if(e)if(e instanceof at){if(bo(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const s=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return s!=null&&t.renderCoordsHelper.setAltitude(i,s),i}}else te(i,e);else te(i,t.state.camera.center);return i}function FFe(t,e){const r=C();if(e&&e instanceof at){if(bo(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=cp(t.elevationProvider,e);i!=null&&t.renderCoordsHelper.setAltitude(r,i)}}else te(r,e||t.state.camera.center);return r}function _C(t,e,r,i,s,n,o){const a=i&&i instanceof at?i:null;if(l1(o))return NFe(t,i,o.signal).then(c=>{RU(t,e,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=FFe(t,i);return RU(t,e,r,a,l,s,n,o)}function RU(t,e,r,i,s,n,o,a){if(i==null){const d=t.renderSpatialReference;if((i=N0(s,d,yA(t)))==null)return null}n=Math.max(n,t.state.constraints.minimumPoiDistance);const l=kFe(t,e,r,s,n,o),c=(0,g2(t).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===yo.ADJUST&&t.viewingMode==="global"&&r>0){const d=()=>{const g=mhe(t,s,n,VFe(t,n,r,s));return o=r-g<1?yo.LOCKED:yo.ADJUST,RU(t,e,g,i,s,n,o,a)},p=t.map.ground.navigationConstraint;if(!p||p.type==="stay-above"){if(LFe(t,c.eye))return d();if(l1(a))return DFe(t,c.eye,a.signal).then(g=>g?d():(a.resolver.resolve({eye:c.eye,up:c.up,center:ms(s),heading:c.heading,tilt:c.tilt}),null)),null}}const u=!a||l1(a)?{center:C(),eye:C(),up:C(),tilt:0,heading:0}:a;return u.eye=c.eye,u.up=c.up,u.center=ms(s),u.heading=c.heading,u.tilt=c.tilt,l1(a)&&a.resolver.resolve(u),u}function pE(t,e,r,i,s,n=null){let o,a,l;if(t.state.isGlobal){if(!P$(e.spatialReference,Re.Global))return l1(n)&&n.resolver.reject(),null;const v=new at(e.xmin,e.ymin,e.spatialReference),w=new at(e.xmax,e.ymax,e.spatialReference),T=e.spatialReference.isGeographic?$Fe:MFe;o=new at({x:T.center(v.x,w.x),y:(w.y+v.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const x=Cr(e.spatialReference),E=DNe(o,v,w);a=E.lon,l=E.lat,T.diff(v.x,w.x)>T.range/2&&(a+=x.halfCircumference),a=Math.min(a,x.halfCircumference),l=Math.min(l,x.halfCircumference)}else{const v=t.renderSpatialReference??e.spatialReference;v.equals(e.spatialReference)||(e=oA(e,v)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const w=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new at({x:e.xmin+.5*a,y:e.ymin+.5*l,z:w,spatialReference:v})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,u=t.state.camera,d=1/Math.tan(u.fovX/2),p=1/Math.tan(u.fovY/2),g=1/Math.tan(u.fov/2),y=Math.max(.5*a*d,.5*l*p,.5*c*g)/OU;if(l1(n)){const v=new y2(n.signal);return _C(t,r,i,o,y,s,v),void v.resolver.promise.then(w=>{const T=$$(t,w,t.camera.fov);if(T!=null)return n.resolver.resolve(T);n.resolver.reject()},w=>n.resolver.reject(w))}const _=_C(t,r,i,o,y,s);return $$(t,_,t.camera.fov,n)}function UFe(t,e,r){const i=t.renderSpatialReference,s=N0(r,i,yA(t));if(s==null)return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=ZC(e.eye,r),l=2*a*n*OU,c=2*a*o*OU;return t.viewingMode==="global"?ahe(t,s,l,c):ihe(t,s,l,c)}function zFe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>OFe)return!0;const s=t.renderSpatialReference,n=yA(t),o=N0(e,s,n),a=N0(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>RFe}function kFe(t,e,r,i,s,n){let o=0;return n===yo.ADJUST&&zFe(t,i,s)?(e=0,o=BFe(t,s,r,i)):o=vV(t,i,s,r),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:r=mhe(t,i,s,o)}}const M$=.7;function BFe(t,e,r,i){const s=vV(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-M$)+n.max*M$;return Math.min(s,o)}function VFe(t,e,r,i){let s=vV(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-M$)+s*M$}function mhe(t,e,r,i){return g2(t).lookAtTiltToEyeTilt(i,e,r)}function vV(t,e,r,i){return g2(t).eyeTiltToLookAtTilt(i,e,r)}function $$(t,e,r,i){if(e==null)return null;const s=t.renderSpatialReference,n=N0(e.eye,s,yA(t));return n==null?null:i!=null?(i.position=n,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new Ru(n,e.heading,e.tilt,r)}function GFe(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);che.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function ghe(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);che.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function yhe(t,e){return wn(e.center,t.renderSpatialReference,nX,yt.WGS84),k1(t,e.distance,nX[1])}let y2=class{constructor(e){this.signal=e,this.resolver=vo()}};function l1(t){return t&&"resolver"in t}const jFe=.66;function _he(t){return 360-oB.normalize(t)}function eD(t){return oB.normalize(360-t)}function X2(t){return t!=null&&t.resolver&&t.resolver.reject(),null}function HFe(t,e){return t!=null&&t.resolver&&t.resolver.resolve(e),e}function vhe(t,e,r,i=null){if(!e)return X2(i);const s=t.spatialReference||yt.WGS84;if(e.camera!=null){const c=ev(e.camera.position,s);if(c==null)return X2(i);const u=e.camera.clone();return u.position=c.clone(),HFe(i,u)}if(e.targetGeometry==null)return X2(i);const n=e.get("targetGeometry.spatialReference");if(n&&!v0(n,s))return X2(i);const o=Rx(t,t.state.camera);let a=yo.ADJUST;if(e.rotation!=null&&(o.heading=_he(e.rotation),a=yo.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let u;const d=e.targetGeometry.clone();return u=e.scale!=null?_V(t,e.scale,c.latitude):t.state.camera.distance,fhe(t,d,u,o,a,i)}const l=e.targetGeometry.extent;return l?pE(t,l,o.heading,o.tilt,a,i):X2(i)}function WFe(t,e,r=null){return r==null&&(r=new Qh),xV(t,null,e.clone(),r)}async function qFe(t,e,r){const i=i6e(t,e);if(!i)throw new X("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Ru({fov:t.camera.fov}),n=new Qh({camera:s});if(i.target instanceof Qh)return xy(await ZFe(t,i.target,i,r,n));if(i.target instanceof Ru)return xy(whe(t,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof Wr){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return xy(o||c?await PU(t,i,i.target.center,s,r,n):await e6e(t,i,i.target,s,r,n))}const a={boundingBox:li(),hasZ:!1,screenSpaceObjects:[]},l=o?YFe(t,i):void 0;if(await bhe(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(Dh(a.boundingBox,us),Kl.x=us[0],Kl.y=us[1],Kl.z=us[2],Kl.spatialReference=t.spatialReference,isFinite(Kl.z)&&a.hasZ?c=CB(a.boundingBox):(Kl.z=void 0,c=iTe(EB(a.boundingBox,n6e))),o||c)return xy(await PU(t,i,Kl,s,r,n));const u=s6e(t,a.screenSpaceObjects);return xy(await r6e(t,i,Kl,a.boundingBox,u,s,r,n))}return i.position?xy(QFe(t,i,s,n)):xy(await KFe(t,i,s,r,n))}function bV(t,e){return e.scale==null&&e.zoom!=null?ghe(t,e.zoom):e.scale}function YFe(t,e){const r=bV(t,e);return r?cRe(r):void 0}function wV(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=_he(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function xV(t,e,r,i){const s=t.spatialReference||yt.WGS84;return(e=e??Af(t,r))==null||(i.targetGeometry=N0(e.center,t.renderSpatialReference,s),i.scale=yhe(t,e),i.rotation=eD(r.heading),i.camera=r),i}function I$(t,e,r){var a,l;const i=()=>new X("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!v0(e.spatialReference,t.spatialReference))throw new X("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&t.basemapTerrain.spatialReference!=null&&v0(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?us[2]=cp(t.elevationProvider,c)??0:us[2]=0}(0,o6e[e.type])(e,c=>{s.push(c[0],c[1],c[2])},us);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(Xi(s,e.spatialReference,0,o,t.spatialReference,0,n)){e.hasZ&&(r.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(us[0]=o[c],us[1]=o[c+1],us[2]=o[c+2]):(us[0]=o[c],us[1]=o[c+1]),Ap(r.boundingBox,us)}}async function XFe(t,e,r,i){const s=await rm(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void I$(t,e.geometry,i);const n=s.value,o=await rm(n.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void I$(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;cx(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function bhe(t,e,r,i){var s;if(Array.isArray(e)&&e.length===2){const n=e[0],o=e[1];if(typeof n=="number"&&typeof o=="number")return Kl.x=n,Kl.y=o,Kl.z=void 0,Kl.spatialReference=(s=t.spatialReference)!=null&&s.isGeographic?t.spatialReference:yt.WGS84,void I$(t,Kl,i)}e&&"map"in e&&typeof e.map=="function"?await X0(e.map(n=>bhe(t,n,r,i))):e instanceof Z0?I$(t,e,i):e instanceof om&&await XFe(t,e,r,i)}async function ZFe(t,e,r,i,s){if(e.camera!=null)return whe(t,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=eD(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=bV(t,r);n!=null&&(s.scale=n);const o=new y2(i);return vhe(t,s,r.tilt,o),s.camera=await o.resolver.promise,s}function whe(t,e,r){const i=t.spatialReference,s=ev(e.position,i);return s==null?null:((e=e.clone()).fov=t.camera.fov,e.position=s,xV(t,null,e,r))}function JFe(t,e,r,i,s,n){const o=t.renderSpatialReference;return bo(r,sO,o),bo(e,b4,o),n.targetGeometry=new at(e),s.position=new at(r),le(L$,b4,sO),KL(t,sO,L$,i.up,s),n.scale=k1(t,ei(sO,b4),n.targetGeometry.latitude),n.rotation=eD(s.heading),n.camera=s,n}async function PU(t,e,r,i,s,n){if(r==null)throw new X("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=hv(t);if(e.position)return JFe(t,n.targetGeometry,e.position,o,i,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ee(us,o.viewForward,-l);o.eye=oe(us,o.center,c),n.scale=k1(t,l,r.latitude)}Rx(t,o,i);const a=wV(i,e)?yo.LOCKED:yo.ADJUST;if(!e.zoomFactor){const l=bV(t,e);l==null?(bo(r,us,t.renderSpatialReference),Cce(o.frustum,us)?n.scale=k1(t,ei(o.eye,us),r.latitude):n.scale=yhe(t,o)):n.scale=l;const c=new y2(s);phe(t,n.targetGeometry,n.scale,i,a,c),n.camera=await c.resolver.promise}return n}function QFe(t,e,r,i){const s=hv(t);return te(L$,s.viewForward),KL(t,s.eye,L$,s.up,w4),r.position=new at(e.position),r.heading=e.heading!=null?e.heading:w4.heading,r.tilt=e.tilt!=null?e.tilt:w4.tilt,xV(t,null,r,i)}async function KFe(t,e,r,i,s){const n=hv(t);return PU(t,e,N0(n.center,t.renderSpatialReference,t.spatialReference),r,i,s)}async function e6e(t,e,r,i,s,n){n.targetGeometry=r.clone();const o=hv(t);Rx(t,o,i);const a=wV(i,e)?yo.LOCKED:yo.ADJUST,l=new y2(s);return pE(t,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function t6e(t,e,r,i,s){let n=0;r.z!=null?n=r.z:t.basemapTerrain&&t.elevationProvider&&(n=cp(t.elevationProvider,r)),se(us,r.x,r.y,n),bu(t.spatialReference,us,oX,t.renderSpatialReference),Lu(iO,oX),Du(iO,iO),li(Z2);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=i[_[2]];isFinite(v)||(v=n),se(us,i[_[0]],i[_[1]],v),wn(us,t.spatialReference,us,t.renderSpatialReference),Ap(Z2,El(us,us,iO))}const a=sv(Z2),l=Q0(Z2),c=nv(Z2),u=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(d,u)+.5*l,g=.5*l*d+.5*Math.max(a,c);return Math.max(p,g)/s}async function r6e(t,e,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=hv(t),c=t6e(t,l,r,i,s);Rx(t,l,n);const u=wV(n,e)?yo.LOCKED:yo.ADJUST;a.scale=k1(t,c,a.targetGeometry.latitude);const d=new y2(o);return phe(t,a.targetGeometry,a.scale,n,u,d),a.camera=await d.resolver.promise,a}function i6e(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function xy(t){return t&&t.camera!=null&&(t.rotation=eD(t.camera.heading)),t}function s6e(t,e){const r=jFe;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(t.width,t.height)*2}const us=C(),oX=xe(),iO=Zi(),Z2=Bs(),n6e=Ut(),L$=C(),sO=C(),b4=C(),w4={heading:0,tilt:0},Kl=new at,o6e={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,s=t.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(se(r,t.xmin,t.ymin,t.zmin)),e(se(r,t.xmax,t.ymin,t.zmin)),e(se(r,t.xmin,t.ymax,t.zmin)),e(se(r,t.xmax,t.ymax,t.zmin)),e(se(r,t.xmin,t.ymin,t.zmax)),e(se(r,t.xmax,t.ymin,t.zmax)),e(se(r,t.xmin,t.ymax,t.zmax)),e(se(r,t.xmax,t.ymax,t.zmax))):(e(se(r,t.xmin,t.ymin,r[2])),e(se(r,t.xmax,t.ymin,r[2])),e(se(r,t.xmin,t.ymax,r[2])),e(se(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)e(se(r,i[s],i[s+1],i[s+2]))}};let a6e=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this.options.signal!=null&&Uo(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(wr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await QE(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,qFe(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var n;const r=!!(this.target instanceof Qh&&this.target.camera||this.target instanceof Ru),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new X("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const s=Af(this.view,i);return s==null?(this.reject(new X("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new X("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;e.isFullySpecified?(s=new dE({view:this.view,desiredCamera:e.camera}),f2(this.view,e.camera,_u.EYE_AND_CENTER)):ds(this.view,e.camera),r.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Bf&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(r.state){case $i.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case $i.Ready:case $i.Rejected:case $i.Running:case $i.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof Bf&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new Bf({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r!=null&&r.stop(),this.reject(new X("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},js=class extends we{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=Rx(this.view,this.view.state.camera,x4);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableElevationCache(!0),this.setStateCamera(Af(this.view,e),{applyConstraints:!1})||ne.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=Rx(this.view,this.view.state.contentCamera,x4);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=Af(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(T4),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,s=yl(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([ce(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(T4),this.test.contentCameraResetState.clear())}),ce(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),ce(()=>this.view.state.camera,o=>{const a=Hn(s,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],T4),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ne.getLogger(this.declaredClass).error("#center=","Invalid center",e):ne.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):ne.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=UFe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||ne.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):ne.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):ne.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return k1(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||ne.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,s=this._get("padding"),n=Math.round(r[Gt.TOP]/i),o=Math.round(r[Gt.RIGHT]/i),a=Math.round(r[Gt.BOTTOM]/i),l=Math.round(r[Gt.LEFT]/i);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,nO),this.view.state.updateCamera(r=>r.padding=nO))}_paddingToArray(e,r,i){e?oi(i,e.top||0,e.right||0,e.bottom||0,e.left||0):oi(i,0,0,0,0);for(let s=0;s<4;s++)i[s]=Math.round(i[s]*r)}get screenCenter(){const e=this.padding;return Pu((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?WFe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||ne.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,s=i!=null&&i.spatialReference;ne.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else ne.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?GFe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||ne.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return J_(this._tmpCanvasSize,i),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(Ts.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(Ts.PhysicalPixelRendering,vr.IDLE)||e.isFeatureEnabled(Ts.PhysicalPixelRendering,vr.INTERACTING)||e.isFeatureEnabled(Ts.PhysicalPixelRendering,vr.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new lm({frustum:t0},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new l6e}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Ga(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ce(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),Nr)]),Mu(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([Kw({prepare:()=>this._prepareFrame()}),ce(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(oO)}),Ga(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Oe(this._propertiesPool)}init(){this.constraintsManager=new SS({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===Re.Local&&this.addHandles(Mu(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(oO),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),oO)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(oO),this.constraintsManager=Oe(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new a6e(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(hv(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(s=>i.stepController(e,s)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:s}of u6e){const n=e.has(i),o=this._isOverridden(i);!n&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||o)&&s.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Ru)return void this.setStateCamera(Af(this.view,e),{applyConstraints:!1});if(e instanceof Qh){if(e.targetGeometry instanceof Wr){const n=pE(this.view,e.targetGeometry,0,.5,yo.LOCKED);return void(n!=null&&this.setStateCamera(Af(this.view,n),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,i)}const r=pE(this.view,e,0,.5,yo.LOCKED);r!=null&&this.setStateCamera(Af(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&c6e.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Qh?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Ru?this.isCompatible(e.position):e.spatialReference&&v0(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=h6e){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=Ym){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=_C(this.view,s,n,e,r,yo.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),s=pE(this.view,e,r,i,yo.ADJUST,x4);return s?Af(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,s=r.location.latitude;if(s==null)return null;const n=_V(this.view,e,s);return this._centerPointAtDistanceToCamera(i,n)}_zoomToCamera(e){return this._scaleToCamera(ghe(this.view,e))}_viewpointToCamera(e){return Af(this.view,vhe(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&ds(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new dE({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===i.width&&s.fullHeight===i.height&&s.pixelRatio===i.pixelRatio||(Ym.copyFrom(s),Ym.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,nO),Ym.padding=nO),Ym.fullWidth=i.width,Ym.fullHeight=i.height,Ym.pixelRatio=i.pixelRatio,this.view.state.camera=Ym),this._updateViewState()}}_updateElevation(e){var n;const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=((n=this.view.renderCoordsHelper)==null?void 0:n.getAltitude(e.eye))??0,s=r?YL(this.view,e.eye):0;e.relativeElevation=i-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=vr.ANIMATING:this.view.interacting?this.view.state.mode=vr.INTERACTING:(this.view.state.mode===vr.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=d6e?this.view.state.mode=vr.INTERACTING:this.view.state.mode=vr.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([f({type:Ru,dependsOn:["view.state.camera","ready"]})],js.prototype,"camera",null),h([f({type:Ru,dependsOn:["view.state.contentCamera","ready"]})],js.prototype,"contentCamera",null),h([f({type:at})],js.prototype,"center",null),h([f({type:Wr})],js.prototype,"extent",null),h([f({readOnly:!0})],js.prototype,"frustum",null),h([f({readOnly:!0})],js.prototype,"hasInitialView",null),h([f({readOnly:!0,type:Boolean})],js.prototype,"ready",void 0),h([f({type:Number})],js.prototype,"scale",null),h([f()],js.prototype,"padding",null),h([f({readOnly:!0})],js.prototype,"screenCenter",null),h([f({constructOnly:!0})],js.prototype,"view",void 0),h([f({type:Qh})],js.prototype,"viewpoint",null),h([f({type:Number})],js.prototype,"zoom",null),h([f({readOnly:!0})],js.prototype,"_rasterPixelRatio",null),h([f({readOnly:!0})],js.prototype,"_usePhysicalPixelRendering",null),h([f({readOnly:!0})],js.prototype,"_usePhysicalPixelRenderingAny",null),h([f()],js.prototype,"_windowDevicePixelRatio",void 0),h([f()],js.prototype,"_devicePixelRatioOverride",void 0),js=h([F("esri.views.3d.state.ViewStateManager")],js);let l6e=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const c6e=["camera","viewpoint","extent","scale","center","zoom"],u6e=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],h6e={heading:0,tilt:0},x4=new Ru,Ym=new ot,nO=Ht(),oO="pending-initial-view",T4="content-camera-reset",d6e=300,aX=100;let up=class extends Mf{constructor(){super(...arguments),this.startCamera=new ot,this.currentCamera=new ot,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<aX}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=$i.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),aX),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([f({readOnly:!0})],up.prototype,"isInteractive",null),h([f()],up.prototype,"_lastInteraction",void 0),up=h([F("esri.views.3d.state.controllers.InteractiveController")],up);var ml;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(ml||(ml={}));let fE=class extends up{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=ml.CENTER,this._rotScale=0,this._lastPoint=Ie(),this._tmpWorldUp=C(),this._tmpViewDir=C(),this._tmpRotCurPoint=Ie(),this._tmpTransf=xe(),this._tmpAxis=C(),this._tmpPivotPoint=C(),this._pivotPos=C(),this._constraintOptions={selection:gi.ALL,interactionType:zt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:xn.TUMBLE}}initialize(){this._rotScale=this.pivot===ml.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case ml.EYE:te(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=zt.LOOK_AROUND,this._constraintOptions.tiltMode=xn.LOOK_AROUND,this._constraintOptions.selection=gi.NONE;break;case ml.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?dv:{});r||te(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=zt.TUMBLE,this._constraintOptions.tiltMode=xn.TUMBLE,this._constraintOptions.selection=gi.ALL&~gi.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,a1(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,s=C();le(s,this._pivotPos,i.eye);const n=Te(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,lX);let a=Math.max(Math.min(q5e,1/Math.abs(pe(lX,i.viewForward)))*o,Y5e);r&&(a=Math.min(n,a));const l=Cr(this.view.spatialReference),c=Li(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),u=QL(this.startCamera,c,l);let d=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*f4,f4),p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,f4);d==null&&p==null||(d=d??p??0,p=p==null||u===bn.Horizontal?d:p,a=d>p?p:d,a=r?Math.min(a,n):a),fe(s,s),te(this._pivotPos,oe(this._tmpPivotPoint,i.eye,ee(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case ml.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case ml.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}ds(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),a1(e,r,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;le(this._tmpViewDir,i,s);const a=Te(this._tmpViewDir),l=rn(pe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===ml.EYE){n*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;n=c-Math.max(-u,Math.min(u,c+n))}return n=me(n+l,no.min,no.max)-l,Qe(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===ml.CENTER&&(o=-o),bc(this._tmpTransf,o,this._tmpWorldUp),Cl(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),De(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=De(S4,e.up,this._tmpTransf),oe(S4,s,this._tmpViewDir),Vs(this._lastPoint,this._tmpRotCurPoint),S4}};h([f()],fE.prototype,"pivot",void 0),fE=h([F("esri.views.3d.state.controllers.RotateController")],fE);const S4=C(),lX=C();let E4=class extends Zn{constructor(e,r,i,s){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!mV(e.data,this.pointerAction))return;const i=Li(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new fE({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},MU=class extends up{constructor(){super(...arguments),this._pickPoint=C(),this._tmpP0=Ie(),this._panAxisAngle=ZL(),this._tmpRayDir=C(),this._tmpRayDirPick=C(),this._targetOnSphere=C(),this._navMode=bn.Horizontal,this._tmpRay={origin:C(),direction:C()},this.dragBeginPoint=Li(),this._normalizedAnchorPoint=Ie(),this._constraintOptions={selection:gi.ALL_EXCEPT_COLLISION,interactionType:zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:xn.TUMBLE},this._sphere=ss(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Vs(this.dragBeginPoint,e),a1(this.startCamera,e,this._normalizedAnchorPoint);const r=Cr(this.view.spatialReference),i=jue(this._intersectionHelper,this.startCamera,e,r,Ox.Ellipsoid,this.view.map.ground.opacity===0?dv:{});if(this._navMode=QL(this.startCamera,e,r),this._navMode===bn.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let s;m2(this.startCamera,e,this._tmpRay),fe(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(le(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Te(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,cX);let o=me(Math.min(Nue,1/Math.abs(pe(cX,this._tmpRay.direction)))*n,T$[0],T$[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,JL);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,ee(this._tmpRay.direction,this._tmpRay.direction,o),oe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===bn.Horizontal){le(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Te(this._tmpRayDir);a1(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;if(this._hasPickPoint&&s<r){const o=1-(1-s/r)*(1-this._sphere[3]/Te(this.currentCamera.center));this.currentCamera.center=ee(aO,this.currentCamera.center,o)}ee(this._tmpRayDir,this._tmpRayDir,-s/r),this.currentCamera.eye=oe(aO,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Mh(I1(this.dragBeginPoint,e)),ds(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(yC(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),cV(this._pickPoint,this._targetOnSphere,this._panAxisAngle),j0(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Te(this._tmpRay.direction);a1(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;ee(this._tmpRayDir,this._tmpRay.direction,1-s/r),this.currentCamera.eye=oe(aO,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=oe(aO,this.currentCamera.center,this._tmpRayDir)}f2(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};MU=h([F("esri.views.3d.state.controllers.global.ZoomController")],MU);const aO=C(),cX=C();let $U=class extends up{constructor(){super(...arguments),this._tmpP=C(),this._tmpDir=C(),this._tmpN=C(),this._tmpP0=Ie(),this._tmpPoi=C(),this._tmpRayDir=C(),this.dragBeginPoint=Li(),this._normalizedAnchorPoint=Ie(),this._constraintOptions={selection:gi.ALL,interactionType:zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:C(),tiltMode:xn.TUMBLE},this._plane=_r()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Vs(this.dragBeginPoint,e),a1(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?dv:{});le(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Te(this._tmpDir);fe(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=me(Math.min(Nue,1/Math.abs(pe(p6e,this._tmpDir)))*s,T$[0],T$[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,JL);n=o??n,n=r?Math.min(n,i):n,ee(this._tmpDir,this._tmpDir,n),oe(this._tmpP,this.startCamera.eye,this._tmpDir),le(this._tmpN,this.startCamera.eye,this.startCamera.center),fe(this._tmpN,this._tmpN),this._tmpN[1]<0&&zo(this._tmpN,this._tmpN),lA(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;X5e(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||te(this._tmpPoi,this.currentCamera.center),a1(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Vs(this._normalizedAnchorPoint,this._tmpP0),le(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Te(this._tmpRayDir);let s=i*(1-r);this._constraintOptions.interactionDirection&&(te(this._constraintOptions.interactionDirection,this._tmpRayDir),ee(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const n=this.view.state.constraints.minimumPoiDistance;r>=0&&s<n&&(s=n,r=-(s-i)/i),Math.abs(i-s)<1e-6||(ee(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=oe(Ty,this.currentCamera.eye,this._tmpRayDir),Pr(Ty,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?Ty[2]=Math.max(this.startCamera.center[2],Ty[2]):Ty[2]=Math.min(this.startCamera.center[2],Ty[2]),this.currentCamera.center=Ty,this._constraintOptions.interactionFactor=Mh(I1(this.dragBeginPoint,e)),ds(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};$U=h([F("esri.views.3d.state.controllers.local.ZoomController")],$U);const Ty=C(),p6e=Ce(0,0,1);let f6e=class extends Zn{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!mV(e.data,this.pointerAction))return;const i=Li(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new MU({view:this._view}):this._cameraController=new $U({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Xu(t){let e=t*t;return t<0&&(e*=-1),e}function uX(t,e,r){const i=r,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=Xu(s.axes[0]),i.translation[1]=Xu(s.axes[1]),i.translation[2]=Xu(s.buttons[7])-Xu(s.buttons[6]),i.heading=Xu(s.axes[2]),i.tilt=Xu(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*Xu(s.axes[0]),i.translation[1]=1.2*Xu(s.axes[1]),i.translation[2]=2*-Xu(s.axes[2]),i.heading=1.2*Xu(s.axes[5]),i.tilt=1.2*Xu(s.axes[3])),i.tilt*=o,ee(i.translation,i.translation,a),i}function hX(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function C4(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let Q_=class extends up{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new ot,this._headingStart=0,this._constraintOptions={selection:gi.ALL,interactionType:zt.NONE,interactionStartCamera:new ot,interactionFactor:0,interactionDirection:null,tiltMode:xn.LOOK_AROUND}}handleEventGamepad(e){const r=uX(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||C4(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,hX(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=hX(this._keysButtonState,this._transformation);C4(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Sy),this._applyDisabledMovementTypes(Sy),this._applyPan(Sy.pan),this._applyRotate(Sy.rotate),this._applyZoom(Sy.zoom),this._applyAscend(Sy.ascend),this._constraintOptions.interactionType=zt.NONE,this._constraintOptions.selection=gi.COLLISION,ds(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;le(_a,r.center,r.eye),De(_a,_a,e.matrix),r.center=oe(_a,_a,r.eye),r.up=De(_a,r.up,e.matrix),this._constraintOptions.interactionType=zt.LOOK_AROUND,this._constraintOptions.selection=gi.ALL_EXCEPT_COLLISION,ds(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=De(_a,r.eye,e.matrix),r.center=De(_a,r.center,e.matrix),this.view.state.isGlobal&&(r.up=De(_a,r.up,e.matrix)),this._constraintOptions.interactionType=zt.PAN,this._constraintOptions.selection=gi.ALL,ds(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=oe(_a,this.currentCamera.eye,ee($e.get(),r,e)),te(J2,r),zo(J2,J2),this._constraintOptions.interactionDirection=J2,this._constraintOptions.interactionType=zt.ZOOM,this._constraintOptions.selection=gi.ALL_EXCEPT_COLLISION,ds(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,$e.get());if(this._constraintOptions.interactionDirection=te(J2,r),this.view.state.isGlobal){const i=Te(this.currentCamera.eye),s=(i+e)/i;this.currentCamera.eye=ee(_a,this.currentCamera.eye,s),this.currentCamera.center=ee(_a,this.currentCamera.center,s)}else{const i=ee($e.get(),r,e);this.currentCamera.eye=oe(_a,this.currentCamera.eye,i),this.currentCamera.center=oe(_a,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=zt.ASCEND,this._constraintOptions.selection=gi.COLLISION,ds(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=gi.ALL_EXCEPT_COLLISION,ds(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){w6e(i);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,r,i):this._calculateControlTransformationGlobal(s,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,_a)}_calculateControlTransformationLocal(e,r,i){const{viewRight:s,viewForward:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=se($e.get(),n[0],n[1],0);fe(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=ee($e.get(),s,c);Wa(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=ee($e.get(),l,_);Wa(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;i.ascend=u;const d=-o.heading*e.rotate;d!==0&&(Cl(i.rotate.matrix,i.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,$e.get())),i.rotate.enabled=!0);const p=o.tilt*e.rotate,g=G0(this.view.renderCoordsHelper,r.center,r.eye),y=me(g+p,no.min,no.max)-g;y&&(Cl(i.rotate.matrix,i.rotate.matrix,y,s),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:s,viewRight:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=Qe($e.get(),n,s);fe(l,l),zo(l,l),tFe(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Sy.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;i.ascend=u;const d=-o.heading*e.rotate;d!==0&&(Cl(i.rotate.matrix,i.rotate.matrix,d,this._tmpCamera.eye),i.rotate.enabled=!0);const p=o.tilt*e.rotate,g=this._clampTiltDeltaGlobalToValidRange(p,r.ray,c);g!==0&&(Cl(i.rotate.matrix,i.rotate.matrix,g,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const s=Cr(this.view.spatialReference),n=CP(no.min,r.origin,i,s);let o=0,a=0;const l=$e.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=G0(this.view.renderCoordsHelper,l,r.origin);o=CP(c,r.origin,i,s),a=CP(no.max,r.origin,i,s)}else{c2(bL(wL,i+s.radius),r,l);const c=Math.PI+vL(r.direction,l);o=qY(c,r.origin,i,s),a=qY(no.max,r.origin,i,s)}return me(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=r+Math.abs(n-r);return s.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:s}=this.view.state,{direction:n}=IFe(this.view,r,0,xhe,b6e),o=i.intersectManifoldClosestSilhouette(wc(r,n),e,$e.get()),a=ei(r,o),l=i.intersectManifoldClosestSilhouette(wc(r,fm($e.get(),r,s.center)),e,$e.get()),c=ei(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:s,isGlobal:n}=i,o=r.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,$e.get());if(n){const a=le($e.get(),e,o),l=Te(a);ee(a,a,1/l);const c=fe($e.get(),e),u=rn(pe(c,a));return l*Math.sin(Math.min(g6e,u))}{const a=te($e.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),ei(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:y6e}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Cr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=$e.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=s.width/2,u=dX*s.width,d=dX*s.width,p=l*Math.tan(.5*s.fovX)/c,g=p/i,y=p/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(n?g:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*_-_),zoom:2**(u*e/c)*l-l,rotate:me(y*d,_6e,v6e)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&$u(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&$u(e.rotate.matrix))}static activatesFor(e,r){const i=uX(r,e.navigation.gamepad,m6e);return!(r.action==="end"||C4(i))}};h([f({constructOnly:!0})],Q_.prototype,"gamepadDevice",void 0),h([f({constructOnly:!0})],Q_.prototype,"disableMovements",void 0),Q_=h([F("esri.views.3d.state.controllers.GamepadKeyboardController")],Q_);const m6e={translation:[0,0,0],heading:0,tilt:0,zoom:0},xhe=80,g6e=At(xhe),dX=.75,y6e=5,_6e=At(30),v6e=At(80),Sy={zoom:0,ascend:0,pan:{enabled:!1,matrix:xe()},rotate:{enabled:!1,matrix:xe()}},_a=C(),J2=C(),b6e=gV();function w6e(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,$u(t.pan.matrix),t.rotate.enabled=!1,$u(t.rotate.matrix)}let x6e=class extends Zn{constructor(e){super(!0),this._view=e,this._watchHandles=new Oi,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ce(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Tr),ce(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||Q_.activatesFor(this._view,e.data)){if(!i){const s=new Q_({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var cl;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(cl||(cl={}));let T6e=class extends Zn{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Re.Local},this._keyToNumber={[r.left]:cl.LEFT,[r.right]:cl.RIGHT,[r.forward]:cl.FORWARD,[r.backward]:cl.BACKWARD,[r.up]:cl.UP,[r.down]:cl.DOWN,[r.headingLeft]:cl.HEADINGLEFT,[r.headingRight]:cl.HEADINGRIGHT,[r.tiltUp]:cl.TILTUP,[r.tiltDown]:cl.TILTDOWN,[r.zoomIn]:cl.ZOOMIN,[r.zoomOut]:cl.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new Q_({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},S6e=class extends Zn{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new A$({view:this._view,mode:"interaction"}):new O$({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Li(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},D$=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},B1=class extends mC{constructor(){super(...arguments),this._beginCamera=new ot,this._elapsedTimeSec=0,this.constraintOptions={selection:gi.ALL,interactionType:zt.PAN,interactionFactor:0,interactionStartCamera:new ot,interactionDirection:null,tiltMode:xn.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new bx}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),ds(this.view,r,this.constraintOptions)}};B1=h([F("esri.views.3d.state.controllers.momentum.MomentumController")],B1);let mE=class extends B1{constructor(e){super(e),this.interactionType=zt.PAN,this._tmpPan=C()}momentumStep(e,r){const i=this.momentum.value(e);ee(this._tmpPan,this.momentum.direction,i),r.eye=le(pX,r.eye,this._tmpPan),r.center=le(pX,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([f({constructOnly:!0})],mE.prototype,"momentum",void 0),mE=h([F("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],mE);const pX=C(),E6e=C(),lO=C();let OP=class extends B1{constructor(e){super(e),this.interactionType=zt.PAN}momentumStep(e,r){const i=this.momentum.value1(e),s=this.momentum.value2(e);te(lO,r.eye),fe(lO,lO),Qe(this.momentum.axis2,lO,this.momentum.axis1),Yue(r,E6e,this.momentum.axis1,i,this.momentum.axis2,s)}};h([f({constructOnly:!0})],OP.prototype,"momentum",void 0),OP=h([F("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],OP);let B_=class extends B1{set center(e){this._set("center",ms(e))}set axis(e){this._set("axis",ms(e))}constructor(e){super(e),this.interactionType=zt.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);j0(r,this.center,gC(this.axis,i))}};h([f({constructOnly:!0})],B_.prototype,"momentum",void 0),h([f({constructOnly:!0})],B_.prototype,"center",null),h([f({constructOnly:!0})],B_.prototype,"axis",null),B_=h([F("esri.views.3d.state.controllers.momentum.MomentumController")],B_);let yw=class extends B1{set zoomCenter(e){this._set("zoomCenter",ms(e))}constructor(e){super(e),this.interactionType=zt.ZOOM,this.constraintOptions.interactionDirection=C()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;te(i,r.eye);const s=this.momentum.valueDelta(0,e);dV(r,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),fm(i,r.eye,i)}};h([f({constructOnly:!0})],yw.prototype,"momentum",void 0),h([f({constructOnly:!0})],yw.prototype,"zoomCenter",null),yw=h([F("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],yw);let w_=class extends B1{set screenCenter(e){this._set("screenCenter",Li(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",ms(e))}constructor(e){super(e),this.interactionType=zt.ZOOM,this.radius=0,this._tmpSceneCenter=C(),this._tmpZoomAxisAngle=ZL(),this._sphere=ss()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);Vue(this._sphere,r,i),this.constraintOptions.interactionType=zt.ZOOM,ds(this.view,r,this.constraintOptions),yC(this._sphere,r,this.screenCenter,this._tmpSceneCenter),cV(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),j0(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=zt.PAN}};h([f({constructOnly:!0})],w_.prototype,"momentum",void 0),h([f({constructOnly:!0})],w_.prototype,"screenCenter",null),h([f({constructOnly:!0})],w_.prototype,"sceneCenter",null),h([f({constructOnly:!0})],w_.prototype,"radius",void 0),w_=h([F("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],w_);let $h=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},tD=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},C6e=class extends tD{constructor(e,r,i,s,n){super(e,r,i),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},The=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new $h(.6),this._screen=[new $h(.4),new $h(.4)],this._scene=[new $h(.6),new $h(.6),new $h(.6)],this._tmpDirection=C()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Te(this._tmpDirection);s>0&&ee(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new C6e(e,r,i,n==null?0:s/n,this._tmpDirection)}},fX=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const mX=1e-5;let A6e=class extends tD{constructor(e,r,i,s,n,o=0,a){super(e,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},O6e=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=C(),this._tmpAxis2=C(),this._tmpAngles=Ie(),this._time=new $h(.3),this._screen=[new $h(.4),new $h(.4)],this._angle1=new fX(.6),this._angle2=new fX(.6),this._axis1=C(),this._axis2=C(),this._lastScene=C()}addMomentumDirectRotation(e,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=Wue(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),lo(this._tmpAxis2)<mX?a=0:fe(this._axis1,this._tmpAxis2),this._angle1.update(a),te(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;que(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),lo(this._tmpAxis2)<mX?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),fe(this._axis1,this._tmpAxis1),fe(this._axis2,this._tmpAxis2)),te(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new A6e(e,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},She=class{constructor(e=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new $h(.8),this.time=new $h(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=me(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new tD(e,r,i)}},Ehe=class extends She{constructor(e=3,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){const i=this.value.lastValue;if(i!=null){let s=e-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=i+s}super.add(e,r)}},R6e=class extends tD{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),s=super.value(e+r)-i;return Math.exp(s)}},Che=class extends She{constructor(e=2.5,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new R6e(e,r,i)}},IU=class extends up{constructor(){super(...arguments),this._smoothRotation=new D$(.05),this._rotationAxis=C(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=_r(),this._beginRadius=0,this._smoothScaling=new D$(.05),this._zoomCenterScreen=Li(),this._zoomMomentumEstimator=new Che,this._rotationMomentumEstimator=new Ehe,this._panSphericalMomentumEstimator=new O6e,this._panPlanarMomentumEstimator=new The,this._adjustedSphere=ss(),this._tmp3d=C(),this._tmpScreenPointArray=Li(),this._beginScreenPoint=Li(),this._beginScenePoint=C(),this._screenPickPoint=Li(),this._scenePickPoint=C(),this._mode=bn.Horizontal,this._sphere=ss(),this._pointerCount=0,this._tmpInteractionDirection=C(),this._constraintOptions={selection:gi.ALL,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:new ot,interactionDirection:null,tiltMode:xn.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var n;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-I0.normalize(At(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),tp(e.center,this._screenPickPoint),Vs(this._beginScreenPoint,this._screenPickPoint);const i=Cr(this.view.spatialReference),s=jue(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,Ox.Silhouette,this.view.map.ground.opacity===0?dv:{});s.scenePickPoint!=null&&(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,te(this._beginScenePoint,this._scenePickPoint),this._mode=QL(this.startCamera,this._screenPickPoint,i),this._mode===bn.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),(n=this._constraintOptions.interactionStartCamera)==null||n.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===bn.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===bn.Horizontal?new w_({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new yw({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new B_({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===bn.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new OP({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new mE({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,r){const i=zo(this._tmp3d,this.startCamera.viewForward);lA(this._scenePickPoint,i,this._panningPlane);const s=Li(this._screenPickPoint[0],0),n=C(),o=Te(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],yC(this._adjustedSphere,this.startCamera,s,n);const a=mo();this.startCamera.projectToRenderScreen(n,a);const l=C(),c=C(),u=C();le(l,this._scenePickPoint,this.currentCamera.eye);const d=Te(l);fe(l,l);const p=kue*Math.max(Math.abs(this.view.camera.position.z),Bue),g=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,JL);let y=g??p;y=r?Math.min(y,d):y,te(u,oe(c,this.currentCamera.eye,ee(c,l,y))),this._panningPlane[3]=-pe(this._panningPlane,u),this.startCamera.center=oe(c,this.startCamera.eye,ee(c,this.startCamera.viewForward,y));const _=tp(e.center,this._tmpScreenPointArray);AU(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),Vue(this._sphere,this.currentCamera,this._smoothScaling.value),tp(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=zt.ZOOM,this._constraintOptions.interactionFactor=Mh(e.radius-this._beginRadius),ds(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=tp(e.center,this._tmpScreenPointArray);yC(this._sphere,this.currentCamera,r,this._tmp3d),pV(this._beginScenePoint,pe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(Zue(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Xue(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=zt.PAN,this._constraintOptions.interactionFactor=Mh(I1(this._screenPickPoint,r)),ds(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){fe(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||zo(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+CU(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),j0(this.currentCamera,this._sphere,gC(this._rotationAxis,n)),this._constraintOptions.interactionType=zt.TUMBLE,this._constraintOptions.interactionFactor=Mh(e.radius*i),ds(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=tp(e.center,this._tmpScreenPointArray);AU(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(Hue(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=zt.PAN,this._constraintOptions.interactionFactor=Mh(I1(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),ds(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),dV(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=zt.ZOOM,this._constraintOptions.interactionFactor=Mh(e.radius-this._beginRadius),ds(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){te(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||zo(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=CU(i);const s=r+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),j0(this.currentCamera,this._sphere,gC(this._rotationAxis,o)),this._constraintOptions.interactionType=zt.TUMBLE,this._constraintOptions.interactionFactor=Mh(e.radius*o),ds(this.view,this.currentCamera,this._constraintOptions)}};IU=h([F("esri.views.3d.state.controllers.global.PinchAndPanController")],IU);const gX=Ce(0,0,1),P6e={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let LU=class extends up{constructor(){super(...arguments),this._rotationValueSmooth=new D$(.05),this._scalingValueSmooth=new D$(.05),this._planeHorizontal=_r(),this._planeVertical=_r(),this._rotationMomentumEstimator=new Ehe,this._panMomentumEstimator=new The(300,12,.9),this._zoomMomentumEstimator=new Che,this._beginRadius=0,this._beginCenter=C(),this._beginAngle=0,this._tmpPoints=[],this._panMode=bn.Horizontal,this._beginCenterScreen=Li(),this._tmpCentroid3d=C(),this._tmpCentroid2d=Li(),this._tmp2d=Li(),this._pointerCount=0,this._constraintOptions={selection:gi.ALL,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:new ot,interactionDirection:null,tiltMode:xn.TUMBLE}}begin(e){var y;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),tp(e.center,this._beginCenterScreen),hae(gX,0,this._planeHorizontal);const i=C(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?dv:{}),n=C();zo(n,this.startCamera.viewForward);const o=C();te(o,gX);const a=pe(n,o),l=Cu(a<0?-a:a);this._panMode=l>=P6e.ANGLE_THRESHOLD?bn.Horizontal:bn.Vertical;const c=Math.min(kue,1/Math.abs(pe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),Bue);Y9(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||X9(this._planeHorizontal,this._planeHorizontal);const u=C(),d=C(),p=C();le(u,i,this.currentCamera.eye);const g=Te(u);if(fe(u,u),this._panMode===bn.Vertical){ee(o,o,a),le(this._planeVertical,n,o),fe(this._planeVertical,this._planeVertical),Y9(this._planeVertical,this._planeVertical,i);const _=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,JL);let v=_??c;v=s?Math.min(v,g):v,te(p,oe(d,this.currentCamera.eye,ee(d,u,v))),this._planeVertical[3]=-pe(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),m4(this._tmpPoints,this._beginCenter)}else{const _=s?g:c;te(p,oe(d,this.currentCamera.eye,ee(d,u,_))),this._planeHorizontal[3]=-pe(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),m4(this._tmpPoints,this._beginCenter)}(y=this._constraintOptions.interactionStartCamera)==null||y.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===bn.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(r){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),dV(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=zt.ZOOM,this._constraintOptions.interactionFactor=Mh(Math.abs(e.radius-this._beginRadius)),ds(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),m4(this._tmpPoints,this._tmpCentroid3d),tp(e.center,this._tmpCentroid2d),Hue(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=zt.PAN,this._constraintOptions.interactionFactor=Mh(I1(this._beginCenterScreen,this._tmpCentroid2d)),ds(this.view,this.currentCamera,this._constraintOptions),r){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+CU(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const u=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(u,.001*e.timestamp),j0(this.currentCamera,o,gC(n,u)),this._constraintOptions.interactionType=zt.TUMBLE,this._constraintOptions.interactionFactor=Mh(Math.abs(e.radius*u)),ds(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new yw({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new B_({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new mE({view:this.view,momentum:s}):null}_computePlanePoints(e,r,i,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=C()),AU(r,i,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};LU=h([F("esri.views.3d.state.controllers.local.PinchAndPanController")],LU);let yX=class extends Zn{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!mV(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new IU({view:this._view}):new LU({view:this._view})}},M6e=class extends Zn{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},Ahe=class extends Zn{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},$6e=class extends Ahe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},I6e=class extends Ahe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},L6e=class extends Zn{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var s,n,o;const r=this._invert?-1:1,i=Li(0,e.data.delta*r);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new fE({view:this._view,pivot:ml.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(n=this._cameraController)==null||n.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function _X(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>F6e(r,t.axisThreshold))}:{buttons:[],axes:[]}}function D6e(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function N6e(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function F6e(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let U6e=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,_X(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new f7(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=Kw({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=_X(n),l=i||N6e(a);o&&(o.timestamp===s.timestamp||!o.active&&l||D6e(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&e(s)}}_emitGamepadEvent(e,r,i){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const vX=ie("edge"),z6e=ie("chrome"),k6e=ie("ff"),B6e=ie("safari"),bX="esri-view-surface",Dv={touchNone:`${bX}--touch-none`,touchPan:`${bX}--touch-pan`};let Ohe=class Rhe{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new U6e(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Oe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(A4[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&A4[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(A4[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Dv.touchNone:Dv.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Dv.touchPan:Dv.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Dv.touchNone),this._element.classList.remove(Dv.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=cle(this._element,e);return Rhe.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=YPe(r);i&&e==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:vX&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}vX?i*=.7:z6e||B6e?i*=.6:k6e&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};Ohe.test={disableSubpixelCoordinates:!1};const A4={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let V6e=class extends Zn{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function Phe(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function G6e(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function j6e(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Pu()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,E]=t,[O,A]=[E.x-x.x,E.y-x.y];return e.radius=Math.sqrt(O*O+A*A)/2,e.center.x=(x.x+E.x)/2,e.center.y=(x.y+E.y)/2,e}let r=0,i=0;for(let x=0;x<t.length;x++)r+=t[x].x,i+=t[x].y;r/=t.length,i/=t.length;const s=t.map(x=>x.x-r),n=t.map(x=>x.y-i);let o=0,a=0,l=0,c=0,u=0,d=0,p=0;for(let x=0;x<s.length;x++){const E=s[x],O=n[x],A=E*E,$=O*O;o+=A,a+=$,l+=E*O,c+=A*E,u+=$*O,d+=E*$,p+=O*A}const g=.5*(c+d),y=.5*(u+p),_=o*a-l*l,v=(g*a-y*l)/_,w=(o*y-l*g)/_,T=Pu(v+r,w+i);return{radius:Math.sqrt(v*v+w*w+(o+a)/t.length),center:T}}function gE(t){const{native:e}=t,{pointerId:r,button:i,pointerType:s}=e;return s==="mouse"?`${r}:${i}`:`${s}`}let H6e=class extends Zn{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:W6e(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=cO(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=RP(s,Mhe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=cO(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=cO(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=RP(i,r)-e,i.lastAngle=RP(i,r)-e})}_emitEvent(e,r,i){const s=cO(this._activePointerMap);this._drag.emit(this._createPayload(e,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,s=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function Mhe(t){const e=[];return t.forEach(r=>{e.push(Pu(r.event.x,r.event.y))}),j6e(e)}function cO(t){const e=Mhe(t);let r=0;return t.forEach(i=>{let s=RP(i,e),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function W6e(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function RP(t,e){const r=t.event,i=r.x-e.center.x,s=r.y-e.center.y;return Math.atan2(s,i)}var wX;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(wX||(wX={}));const g0={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let q6e=class extends Zn{constructor(e=g0.maximumDoubleClickDelay,r=g0.maximumDoubleClickDistance,i=g0.maximumDoubleTouchDelay,s=g0.maximumDoubleTouchDistance,n=Qw){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=bi(e.doubleClickTimer))}get hasPendingInputs(){return ao(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=bi(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:s}=e.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Phe(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=gE(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,s=gE(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},Y6e=class extends Zn{constructor(e=g0.maximumDoubleClickDelay,r=g0.maximumDoubleClickDistance,i=g0.maximumDoubleTouchDelay,s=g0.maximumDoubleTouchDistance,n=Qw){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=gE(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=gE(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Phe(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=gE(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const Q2={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let X6e=class extends Zn{constructor(e=Q2.maximumClickDelay,r=Q2.movementUntilMouseDrag,i=Q2.movementUntilPenDrag,s=Q2.movementUntilTouchDrag,n=Q2.holdDelay,o=Qw){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=bi(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):G6e(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),s.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},Z6e=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},J6e=class extends Zn{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Z6e({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),u=Math.min(u,v);const d=i-s,p=n-o,g=a-l,y=c-u;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(g-d)<=this._maxDelta&&Math.abs(y-p)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}},hh=class extends we{constructor(){super(...arguments),this._handles=new Oi}destroy(){this._handles=Oe(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Oe(this._inputManager)}connect(){const e=this.view;this._source=new Ohe(this.view.surface,e.input);const r=[new Y6e,new X6e,new q6e,new H6e(this.view.navigation),new J6e],i=new Wc({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new V6e],x0.INTERNAL),this._modeDragPan=new yX(e,"primary"),this._modeDragRotate=new E4(e,"secondary",ml.CENTER),this._modeDragZoom=new f6e(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new M6e(e),new lFe(e),new x6e(e),new T6e(e,s.pan),new S6e(e),new I6e(e,s.resetTilt),new $6e(e,s.resetHeading),new E4(e,"primary",ml.EYE,[s.lookAround]),new E4(e,"secondary",ml.CENTER,[s.lookAround]),new yX(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new L6e(e)],x0.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(ce(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},Tr))}_updateMode(){var s;const e=this.mode,r=this.primaryDragAction,i=(s=DU.get(e))==null?void 0:s.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};h([f()],hh.prototype,"view",void 0),h([f({value:"pan"})],hh.prototype,"primaryDragAction",null),h([f({value:"default"})],hh.prototype,"mode",null),h([f({readOnly:!0})],hh.prototype,"updating",null),h([f()],hh.prototype,"latestPointerType",null),h([f()],hh.prototype,"latestPointerLocation",null),h([f()],hh.prototype,"multiTouchActive",null),h([f()],hh.prototype,"_inputManager",void 0),hh=h([F("esri.views.3d.input.SceneInputManager")],hh);const DU=new Map,O4=new Map,R4=new Map;O4.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),O4.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),R4.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),R4.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),DU.set("default",O4),DU.set("pro",R4);const Q6e=hh;let os=class extends we{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};h([f()],os.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),h([f()],os.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),h([f()],os.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),h([f()],os.prototype,"DECONFLICTOR_SHOW_GRID",void 0),h([f()],os.prototype,"LABELS_SHOW_BORDER",void 0),h([f()],os.prototype,"TEXT_SHOW_BASELINE",void 0),h([f()],os.prototype,"TEXT_SHOW_BORDER",void 0),h([f()],os.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),h([f()],os.prototype,"OVERLAY_SHOW_CENTER",void 0),h([f()],os.prototype,"SHOW_POI",void 0),h([f()],os.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),h([f()],os.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),h([f()],os.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),h([f()],os.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),h([f()],os.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),h([f()],os.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),h([f()],os.prototype,"I3S_TREE_SHOW_TILES",void 0),h([f()],os.prototype,"I3S_SHOW_MODIFICATIONS",void 0),h([f()],os.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),h([f()],os.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),h([f()],os.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),h([f()],os.prototype,"LINE_WIREFRAMES",void 0),os=h([F("esri.views.3d.support.DebugFlags")],os);const kr=new os;let ec,kw,NU=!1,FU=!1,UU=!1,zU=!1,yE=null;function K6e(t,e){if(!FU||!kw)return;$he();const r=kw;let i=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];i+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,u=(n+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),Ihe(a,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function e9e(t){UU=kr.DECONFLICTOR_SHOW_VISIBLE,zU=kr.DECONFLICTOR_SHOW_INVISIBLE,NU=UU||zU,FU=kr.DECONFLICTOR_SHOW_GRID,yE=null,NU||FU?yE=()=>t9e(t):ec&&(ec.parentElement.removeChild(ec),ec=null)}function $he(){yE&&(yE(),yE=null)}function t9e(t){ec==null&&(ec=document.createElement("canvas"),ec.setAttribute("id","canvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(ec));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:s,height:n}=r,o=s*i,a=n*i;ec.setAttribute("width",`${o}px`),ec.setAttribute("height",`${a}px`),ec.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),kw=ec.getContext("2d"),kw.clearRect(0,0,s,n),kw.font="12px Arial"}function Ihe(t,e,r,i,s){$he();const n=ec.height,o=kw;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-r),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.closePath()}function r9e(t,e){NU&&(e&&UU||!e&&zU)&&Ihe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var ho,yn;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(ho||(ho={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(yn||(yn={}));function Lhe(t,e){return new Uhe(t,khe,e)}function i9e(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=khe;return new Uhe(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:P4.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:P4.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:P4.minPixelSize},e)}function s9e(t){return Math.abs(t*t*t)}function Dhe(t,e,r){const i=r.parameters,s=r.paddingPixelsOverride;return K2.scale=Math.min(i.divisor/(e-i.offset),1),K2.factor=s9e(t),K2.minPixelSize=i.minPixelSize,K2.paddingPixels=s,K2}function Nhe(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function TV(t,e){return Math.max(_t(t*e.scale,t,e.factor),Nhe(t,e))}function n9e(t,e,r){const i=Dhe(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,TV(1,i)}function xX(t,e,r,i){i.scale=n9e(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function Fhe(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,Nhe(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function o9e(t,e,r,i){return TV(t,Dhe(e,r,i))}let Uhe=class zhe{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,s=a9e(),n){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===Re.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new zhe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),u=this._coverageCompensation(e,r,c),{tiltAngle:d,scaleFallOffFactor:p}=c,g=Math.sin(d)*l,y=.5*Math.PI-d-a*(.5-s*u),_=g/Math.cos(y),v=y+a*n*u,w=(_-p*(g/Math.cos(v)))/(1-p);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=w,i.divisor=_-w,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=TX){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=TX){const s=this._description.curvatureDependent,n=1+e.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=me((o-a)/(l-a),0,1),[u,d]=[s.min,s.max];return i.tiltAngle=_t(u.tiltAngle,d.tiltAngle,c),i.scaleFallOffFactor=_t(u.scaleFallOffFactor,d.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),u=Math.sqrt(l-s);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}};const khe={curvatureDependent:{min:{curvature:At(10),tiltAngle:At(12),scaleFallOffFactor:.5},max:{curvature:At(70),tiltAngle:At(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},P4={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function a9e(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const K2={scale:0,factor:0,minPixelSize:0,paddingPixels:0},TX={tiltAngle:0,scaleFallOffFactor:0};function l9e(t){return t instanceof Float32Array&&t.length>=16}function c9e(t){return Array.isArray(t)&&t.length>=16}function u9e(t){return l9e(t)||c9e(t)}function SV(t){t.vertex.code.add(b`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(b`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(b`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(b`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(b`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(b`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(b`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function h9e(t){t.uniforms.add(new Wt("screenSizePerspective",e=>Bhe(e.screenSizePerspective)))}function rD(t){t.uniforms.add(new Wt("screenSizePerspectiveAlignment",e=>Bhe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function Bhe(t){return oi(d9e,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const d9e=Ht();let Vhe=class extends Ji{constructor(e,r){super(e,"mat4",zr.Draw,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};function td(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Va):t.uniforms.add(new mc("cameraPosition",(r,i)=>se(Ghe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Pl(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new wi("proj",(i,s)=>s.camera.projectionMatrix),new Vhe("view",(i,s)=>Wa(SX,s.camera.viewMatrix,i.origin)),new mc("localOrigin",i=>i.origin));const r=i=>se(Ghe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new wi("proj",(i,s)=>s.camera.projectionMatrix),new wi("view",(i,s)=>Wa(SX,s.camera.viewMatrix,r(s))),new Mt("localOrigin",(i,s)=>r(s)))}const SX=xe(),Ghe=C();function Px(t){t.uniforms.add(new wi("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function jhe(t,e){const r=t.vertex;e.hasVerticalOffset?(Hhe(r),e.hasScreenSizePerspective&&(t.include(SV),rD(r),td(t.vertex,e)),r.code.add(b`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?b`vec3 worldNormal = normalize(worldPos + localOrigin);`:b`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?b`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:b`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(b`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const p9e=Ht();function Hhe(t){t.uniforms.add(new Wt("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return oi(p9e,n*a,o,i,s)}))}function iD(t){t.uniforms.add(new vp("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(b`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(b`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var dl;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(dl||(dl={}));var Ua;function Whe(t,e){t.include(SV),t.attributes.add(S.POSITION,"vec3"),t.attributes.add(S.NORMAL,"vec3"),t.attributes.add(S.AUXPOS1,"vec4");const r=t.vertex;Pl(r,e),td(r,e),r.uniforms.add(new Wt("viewport",(i,s)=>s.camera.fullViewport),new Se("polygonOffset",i=>i.shaderPolygonOffset),new Se("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new Se("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===dl.Occluded?1:s.renderTransparentlyOccludedHUD===dl.NotOccluded?0:.75),new We("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)),e.hasVerticalOffset&&Hhe(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(b`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(b`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.isDraped&&!e.hasVerticalOffset||Px(r),e.isDraped||(r.uniforms.add(new Se("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(b`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===Ua.Screen&&r.uniforms.add(new Se("pixelRatio",(i,s)=>s.camera.pixelRatio)),e.hasScreenSizePerspective&&rD(r),r.code.add(b`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===Ua.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?b`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==Ua.Screen?b`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===Ua.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===Ua.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.include(iD),r.code.add(b`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(Ua||(Ua={}));const uO=Bs();function qhe(t,e,r,i,s,n){if(t.visible)if(t.boundingInfo){He(t.type===Wi.Mesh);const o=e.tolerance;Yhe(t.boundingInfo,r,i,o,s,n)}else{const o=t.indices.get(S.POSITION),a=t.vertexAttributes.get(S.POSITION);_A(r,i,0,o.length/3,o,a,void 0,s,n)}}const f9e=C();function Yhe(t,e,r,i,s,n){if(t==null)return;const o=Zhe(e,r,f9e);if(Tne(uO,t.bbMin),Sne(uO,t.bbMax),s!=null&&s.applyToAabb(uO),CV(uO,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,u=a?a.length:l.length/3;if(u>_9e){const d=t.getChildren();if(d!==void 0){for(const p of d)Yhe(p,e,r,i,s,n);return}}_A(e,r,0,u,l,c,a,s,n)}}const Xhe=C();function _A(t,e,r,i,s,n,o,a,l){if(o)return m9e(t,e,r,i,s,n,o,a,l);const{data:c,stride:u}=n,d=t[0],p=t[1],g=t[2],y=e[0]-d,_=e[1]-p,v=e[2]-g;for(let w=r,T=3*r;w<i;++w){let x=u*s[T++],E=c[x++],O=c[x++],A=c[x];x=u*s[T++];let $=c[x++],M=c[x++],U=c[x];x=u*s[T++];let k=c[x++],B=c[x++],z=c[x];a!=null&&([E,O,A]=a.applyToVertex(E,O,A,w),[$,M,U]=a.applyToVertex($,M,U,w),[k,B,z]=a.applyToVertex(k,B,z,w));const Y=$-E,W=M-O,j=U-A,Z=k-E,R=B-O,I=z-A,N=_*I-R*v,V=v*Z-I*y,q=y*R-Z*_,J=Y*N+W*V+j*q;if(Math.abs(J)<=Number.EPSILON)continue;const K=d-E,ge=p-O,Me=g-A,pt=K*N+ge*V+Me*q;if(J>0){if(pt<0||pt>J)continue}else if(pt>0||pt<J)continue;const Tt=ge*j-W*Me,et=Me*Y-j*K,tt=K*W-Y*ge,Ne=y*Tt+_*et+v*tt;if(J>0){if(Ne<0||pt+Ne>J)continue}else if(Ne>0||pt+Ne<J)continue;const de=(Z*Tt+R*et+I*tt)/J;de>=0&&l(de,EV(Y,W,j,Z,R,I,Xhe),w,!1)}}function m9e(t,e,r,i,s,n,o,a,l){const{data:c,stride:u}=n,d=t[0],p=t[1],g=t[2],y=e[0]-d,_=e[1]-p,v=e[2]-g;for(let w=r;w<i;++w){const T=o[w];let x=3*T,E=u*s[x++],O=c[E++],A=c[E++],$=c[E];E=u*s[x++];let M=c[E++],U=c[E++],k=c[E];E=u*s[x];let B=c[E++],z=c[E++],Y=c[E];a!=null&&([O,A,$]=a.applyToVertex(O,A,$,w),[M,U,k]=a.applyToVertex(M,U,k,w),[B,z,Y]=a.applyToVertex(B,z,Y,w));const W=M-O,j=U-A,Z=k-$,R=B-O,I=z-A,N=Y-$,V=_*N-I*v,q=v*R-N*y,J=y*I-R*_,K=W*V+j*q+Z*J;if(Math.abs(K)<=Number.EPSILON)continue;const ge=d-O,Me=p-A,pt=g-$,Tt=ge*V+Me*q+pt*J;if(K>0){if(Tt<0||Tt>K)continue}else if(Tt>0||Tt<K)continue;const et=Me*Z-j*pt,tt=pt*W-Z*ge,Ne=ge*j-W*Me,de=y*et+_*tt+v*Ne;if(K>0){if(de<0||Tt+de>K)continue}else if(de>0||Tt+de<K)continue;const rt=(R*et+I*tt+N*Ne)/K;rt>=0&&l(rt,EV(W,j,Z,R,I,N,Xhe),T,!1)}}const EX=C(),CX=C();function EV(t,e,r,i,s,n,o){return se(EX,t,e,r),se(CX,i,s,n),Qe(o,EX,CX),fe(o,o),o}function Zhe(t,e,r){return se(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function CV(t,e,r,i){return AV(t,e,r,i,1/0)}function AV(t,e,r,i,s){const n=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-i-e[1])*r[1],u=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const d=(t[2]-i-e[2])*r[2],p=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(d,p)),!(l<0)&&(a=Math.max(a,Math.min(d,p)),!(a>l)&&a<s)}function Jhe(t,e,r,i,s){let n=(r.screenLength||0)*t.pixelRatio;s!=null&&(n=o9e(n,i,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return me(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function Qhe(t,e){const r=e?Qhe(e):{};for(const i in t){let s=t[i];s&&s.forEach&&(s=y9e(s)),s==null&&i in r||(r[i]=s)}return r}function g9e(t,e){let r=!1;for(const i in e){const s=e[i];s!==void 0&&(Array.isArray(s)?t[i]===null?(t[i]=s.slice(),r=!0):Yz(t[i],s)&&(r=!0):t[i]!==s&&(r=!0,t[i]=s))}return r}function y9e(t){const e=[];return t.forEach(r=>e.push(r)),e}const Khe={multiply:1,ignore:2,replace:3,tint:4},_9e=1e3;let ry=class extends fA{constructor(e,r){super(),this.type=Wi.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=cr,this._pp0=Ce(0,0,1),this._pp1=Ce(0,0,0),this._parameters=Qhe(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){g9e(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(e,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,i,this._pp0,this._pp1,n)}},ede=class extends BDe{constructor(e,r,i){super(r,i),this.camera=e}};var _i;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(_i||(_i={}));let OV=class extends Ar{constructor(){super(...arguments),this.renderOccluded=_i.Occlude}},tde=class{constructor(){this.factor=new AX,this.factorAlignment=new AX}},AX=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function wmt(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let u=0;u<s;u++)n[i]=c,i+=o}}function OX(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length;i*=n;for(let a=0;a<o;++a){const l=2*t[a];s[i]=e[l],s[i+1]=e[l+1],i+=n}}function rde(t,e,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let u=0;u<s;++u)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}}function Mx(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let u=0;u<s;++u)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}}function RX(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<r;++n)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=s}function sD(t,e,r,i,s,n=1){if(!r)return void rde(t,e,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],u=r[1],d=r[2],p=r[4],g=r[5],y=r[6],_=r[8],v=r[9],w=r[10],T=r[12],x=r[13],E=r[14];s*=a;let O=0,A=0,$=0;const M=gL(r)?U=>{O=e[U]+T,A=e[U+1]+x,$=e[U+2]+E}:U=>{const k=e[U],B=e[U+1],z=e[U+2];O=c*k+p*B+_*z+T,A=u*k+g*B+v*z+x,$=d*k+y*B+w*z+E};if(n===1)for(let U=0;U<l;++U)M(3*t[U]),o[s]=O,o[s+1]=A,o[s+2]=$,s+=a;else for(let U=0;U<l;++U){M(3*t[U]);for(let k=0;k<n;++k)o[s]=O,o[s+1]=A,o[s+2]=$,s+=a}}function RV(t,e,r,i,s,n=1){if(!r)return void rde(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,u=o[0],d=o[1],p=o[2],g=o[4],y=o[5],_=o[6],v=o[8],w=o[9],T=o[10],x=!kB(o),E=1e-6,O=1-E;s*=l;let A=0,$=0,M=0;const U=gL(o)?k=>{A=e[k],$=e[k+1],M=e[k+2]}:k=>{const B=e[k],z=e[k+1],Y=e[k+2];A=u*B+g*z+v*Y,$=d*B+y*z+w*Y,M=p*B+_*z+T*Y};if(n===1)if(x)for(let k=0;k<c;++k){U(3*t[k]);const B=A*A+$*$+M*M;if(B<O&&B>E){const z=1/Math.sqrt(B);a[s]=A*z,a[s+1]=$*z,a[s+2]=M*z}else a[s]=A,a[s+1]=$,a[s+2]=M;s+=l}else for(let k=0;k<c;++k)U(3*t[k]),a[s]=A,a[s+1]=$,a[s+2]=M,s+=l;else for(let k=0;k<c;++k){if(U(3*t[k]),x){const B=A*A+$*$+M*M;if(B<O&&B>E){const z=1/Math.sqrt(B);A*=z,$*=z,M*=z}}for(let B=0;B<n;++B)a[s]=A,a[s+1]=$,a[s+2]=M,s+=l}}function v9e(t,e,r,i,s,n=1){if(!r)return void Mx(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,u=o[0],d=o[1],p=o[2],g=o[4],y=o[5],_=o[6],v=o[8],w=o[9],T=o[10],x=!kB(o),E=1e-6,O=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const $=4*t[A],M=e[$],U=e[$+1],k=e[$+2],B=e[$+3];let z=u*M+g*U+v*k,Y=d*M+y*U+w*k,W=p*M+_*U+T*k;if(x){const j=z*z+Y*Y+W*W;if(j<O&&j>E){const Z=1/Math.sqrt(j);z*=Z,Y*=Z,W*=Z}}a[s]=z,a[s+1]=Y,a[s+2]=W,a[s+3]=B,s+=l}else for(let A=0;A<c;++A){const $=4*t[A],M=e[$],U=e[$+1],k=e[$+2],B=e[$+3];let z=u*M+g*U+v*k,Y=d*M+y*U+w*k,W=p*M+_*U+T*k;if(x){const j=z*z+Y*Y+W*W;if(j<O&&j>E){const Z=1/Math.sqrt(j);z*=Z,Y*=Z,W*=Z}}for(let j=0;j<n;++j)a[s]=z,a[s+1]=Y,a[s+2]=W,a[s+3]=B,s+=l}}function PV(t,e,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(s*=a,r!==e.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const u=3*t[c];for(let d=0;d<n;++d)o[s]=e[u],o[s+1]=e[u+1],o[s+2]=e[u+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const u=4*t[c];for(let d=0;d<n;++d)o[s]=e[u],o[s+1]=e[u+1],o[s+2]=e[u+2],o[s+3]=e[u+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const u=4*t[c];o[s]=e[u],o[s+1]=e[u+1],o[s+2]=e[u+2],o[s+3]=e[u+3],s+=a}return}for(let c=0;c<l;++c){const u=3*t[c];o[s]=e[u],o[s+1]=e[u+1],o[s+2]=e[u+2],o[s+3]=255,s+=a}}else{o[s]=e[0],o[s+1]=e[1],o[s+2]=e[2],o[s+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),u=a/4,d=c[s/=4];s+=u;const p=l*n;for(let g=1;g<p;++g)c[s]=d,s+=u}}function b9e(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length,a=e[0];i*=n;for(let l=0;l<o;++l)s[i]=a,i+=n}function ide(t,e,r,i,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o}function sde(t,e,r,i,s,n){for(const o of e.fields.keys()){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)switch(o){case S.POSITION:{He(a.size===3);const c=s.getField(o,Os);He(!!c,`No buffer view for ${o}`),c&&sD(l,a.data,r,c,n);break}case S.NORMAL:{He(a.size===3);const c=s.getField(o,Os);He(!!c,`No buffer view for ${o}`),c&&RV(l,a.data,i,c,n);break}case S.NORMALCOMPRESSED:{He(a.size===2);const c=s.getField(o,pA);He(!!c,`No buffer view for ${o}`),c&&OX(l,a.data,c,n);break}case S.UV0:{He(a.size===2);const c=s.getField(o,ty);He(!!c,`No buffer view for ${o}`),c&&OX(l,a.data,c,n);break}case S.COLOR:case S.SYMBOLCOLOR:{const c=s.getField(o,wo);He(!!c,`No buffer view for ${o}`),He(a.size===3||a.size===4),!c||a.size!==3&&a.size!==4||PV(l,a.data,a.size,c,n);break}case S.COLORFEATUREATTRIBUTE:{const c=s.getField(o,FL);He(!!c,`No buffer view for ${o}`),He(a.size===1),c&&a.size===1&&b9e(l,a.data,c,n);break}case S.TANGENT:{He(a.size===4);const c=s.getField(o,ed);He(!!c,`No buffer view for ${o}`),c&&v9e(l,a.data,i,c,n);break}case S.PROFILERIGHT:case S.PROFILEUP:case S.PROFILEVERTEXANDNORMAL:case S.FEATUREVALUE:{He(a.size===4);const c=s.getField(o,ed);He(!!c,`No buffer view for ${o}`),c&&Mx(l,a.data,c,n)}}else if(o===S.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.indices.get(S.POSITION);if(He(!!c,`No buffer view for ${o}`),c){const u=c.length,d=s.getField(o,wo);ide(t.objectAndLayerIdColor,d,u,n)}}}}function vC(t,e,r=0){const i=me(t,0,T9e);for(let s=0;s<4;s++)e[r+s]=Math.floor(256*S9e(i*w9e[s]))}function MV(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*x9e[i];return r}const w9e=[1,256,65536,16777216],x9e=[1/256,1/65536,1/16777216,1/4294967296],T9e=MV(new Uint8ClampedArray([255,255,255,255]));function S9e(t){return t-Math.floor(t)}async function hm(t,e){const{data:r}=await Es(t,{responseType:"image",...e});return r}function E9e(){if(M4==null){const t=e=>Rr(`esri/libs/basisu/${e}`);M4=he(()=>import("./basis_transcoder-3d832dd1.js"),[]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return M4}let M4;var V_;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(V_||(V_={}));let jh=null,hO=null;async function nde(){return hO==null&&(hO=E9e(),jh=await hO),hO}function C9e(t,e){if(jh==null)return t.byteLength;const r=new jh.BasisFile(new Uint8Array(t)),i=ade(r)?ode(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function A9e(t,e){if(jh==null)return t.byteLength;const r=new jh.KTX2File(new Uint8Array(t)),i=lde(r)?ode(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function ode(t,e,r,i,s){const n=Jle(e?Ki.COMPRESSED_RGBA8_ETC2_EAC:Ki.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*n*o)}function ade(t){return t.getNumImages()>=1&&!t.isUASTC()}function lde(t){return t.getFaces()>=1&&t.isETC1S()}async function O9e(t,e,r){jh==null&&(jh=await nde());const i=new jh.BasisFile(new Uint8Array(r));if(!ade(i))return null;i.startTranscoding();const s=cde(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function R9e(t,e,r){jh==null&&(jh=await nde());const i=new jh.KTX2File(new Uint8Array(r));if(!lde(i))return null;i.startTranscoding();const s=cde(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function cde(t,e,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,d]=l?i?[V_.ETC2_RGBA,Ki.COMPRESSED_RGBA8_ETC2_EAC]:[V_.ETC1_RGB,Ki.COMPRESSED_RGB8_ETC2]:c?i?[V_.BC3_RGBA,Ki.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[V_.BC1_RGB,Ki.COMPRESSED_RGB_S3TC_DXT1_EXT]:[V_.RGBA32,Pt.RGBA],p=e.hasMipmap?r:Math.min(1,r),g=[];for(let y=0;y<p;y++)g.push(new Uint8Array(o(y,u))),a(y,u,g[y]);return e.internalFormat=d,e.hasMipmap=g.length>1,e.samplingMode=e.hasMipmap?wt.LINEAR_MIPMAP_LINEAR:wt.LINEAR,e.width=s,e.height=n,new bt(t,e,{type:"compressed",levels:g})}const dO=ne.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),P9e=542327876,M9e=131072,$9e=4;function $V(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function I9e(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const L9e=$V("DXT1"),D9e=$V("DXT3"),N9e=$V("DXT5"),F9e=31,U9e=0,z9e=1,k9e=2,B9e=3,V9e=4,G9e=7,j9e=20,H9e=21;function W9e(t,e,r){const i=q9e(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=i;return e.samplingMode=s.levels.length>1?wt.LINEAR_MIPMAP_LINEAR:wt.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new bt(t,e,s)}function q9e(t,e){const r=new Int32Array(t,0,F9e);if(r[U9e]!==P9e)return dO.error("Invalid magic number in DDS header"),null;if(!(r[j9e]&$9e))return dO.error("Unsupported format, must contain a FourCC code"),null;const i=r[H9e];let s,n;switch(i){case L9e:s=8,n=Ki.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case D9e:s=16,n=Ki.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case N9e:s=16,n=Ki.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return dO.error("Unsupported FourCC code:",I9e(i)),null}let o=1,a=r[V9e],l=r[B9e];!(3&a)&&!(3&l)||(dO.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,p;r[k9e]&M9e&&e!==!1&&(o=Math.max(1,r[G9e]));let g=r[z9e]+4;const y=[];for(let _=0;_<o;++_)p=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t,g,p),y.push(d),g+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:u}}let pv=class PP extends fA{constructor(e,r){super(),this._data=e,this.type=Wi.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new ys,this.parameters=r||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:Ot.REPEAT,t:Ot.REPEAT},this.memoryEstimate=PP._estimateTexMemRequired(this._data,this.parameters),this._startPreload()}_startPreload(){const e=this._data;e!=null&&(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(GE(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){Ip(e.src)||GE(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,r){if(e==null)return 0;if(E2(e)||Zg(e))return r.encoding===Df.KTX2_ENCODING?A9e(e,!!r.mipmap):r.encoding===Df.BASIS_ENCODING?C9e(e,!!r.mipmap):e.byteLength;const{width:i,height:s}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?PP._getDataDimensions(e):r;return(r.mipmap?4/3:1)*i*s*(r.components||4)||0}dispose(){this._data=void 0}get width(){return this.parameters.width}get height(){return this.parameters.height}_createDescriptor(e){const r=new xr;return r.wrapMode=this.parameters.wrap??Ot.REPEAT,r.flipped=!this.parameters.noUnpackFlip,r.samplingMode=this.parameters.mipmap?wt.LINEAR_MIPMAP_LINEAR:wt.LINEAR,r.hasMipmap=!!this.parameters.mipmap,r.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,r.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}load(e){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise!=null)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new bt(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(E2(r)||Zg(r))&&this.parameters.encoding===Df.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(E2(r)||Zg(r))&&this.parameters.encoding===Df.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(E2(r)||Zg(r))&&this.parameters.encoding===Df.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):Zg(r)?this._loadFromPixelData(e,r):E2(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<_E.HAVE_CURRENT_DATA||e===this._data.currentTime?e:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):e}_loadFromDDSData(e,r){return this._glTexture=W9e(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>R9e(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>O9e(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){He(this.parameters.width>0&&this.parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.parameters.components===1?Pt.LUMINANCE:this.parameters.components===3?Pt.RGB:Pt.RGBA,i.width=this.parameters.width??0,i.height=this.parameters.height??0,this._glTexture=new bt(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const s=await hm(r,{signal:i});return qt(i),this._loadFromImage(e,s)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const s=await zre(r,r.src,!1,i);return qt(i),this._loadFromImage(e,s)})}_loadFromVideoElement(e,r){return r.readyState>=_E.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((s,n)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),bi(c)},a=()=>{r.readyState>=_E.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,r)))},l=u=>{o(),n(u||new X("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=Uo(i,()=>l(wr()))}))}_loadFromImage(e,r){const i=PP._getDataDimensions(r);this.parameters.width=i.width,this.parameters.height=i.height;const s=this._createDescriptor(e);return s.pixelFormat=this.parameters.components===3?Pt.RGB:Pt.RGBA,s.width=i.width,s.height=i.height,this._glTexture=new bt(e,s,r),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}unload(){if(this._glTexture!=null&&(this._glTexture.dispose(),this._glTexture=null),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};var _E;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(_E||(_E={}));const bC=128,IV=.5;function ude(t,e=bC,r=e*IV,i=0){const s=Y9e(t,e,r,i);return new pv(s,{mipmap:!1,wrap:{s:Ot.CLAMP_TO_EDGE,t:Ot.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function Y9e(t,e=bC,r=e*IV,i=0){switch(t){case"circle":default:return X9e(e,r);case"square":return Z9e(e,r);case"cross":return Q9e(e,r,i);case"x":return K9e(e,r,i);case"kite":return J9e(e,r);case"triangle":return e8e(e,r);case"arrow":return t8e(e,r)}}function X9e(t,e){const r=t/2-.5;return vA(t,pde(r,r,e/2))}function Z9e(t,e){return hde(t,e,!1)}function J9e(t,e){return hde(t,e,!0)}function Q9e(t,e,r=0){return dde(t,e,!1,r)}function K9e(t,e,r=0){return dde(t,e,!0,r)}function e8e(t,e){return vA(t,fde(t/2,e,e/2))}function t8e(t,e){const r=e,i=e/2,s=t/2,n=.8*r,o=pde(s,(t-e)/2-n,Math.sqrt(n*n+i*i)),a=fde(s,r,i);return vA(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function hde(t,e,r){return r&&(e/=Math.SQRT2),vA(t,(i,s)=>{let n=i-.5*t+.25,o=.5*t-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function dde(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const s=.5*e;return vA(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function pde(t,e,r){return(i,s)=>{const n=i-t,o=s-e;return Math.sqrt(n*n+o*o)-r}}function fde(t,e,r){const i=Math.sqrt(e*e+r*r);return(s,n)=>{const o=Math.abs(s-t)-r,a=n-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function vA(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s+t*i;let o=e(s,i);o=o/t+.5,vC(o,r,4*n)}return r}let xmt=class extends Ar{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function r8e(t,e){mde(t,e,new Mt("slicePlaneOrigin",(r,i)=>vde(e,r,i)),new Mt("slicePlaneBasis1",(r,i)=>{var s;return N$(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new Mt("slicePlaneBasis2",(r,i)=>{var s;return N$(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function rs(t,e){mde(t,e,new mc("slicePlaneOrigin",(r,i)=>vde(e,r,i)),new mc("slicePlaneBasis1",(r,i)=>{var s;return N$(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new mc("slicePlaneBasis2",(r,i)=>{var s;return N$(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function mde(t,e,...r){if(!e.hasSlicePlane){const o=b`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=b`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=b`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?b`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:b`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(n)}function gde(t,e,r){return t.instancedDoublePrecision?se(i8e,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function yde(t,e){return t!=null?le(F$,e.origin,t):e.origin}function _de(t,e,r){return t.hasSliceTranslatedView?e!=null?Wa(s8e,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function vde(t,e,r){if(r.slicePlane==null)return Va;const i=gde(t,e,r),s=yde(i,r.slicePlane),n=_de(t,i,r);return n!=null?De(F$,s,n):s}function N$(t,e,r,i){if(i==null||r.slicePlane==null)return Va;const s=gde(t,e,r),n=yde(s,r.slicePlane),o=_de(t,s,r);return o!=null?(oe(eT,i,n),De(F$,n,o),De(eT,eT,o),le(eT,eT,F$)):i}const i8e=C(),F$=C(),eT=C(),s8e=xe();function bA(t,e){const r=e.output===L.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(S.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(S.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(b`
     void forwardObjectAndLayerIdColor() {
      ${r?i?b`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:b`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:b``} }`),t.fragment.code.add(b`
      void outputObjectAndLayerIdColor() {
        ${r?b`fragColor = objectAndLayerIdColorVarying;`:b``} }`)}function n8e(t,e){const{vertex:r,fragment:i}=t;r.include(iD),e.hasMultipassGeometry&&r.include(wce),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(b`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?b`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(xc),e.hasMultipassTerrain&&i.uniforms.add(new We("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new mr("nearFar",(s,n)=>n.camera.nearFar)),i.include(Ll),i.code.add(b`
  void main() {
    fragColor = vec4(1);
    ${e.hasMultipassTerrain?b`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const o8e=Ct(1,1,0,1),bde=Ct(1,0,1,1);function Am(t){t.fragment.uniforms.add(new We("depthTex",(e,r)=>r.highlightDepthTexture)),t.fragment.constants.add("occludedHighlightFlag","vec4",o8e).add("unoccludedHighlightFlag","vec4",bde),t.fragment.code.add(b`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTex, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let wde=class extends Ji{constructor(e,r,i){super(e,"vec4",zr.Pass,(s,n,o)=>s.setUniform4fv(e,r(n,o)),i)}},za=class extends Ji{constructor(e,r,i){super(e,"float",zr.Pass,(s,n,o)=>s.setUniform1fv(e,r(n,o)),i)}};const $x={unknown:1,inches:so(1,"meters","inches"),feet:so(1,"meters","feet"),"us-feet":so(1,"meters","us-feet"),yards:so(1,"meters","yards"),miles:so(1,"meters","miles"),"nautical-miles":so(1,"meters","nautical-miles"),millimeters:so(1,"meters","millimeters"),centimeters:so(1,"meters","centimeters"),decimeters:so(1,"meters","decimeters"),meters:so(1,"meters","meters"),kilometers:so(1,"meters","kilometers"),"decimal-degrees":1/vwe(1,"meters",Yt.radius)};var Lo,PX;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Lo||(Lo={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(PX||(PX={}));let LV=class{constructor(e){this.field=e}},a8e=class extends LV{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Lo.Undefined,Lo.Undefined,Lo.Undefined]}},l8e=class extends LV{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},c8e=class extends LV{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},u8e=class{};function tT(t){return t!=null}function Nv(t){return typeof t=="number"}function nD(t){return typeof t=="string"}function h8e(t){return t==null||nD(t)}function Fs(t,e){t&&t.push(e)}function d8e(t,e,r,i=xe()){const s=t||0,n=e||0,o=r||0;return s!==0&&dx(i,i,-s/180*Math.PI),n!==0&&hx(i,i,n/180*Math.PI),o!==0&&pL(i,i,o/180*Math.PI),i}function Xm(t,e,r,i,s){const n=t.minSize,o=t.maxSize;if(t.expression)return Fs(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Lo.DefinedSize,!0}if(tT(t.field))return tT(t.stops)?t.stops.length===2&&Nv(t.stops[0].size)&&Nv(t.stops[1].size)?(MX(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=Lo.DefinedSize,!0):(Fs(s,"Could not convert size info: stops only supported with 2 elements"),!1):Nv(n)&&Nv(o)&&tT(t.minDataValue)&&tT(t.maxDataValue)?(MX(n,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=Lo.DefinedSize,!0):t.valueUnit==="unknown"?(Fs(s,"Could not convert size info: proportional size not supported"),!1):$x[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/$x[t.valueUnit],e.type[r]=Lo.DefinedSize,!0):(Fs(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!tT(t.field)){if(t.stops&&t.stops[0]&&Nv(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Lo.DefinedSize,!0;if(Nv(n))return e.minSize[r]=n,e.maxSize[r]=n,e.offset[r]=n,e.factor[r]=0,e.type[r]=Lo.DefinedSize,!0}return Fs(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function MX(t,e,r,i,s,n){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-r*o,s.factor[n]=o}function p8e(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return Fs(i,"Could not convert size info: unsupported property"),null;if(!h8e(t.field))return Fs(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Fs(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new a8e(t.field);let s;switch(t.axis){case"width":return s=Xm(t,e.size,0,r,i),s?e:null;case"height":return s=Xm(t,e.size,2,r,i),s?e:null;case"depth":return s=Xm(t,e.size,1,r,i),s?e:null;case"width-and-depth":return s=Xm(t,e.size,0,r,i),s&&Xm(t,e.size,1,r,i),s?e:null;case null:case void 0:case"all":return s=Xm(t,e.size,0,r,i),s=s&&Xm(t,e.size,1,r,i),s=s&&Xm(t,e.size,2,r,i),s?e:null;default:return Fs(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function f8e(t,e,r){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===Lo.DefinedSize&&(n*=e.modelSize[s],t.type[s]=Lo.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let i;if(t.type[0]!==Lo.Undefined)i=0;else if(t.type[1]!==Lo.Undefined)i=1;else{if(t.type[2]===Lo.Undefined)return Fs(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)t.type[s]===Lo.Undefined&&(t.minSize[s]=t.minSize[i],t.maxSize[s]=t.maxSize[i],t.offset[s]=t.offset[i],t.factor[s]=t.factor[i],t.type[s]=t.type[i]);return!0}function $X(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function m8e(t,e,r){if(t.normalizationField)return Fs(r,"Could not convert color info: unsupported property"),null;if(nD(t.field)){if(!t.stops)return Fs(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Fs(r,"Could not convert color info: too many color stops"),null;e.color=new l8e(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.color.values[s]=n.value,$X(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Fs(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,$X(e.color.colors,s,i)}}return e}function g8e(t,e,r){if(t.normalizationField)return Fs(r,"Could not convert opacity info: unsupported property"),null;if(nD(t.field)){if(!t.stops)return Fs(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Fs(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new c8e(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Fs(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=i}}return e}function $4(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function y8e(t,e,r){if(!nD(t.field))return Fs(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Fs(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return $4(t,e.rotation,0),e;case"roll":return $4(t,e.rotation,1),e;case null:case void 0:case"heading":return $4(t,e.rotation,2),e;default:return Fs(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let wA=class{constructor(e,r=[1,1,1],i=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function xde(t,e,r){if(!t)return null;const i=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return Fs(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?p8e(n,s,e,r):s;case"color":return e.supports.color?m8e(n,s,r):s;case"opacity":return e.supports.opacity?g8e(n,s,r):null;case"rotation":return e.supports.rotation?y8e(n,s,r):s;default:return null}},new u8e);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i&&i.size&&!f8e(i.size,e,r)?null:i:null}let _8e=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function Ix(t,e){if(!t||kr.TESTS_DISABLE_FAST_UPDATES)return null;const r=xde(t.visualVariables,e);return r?new _8e(r,Sde(r,e),!!r.size):null}function Lx(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,s=xde(e.visualVariables,r);return!!s&&!!(pO(i.size,s.size,"size")&&pO(i.color,s.color,"color")&&pO(i.rotation,s.rotation,"rotation")&&pO(i.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=Sde(s,r),t.requiresShaderTransformation=!!s.size,!0)}function pO(t,e,r){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&r==="rotation"){const i=t,s=e;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}let Tde=class extends Ar{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function Sde(t,e){const r=new Tde(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,$u(vE),d8e(e.rotation[2],e.rotation[0],e.rotation[1],vE),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||Zi(),Lu(r.vvSymbolRotationMatrix,vE)),r}function kU(t,e,r){if(!t.vvSize)return r;en(Zm,r);const i=t.vvSymbolRotationMatrix;Fp(vE,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),qi(Zm,Zm,vE);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];IX[s]=me(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return dL(Zm,Zm,IX),Wa(Zm,Zm,t.vvSymbolAnchor),Zm}function v8e(t,e,r){if(e.vvSize)for(let i=0;i<3;++i){const s=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=me(s,e.vvSize.minSize[i],e.vvSize.maxSize[i])}else se(t,1,1,1)}function Hh(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const Zm=xe(),IX=C(),vE=xe();let xA=class extends Tde{constructor(){super(...arguments),this.renderOccluded=_i.Occlude}};const Bw=8;function E0(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(S.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new Mt("vvSizeMinSize",s=>s.vvSize.minSize)),r.uniforms.add(new Mt("vvSizeMaxSize",s=>s.vvSize.maxSize)),r.uniforms.add(new Mt("vvSizeOffset",s=>s.vvSize.offset)),r.uniforms.add(new Mt("vvSizeFactor",s=>s.vvSize.factor)),r.uniforms.add(new kp("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),r.uniforms.add(new Mt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),r.code.add(b`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(b`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?b`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(b`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",Bw),r.uniforms.add(new za("vvColorValues",s=>s.vvColor.values,Bw),new wde("vvColorColors",s=>s.vvColor.colors,Bw)),r.code.add(b`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?b`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(b`vec4 vvColor() { return vec4(1.0); }`)}const U$=.1,Gn=.001;function b8e(t){const e=new ur,r=t.signedDistanceFieldEnabled;if(e.include(Whe,t),e.include(rs,t),t.occlusionPass)return e.include(n8e,t),e;const{vertex:i,fragment:s}=e;e.include(SV),s.include(Ll),s.include(zp),e.include(E0,t),e.include(bA,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add(new Wt("viewport",(c,u)=>u.camera.fullViewport),new mr("screenOffset",(c,u)=>Qt(Ede,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new mr("anchorPosition",c=>z$(c)),new Wt("materialColor",c=>c.color),new Se("pixelRatio",(c,u)=>u.camera.pixelRatio)),r&&(i.uniforms.add(new Wt("outlineColor",c=>c.outlineColor)),s.uniforms.add(new Wt("outlineColor",c=>LX(c)?c.outlineColor:gp),new Se("outlineSize",c=>LX(c)?c.outlineSize:0))),t.hasScreenSizePerspective&&(h9e(i),rD(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(S.UV0,"vec2"),e.attributes.add(S.COLOR,"vec4"),e.attributes.add(S.SIZE,"vec2"),e.attributes.add(S.AUXPOS2,"vec4"),i.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?b`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:b`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=b`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;t.pixelSnappingEnabled&&i.include(iD);const o=t.pixelSnappingEnabled?r?b`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:b`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:b`posProj += quadOffset;`;i.code.add(b`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===L.ObjectAndLayerIdColor?b`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${b.float(Gn)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${b.float(Gn)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?b`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new We("tex",c=>c.texture));const a=t.debugDrawLabelBorder?b`(isBorder > 0.0 ? 0.0 : ${b.float(U$)})`:b.float(U$),l=b`
    ${t.debugDrawLabelBorder?b`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?b`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${b.float(bC)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${b.float(Gn)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:b`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?b`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===L.Alpha&&s.code.add(b`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),t.output===L.ObjectAndLayerIdColor&&s.code.add(b`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===L.Color&&s.code.add(b`
    void main() {
      ${l}
      ${t.transparencyPassType===Ze.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),t.output===L.Highlight&&(e.include(Am,t),s.code.add(b`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?b`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function LX(t){return t.outlineColor[3]>0&&t.outlineSize>0}function z$(t,e=Ede){return t.textureIsSignedDistanceField?w8e(t.anchorPosition,t.distanceFieldBoundingBox,e):Vs(e,t.anchorPosition),e}function w8e(t,e,r){e!=null?Qt(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):Qt(r,0,0)}const Ede=Ie(),x8e=Object.freeze(Object.defineProperty({__proto__:null,build:b8e,calculateAnchorPosForRendering:z$},Symbol.toStringTag,{value:"Module"})),gc=Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),T8e=Il(_e.ONE,_e.ONE),Cde=Il(_e.ZERO,_e.ONE_MINUS_SRC_ALPHA);function Om(t){return t===Ze.FrontFace?null:t===Ze.Alpha?Cde:T8e}function oD(t){return t===Ze.FrontFace?Ya:null}const aD=5e5,lD={factor:-1,units:-2};function cD(t){return t?lD:null}function iy(t,e=Br.LESS){return t===Ze.NONE||t===Ze.FrontFace?e:Br.LEQUAL}let Ade=class Ode extends gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Re.Global}initializeProgram(e){return new pr(e.rctx,Ode.shader.get().build(this.configuration),cr)}_setPipelineState(e){const r=this.configuration,i=e===Ze.NONE,s=e===Ze.FrontFace,n=this.configuration.hasPolygonOffset?S8e:null,o=(i||s)&&r.output!==L.Highlight&&(r.depthEnabled||r.occlusionPass)?Ya:null;return xt({blending:r.output===L.Color||r.output===L.Alpha||r.output===L.Highlight?i?E8e:Om(e):null,depthTest:{func:Br.LEQUAL},depthWrite:o,colorWrite:$t,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?vt.POINTS:vt.TRIANGLES}};Ade.shader=new dr(x8e,()=>he(()=>import("./HUDMaterial.glsl-95b12d6a.js"),[]));const S8e={factor:0,units:-4},E8e=Il(_e.ONE,_e.ONE_MINUS_SRC_ALPHA);let as=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.screenCenterOffsetUnitsEnabled=Ua.World,this.transparencyPassType=Ze.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};h([D({count:L.COUNT})],as.prototype,"output",void 0),h([D({count:Ua.COUNT})],as.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([D({count:Ze.COUNT})],as.prototype,"transparencyPassType",void 0),h([D()],as.prototype,"spherical",void 0),h([D()],as.prototype,"occlusionTestEnabled",void 0),h([D()],as.prototype,"signedDistanceFieldEnabled",void 0),h([D()],as.prototype,"vvSize",void 0),h([D()],as.prototype,"vvColor",void 0),h([D()],as.prototype,"hasVerticalOffset",void 0),h([D()],as.prototype,"hasScreenSizePerspective",void 0),h([D()],as.prototype,"debugDrawLabelBorder",void 0),h([D()],as.prototype,"binaryHighlightOcclusionEnabled",void 0),h([D()],as.prototype,"hasSlicePlane",void 0),h([D()],as.prototype,"hasPolygonOffset",void 0),h([D()],as.prototype,"depthEnabled",void 0),h([D()],as.prototype,"pixelSnappingEnabled",void 0),h([D()],as.prototype,"isDraped",void 0),h([D()],as.prototype,"hasMultipassGeometry",void 0),h([D()],as.prototype,"hasMultipassTerrain",void 0),h([D()],as.prototype,"cullAboveGround",void 0),h([D()],as.prototype,"occlusionPass",void 0),h([D()],as.prototype,"objectAndLayerIdColorInstanced",void 0),h([D({constValue:!0})],as.prototype,"hasSliceInVertexProgram",void 0),h([D({constValue:!1})],as.prototype,"hasVvInstancing",void 0);let Dx=class extends ry{constructor(e){super(e,new D8e),this._configuration=new as}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Ua.Screen:Ua.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===ae.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===L.Color||e===L.Alpha),e===L.Color&&(this._configuration.debugDrawLabelBorder=!!kr.LABELS_SHOW_BORDER),e===L.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Lu(L4,r),e.shaderTransformer!=null){const T=e.shaderTransformer(FX);l=T[0],c=T[5],O8e(L4)}const u=e.vertexAttributes.get(S.POSITION),d=e.vertexAttributes.get(S.SIZE),p=e.vertexAttributes.get(S.NORMAL),g=e.vertexAttributes.get(S.AUXPOS1);He(u.size>=3);const y=i.point,_=i.camera,v=z$(a);l*=_.pixelRatio,c*=_.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<u.data.length/u.size;T++){const x=T*u.size;se(Eo,u.data[x],u.data[x+1],u.data[x+2]),De(Eo,Eo,r);const E=T*d.size;Jm[0]=d.data[E]*l,Jm[1]=d.data[E+1]*c,De(Eo,Eo,_.viewMatrix);const O=T*g.size;if(se(Ul,g.data[O],g.data[O+1],g.data[O+2]),!w&&(Eo[0]+=Ul[0],Eo[1]+=Ul[1],Ul[2]!==0)){const $=Ul[2];fe(Ul,Eo),le(Eo,Eo,ee(Ul,Ul,$))}const A=T*p.size;if(se(rT,p.data[A],p.data[A+1],p.data[A+2]),this._normalAndViewAngle(rT,L4,_,D4),this._applyVerticalOffsetTransformationView(Eo,D4,_,I4),_.applyProjection(Eo,Wo),Wo[0]>-1){Wo[0]=Math.floor(Wo[0]),Wo[1]=Math.floor(Wo[1]),w&&(Ul[0]||Ul[1])&&(Wo[0]+=Ul[0],Ul[1]!==0&&(Wo[1]+=TV(Ul[1],I4.factorAlignment)),_.unapplyProjection(Wo,Eo)),Wo[0]+=this.parameters.screenOffset[0],Wo[1]+=this.parameters.screenOffset[1],Fhe(Jm,I4.factor,Jm);const $=$8e*_.pixelRatio;let M=0;if(a.textureIsSignedDistanceField&&(M=a.outlineSize*_.pixelRatio/2),y&&DX(y,Wo[0],Wo[1],Jm,$,M,a,v)){const U=i.ray;if(De(NX,Eo,Wn(M8e,_.viewMatrix)),Wo[0]=y[0],Wo[1]=y[1],_.unprojectFromRenderScreen(Wo,Eo)){const k=C();te(k,U.direction);const B=1/Te(k);ee(k,k,B),o(ei(U.origin,Eo)*B,k,-1,!0,1,NX)}}}}}intersectDraped(e,r,i,s,n,o){const a=e.vertexAttributes.get(S.POSITION),l=e.vertexAttributes.get(S.SIZE),c=this.parameters,u=z$(c);let d=1,p=1;if(e.shaderTransformer!=null){const y=e.shaderTransformer(FX);d=y[0],p=y[5]}d*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const g=I8e*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],w=a.data[_+1],T=y*l.size;Jm[0]=l.data[T]*d,Jm[1]=l.data[T+1]*p;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),DX(s,v,w,Jm,g,x,c,u)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new F8e(this)}_normalAndViewAngle(e,r,i,s){return u9e(r)&&(r=Lu(P8e,r)),El(s.normal,e,r),De(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=pe(Rde,L8e),s}_updateScaleInfo(e,r,i){const s=this.parameters;s.screenSizePerspective!=null?xX(i,r,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),s.screenSizePerspectiveAlignment!=null?xX(i,r,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,D4);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,r,i,s,n){return this._applyCenterOffsetNDC(e,r,i,s),n!=null&&te(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(e,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return te(n,e);const c=me(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ee(n,e,l>0?u:1/u),n}_applyVerticalGroundOffsetView(e,r,i,s){const n=Te(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=ee(Eo,r.normal,o*a);return oe(s,e,l),s}_applyVerticalOffsetTransformationView(e,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Te(e);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Te(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=Jhe(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),ee(r.normal,r.normal,l),oe(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==e&&te(i,e),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(fe(rT,i),oe(i,i,ee(rT,rT,r[2])))),i}_applyCenterOffsetNDC(e,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&te(s,e),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(e,r,i,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&te(s,e),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(e,r){if(r===L.Color||r===L.Alpha||r===L.Highlight||r===L.ObjectAndLayerIdColor){if(e===ae.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return e===(i?ae.LABEL_MATERIAL:ae.HUD_MATERIAL)||s&&e===ae.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new C8e(e)}calculateRelativeScreenBounds(e,r,i=Ut()){return A8e(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},C8e=class extends E7{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(Ade,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function A8e(t,e,r,i=R8e){return Vs(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function O8e(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+r*r+i*i),d=1/Math.sqrt(s*s+n*n+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=r*u,t[2]=i*u,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function DX(t,e,r,i,s,n,o,a){let l=e-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,u=r-s-(a[1]>0?i[1]*a[1]:0),d=u+i[1]+2*s;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=i[0]*p[0],u+=i[1]*p[1],c-=i[0]*(1-p[2]),d-=i[1]*(1-p[3]),l-=n,c+=n,u-=n,d+=n),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<d}const I4=new tde,R8e=Ie(),Eo=C(),rT=C(),Wo=Ht(),Rde=C(),NX=C(),L4=Zi(),P8e=Zi(),M8e=xe(),Ul=C(),D4={normal:Rde,cosAngle:0},FX=xe(),$8e=1,I8e=2,Jm=[0,0],L8e=Ce(0,0,1);let D8e=class extends cce{constructor(){super(...arguments),this.renderOccluded=_i.Occlude,this.color=Ct(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=ir(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Ct(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const Pde=Ri().vec3f(S.POSITION).vec3f(S.NORMAL).vec2f(S.UV0).vec4u8(S.COLOR).vec2f(S.SIZE).vec4f(S.AUXPOS1).vec4f(S.AUXPOS2),N8e=Pde.clone().vec4u8(S.OBJECTANDLAYERIDCOLOR);class F8e{constructor(e){this._material=e,this.vertexBufferLayout=ie("enable-feature:objectAndLayerId-rendering")?N8e:Pde}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(S.POSITION).length}write(e,r,i,s,n){sD(i.indices.get(S.POSITION),i.vertexAttributes.get(S.POSITION).data,e,s.position,n,6),RV(i.indices.get(S.NORMAL),i.vertexAttributes.get(S.NORMAL).data,r,s.normal,n,6);const o=i.vertexAttributes.get(S.UV0).data;let a,l,c,u;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],u=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=i.indices.get(S.POSITION).length,p=n;const g=s.uv0;for(let w=0;w<d;++w)g.set(p,0,a),g.set(p,1,l),p+=1,g.set(p,0,c),g.set(p,1,l),p+=1,g.set(p,0,c),g.set(p,1,u),p+=1,g.set(p,0,c),g.set(p,1,u),p+=1,g.set(p,0,a),g.set(p,1,u),p+=1,g.set(p,0,a),g.set(p,1,l),p+=1;PV(i.indices.get(S.COLOR),i.vertexAttributes.get(S.COLOR).data,4,s.color,n,6);const y=i.indices.get(S.SIZE),_=i.vertexAttributes.get(S.SIZE).data;d=y.length;const v=s.size;p=n;for(let w=0;w<d;++w){const T=_[2*y[w]],x=_[2*y[w]+1];for(let E=0;E<6;++E)v.set(p,0,T),v.set(p,1,x),p+=1}if(i.indices.get(S.AUXPOS1)&&i.vertexAttributes.get(S.AUXPOS1)?Mx(i.indices.get(S.AUXPOS1),i.vertexAttributes.get(S.AUXPOS1).data,s.auxpos1,n,6):RX(s.auxpos1,n,6*d),i.indices.get(S.AUXPOS2)&&i.vertexAttributes.get(S.AUXPOS2)?Mx(i.indices.get(S.AUXPOS2),i.vertexAttributes.get(S.AUXPOS2).data,s.auxpos2,n,6):RX(s.auxpos2,n,6*d),i.objectAndLayerIdColor!=null&&i.indices.get(S.POSITION)){const w=i.indices.get(S.POSITION).length,T=s.getField(S.OBJECTANDLAYERIDCOLOR,wo);ide(i.objectAndLayerIdColor,T,w,n,6)}}}const md=C(),Fv=Ht(),iT=Ht(),N4=C(),U8e=xe(),z8e=ss(),F4=vn(),k8e=C(),B8e=Ut();class V8e{constructor(){this.aabr=Ut(),this.distance=0,this.culled=!1,this.visible=!1}}class G8e{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var hl;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(hl||(hl={}));class Mde{constructor(){this.camera=new ot,this.slicePlane=_m(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),lv(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let _w=class extends we{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new Mde,this._state=hl.Idle,this._active=new Map,this._visible=new Map,this._iterators=new q8e,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==hl.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/hl.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case hl.Idle:this._startUpdate(),t.madeProgress();case hl.Process:if(this._state=hl.Process,!this._processActiveGraphics(t))return;case hl.Sort:if(this._state=hl.Sort,!this._sortVisibleGraphics(t))return;case hl.Deconflict:if(this._state=hl.Deconflict,!this._deconflictVisibleGraphics(t))return;default:K6e(this,this._visible),this._state=hl.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof Dx}_startUpdate(){e9e(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new V8e,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),j8e(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=a2(U8e,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?z8e:null;let s=0;for(i!=null&&(De(i,Va,this._runningViewState.camera.viewMatrix),i[3]=Cr(this.view.spatialReference).radius,s=aae(i,Va));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===yn.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=!r||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),r9e(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=UX(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=UX(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=H8e(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(yn.GRAPHIC,ho.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Au(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null){if(a=Z8e,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,md)||r!=null&&this._isCulledByHorizon(a,r,i))return void(n.culled=!0);!kr.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;De(md,a,i.viewMatrix);const l=n.vertexAttributes,c=l.get(S.NORMAL).data,u=l.get(S.AUXPOS1).data;o.applyShaderOffsetsView(md,c,s.transformation,u,i,r.scaleInfo,md),oi(Fv,md[0],md[1],md[2],1),uc(iT,Fv,i.projectionMatrix),ee(r.positionNDC,iT,1/iT[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,N4),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(N4[2]),r.distance=N4[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),oi(iT,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),uc(Fv,iT,e),Qx(Fv,Fv,1/Fv[3]),se(r.positionView,md[0],md[1],md[2])}_isCulledByHorizon(t,e,r){return te(F4.direction,t.positionView),se(F4.origin,0,0,0),!!K0(e,F4,k8e)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&s7(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(Y8e);Fhe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=LM(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,B8e),_t(0,n.fullWidth,.5+.5*i[0]),_t(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(lc(a),Xh(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}b0(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,YI(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new Nt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,ho.DECONFLICTION,e),this.visibilityGroup===yn.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function j8e(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,ho.DECONFLICTION,!0)}function*UX(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*H8e(t,e,r){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(r,ho.DECONFLICTION);const a=s.info&&s.info[r];o.prio=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((s,n)=>s.visible!==n.visible?s.visible?-1:1:s.prio!==n.prio?s.prio-n.prio:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}h([f({constructOnly:!0})],_w.prototype,"view",void 0),h([f({type:Boolean,readOnly:!0})],_w.prototype,"updating",null),_w=h([F("esri.views.3d.layers.graphics.Deconflictor")],_w);class W8e{constructor(){this.id=0,this.visible=!1,this.prio=0}}class q8e{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Nt({allocator:s=>s||new W8e})}}const Y8e=Ie();class X8e{constructor(){this.positionView=C(),this.positionNDC=C(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new tde}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const Z8e=new X8e,J8e=2e3;let MP=class extends _w{constructor(e){super(e),this.visibilityGroup=yn.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return _o.YIELD;const r=performance.now();if(e.state!==vr.IDLE&&r-this._lastDeconfliction<J8e)return _o.YIELD;super.runTask(e),this.state===hl.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([f({constructOnly:!0})],MP.prototype,"parent",void 0),MP=h([F("esri.views.3d.layers.graphics.LabelDeconflictor")],MP);let BU=class extends _w{constructor(){super(...arguments),this._handles=new Oi,this._contexts=new Map,this._viewState=new Mde,this.visibilityGroup=yn.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ce(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),ce(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),ce(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Tr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(nt.GRAPHICS_DECONFLICTOR,this),this._labels=new MP({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&U4(e));r.setVisibilityFlag(yn.GRAPHIC,ho.DECONFLICTION,i)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&xae(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){ao(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const s=i.graphic.uid,n=new G8e(i,e.symbolCreationContext.slicePlaneEnabled);r.set(s,n),U4(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,r){const i=r.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=U4(e);i||Q8e(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(s=>s.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function U4(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function Q8e(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(yn.GRAPHIC,ho.DECONFLICTION,!0))}BU=h([F("esri.views.3d.layers.graphics.GraphicsDeconflictor")],BU);function $de(t){return 32+t.length}function Ide(t){return 16}function Lde(t){if(!t)return 0;let e=Fde;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=$de(i);break;case"number":e+=Ide();break;case"boolean":e+=4}}return e}function Dde(t){if(!t)return 0;if(Array.isArray(t))return K8e(t);let e=Fde;for(const r in t)t.hasOwnProperty(r)&&(e+=Nde(t[r]));return e}function K8e(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=Ude;for(let i=0;i<e;i++)r+=Nde(t[i]);return r}function Nde(t){switch(typeof t){case"object":return Dde(t);case"string":return $de(t);case"number":return Ide();case"boolean":return 4;default:return 8}}function Bmt(t,e){return Ude+t.length*e}const Fde=32,Ude=32,DV=(t,e,r)=>[e,r],Nx=(t,e,r)=>[e,r,t[2]],NV=(t,e,r)=>[e,r,t[2],t[3]];function Vmt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function eUe({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function tUe({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function zde({scale:t,translate:e},r){return r*t[0]+e[0]}function kde({scale:t,translate:e},r){return e[1]-r*t[1]}function Bde(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=t.scale;let o=zde(t,r[0][0]),a=kde(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=e(c,o,a)}return i}function Vde(t,e,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=Bde(t,e,r[s]);return i}function rUe(t,e,r,i){return Bde(t,r?i?NV:Nx:i?Nx:DV,e)}function iUe(t,e,r,i){return Vde(t,r?i?NV:Nx:i?Nx:DV,e)}function sUe(t,e,r,i){return Vde(t,r?i?NV:Nx:i?Nx:DV,e)}function Gmt(t,e,r,i,s){return e.x=eUe(t,r.x),e.y=tUe(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m)),e}function Gde(t,e,r,i,s){return r!=null&&(e.points=rUe(t,r.points,i,s)),e}function jde(t,e,r,i,s){return r==null||(e.x=zde(t,r.x),e.y=kde(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m))),e}function Hde(t,e,r,i,s){return r!=null&&(e.rings=sUe(t,r.rings,i,s)),e}function Wde(t,e,r,i,s){return r!=null&&(e.paths=iUe(t,r.paths,i,s)),e}var VU;let ES=VU=class extends Ke{constructor(t){super(t),this.name=null,this.code=null}clone(){return new VU({name:this.name,code:this.code})}};h([f({type:String,json:{write:!0}})],ES.prototype,"name",void 0),h([f({type:[String,Number],json:{write:!0}})],ES.prototype,"code",void 0),ES=VU=h([F("esri.layers.support.CodedValue")],ES);const nUe=new Tn({inherited:"inherited",codedValue:"coded-value",range:"range"});let CS=class extends Ke{constructor(e){super(e),this.name=null,this.type=null}};h([f({type:String,json:{write:!0}})],CS.prototype,"name",void 0),h([Kt(nUe)],CS.prototype,"type",void 0),CS=h([F("esri.layers.support.Domain")],CS);const uD=CS;var GU;let AS=GU=class extends uD{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new GU({codedValues:ye(this.codedValues),name:this.name})}};h([f({type:[ES],json:{write:!0}})],AS.prototype,"codedValues",void 0),h([Kt({codedValue:"coded-value"})],AS.prototype,"type",void 0),AS=GU=h([F("esri.layers.support.CodedValueDomain")],AS);const qde=AS;var jU;let $P=jU=class extends uD{constructor(t){super(t),this.type="inherited"}clone(){return new jU}};h([Kt({inherited:"inherited"})],$P.prototype,"type",void 0),$P=jU=h([F("esri.layers.support.InheritedDomain")],$P);const Yde=$P;var HU;let Gb=HU=class extends uD{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new HU({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};h([f({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],Gb.prototype,"maxValue",void 0),h([f({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],Gb.prototype,"minValue",void 0),h([Kt({range:"range"})],Gb.prototype,"type",void 0),Gb=HU=h([F("esri.layers.support.RangeDomain")],Gb);const Xde=Gb,oUe={key:"type",base:uD,typeMap:{range:Xde,"coded-value":qde,inherited:Yde}};function aUe(t){if(!t||!t.type)return null;switch(t.type){case"range":return Xde.fromJSON(t);case"codedValue":return qde.fromJSON(t);case"inherited":return Yde.fromJSON(t)}return null}const lUe=new Tn({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var WU;const cUe=new Tn({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Xo=WU=class extends Ke{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?cUe.fromJSON(r.fieldValueType):null}clone(){return new WU({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};h([f({type:String,json:{write:!0}})],Xo.prototype,"alias",void 0),h([f({type:[String,Number],json:{write:{allowNull:!0}}})],Xo.prototype,"defaultValue",void 0),h([f()],Xo.prototype,"description",void 0),h([Ur("description")],Xo.prototype,"readDescription",null),h([f({types:oUe,json:{read:{reader:aUe},write:!0}})],Xo.prototype,"domain",void 0),h([f({type:Boolean,json:{write:!0}})],Xo.prototype,"editable",void 0),h([f({type:Qs,json:{write:!0}})],Xo.prototype,"length",void 0),h([f({type:String,json:{write:!0}})],Xo.prototype,"name",void 0),h([f({type:Boolean,json:{write:!0}})],Xo.prototype,"nullable",void 0),h([Kt(lUe)],Xo.prototype,"type",void 0),h([f()],Xo.prototype,"valueType",void 0),h([Ur("valueType",["description"])],Xo.prototype,"readValueType",null),h([f({type:Boolean,json:{read:!1}})],Xo.prototype,"visible",void 0),Xo=WU=h([F("esri.layers.support.Field")],Xo);const uUe=Xo;let Hmt=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function qmt(t){return t.geometry!=null}let Ymt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function Zmt(t){var n;const e=fTe.fromJSON(t.geometryType),r=yt.fromJSON(t.spatialReference),i=t.transform,s=t.features.map(o=>{const a=hUe(o,e,r,t.objectIdFieldName),l=a.geometry;if(l!=null&&i)switch(l.type){case"point":a.geometry=jde(i,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=Gde(i,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=Hde(i,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=Wde(i,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:s,spatialReference:r,fields:((n=t.fields)==null?void 0:n.map(o=>uUe.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function hUe(t,e,r,i){return{uid:Rl(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:dUe(t.geometry,e,r),visible:!0}}function dUe(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function fv(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function pUe(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)r+=n.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(s.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=ow(t.vertexAttributes.position),e+=ow(t.vertexAttributes.normal),e+=ow(t.vertexAttributes.uv),e+=ow(t.vertexAttributes.tangent)}return e}function Jmt(t){let e=32;return e+=Lde(t.attributes),e+=3,e+=8+pUe(t.geometry),e}function fUe(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function Qmt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function Kmt(t,e){switch(li(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)mN(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)mN(e,t.rings[r],!!t.hasZ);break;case"multipoint":mN(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function mUe(t,e){switch(Au(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)iN(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)iN(e,t.rings[r]);break;case"multipoint":iN(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function egt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function Zde(t){return"declaredClass"in t}function zX(t){return"declaredClass"in t}function gUe(t){return"declaredClass"in t}function yUe(t,e){return t?gUe(t)?t:new om({layer:e,sourceLayer:e,visible:t.visible,symbol:ye(t.symbol),attributes:ye(t.attributes),geometry:Jde(t.geometry)}):null}function Jde(t){return t==null?null:Zde(t)?t:Ou(_Ue(t))}function _Ue(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,s={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:n,y:o,z:a,m:l}=t;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=t;return{rings:kX(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=t;return{paths:kX(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:d,mmax:p,hasZ:g,hasM:y}=t;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:d,mmax:p,hasZ:g,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=t;return{points:Kde(n)?Qde(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function kX(t){return vUe(t)?t.map(e=>Qde(e)):t}function Qde(t){return t.map(e=>Array.from(e))}function vUe(t){for(const e of t)if(e.length!==0)return Kde(e);return!1}function Kde(t){return t.length>0&&(qx(t[0])||Yx(t[0]))}function bUe(t,e){if(!t)return null;let r;if(zX(t)){if(e==null)return t.clone();if(zX(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=fv(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function tgt(t){const{wkid:e,wkt:r,latestWkid:i}=t,s={wkid:e,wkt:r,latestWkid:i};return yt.fromJSON(s)}const FV="__begin__",UV="__end__",wUe=new RegExp(FV,"ig"),xUe=new RegExp(UV,"ig"),BX=new RegExp("^"+FV,"i"),VX=new RegExp(UV+"$","i"),k$='"',TUe=k$+" + ",SUe=" + "+k$;function EUe(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function rgt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function zV(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=EUe(t.labelExpression),e.type="conventional"),e}function igt(t){const e=zV(t);if(!e)return null;switch(e.type){case"conventional":return CUe(e.expression);case"arcade":return e.expression}return null}function sgt(t){const e=zV(t);if(!e)return null;switch(e.type){case"conventional":return OUe(e.expression);case"arcade":return epe(e.expression)}return null}function CUe(t){let e;return t?(e=II(t,r=>FV+'$feature["'+r+'"]'+UV),e=BX.test(e)?e.replace(BX,""):k$+e,e=VX.test(e)?e.replace(VX,""):e+k$,e=e.replaceAll(wUe,TUe).replaceAll(xUe,SUe)):e='""',e}const AUe=/^\s*\{([^}]+)\}\s*$/i;function OUe(t){const e=t==null?void 0:t.match(AUe);return e&&e[1].trim()||null}const RUe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,PUe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,MUe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function epe(t){if(!t)return null;let e=RUe.exec(t)||PUe.exec(t);return e?e[1]||e[3]:(e=MUe.exec(t),e?e[2]:null)}const z4=ne.getLogger("esri.layers.support.labelFormatUtils"),k4={type:"simple",evaluate:()=>null},$Ue={getAttribute:(t,e)=>t.field(e)};async function tpe(t,e,r){if(!t||!t.symbol||!e)return k4;const i=t.where,s=zV(t),n=i?await he(()=>import("./WhereClause-bfeee3cb.js").then(a=>a.W),["assets/WhereClause-bfeee3cb.js","assets/executionError-c92d3b85.js"]):null;let o;if(s.type==="arcade"){const a=await ETe(s.expression,r,e);if(a==null)return k4;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{z4.error(new X("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>epe(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),u=e.get(c);if(!u)return l;let d=null;return"attributes"in a?a&&a.attributes&&(d=a.attributes[u.name]):d=a.field(u.name),d==null?"":rpe(d,u)})};if(i){let a;try{a=n.WhereClause.create(i,e)}catch(c){return z4.error(new X("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),k4}const l=o.evaluate;o.evaluate=c=>{const u="attributes"in c?void 0:$Ue;try{if(a.testFeature(c,u))return l(c)}catch(d){z4.error(new X("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:d}))}return null}}return o}function rpe(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=t;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+t,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=L0(i,zT("short-date")):Kie(e)&&(i=lx(+i)),i||""}const ngt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:tpe,formatField:rpe},Symbol.toStringTag,{value:"Module"}));let ipe=class{constructor(e=null,r="center",i="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",u=0,d=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=u,this.displayHeight=d}};function kV(t,e){if(t.type==="point")return Qm(t,e,!1);if(Zde(t))switch(t.type){case"extent":return Qm(t.center,e,!1);case"polygon":return Qm(t.centroid,e,!1);case"polyline":return Qm(GX(t),e,!0);case"mesh":return Qm(t.origin,e,!1)}else switch(t.type){case"extent":return Qm(IUe(t),e,!0);case"polygon":return Qm(LUe(t),e,!0);case"polyline":return Qm(GX(t),e,!0)}}function GX(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=Sie(e,Tie(e)/2);return fv(r[0],r[1],r[2],t.spatialReference)}function IUe(t){return fv(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function LUe(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=Aie(t.rings,!!t.hasZ);return fv(r[0],r[1],r[2],t.spatialReference)}function Qm(t,e,r){const i=r?t:bUe(t);return e&&t?$3e(t,i,e)?i:null:i}function agt(t,e,r,i=0){if(t){e||(e=Ut());const s=t;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),oi(e,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),e}return null}function spe(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(S.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function bE(t,e,r=null){const i=aA(fu);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function lgt(t,e,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)t!=null&&t[o]!=null?n[o]=t[o]:r!=null&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return n[3]=e??i??s[3],n}function jX(t=zf,e,r,i=1){const s=new Array(3);if(e==null||r==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,d=a===0&&!n&&!u,p=r[a];l==="symbol-value"||d?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return yl(s)}function DUe(t){return t.isPrimitive!=null}function hD(t){return qU(DUe(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function qU(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function NUe(t,e,r,i=xe()){return t&&dx(i,i,-t/180*Math.PI),e&&hx(i,i,e/180*Math.PI),r&&pL(i,i,r/180*Math.PI),i}function BV(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=fa(e),s=sv(t)*i,n=nv(t)*i,o=Q0(t)*(e.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function npe(t,e,r,i,s,n,o,a,l,c,u){const d=jUe[u.mode];let p,g,y=0;if(Xi(t,e,r,i,l.spatialReference,s,a))return d.requiresAlignment(u)?(y=d.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,u),p=n,g=o):(p=i,g=s),Xi(p,l.spatialReference,g,n,c.spatialReference,o,a)?y:void 0}function _2(t,e,r,i,s){const n=(R$(t)?t.z:lhe(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=cp(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=cp(e,t,"ground")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=cp(e,t,"scene")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=cp(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function FUe(t,e,r,i){return _2(t,e,r,i,vw),vw.z}function TA(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?Yi.UPDATE:t.onTheGroundChanged}function Uu(t){return t==="relative-to-ground"||t==="relative-to-scene"}function H0(t){return t!=="absolute-height"}function UUe(t,e,r,i,s){_2(e,r,s,i,vw),spe(t,vw.verticalDistanceToGround);const n=vw.sampledElevation,o=en(HUe,t.transformation);return fO[0]=e.x,fO[1]=e.y,fO[2]=vw.z,bu(e.spatialReference,fO,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function zUe(t,e,r,i,s,n){let o=0;const a=n.spatialReference;e*=3,i*=3;for(let l=0;l<s;++l){const c=t[e],u=t[e+1],d=t[e+2],p=n.getElevation(c,u,d,a,"ground")??0;o+=p,r[i]=c,r[i+1]=u,r[i+2]=p,e+=3,i+=3}return o/s}function kUe(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,i*=3;for(let p=0;p<s;++p){const g=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(g,y,_,d,"ground")??0;l+=v,r[i]=g,r[i+1]=y,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/s}function BUe(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,i*=3;for(let p=0;p<s;++p){const g=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(g,y,_,d,"scene")??0;l+=v,r[i]=g,r[i+1]=y,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/s}function VUe(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function GUe(t,e,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let u=0;u<s;++u){const d=t[e],p=t[e+1],g=t[e+2];r[i]=d,r[i+1]=p,r[i+2]=c==null?g+l:l,e+=3,i+=3}return 0}let SA=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Yi;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Yi||(Yi={}));const jUe={"absolute-height":{applyElevationAlignmentBuffer:GUe,requiresAlignment:VUe},"on-the-ground":{applyElevationAlignmentBuffer:zUe,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:kUe,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:BUe,requiresAlignment:()=>!0}},HUe=xe(),vw=new SA,fO=C();function VV(t){return t.mapPositions!=null}function ope(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!VV(l))continue;const{update:c,averageGeometrySampledElevation:u}=lpe(l,e,r,i,s);a+=u,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function wC(t,e,r,i,s){const n=t.stageObject,o=e.centerPointInElevationSR;let a=0;n.usesVerticalDistanceToGround?(i(o,Fa),spe(n,Fa.verticalDistanceToGround),a=Fa.sampledElevation):(i(o,Fa),e.mode!=="absolute-height"&&(a=Fa.sampledElevation));const l=en(WUe,n.transformation),c=se(ape,l[12],l[13],l[14]);kr.TESTS_DISABLE_OPTIMIZATIONS?(Na[0]=o.x,Na[1]=o.y,Na[2]=Fa.z,bu(o.spatialReference,Na,l,s.spatialReference)&&(n.transformation=l)):s.setAltitudeOfTransformation(Fa.z,l);const u=GV/s.unitInMeters;return(Math.abs(l[12]-c[0])>=u||Math.abs(l[13]-c[1])>=u||Math.abs(l[14]-c[2])>=u)&&(n.transformation=l),a}const WUe=xe();function qUe(t,e,r,i,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;i(o,Fa);const a=e.mode!=="absolute-height"?Fa.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,u=XUe;l.getGlobalTransform(c,u);const d=se(ape,u[12],u[13],u[14]);kr.TESTS_DISABLE_OPTIMIZATIONS?(Na[0]=o.x,Na[1]=o.y,Na[2]=Fa.z,bu(o.spatialReference,Na,u,s.spatialReference)&&l.setGlobalTransform(c,u)):s.setAltitudeOfTransformation(Fa.z,u);const p=GV/s.unitInMeters;return(kr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-d[0])>=p||Math.abs(u[13]-d[1])>=p||Math.abs(u[14]-d[2])>=p)&&l.setGlobalTransform(c,u),a}function YUe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const d of o){if(!VV(d))continue;const p=d.vertexAttributes.get(S.POSITION);if(p!==l){const{update:g,averageGeometrySampledElevation:y}=lpe(d,e,r,i,s);c=y,l=p,u=g}u&&n.geometryVertexAttrsUpdated(d),a+=c}return a/o.length}const GV=.01,Na=C(),Pc=C(),Uv=C(),XUe=xe(),ape=C(),Fa=new SA;function lpe(t,e,r,i,s){let n=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;Pc[0]=o[12],Pc[1]=o[13],Pc[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(S.POSITION),c=l.data,u=l.size,d=c.length/u,p=new yV(t.mapPositions,r);let g=0,y=0;for(let _=0;_<d;_++){if(Uv[0]=c[g],Uv[1]=c[g+1],Uv[2]=c[g+2],i(p,Fa),a&&(y+=Fa.sampledElevation),kr.TESTS_DISABLE_OPTIMIZATIONS)c[g]=p.array[p.offset],c[g+1]=p.array[p.offset+1],c[g+2]=Fa.z,Xi(c,r,g,c,s.spatialReference,g,1),c[g]-=Pc[0],c[g+1]-=Pc[1],c[g+2]-=Pc[2],n=!0;else{Na[0]=c[g]+Pc[0],Na[1]=c[g+1]+Pc[1],Na[2]=c[g+2]+Pc[2],s.setAltitude(Na,Fa.z),c[g]=Na[0]-Pc[0],c[g+1]=Na[1]-Pc[1],c[g+2]=Na[2]-Pc[2];const v=GV/s.unitInMeters;(Math.abs(Uv[0]-c[g])>=v||Math.abs(Uv[1]-c[g+1])>=v||Math.abs(Uv[2]-c[g+2])>=v)&&(n=!0)}g+=u,p.offset+=3}return y/=d,{update:n,averageGeometrySampledElevation:y}}function ZUe(t){return!!t&&$x[t]!=null}function JUe(t){return 1/($x[t]||1)}function QUe(){const t=Object.keys($x);return t.sort(),t}const ugt=QUe(),KUe=ne.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function eze(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function hgt(t){const e=t&&t.expression;if(typeof e=="string"){const r=hpe(e);if(r!=null)return{cachedResult:r}}return null}async function dgt(t,e,r,i){const s=t&&t.expression;if(typeof s!="string")return null;const n=hpe(s);if(n!=null)return{cachedResult:n};const o=await aB();qt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function cpe(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function jV(t,e){if(t!=null&&!upe(t)){if(!e||!t.arcade)return void KUe.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=Jde(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function tze(t){if(t!=null){if(upe(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function pgt(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const rze={cachedResult:0};function upe(t){return t.cachedResult!=null}function hpe(t){return t==="0"?0:null}let od=class dpe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=JUe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=tze(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=ZUe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&r!=null&&i!=null?(this._featureExpressionInfoContext=eze(e),jV(this._featureExpressionInfoContext,cpe(s.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new dpe;return e!=null&&r.setFromElevationInfo(e),r}},ize=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var Dt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Dt||(Dt={}));let sze=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},Bp=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=e.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=HX(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this._resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,s){if(this.elevationAligner==null)return;i!=null&&jV(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>_2(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r),this._resetEdgeObject(s)}alignWithAbsoluteElevation(e,r,i){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this._resetEdgeObject(i)}getCenterObjectSpace(e=C()){return te(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Bs()){const r=this.stageObject.boundingVolumeObjectSpace;return Tne(e,r.min),Sne(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.transformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Xp)&&(De(Xp,Xp,this.stageObject.transformation),oe(e.render.origin,e.render.origin,Xp),e.render.num++)}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=nze,l=CB(o)?1:a.length;for(let u=0;u<l;u++){const d=a[u];Km[0]=o[d[0]],Km[1]=o[d[1]],Km[2]=o[d[2]],De(Km,Km,this.stageObject.transformation),Ey[3*u]=Km[0],Ey[3*u+1]=Km[1],Ey[3*u+2]=Km[2]}if(!e(Ey,0,l))return null;li(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Ey[u+d]),o[d+3]=Math.max(o[d+3],Ey[u+d]);c&&i.push({location:Ey.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){Dh(o,Xp);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(r.useViewElevation)d=r.service.getElevation(Xp[0],Xp[1],u)??0;else try{const p=BV(o,r.service.spatialReference,r);d=await r.service.queryElevation(Xp[0],Xp[1],s,p,u)??0}catch{}xne(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,r){e===cm.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===cm.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const s=HX(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function HX(t){return t.isVisible()?t.parameters.transparent?Dt.TRANSPARENT:Dt.OPAQUE:Dt.INVISIBLE}const Ey=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Km=C(),Xp=C(),nze=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let ppe=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};var fs;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(fs||(fs={}));let HV=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=sc.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===sc.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===sc.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=sc.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=sc.FAILED,!gs(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=yc(this._abortController):this._loadStatus===sc.LOADING&&(this._loadStatus=sc.FAILED),this._loader=null}};var sc;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(sc||(sc={}));const fpe=3,YU=3,mpe=10;let gpe=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function mO(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),OI(e)}function WX(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})}),OI(e)}function ype(t){const e=t.components.map(r=>r.geometry);return OI(e)}function qX(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),OI(e)}function oze(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function _pe(t,e){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&EDe(a),{components:[new gpe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>xDe(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>pDe(e,1));case"cone":return r(B4,i=>Hq(e,1,.5,i,!1),!0);case"inverted-cone":return r(B4,i=>Hq(e,1,.5,i,!0),!0);case"cylinder":return r(B4,i=>SDe(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>wDe(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>yDe(e,1),!0);default:return}}const B4=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function aze(t){return t.type==="fill"}function lze(t){return t.type==="extrude"}function cze(t){return t&&t.enabled&&(lze(t)||aze(t))&&t.edges!=null}function uze(t){return t&&t.enabled&&t.edges||null}function vpe(t,e){return hze(uze(t),e)}function hze(t,e){if(t==null)return null;const r=t.color!=null?ZB(ht.toUnitRGBA(t.color)):Ct(0,0,0,0),i=Fo(t.size),s=Fo(t.extensionLength);switch(t.type){case"solid":return dze({color:r,size:i,extensionLength:s,...e});case"sketch":return pze({color:r,size:i,extensionLength:s,...e});default:return}}function dze(t){return{...fze,...t,type:"solid"}}function pze(t){return{...mze,...t,type:"sketch"}}const fze={color:Ct(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Dt.OPAQUE,hasSlicePlane:!1},mze={color:Ct(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Dt.OPAQUE,hasSlicePlane:!1},WV={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function bgt(t){return t.type==="web-style"?WV:qV(t.symbolLayers.toArray().map(e=>bpe(t,e)))}function qV(t){let e=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)a!=null&&(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function wgt(t){const e=qV(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const YX={};function bpe(t,e){var s;const r=wpe(t,e),i=cze(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:e.outline!=null&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return(s=e.resource)!=null&&s.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...gze(e.resource&&e.resource.primitive||Ine),memory:r};case"path":{let n=0,o=0;switch(e.profile){case"circle":n=mpe;break;case"quad":n=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":o=fpe;break;case"miter":case"bevel":o=1;break;default:return}const a=2*n,l=n*o*2;let c=-2*l-a;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(n-1);break;case"round":c+=2*(n*(YU-1)*2+n);break;default:return}return{primitivesPerFeature:c,primitivesPerCoordinate:l+a,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function wpe(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?va.EXTRUDE_EDGES:va.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?va.FILL_OUTLINE:va.FILL;case"water":return va.FILL;case"line":return e.join==="round"?va.LINE_ROUND:va.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return va.PATH_ROUND_CIRCLE;case"quad":return va.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return va.PATH_MITER_CIRCLE;case"quad":return va.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?va.OBJECT_POINT:va.OBJECT_POLYGON;case"icon":case"text":return r?va.ICON_POINT:va.ICON_POLYGON;default:return}}function gze(t){let e=YX[t];if(e)return e;const r=_pe(t,null);return e={primitivesPerFeature:ype(r.levels[0]).reduce((i,s)=>i+s.indices.get(S.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},YX[t]=e,e}const va={ICON_POINT:{bytesPerFeature:2451.177286989198,bytesPerFeatureLabel:1004.59838,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2317.1850418036647,bytesPerFeatureLabel:1000.0161400000001,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3961.045103847853,bytesPerFeatureLabel:1006.1069133333333,bytesPerCoordinate:4.057612904843353,resourceBytes:0,draped:{bytesPerFeature:3804.4008001312104,bytesPerFeatureLabel:987.7816,bytesPerCoordinate:4.047906356287818}},OBJECT_POINT:{bytesPerFeature:1447.8785364020669,bytesPerFeatureLabel:1020.09532,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1447.8785364020669,bytesPerFeatureLabel:1020.09532,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2951.2909864567605,bytesPerFeatureLabel:997.3342900000001,bytesPerCoordinate:4.1294182294544095,resourceBytes:0,draped:{bytesPerFeature:2951.2909864567605,bytesPerFeatureLabel:997.3342900000001,bytesPerCoordinate:4.1294182294544095}},LINE_MITER:{bytesPerFeature:5072.19763350597,bytesPerFeatureLabel:1017.5677599999999,bytesPerCoordinate:24.122762658337535,resourceBytes:0,draped:{bytesPerFeature:4492.422517500552,bytesPerFeatureLabel:1003.95334,bytesPerCoordinate:19.35112188679211}},LINE_ROUND:{bytesPerFeature:5082.481621130482,bytesPerFeatureLabel:1003.2300933333333,bytesPerCoordinate:24.040929472815833,resourceBytes:0,draped:{bytesPerFeature:4492.652930094735,bytesPerFeatureLabel:1008.5642066666665,bytesPerCoordinate:19.355107747713923}},PATH_MITER_CIRCLE:{bytesPerFeature:26814.829146752174,bytesPerFeatureLabel:963.0500999999999,bytesPerCoordinate:2395.4483977546115,resourceBytes:0,draped:{bytesPerFeature:26814.829146752174,bytesPerFeatureLabel:963.0500999999999,bytesPerCoordinate:2395.4483977546115}},PATH_ROUND_CIRCLE:{bytesPerFeature:16963.84475541293,bytesPerFeatureLabel:996.1762000000001,bytesPerCoordinate:4978.373360064154,resourceBytes:0,draped:{bytesPerFeature:16963.84475541293,bytesPerFeatureLabel:996.1762000000001,bytesPerCoordinate:4978.373360064154}},PATH_MITER_QUAD:{bytesPerFeature:17468.505921411364,bytesPerFeatureLabel:980.6950999999999,bytesPerCoordinate:1776.9797008821172,resourceBytes:0,draped:{bytesPerFeature:17468.505921411364,bytesPerFeatureLabel:980.6950999999999,bytesPerCoordinate:1776.9797008821172}},PATH_ROUND_QUAD:{bytesPerFeature:25851.768221331153,bytesPerFeatureLabel:956.9598,bytesPerCoordinate:3080.2657762630315,resourceBytes:0,draped:{bytesPerFeature:25851.768221331153,bytesPerFeatureLabel:956.9598,bytesPerCoordinate:3080.2657762630315}},FILL:{bytesPerFeature:5489.369802554269,bytesPerFeatureLabel:1012.22564,bytesPerCoordinate:9.734004494329515,resourceBytes:0,draped:{bytesPerFeature:4845.359311967749,bytesPerFeatureLabel:1004.9782666666669,bytesPerCoordinate:7.832210335065287}},FILL_OUTLINE:{bytesPerFeature:8353.648922169245,bytesPerFeatureLabel:1020.6102599999999,bytesPerCoordinate:14.685900784798825,resourceBytes:0,draped:{bytesPerFeature:7125.123613319484,bytesPerFeatureLabel:1007.2947466666666,bytesPerCoordinate:11.134039935316899}},EXTRUDE:{bytesPerFeature:16527.95032235245,bytesPerFeatureLabel:1028.1464866666668,bytesPerCoordinate:40.43281702948696,resourceBytes:0,draped:{bytesPerFeature:16527.95032235245,bytesPerFeatureLabel:1028.1464866666668,bytesPerCoordinate:40.43281702948696}},EXTRUDE_EDGES:{bytesPerFeature:18415.67490490035,bytesPerFeatureLabel:1023.0124733333333,bytesPerCoordinate:40.548367493921205,resourceBytes:0,draped:{bytesPerFeature:18415.67490490035,bytesPerFeatureLabel:1023.0124733333333,bytesPerCoordinate:40.548367493921205}}},zv=ne.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Vp=class extends HV{constructor(e,r,i,s){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=zv,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new od,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=XX(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=XX(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&zv.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const s=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(zv.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(zv.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return zv.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return yze}_defaultElevationInfoZ(){return _ze}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?rze:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=ZX){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=ZX){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return bE(null,i);const s=e!=null?ht.toUnitRGB(e):zf;return bE(s,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=bE(i,s);return r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return bpe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==Yi.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let s=Yi.UPDATE;return e.forEach(n=>{const o=r(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=Yi.RECREATE}),s}applyRendererDiff(e,r){return fs.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?Hh(r.size.field,e):0,s=r.color?Hh(r.color.field,e):0,n=r.opacity?Hh(r.opacity.field,e):0;return Ct(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&zv.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,s,n,o,a,l,c;return{size:((i=(r=this._fastUpdates)==null?void 0:r.visualVariables.size)==null?void 0:i.field)??null,color:((n=(s=this._fastUpdates)==null?void 0:s.visualVariables.color)==null?void 0:n.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function XX(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const yze={mode:"on-the-ground",offset:0,unit:"meters"},_ze={mode:"absolute-height",offset:0,unit:"meters"},ZX={hasIntrinsicColor:!1};let Rm=class extends fA{get geometries(){return this._geometries}get transformation(){return this._transformation??qa}set transformation(e){this._transformation=en(this._transformation??xe(),e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(e={}){super(),this.type=Wi.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new xpe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){He(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new y$(cm.MaskOccludee);for(const r of this._geometries)r.occludees=uU(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=hU(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new y$(cm.Highlight);for(const r of this._geometries)r.highlights=uU(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=hU(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return qi(r,this.transformation,e.transformation)}_getCombinedShaderTransformation(e){return qi(xe(),this.transformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new JX,this._validateBoundingVolume(this._bvWorldSpace,wE.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new JX,this._validateBoundingVolume(this._bvObjectSpace,wE.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===wE.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&vze(n,e,i?s.shaderTransformation:this._getCombinedShaderTransformation(s))}Pr(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=i?s.shaderTransformation:this._getCombinedShaderTransformation(s),a=gx(o);De(QX,n.center,o);const l=ei(QX,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var r;const e=(r=this._bvWorldSpace)==null?void 0:r.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},xpe=class{constructor(){this.min=Ce(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ce(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},JX=class extends xpe{constructor(){super(...arguments),this.bounds=ss()}};function vze(t,e,r){const i=t.bbMin,s=t.bbMax;if(gL(r)){const n=se(bze,r[12],r[13],r[14]);oe(zl,i,n),oe(Zu,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],zl[o]),e.max[o]=Math.max(e.max[o],Zu[o])}else if(De(zl,i,r),ca(i,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],zl[n]),e.max[n]=Math.max(e.max[n],zl[n]);else{De(Zu,s,r);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],zl[n],Zu[n]),e.max[n]=Math.max(e.max[n],zl[n],Zu[n]);for(let n=0;n<3;++n){te(zl,i),te(Zu,s),zl[n]=s[n],Zu[n]=i[n],De(zl,zl,r),De(Zu,Zu,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],zl[o],Zu[o]),e.max[o]=Math.max(e.max[o],zl[o],Zu[o])}}}const bze=C(),zl=C(),Zu=C(),QX=C();var wE;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(wE||(wE={}));function YV(t,e,r,i,s,n){const o=t.clippingExtent;if(bo(e,y0,t.elevationProvider.spatialReference),o!=null&&!SB(o,y0))return null;bo(e,y0,t.renderCoordsHelper.spatialReference),r.shaderTransformer=n,r.localOrigin=t.localOriginFactory.getOrigin(y0);const a=new Rm({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:UUe(a,e,t.elevationProvider,t.renderCoordsHelper,i)}}function xC(t,e,r){const i=t.elevationContext,s=r.spatialReference;bo(e,y0,s),i.centerPointInElevationSR=fv(y0[0],y0[1],e.hasZ?y0[2]:0,s??null)}function TC(t){switch(t.type){case"point":return t;case"polygon":case"extent":return kV(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=Sie(e,Tie(e)/2);return fv(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const y0=C();function Tpe(){return new Float32Array(2)}function wze(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function lu(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function xze(t,e){return new Float32Array(t,e,2)}function Spe(){return Tpe()}function Epe(){return lu(1,1)}function Cpe(){return lu(1,0)}function Ape(){return lu(0,1)}const Ope=Spe(),Rpe=Epe(),Tze=Cpe(),Sze=Ape();Object.freeze(Object.defineProperty({__proto__:null,ONES:Rpe,UNIT_X:Tze,UNIT_Y:Sze,ZEROS:Ope,clone:wze,create:Tpe,createView:xze,fromValues:lu,ones:Epe,unitX:Cpe,unitY:Ape,zeros:Spe},Symbol.toStringTag,{value:"Module"}));function Eze(t){const e=new ur,{vertex:r,fragment:i}=e;return r.include(iD),e.include(Whe,t),e.include(rs,t),e.attributes.add(S.UV0,"vec2"),r.uniforms.add(new Wt("viewport",(s,n)=>n.camera.fullViewport),new Se("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new mr("pixelToNDC",(s,n)=>Qt(eZ,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Se("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new mr("screenOffset",(s,n)=>Qt(eZ,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&rD(r),r.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?b`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?b`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:b`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?b`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:b`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?b`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:b`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new Wt("uColor",s=>KX(s.color)),new Wt("borderColor",s=>KX(s.borderColor))),t.hasMultipassGeometry&&(i.include(wce,t),i.uniforms.add(new mr("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(b`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?b`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:b`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function KX(t){return t??gp}const eZ=Ie(),Cze=Object.freeze(Object.defineProperty({__proto__:null,build:Eze},Symbol.toStringTag,{value:"Module"}));let Ppe=class Mpe extends gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Re.Global}initializeProgram(e){return new pr(e.rctx,Mpe.shader.get().build(this.configuration),cr)}setPipelineState(e){const r=e?Br.ALWAYS:Br.LESS;return this.configuration.depthHudEnabled?xt({depthTest:{func:r},depthWrite:Ya}):xt({blending:Xn(_e.ONE,_e.SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:$t})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};Ppe.shader=new dr(Cze,()=>he(()=>import("./LineCallout.glsl-97dd881c.js"),[]));let Xc=class extends uo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Ua.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};h([D({count:Ua.COUNT})],Xc.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([D()],Xc.prototype,"spherical",void 0),h([D()],Xc.prototype,"occlusionTestEnabled",void 0),h([D()],Xc.prototype,"hasVerticalOffset",void 0),h([D()],Xc.prototype,"hasScreenSizePerspective",void 0),h([D()],Xc.prototype,"depthHudEnabled",void 0),h([D()],Xc.prototype,"depthHudAlignStartEnabled",void 0),h([D()],Xc.prototype,"hasSlicePlane",void 0),h([D()],Xc.prototype,"hasMultipassGeometry",void 0),h([D({constValue:!0})],Xc.prototype,"hasSliceInVertexProgram",void 0),h([D({constValue:!1})],Xc.prototype,"isDraped",void 0);let gO=class XU extends ry{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new $pe),this._configuration=new Xc,this._uniqueMaterialIdentifier=XU.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==ae.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Ua.Screen:Ua.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===L.Color)switch(e){case ae.LINE_CALLOUTS:case ae.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new Aze(e)}createBufferWriter(){return new Rze}validateParameters(e){const r=XU.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},Aze=class extends ey{beginSlot(e){return this.ensureTechnique(Ppe,e)}},$pe=class extends OV{constructor(){super(...arguments),this.screenOffset=Kh,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const Oze=Ri().vec3f(S.POSITION).vec3f(S.NORMAL).vec2f(S.UV0).vec4f(S.AUXPOS1),tZ=[lu(0,0),lu(1,0),lu(0,1),lu(1,0),lu(1,1),lu(0,1)];let Rze=class{constructor(){this.vertexBufferLayout=Oze}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(S.POSITION).length}write(e,r,i,s,n){sD(i.indices.get(S.POSITION),i.vertexAttributes.get(S.POSITION).data,e,s.position,n,6),RV(i.indices.get(S.NORMAL),i.vertexAttributes.get(S.NORMAL).data,r,s.normal,n,6),Mx(i.indices.get(S.AUXPOS1),i.vertexAttributes.get(S.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<tZ.length;++o)s.uv0.setVec(n+o,tZ[o])}},Ipe=class Lpe extends Vp{constructor(e,r){super(e,null,r,$ze),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new gO(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||Kh,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new $pe,r=this.symbol,i=r.callout;if(e.color=i.color!=null?ht.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=Fo(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:Fo(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=i.border!=null&&i.border.color!=null?ht.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.getItemAt(0).type==="object",n=r.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Mze}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,s=this.setGraphicElevationContext(i,new od,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!zne(l)))return null;const a=kV(i.geometry);return a==null?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){var e;(e=this._material)==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=TA(Lpe.elevationModeChangeTypes,i,s);return n!==Yi.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){var e;return(e=this._material)==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Uu(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:WV.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,s=new Le(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),n=new Le(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[S.POSITION,s],[S.NORMAL,new Le([0,0,1],3,!0)],[S.AUXPOS1,n]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=gO.uniqueMaterialIdentifier(r);if(this._material&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(i);return s==null&&(s=new gO(r),e.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new gO(r),isUnique:!0}}_createAs3DShape(e,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new Rs(a.material,this._createVertexData(i),Pze,null,Wi.Point,o),c=YV(this._context,e,l,r,s);if(c==null)return null;const u=new Bp(this,c.object,[l],a.isUnique?[a.material]:null,null,wC,r);return u.metadata=new ppe(i.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=Uu(r.mode),xC(u,e,this._context.elevationProvider),u}};Ipe.elevationModeChangeTypes={definedChanged:Yi.UPDATE,staysOnTheGround:Yi.UPDATE,onTheGroundChanged:Yi.RECREATE};const V4=[0],Pze=[[S.POSITION,V4],[S.NORMAL,V4],[S.AUXPOS1,V4]],Mze={mode:"relative-to-ground",offset:0},$ze={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let Ize=class{constructor(e,r,i=C(),s=Ht(),n=Ie(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},Lze=class extends ize{};const rZ=ne.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Dze(t,e){if(!$B(t))return rZ.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=Nze[t.callout.type];return r?new r(t,e):(rZ.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const Nze={line:Ipe};let V1=class Dpe{constructor(e=null,r={},i,s){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new Dpe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function $gt(t){return!(t.geometry==null||!t.geometry.coords||!t.geometry.coords.length)}let Igt=class extends V1{},Fze=class Npe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new Npe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},W0=class IP{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,s,n]=e,o=s-r,a=n-i;return new IP([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)e(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(e){return e?(e.set(this.coords),new IP(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new IP(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function ko(t,e){return t?e?4:3:e?3:2}const EA=ne.getLogger("esri.layers.graphics.featureConversionUtils"),Fpe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},Uze=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n},iZ=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2]},zze=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+3]},kze=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2],t[r+3]=e[i+3]};function XV(t,e,r,i){if(t){if(r)return e&&i?kze:iZ;if(e&&i)return zze}else if(e&&i)return iZ;return Uze}function G4({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function j4({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function H4({scale:t,translate:e},r,i){return r*t[i]+e[i]}function Dgt(t,e,r){return t?e?r?QV(t):ZV(t):r?JV(t):dD(t):null}function dD(t){const e=t.coords;return{x:e[0],y:e[1]}}function Upe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function ZV(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Bze(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function JV(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function Vze(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function QV(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Gze(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function jze(t,e,r,i){let s=dD;r&&i?s=QV:r?s=ZV:i&&(s=JV);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function KV(t,e){return t&&e?Gze:t?Bze:e?Vze:Upe}function Hze(t,e,r,i,s){const n=KV(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new W0,o):null;t.push(new V1(l,a,null,s?a[s]:void 0))}return t}function Ngt(t,e,r=KV(e.z!=null,e.m!=null)){return r(t,e)}function Wze(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?zpe(s,r,i):null});return t}function zpe(t,e,r){if(t==null)return null;const i=ko(e,r),s=[];for(let n=0;n<t.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[n+a]);s.push(o)}return e?r?{points:s,hasZ:e,hasM:r}:{points:s,hasZ:e}:r?{points:s,hasM:r}:{points:s}}function qze(t,e,r,i,s){const n=ko(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?kpe(new W0,o,n):null;t.push(new V1(l,a,null,s?a[s]:void 0))}return t}function kpe(t,e,r=ko(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let s=0;for(const n of e.points)for(let o=0;o<r;o++)i[s++]=n[o];return t}function Yze(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?Bpe(s,r,i):null});return t}function Bpe(t,e,r){if(!t)return null;const i=ko(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(s[a++]);c.push(d)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function Xze(t,e,r,i,s){const n=ko(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?Vpe(new W0,o,n):null;t.push(new V1(l,a,null,s?a[s]:void 0))}return t}function Vpe(t,e,r=ko(e.hasZ,e.hasM)){const{lengths:i,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return t}function Zze(t,e,r,i){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?Gpe(s,r,i):null;if(o!=null){const l=dD(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function Gpe(t,e,r){if(!t)return null;const i=ko(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(s[a++]);c.push(d)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function Jze(t,e,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?jpe(new W0,n,r,i):null,c=s?a[s]:void 0;o!=null?t.push(new V1(l,a,Upe(new W0,o),c)):t.push(new V1(l,a,null,c))}return t}function jpe(t,e,r=e.hasZ,i=e.hasM){return Qze(t,e.rings,r,i)}function Qze(t,e,r,i){const s=ko(r,i),{lengths:n,coords:o}=t;let a=0;qf(t);for(const l of e){for(const c of l)for(let u=0;u<s;u++)o[a++]=c[u];n.push(l.length)}return t}const Vw=[],xE=[];function Fgt(t,e,r,i,s){Vw[0]=t;const[n]=Hpe(xE,Vw,e,r,i,s);return rd(Vw),rd(xE),n}function Hpe(t,e,r,i,s,n){if(rd(t),!r){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new V1(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return Hze(t,e,i,s,n);case"esriGeometryMultipoint":return qze(t,e,i,s,n);case"esriGeometryPolyline":return Xze(t,e,i,s,n);case"esriGeometryPolygon":return Jze(t,e,i,s,n);default:EA.error("convertToFeatureSet:unknown-geometry",new X(`Unable to parse unknown geometry type '${r}'`)),rd(t)}return t}function Ugt(t,e,r,i){xE[0]=t,Wpe(Vw,xE,e,r,i);const s=Vw[0];return rd(Vw),rd(xE),s}function Kze(t,e,r){if(t==null)return null;const i=new W0;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),Kk(t)?KV(e??t.z!=null,r??t.m!=null)(i,t):tB(t)?jpe(i,t,e,r):eB(t)?Vpe(i,t,ko(e,r)):Qk(t)?kpe(i,t,ko(e,r)):void EA.error("convertFromGeometry:unknown-geometry",new X(`Unable to parse unknown geometry type '${t}'`))}function eke(t,e,r,i){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=dD;return r&&i?n=QV:r?n=ZV:i&&(n=JV),n(s)}case"esriGeometryMultipoint":return zpe(s,r,i);case"esriGeometryPolyline":return Bpe(s,r,i);case"esriGeometryPolygon":return Gpe(s,r,i);default:return EA.error("convertToGeometry:unknown-geometry",new X(`Unable to parse unknown geometry type '${e}'`)),null}}function tke(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function Wpe(t,e,r,i,s){if(rd(t),r==null)return tke(t,e);switch(r){case"esriGeometryPoint":return jze(t,e,i,s);case"esriGeometryMultipoint":return Wze(t,e,i,s);case"esriGeometryPolyline":return Yze(t,e,i,s);case"esriGeometryPolygon":return Zze(t,e,i,s);default:EA.error("convertToFeatureSet:unknown-geometry",new X(`Unable to parse unknown geometry type '${r}'`))}return t}function zgt(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:p}=t,g={features:Wpe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:u,queryGeometry:eke(d,p,!1,!1)};return i&&(g.transform=i),c&&(g.exceededTransferLimit=c),n&&(g.hasM=n),o&&(g.hasZ=o),g}function kgt(t,e){const r=new Fze,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:d}=t;return d&&(r.fields=d),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&Hpe(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),u&&(r.transform=u),r):(EA.error(new X("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function Bgt(t){const{transform:e,features:r,hasM:i,hasZ:s}=t;if(!e)return t;for(const n of r)n.geometry!=null&&nZ(n.geometry,n.geometry,i,s,e),n.centroid!=null&&nZ(n.centroid,n.centroid,i,s,e);return t.transform=null,t}function Vgt(t,e){const{geometryType:r,features:i,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new W0,sZ(l.geometry,a.geometry,s,n,r,t),a.centroid&&(l.centroid=new W0,sZ(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function sZ(t,e,r,i,s,n,o=r,a=i){if(qf(t),e==null||!e.coords.length)return null;const l=Fpe[s],{coords:c,lengths:u}=e,d=ko(r,i),p=ko(r&&o,i&&a),g=XV(r,i,o,a);if(!u.length)return g(t.coords,c,0,0,G4(n,c[0]),j4(n,c[1])),qf(t,d,0),t;let y,_,v,w,T=0,x=0,E=x;for(const O of u){if(O<l)continue;let A=0;x=E,v=y=G4(n,c[T]),w=_=j4(n,c[T+1]),g(t.coords,c,x,T,v,w),A++,T+=d,x+=p;for(let $=1;$<O;$++,T+=d)v=G4(n,c[T]),w=j4(n,c[T+1]),v===y&&w===_||(g(t.coords,c,x,T,v-y,w-_),x+=p,A++,y=v,_=w);A>=l&&(t.lengths.push(A),E=x)}return rd(t.coords,E),t.coords.length?t:null}function Ggt(t,e,r,i,s,n,o=r,a=i){if(qf(t),!e||!e.coords.length)return null;const l=Fpe[s],{coords:c,lengths:u}=e,d=ko(r,i),p=ko(r&&o,i&&a),g=XV(r,i,o,a);if(!u.length)return g(t.coords,c,0,0,c[0],c[1]),qf(t,d,0),t;let y=0;const _=n*n;for(const v of u){if(v<l){y+=v*d;continue}const w=t.coords.length/p,T=y,x=y+(v-1)*d;g(t.coords,c,t.coords.length,T,c[T],c[T+1]),ZU(t.coords,c,d,_,g,T,x),g(t.coords,c,t.coords.length,x,c[x],c[x+1]);const E=t.coords.length/p-w;E>=l?t.lengths.push(E):rd(t.coords,w*p),y+=v*d}return t.coords.length?t:null}function rke(t,e,r,i){const s=t[e],n=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let u=o,d=a,p=l-u,g=c-d;if(p!==0||g!==0){const y=((s-u)*p+(n-d)*g)/(p*p+g*g);y>1?(u=l,d=c):y>0&&(u+=p*y,d+=g*y)}return p=s-u,g=n-d,p*p+g*g}function ZU(t,e,r,i,s,n,o){let a,l=i,c=0;for(let u=n+r;u<o;u+=r)a=rke(e,u,n,o),a>l&&(c=u,l=a);l>i&&(c-n>r&&ZU(t,e,r,i,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>r&&ZU(t,e,r,i,s,c,o))}function jgt(t,e,r,i){if(e==null||!e.coords||!e.coords.length)return null;const s=ko(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let u=0;u<c.length;u+=s){const d=c[u],p=c[u+1];n=Math.min(n,d),a=Math.max(a,d),o=Math.min(o,p),l=Math.max(l,p)}}return r9(t)?qCe(t,n,o,a,l):Wk(n,o,a,l,t),t}function nZ(t,e,r,i,s){const{coords:n,lengths:o}=e,a=ko(r,i);if(!n.length)return t!==e&&qf(t),t;CI(s);const{originPosition:l,scale:c,translate:u}=s,d=ske;d.originPosition=l;const p=d.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const g=d.translate;if(g[0]=u[0]??0,g[1]=u[1]??0,g[2]=u[2]??0,g[3]=u[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=H4(d,n[_],_);return t!==e&&qf(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let x=0;x<a;++x)t.coords[y+x]=H4(d,n[y+x],x);let w=t.coords[y],T=t.coords[y+1];y+=a;for(let x=1;x<v;x++,y+=a){w+=n[y]*p[0],T+=n[y+1]*p[1],t.coords[y]=w,t.coords[y+1]=T;for(let E=2;E<a;++E)t.coords[y+E]=H4(d,n[y+E],E)}}return t!==e&&qf(t,n.length,o.length),t}function Hgt(t,e,r,i,s,n){if(qf(t),t.lengths.push(...e.lengths),r===s&&i===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=ko(r,i),a=XV(r,i,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function ike(t,e,r,i){let s=0,n=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=n+t[i*(e+a)],c=o+t[i*(e+a)+1],u=(l-n)*(c+o);n=l,o=c,s+=u}return .5*s}function Wgt(t,e){const{coords:r,lengths:i}=t;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=ike(r,s,a,e),s+=a}return Math.abs(n)}function qgt(t,e){if(t==null)return null;const r=t.clone(),i=t.coords,s=t.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=i[e*n],c=i[e*n+1];for(let u=1;u<a;u++){const d=l+i[e*(n+u)],p=c+i[e*(n+u)+1];r.coords[e*(n+u)]=d,r.coords[e*(n+u)+1]=p,l=d,c=p}n+=a}return r}function qf(t,e=0,r=0){rd(t.lengths,r),rd(t.coords,e)}function rd(t,e=0){t.length!==e&&(t.length=e)}const ske={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},oZ=new po(Array,t=>rL(t,Ene),null,10,5),nke=Ut();let oke=class{get labelLayers(){return this._labelLayers||b1e}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,r,i,s,n){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=ho.ALL_LABEL,++r.referenced,this._featureExpressionFeature=n?cpe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(yn.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=yn.GRAPHIC,r){const i=r?this._visibleFlags|r|yn.LABEL*r:this._visibleFlags;return e===yn.GRAPHIC?(i&ho.ALL_GRAPHIC)===ho.ALL_GRAPHIC:(i&ho.ALL_LABEL)===ho.ALL_LABEL}setVisibilityFlag(e,r,i){const s=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const n=this.isVisible(e);if(s===n)return!1;if(e===yn.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(yn.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=Ut(),mUe(r,this._extent);const i=r.spatialReference;if(!Sn(i,e)&&!yL(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=tv.fromExtent(s.type==="mesh"?s.extent:s)),Kze(s,r,i)}get usedMemory(){let e=Lde(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(i==null)return;const s=r.type==="draped"?i.memory.draped:i.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=fUe(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:C(),num:0},draped:{origin:Ie(),num:0}};for(const r of this.layers)r!=null&&r.computeAttachmentOrigin(e);return e.render.num>1&&ee(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Tl(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?li(n.boundingBox):n.boundingBox=li(),n.requiresDrapedElevation=!1,await UI(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=oZ.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&cx(n.boundingBox,l),oZ.release(l)}),HCe(n.boundingBox)||c6(EB(n.boundingBox,nke))?n:null}needsElevationUpdates(){var e;for(const r of this.layers)if(r!=null&&(r.type==="object3d"||r.type==="lod-instance")&&r.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(r=>(r==null?void 0:r.needsElevationUpdates)??!1))??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e==null||e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},Xgt=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},ake=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var aZ,lZ,cZ,JU={exports:{}};JU.exports,aZ=JU,lZ=function(){function t(R,I,N){N=N||2;var V,q,J,K,ge,Me,pt,Tt=I&&I.length,et=Tt?I[0]*N:R.length,tt=e(R,0,et,N,!0),Ne=[];if(!tt||tt.next===tt.prev)return Ne;if(Tt&&(tt=l(R,I,tt,N)),R.length>80*N){V=J=R[0],q=K=R[1];for(var de=N;de<et;de+=N)(ge=R[de])<V&&(V=ge),(Me=R[de+1])<q&&(q=Me),ge>J&&(J=ge),Me>K&&(K=Me);pt=(pt=Math.max(J-V,K-q))!==0?1/pt:0}return i(tt,Ne,N,V,q,pt),Ne}function e(R,I,N,V,q){var J,K;if(q===Z(R,I,N,V)>0)for(J=I;J<N;J+=V)K=Y(J,R[J],R[J+1],K);else for(J=N-V;J>=I;J-=V)K=Y(J,R[J],R[J+1],K);if(K&&O(K,K.next)){var ge=K.next;W(K),K=ge}return K}function r(R,I){if(!R)return R;I||(I=R);var N,V=R;do if(N=!1,V.steiner||!O(V,V.next)&&E(V.prev,V,V.next)!==0)V=V.next;else{var q=V.prev;if(W(V),(V=I=q)===V.next)break;N=!0}while(N||V!==I);return I}function i(R,I,N,V,q,J,K){if(R){!K&&J&&y(R,V,q,J);for(var ge,Me,pt=R;R.prev!==R.next;)if(ge=R.prev,Me=R.next,J?n(R,V,q,J):s(R))I.push(ge.i/N),I.push(R.i/N),I.push(Me.i/N),W(R),R=Me.next,pt=Me.next;else if((R=Me)===pt){K?K===1?i(R=o(r(R),I,N),I,N,V,q,J,2):K===2&&a(R,I,N,V,q,J):i(r(R),I,N,V,q,J,1);break}}}function s(R){var I=R.prev,N=R,V=R.next;if(E(I,N,V)>=0)return!1;for(var q=R.next.next;q!==R.prev;){if(T(I.x,I.y,N.x,N.y,V.x,V.y,q.x,q.y)&&E(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function n(R,I,N,V){var q=R.prev,J=R,K=R.next;if(E(q,J,K)>=0)return!1;for(var ge=q.x<J.x?q.x<K.x?q.x:K.x:J.x<K.x?J.x:K.x,Me=q.y<J.y?q.y<K.y?q.y:K.y:J.y<K.y?J.y:K.y,pt=q.x>J.x?q.x>K.x?q.x:K.x:J.x>K.x?J.x:K.x,Tt=q.y>J.y?q.y>K.y?q.y:K.y:J.y>K.y?J.y:K.y,et=v(ge,Me,I,N,V),tt=v(pt,Tt,I,N,V),Ne=R.prevZ,de=R.nextZ;Ne&&Ne.z>=et&&de&&de.z<=tt;){if(Ne!==R.prev&&Ne!==R.next&&T(q.x,q.y,J.x,J.y,K.x,K.y,Ne.x,Ne.y)&&E(Ne.prev,Ne,Ne.next)>=0||(Ne=Ne.prevZ,de!==R.prev&&de!==R.next&&T(q.x,q.y,J.x,J.y,K.x,K.y,de.x,de.y)&&E(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;Ne&&Ne.z>=et;){if(Ne!==R.prev&&Ne!==R.next&&T(q.x,q.y,J.x,J.y,K.x,K.y,Ne.x,Ne.y)&&E(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.prevZ}for(;de&&de.z<=tt;){if(de!==R.prev&&de!==R.next&&T(q.x,q.y,J.x,J.y,K.x,K.y,de.x,de.y)&&E(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function o(R,I,N){var V=R;do{var q=V.prev,J=V.next.next;!O(q,J)&&A(q,V,V.next,J)&&k(q,J)&&k(J,q)&&(I.push(q.i/N),I.push(V.i/N),I.push(J.i/N),W(V),W(V.next),V=R=J),V=V.next}while(V!==R);return r(V)}function a(R,I,N,V,q,J){var K=R;do{for(var ge=K.next.next;ge!==K.prev;){if(K.i!==ge.i&&x(K,ge)){var Me=z(K,ge);return K=r(K,K.next),Me=r(Me,Me.next),i(K,I,N,V,q,J),void i(Me,I,N,V,q,J)}ge=ge.next}K=K.next}while(K!==R)}function l(R,I,N,V){var q,J,K,ge=[];for(q=0,J=I.length;q<J;q++)(K=e(R,I[q]*V,q<J-1?I[q+1]*V:R.length,V,!1))===K.next&&(K.steiner=!0),ge.push(w(K));for(ge.sort(c),q=0;q<ge.length;q++)N=r(N=d(ge[q],N),N.next);return N}function c(R,I){return R.x-I.x}function u(R){if(R.next.prev===R)return R;let I=R;for(;;){const N=I.next;if(N.prev===I||N===I||N===R)break;I=N}return I}function d(R,I){var N=p(R,I);if(!N)return I;var V=z(N,R),q=r(N,N.next);let J=u(V);return r(J,J.next),q=u(q),u(I===N?q:I)}function p(R,I){var N,V=I,q=R.x,J=R.y,K=-1/0;do{if(J<=V.y&&J>=V.next.y&&V.next.y!==V.y){var ge=V.x+(J-V.y)*(V.next.x-V.x)/(V.next.y-V.y);if(ge<=q&&ge>K){if(K=ge,ge===q){if(J===V.y)return V;if(J===V.next.y)return V.next}N=V.x<V.next.x?V:V.next}}V=V.next}while(V!==I);if(!N)return null;if(q===K)return N;var Me,pt=N,Tt=N.x,et=N.y,tt=1/0;V=N;do q>=V.x&&V.x>=Tt&&q!==V.x&&T(J<et?q:K,J,Tt,et,J<et?K:q,J,V.x,V.y)&&(Me=Math.abs(J-V.y)/(q-V.x),k(V,R)&&(Me<tt||Me===tt&&(V.x>N.x||V.x===N.x&&g(N,V)))&&(N=V,tt=Me)),V=V.next;while(V!==pt);return N}function g(R,I){return E(R.prev,R,I.prev)<0&&E(I.next,R,R.next)<0}function y(R,I,N,V){var q=R;do q.z===null&&(q.z=v(q.x,q.y,I,N,V)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==R);q.prevZ.nextZ=null,q.prevZ=null,_(q)}function _(R){var I,N,V,q,J,K,ge,Me,pt=1;do{for(N=R,R=null,J=null,K=0;N;){for(K++,V=N,ge=0,I=0;I<pt&&(ge++,V=V.nextZ);I++);for(Me=pt;ge>0||Me>0&&V;)ge!==0&&(Me===0||!V||N.z<=V.z)?(q=N,N=N.nextZ,ge--):(q=V,V=V.nextZ,Me--),J?J.nextZ=q:R=q,q.prevZ=J,J=q;N=V}J.nextZ=null,pt*=2}while(K>1);return R}function v(R,I,N,V,q){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R=32767*(R-N)*q)|R<<8))|R<<4))|R<<2))|R<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-V)*q)|I<<8))|I<<4))|I<<2))|I<<1))<<1}function w(R){var I=R,N=R;do(I.x<N.x||I.x===N.x&&I.y<N.y)&&(N=I),I=I.next;while(I!==R);return N}function T(R,I,N,V,q,J,K,ge){return(q-K)*(I-ge)-(R-K)*(J-ge)>=0&&(R-K)*(V-ge)-(N-K)*(I-ge)>=0&&(N-K)*(J-ge)-(q-K)*(V-ge)>=0}function x(R,I){return R.next.i!==I.i&&R.prev.i!==I.i&&!U(R,I)&&(k(R,I)&&k(I,R)&&B(R,I)&&(E(R.prev,R,I.prev)||E(R,I.prev,I))||O(R,I)&&E(R.prev,R,R.next)>0&&E(I.prev,I,I.next)>0)}function E(R,I,N){return(I.y-R.y)*(N.x-I.x)-(I.x-R.x)*(N.y-I.y)}function O(R,I){return R.x===I.x&&R.y===I.y}function A(R,I,N,V){var q=M(E(R,I,N)),J=M(E(R,I,V)),K=M(E(N,V,R)),ge=M(E(N,V,I));return q!==J&&K!==ge||!(q!==0||!$(R,N,I))||!(J!==0||!$(R,V,I))||!(K!==0||!$(N,R,V))||!(ge!==0||!$(N,I,V))}function $(R,I,N){return I.x<=Math.max(R.x,N.x)&&I.x>=Math.min(R.x,N.x)&&I.y<=Math.max(R.y,N.y)&&I.y>=Math.min(R.y,N.y)}function M(R){return R>0?1:R<0?-1:0}function U(R,I){var N=R;do{if(N.i!==R.i&&N.next.i!==R.i&&N.i!==I.i&&N.next.i!==I.i&&A(N,N.next,R,I))return!0;N=N.next}while(N!==R);return!1}function k(R,I){return E(R.prev,R,R.next)<0?E(R,I,R.next)>=0&&E(R,R.prev,I)>=0:E(R,I,R.prev)<0||E(R,R.next,I)<0}function B(R,I){var N=R,V=!1,q=(R.x+I.x)/2,J=(R.y+I.y)/2;do N.y>J!=N.next.y>J&&N.next.y!==N.y&&q<(N.next.x-N.x)*(J-N.y)/(N.next.y-N.y)+N.x&&(V=!V),N=N.next;while(N!==R);return V}function z(R,I){var N=new j(R.i,R.x,R.y),V=new j(I.i,I.x,I.y),q=R.next,J=I.prev;return R.next=I,I.prev=R,N.next=q,q.prev=N,V.next=N,N.prev=V,J.next=V,V.prev=J,V}function Y(R,I,N,V){var q=new j(R,I,N);return V?(q.next=V.next,q.prev=V,V.next.prev=q,V.next=q):(q.prev=q,q.next=q),q}function W(R){R.next.prev=R.prev,R.prev.next=R.next,R.prevZ&&(R.prevZ.nextZ=R.nextZ),R.nextZ&&(R.nextZ.prevZ=R.prevZ)}function j(R,I,N){this.i=R,this.x=I,this.y=N,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Z(R,I,N,V){for(var q=0,J=I,K=N-V;J<N;J+=V)q+=(R[K]-R[J])*(R[J+1]+R[K+1]),K=J;return q}return t.deviation=function(R,I,N,V){var q=I&&I.length,J=q?I[0]*N:R.length,K=Math.abs(Z(R,0,J,N));if(q)for(var ge=0,Me=I.length;ge<Me;ge++){var pt=I[ge]*N,Tt=ge<Me-1?I[ge+1]*N:R.length;K-=Math.abs(Z(R,pt,Tt,N))}var et=0;for(ge=0;ge<V.length;ge+=3){var tt=V[ge]*N,Ne=V[ge+1]*N,de=V[ge+2]*N;et+=Math.abs((R[tt]-R[de])*(R[Ne+1]-R[tt+1])-(R[tt]-R[Ne])*(R[de+1]-R[tt+1]))}return K===0&&et===0?0:Math.abs((et-K)/K)},t.flatten=function(R){for(var I=R[0][0].length,N={vertices:[],holes:[],dimensions:I},V=0,q=0;q<R.length;q++){for(var J=0;J<R[q].length;J++)for(var K=0;K<I;K++)N.vertices.push(R[q][J][K]);q>0&&(V+=R[q-1].length,N.holes.push(V))}return N},t},(cZ=lZ())!==void 0&&(aZ.exports=cZ);const Fx=mA(JU.exports),pD=ne.getLogger("esri.views.3d.support.buffer.math");function lke(t,e,r){Ux(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function Ux(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return pD.error("source and destination buffers need to have the same number of elements"),t;const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],d=r[6],p=r[8],g=r[9],y=r[10],_=r[12],v=r[13],w=r[14];let T=0,x=0;for(let E=0;E<n;E++){const O=e[T],A=e[T+1],$=e[T+2];t[x]=o*O+c*A+p*$+_,t[x+1]=a*O+u*A+g*$+v,t[x+2]=l*O+d*A+y*$+w,T+=s,x+=i}return t}function qpe(t,e,r){G1(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function G1(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return void pD.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],d=r[5],p=r[6],g=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const T=e[_],x=e[_+1],E=e[_+2];t[v]=o*T+c*x+p*E,t[v+1]=a*T+u*x+g*E,t[v+2]=l*T+d*x+y*E,_+=s,v+=i}}function cke(t,e,r){B$(t.typedBuffer,e,r,t.typedBufferStride)}function B$(t,e,r,i=3){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],a+=o,l+=i}function uke(t,e){fD(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function fD(t,e,r=3,i=r){const s=Math.min(t.length/r,e.length/i);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],u=e[n+2],d=l*l+c*c+u*u;if(d>0){const p=1/Math.sqrt(d);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}n+=i,o+=r}}function hke(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<i;u++)s[c]=o[l]>>r,s[c+1]=o[l+1]>>r,s[c+2]=o[l+2]>>r,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:fD,normalizeView:uke,scale:B$,scaleView:cke,shiftRight:hke,transformMat3:G1,transformMat3View:qpe,transformMat4:Ux,transformMat4View:lke},Symbol.toStringTag,{value:"Module"}));function dke(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function uZ(t,e,r,i,s,n=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:s,draped:n}}var Yf,Mo;function pke(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function SC(t){return t!=null&&!isNaN(t)&&isFinite(t)}function fke(t){return t.valueExpression?Yf.Expression:t.field&&typeof t.field=="string"?Yf.Field:Yf.Unknown}function Qgt(t,e){const r=e||fke(t),i=t.valueUnit||"unknown";return r===Yf.Unknown?Mo.Constant:t.stops?Mo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Mo.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Mo.Proportional:Mo.Additive:Mo.Identity:Mo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(Yf||(Yf={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Mo||(Mo={}));const q0=ne.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),hZ=new om,LP=Math.PI,mke=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function Ype(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void q0.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const y=i.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(u){if(r==null||r.arcade==null)return void q0.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!d){const T=_.createSyntaxTree(i.valueExpression);d=_.createFunction(T),i.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const p=i.normalizationField,g=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const y=tG(a,c);if(y){const _=y[0],v=y[1],w=_===v?i.stops[_].color:ht.blendColors(i.stops[_].color,i.stops[v].color,y[2],r!=null?r.color:void 0);return new ht(w)}}}function Xpe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void q0.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const y=i.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(u){if(r==null||r.arcade==null)return void q0.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!d){const T=_.createSyntaxTree(i.valueExpression);d=_.createFunction(T),i.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const p=i.normalizationField,g=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const y=tG(a,c);if(y){const _=y[0],v=y[1];if(_===v)return i.stops[_].opacity;{const w=i.stops[_].opacity;return w+(i.stops[v].opacity-w)*y[2]}}}}function Zpe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void q0.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:u}=i.cache;let d=i.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if(r==null||r.arcade==null)return void q0.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(g),v=y.createExecContext(a,_);if(!d){const w=y.createSyntaxTree(i.valueExpression);d=y.createFunction(w),i.cache.compiledFunc=d}p=y.executeFunction(d,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:n+o*p,p}function gke(t,e,r){const i=typeof e=="number",s=i?null:e,n=s&&s.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=r!=null?r.scale:void 0,d=r!=null?r.view:void 0;o=u==null||d==="3d"?yke(t):u}else if(!i)switch(t.inputValueType){case Yf.Expression:{if(r==null||r.arcade==null)return void q0.error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},d=r.arcade.arcadeUtils,p=d.getViewInfo(u),g=d.createExecContext(s,p);if(!l){const y=d.createSyntaxTree(t.valueExpression);l=d.createFunction(y),t.cache.compiledFunc=l}o=d.executeFunction(l,g);break}case Yf.Field:n&&(o=n[t.field]);break;case Yf.Unknown:o=null}if(!SC(o))return null;if(i||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return SC(c)&&c!==0?o/c:null}function yke(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function mD(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void q0.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=Qpe(gke(i,e,r),i,e,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function Ml(t,e,r){return t==null?null:pke(t)?mD(t,e,r):SC(t)?t:null}function Jpe(t,e,r){return SC(r)&&t>r?r:SC(e)&&t<e?e:t}function _ke(t,e,r,i){return t+((Ml(e.minSize,r,i)||e.minDataValue)??0)}function vke(t,e,r){const i=t.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=t.minSize),Ml(s,e,r)}function bke(t,e,r,i){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=Ml(e.minSize,r,i),o=Ml(e.maxSize,r,i),a=i!=null?i.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?LP*(n/2)**2:n*n,u=c+s*((l?LP*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/LP):Math.sqrt(u)}return n+s*(o-n)}function wke(t,e,r,i){const s=i!=null?i.shape:void 0,n=t/e.minDataValue,o=Ml(e.minSize,r,i),a=Ml(e.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,Jpe(l,o,a)}function xke(t,e,r,i,s){var l,c,u;const[n,o,a]=tG(t,s);if(n===o)return Ml((l=e.stops)==null?void 0:l[n].size,r,i);{const d=Ml((c=e.stops)==null?void 0:c[n].size,r,i);return d+(Ml((u=e.stops)==null?void 0:u[o].size,r,i)-d)*a}}function Tke(t,e,r,i){const s=(i!=null&&i.resolution?i.resolution:1)*$x[e.valueUnit],n=Ml(e.minSize,r,i),o=Ml(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/LP)/s:a==="radius"||a==="distance"?2*t/s:t/s,Jpe(l,n,o)}function Qpe(t,e,r,i,s){switch(e.transformationType){case Mo.Additive:return _ke(t,e,r,i);case Mo.Constant:return vke(e,r,i);case Mo.ClampedLinear:return bke(t,e,r,i);case Mo.Proportional:return wke(t,e,r,i);case Mo.Stops:return xke(t,e,r,i,s);case Mo.RealWorldSize:return Tke(t,e,r,i);case Mo.Identity:return t;case Mo.Unknown:return null}}function Ske(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const s={scale:e,view:r};let n=Ml(t.minSize,hZ,s),o=Ml(t.maxSize,hZ,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function eG(t,e,r){if(!t.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=Ype(l,e,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=Xpe(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=Zpe(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=mD(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function tG(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((s,n)=>t<s?(i=n,!0):(r=n,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function Eke(t,e,r){const i=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":mD(s,e,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const Kgt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Eke,getColor:Ype,getOpacity:Xpe,getRotationAngle:Zpe,getSize:mD,getSizeForValue:Qpe,getSizeFromNumberOrVariable:Ml,getSizeRangeAtScale:Ske,getVisualVariableValues:eG,viewScaleRE:mke},Symbol.toStringTag,{value:"Module"}));function gD(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function Cke(t,e){if(t.symbol!=null)return t.symbol;const r=gD(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function e0t(t,e){const r=gD(t,e),i=Cke(t,e);if(i==null)return null;const s={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=eG(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Ake(t,e){if(t.symbol!=null)return t.symbol;const r=gD(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function t0t(t,e){const r=gD(t,e),i=await Ake(t,e);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=eG(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=ht.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Oke(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function Rke(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function dZ(t){const e=[[S.POSITION,t.indices]],r=[[S.POSITION,new Le(t.attributeData.position,3,!0)]];return t.attributeData.colorFeature!=null?(r.push([S.COLORFEATUREATTRIBUTE,new Le([t.attributeData.colorFeature],1,!0)]),e.push([S.COLORFEATUREATTRIBUTE,new Array(t.indices.length).fill(0)])):t.attributeData.color&&(r.push([S.COLOR,new Le(t.attributeData.color,4,!0)]),e.push([S.COLOR,d2(t.indices.length)])),t.attributeData.uvMapSpace&&(r.push([S.UVMAPSPACE,new Le(t.attributeData.uvMapSpace,4,!0)]),e.push([S.UVMAPSPACE,t.indices])),t.attributeData.boundingRect&&(r.push([S.BOUNDINGRECT,new Le(t.attributeData.boundingRect,9,!0)]),e.push([S.BOUNDINGRECT,t.indices])),new Rs(t.material,r,e,t.mapPositions,Wi.Mesh,t.attributeData.objectAndLayerIdColor)}function pZ(t,e=null){const r=[[S.POSITION,t.indices],[S.UV0,t.indices]],i=[[S.POSITION,new Le(t.attributeData.position,3,!0)],[S.UV0,new Le(t.attributeData.uv0,2,!0)]];return new Rs(t.material,i,r,t.mapPositions,Wi.Mesh,e)}function EC(t){switch(t.type){case"extent":if(t instanceof Wr)return tv.fromExtent(t);break;case"polygon":return t}return null}let yD=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function QU(t,e,r){const i=Array.isArray(t),s=i?t.length/e:t.byteLength/(4*e),n=i?t:new Uint32Array(t,0,s*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let u=0;if(c)for(let A=0;A<c.length-1;A++){const $=c[A+1]-c[A];$>u&&(u=$)}else u=s;const d=Math.floor(1.1*u)+1;(gd==null||gd.length<2*d)&&(gd=new Uint32Array(Hk(2*d)));for(let A=0;A<2*d;A++)gd[A]=0;let p=0;const g=!!c&&!!a,y=g?l:s;let _=g$(s);const v=new Uint32Array(l),w=1.96;let T=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,x=1,E=c?c[1]:y;for(let A=0;A<y;A++){if(A===T){const z=1-p/A;if(z+w*Math.sqrt(z*(1-z)/A)<o)return null;T*=2}if(A===E){for(let z=0;z<2*d;z++)gd[z]=0;if(a)for(let z=c[x-1];z<c[x];z++)v[z]=_[a[z]];E=c[++x]}const $=g?a[A]:A,M=$*e,U=$ke(n,M,e);let k=U%d,B=p;for(;gd[2*k+1]!==0;){if(gd[2*k]===U){const z=gd[2*k+1]-1;if(Pke(n,M,z*e,e)){B=_[z];break}}k++,k>=d&&(k-=d)}B===p&&(gd[2*k]=U,gd[2*k+1]=$+1,p++),_[$]=B}if(o!==0&&1-p/s<o)return null;if(g){for(let A=c[x-1];A<v.length;A++)v[A]=_[a[A]];_=bp(v)}const O=i?new Array(p):new Uint32Array(p*e);p=0;for(let A=0;A<y;A++)_[A]===p&&(Mke(n,(g?a[A]:A)*e,O,p*e,e),p++);if(a&&!g){const A=new Uint32Array(l);for(let $=0;$<A.length;$++)A[$]=_[a[$]];_=bp(A)}return{buffer:Array.isArray(O)?O:O.buffer,indices:_,uniqueCount:p}}function Pke(t,e,r,i){for(let s=0;s<i;s++)if(t[e+s]!==t[r+s])return!1;return!0}function Mke(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[e+n]}function $ke(t,e,r){let i=0;for(let s=0;s<r;s++)i=t[e+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let gd=null;function i0t(t){const e=CA(t.rings,t.hasZ,Pp.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,u=xu(e.position,3*c,3*l),d=a.holeIndices.map(g=>g-c),p=bp(Fx(u,d,3));r.push({position:u,faces:p}),i+=u.length,s+=p.length}const n=Ike(r,i,s),o=Array.isArray(n.position)?QU(n.position,3,{originalIndices:n.faces}):QU(n.position.buffer,6,{originalIndices:n.faces});return n.position=sue(new Float64Array(o.buffer)),n.faces=o.indices,n}function Ike(t,e,r){if(t.length===1)return t[0];const i=go(e),s=new Array(r);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:i,faces:bp(s)}}function CA(t,e,r){const i=t.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,u=0;for(let g=0;g<i;++g)u+=t[g].length;const d=go(3*u);let p=0;for(let g=i-1;g>=0;g--){const y=t[g],_=r===Pp.CCW_IS_HOLE&&Lke(y);if(_&&i!==1)s[a++]=y;else{let v=y.length;for(let T=0;T<a;++T)v+=s[T].length;const w={index:p,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};w.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:p,count:y.length}),p=_?yO(y,y.length-1,-1,d,p,y.length,e):yO(y,0,1,d,p,y.length,e);for(let T=0;T<a;++T){const x=s[T];w.holeIndices[T]=p,w.pathLengths[T+1]=x.length,x.length>0&&(o[c++]={index:p,count:x.length}),p=yO(x,0,1,d,p,x.length,e)}a=0,w.count>0&&(n[l++]=w)}}for(let g=0;g<a;++g){const y=s[g];y.length>0&&(o[c++]={index:p,count:y.length}),p=yO(y,0,1,d,p,y.length,e)}return n.length=l,o.length=c,{position:d,polygons:n,outlines:o}}function yO(t,e,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,e+=r}return s/3}function Lke(t){return!Eie(t,!1,!1)}var Pp;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Pp||(Pp={}));var TE,V$,KU;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(TE||(TE={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(V$||(V$={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(KU||(KU={}));var Ci,cu,mt,SE,Bi,Ns,$o;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Ci||(Ci={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(cu||(cu={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(mt||(mt={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(SE||(SE={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(Bi||(Bi={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Ns||(Ns={})),function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"}($o||($o={}));let Dke=class{constructor(e,r){this.vec3=e,this.id=r}};function G$(t,e,r,i){return new Dke(Ce(t,e,r),i)}var Da;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Da||(Da={}));let fZ=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=Ut(),this.resolution=0,this.renderLocalOrigin=G$(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Nke,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===Da.ColorAndWater?this.renderTargets.getTarget(Bi.Color):e===Da.Highlight?this.renderTargets.getTarget(Bi.Highlight):e===Da.ObjectAndLayerIdColor?this.renderTargets.getTarget(Bi.ObjectAndLayerIdColor):this.renderTargets.getTarget(Bi.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Bi.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Bi.Color):null}getNormalTexture(e){const r=e===Da.ColorAndWater?this.renderTargets.getTarget(Bi.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==Bi.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?xx.CHANGED:xx.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[Bi.Color]|+e[Bi.ColorNoRasterImage]<<1|+e[Bi.Highlight]<<2|+e[Bi.Water]<<3|+e[Bi.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];LM(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];LM(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,sm(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===Ci.INNER?0:this.resolution,0,this.resolution,this.resolution)}},Nke=class{constructor(){this.extents=[Ut(),Ut(),Ut()],this.numViews=0}},Kpe=class{constructor(e,r){this._fbo=null;const i=new xr;i.wrapMode=Ot.CLAMP_TO_EDGE,i.samplingMode=wt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=r,i.maxAnisotropy=8,this._fbo=new As(e,i)}dispose(){this._fbo=Ue(this._fbo)}getTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}isValid(){return this._fbo!=null}resize(e,r){var i;(i=this._fbo)==null||i.resize(e,r)}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){var r;const e=(r=this._fbo)==null?void 0:r.colorTexture;e!=null&&e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},kv=class{constructor(e,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new Kpe(e,s)}},Fke=class{constructor(e){this.renderTargets=[new kv(e,L.Color,Bi.Color),new kv(e,L.Color,Bi.ColorNoRasterImage),new kv(e,L.Highlight,Bi.Highlight,!1),new kv(e,L.Normal,Bi.Water),new kv(e,L.Color,Bi.Occluded)],ie("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new kv(e,L.ObjectAndLayerIdColor,Bi.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){if(e)r.lastUsed=i;else if(i-r.lastUsed>Uke)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const Uke=1e3;let efe=class extends Ar{constructor(){super(...arguments),this.color=Ct(1,1,1,1)}};function zke(){const t=new ur;return t.include(Ac),t.fragment.uniforms.add(new We("tex",e=>e.texture),new Wt("uColor",e=>e.color)),t.fragment.code.add(b`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const kke=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:efe,build:zke},Symbol.toStringTag,{value:"Module"}));let tfe=class{constructor(e){this._context=e,this._perConstructorInstances=new p2,this._frameCounter=0,this._keepAliveFrameCount=mZ}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=Vke){const i=r.key;let s=this._perConstructorInstances.get(e,i);if(s==null){const n=new e(this._context,r,()=>this.release(n));s=new Bke(n),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==mZ&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(r,i))}),await Promise.all(e)}},Bke=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const mZ=-1,Vke=new Bo;let rfe=class{constructor(e,r,i,s){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new p2}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(s==null){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new Gke(n),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(Ue(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository!=null&&e.repository!==this&&ne.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Gke=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,He(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const jke={orderedRepackingEnabled:!1},Hke=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let ez=class DP{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new dn,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),dn.clearPool(),tz[0]=null,Cy.prune(),x_.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=dn.acquire();for(let s=0;s<r;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}dn.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=dn.acquire();for(const s of e){const n=r??mx(this.objectToBoundingSphere(s),Zke);OS(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}dn.release(i),this._shrink()}update(e,r){if(!OS(r[3])&&this._isDegenerate(e))return;const i=Xke(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const s=wc(e,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,s){const n=wc(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=W4(e,r),u=d=>{if(--n,!s(d))return;const p=this.objectToBoundingSphere(d);if(!m0(i,p))return;const g=qg(e,r,p),y=g-p[3],_=g+p[3];y<o&&(o=y,a=_,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(n<=0||!m0(i,d.bounds)||(ee(Mc,c,d.halfSize),oe(Mc,Mc,d.bounds),qg(e,r,Mc)>a))return!1;const p=d.node;return p.terminals.forAll(g=>u(g)),p.residents!==null&&p.residents.forAll(g=>u(g)),!0},e,r),l}forEachInDepthRange(e,r,i,s,n,o,a){let l=-1/0,c=1/0;const u={setRange:_=>{i===DP.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};u.setRange(s);const d=qg(r,i,e),p=W4(r,i),g=W4(r,-i),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),w=v,T=qg(r,i,w)-d,x=T-v[3],E=T+v[3];x>c||E<l||!m0(o,v)||n(_,u)};this._forEachNodeDepthOrdered(this._root,_=>{if(!m0(o,_.bounds)||(ee(Mc,p,_.halfSize),oe(Mc,Mc,_.bounds),qg(r,i,Mc)-d>c)||(ee(Mc,g,_.halfSize),oe(Mc,Mc,_.bounds),qg(r,i,Mc)-d<l))return!1;const v=_.node;return v.terminals.forAll(w=>y(w)),v.residents!==null&&v.residents.forAll(w=>y(w)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=jf(r),s=r,n=l=>{const c=this.objectToBoundingSphere(l),u=jf(c),d=i+u;return!(Hn(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=jf(l.bounds),u=i+c;if(Hn(l.bounds,s)-u*u>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return _O(r.bounds,2*-r.halfSize,tc),_O(r.bounds,2*r.halfSize,rc),_q(e.origin,e.direction,tc,rc)}_intersectsNodeWithOffset(e,r,i){return _O(r.bounds,2*-r.halfSize,tc),_O(r.bounds,2*r.halfSize,rc),i.applyToMinMax(tc,rc),_q(e.origin,e.direction,tc,rc)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||W9(i,e)}_intersectsObjectWithOffset(e,r,i){const s=this.objectToBoundingSphere(r);return!(s[3]>0)||W9(i.applyToBoundingSphere(s),e)}_forEachNode(e,r){let i=dn.acquire().init(e);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(dn.acquire().init(i).advance(n));dn.release(i)}}_forEachNodeDepthOrdered(e,r,i,s=DP.DepthOrder.FRONT_TO_BACK){let n=dn.acquire().init(e);const o=[n];for(Yke(i,s,_Z);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=_Z[a];n.node.children[l]&&o.push(dn.acquire().init(n).advance(l))}dn.release(n)}}_remove(e,r,i){Cy.clear();const s=i.advanceTo(r,(n,o)=>{Cy.push(n.node),Cy.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=Cy.length-2;n>=0;n-=2){const o=Cy.data[n],a=Cy.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Nt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const s=dn.acquire().init(e);this._add(r.getItemAt(i),s),dn.release(s)}}_grow(e,r){if(r!==0&&(gZ(e,r,i=>this.objectToBoundingSphere(i),Zp),OS(Zp[3])&&!this._fitsInsideTree(Zp)))if(this._nodeIsEmpty(this._root.node))mx(Zp,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(Zp);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(Zp,i):this._growRootAsSubNode(i),dn.release(i)}}_rebuildTree(e,r){te(Y4,r.bounds),Y4[3]=r.halfSize,gZ([e,Y4],2,s=>s,X4);const i=dn.acquire().init(this._root);this._root.initFrom(null,X4,X4[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),dn.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),u=i[l]+r-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,g=2**Math.ceil(Math.log(d+p)*Math.LOG2E);s=Math.max(s,g),vO[l].min=d,vO[l].max=p}for(let l=0;l<3;l++){let c=vO[l].min,u=vO[l].max;const d=(s-(c+u))/2;c+=Math.ceil(d),u+=Math.floor(d);const p=n[l]-o-c*o*2;q4[l]=p+(u+c)*o}const a=s*o;return q4[3]=a*sfe,dn.acquire().initFrom(null,q4,a,0)}_growRootAsSubNode(e){const r=this._root.node;te(Zp,this._root.bounds),Zp[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Zp,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&e==null;)i=s++,e=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(e){return!OS(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){var n,o;const r=e.children.map(a=>a?this._nodeToJSON(a):null),i=(n=e.residents)==null?void 0:n.map(a=>this.objectToBoundingSphere(a)),s=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:r,residents:i,terminals:s}}static fromJSON(e){const r=new DP(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},dn=class jb{constructor(){this.bounds=ss(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,s=this.depth){return this.node=e??jb.createEmptyNode(),r!=null&&mx(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*sfe}advance(e){let r=this.node.children[e];r||(r=jb.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=ife[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Nt({shrink:!0}),residents:new Nt({shrink:!0})}}static acquire(){return jb._pool.acquire()}static release(e){jb._pool.release(e)}static clearPool(){jb._pool.prune()}};function Wke(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function qke(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function _O(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function gZ(t,e,r,i){if(e===1){const s=r(t[0]);mx(s,i)}else{tc[0]=1/0,tc[1]=1/0,tc[2]=1/0,rc[0]=-1/0,rc[1]=-1/0,rc[2]=-1/0;for(let s=0;s<e;s++){const n=r(t[s]);OS(n[3])&&(Wke(tc,n),qke(rc,n))}Pr(i,tc,rc,.5),i[3]=Math.max(rc[0]-tc[0],rc[1]-tc[1],rc[2]-tc[2])/2}}function Yke(t,e,r){if(!x_.length)for(let i=0;i<8;++i)x_.push({index:0,distance:0});for(let i=0;i<8;++i){const s=ife[i];x_.data[i].index=i,x_.data[i].distance=qg(t,e,s)}x_.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=x_.data[i].index}function W4(t,e){let r,i=1/0;for(let s=0;s<8;++s){const n=qg(t,e,yZ[s]);n<i&&(i=n,r=yZ[s])}return r}function qg(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function OS(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}dn._pool=new po(dn),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(ez||(ez={}));const ife=[Ce(-1,-1,-1),Ce(1,-1,-1),Ce(-1,1,-1),Ce(1,1,-1),Ce(-1,-1,1),Ce(1,-1,1),Ce(-1,1,1),Ce(1,1,1)],yZ=[Ce(-1,-1,-1),Ce(-1,-1,1),Ce(-1,1,-1),Ce(-1,1,1),Ce(1,-1,-1),Ce(1,-1,1),Ce(1,1,-1),Ce(1,1,1)],sfe=Math.sqrt(3),tz=[null];function Xke(t){return tz[0]=t,tz}const q4=ss(),Mc=C(),tc=C(),rc=C(),Cy=new Nt,Zke=ss(),Zp=ss(),Y4=ss(),X4=ss(),vO=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],x_=new Nt,_Z=[0,0,0,0,0,0,0,0],zh=ez;var C0;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(C0||(C0={}));let nfe=class extends fA{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=Wi.Layer,this.events=new ys,this.sliceable=!1,this._objects=new Nt,this._objectsAdded=new Nt,this._handles=new Oi,this.apiLayerUid=i,this.visible=(r==null?void 0:r.visible)??!0,this.pickable=(r==null?void 0:r.pickable)??!0,this.updatePolicy=(r==null?void 0:r.updatePolicy)??C0.ASYNC,this._disableOctree=(r==null?void 0:r.disableOctree)??!1,e.add(this);for(const s of Hke)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==C0.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new zh(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Oe(this._octree),this._objectsAdded.clear()}};function j$(t){return t!=null&&t.type===Wi.Layer}var Tu,j1;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Tu||(Tu={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(j1||(j1={}));let Nn=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.transparencyPassType=Ze.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Tu.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=j1.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};h([D({count:L.COUNT})],Nn.prototype,"output",void 0),h([D({count:Ze.COUNT})],Nn.prototype,"transparencyPassType",void 0),h([D()],Nn.prototype,"occluder",void 0),h([D()],Nn.prototype,"hasSlicePlane",void 0),h([D()],Nn.prototype,"writeDepth",void 0),h([D({count:Tu.COUNT})],Nn.prototype,"space",void 0),h([D()],Nn.prototype,"hideOnShortSegments",void 0),h([D()],Nn.prototype,"hasCap",void 0),h([D({count:j1.COUNT})],Nn.prototype,"anchor",void 0),h([D()],Nn.prototype,"hasTip",void 0),h([D()],Nn.prototype,"vvSize",void 0),h([D()],Nn.prototype,"vvColor",void 0),h([D()],Nn.prototype,"vvOpacity",void 0),h([D()],Nn.prototype,"hasOccludees",void 0),h([D()],Nn.prototype,"hasMultipassTerrain",void 0),h([D()],Nn.prototype,"cullAboveGround",void 0),h([D({constValue:!0})],Nn.prototype,"hasVvInstancing",void 0),h([D({constValue:!0})],Nn.prototype,"hasSliceTranslatedView",void 0);const vZ=8;function ofe(t,e){const r=t.vertex;r.uniforms.add(new Se("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(S.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Mt("vvSizeMinSize",i=>i.vvSize.minSize),new Mt("vvSizeMaxSize",i=>i.vvSize.maxSize),new Mt("vvSizeOffset",i=>i.vvSize.offset),new Mt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(b`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(S.SIZE,"float"),r.code.add(b`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(S.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new za("vvOpacityValues",i=>i.vvOpacity.values,vZ),new za("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,vZ)),r.code.add(b`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(b`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(E0,e),t.attributes.add(S.COLORFEATUREATTRIBUTE,"float"),r.code.add(b`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(S.COLOR,"vec4"),r.code.add(b`vec4 getColor(){
return applyOpacity(color);
}`))}function dm(t,e){switch(t.fragment.include(Ll),e.output){case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:t.fragment.code.add(b`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case L.Depth:t.fragment.code.add(b`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}let afe=class{constructor(e){this._rctx=e,this._cache=new Map}destroy(){this._cache.forEach(e=>Ue(e.stippleTexture)),this._cache.clear()}_acquire(e){if(e==null)return null;const r=this._patternId(e),i=this._cache.get(r);if(i)return i.refCount++,i;const{encodedData:s,paddedPixels:n}=Qke(e),o=new xr;o.internalFormat=Pt.RGBA,o.width=n,o.height=1,o.wrapMode=Ot.CLAMP_TO_EDGE;const a=new Jke(new bt(this._rctx,o,s));return this._cache.set(r,a),a}release(e){if(e==null)return;const r=this._patternId(e),i=this._cache.get(r);i&&(i.refCount--,i.refCount===0&&(i.stippleTexture!=null&&i.stippleTexture.dispose(),this._cache.delete(r)))}swap(e,r){const i=this._acquire(r);return this.release(e),i}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}},Jke=class extends Ar{constructor(e){super(),this.stippleTexture=e,this.refCount=1}};function Qke(t){const e=rG(t),r=1/t.pixelRatio,i=lfe(t),s=cfe(t),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const g of e){for(let y=0;y<g;y++){const _=a*(Math.min(y,g-1-y)+.5)*r/n*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=i+ufe,d=new Uint8Array(4*u);let p=4;for(const g of c)vC(g,d,p),p+=4;return d.copyWithin(0,p-4,p),d.copyWithin(p,4,8),{encodedData:d,paddedPixels:u}}function rG(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function lfe(t){if(t==null)return 1;const e=rG(t);return Math.floor(e.reduce((r,i)=>r+i))}function cfe(t){return rG(t).reduce((e,r)=>Math.max(e,r))}const ufe=2;function Kke(t){return t==null?gp:t.length===4?t:oi(eBe,t[0],t[1],t[2],1)}const eBe=Ht();function hfe(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?tBe(t,e):rBe(t)}function tBe(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:s}=t;s.include(Ll),e.draped||(td(i,e),i.uniforms.add(new Se("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(b`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(b`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${sBe};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(b`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(b`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),i.uniforms.add(new Se("pixelRatio",(n,o)=>o.camera.pixelRatio)),i.code.add(b`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?b`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",ufe),s.uniforms.add(new We("stipplePatternTexture",n=>n.stippleTexture)),s.uniforms.add(new Se("stipplePatternSDFNormalizer",n=>iBe(n.stipplePattern)),new Se("stipplePatternPixelSizeInv",n=>1/iG(n))),s.code.add(b`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),s.code.add(b`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?b`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:b`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?b`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?b`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:b`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?b`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:b`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(s.uniforms.add(new Wt("stippleOffColor",n=>Kke(n.stippleOffColor))),s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function rBe(t){t.fragment.code.add(b`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function iBe(t){return t!=null?(Math.floor(.5*(cfe(t)-1))+.5)/t.pixelRatio:1}function iG(t){const e=t.stipplePattern;return e!=null?lfe(t.stipplePattern)/e.pixelRatio:1}const sBe=b.float(.4),CC=64,sG=CC/2,dfe=sG/5,nBe=CC/dfe,oBe=.25;function aBe(t,e){return t.fromData(`${e}-marker`,()=>ude(e,CC,sG,dfe))}function pfe(t,e){const r=t.vertex;t.constants.add("markerSizePerLineWidth","float",nBe),r.uniforms.add(new Se("pixelRatio",(i,s)=>s.camera.pixelRatio)),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(b`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Tu.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Se("perRenderPixelRatio",(i,s)=>s.camera.perRenderPixelRatio)),r.code.add(b`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var Su;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Su||(Su={}));let Ei=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.capType=Su.BUTT,this.transparencyPassType=Ze.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};h([D({count:L.COUNT})],Ei.prototype,"output",void 0),h([D({count:Su.COUNT})],Ei.prototype,"capType",void 0),h([D({count:Ze.COUNT})],Ei.prototype,"transparencyPassType",void 0),h([D()],Ei.prototype,"occluder",void 0),h([D()],Ei.prototype,"hasSlicePlane",void 0),h([D()],Ei.prototype,"hasPolygonOffset",void 0),h([D()],Ei.prototype,"writeDepth",void 0),h([D()],Ei.prototype,"draped",void 0),h([D()],Ei.prototype,"stippleEnabled",void 0),h([D()],Ei.prototype,"stippleOffColorEnabled",void 0),h([D()],Ei.prototype,"stippleScaleWithLineWidth",void 0),h([D()],Ei.prototype,"stipplePreferContinuous",void 0),h([D()],Ei.prototype,"roundJoins",void 0),h([D()],Ei.prototype,"applyMarkerOffset",void 0),h([D()],Ei.prototype,"vvSize",void 0),h([D()],Ei.prototype,"vvColor",void 0),h([D()],Ei.prototype,"vvOpacity",void 0),h([D()],Ei.prototype,"falloffEnabled",void 0),h([D()],Ei.prototype,"innerColorEnabled",void 0),h([D()],Ei.prototype,"hasOccludees",void 0),h([D()],Ei.prototype,"hasMultipassTerrain",void 0),h([D()],Ei.prototype,"cullAboveGround",void 0),h([D()],Ei.prototype,"wireframe",void 0),h([D({constValue:!0})],Ei.prototype,"stippleRequiresClamp",void 0),h([D({constValue:!0})],Ei.prototype,"stippleRequiresStretchMeasure",void 0),h([D({constValue:!0})],Ei.prototype,"hasVvInstancing",void 0),h([D({constValue:!0})],Ei.prototype,"hasSliceTranslatedView",void 0),h([D()],Ei.prototype,"objectAndLayerIdColorInstanced",void 0);const H$=1;function lBe(t){const e=new ur,{vertex:r,fragment:i}=e,s=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha);e.include(uA),e.include(ofe,t),e.include(hfe,t);const n=t.applyMarkerOffset&&!t.draped;n&&(r.uniforms.add(new Se("markerScale",g=>g.markerScale)),e.include(pfe,{space:Tu.World})),t.output===L.Depth&&e.include(dm,t),e.include(bA,t),Pl(r,t),r.uniforms.add(new wi("inverseProjectionMatrix",(g,y)=>y.camera.inverseProjectionMatrix),new mr("nearFar",(g,y)=>y.camera.nearFar),new Se("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new Wt("viewport",(g,y)=>y.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(S.POSITION,"vec3"),e.attributes.add(S.SUBDIVISIONFACTOR,"float"),e.attributes.add(S.UV0,"vec2"),e.attributes.add(S.AUXPOS1,"vec3"),e.attributes.add(S.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),z0(e),s&&e.varyings.add("depth","float");const o=t.capType===Su.ROUND,a=t.stippleEnabled&&t.stippleScaleWithLineWidth||o;a&&e.varyings.add("vLineWidth","float");const l=t.stippleEnabled&&t.stippleScaleWithLineWidth;l&&e.varyings.add("vLineSizeInv","float");const c=t.innerColorEnabled||o;c&&e.varyings.add("vLineDistance","float");const u=t.stippleEnabled&&o,d=t.falloffEnabled||u;d&&e.varyings.add("vLineDistanceNorm","float"),o&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(b`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),NL(e),r.code.add(b`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new Se("pixelRatio",(g,y)=>y.camera.pixelRatio)),r.code.add(b`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?b`vLineWidth = lineWidth;`:""}
      ${l?b`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(b`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(b`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||o)&&r.code.add(b`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?b`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(b`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(b`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?b`min(1.0, subdivisionFactor * ${b.float((H$+2)/(H$+1))})`:b`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(b`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=t.capType!==Su.BUTT;return r.code.add(b`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?b`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(b`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?b`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?b`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?b`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&r.code.add(b`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Se("worldToScreenRatio",(g,y)=>1/y.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(b`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(b`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Se("stipplePatternPixelSize",g=>iG(g))),r.code.add(b`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(b`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(Tc,t),e.include(rs,t),i.include(zp),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(b`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&i.code.add(b`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${b.float(Gn)}) {
        discard;
      }
    `),u?i.code.add(b`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${b.float(Gn)}, stippleCoverage);
      `):i.code.add(b`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new Wt("intrinsicColor",g=>g.color)),t.output!==L.ObjectAndLayerIdColor&&i.code.add(b`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(b`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new Wt("innerColor",g=>g.innerColor??g.color),new Se("innerWidth",(g,y)=>g.innerWidth*y.camera.pixelRatio)),i.code.add(b`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(b`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Se("falloff",g=>g.falloff)),i.code.add(b`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(b`
    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(Gn)}) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Color&&t.transparencyPassType===Ze.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===L.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""}
    ${t.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const cBe=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:H$,build:lBe},Symbol.toStringTag,{value:"Module"})),nG={func:Br.LESS},W$={func:Br.ALWAYS},Mp={mask:255},ffe={mask:0},uBe=t=>({function:{func:Br.NOTEQUAL,ref:t,mask:t},operation:{fail:is.KEEP,zFail:is.KEEP,zPass:is.KEEP}}),hBe=t=>({function:{func:Br.ALWAYS,ref:t,mask:t},operation:{fail:is.KEEP,zFail:is.KEEP,zPass:is.REPLACE}}),sy={function:{func:Br.ALWAYS,ref:ja.OutlineVisualElementMask,mask:ja.OutlineVisualElementMask},operation:{fail:is.KEEP,zFail:is.KEEP,zPass:is.ZERO}},Y0={function:{func:Br.ALWAYS,ref:ja.OutlineVisualElementMask,mask:ja.OutlineVisualElementMask},operation:{fail:is.KEEP,zFail:is.KEEP,zPass:is.REPLACE}},mfe={function:{func:Br.EQUAL,ref:ja.OutlineVisualElementMask,mask:ja.OutlineVisualElementMask},operation:{fail:is.KEEP,zFail:is.KEEP,zPass:is.KEEP}},gfe={function:{func:Br.NOTEQUAL,ref:ja.OutlineVisualElementMask,mask:ja.OutlineVisualElementMask},operation:{fail:is.KEEP,zFail:is.KEEP,zPass:is.KEEP}},yfe=new Map([[S.POSITION,0],[S.SUBDIVISIONFACTOR,1],[S.UV0,2],[S.AUXPOS1,3],[S.AUXPOS2,4],[S.COLOR,5],[S.COLORFEATUREATTRIBUTE,5],[S.SIZE,6],[S.SIZEFEATUREATTRIBUTE,6],[S.OPACITYFEATUREATTRIBUTE,7],[S.OBJECTANDLAYERIDCOLOR,8]]);let _fe=class vfe extends gr{initializeProgram(e){return new pr(e.rctx,vfe.shader.get().build(this.configuration),yfe)}_makePipelineState(e,r){const i=this.configuration,s=e===Ze.NONE,n=e===Ze.FrontFace;return xt({blending:i.output===L.Color||i.output===L.Alpha?s?gc:Om(e):null,depthTest:{func:iy(e)},depthWrite:s?i.writeDepth?Ya:null:oD(e),colorWrite:$t,stencilWrite:i.hasOccludees?Mp:null,stencilTest:i.hasOccludees?r?Y0:sy:null,polygonOffset:s||n?i.hasPolygonOffset?bZ:null:lD})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?bZ:null;this._occluderPipelineTransparent=xt({blending:gc,polygonOffset:r,depthTest:W$,depthWrite:null,colorWrite:$t,stencilWrite:null,stencilTest:gfe}),this._occluderPipelineOpaque=xt({blending:gc,polygonOffset:r,depthTest:W$,depthWrite:null,colorWrite:$t,stencilWrite:ffe,stencilTest:mfe}),this._occluderPipelineMaskWrite=xt({blending:null,polygonOffset:r,depthTest:nG,depthWrite:null,colorWrite:null,stencilWrite:Mp,stencilTest:Y0})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?vt.LINES:vt.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===ae.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ae.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};_fe.shader=new dr(cBe,()=>he(()=>import("./RibbonLine.glsl-c52283c4.js"),[]));const bZ={factor:0,units:-4};var ul;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(ul||(ul={}));let bw=class extends ry{constructor(e){super(e,new pBe),this._configuration=new Ei,this._vertexAttributeLocations=yfe}isClosed(e,r){return wfe(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===ae.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==L.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&mBe(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===_i.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(S.POSITION).data,l=e.vertexAttributes.get(S.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.vertexAttributes.get(S.SIZEFEATUREATTRIBUTE).data[0];c*=me(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],d=s[1],p=(c/2+4)*e.screenToWorldRatio;let g=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],T=u-v,x=d-w,E=a[_+3]-v,O=a[_+4]-w,A=me((E*T+O*x)/(E*E+O*O),0,1),$=E*A-T,M=O*A-x,U=$*$+M*M;U<g&&(g=U,y=_/3)}g<p*p&&n(o.dist,o.normal,y,!1)}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!Nle(r))return void ne.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(S.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const T=a.get(S.SIZEFEATUREATTRIBUTE).data[0];c*=me(this.parameters.vvSize.offset[0]+T*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(S.SIZE)&&(c*=a.get(S.SIZE).data[0]);const u=i.camera,d=gBe;Vs(d,i.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;se(sT[0],d[0]-p,d[1]+p,0),se(sT[1],d[0]+p,d[1]+p,0),se(sT[2],d[0]+p,d[1]-p,0),se(sT[3],d[0]-p,d[1]-p,0);for(let T=0;T<4;T++)if(!u.unprojectFromRenderScreen(sT[T],Jp[T]))return;Io(u.eye,Jp[0],Jp[1],J4),Io(u.eye,Jp[1],Jp[2],Q4),Io(u.eye,Jp[2],Jp[3],K4),Io(u.eye,Jp[3],Jp[0],e5);let g=Number.MAX_VALUE,y=0;const _=bfe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let T=0;T<_;T+=3){ba[0]=l[T]+r[12],ba[1]=l[T+1]+r[13],ba[2]=l[T+2]+r[14];const x=(T+3)%l.length;if(wa[0]=l[x]+r[12],wa[1]=l[x+1]+r[13],wa[2]=l[x+2]+r[14],Kr(J4,ba)<0&&Kr(J4,wa)<0||Kr(Q4,ba)<0&&Kr(Q4,wa)<0||Kr(K4,ba)<0&&Kr(K4,wa)<0||Kr(e5,ba)<0&&Kr(e5,wa)<0)continue;if(u.projectToRenderScreen(ba,Oy),u.projectToRenderScreen(wa,Ry),Oy[2]<0&&Ry[2]>0){le(yd,ba,wa);const O=u.frustum,A=-Kr(O[Qr.NEAR],ba)/pe(yd,O[Qr.NEAR]);ee(yd,yd,A),oe(ba,ba,yd),u.projectToRenderScreen(ba,Oy)}else if(Oy[2]>0&&Ry[2]<0){le(yd,wa,ba);const O=u.frustum,A=-Kr(O[Qr.NEAR],wa)/pe(yd,O[Qr.NEAR]);ee(yd,yd,A),oe(wa,wa,yd),u.projectToRenderScreen(wa,Ry)}else if(Oy[2]<0&&Ry[2]<0)continue;Oy[2]=0,Ry[2]=0;const E=KB(o1(Oy,Ry,TZ),d);E<g&&(g=E,te(wZ,ba),te(xZ,wa),y=T/3)}const v=i.rayBegin,w=i.rayEnd;if(g<p*p){let T=Number.MAX_VALUE;if(Koe(o1(wZ,xZ,TZ),o1(v,w,yBe),Ay)){le(Ay,Ay,v);const x=Te(Ay);ee(Ay,Ay,1/x),T=x/ei(v,w)}o(T,Ay,y,!1)}}get _layout(){const e=Ri().vec3f(S.POSITION).f32(S.SUBDIVISIONFACTOR).vec2f(S.UV0).vec3f(S.AUXPOS1).vec3f(S.AUXPOS2);return this.parameters.vvSize?e.f32(S.SIZEFEATUREATTRIBUTE):e.f32(S.SIZE),this.parameters.vvColor?e.f32(S.COLORFEATUREATTRIBUTE):e.vec4f(S.COLOR),this.parameters.vvOpacity&&e.f32(S.OPACITYFEATUREATTRIBUTE),ie("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(S.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new fBe(this._layout,this.parameters)}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth||r===L.ObjectAndLayerIdColor?e===ae.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===_i.OccludeAndTransparentStencil?e===ae.OPAQUE_MATERIAL||e===ae.OCCLUDER_MATERIAL||e===ae.TRANSPARENT_OCCLUDER_MATERIAL:r===L.Color||r===L.Alpha?e===(this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ae.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new dBe(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},dBe=class extends ey{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(_fe,e)}},pBe=class extends xA{constructor(){super(...arguments),this.width=0,this.color=fu,this.join="miter",this.cap=Su.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},fBe=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=H$+i}}_isClosed(e){return bfe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(S.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,r,i,s,n){var j;const o=_Be,a=vBe,l=bBe,c=i.vertexAttributes.get(S.POSITION).data,u=i.indices&&i.indices.get(S.POSITION),d=(j=i.vertexAttributes.get(S.DISTANCETOSTART))==null?void 0:j.data;u&&u.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,g=0;this._parameters.vvSize?g=i.vertexAttributes.get(S.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(S.SIZE)&&(p=i.vertexAttributes.get(S.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColor?_=i.vertexAttributes.get(S.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(S.COLOR)&&(y=i.vertexAttributes.get(S.COLOR).data);const v=ie("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let w=0;this._parameters.vvOpacity&&(w=i.vertexAttributes.get(S.OPACITYFEATUREATTRIBUTE).data[0]);const T=c.length/3,x=new Float32Array(s.buffer),E=ie("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,O=this.vertexBufferLayout.stride/4;let A=n*O;const $=A;let M=0;const U=d?(Z,R,I)=>M=d[I]:(Z,R,I)=>M+=ei(Z,R),k=ie("enable-feature:objectAndLayerId-rendering"),B=(Z,R,I,N,V,q,J)=>{if(x[A++]=R[0],x[A++]=R[1],x[A++]=R[2],x[A++]=N,x[A++]=J,x[A++]=V,x[A++]=Z[0],x[A++]=Z[1],x[A++]=Z[2],x[A++]=I[0],x[A++]=I[1],x[A++]=I[2],x[A++]=this._parameters.vvSize?g:p,this._parameters.vvColor)x[A++]=_;else{const K=Math.min(4*q,y.length-4);x[A++]=y[K],x[A++]=y[K+1],x[A++]=y[K+2],x[A++]=y[K+3]}this._parameters.vvOpacity&&(x[A++]=w),k&&(v!=null&&(E[4*A]=v[0],E[4*A+1]=v[1],E[4*A+2]=v[2],E[4*A+3]=v[3]),A++)};A+=O,se(a,c[0],c[1],c[2]),e&&De(a,a,e);const z=this._isClosed(i);if(z){const Z=c.length-3;se(o,c[Z],c[Z+1],c[Z+2]),e&&De(o,o,e)}else se(l,c[3],c[4],c[5]),e&&De(l,l,e),B(a,a,l,1,ul.LEFT_CAP_START,0,0),B(a,a,l,1,ul.RIGHT_CAP_START,0,0),te(o,a),te(a,l);const Y=z?0:1,W=z?T:T-1;for(let Z=Y;Z<W;Z++){const R=(Z+1)%T*3;se(l,c[R],c[R+1],c[R+2]),e&&De(l,l,e),U(o,a,Z),B(o,a,l,0,ul.LEFT_JOIN_END,Z,M),B(o,a,l,0,ul.RIGHT_JOIN_END,Z,M);const I=this.numJoinSubdivisions;for(let N=0;N<I;++N){const V=(N+1)/(I+1);B(o,a,l,V,ul.LEFT_JOIN_END,Z,M),B(o,a,l,V,ul.RIGHT_JOIN_END,Z,M)}B(o,a,l,1,ul.LEFT_JOIN_START,Z,M),B(o,a,l,1,ul.RIGHT_JOIN_START,Z,M),te(o,a),te(a,l)}z?(se(l,c[3],c[4],c[5]),e&&De(l,l,e),M=U(o,a,W),B(o,a,l,0,ul.LEFT_JOIN_END,Y,M),B(o,a,l,0,ul.RIGHT_JOIN_END,Y,M)):(M=U(o,a,W),B(o,a,a,0,ul.LEFT_CAP_END,W,M),B(o,a,a,0,ul.RIGHT_CAP_END,W,M)),Z4(x,$+O,x,$,O),A=Z4(x,A-O,x,A,O),this._parameters.wireframe&&this._addWireframeVertices(s,$,A,O)}_addWireframeVertices(e,r,i,s){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=Z4(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function Z4(t,e,r,i,s){for(let n=0;n<s;n++)r[i++]=t[e++];return i}function bfe(t,e,r){return wfe(t,e.get(S.POSITION).data,r?r.get(S.POSITION):null)}function wfe(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function mBe(t){return t.anchor===j1.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const ba=C(),wa=C(),yd=C(),Ay=C(),gBe=C(),Oy=mo(),Ry=mo(),wZ=C(),xZ=C(),TZ=id(),yBe=id(),_Be=C(),vBe=C(),bBe=C(),sT=[mo(),mo(),mo(),mo()],Jp=[C(),C(),C(),C()],J4=_r(),Q4=_r(),K4=_r(),e5=_r();let oG=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Rl()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const u=G$(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(le(Rn,e,r.vec3),Rn[0]=Math.abs(Rn[0]),Rn[1]=Math.abs(Rn[1]),Rn[2]=Math.abs(Rn[2]),Rn[0]<c&&Rn[1]<c&&Rn[2]<c){if(l){const u=Math.max(...Rn);if(le(Rn,e,l.vec3),Rn[0]=Math.abs(Rn[0]),Rn[1]=Math.abs(Rn[1]),Rn[2]=Math.abs(Rn[2]),Math.max(...Rn)<u)return l}return r}return l||(l=G$(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Ct(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new bw({width:2,color:r}),s.add(this._material);const g=new nfe(s,{pickable:!1}),y=new Rm({castShadow:!1});s.add(y),g.add(y),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,d=.5*this._gridSize;for(let g=0;g<l;g++)c[3*g]=e[0]+(1&a[g]?d:-d),c[3*g+1]=e[1]+(2&a[g]?d:-d),c[3*g+2]=e[2]+(4&a[g]?d:-d),g>0&&u.push(g-1,g);Xi(c,this._originSR,0,c,i.renderSpatialReference,0,l);const p=new Rs(this._material,[[S.POSITION,new Le(c,3,!0)]],[[S.POSITION,u]],null,Wi.Line);s.add(p),o.addGeometry(p)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const Rn=C();let xfe=class{constructor(e,r,i,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new ot,this.output=L.Color,this.renderOccludedMask=SZ,this.bindParameters=new DL(r,i,s!=null?s.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=SZ}},wBe=class extends xfe{constructor(e,r,i,s,n){super(e,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}};const SZ=_i.Occlude|_i.OccludeAndTransparent|_i.OccludeAndTransparentStencil;let RS=class extends ot{constructor(){super(...arguments),this._projectionMatrix=xe()}get projectionMatrix(){return this._projectionMatrix}};h([f()],RS.prototype,"_projectionMatrix",void 0),h([f({readOnly:!0})],RS.prototype,"projectionMatrix",null),RS=h([F("esri.views.3d.webgl-engine.lib.CascadeCamera")],RS);let q$=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};var zx;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(zx||(zx={}));let bO=class{constructor(){this.camera=new RS,this.lightMat=xe()}},xBe=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1,this.textureSizeModLowQuality=.45,this.splitSchemeLambda=0}},aG=class{get depthTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return oi(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._renderHighQuality=!0,this.settings=new xBe,this._projectionView=xe(),this._projectionViewInverse=xe(),this._modelViewLight=xe(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Ht(),this._cascades=[new bO,new bO,new bO,new bO],this._lastOrigin=null,this._maxTextureSize=Math.min(ie("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=me(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)r5[e]=this._cascades[e];return r5.length=this._numCascades,r5}start(e,r,i,s){He(this.enabled),this._renderHighQuality=s,this._textureSize=this._computeTextureSize(e),this._ensureDepthTexture();const{near:n,far:o}=this._clampNearFar(i);this._computeCascadeDistances(o,n),this._setupMatrices(e,r);const{viewMatrix:a,projectionMatrix:l}=e;for(let c=0;c<this._numCascades;++c)this._constructCascade(c,l,a,r);this._lastOrigin=null,this.clear()}finish(e){He(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!ca(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||C(),te(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Wa(PZ,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)MZ[16*r+i]=PZ[i]}}return MZ}takeCascadeSnapshotTo(e,r){He(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,bt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(ji.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,bt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(mi.COLOR_BUFFER_BIT|mi.DEPTH_BUFFER_BIT)}_computeTextureSize(e){const r=Math.max(e.fullWidth,e.fullHeight)*window.devicePixelRatio/e.pixelRatio,i=this._renderHighQuality?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,s=Math.floor(Math.min(this._maxTextureSize,(this.numCascades===1?1:2)*r)*i);return Math.min(s,this._rctx.parameters.maxTextureSize)}_ensureDepthTexture(){if(this.depthTexture&&this.depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e=new xr(this._textureSize);e.wrapMode=Ot.CLAMP_TO_EDGE,e.samplingMode=wt.NEAREST,this._fbo=new As(this._rctx,e,new q$(xs.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(e){let r=this._snapshots[e];if(r!=null&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i=new xr;return i.wrapMode=Ot.CLAMP_TO_EDGE,i.samplingMode=wt.NEAREST,i.width=this._textureSize,i.height=this._textureSize,r=new bt(this._rctx,i),this._snapshots[e]=r,r}_discardDepthTexture(){this._fbo=Ue(this._fbo)}_discardSnapshot(e){this._snapshots[e]=Ue(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);He(l<c);for(let g=0;g<8;++g){oi(EZ,g%4==0||g%4==3?-1:1,g%4==0||g%4==1?-1:1,g<4?l:c,1);const y=iu[g];uc(y,EZ,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}zo(t5,iu[0]),n.camera.viewMatrix=Wa(TBe,this._modelViewLight,t5);for(let g=0;g<8;++g)De(iu[g],iu[g],n.camera.viewMatrix);let u=iu[0][2],d=iu[0][2];for(let g=1;g<8;++g)u=Math.min(u,iu[g][2]),d=Math.max(d,iu[g][2]);u-=200,d+=200,n.camera.near=-d,n.camera.far=-u,ABe(i,s,u,d,n.camera),qi(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const p=this._textureSize/(this.numCascades===1?1:2);n.camera.viewport=[e%2==0?0:p,Math.floor(e/2)===0?0:p,p,p]}_setupMatrices(e,r){qi(this._projectionView,e.projectionMatrix,e.viewMatrix),Wn(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Re.Global?e.eye:se(t5,0,0,1);mL(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r){const i=this._renderHighQuality?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(P$e(e/r,4)),i);const s=(e-r)/this._numCascades,n=(e/r)**(1/this._numCascades);let o=r,a=r;for(let l=0;l<this._numCascades+1;++l)this._cascadeDistances[l]=_t(o,a,this.settings.splitSchemeLambda),o*=n,a+=s}get gpuMemoryUsage(){var e;return this._snapshots.reduce((r,i)=>r+N1(i),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}};const TBe=xe(),EZ=Ht(),iu=[];for(let t=0;t<8;++t)iu.push(Ht());const CZ=Ie(),AZ=Ie(),SBe=Ie(),OZ=Ie(),RZ=Ie(),t5=C(),r5=[],PZ=xe(),MZ=new Array(64),kl=Ie(),Bv=Ie(),Py=[Ie(),Ie(),Ie(),Ie()],Gs=Ie(),i5=Ie(),eg=Ie(),nT=Ie(),Vv=Ie(),Gv=Ie(),wO=Ie();function EBe(t,e,r,i,s,n,o,a){Qt(kl,0,0);for(let O=0;O<4;++O)Ch(kl,kl,t[O]);Tl(kl,kl,.25),Qt(Bv,0,0);for(let O=4;O<8;++O)Ch(Bv,Bv,t[O]);Tl(Bv,Bv,.25),au(Py[0],t[4],t[5],.5),au(Py[1],t[5],t[6],.5),au(Py[2],t[6],t[7],.5),au(Py[3],t[7],t[4],.5);let l=0,c=n$(Py[0],kl);for(let O=1;O<4;++O){const A=n$(Py[O],kl);A<c&&(c=A,l=O)}ip(Gs,Py[l],t[l+4]);const u=Gs[0];let d,p;Gs[0]=-Gs[1],Gs[1]=u,ip(i5,Bv,kl),Is(i5,Gs)<0&&y7(Gs,Gs),au(Gs,Gs,i5,r),cC(Gs,Gs),d=p=Is(ip(eg,t[0],kl),Gs);for(let O=1;O<8;++O){const A=Is(ip(eg,t[O],kl),Gs);A<d?d=A:A>p&&(p=A)}Vs(i,kl),Tl(eg,Gs,d-e),Ch(i,i,eg);let g=-1,y=1,_=0,v=0;for(let O=0;O<8;++O){ip(nT,t[O],i),cC(nT,nT);const A=Gs[0]*nT[1]-Gs[1]*nT[0];A>0?A>g&&(g=A,_=O):A<y&&(y=A,v=O)}Tv(g>0,"leftArea"),Tv(y<0,"rightArea"),Tl(Vv,Gs,d),Ch(Vv,Vv,kl),Tl(Gv,Gs,p),Ch(Gv,Gv,kl),wO[0]=-Gs[1],wO[1]=Gs[0];const w=C3(i,t[v],Gv,Ch(eg,Gv,wO),1,s),T=C3(i,t[_],Gv,eg,1,n),x=C3(i,t[_],Vv,Ch(eg,Vv,wO),1,o),E=C3(i,t[v],Vv,eg,1,a);Tv(w,"rayRay"),Tv(T,"rayRay"),Tv(x,"rayRay"),Tv(E,"rayRay")}function ar(t,e){return 3*e+t}const $Z=Ie();function Ka(t,e){return Qt($Z,t[e],t[e+3]),$Z}const xa=Ie(),Ve=Zi();function CBe(t,e,r,i,s){ip(xa,r,i),Tl(xa,xa,.5),Ve[0]=xa[0],Ve[1]=xa[1],Ve[2]=0,Ve[3]=xa[1],Ve[4]=-xa[0],Ve[5]=0,Ve[6]=xa[0]*xa[0]+xa[1]*xa[1],Ve[7]=xa[0]*xa[1]-xa[1]*xa[0],Ve[8]=1,Ve[ar(0,2)]=-Is(Ka(Ve,0),t),Ve[ar(1,2)]=-Is(Ka(Ve,1),t);let n=Is(Ka(Ve,0),r)+Ve[ar(0,2)],o=Is(Ka(Ve,1),r)+Ve[ar(1,2)],a=Is(Ka(Ve,0),i)+Ve[ar(0,2)],l=Is(Ka(Ve,1),i)+Ve[ar(1,2)];n=-(n+a)/(o+l),Ve[ar(0,0)]+=Ve[ar(1,0)]*n,Ve[ar(0,1)]+=Ve[ar(1,1)]*n,Ve[ar(0,2)]+=Ve[ar(1,2)]*n,n=1/(Is(Ka(Ve,0),r)+Ve[ar(0,2)]),o=1/(Is(Ka(Ve,1),r)+Ve[ar(1,2)]),Ve[ar(0,0)]*=n,Ve[ar(0,1)]*=n,Ve[ar(0,2)]*=n,Ve[ar(1,0)]*=o,Ve[ar(1,1)]*=o,Ve[ar(1,2)]*=o,Ve[ar(2,0)]=Ve[ar(1,0)],Ve[ar(2,1)]=Ve[ar(1,1)],Ve[ar(2,2)]=Ve[ar(1,2)],Ve[ar(1,2)]+=1,n=Is(Ka(Ve,1),e)+Ve[ar(1,2)],o=Is(Ka(Ve,2),e)+Ve[ar(2,2)],a=Is(Ka(Ve,1),r)+Ve[ar(1,2)],l=Is(Ka(Ve,2),r)+Ve[ar(2,2)],n=-.5*(n/o+a/l),Ve[ar(1,0)]+=Ve[ar(2,0)]*n,Ve[ar(1,1)]+=Ve[ar(2,1)]*n,Ve[ar(1,2)]+=Ve[ar(2,2)]*n,n=Is(Ka(Ve,1),e)+Ve[ar(1,2)],o=Is(Ka(Ve,2),e)+Ve[ar(2,2)],a=-o/n,Ve[ar(1,0)]*=a,Ve[ar(1,1)]*=a,Ve[ar(1,2)]*=a,s[0]=Ve[0],s[1]=Ve[1],s[2]=0,s[3]=Ve[2],s[4]=Ve[3],s[5]=Ve[4],s[6]=0,s[7]=Ve[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Ve[6],s[13]=Ve[7],s[14]=0,s[15]=Ve[8]}function ABe(t,e,r,i,s){const n=1/iu[0][3],o=1/iu[4][3];He(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(rn(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,EBe(iu,a,l,CZ,AZ,SBe,OZ,RZ),CBe(CZ,AZ,OZ,RZ,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function OBe(t){return nd(t)&&t.intersector===Ai.TERRAIN&&!!t.target}let RBe=class extends HL{constructor(e,r,i){super(e,r),this.triangleNr=i}};function Tfe(t){return nd(t)&&t.intersector===Ai.OVERLAY&&!!t.target}let rz=class{constructor(){this.adds=new Nt,this.removes=new Nt,this.updates=new Nt({allocator:e=>e||new PBe,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},PBe=class{},MBe=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Mi,Ys;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Mi||(Mi={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Ys||(Ys={}));function Sfe(t){const e=new Map,r=i=>{let s=e.get(i);return s||(s=new MBe,e.set(i,s)),s};return t.removes.forAll(i=>{s5(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{s5(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{s5(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function s5(t){return t.geometry.indexCount>=1}let Efe=class Cfe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=Cfe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return br.createIndex(this._rctx,hr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,gt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(vt.POINTS,1,Ye.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},Afe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(e)===Hf.LOADED)return s;this._repository.requestRender()}return null}};function AA(t,e){switch(e.normalType){case fr.Compressed:t.attributes.add(S.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(b`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case fr.Attribute:t.attributes.add(S.NORMAL,"vec3"),t.vertex.code.add(b`vec3 normalModel() {
return normal;
}`);break;case fr.ScreenDerivative:t.fragment.code.add(b`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case fr.COUNT:case fr.Ground:}}var fr;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(fr||(fr={}));function _D(t,e){switch(e.normalType){case fr.Attribute:case fr.Compressed:t.include(AA,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new uC("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new kp("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(b`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case fr.Ground:t.include(Lw,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(b`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?b`normalize(vPositionWorldCameraRelative);`:b`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case fr.ScreenDerivative:t.vertex.code.add(b`void forwardNormal() {}`);break;default:e.normalType;case fr.COUNT:}}let Ofe=class extends Fce{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Zi()}},Rfe=class extends Uce{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Zi(),this.toMapSpace=Ht()}},iz=class extends Rfe{constructor(e=C()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},v2=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(S.POSITION).length}write(e,r,i,s,n){sde(i,this.vertexBufferLayout,e,r,s,n)}};const $Be=Ri().vec3f(S.POSITION),IBe=Ri().vec3f(S.POSITION).vec2f(S.UV0),LBe=Ri().vec3f(S.POSITION).vec4u8(S.COLOR);Ri().vec3f(S.POSITION).vec4u8(S.OBJECTANDLAYERIDCOLOR);const DBe=Ri().vec3f(S.POSITION).vec2f(S.UV0).vec4u8(S.OBJECTANDLAYERIDCOLOR);Ri().vec3f(S.POSITION).vec4u8(S.COLOR).vec4u8(S.OBJECTANDLAYERIDCOLOR);let lG=class extends ry{intersect(e,r,i,s,n,o){return qhe(e,i,s,n,void 0,o)}};function NBe(t){t.fragment.code.add(b`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function FBe(t){t.fragment.code.add(b`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function IZ(t){t.fragment.uniforms.add(new We("texWaveNormal",e=>e.waveNormal),new We("texWavePerturbation",e=>e.wavePertubation),new Wt("waveParams",e=>oi(UBe,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new mr("waveDirection",e=>Qt(zBe,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(NBe),t.fragment.code.add(b`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const UBe=Ht(),zBe=Ie();function AC(t,e){e.spherical?t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}let OA=class extends Ji{constructor(e,r){super(e,"int",zr.Pass,(i,s,n)=>i.setUniform1i(e,r(s,n)))}},kBe=class extends Ji{constructor(e,r,i){super(e,"mat4",zr.Draw,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},BBe=class extends Ji{constructor(e,r,i){super(e,"mat4",zr.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},Pfe=class extends Ar{constructor(){super(...arguments),this.origin=C()}};function vD(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new BBe("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Mfe(t))}function H1(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new kBe("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Mfe(t))}function Mfe(t){const e=t.fragment;e.include(Ll),e.uniforms.add(new We("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new OA("numCascades",(r,i)=>i.shadowMap.numCascades),new Wt("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(b`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function VBe(t){const e=t.fragment.code;e.add(b`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(b`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(b`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function cG(t,e){const r=t.fragment.code;t.include(uA),e.pbrMode!==Xe.Normal&&e.pbrMode!==Xe.Schematic&&e.pbrMode!==Xe.Terrain&&e.pbrMode!==Xe.TerrainWithWater||(r.add(b`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(b`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Xe.Normal&&e.pbrMode!==Xe.Schematic||(t.include(VBe),r.add(b`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(b`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(b`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(b`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function GBe(t,e){const r=t.fragment.code;t.include(uA),r.add(b`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(b`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(b`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(b`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(b`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function $fe(t,e){t.include(GBe,e),t.include($L),t.include(FBe),e.hasCloudsReflections&&t.include(uce,e),e.hasScreenSpaceReflections&&t.include(hLe,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(b`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Se("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Se("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(b`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new wi("view",(i,s)=>s.ssr.camera.viewMatrix),new We("lastFrameColorTexture",(i,s)=>s.ssr.lastFrameColorTexture),new Se("fadeFactorSSR",(i,s)=>s.ssr.fadeFactor)),r.code.add(b`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(b`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(b`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor;
}`)}function jBe(t){const e=new ur,{vertex:r,fragment:i}=e;Pl(r,t),e.include(Ba,t),e.attributes.add(S.POSITION,"vec3"),e.attributes.add(S.UV0,"vec2");const s=new Wt("waterColor",n=>n.color);if(t.output===L.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(Gn)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(b`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==L.Color&&t.output!==L.Alpha||(e.include(AC,t),e.include(h2,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(Gn)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===L.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Tc,t),t.output){case L.Alpha:e.include(rs,t),i.uniforms.add(s),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case L.Color:e.include(o$),e.include(A7,{pbrMode:Xe.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(IZ),e.include(rs,t),e.include(H1,t),e.include($fe,t),i.uniforms.add(s,new Se("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),td(i,t),i.include(zp),vm(i),Up(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?b`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===Ze.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case L.Normal:e.include(AC,t),e.include(IZ,t),e.include(rs,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(Gn)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Se("timeElapsed",n=>n.timeElapsed)),i.code.add(b`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case L.Highlight:e.include(Am,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(Gn)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(rs,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case L.ObjectAndLayerIdColor:e.include(bA,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(Gn)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(rs,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const HBe=Object.freeze(Object.defineProperty({__proto__:null,build:jBe},Symbol.toStringTag,{value:"Module"}));let Ife=class Lfe extends gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Re.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new pr(e.rctx,Lfe.shader.get().build(this.configuration),cr)}_setPipelineState(e){const r=this.configuration,i=e===Ze.NONE,s=e===Ze.FrontFace;return xt({blending:r.output!==L.Normal&&r.output!==L.Highlight&&r.output!==L.ObjectAndLayerIdColor&&r.transparent?i?gc:Om(e):null,depthTest:{func:iy(e)},depthWrite:i?r.writeDepth?Ya:null:oD(e),colorWrite:$t,polygonOffset:i||s?null:cD(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Ife.shader=new dr(HBe,()=>he(()=>import("./WaterSurface.glsl-374952d5.js"),[]));let ln=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.transparencyPassType=Ze.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};h([D({count:L.COUNT})],ln.prototype,"output",void 0),h([D({count:Ze.COUNT})],ln.prototype,"transparencyPassType",void 0),h([D()],ln.prototype,"spherical",void 0),h([D()],ln.prototype,"receiveShadows",void 0),h([D()],ln.prototype,"hasSlicePlane",void 0),h([D()],ln.prototype,"transparent",void 0),h([D()],ln.prototype,"enableOffset",void 0),h([D()],ln.prototype,"writeDepth",void 0),h([D()],ln.prototype,"hasScreenSpaceReflections",void 0),h([D()],ln.prototype,"doublePrecisionRequiresObfuscation",void 0),h([D()],ln.prototype,"hasCloudsReflections",void 0),h([D()],ln.prototype,"objectAndLayerIdColorInstanced",void 0),h([D()],ln.prototype,"isDraped",void 0),h([D()],ln.prototype,"hasMultipassTerrain",void 0),h([D()],ln.prototype,"cullAboveGround",void 0),h([D({constValue:Xe.Water})],ln.prototype,"pbrMode",void 0),h([D({constValue:!0})],ln.prototype,"useCustomDTRExponentForWater",void 0),h([D({constValue:!0})],ln.prototype,"highStepCount",void 0),h([D({constValue:!1})],ln.prototype,"useFillLights",void 0);let WBe=class extends ey{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===L.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(Ife,e)}},Dfe=class extends lG{constructor(e){super(e,new Nfe),this._configuration=new ln,this.animation=new due}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<aD,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<qBe;const i=this.animation.advance(e);return this.setParameters({timeElapsed:sk(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case L.Normal:return e===ae.DRAPED_WATER;case L.Color:if(this.parameters.isDraped)return e===ae.DRAPED_MATERIAL;break;case L.Alpha:break;case L.Highlight:case L.ObjectAndLayerIdColor:return e===ae.OPAQUE_MATERIAL||e===ae.DRAPED_MATERIAL;default:return!1}let i=ae.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new WBe(e)}createBufferWriter(){return new v2(ie("enable-feature:objectAndLayerId-rendering")?DBe:IBe)}},Nfe=class extends OV{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=ir(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Ct(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}};const qBe=35e3;let uG=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function LZ(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const s=e.get(i.to);s&&(i.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0)})}let DZ=class extends uG{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},YBe=class{constructor(){this.first=0,this.count=0}},XBe=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Nt({allocator:e=>e||new uG,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=xO(),this.drawCommandsHighlight=xO(),this.drawCommandsOccludees=xO(),this.drawCommandsShadowHighlightRest=xO()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.size/e)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(NZ(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),NZ(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function ZBe(t){return t.vao!=null}function xO(){return new Nt({allocator:t=>t||new YBe,deallocator:t=>t})}function NZ(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(JBe(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function JBe(t,e){return t.first+t.count>=e.from}let QBe=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const NP=-3;var $f;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})($f||($f={}));let KBe=class{constructor(e,r,i){this._namespace=e,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,r,i,s=0){this._storage.put(this._namespace+e,r,i,s)}get(e){const r=this._storage.get(this._namespace+e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this._namespace+e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this._namespace+e,r,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}},Ffe=class{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Nt,this._users=new Nt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get size(){return this._size}get sizeMB(){return this._size/1024/1024}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,r,i,s){const n=this._db.get(e);if(n&&(this._size-=n.size,this._db.delete(e),n.entry!==r&&this._notifyRemove(e,n.entry,$f.ALL)),i>this._maxSize)return void this._notifyRemove(e,r,$f.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const o=1+Math.max(s,NP)-NP;this._db.set(e,{entry:r,size:i,lifetime:o,lives:o}),this._size+=i,this._checkSizeLimit()}updateSize(e,r,i){const s=this._db.get(e);if(s&&s.entry===r){for(this._size-=s.size;i>this._maxSize;){const n=this._notifyRemove(e,r,$f.SOME);if(!(n!=null&&n>0))return void this._db.delete(e);i=n}s.size=i,this._size+=i,this._checkSizeLimit()}}pop(e){const r=this._db.get(e);if(r)return this._size-=r.size,this._db.delete(e),++this._hit,r.entry;++this._miss}get(e){const r=this._db.get(e);if(r!==void 0)return this._db.delete(e),r.lives=r.lifetime,this._db.set(e,r),++this._hit,r.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const u=c.namespace;if(a.startsWith(u)){const d=r[u]||0;r[u]=d+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+NP-1)]=Math.round(a/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){this._db.forEach((r,i)=>{i.startsWith(e)&&(this._size-=r.size,this._db.delete(i),this._notifyRemove(i,r.entry,$f.ALL))})}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,$f.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,r]of this._db){if(this._db.delete(e),r.lives<=1){this._size-=r.size;const i=this._notifyRemove(e,r.entry,$f.SOME);i!=null&&i>0&&(this._size+=i,r.lives=r.lifetime,r.size=i,this._db.set(e,r))}else--r.lives,this._db.set(e,r);if(this._size<=.9*this.maxSize)return}}};const e7e=NP+1;let t7e=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache(`VaoCache ${Rl()}`,r7e)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(i!=null){const n=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,e7e),n}const s=new sd(this._rctx,this._locations,{geometry:this._layout},{geometry:br.createVertex(this._rctx,hr.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(e==null)return null;const r=e.size,i=r.toString(),s=this._cache.pop(i);return s!=null?(s.push(e),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[e],r,-1),null}};function r7e(t,e){if(e===$f.ALL)return void t.forEach(s=>s.dispose());const r=t.pop(),i=t.length*r.size;return r.dispose(),i}let Ufe=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Afe(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new t7e(e,i.vertexAttributeLocations,Dl(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new Efe(this._rctx))}dispose(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach(r=>r.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof Dfe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==_i.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(Ys.GEOMETRY|Ys.TRANSFORMATION)){const c=CO(r.elementCount(l.geometry.geometry)*i),u=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i),AO()}s.updateType&(Ys.HIGHLIGHT|Ys.OCCLUDEE|Ys.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new p2;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=i.get(n.id,null);o==null&&(o=new FZ(n.vec3),i.set(n.id,null,o)),o.changes.push(s)}for(const s of r){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)continue;let l=i.get(n.id,a);l==null&&(l=new FZ(n.vec3),i.set(n.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let d=s.get(l);if(a.forEach((p,g)=>{if(o.delete(l,g),g==null)return void He(!1,"No VAO for removed geometries");if(g.instances.size===p.changes.length)return this._vaoCache.deleteVao(g.vao),FE(d.buffers,g),void(d.buffers.length===0&&u.length===0&&s.delete(l));const y=g.numElements,_=g.vao.size/4,v=u.reduce((E,O)=>E+i.elementCount(O.geometry),0),w=p.changes.reduce((E,O)=>E+i.elementCount(O.geometry),0),T=Math.min((y+v-w)*n,EO),x=T>_;T>Y$&&T<_/2?(p.changes.forEach(({id:E})=>g.deleteInstance(E)),g.instances.forEach(({geometry:E})=>u.push(E)),this._vaoCache.deleteVao(g.vao),FE(d.buffers,g)):x?this._applyAndRebuild(g,u,p):this._applyRemoves(g,p)}),u.length>0)for(d==null&&(d=new QBe(c.origin),s.set(l,d)),d.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)d.buffers.push(this._applyAndRebuild(new XBe,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,ao(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const y of i.changes)e.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(EO/o);let l=e.numElements;for(;r.length>0;){const y=r.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){r.push(y);break}l+=_;const v=new DZ(y,0,0);He(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*o,u=CO(c),d=s.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,d,p);const v=p;p+=s.elementCount(y.geometry.geometry),e.updateInstance(_,v,p),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(zZ(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),AO(),e.holes.clear();const g=e.holes.pushNew();return g.from=p,g.to=Math.floor(e.vao.size/n),e.updateDrawCommands(n),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=_d.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const d=_d.pushNew();d.from=c.from,d.to=c.to}LZ(_d);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=_d.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=CO(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;_d.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),AO(),e.holes.pushArray(_d.data,_d.length),_d.forAll((a,l)=>_d.data[l]=null),_d.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!ZBe(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=e.numElements,o=r.reduce((w,T)=>w+i.elementCount(T.geometry),0),a=Math.min((n+o)*s,EO),l=4*a;if(e.vao.size<zZ(EO-Y$)&&l>e.vao.size)return void this._applyAndRebuild(e,r,null);LZ(e.holes);const c=new Array;for(const w of r){const T=i.elementCount(w.geometry),x=i7e(e.holes,T);c.push(x)}const u=e.vao.vertexBuffers.geometry;let d=0,p=0,g=0;const y=CO(a),_=i.vertexBufferLayout.createView(y.buffer);r.forEach((w,T)=>{const x=c[T];if(x==null)return;if(g!==x){const A=g-p;A>0&&u.setSubData(y,p*s,0,A*s),p=x,d=0}const E=i.elementCount(w.geometry);this._writeGeometry(w,_,d),d+=E,g=x+E;const O=new DZ(w,x,x+E);He(e.instances.get(w.id)==null),e.addInstance(w.id,O),e.drawCommandsDirty=!0});const v=g-p;v>0&&u.setSubData(y,p*s,0,v*s),_1e(r,(w,T)=>c[T]==null),AO()}_writeGeometry(e,r,i){const s=e.localOrigin.vec3;M$e(UZ,-s[0],-s[1],-s[2]);const n=qi(s7e,UZ,e.transformation);Wn(TO,n),$l(TO,TO),this._bufferWriter.write(n,TO,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}prepareTechnique(e){var a;const{output:r,bindParameters:i}=e;if(!this.requiresSlot(i.slot,r))return null;const s=r===L.Highlight||r===L.ShadowHighlight;if(s&&!this._hasHighlights)return null;const n=r===L.ShadowExcludeHighlight,o=!(s||n);(a=this._appleAmdDriverHelper)==null||a.resetIndicesType();for(const l of this._dataByOrigin.values())for(const c of l.buffers){if(s&&!c.hasHighlights)continue;const u=(s?c.drawCommandsHighlight:n&&c.needsMultipleCommands()?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,d=o&&c.drawCommandsOccludees||null;if(u!=null&&u.length||d!=null&&d.length){const p=this._glMaterials.load(e.rctx,i.slot,r),g=p!=null?p.beginSlot(i):null;if(g!=null)return g}}return null}render(e,r){var c;const{output:i,bindParameters:s}=e,n=i===L.Highlight||i===L.ShadowHighlight,o=i===L.ShadowExcludeHighlight,a=!(n||o),l=this._rctx;(c=this._appleAmdDriverHelper)==null||c.resetIndicesType(),l.bindTechnique(r,this.material.parameters,s);for(const u of this._dataByOrigin.values())for(const d of u.buffers){if(n&&!d.hasHighlights)continue;const p=(n?d.drawCommandsHighlight:o&&d.needsMultipleCommands()?d.drawCommandsShadowHighlightRest:d.drawCommandsDefault)||null,g=a&&d.drawCommandsOccludees||null;(p!=null&&p.length||g!=null&&g.length)&&(r.program.bindDraw(new iz(u.origin),s,this.material.parameters),r.ensureAttributeLocations(d.vao),l.bindVAO(d.vao),p!=null&&p.length&&(r.bindPipelineState(l,s.slot,!1),p.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))),g!=null&&g.length&&(r.bindPipelineState(l,s.slot,!0),g.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},FZ=class{constructor(e){this.origin=e,this.changes=new Array}};function i7e(t,e){let r;if(!t.some(s=>!(s.numElements<e)&&(r=s,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const UZ=xe(),s7e=xe(),TO=xe(),_d=new Nt({allocator:t=>t||new uG,deallocator:null}),Y$=65536,SO=4*Y$,zfe=16777216,EO=zfe/4;let FP=new Float32Array(Y$);function CO(t){return FP.length<t&&(FP=new Float32Array(t)),FP}function zZ(t){const e=4*t;return e<SO?SO:Math.max(Math.min(Math.ceil(1.5*e/SO)*SO,zfe),e)}function AO(){FP=new Float32Array(2)}let Xl=class extends we{constructor(e){super(e),this._pending=new n7e,this._changes=new rz,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Nt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return ao(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Sfe(this._changes);let r=!1,i=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.get(o);if(!a&&n.adds.length>0&&(a=new Ufe(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,s=!0),!a)return;const l=i||a.hasHighlights,c=s||a.hasWater;a.modify(n),i=i||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=ao(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=ao(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of i)this._pending.adds.add(n);s&&this.notifyChange("updating"),r===Mi.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===Mi.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case Ys.TRANSFORMATION:case Ys.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Ys.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{if(r.material.shouldRender(e)){const i=r.prepareTechnique(e);i!=null&&r.render(e,i)}})}intersect(e,r,i,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,i,r,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const s=i.material.renderPriority-r.material.renderPriority;return s!==0?s:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],n5[0]=i[0]-s,n5[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,n5,(l,c,u)=>{o7e(r,u,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicGeometryChanged(s),r=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(s),r=s)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};h([f()],Xl.prototype,"drapeSource",void 0),h([f()],Xl.prototype,"updating",null),h([f()],Xl.prototype,"rctx",null),h([f()],Xl.prototype,"rendererContext",void 0),h([f()],Xl.prototype,"_materialRepository",null),h([f()],Xl.prototype,"_localOriginFactory",null),h([f({readOnly:!0})],Xl.prototype,"isEmpty",null),h([f()],Xl.prototype,"_materialRenderers",void 0),h([f()],Xl.prototype,"_geometries",void 0),Xl=h([F("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Xl);let n7e=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function o7e(t,e,r,i,s,n,o){const a=new RBe(n,o,e),l=c=>{c.set(Ai.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Yn.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Yn.ALL){const c=eV(s.ray);l(c),s.results.all.push(c)}}const n5=Ie();let hG=class extends Ji{constructor(e,r){super(e,"vec2",zr.Draw,(i,s,n,o)=>i.setUniform2fv(e,r(s,n,o)))}};const o5=4;function a7e(){const t=new ur,e=t.fragment;t.include(Ac);const r=(o5+1)/2,i=1/(2*r*r);return e.include(xc),e.uniforms.add(new We("depthMap",s=>s.depthTexture),new wu("tex",s=>s.colorTexture),new hG("blurSize",s=>s.blurSize),new Se("projScale",(s,n)=>{const o=ei(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new mr("nearFar",(s,n)=>n.camera.nearFar)),e.code.add(b`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${b.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(b`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${b.int(o5)}; r <= ${b.int(o5)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),t}const l7e=Object.freeze(Object.defineProperty({__proto__:null,build:a7e},Symbol.toStringTag,{value:"Module"}));let kfe=class Bfe extends gr{initializeProgram(e){return new pr(e.rctx,Bfe.shader.get().build(),cr)}initializePipeline(){return xt({colorWrite:$t})}};kfe.shader=new dr(l7e,()=>he(()=>import("./SSAOBlur.glsl-e4beffa9.js"),[]));const c7e="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function bD(t){t.fragment.uniforms.add(new Wt("projInfo",(e,r)=>u7e(r))),t.fragment.uniforms.add(new mr("zScale",(e,r)=>Vfe(r))),t.fragment.code.add(b`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function u7e(t){const e=t.camera.projectionMatrix;return e[11]===0?oi(kZ,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):oi(kZ,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const kZ=Ht();function Vfe(t){return t.camera.projectionMatrix[11]===0?Qt(BZ,0,1):Qt(BZ,1,0)}const BZ=Ie(),VZ=16;function h7e(){const t=new ur,e=t.fragment;return t.include(Ac),e.include(xc),t.include(bD),e.uniforms.add(new Se("radius",(r,i)=>dG(i.camera))),e.code.add(b`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(b`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new mr("nearFar",(r,i)=>i.camera.nearFar),new We("normalMap",r=>r.normalTexture),new We("depthMap",r=>r.depthTexture),new mr("zScale",(r,i)=>Vfe(i)),new Se("projScale",r=>r.projScale),new We("rnm",r=>r.noiseTexture),new mr("rnmScale",(r,i)=>Qt(GZ,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Se("intensity",r=>r.intensity),new mr("screenSize",(r,i)=>Qt(GZ,i.camera.fullWidth,i.camera.fullHeight))),e.code.add(b`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${b.int(VZ)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${b.int(VZ)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),t}function dG(t){return Math.max(10,20*t.computeRenderPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const GZ=Ie(),d7e=Object.freeze(Object.defineProperty({__proto__:null,build:h7e,getRadius:dG},Symbol.toStringTag,{value:"Module"}));let Gfe=class jfe extends gr{initializeProgram(e){return new pr(e.rctx,jfe.shader.get().build(),cr)}initializePipeline(){return xt({colorWrite:$t})}};Gfe.shader=new dr(d7e,()=>he(()=>import("./SSAO.glsl-b4dd6f16.js"),[]));let p7e=class extends Ar{constructor(){super(...arguments),this.projScale=1}},f7e=class extends p7e{constructor(){super(...arguments),this.intensity=1}},m7e=class extends Ar{},g7e=class extends m7e{constructor(){super(...arguments),this.blurSize=Ie()}};const PS=2;let Hfe=class{constructor(e,r,i,s){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=s,this._quadVAO=null,this._passParameters=new f7e,this._drawParameters=new g7e}dispose(){this.enabled=!1,this._quadVAO=Ue(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){fo(this._ssaoFBO,e=>e.resize(0,0)),fo(this._blur0FBO,e=>e.resize(0,0)),fo(this._blur1FBO,e=>e.resize(0,0))}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return this._blur1FBO!=null?this._blur1FBO.colorTexture:null}render(e,r,i,s){if(this._enableTime==null||i==null||s==null||this._ssaoFBO==null||this._blur0FBO==null||this._blur1FBO==null)return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const n=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*y7e/dG(o)**6*l;const c=o.fullViewport,u=c[2],d=c[3],p=u/PS,g=d/PS;this._ssaoFBO.resize(u,d),this._blur0FBO.resize(p,g),this._blur1FBO.resize(p,g),this._quadVAO==null&&(this._quadVAO=Xa(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,u,d),n.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),n.bindVAO(this._quadVAO);const y=co(this._quadVAO,"geometry");n.drawArrays(vt.TRIANGLE_STRIP,0,y);const _=n.bindTechnique(this._blurTechnique,this._passParameters,e);n.setViewport(0,0,p,g),n.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,Qt(this._drawParameters.blurSize,0,PS/d),_.bindDraw(this._drawParameters,e,this._passParameters),n.setViewport(0,0,p,g),n.drawArrays(vt.TRIANGLE_STRIP,0,y),n.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,Qt(this._drawParameters.blurSize,PS/u,0),_.bindDraw(this._drawParameters,e,this._passParameters),n.drawArrays(vt.TRIANGLE_STRIP,0,y),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const e=new xr;e.wrapMode=Ot.CLAMP_TO_EDGE,this._ssaoFBO=new As(this._rctx,e),this._blur0FBO=new As(this._rctx,e),this._blur1FBO=new As(this._rctx,e);const r=Uint8Array.from(atob(c7e),i=>i.charCodeAt(0));e.pixelFormat=Pt.RGB,e.wrapMode=Ot.REPEAT,e.hasMipmap=!0,e.width=32,e.height=32,this._passParameters.noiseTexture=new bt(this._rctx,e,r),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(Gfe)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire(kfe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=Ue(this._passParameters.noiseTexture),this._blur1FBO=Ue(this._blur1FBO),this._blur0FBO=Ue(this._blur0FBO),this._ssaoFBO=Ue(this._ssaoFBO)}get gpuMemoryUsage(){return(this._blur0FBO!=null?this._blur0FBO.gpuMemoryUsage:0)+(this._blur1FBO!=null?this._blur1FBO.gpuMemoryUsage:0)+(this._ssaoFBO!=null?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}};const y7e=.5;let pG=class Wfe extends gr{initializeProgram(e){return new pr(e.rctx,Wfe.shader.get().build(),cr)}initializePipeline(){return this.configuration.hasAlpha?xt({blending:Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),colorWrite:$t}):xt({colorWrite:$t})}};pG.shader=new dr(kke,()=>he(()=>import("./TextureOnly.glsl-7108c265.js"),[]));let fG=class extends Bo{constructor(){super(...arguments),this.hasAlpha=!1}};h([D()],fG.prototype,"hasAlpha",void 0);let dh=class extends we{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Oi,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Nt,this._passParameters=new efe,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new ot,this.worldToPCSRatio=1,this.events=new ys,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,r=e.waterTextureRepository;this._stippleTextureRepository=new afe(e.renderingContext),this._shaderTechniqueRepository=new tfe({rctx:this._rctx,viewingMode:Re.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:r}),this._renderContext=new xfe(this._rctx,new aG(this._rctx,this.view.state.viewingMode),new Hfe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ce(()=>r.updating,()=>this.events.emit("content-changed"),Ss),ce(()=>this.spatialReference,i=>this._localOriginFactory=new oG(i),Ss),Ga(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new rfe(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&X$)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ae.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=rce(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=Ze.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new D7(Ce(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(nt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=vi(this._debugTextureTechnique),this._passParameters.texture=Ue(this._passParameters.texture),this._bindParameters.highlightDepthTexture=Ue(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Oe(this._shaderTechniqueRepository),this._temporaryFBO=Ue(this._temporaryFBO),this._quadVAO=Ue(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||ao(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Xl)}createDrapeSourceRenderer(e,r,i){const s=this._renderers.get(e);s!=null&&s.destroy();const n=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ce(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(e){let r=!1;if(this._overlayRenderTarget!=null)for(const i of this._overlayRenderTarget.renderTargets){const[s,n]=this.overlays,o=s.validTargets[i.type]||!n.validTargets[i.type];r=this._overlayRenderTarget.validateUsageForTarget(o,i,e)||r}return r}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=$R(e,i=>i.drapeTargetType===KU.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=$R(e,i=>i.drapeSourceType===TE.Features),r.hasDrapedRasterSource=$R(e,i=>i.drapeSourceType===TE.RasterImage)})}ensureOverlays(e,r){this._overlays==null&&(this._overlayRenderTarget=new Fke(this._rctx),this._overlays=[new fZ(Ci.INNER,this._overlayRenderTarget),new fZ(Ci.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Ue(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(la,e=>e.updatePolicy===C0.SYNC)}get isEmpty(){return!kr.OVERLAY_DRAW_DEBUG_TEXTURE&&!ao(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const s=e.canvasGeometries;if(s.numViews===0)return!1;const{alignPixelEnabled:n,contentPixelRatio:o}=i;this._screenToWorldRatio=o*e.mapUnitsPerPixel;const a=r.output;if(this.isEmpty||a===L.Highlight&&!this.hasHighlights||a===L.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const l=r.fbo;if(!l.isValid())return!1;const c=2*e.resolution,u=e.resolution;l.resize(c,u);const d=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===L.Normal?ae.DRAPED_WATER:ae.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(d),e.index===Ci.INNER&&(d.setClearColor(0,0,0,0),d.clearSafe(mi.COLOR_BUFFER_BIT)),r.type===Bi.Occluded&&(this._renderContext.renderOccludedMask=X$),kr.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==Bi.Occluded)for(let p=0;p<s.numViews;p++)this._setViewParameters(s.extents[p],e),this._drawDebugTexture(e.resolution,v7e[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:p,renderer:g})=>{if(r.type===Bi.ColorNoRasterImage&&p.drapeSourceType===TE.RasterImage)return;const{fullOpacity:y}=p,_=y!=null&&y<1&&a===L.Color;_&&(this.bindTemporaryFramebuffer(this._rctx,c,u),d.clearSafe(mi.COLOR_BUFFER_BIT));for(let v=0;v<s.numViews;v++)this._setViewParameters(s.extents[v],e),g.render(this._renderContext);_&&this._temporaryFBO!=null&&(l.bind(d),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),y,e.index))}),d.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){this._temporaryFBO==null&&(this._temporaryFBO=new Kpe(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,s){var o;let n=0;for(const a of this._renderers.values())n=((o=a.intersect)==null?void 0:o.call(a,e,r,i,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),n=s>=0,o=this._renderers.size*(i.renderGroup??(n?V$.MapLayer:V$.ViewLayer))+(n?s:0);this._sortedRenderers.push(new _7e(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],hoe(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),fL(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=ao(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=ao(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=ao(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(vt.TRIANGLE_STRIP,0,co(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r,i){if(se(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const s=new Uint8Array(e*r*4);let n=0;for(let l=0;l<r;l++)for(let c=0;c<e;c++){const u=Math.floor(c/10),d=Math.floor(l/10);u<2||d<2||10*u>e-20||10*d>r-20?(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=255):(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=1&u&&1&d?1&c^1&l?0:255:1&u^1&d?0:128)}const o=new xr;o.samplingMode=wt.NEAREST,o.width=e,o.height=r,this._passParameters.texture=new bt(this._rctx,o,s);const a=new fG;a.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(pG,a),this._quadVAO=Xa(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};h([f()],dh.prototype,"_sortedDrapeSourceRenderersDirty",void 0),h([f({autoDestroy:!0})],dh.prototype,"_shaderTechniqueRepository",void 0),h([f({autoDestroy:!0})],dh.prototype,"_stippleTextureRepository",void 0),h([f({constructOnly:!0})],dh.prototype,"view",void 0),h([f()],dh.prototype,"worldToPCSRatio",void 0),h([f()],dh.prototype,"spatialReference",void 0),h([f({type:Boolean,readOnly:!0})],dh.prototype,"updating",null),h([f()],dh.prototype,"isEmpty",null),dh=h([F("esri.views.3d.terrain.OverlayRenderer")],dh);let _7e=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const v7e=[[1,.5,.5],[.5,.5,1]],mG=-2,X$=_i.OccludeAndTransparent;function gG(t,e,r,i){const s=CA(t.rings,!!t.hasZ,Pp.CCW_IS_HOLE),n=go(s.position.length),o=npe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,r,i),a=o!=null;return new x7e(s.position,n,Xfe(s.polygons,s.position,n),Yfe(s.outlines,s.position,n),a,o)}function qfe(t,e){const r=CA(t.rings,!1,Pp.CCW_IS_HOLE),i=Xi(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=mG;return{position:r.position,polygons:Xfe(r.polygons,r.position),outlines:Yfe(r.outlines,r.position),projectionSuccess:i}}function Yfe(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return r!=null?new Zfe(i,s,xu(e,n,o),xu(r,n,o)):new yG(i,s,xu(e,n,o))})}function Xfe(t,e,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,u=o.map(p=>p-s),d=r!=null?new b7e(s,n,xu(e,3*s,3*n),xu(r,l,c),u,a):new w7e(s,n,xu(e,3*s,3*n),u,a);i.push(d)}return i}let yG=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},Zfe=class extends yG{constructor(e,r,i,s){super(e,r,i),this.mapPositions=s}},b7e=class extends Zfe{constructor(e,r,i,s,n,o){super(e,r,i,s),this.holeIndices=n,this.pathLengths=o}},w7e=class extends yG{constructor(e,r,i,s,n){super(e,r,i),this.holeIndices=s,this.pathLengths=n}},x7e=class{constructor(e,r,i,s,n,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function W1(t,e,r,i,s,n=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),a=r*o,l=i*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*n;t[d]=jZ(c),t[d+1]=jZ(u)}function T7e(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let s=0;s<e;++s)W1(r,s,t[i++],t[i++],t[i++]);return r}function S7e(t,e,r,i=2){const s=r*i,n=HZ(e[s]),o=HZ(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),fe(t,t)}function jZ(t){return me(Math.round(32767*t),-32767,32767)}function HZ(t){return me(t/32767,-1,1)}function Jfe(t,e){const r=t.fragment;switch(r.code.add(b`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Ni.None:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Ni.View:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Ni.WindingOrder:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Ni.COUNT:}}var Ni;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Ni||(Ni={}));function Qfe(t){t.vertex.code.add(b`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let E7e=class extends Bo{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function Kfe(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(S.MODELORIGINHI,"vec3"),t.attributes.add(S.MODELORIGINLO,"vec3"),t.attributes.add(S.MODEL,"mat3"),t.attributes.add(S.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(p$,e),r.uniforms.add(new mc("viewOriginHi",(i,s)=>nDe(se(OO,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),OO)),new mc("viewOriginLo",(i,s)=>oDe(se(OO,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),OO)))),r.code.add(b`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(b`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?b`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(b`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===L.Normal&&(Px(r),r.code.add(b`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(b`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}h([D()],E7e.prototype,"instancedDoublePrecision",void 0);const OO=C();var Us;function C7e(t){switch(t){case"multiply":default:return Us.Multiply;case"ignore":return Us.Ignore;case"replace":return Us.Replace;case"tint":return Us.Tint}}function eme(t,e,r){if(t==null||e===Us.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=me(Math.round(t[3]*Z$),0,Z$),s=i===0||e===Us.Tint?0:e===Us.Replace?A7e:O7e;r[0]=me(Math.round(t[0]*jv),0,jv),r[1]=me(Math.round(t[1]*jv),0,jv),r[2]=me(Math.round(t[2]*jv),0,jv),r[3]=i+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Us||(Us={}));const jv=255,Z$=85,A7e=Z$,O7e=2*Z$;function tme(t){t.vertex.code.add(b`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${b.int(Us.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${b.int(Us.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${b.int(Us.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${b.int(Us.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function rme(t,e){e.hasSymbolColors?(t.include(tme),t.attributes.add(S.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(b`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new OA("colorMixMode",r=>Khe[r.colorMixMode])),t.vertex.code.add(b`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function mv(t,e){e.hasVertexColors?(t.attributes.add(S.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(b`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(b`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(b`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function R7e(t){t.fragment.code.add(b`
    #define discardOrAdjustAlpha(color) { if (color.a < ${b.float(Gn)}) { discard; } }
  `)}let c1=class extends Ji{constructor(e,r){super(e,"float",zr.Draw,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function u1(t,e){ime(t,e,new Se("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function P7e(t,e){ime(t,e,new c1("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function ime(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==Fr.Mask&&e.alphaDiscardMode!==Fr.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case Fr.Blend:return t.include(R7e);case Fr.Opaque:i.code.add(b`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Fr.Mask:i.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Fr.MaskBlend:t.fragment.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function sme(t,e){const{vertex:r,fragment:i}=t,s=e.hasModelTransformation;s&&r.uniforms.add(new wi("model",o=>o.modelTransformation!=null?o.modelTransformation:qa));const n=e.hasColorTexture&&e.alphaDiscardMode!==Fr.Opaque;switch(e.output){case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:case L.ObjectAndLayerIdColor:Pl(r,e),t.include(Ba,e),t.include(_p,e),t.include(E0,e),t.include(dm,e),t.include(rs,e),t.include(bA,e),U1(t),t.varyings.add("depth","float"),n&&i.uniforms.add(new We("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(u1,e),i.code.add(b`
          void main(void) {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:b`outputDepth(depth);`}
          }
        `);break;case L.Normal:{Pl(r,e),t.include(Ba,e),t.include(AA,e),t.include(_D,e),t.include(_p,e),t.include(E0,e),n&&i.uniforms.add(new We("tex",a=>a.texture)),e.normalType===fr.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const o=e.normalType===fr.Attribute||e.normalType===fr.Compressed;r.code.add(b`
          void main(void) {
            vpos = calculateVPos();

            ${o?b`
                  vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:b`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * (${s?"model *":""} vec4(vpos, 1.0))).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(rs,e),t.include(u1,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===fr.ScreenDerivative?b`vec3 normal = screenDerivativeNormal(vPositionView);`:b`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case L.Highlight:Pl(r,e),t.include(Ba,e),t.include(_p,e),t.include(E0,e),n&&i.uniforms.add(new We("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),t.include(rs,e),t.include(u1,e),t.include(Am,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function nme(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(S.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Ni.WindingOrder?r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(b`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==ps.None&&(t.include(S7,e),r.uniforms.add(e.pbrTextureBindType===zr.Pass?new We("normalTexture",i=>i.textureNormal):new wu("normalTexture",i=>i.textureNormal)),r.code.add(b`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function RA(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new We("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture)),r.constants.add("blurSizePixelsInverse","float",1/PS),r.code.add(b`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(b`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function PA(t){t.constants.add("ambientBoostFactor","float",Ice)}function b2(t){t.uniforms.add(new Se("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function q1(t,e){const r=t.fragment;switch(t.include(RA,e),e.pbrMode!==Xe.Disabled&&t.include(cG,e),t.include(A7,e),t.include(uA),r.code.add(b`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Xe.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),PA(r),b2(r),vm(r),r.code.add(b`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?b`normalize(vPosWorld)`:b`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Up(r),r.code.add(b`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Xe.Disabled:case Xe.WaterOnIntegratedMesh:case Xe.Water:t.include(o$),r.code.add(b`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Xe.Normal:case Xe.Schematic:r.code.add(b`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(b`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new vp("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(b`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Se("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Se("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(b`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===Xe.Schematic?b`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:b`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Xe.Terrain:case Xe.TerrainWithWater:t.include(o$),r.code.add(b`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Xe.COUNT:}}function Ha(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function ome(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function UP(t,e,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function M7e(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:ome,create:Ha,createView:M7e,fromValues:UP},Symbol.toStringTag,{value:"Module"}));function $7e(t){t.vertex.uniforms.add(new kp("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:Ha())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(b`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function I7e(t){t.vertex.uniforms.add(new kp("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:Ha())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(b`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function L7e(t){t.vertex.uniforms.add(new kp("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:Ha())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(b`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function D7e(t){t.vertex.uniforms.add(new kp("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:Ha())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(b`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function N7e(t){t.vertex.uniforms.add(new kp("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:Ha())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(b`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function OC(t){t.include(zp),t.code.add(b`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${b.int(Us.Multiply)}) {
        return allMixed;
      }
      if (mode == ${b.int(Us.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Us.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${b.int(Us.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Us.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function F7e(t){const e=new ur,{vertex:r,fragment:i,varyings:s}=e;if(Pl(r,t),e.include(hA),s.add("vpos","vec3"),e.include(E0,t),e.include(Kfe,t),e.include(jhe,t),t.hasColorTextureTransform&&e.include($7e),t.output===L.Color||t.output===L.Alpha){t.hasNormalTextureTransform&&e.include(I7e),t.hasEmissionTextureTransform&&e.include(L7e),t.hasOcclusionTextureTransform&&e.include(D7e),t.hasMetallicRoughnessTextureTransform&&e.include(N7e),td(r,t),e.include(AA,t),e.include(Ba,t);const n=t.normalType===fr.Attribute||t.normalType===fr.Compressed;n&&t.offsetBackfaces&&e.include(Qfe),e.include(nme,t),e.include(_D,t),t.instancedColor&&e.attributes.add(S.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(_p,t),e.include(h2,t),e.include(rme,t),e.include(mv,t),r.uniforms.add(new Wt("externalColor",o=>o.externalColor)),s.add("vcolorExt","vec4"),t.hasMultipassTerrain&&s.add("depth","float"),t.hasModelTransformation&&r.uniforms.add(new wi("model",o=>o.modelTransformation!=null?o.modelTransformation:qa)),r.code.add(b`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${b.float(Gn)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?b`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${t.hasModelTransformation?"model,":""} vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?b`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?b`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?b`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?b`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?b`forwardMetallicRoughnessUV();`:""}
      }
    `)}return t.output===L.Alpha&&(e.include(rs,t),e.include(u1,t),e.include(Tc,t),i.uniforms.add(new Se("opacity",n=>n.opacity),new Se("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new We("tex",n=>n.texture)),i.include(OC),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `)),t.output===L.Color&&(e.include(rs,t),e.include(q1,t),e.include(RA,t),e.include(u1,t),e.include(t.instancedDoublePrecision?vD:H1,t),e.include(Tc,t),td(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new Mt("ambient",n=>n.ambient),new Mt("diffuse",n=>n.diffuse),new Se("opacity",n=>n.opacity),new Se("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new We("tex",n=>n.texture)),e.include(C7,t),e.include(cG,t),i.include(OC),e.include(Jfe,t),PA(i),b2(i),Up(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===fr.ScreenDerivative?b`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:b`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===Xe.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?b`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?b`normalUV`:"vuv0"});`:b`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?b`normalize(posWorld);`:b`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?b`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===Xe.Normal||t.pbrMode===Xe.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Ze.Color?b`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)),e.include(sme,t),e}const U7e=Object.freeze(Object.defineProperty({__proto__:null,build:F7e},Symbol.toStringTag,{value:"Module"}));let z7e=class extends Ofe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ce(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=ti.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ce(0,0,0),this.instancedDoublePrecision=!1,this.normalType=fr.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.externalColor=Ct(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=C(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=L1.Less,this.textureAlphaMode=Fr.Blend,this.textureAlphaCutoff=U$,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=_i.Occlude}},k7e=class extends Rfe{constructor(){super(...arguments),this.origin=C(),this.slicePlaneLocalOrigin=this.origin}},_G=class ame extends gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Re.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?ps.Default:ps.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,ame.shader)}_initializeProgram(e,r){return new pr(e.rctx,r.get().build(this.configuration),cr)}_convertDepthTestFunction(e){return e===L1.Lequal?Br.LEQUAL:Br.LESS}_makePipeline(e,r){const i=this.configuration,s=e===Ze.NONE,n=e===Ze.FrontFace;return xt({blending:i.output!==L.Color&&i.output!==L.Alpha||!i.transparent?null:s?gc:Om(e),culling:B7e(i)?IL(i.cullFace):null,depthTest:{func:iy(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?Ya:null,colorWrite:$t,stencilWrite:i.hasOccludees?Mp:null,stencilTest:i.hasOccludees?r?Y0:sy:null,polygonOffset:s||n?null:cD(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function B7e(t){return t.cullFace!==ti.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}_G.shader=new dr(U7e,()=>he(()=>import("./DefaultMaterial.glsl-8c7bb06e.js"),[]));let Lt=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.alphaDiscardMode=Fr.Opaque,this.doubleSidedMode=Ni.None,this.pbrMode=Xe.Disabled,this.cullFace=ti.None,this.transparencyPassType=Ze.NONE,this.normalType=fr.Attribute,this.textureCoordinateType=ps.None,this.customDepthTest=L1.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};h([D({count:L.COUNT})],Lt.prototype,"output",void 0),h([D({count:Fr.COUNT})],Lt.prototype,"alphaDiscardMode",void 0),h([D({count:Ni.COUNT})],Lt.prototype,"doubleSidedMode",void 0),h([D({count:Xe.COUNT})],Lt.prototype,"pbrMode",void 0),h([D({count:ti.COUNT})],Lt.prototype,"cullFace",void 0),h([D({count:Ze.COUNT})],Lt.prototype,"transparencyPassType",void 0),h([D({count:fr.COUNT})],Lt.prototype,"normalType",void 0),h([D({count:ps.COUNT})],Lt.prototype,"textureCoordinateType",void 0),h([D({count:L1.COUNT})],Lt.prototype,"customDepthTest",void 0),h([D()],Lt.prototype,"spherical",void 0),h([D()],Lt.prototype,"hasVertexColors",void 0),h([D()],Lt.prototype,"hasSymbolColors",void 0),h([D()],Lt.prototype,"hasVerticalOffset",void 0),h([D()],Lt.prototype,"hasSlicePlane",void 0),h([D()],Lt.prototype,"hasSliceHighlight",void 0),h([D()],Lt.prototype,"hasColorTexture",void 0),h([D()],Lt.prototype,"hasMetallicRoughnessTexture",void 0),h([D()],Lt.prototype,"hasEmissionTexture",void 0),h([D()],Lt.prototype,"hasOcclusionTexture",void 0),h([D()],Lt.prototype,"hasNormalTexture",void 0),h([D()],Lt.prototype,"hasScreenSizePerspective",void 0),h([D()],Lt.prototype,"hasVertexTangents",void 0),h([D()],Lt.prototype,"hasOccludees",void 0),h([D()],Lt.prototype,"hasMultipassTerrain",void 0),h([D()],Lt.prototype,"hasModelTransformation",void 0),h([D()],Lt.prototype,"offsetBackfaces",void 0),h([D()],Lt.prototype,"vvSize",void 0),h([D()],Lt.prototype,"vvColor",void 0),h([D()],Lt.prototype,"receiveShadows",void 0),h([D()],Lt.prototype,"receiveAmbientOcclusion",void 0),h([D()],Lt.prototype,"textureAlphaPremultiplied",void 0),h([D()],Lt.prototype,"instanced",void 0),h([D()],Lt.prototype,"instancedColor",void 0),h([D()],Lt.prototype,"objectAndLayerIdColorInstanced",void 0),h([D()],Lt.prototype,"instancedDoublePrecision",void 0),h([D()],Lt.prototype,"doublePrecisionRequiresObfuscation",void 0),h([D()],Lt.prototype,"writeDepth",void 0),h([D()],Lt.prototype,"transparent",void 0),h([D()],Lt.prototype,"enableOffset",void 0),h([D()],Lt.prototype,"cullAboveGround",void 0),h([D()],Lt.prototype,"snowCover",void 0),h([D()],Lt.prototype,"hasColorTextureTransform",void 0),h([D()],Lt.prototype,"hasEmissionTextureTransform",void 0),h([D()],Lt.prototype,"hasNormalTextureTransform",void 0),h([D()],Lt.prototype,"hasOcclusionTextureTransform",void 0),h([D()],Lt.prototype,"hasMetallicRoughnessTextureTransform",void 0),h([D({constValue:!0})],Lt.prototype,"hasVvInstancing",void 0),h([D({constValue:!1})],Lt.prototype,"useCustomDTRExponentForWater",void 0),h([D({constValue:!1})],Lt.prototype,"supportsTextureAtlas",void 0),h([D({constValue:!0})],Lt.prototype,"useFillLights",void 0);function V7e(t){const e=new ur,{vertex:r,fragment:i,varyings:s}=e;return Pl(r,t),e.include(hA),s.add("vpos","vec3"),e.include(E0,t),e.include(Kfe,t),e.include(jhe,t),t.output!==L.Color&&t.output!==L.Alpha||(td(e.vertex,t),e.include(AA,t),e.include(Ba,t),t.offsetBackfaces&&e.include(Qfe),t.instancedColor&&e.attributes.add(S.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.hasMultipassTerrain&&s.add("depth","float"),e.include(_p,t),e.include(h2,t),e.include(rme,t),e.include(mv,t),r.uniforms.add(new Wt("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(b`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${b.float(Gn)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?b`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===L.Alpha&&(e.include(rs,t),e.include(u1,t),e.include(Tc,t),i.uniforms.add(new Se("opacity",n=>n.opacity),new Se("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new We("tex",n=>n.texture)),i.include(OC),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===L.Color&&(e.include(rs,t),e.include(q1,t),e.include(RA,t),e.include(u1,t),e.include(t.instancedDoublePrecision?vD:H1,t),e.include(Tc,t),td(e.fragment,t),vm(i),PA(i),b2(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Mt("ambient",n=>n.ambient),new Mt("diffuse",n=>n.diffuse),new Se("opacity",n=>n.opacity),new Se("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new We("tex",n=>n.texture)),e.include(C7,t),e.include(cG,t),i.include(OC),Up(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===Xe.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?b`albedo = mix(albedo, vec3(1), 0.9);`:b``}
        ${b`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===Xe.Normal||t.pbrMode===Xe.Schematic?t.spherical?b`vec3 normalGround = normalize(vpos + localOrigin);`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:b``}
        ${t.pbrMode===Xe.Normal||t.pbrMode===Xe.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===Ze.Color?b`fragColor = premultiplyAlpha(fragColor);`:b``}
      }
    `)),e.include(sme,t),e}const G7e=Object.freeze(Object.defineProperty({__proto__:null,build:V7e},Symbol.toStringTag,{value:"Module"}));let lme=class cme extends _G{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=fr.Attribute,r.doubleSidedMode=Ni.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,cme.shader)}};lme.shader=new dr(G7e,()=>he(()=>import("./RealisticTree.glsl-d27b7af8.js"),[]));let pm=class extends ry{constructor(e){super(e,W7e),this.supportsEdges=!0,this._configuration=new Lt,this._vertexBufferLayout=q7e(this.parameters)}isVisibleForOutput(e){return e!==L.Shadow&&e!==L.ShadowExcludeHighlight&&e!==L.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||n||s;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?ti.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==L.Color&&e!==L.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Ni.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ni.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ni.WindingOrder:Ni.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Xe.Schematic:Xe.Normal:Xe.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<aD,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,s,n,o){if(this.parameters.verticalOffset!=null){const a=i.camera;se(l5,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Re.Global:l=fe(WZ,l5);break;case Re.Local:l=te(WZ,Z7e)}let c=0;const u=le(J7e,l5,a.eye),d=Te(u),p=ee(u,u,1/d);let g=null;this.parameters.screenSizePerspective&&(g=pe(l,p)),c+=Jhe(a,d,this.parameters.verticalOffset,g??0,this.parameters.screenSizePerspective),ee(l,l,c),El(a5,l,i.transform.inverseRotation),s=le(Y7e,s,a5),n=le(X7e,n,a5)}qhe(e,i,s,n,TU(i.verticalOffset),o)}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Depth||r===L.Normal||r===L.Shadow||r===L.ShadowHighlight||r===L.ShadowExcludeHighlight||r===L.Highlight||r===L.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ae.OPAQUE_MATERIAL)||e===ae.DRAPED_MATERIAL:!1}createGLMaterial(e){return new j7e(e)}createBufferWriter(){return new v2(this._vertexBufferLayout)}},j7e=class extends E7{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==L.Color&&this._output!==L.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?lme:_G,e)}},H7e=class extends z7e{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const W7e=new H7e;function q7e(t){const e=Ri().vec3f(S.POSITION);return t.normalType===fr.Compressed?e.vec2i16(S.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(S.NORMAL),t.hasVertexTangents&&e.vec4f(S.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(S.UV0),t.hasVertexColors&&e.vec4u8(S.COLOR),t.hasSymbolColors&&e.vec4u8(S.SYMBOLCOLOR),ie("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(S.OBJECTANDLAYERIDCOLOR),e}const Y7e=C(),X7e=C(),Z7e=Ce(0,0,1),WZ=C(),a5=C(),l5=C(),J7e=C(),Q7e=["polygon","extent"];let K7e=class extends Vp{constructor(e,r,i,s){super(e,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=hD(this._getSymbolSize());if(c)throw new X("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,r=this._getCombinedOpacityAndColor(e),i=yl(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?ti.None:ti.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:fr.Compressed};this._material=new pm(o),this._bottomMaterial=new pm({...o,cullFace:ti.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Q7e,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new od);return this._createAs3DShape(r,e.renderingInfo,i,s,r.uid)}layerOpacityChanged(e,r){var a,l;const i=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(c=>{const u=r(c);u!=null&&u.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,H0)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const s=r(i);s!=null&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?Oke(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?fs.RecreateSymbol:fs.RecreateGraphics}async queryForSnapping(e,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/YF(r),{objectId:o,target:a}=e,l=ye(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:u}=e,d=ye(c),p=ye(u);return d.z=(d.z??0)+n,p.z=(p.z??0)+n,[uZ(o,l,1/0,d,p)]}case"vertex":return[dke(o,l,1/0),uZ(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,s,n){const o=EC(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(M=>M.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=gG(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=kV(o);if(l==null)return null;const c=new Array,u=new Array,d=Bs(),p=xe(),g=C(),y=this._context.renderCoordsHelper.viewingMode===Re.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,g),bu(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const _=xe();Wn(_,p);const v=Zi();Sx(v,_);const{polygons:w,mapPositions:T,position:x}=a;for(const M of w){const U=M.count;if(this._context.clippingExtent&&(li(d),hc(d,M.mapPositions),!Nh(d,this._context.clippingExtent)))continue;const k=Fx(M.mapPositions,M.holeIndices,3);if(k.length===0)continue;const B=k.length,z=6*U,Y=g$(z+B),W=g$(B),j=go(3*z),Z=go(3*z),R=go(3*z),I=go(z);eVe(x,T,k,M,j,R,Z,I,Y,W,this._getExtrusionSize(r),g,y),Ux(j,j,_);const N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),V=new nVe(j,R,T7e(Z),I);c.push(qZ(this._material,Y,Y.length-W.length,V,i,N),qZ(this._bottomMaterial,W,0,V,i,N)),u.push(V.heights)}if(c.length===0)return null;const E=new Rm({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});E.transformation=p;const O=vpe(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=O!=null?{baseMaterial:this._material,edgeMaterials:[O],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,$=new Bp(this,E,c,null,null,(M,U,k,B,z)=>iVe(M,U,k,B,z,u),s,A);return $.alignedSampledElevation=a.sampledElevation,$.needsElevationUpdates=H0(s.mode),$}};function qZ(t,e,r,i,s,n){const o=d2(e.length),a=[[S.POSITION,new Le(i.positions,3,!0)],[S.NORMALCOMPRESSED,new Le(i.normals,2,!0)],[S.COLOR,new Le(s,4,!0)]],l=[[S.POSITION,e],[S.NORMALCOMPRESSED,e],[S.COLOR,o]];return new Rs(t,a,l,i.elevation,Wi.Mesh,n,r)}function eVe(t,e,r,i,s,n,o,a,l,c,u,d,p){const g=r.length/3;let y=0,_=2*i.count;tVe(t,e,i.index,i.count,r,0,g,s,n,o,a,l,c,_,u,d,p);let v=2*i.count;_=0,YZ(s,n,a,o,y,i.pathLengths[0],i.count,v,l,_,u),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],y+=i.pathLengths[0];for(let w=1;w<i.pathLengths.length;++w)YZ(s,n,a,o,y,i.pathLengths[w],i.count,v,l,_,u),v+=4*i.pathLengths[w],_+=2*i.pathLengths[w],y+=i.pathLengths[w]}function tVe(t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_,v){te(Ta,_);const w=y>0?1:-1;let T=3*r,x=0,E=3*x,O=i,A=3*O;for(let U=0;U<i;++U)v&&(Ta[0]=t[T],Ta[1]=t[T+1],Ta[2]=t[T+2],fe(Ta,Ta)),a[E]=t[T],a[E+1]=t[T+1],a[E+2]=t[T+2],l[E]=e[T],l[E+1]=e[T+1],l[E+2]=e[T+2],c[E]=-w*Ta[0],c[E+1]=-w*Ta[1],c[E+2]=-w*Ta[2],u[x]=0,a[A]=t[T]+y*Ta[0],a[A+1]=t[T+1]+y*Ta[1],a[A+2]=t[T+2]+y*Ta[2],l[A]=e[T],l[A+1]=e[T+1],l[A+2]=e[T+2],c[A]=w*Ta[0],c[A+1]=w*Ta[1],c[A+2]=w*Ta[2],u[O]=y,E+=3,A+=3,T+=3,x+=1,O+=1;T=3*n,E=0,A=3*g;const $=y<0?eJ:KZ,M=y<0?KZ:eJ;for(let U=0;U<o;++U)p[E]=s[T+$[0]],p[E+1]=s[T+$[1]],p[E+2]=s[T+$[2]],d[A]=s[T+M[0]]+i,d[A+1]=s[T+M[1]]+i,d[A+2]=s[T+M[2]]+i,E+=3,A+=3,T+=3}function RO(t,e,r,i,s,n,o){i[n]=i[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const oT=C();function YZ(t,e,r,i,s,n,o,a,l,c,u){let d=s,p=s+1,g=s+o,y=s+o+1,_=a,v=a+1,w=a+2*n,T=a+2*n+1;u<0&&(d=s+o+1,y=s),c*=3;for(let x=0;x<n;++x)x===n-1&&(u>0?(p=s,y=s+o):(p=s,d=s+o)),rVe(t,d,p,g,oT),RO(t,e,i,r,oT,_,d),RO(t,e,i,r,oT,v,p),RO(t,e,i,r,oT,w,g),RO(t,e,i,r,oT,T,y),l[c++]=_,l[c++]=w,l[c++]=T,l[c++]=_,l[c++]=T,l[c++]=v,d++,p++,g++,y++,_+=2,v+=2,w+=2,T+=2}const c5=C(),XZ=C(),ZZ=C(),JZ=C(),QZ=C();function rVe(t,e,r,i,s){e*=3,r*=3,i*=3,se(c5,t[e++],t[e++],t[e++]),se(XZ,t[r++],t[r++],t[r++]),se(ZZ,t[i++],t[i++],t[i++]),le(JZ,XZ,c5),le(QZ,ZZ,c5),Qe(s,QZ,JZ),fe(s,s)}const Hv=C();function iVe(t,e,r,i,s,n){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let u=0;const d=o.transformation,p=a2(xe(),d);for(let g=0;g<l;g+=2){const y=a[g];if(!VV(y))continue;const _=y.getMutableAttribute(S.POSITION).data,v=n[g/2],w=new yV(y.mapPositions),T=_.length/3;let x=0,E=!1,O=0;for(let A=0;A<T;A++){Hv[0]=_[x],Hv[1]=_[x+1],Hv[2]=_[x+2],i(w,PO),c&&(O+=PO.sampledElevation),kr.TESTS_DISABLE_OPTIMIZATIONS?(se(el,w.array[w.offset],w.array[w.offset+1],PO.z+v[x/3]),r!=null&&s.toRenderCoords(el,r,el),De(el,el,p)):(se(el,_[x],_[x+1],_[x+2]),De(el,el,d),s.setAltitude(el,PO.z+v[x/3]),De(el,el,p)),_[x]=el[0],_[x+1]=el[1],_[x+2]=el[2];const $=sVe/s.unitInMeters;(Math.abs(Hv[0]-_[x])>=$||Math.abs(Hv[1]-_[x+1])>=$||Math.abs(Hv[2]-_[x+2])>=$)&&(E=!0),w.offset+=3,x+=3}E&&(y.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[g]),a[g+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[g+1])),u+=O/T}return u/l}const el=C(),Ta=C(),PO=new SA,KZ=[0,2,1],eJ=[0,1,2],sVe=.01;class nVe{constructor(e,r,i,s){this.positions=e,this.elevation=r,this.normals=i,this.heights=s}}function wD(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function oVe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function aVe(t,e,r,i,s,n,o,a,l,c,u,d,p,g,y,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=d,v[12]=p,v[13]=g,v[14]=y,v[15]=_,v}function lVe(t,e){return new Float32Array(t,e,16)}const cVe=wD();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:cVe,clone:oVe,create:wD,createView:lVe,fromValues:aVe},Symbol.toStringTag,{value:"Module"}));const uVe=(t,e)=>{const r=Fp(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return $l(r,r)},hVe=(t,e)=>{const r=Fp(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return $l(r,r)},dVe=(t,e)=>{const r=1-e,i=Fp(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return $l(i,i)},pVe=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),s=Fp(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return $l(s,s)},fVe=(t,e)=>{const r=1-2*e,i=Fp(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return $l(i,i)},mVe=(t,e)=>{const r=Fp(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return $l(r,r)},gVe=(t,e)=>{const r=1-e,i=Fp(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return $l(i,i)};let ume=class hme{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=vl(e.strength,r.strength,i),this.radius=vl(e.radius,r.radius,i),this.threshold=vl(e.threshold,r.threshold,i)}clone(){return new hme(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:EE(this.radius),strength:this.strength,threshold:this.threshold}}},dme=class pme{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(vl(e.radius,r.radius,i))}clone(){return new pme(this.radius)}toJSON(){return{type:"blur",radius:EE(this.radius)}}},sz=class fme{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=vl(e.amount,r.amount,i),this._updateMatrix()}clone(){return new fme(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||wD();switch(this.type){case"brightness":this._colorMatrix=uVe(e,this.amount);break;case"contrast":this._colorMatrix=hVe(e,this.amount);break;case"grayscale":this._colorMatrix=dVe(e,this.amount);break;case"invert":this._colorMatrix=fVe(e,this.amount);break;case"saturate":this._colorMatrix=mVe(e,this.amount);break;case"sepia":this._colorMatrix=gVe(e,this.amount)}}},mme=class gme{constructor(e,r,i,s){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=vl(e.offsetX,r.offsetX,i),this.offsetY=vl(e.offsetY,r.offsetY,i),this.blurRadius=vl(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(vl(e.color[0],r.color[0],i)),this.color[1]=Math.round(vl(e.color[1],r.color[1],i)),this.color[2]=Math.round(vl(e.color[2],r.color[2],i)),this.color[3]=vl(e.color[3],r.color[3],i)}clone(){return new gme(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:EE(this.offsetX),yoffset:EE(this.offsetY),blurRadius:EE(this.blurRadius),color:e}}},yme=class _me{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=vl(e.angle,r.angle,i),this._updateMatrix()}clone(){return new _me(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||wD();this._colorMatrix=pVe(e,this.angle)}},vme=class bme{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=vl(e.amount,r.amount,i)}clone(){return new bme(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function vl(t,e,r){return t+(e-t)*r}function EE(t){return Math.round(1e3*Jh(t))/1e3}function yVe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new sz(t.type,0);case"saturate":case"brightness":case"contrast":return new sz(t.type,1);case"opacity":return new vme(1);case"hue-rotate":return new yme(0);case"blur":return new dme(0);case"drop-shadow":return new mme(0,0,0,[...Lk("transparent")]);case"bloom":return new ume(0,0,1)}}function _Ve(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,s)=>i.type===r[s].type)}function vVe(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let s=i.length;s<r.length;s++)i.push(yVe(r[s]))}function Myt(t){const e=t[0];return!!e&&"type"in e}var tJ,rJ,nz={exports:{}};nz.exports,rJ=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:jp},u=jp,d="none",p=")",g=",",y="(",_="%",v="px",w="cm",T="mm",x="in",E="pt",O="pc",A="deg",$="rad",M="grad",U="turn",k="#",B=".",z="e",Y=/^[ \t\n\r]/,W=/^[a-z\-]/,j=/^[0-9a-fA-F]/,Z=/^[+\-]/,R=/^[0-9]/,I=ga("none"),N=on("none",!1),V=on(")",!1),q=on(",",!1),J=ga("whitespace"),K=ny([" ","	",`
`,"\r"],!1,!1),ge=ga("function"),Me=on("(",!1),pt=ga("identifier"),Tt=ny([["a","z"],"-"],!1,!1),et=ga("percentage"),tt=on("%",!1),Ne=ga("length"),de=on("px",!1),rt=on("cm",!1),kt=on("mm",!1),Ee=on("in",!1),Fe=on("pt",!1),ze=on("pc",!1),lt=ga("angle"),it=on("deg",!1),sr=on("rad",!1),ke=on("grad",!1),ct=on("turn",!1),nr=ga("number"),Je=ga("color"),st=on("#",!1),ut=ny([["0","9"],["a","f"],["A","F"]],!1,!1),Et=ny(["+","-"],!1,!1),It=ny([["0","9"]],!1,!1),ci=on(".",!1),Ir=on("e",!1),ri=function(){return[]},Rt=function(G,ue){return{type:"function",name:G,parameters:ue||[]}},Yr=function(G,ue){return ue.length>0?S2(G,ue,3):[G]},Sr=function(G){return{type:"quantity",value:G.value,unit:G.unit}},Vr=function(G){return{type:"color",colorType:G.type,value:G.value}},yr=function(G){return G},ui=function(){return Za()},Or=function(G){return{value:G,unit:"%"}},Xr=function(G){return{value:G,unit:"px"}},Gr=function(G){return{value:G,unit:"cm"}},or=function(G){return{value:G,unit:"mm"}},Zr=function(G){return{value:G,unit:"in"}},xi=function(G){return{value:G,unit:"pt"}},En=function(G){return{value:G,unit:"pc"}},Cn=function(G){return{value:G,unit:"deg"}},An=function(G){return{value:G,unit:"rad"}},On=function(G){return{value:G,unit:"grad"}},Pi=function(G){return{value:G,unit:"turn"}},Ti=function(G){return{value:G,unit:null}},Lr=function(){return{type:"hex",value:Za()}},sn=function(G){return{type:"function",value:G}},Jn=function(){return{type:"named",value:Za()}},Vo=function(){return parseFloat(Za())},re=0,hi=0,Vu=[{line:1,column:1}],nn=0,Gu=[],qe=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=c[n.startRule]}function Za(){return s.substring(hi,re)}function on(G,ue){return{type:"literal",text:G,ignoreCase:ue}}function ny(G,ue,be){return{type:"class",parts:G,inverted:ue,ignoreCase:be}}function oy(){return{type:"end"}}function ga(G){return{type:"other",description:G}}function Gp(G){var ue,be=Vu[G];if(be)return be;for(ue=G-1;!Vu[ue];)ue--;for(be={line:(be=Vu[ue]).line,column:be.column};ue<G;)s.charCodeAt(ue)===10?(be.line++,be.column=1):be.column++,ue++;return Vu[G]=be,be}function ay(G,ue,be){var tr=Gp(G),ws=Gp(ue),ii={source:l,start:{offset:G,line:tr.line,column:tr.column},end:{offset:ue,line:ws.line,column:ws.column}};return be&&l&&typeof l.offset=="function"&&(ii.start=l.offset(ii.start),ii.end=l.offset(ii.end)),ii}function Bt(G){re<nn||(re>nn&&(nn=re,Gu=[]),Gu.push(G))}function Pm(G,ue,be){return new e(e.buildMessage(G,ue),G,ue,be)}function jp(){var G;return(G=Mm())===a&&(G=Go()),G}function Mm(){var G,ue;return qe++,G=re,Fi(),s.substr(re,4)===d?(ue=d,re+=4):(ue=a,qe===0&&Bt(N)),ue!==a?(Fi(),hi=G,G=ri()):(re=G,G=a),qe--,G===a&&qe===0&&Bt(I),G}function Go(){var G,ue;if(G=[],(ue=Ja())!==a)for(;ue!==a;)G.push(ue),ue=Ja();else G=a;return G}function Ja(){var G,ue,be,tr;return G=re,Fi(),(ue=$m())!==a?(Fi(),(be=ld())===a&&(be=null),Fi(),s.charCodeAt(re)===41?(tr=p,re++):(tr=a,qe===0&&Bt(V)),tr!==a?(Fi(),hi=G,G=Rt(ue,be)):(re=G,G=a)):(re=G,G=a),G}function ld(){var G,ue,be,tr,ws,ii,jo,hy;if(G=re,(ue=an())!==a){for(be=[],tr=re,ws=Fi(),s.charCodeAt(re)===44?(ii=g,re++):(ii=a,qe===0&&Bt(q)),ii===a&&(ii=null),jo=Fi(),(hy=an())!==a?tr=ws=[ws,ii,jo,hy]:(re=tr,tr=a);tr!==a;)be.push(tr),tr=re,ws=Fi(),s.charCodeAt(re)===44?(ii=g,re++):(ii=a,qe===0&&Bt(q)),ii===a&&(ii=null),jo=Fi(),(hy=an())!==a?tr=ws=[ws,ii,jo,hy]:(re=tr,tr=a);hi=G,G=Yr(ue,be)}else re=G,G=a;return G}function an(){var G,ue;return G=re,(ue=cy())===a&&(ue=gv())===a&&(ue=uy())===a&&(ue=Im()),ue!==a&&(hi=G,ue=Sr(ue)),(G=ue)===a&&(G=re,(ue=kA())!==a&&(hi=G,ue=Vr(ue)),G=ue),G}function Fi(){var G,ue;for(qe++,G=[],Y.test(s.charAt(re))?(ue=s.charAt(re),re++):(ue=a,qe===0&&Bt(K));ue!==a;)G.push(ue),Y.test(s.charAt(re))?(ue=s.charAt(re),re++):(ue=a,qe===0&&Bt(K));return qe--,ue=a,qe===0&&Bt(J),G}function $m(){var G,ue,be;return qe++,G=re,(ue=ly())!==a?(s.charCodeAt(re)===40?(be=y,re++):(be=a,qe===0&&Bt(Me)),be!==a?(hi=G,G=yr(ue)):(re=G,G=a)):(re=G,G=a),qe--,G===a&&(ue=a,qe===0&&Bt(ge)),G}function ly(){var G,ue,be;if(qe++,G=re,ue=[],W.test(s.charAt(re))?(be=s.charAt(re),re++):(be=a,qe===0&&Bt(Tt)),be!==a)for(;be!==a;)ue.push(be),W.test(s.charAt(re))?(be=s.charAt(re),re++):(be=a,qe===0&&Bt(Tt));else ue=a;return ue!==a&&(hi=G,ue=ui()),qe--,(G=ue)===a&&(ue=a,qe===0&&Bt(pt)),G}function cy(){var G,ue,be;return qe++,G=re,Fi(),(ue=ya())!==a?(s.charCodeAt(re)===37?(be=_,re++):(be=a,qe===0&&Bt(tt)),be!==a?(hi=G,G=Or(ue)):(re=G,G=a)):(re=G,G=a),qe--,G===a&&qe===0&&Bt(et),G}function gv(){var G,ue,be;return qe++,G=re,Fi(),(ue=ya())!==a?(s.substr(re,2)===v?(be=v,re+=2):(be=a,qe===0&&Bt(de)),be!==a?(hi=G,G=Xr(ue)):(re=G,G=a)):(re=G,G=a),G===a&&(G=re,Fi(),(ue=ya())!==a?(s.substr(re,2)===w?(be=w,re+=2):(be=a,qe===0&&Bt(rt)),be!==a?(hi=G,G=Gr(ue)):(re=G,G=a)):(re=G,G=a),G===a&&(G=re,Fi(),(ue=ya())!==a?(s.substr(re,2)===T?(be=T,re+=2):(be=a,qe===0&&Bt(kt)),be!==a?(hi=G,G=or(ue)):(re=G,G=a)):(re=G,G=a),G===a&&(G=re,Fi(),(ue=ya())!==a?(s.substr(re,2)===x?(be=x,re+=2):(be=a,qe===0&&Bt(Ee)),be!==a?(hi=G,G=Zr(ue)):(re=G,G=a)):(re=G,G=a),G===a&&(G=re,Fi(),(ue=ya())!==a?(s.substr(re,2)===E?(be=E,re+=2):(be=a,qe===0&&Bt(Fe)),be!==a?(hi=G,G=xi(ue)):(re=G,G=a)):(re=G,G=a),G===a&&(G=re,Fi(),(ue=ya())!==a?(s.substr(re,2)===O?(be=O,re+=2):(be=a,qe===0&&Bt(ze)),be!==a?(hi=G,G=En(ue)):(re=G,G=a)):(re=G,G=a)))))),qe--,G===a&&qe===0&&Bt(Ne),G}function uy(){var G,ue,be;return qe++,G=re,(ue=ya())!==a?(s.substr(re,3)===A?(be=A,re+=3):(be=a,qe===0&&Bt(it)),be!==a?(hi=G,G=Cn(ue)):(re=G,G=a)):(re=G,G=a),G===a&&(G=re,(ue=ya())!==a?(s.substr(re,3)===$?(be=$,re+=3):(be=a,qe===0&&Bt(sr)),be!==a?(hi=G,G=An(ue)):(re=G,G=a)):(re=G,G=a),G===a&&(G=re,(ue=ya())!==a?(s.substr(re,4)===M?(be=M,re+=4):(be=a,qe===0&&Bt(ke)),be!==a?(hi=G,G=On(ue)):(re=G,G=a)):(re=G,G=a),G===a&&(G=re,(ue=ya())!==a?(s.substr(re,4)===U?(be=U,re+=4):(be=a,qe===0&&Bt(ct)),be!==a?(hi=G,G=Pi(ue)):(re=G,G=a)):(re=G,G=a)))),qe--,G===a&&(ue=a,qe===0&&Bt(lt)),G}function Im(){var G,ue;return qe++,G=re,Fi(),(ue=ya())!==a?(hi=G,G=Ti(ue)):(re=G,G=a),qe--,G===a&&qe===0&&Bt(nr),G}function kA(){var G,ue,be,tr;if(qe++,G=re,s.charCodeAt(re)===35?(ue=k,re++):(ue=a,qe===0&&Bt(st)),ue!==a){if(be=[],j.test(s.charAt(re))?(tr=s.charAt(re),re++):(tr=a,qe===0&&Bt(ut)),tr!==a)for(;tr!==a;)be.push(tr),j.test(s.charAt(re))?(tr=s.charAt(re),re++):(tr=a,qe===0&&Bt(ut));else be=a;be!==a?(hi=G,G=Lr()):(re=G,G=a)}else re=G,G=a;return G===a&&(G=re,(ue=Ja())!==a&&(hi=G,ue=sn(ue)),(G=ue)===a&&(G=re,(ue=ly())!==a&&(hi=G,ue=Jn()),G=ue)),qe--,G===a&&(ue=a,qe===0&&Bt(Je)),G}function ya(){var G,ue,be,tr,ws,ii,jo;for(G=re,Z.test(s.charAt(re))?(s.charAt(re),re++):qe===0&&Bt(Et),ue=re,be=[],R.test(s.charAt(re))?(tr=s.charAt(re),re++):(tr=a,qe===0&&Bt(It));tr!==a;)be.push(tr),R.test(s.charAt(re))?(tr=s.charAt(re),re++):(tr=a,qe===0&&Bt(It));if(s.charCodeAt(re)===46?(tr=B,re++):(tr=a,qe===0&&Bt(ci)),tr!==a){if(ws=[],R.test(s.charAt(re))?(ii=s.charAt(re),re++):(ii=a,qe===0&&Bt(It)),ii!==a)for(;ii!==a;)ws.push(ii),R.test(s.charAt(re))?(ii=s.charAt(re),re++):(ii=a,qe===0&&Bt(It));else ws=a;ws!==a?ue=be=[be,tr,ws]:(re=ue,ue=a)}else re=ue,ue=a;if(ue===a)if(ue=[],R.test(s.charAt(re))?(be=s.charAt(re),re++):(be=a,qe===0&&Bt(It)),be!==a)for(;be!==a;)ue.push(be),R.test(s.charAt(re))?(be=s.charAt(re),re++):(be=a,qe===0&&Bt(It));else ue=a;if(ue!==a){if(be=re,s.charCodeAt(re)===101?(tr=z,re++):(tr=a,qe===0&&Bt(Ir)),tr!==a){if(Z.test(s.charAt(re))?(ws=s.charAt(re),re++):(ws=a,qe===0&&Bt(Et)),ws===a&&(ws=null),ii=[],R.test(s.charAt(re))?(jo=s.charAt(re),re++):(jo=a,qe===0&&Bt(It)),jo!==a)for(;jo!==a;)ii.push(jo),R.test(s.charAt(re))?(jo=s.charAt(re),re++):(jo=a,qe===0&&Bt(It));else ii=a;ii!==a?be=tr=[tr,ws,ii]:(re=be,be=a)}else re=be,be=a;be===a&&(be=null),hi=G,G=Vo()}else re=G,G=a;return G}function T2(G,ue){return G.map(function(be){return be[ue]})}function S2(G,ue,be){return[G].concat(T2(ue,be))}if((o=u())!==a&&re===s.length)return o;throw o!==a&&re<s.length&&Bt(oy()),Pm(Gu,nn<s.length?s.charAt(nn):null,nn<s.length?ay(nn,nn+1):ay(nn,nn))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,p=r("",c.line.toString().length," "),g=a[l.line-1],y=(l.line===d.line?d.column:g.length+1)-l.column||1;n+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+g+`
`+p+" | "+r("",l.column-1," ")+r("",y,"^")}else n+=`
 at `+u}return n},e.buildMessage=function(s,n){var o={literal:function(g){return'"'+l(g.text)+'"'},class:function(g){var y=g.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(g.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(g){return g.description}};function a(g){return g.charCodeAt(0).toString(16).toUpperCase()}function l(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function u(g){return o[g.type](g)}function d(g){var y,_,v=g.map(u);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(g){return g?'"'+l(g)+'"':"end of input"}return"Expected "+d(s)+" but "+p(n)+" found."},{SyntaxError:e,parse:i}},(tJ=nz).exports&&(tJ.exports=rJ());var bVe=nz.exports;function $yt(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=iJ(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new X("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:iJ(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!_Ve(e[r].effects,e[r+1].effects))throw new X("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});vVe(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function iJ(t){let e;if(!t)return[];try{e=bVe.parse(t)}catch(r){throw new X("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>wVe(r))}function wVe(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return xVe(t);case"opacity":return TVe(t);case"hue-rotate":return SVe(t);case"blur":return EVe(t);case"drop-shadow":return CVe(t);case"bloom":return AVe(t)}}catch(e){throw e.details.filter=t,e}throw new X("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function xVe(t){let e=1;return w2(t.parameters,1),t.parameters.length===1&&(e=Ah(t.parameters[0])),new sz(t.name,e)}function TVe(t){let e=1;return w2(t.parameters,1),t.parameters.length===1&&(e=Ah(t.parameters[0])),new vme(e)}function SVe(t){let e=0;return w2(t.parameters,1),t.parameters.length===1&&(e=IVe(t.parameters[0])),new yme(e)}function EVe(t){let e=0;return w2(t.parameters,1),t.parameters.length===1&&(e=wG(t.parameters[0]),MA(e,t.parameters[0])),new dme(e)}function CVe(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new X("effect:type-error","Accepts only one color",{});r=LVe(i)}else{const s=wG(i);if(Object.isFrozen(e))throw new X("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&MA(s,i)}if(e.length<2||e.length>3)throw new X("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new mme(e[0],e[1],e[2]||0,r||wme("black"))}function AVe(t){let e=1,r=0,i=0;return w2(t.parameters,3),t.parameters[0]&&(e=Ah(t.parameters[0])),t.parameters[1]&&(r=wG(t.parameters[1]),MA(r,t.parameters[1])),t.parameters[2]&&(i=Ah(t.parameters[2])),new ume(e,r,i)}function w2(t,e){if(t.length>e)throw new X("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function xD(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in bG)return"<length>";if(t.unit in vG)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function MA(t,e){if(t<0)throw new X("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function OVe(t){if(t.type!=="quantity"||t.unit!==null)throw new X("effect:type-error",`Expected <double>, Actual: ${xD(t)}`,{term:t})}function RVe(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new X("effect:type-error",`Expected <double> or <percentage>, Actual: ${xD(t)}`,{term:t})}const vG={deg:1,grad:.9,rad:180/Math.PI,turn:360};function PVe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&vG[t.unit]!=null))throw new X("effect:type-error",`Expected <angle>, Actual: ${xD(t)}`,{term:t})}const bG={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function MVe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&bG[t.unit]!=null))throw new X("effect:type-error",`Expected <length>, Actual: ${xD(t)}`,{term:t})}function Ah(t){RVe(t);const e=t.value;return MA(e,t),t.unit==="%"?.01*e:e}function $Ve(t){return OVe(t),MA(t.value,t),t.value}function IVe(t){return PVe(t),t.value*vG[t.unit]||0}function wG(t){return MVe(t),t.value*bG[t.unit]||0}function LVe(t){switch(t.colorType){case"hex":return Yxe(t.value);case"named":return wme(t.value);case"function":return FVe(t.value)}}function wme(t){if(!eie(t))throw new X("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return qxe(t)}const DVe=/^rgba?/i,NVe=/^hsla?/i;function FVe(t){if(w2(t.parameters,4),DVe.test(t.name))return[Ah(t.parameters[0]),Ah(t.parameters[1]),Ah(t.parameters[2]),t.parameters[3]?Ah(t.parameters[3]):1];if(NVe.test(t.name))return tie($Ve(t.parameters[0]),Ah(t.parameters[1]),Ah(t.parameters[2]),t.parameters[3]?Ah(t.parameters[3]):1);throw new X("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}let UVe=class{constructor(e,r){this._storage=new Ffe,this._storage.maxSize=e,r&&this._storage.registerRemoveFunc("",r)}put(e,r){this._storage.put(e,r,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}};new UVe(1e3);new ht([128,128,128]);const zVe=new ht("white");function kVe(t){return gl(t.resource).href}function Lyt(t,e){if(!t)return null;let r=null;return O1(t)?r=BVe(t):uL(t)&&(r=t.color?new ht(t.color):null),r?RC(r,e):null}function BVe(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var s;i.type==="object"&&((s=i.resource)!=null&&s.href)||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new ht(r):null}function RC(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new ht(r)}function VVe(t,e,r){const i=t.symbolLayers;if(!i)return;const s=n=>RC(e=e??n??(r!=null?zVe:null),r);i.forEach(n=>{var o;if(n.type!=="object"||!((o=n.resource)!=null&&o.href)||e)if(n.type==="water")n.color=s(n.color);else{const a=n.material!=null?n.material.color:null,l=s(a);n.material==null?n.material=new fc({color:l}):n.material.color=l,r!=null&&"outline"in n&&n.outline!=null&&n.outline.color!=null&&(n.outline.color=RC(n.outline.color,r))}})}function GVe(t,e,r){(e=e??t.color)&&(t.color=RC(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=RC(t.outline.color,r))}function Dyt(t,e,r){t&&(e||r!=null)&&(e&&(e=new ht(e)),O1(t)?VVe(t,e,r):uL(t)&&GVe(t,e,r))}async function jVe(t,e){const r=t.symbolLayers;r&&await UI(r,async i=>HVe(i,e))}async function HVe(t,e){switch(t.type){case"extrude":qVe(t,e);break;case"icon":case"line":case"text":WVe(t,e);break;case"path":XVe(t,e);break;case"object":await YVe(t,e)}}function WVe(t,e){const r=xme(e);r!=null&&(t.size=r)}function xme(t){for(const e of t)if(typeof e=="number")return e;return null}function qVe(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function YVe(t,e){const{resourceSize:r,symbolSize:i}=await ZVe(t),s=Tme(e,r,i);t.width=CE(e[0],i[0],r[0],s),t.depth=CE(e[1],i[1],r[1],s),t.height=CE(e[2],i[2],r[2],s)}function XVe(t,e){const r=Tme(e,zf,[t.width,void 0,t.height]);t.width=CE(e[0],t.width,1,r),t.height=CE(e[2],t.height,1,r)}function Tme(t,e,r){for(let i=0;i<3;i++){const s=t[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/e[i]:1}case"proportional":break;default:if(s&&e[i])return s/e[i]}}return 1}async function ZVe(t){const{computeObjectLayerResourceSize:e}=await he(()=>import("./symbolLayerUtils-a8470210.js"),[]),r=await e(t,10),{width:i,height:s,depth:n}=t,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function CE(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function JVe(t,e){const r=xme(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function Nyt(t,e){if(t&&e)return O1(t)?jVe(t,e):void(uL(t)&&JVe(t,e))}function Fyt(t,e,r){if(t&&e!=null)if(O1(t)){const i=t.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else uL(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function Uyt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function zyt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function QVe(t,e,r,i,s){if(t==null)return null;const n=t.referencesGeometry()&&s?KVe(e,i,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...r,$feature:o})}catch(a){return ne.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const u5=new Map;function KVe(t,e,r){const{transform:i,hasZ:s,hasM:n}=r;u5.has(e)||u5.set(e,eGe(e));const o=u5.get(e)(t.geometry,i,s,n);return{...t,geometry:o}}function eGe(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,s,n)=>jde(i,e,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>Hde(i,e,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>Wde(i,e,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>Gde(i,e,r,s,n);default:return ne.getLogger("esri.views.2d.support.arcadeOnDemand").error(new X("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const kyt=1.2,tGe=gp;let TD=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Mi.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ys.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Mi.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=C()){return se(e,0,0,0)}getBoundingBoxObjectSpace(e=Bs()){return li(e)}addObjectState(e,r){e===cm.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ys.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ys.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(Wv)&&(e.draped.origin[0]+=Wv[0],e.draped.origin[1]+=Wv[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,s,n){li(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,sJ,i),jCe(n,sJ)}if(r){let o;Dh(n,Wv);const a=BV(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(Wv[0],Wv[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,r,i,s){if(this.boundingBox)rL(vd,this.boundingBox);else{const n=e.boundingSphere,o=n[3];vd[0]=n[0]-o,vd[1]=n[1]-o,vd[2]=n[2]-o,vd[3]=n[0]+o,vd[4]=n[1]+o,vd[5]=n[2]+o}return r(vd,0,2),this.calculateRelativeScreenBounds&&s.push({location:Dh(vd),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),EB(vd,i)}};const sJ=Ut(),vd=Bs(),Wv=C();let Sme=class{constructor(e,r,i,s=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=oz(nJ,MO,MO).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const v=e.measureText(y),w=v.width,T=w+r;this._textWidths.push(w),this._lineWidths.push(T),o=Math.max(o,T),a=Math.max(a,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),_===0&&(s=v),_===this._lines.length-1&&(n=v)});const c=e.font;let u=aJ.get(c);if(!u){const y=e.measureText(iGe);u=new nGe(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),aJ.set(c,u)}a=Math.max(a,u.actualBoundingBoxAscent),l=Math.max(l,u.actualBoundingBoxDescent);const d=a+l,p=this._hasBackground?s.actualBoundingBoxAscent:a,g=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new sGe(a-p,l-g,d,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*rGe}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case A0.Left:return this._backgroundHorizontalPadding;case A0.Center:return(this.displayWidth-this._lineWidths[e])/2;case A0.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,r+d,i),this._renderLineDecoration(e,r+d,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+d,i,this._textWidths[c]),i+=this._lineSpacing}if(kr.TEXT_SHOW_BASELINE){e.strokeStyle=oJ,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let u=0;u<this._lines.length;++u){const d=c+this._baselinePosition;this._drawLine(e,[s,d],[s+this.displayWidth,d]),c+=this._lineSpacing}}if(kr.TEXT_SHOW_BORDER&&(e.strokeStyle=oJ,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=me(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+s),e.arcTo(r,i,r+s,i,s),e.lineTo(r+n-s,i),e.arcTo(r+n,i,r+n,i+s,s),e.lineTo(r+n,i+o-s),e.arcTo(r+n,i+o,r+n-s,i+o,s),e.lineTo(r+s,i+o),e.arcTo(r,i+o,r,i+o-s,s),e.closePath()):e.rect(r,i,n,o)}_renderHalo(e,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=oz(nJ,Math.max(o,MO),Math.max(a,MO)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n+this._baselinePosition;for(let p=0;p<this._lines.length;++p){const g=this._getLineXOffset(p);this._renderLineDecoration(c,s+g,d,this._textWidths[p],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of Eme)this._fillText(e,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let u=0;u<l;u++){const d=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,s){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(e,r,i,s){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,u=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,u),e.stroke()}};const Eme=[];for(let e=0;e<360;e+=360/16)Eme.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var A0;function oz(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(A0||(A0={}));const nJ={canvas:null},rGe=.2,MO=512,oJ="rgb(255, 0, 255, 0.5)",iGe=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let sGe=class{constructor(e,r,i,s,n){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=s,this.baselinePosition=n}},nGe=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const aJ=new Map,oGe=Object.freeze({left:0,center:.5,right:1}),zP=Object.freeze({"bottom-left":ir(0,0),bottom:ir(.5,0),"bottom-right":ir(1,0),left:ir(0,.5),center:ir(.5,.5),right:ir(1,.5),"top-left":ir(0,1),top:ir(.5,1),"top-right":ir(1,1)});function Cme(t){switch(t){case"left":return A0.Left;case"right":return A0.Right;default:return A0.Center}}function lJ(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function aGe(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function lGe(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function cGe(t){return t==="middle"?"center":t}let kx=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=xe(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Rl(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.shaderTransformer=r.shaderTransformer,this.castShadow=r.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(e){e(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=De(ss(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*gx(this.shaderTransformation),this._boundingSphere):iae}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=en(xe(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const uGe=xe(),cJ=Ce(0,0,1),hGe=16,dGe=1.5,K_=IV,pGe=[K_/2,K_/2,1-K_/2,1-K_/2],fGe=[bC*K_,bC*K_];let az=class Ame extends Vp{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,s){super(e,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const s=kVe(this.symbolLayer),n=y1(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),e):await this._prepareResourcesHref(r,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=hD(this._getIconSize());if(e)throw new X("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?Fo(e.size):hGe);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height};i=new pv(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_computeSize(e,r){const i=e.width/e.height;return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(mGe(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;e.verticalOffset={screenLength:Fo(i),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(h5(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>ude(r));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=pGe;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/K_,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await rm(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw K1(o.error),new X("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters;this._size=this._computeSize(l,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const s=new s2({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const u=(await he(()=>import("./CIMSymbolRasterizer-38195078.js"),["assets/CIMSymbolRasterizer-38195078.js","assets/cimAnalyzer-f61f06f5.js","assets/TileClipper-ae6eca9e.js","assets/enums-9bbe4bf0.js","assets/number-954e4ab6.js","assets/BidiEngine-9a40f2f4.js","assets/imageutils-a4ca2b94.js","assets/rasterizingUtils-ae6c4413.js"])).CIMSymbolRasterizer;qt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(isNaN(u.scaleExpression)){const d=u.scaleExpression,p=await CTe(d,this._context.layer.spatialReference,n);a=(g,y,_)=>{const v=QVe(p,g,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(u.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];qt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(u=>c.get(u).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||uAe}_getOutlineSize(){let e=0;const r=this.symbolLayer;return r.outline!=null&&r.outline.size!=null?Math.max(Fo(r.outline.size),0):(e=h5(this._getPrimitive())?dGe:0,Math.max(e,0))}_getOutlineColor(){var s;const e=this._getLayerOpacity(),r=this.symbolLayer,i=(s=r==null?void 0:r.outline)==null?void 0:s.color;if(i!=null){const n=ht.toUnitRGB(i),o=i.a*e;return[n[0],n[1],n[2],o]}return[0,0,0,0]}_getFillColor(){var i,s;if(h5(this._getPrimitive()))return tGe;const e=this._getPrimitive()==null,r=(s=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:s.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?ir((r.x||0)+.5,.5-(r.y||0)):e in zP?zP[e]:zP.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new Dx(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=Ix(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._material=new Dx(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=vi(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const s=e.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[i]=Fo(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){var d;const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),g={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(g,this._context.stage),s=[p.parameters.width,p.parameters.height]}else s=this._size,i=this._material;const n=TC(r.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((d=this._fastUpdates)!=null&&d.visualVariables.size)){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=ir(s[0]*l,s[1]*l),u=this.setGraphicElevationContext(r,new od);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,e.layer.uid):this._createAs3DShape(r,n,i,a,c,u,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=TA(Ame.elevationModeChangeTypes,i,s);if(n!==Yi.UPDATE)return n;const o=Uu(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!Lx(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return fs.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return fs.FastUpdate}_defaultElevationInfoNoZ(){return gGe}_createAs3DShape(e,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=l&&this._fastUpdates?_=>kU(this._fastUpdates.materialParameters,l,_):void 0,u=this._context.layer.uid,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:u}),p=dU(i,cJ,null,s,n,yGe,null,l,d),g=YV(this._context,r,p,o,a,c);if(g==null)return null;const y=new Bp(this,g.object,[p],null,null,wC,o);return y.alignedSampledElevation=g.sampledElevation,y.needsElevationUpdates=Uu(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),xC(y,r,this._context.elevationProvider),y}_createAsOverlay(e,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Ht();bo(r,a,this._context.overlaySR),a[2]=mG;const l=this._context.clippingExtent;if(l!=null&&!SB(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=c&&this._fastUpdates?_=>kU(this._fastUpdates.materialParameters,c,_):void 0,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),p=dU(i,cJ,a,s,n,null,null,c,d),g=new kx(p,{layerUid:o,graphicUid:e.uid,shaderTransformer:u}),y=new TD(this,[g],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,u),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(o=Ie())=>{const a=r(uGe);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=e[0]/this._symbolTextureRatio+i,n=e[1]/this._symbolTextureRatio+i;return(o=Ie())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Ce(e,e,e),i=Jh(1),s=e*i,n=Ce(s,s,s);return new wA({size:!0,color:!0,rotation:!0,opacity:!1},r,n,i)}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){this._material!=null&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function mGe(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function h5(t){return t!=null&&(t==="cross"||t==="x")}az.PRIMITIVE_SIZE=fGe,az.elevationModeChangeTypes={definedChanged:Yi.UPDATE,staysOnTheGround:Yi.NONE,onTheGroundChanged:Yi.RECREATE};const gGe={mode:"relative-to-ground",offset:0},yGe=Ct(0,0,0,1);function lz(t){switch(t){case"butt":return Su.BUTT;case"square":return Su.SQUARE;case"round":return Su.ROUND;default:return null}}function _Ge(t){return t==="diamond"?"kite":t}function cz(t,e,r=null){const i=[],s=[],n=e.mapPositions;vGe(e,s,i);const o=s[0][1].data,a=i[0][1].length,l=d2(a);return bGe(e,s,i,l),TGe(e,s,i,l),wGe(e,s,i,l),xGe(e,s,i,l),SGe(e,s,i,l),EGe(e,s,i,l),CGe(e,s,i,o),new Rs(t,s,i,n,Wi.Line,r)}function vGe(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=t,n=AGe(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?i.slice(0,i.length-3):i;let c=0;for(let u=0;u<o-1;u++)a[c++]=u,a[c++]=u+1;e.push([S.POSITION,new Le(l,3,n)]),r.push([S.POSITION,a])}function bGe(t,e,r,i){if(t.attributeData.colorFeature!=null)return;const s=t.attributeData.color;e.push([S.COLOR,new Le(s??fu,4)]),r.push([S.COLOR,i])}function wGe(t,e,r,i){if(t.attributeData.normal==null)return;const s=t.attributeData.normal;e.push([S.NORMAL,new Le(s,3)]),r.push([S.NORMAL,i])}function xGe(t,e,r,i){t.attributeData.colorFeature!=null&&(e.push([S.COLORFEATUREATTRIBUTE,new Le([t.attributeData.colorFeature],1,!0)]),r.push([S.COLOR,i]))}function TGe(t,e,r,i){t.attributeData.sizeFeature==null&&(e.push([S.SIZE,new Le([t.attributeData.size??1],1,!0)]),r.push([S.SIZE,i]))}function SGe(t,e,r,i){t.attributeData.sizeFeature!=null&&(e.push([S.SIZEFEATUREATTRIBUTE,new Le([t.attributeData.sizeFeature],1,!0)]),r.push([S.SIZEFEATUREATTRIBUTE,i]))}function EGe(t,e,r,i){const s=t.attributeData.opacityFeature;s!=null&&(e.push([S.OPACITYFEATUREATTRIBUTE,new Le([s],1,!0)]),r.push([S.OPACITYFEATUREATTRIBUTE,i]))}function CGe(t,e,r,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Re.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=go(i.length),n=Cr(t.overlayInfo.spatialReference);for(let p=0;p<s.length;p+=3)GB(i,p,s,p,n);const o=i.length/3,a=Di(o+1);let l=OGe,c=RGe,u=0,d=0;se(l,s[d++],s[d++],s[d++]),a[0]=0;for(let p=1;p<o+1;++p)p===o&&(d=0),se(c,s[d++],s[d++],s[d++]),u+=Dle(l,c),a[p]=u,[l,c]=[c,l];e.push([S.DISTANCETOSTART,new Le(a,1,!0)]),r.push([S.DISTANCETOSTART,r[0][1]])}function AGe(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const OGe=C(),RGe=C();function Wyt(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const s=i.length,n=go(3*s);i.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function PGe(t,e,r,i){const s=t.type==="polygon"?Pp.CCW_IS_HOLE:Pp.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=CA(n,!!t.hasZ,s),l=go(o.length),c=npe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),u=c!=null;return{lines:u?Ome(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function MGe(t,e){const r=t.type==="polygon"?Pp.CCW_IS_HOLE:Pp.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=CA(i,!1,r),o=Xi(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=mG;return{lines:o?Ome(n,s):[],projectionSuccess:o}}function Ome(t,e,r=null){const i=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:xu(e,3*s,3*n),mapPositions:r!=null?xu(r,o,a):void 0})}return i}function $Ge(t){const e=new ur,r=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha),i=t.space===Tu.World;e.include(ofe,t),e.include(pfe,t),t.output===L.Depth&&e.include(dm,t);const{vertex:s,fragment:n}=e;return n.include(Ll),Pl(s,t),e.attributes.add(S.POSITION,"vec3"),e.attributes.add(S.UV0,"vec2"),e.attributes.add(S.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),z0(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new mr("nearFar",(o,a)=>a.camera.nearFar),new Wt("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(b`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(S.NORMAL,"vec3"),Px(s),s.constants.add("tiltThreshold","float",.7),s.code.add(b`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(b`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(b`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===j1.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Tu.Screen&&(s.uniforms.add(new wi("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(b`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(b`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Se("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(b`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),s.uniforms.add(new Se("pixelRatio",(o,a)=>a.camera.pixelRatio)),NL(e),s.code.add(b`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&s.code.add(b`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(b`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(b`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Tu.Screen&&s.code.add(b`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(b`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(Tc,t),e.include(rs,t),n.uniforms.add(new Wt("intrinsicColor",o=>o.color),new We("tex",o=>o.texture)),n.include(zp),e.constants.add("texelSize","float",1/CC),n.code.add(b`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",sG/CC),e.constants.add("relativeTipLineWidth","float",oBe),n.code.add(b`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",Gn),n.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Color&&t.transparencyPassType===Ze.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===L.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""}
  }
  `),e}const IGe=Object.freeze(Object.defineProperty({__proto__:null,build:$Ge},Symbol.toStringTag,{value:"Module"})),Rme=new Map([[S.POSITION,0],[S.UV0,2],[S.AUXPOS1,3],[S.NORMAL,4],[S.COLOR,5],[S.COLORFEATUREATTRIBUTE,5],[S.SIZE,6],[S.SIZEFEATUREATTRIBUTE,6],[S.OPACITYFEATUREATTRIBUTE,7]]);let Pme=class Mme extends gr{initializeProgram(e){return new pr(e.rctx,Mme.shader.get().build(this.configuration),Rme)}_makePipelineState(e,r){const i=this.configuration,s=e===Ze.NONE;return xt({blending:i.output===L.Color||i.output===L.Alpha?s?gc:Om(e):null,depthTest:{func:iy(e)},depthWrite:s?i.writeDepth?Ya:null:oD(e),colorWrite:$t,stencilWrite:i.hasOccludees?Mp:null,stencilTest:i.hasOccludees?r?Y0:sy:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=xt({blending:gc,depthTest:W$,depthWrite:null,colorWrite:$t,stencilWrite:null,stencilTest:gfe}),this._occluderPipelineOpaque=xt({blending:gc,depthTest:W$,depthWrite:null,colorWrite:$t,stencilWrite:ffe,stencilTest:mfe}),this._occluderPipelineMaskWrite=xt({blending:null,depthTest:nG,depthWrite:null,colorWrite:null,stencilWrite:Mp,stencilTest:Y0})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===ae.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ae.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};Pme.shader=new dr(IGe,()=>he(()=>import("./LineMarker.glsl-c3d981d1.js"),[]));let LGe=class extends ry{constructor(e){super(e,new NGe),this._vertexAttributeLocations=Rme,this._configuration=new Nn,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===ae.DRAPED_MATERIAL?Tu.Draped:this.parameters.worldSpace?Tu.World:Tu.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Su.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===_i.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Ri().vec3f(S.POSITION).vec2f(S.UV0).vec3f(S.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(S.NORMAL),this.parameters.vvSize?e.f32(S.SIZEFEATUREATTRIBUTE):e.f32(S.SIZE),this.parameters.vvColor?e.f32(S.COLORFEATUREATTRIBUTE):e.vec4f(S.COLOR),this.parameters.vvOpacity&&e.f32(S.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new FGe(this._layout,this.parameters)}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth?e===ae.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===_i.OccludeAndTransparentStencil?e===ae.OPAQUE_MATERIAL||e===ae.OCCLUDER_MATERIAL||e===ae.TRANSPARENT_OCCLUDER_MATERIAL:r===L.Color||r===L.Alpha?e===(this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ae.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new DGe(e)}},DGe=class extends E7{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Pme,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},NGe=class extends xA{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Su.BUTT,this.anchor=j1.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}},FGe=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,s,n){const o=i.vertexAttributes.get(S.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(S.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,d=0;this._parameters.vvSize?d=i.vertexAttributes.get(S.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(S.SIZE)&&(u=i.vertexAttributes.get(S.SIZE).data[0]);let p=[1,1,1,1],g=0;this._parameters.vvColor?g=i.vertexAttributes.get(S.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(S.COLOR)&&(p=i.vertexAttributes.get(S.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=i.vertexAttributes.get(S.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const w=(O,A,$,M)=>{if(_[v++]=O[0],_[v++]=O[1],_[v++]=O[2],_[v++]=$[0],_[v++]=$[1],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=d:_[v++]=u,this._parameters.vvColor)_[v++]=g;else{const U=Math.min(4*M,p.length-4);_[v++]=p[U],_[v++]=p[U+1],_[v++]=p[U+2],_[v++]=p[U+3]}this._parameters.vvOpacity&&(_[v++]=y)};let T;(function(O){O[O.ASCENDING=1]="ASCENDING",O[O.DESCENDING=-1]="DESCENDING"})(T||(T={}));const x=(O,A)=>{const $=se(UGe,o[3*O],o[3*O+1],o[3*O+2]),M=zGe;let U=O+A;do se(M,o[3*U],o[3*U+1],o[3*U+2]),U+=A;while(M0($,M)&&U>=0&&U<a);e&&(De($,$,e),De(M,M,e)),w($,M,[-1,-1],O),w($,M,[1,-1],O),w($,M,[1,1],O),w($,M,[-1,-1],O),w($,M,[1,1],O),w($,M,[-1,1],O)},E=this._parameters.placement;E!=="begin"&&E!=="begin-end"||x(0,T.ASCENDING),E!=="end"&&E!=="begin-end"||x(a-1,T.DESCENDING)}};const UGe=C(),zGe=C(),Co={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},kGe={dash:Co.dash,"dash-dot":[...Co.dash,...Co.dot],dot:Co.dot,"long-dash":Co["long-dash"],"long-dash-dot":[...Co["long-dash"],...Co.dot],"long-dash-dot-dot":[...Co["long-dash"],...Co.dot,...Co.dot],none:null,"short-dash":Co["short-dash"],"short-dash-dot":[...Co["short-dash"],...Co["short-dot"]],"short-dash-dot-dot":[...Co["short-dash"],...Co["short-dot"],...Co["short-dot"]],"short-dot":Co["short-dot"],solid:null},BGe=8;function VGe(t,e=2){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function Jyt(t,e=2){return{pattern:[t,t],pixelRatio:e}}function $me(t){return t!=null&&t.type==="style"?GGe(t.style):null}function GGe(t){return t!=null?VGe(kGe[t],BGe):null}const jGe=["polyline","polygon","extent"],uJ=new wA({size:!0,color:!0,rotation:!1,opacity:!0});let Ime=class Lme extends Vp{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){if(this._fastUpdates=Ix(this._context.renderer,uJ),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Jh(1))<0)throw new X("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=this.symbolLayer.marker!=null&&this._context.sharedResources.textures!=null?aBe(this._context.sharedResources.textures,_Ge(this.symbolLayer.marker.style)):null}_getMaterialParameters(e,r=!1){var n,o;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:lz(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:$me(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return(o=this._fastUpdates)!=null&&o.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return fo(this.symbolLayer.material,e=>e.color)}get _markerColor(){return fo(this.symbolLayer.marker,e=>e.color)}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new bw(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new bw(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new bw({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new bw({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&this._markerTexture!=null&&(this._markerMaterialCached=new LGe({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=vi(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Fo(Rke(e.size)):1}_getDrivenColor(e){const r=Ct(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,jGe,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new od);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return fs.RecreateSymbol;{const s=this._fastUpdates;if(!Lx(s,r,uJ))return fs.RecreateSymbol;this._forEachMaterial(n=>n.setParameters(s.materialParameters))}}return fs.FastUpdate}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((n=r.size)==null?void 0:n.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=lz(r.cap.newValue??"butt"),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){this._lineMaterialCached!=null&&e(this._lineMaterialCached),this._ringMaterialCached!=null&&e(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&e(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&e(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){var a,l;const i=e.parameters.color,s=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=Ct(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=TA(Lme.elevationModeChangeTypes,i,s);if(n!==Yi.UPDATE)return n;const o=Uu(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof Wr)return tv.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=Bs(),c=PGe(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),u=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let g=0;g<c.lines.length;g++){const y=c.lines[g],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(li(l),hc(l,v),!Nh(l,this._context.clippingExtent)))continue;const w=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,n.type,AE.ELEVATED,i);a.push(w),kr.LINE_WIREFRAMES&&a.push(w.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new Rm({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),p=new Bp(this,d,a,null,null,YUe,r);return p.alignedSampledElevation=c.sampledElevation,p.needsElevationUpdates=Uu(r.mode),p}_createGeometry(e,r,i,s,n,o,a){var _,v,w;const l=o===AE.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",u=(_=this._fastUpdates)==null?void 0:_.visualVariables.color,d=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,p=(w=this._fastUpdates)==null?void 0:w.visualVariables.opacity,g=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:i,size:d?null:this._getDrivenSize(r.renderingInfo),color:u?null:this._getDrivenColor(r.renderingInfo),sizeFeature:d?Hh(d.field,r.graphic):null,colorFeature:u?Hh(u.field,r.graphic):null,opacityFeature:p?Hh(p.field,r.graphic):null};return cz(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:y},g)}_createAsOverlay(e,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=kr.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=Bs(),d=li(),p=MGe(s,this._context.overlaySR),g=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,n,g,"LineSymbol3DLayer");for(const y of p.lines){if(li(u),hc(u,y.position),!Nh(u,this._context.clippingExtent))continue;cx(d,u);const _=v=>{const w=this._createGeometry(v,e,y.position,void 0,s.type,AE.DRAPED,i.uid),T=new kx(w,{layerUid:r,graphicUid:i.uid});c.push(T)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||hc(u,y.position,0,1),v!=="end"&&v!=="begin-end"||hc(u,y.position,y.position.length-3,1)}_(o),kr.LINE_WIREFRAMES&&_(a)}return new TD(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var r;return e=e??Jh(1),this._drivenProperties.size?(r=this._fastUpdates)!=null&&r.visualVariables.size?Fo(1):1:Fo(e)}_prepareMaterialPatch(e,r,i){var a;const s=r.material;if(s==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?fo(s.newValue,l=>l.color):((a=s.diff.color)==null?void 0:a.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(aA(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){const i=r.marker;if(i==null||i.type!=="partial"||i.diff.style!=null||i.diff.placement!=null||i.diff.color!=null&&i.diff.color.type!=="complete")return{changed:!1,useMaterialColor:this._markerColor==null};const s=i.diff.color;if(s==null)return delete r.marker,{changed:!1,useMaterialColor:this._markerColor==null};const n=s.newValue;return n==null?(delete r.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterialCached,e),delete r.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var AE;Ime.elevationModeChangeTypes={definedChanged:Yi.RECREATE,staysOnTheGround:Yi.NONE,onTheGroundChanged:Yi.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(AE||(AE={}));let aT=null,J$=!0;function d5(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(J$)try{return new ImageData(t,e)}catch{J$=!1}return Dme(t,e,r)}function HGe(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(J$)try{return new ImageData(t,e,r)}catch{J$=!1}const s=Dme(e,r,i);return s.data.set(t,0),s}function WGe(){return aT||(aT=document.createElement("canvas"),aT.width=1,aT.height=1),aT}function Dme(t,e,r){return r||(r=WGe()),r.getContext("2d").createImageData(t,e)}var Hb;const p5=new WeakMap;let qGe=0,Gd=Hb=class extends Ke{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const s={type:"image-element",src:ux(t.src,i),crossOrigin:t.crossOrigin};e[r]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[r]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:ux(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[r]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(p5.has(this.data)||p5.set(this.data,++qGe),e(p5.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new Hb(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return HGe(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new Hb({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new Hb({data:t}):ex(Hb,t)}};h([f({type:String,json:{write:A1}})],Gd.prototype,"url",null),h([f({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f()],Gd.prototype,"data",null),h([qr("data")],Gd.prototype,"writeData",null),h([Ur("data")],Gd.prototype,"readData",null),h([f({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Gd.prototype,"transparent",null),h([f({json:{write:!0}})],Gd.prototype,"wrap",void 0),h([f({readOnly:!0})],Gd.prototype,"contentHash",null),Gd=Hb=h([F("esri.geometry.support.MeshTexture")],Gd);const OE=Gd;var uz;let ph=uz=class extends Ke{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new uz(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){return{color:this.color!=null?this.color.clone():null,colorTexture:this.colorTexture!=null?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:this.normalTexture!=null?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform!=null?this.colorTextureTransform:null,normalTextureTransform:this.normalTextureTransform!=null?this.normalTextureTransform:null}}};h([f({type:ht,json:{write:!0}})],ph.prototype,"color",void 0),h([f({type:OE,json:{write:!0}})],ph.prototype,"colorTexture",void 0),h([f({type:OE,json:{write:!0}})],ph.prototype,"normalTexture",void 0),h([f({nonNullable:!0,json:{write:!0}})],ph.prototype,"alphaMode",void 0),h([f({nonNullable:!0,json:{write:!0}})],ph.prototype,"alphaCutoff",void 0),h([f({nonNullable:!0,json:{write:!0}})],ph.prototype,"doubleSided",void 0),h([f()],ph.prototype,"colorTextureTransform",void 0),h([f()],ph.prototype,"normalTextureTransform",void 0),ph=uz=h([F("esri.geometry.support.MeshMaterial")],ph);const xG=ph;var hz;let Zc=hz=class extends xG{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new hz(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor!=null?this.emissiveColor.clone():null,emissiveTexture:this.emissiveTexture!=null?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:this.occlusionTexture!=null?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.cloneWithDeduplication(t):null,occlusionTextureTransform:this.occlusionTextureTransform!=null?this.occlusionTextureTransform:null,emissiveTextureTransform:this.emissiveTextureTransform!=null?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform!=null?this.metallicRoughnessTextureTransform:null}}};h([f({type:ht,json:{write:!0}})],Zc.prototype,"emissiveColor",void 0),h([f({type:OE,json:{write:!0}})],Zc.prototype,"emissiveTexture",void 0),h([f({type:OE,json:{write:!0}})],Zc.prototype,"occlusionTexture",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Zc.prototype,"metallic",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Zc.prototype,"roughness",void 0),h([f({type:OE,json:{write:!0}})],Zc.prototype,"metallicRoughnessTexture",void 0),h([f()],Zc.prototype,"occlusionTextureTransform",void 0),h([f()],Zc.prototype,"emissiveTextureTransform",void 0),h([f()],Zc.prototype,"metallicRoughnessTextureTransform",void 0),Zc=hz=h([F("esri.geometry.support.MeshMaterialMetallicRoughness")],Zc);const Nme=Zc;var kP;const Fme="esri.geometry.support.MeshVertexAttributes",qv=ne.getLogger(Fme);let $c=kP=class extends Ke{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return Wb(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},qv)}castPosition(t){return t&&t instanceof Float32Array&&qv.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),Wb(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},qv)}castUv(t){return Wb(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},qv)}castNormal(t){return Wb(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},qv)}castTangent(t){return Wb(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},qv)}clone(){const t={position:ye(this.position),uv:ye(this.uv),normal:ye(this.normal),tangent:ye(this.tangent),color:ye(this.color)};return new kP(t)}clonePositional(){const t={position:ye(this.position),normal:ye(this.normal),tangent:ye(this.tangent),uv:this.uv,color:this.color};return new kP(t)}};function f5(t,e,r,i){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function Wb(t,e,r,i,s){if(!t)return t;if(t instanceof e)return f5(t,i,e,s);for(const n of r)if(t instanceof n)return f5(new e(t),i,e,s);if(Array.isArray(t))return f5(new e(t),i,e,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function lT(t,e,r){e[r]=YGe(t)}function YGe(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}h([f({json:{write:lT}})],$c.prototype,"color",void 0),h([Gi("color")],$c.prototype,"castColor",null),h([f({nonNullable:!0,json:{write:lT}})],$c.prototype,"position",void 0),h([Gi("position")],$c.prototype,"castPosition",null),h([f({json:{write:lT}})],$c.prototype,"uv",void 0),h([Gi("uv")],$c.prototype,"castUv",null),h([f({json:{write:lT}})],$c.prototype,"normal",void 0),h([Gi("normal")],$c.prototype,"castNormal",null),h([f({json:{write:lT}})],$c.prototype,"tangent",void 0),h([Gi("tangent")],$c.prototype,"castTangent",null),$c=kP=h([F(Fme)],$c);var MS;const Ume="esri.geometry.support.MeshComponent",XGe=ne.getLogger(Ume);let bf=MS=class extends Ke{static from(t){return ex(MS,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return Wb(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},XGe)}castMaterial(t){return ex(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?Nme:xG,t)}clone(){return new MS({faces:ye(this.faces),shading:this.shading,material:ye(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:ye(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new MS(r)}};h([f({json:{write:!0}})],bf.prototype,"faces",void 0),h([Gi("faces")],bf.prototype,"castFaces",null),h([f({type:xG,json:{write:!0}})],bf.prototype,"material",void 0),h([Gi("material")],bf.prototype,"castMaterial",null),h([f({type:String,json:{write:!0}})],bf.prototype,"shading",void 0),h([f({type:Boolean})],bf.prototype,"trustSourceNormals",void 0),bf=MS=h([F(Ume)],bf);const ZGe=bf,SD=ne.getLogger("esri.geometry.support.meshUtils.normalProjection");function JGe(t,e,r,i,s){return CD(i)?(ED(Xf.TO_PCPF,Os.fromTypedArray(t),Nu.fromTypedArray(e),Nu.fromTypedArray(r),i,Os.fromTypedArray(s)),s):(SD.error("Cannot convert spatial reference to PCPF"),s)}function Qyt(t,e,r,i,s){return CD(i)?(ED(Xf.FROM_PCPF,Os.fromTypedArray(t),Nu.fromTypedArray(e),Nu.fromTypedArray(r),i,Os.fromTypedArray(s)),s):(SD.error("Cannot convert to spatial reference from PCPF"),s)}function Kyt(t,e,r){return Xi(t,e,0,r,CL(e),0,t.length/3),r}function e_t(t,e,r){return Xi(t,CL(r),0,e,r,0,t.length/3),e}function QGe(t,e,r){return Sx(pn,r),G1(e,t,pn),L7(pn)||fD(e,e),e}function KGe(t,e,r){if(Sx(pn,r),G1(e,t,pn,4),L7(pn)||fD(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function eje(t,e,r,i,s){if(!CD(i))return SD.error("Cannot convert spatial reference to PCPF"),s;ED(Xf.TO_PCPF,Os.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Nu.fromTypedArray(e),Nu.fromTypedArray(r),i,Os.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function t_t(t,e,r,i,s){if(!CD(i))return SD.error("Cannot convert to spatial reference from PCPF"),s;ED(Xf.FROM_PCPF,Os.fromTypedArray(t,16),Nu.fromTypedArray(e),Nu.fromTypedArray(r),i,Os.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function ED(t,e,r,i,s,n){if(!e)return;const o=r.count,a=CL(s);if(zme(s))for(let l=0;l<o;l++)i.getVec(l,$O),e.getVec(l,bd),bu(a,$O,IO,a),Lu(pn,IO),t===Xf.FROM_PCPF&&Du(pn,pn),El(bd,bd,pn),n.setVec(l,bd);else for(let l=0;l<o;l++){i.getVec(l,$O),e.getVec(l,bd),bu(a,$O,IO,a),Lu(pn,IO);const c=EM(r.get(l,1));let u=Math.cos(c);t===Xf.TO_PCPF&&(u=1/u),pn[0]*=u,pn[1]*=u,pn[2]*=u,pn[3]*=u,pn[4]*=u,pn[5]*=u,t===Xf.FROM_PCPF&&Du(pn,pn),El(bd,bd,pn),fe(bd,bd),n.setVec(l,bd)}return n}function CD(t){return zme(t)||tje(t)}function zme(t){return t.isWGS84||Rre(t)||Lp(t)||Dp(t)}function tje(t){return t.isWebMercator}var Xf;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(Xf||(Xf={}));const $O=C(),bd=C(),IO=xe(),pn=Zi();let kme=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=Df.KTX2_ENCODING}};function h1(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function rje(t){return new Promise((e,r)=>{const i=new Blob([t]),s=new FileReader;s.onload=()=>{const n=s.result;e(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function ije(t,e){return e===Df.KTX2_ENCODING?new kme(t):new Promise((r,i)=>{const s=new Blob([t],{type:e}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=u=>{URL.revokeObjectURL(n),i(u),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function np(t){if(t==null)return null;const e=t.offset!=null?t.offset:Ope,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:Rpe,s=UP(1,0,0,0,1,0,e[0],e[1],1),n=UP(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=UP(i[0],0,0,0,i[1],0,0,0,1),a=Ha();return Tx(a,n,o),Tx(a,s,a),a}function sje(t){const e=new ur,{vertex:r,fragment:i}=e;return e.include(Ba,t),e.include(mv,t),e.include(hfe,t),Pl(r,t),t.stippleEnabled&&(e.attributes.add(S.UV0,"vec2"),e.attributes.add(S.AUXPOS1,"vec3"),r.uniforms.add(new Wt("viewport",(s,n)=>n.camera.fullViewport))),e.attributes.add(S.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(b`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(b`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new Se("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(b`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(b`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Se("stipplePatternPixelSize",s=>iG(s))),r.code.add(b`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(b`}`),t.output===L.Highlight&&e.include(Am,t),e.include(rs,t),i.uniforms.add(new Se("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new Wt("constantColor",s=>s.color)),i.code.add(b`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(Gn)}) {
      discard;
    }

    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Highlight?b`outputHighlight();`:""}
  }
  `),e}const nje=Object.freeze(Object.defineProperty({__proto__:null,build:sje},Symbol.toStringTag,{value:"Module"}));let Bme=class Vme extends gr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==L.Highlight}initializeProgram(e){return new pr(e.rctx,Vme.shader.get().build(this.configuration),cr)}initializePipeline(){const e=this.configuration,r=Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>xt({blending:n,depthTest:nG,depthWrite:o,colorWrite:$t,stencilWrite:e.hasOccludees?Mp:null,stencilTest:e.hasOccludees?s?Y0:sy:null});return e.output===L.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,Ya),i(!1,e.transparent||this._stippleEnabled?r:null,Ya)):i(!1)}get primitiveType(){return vt.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};Bme.shader=new dr(nje,()=>he(()=>import("./NativeLine.glsl-26353a93.js"),[]));let Wl=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};h([D({count:L.COUNT})],Wl.prototype,"output",void 0),h([D()],Wl.prototype,"hasSlicePlane",void 0),h([D()],Wl.prototype,"hasVertexColors",void 0),h([D()],Wl.prototype,"transparent",void 0),h([D()],Wl.prototype,"draped",void 0),h([D()],Wl.prototype,"stippleEnabled",void 0),h([D()],Wl.prototype,"stippleOffColorEnabled",void 0),h([D()],Wl.prototype,"stipplePreferContinuous",void 0),h([D()],Wl.prototype,"hasOccludees",void 0),h([D({constValue:!1})],Wl.prototype,"stippleRequiresClamp",void 0),h([D({constValue:!1})],Wl.prototype,"stippleScaleWithLineWidth",void 0),h([D({constValue:!1})],Wl.prototype,"stippleRequiresStretchMeasure",void 0);var Q$;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(Q$||(Q$={}));let hJ=class extends ry{constructor(e){super(e,new lje),this._configuration=new Wl}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===ae.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!Nle(r))return void ne.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(S.POSITION).data,l=i.camera,c=uje;Vs(c,i.point);const u=2;se(cT[0],c[0]-u,c[1]+u,0),se(cT[1],c[0]+u,c[1]+u,0),se(cT[2],c[0]+u,c[1]-u,0),se(cT[3],c[0]-u,c[1]-u,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(cT[_],Qp[_]))return;Io(l.eye,Qp[0],Qp[1],m5),Io(l.eye,Qp[1],Qp[2],g5),Io(l.eye,Qp[2],Qp[3],y5),Io(l.eye,Qp[3],Qp[0],_5);let d=Number.MAX_VALUE,p=0;for(let _=0;_<a.length-5;_+=3){if(Zo[0]=a[_]+r[12],Zo[1]=a[_+1]+r[13],Zo[2]=a[_+2]+r[14],Jo[0]=a[_+3]+r[12],Jo[1]=a[_+4]+r[13],Jo[2]=a[_+5]+r[14],Kr(m5,Zo)<0&&Kr(m5,Jo)<0||Kr(g5,Zo)<0&&Kr(g5,Jo)<0||Kr(y5,Zo)<0&&Kr(y5,Jo)<0||Kr(_5,Zo)<0&&Kr(_5,Jo)<0)continue;if(l.projectToRenderScreen(Zo,$y),l.projectToRenderScreen(Jo,Iy),$y[2]<0&&Iy[2]>0){le(wd,Zo,Jo);const w=l.frustum,T=-Kr(w[Qr.NEAR],Zo)/pe(wd,w[Qr.NEAR]);ee(wd,wd,T),oe(Zo,Zo,wd),l.projectToRenderScreen(Zo,$y)}else if($y[2]>0&&Iy[2]<0){le(wd,Jo,Zo);const w=l.frustum,T=-Kr(w[Qr.NEAR],Jo)/pe(wd,w[Qr.NEAR]);ee(wd,wd,T),oe(Jo,Jo,wd),l.projectToRenderScreen(Jo,Iy)}else if($y[2]<0&&Iy[2]<0)continue;$y[2]=0,Iy[2]=0;const v=KB(o1($y,Iy,fJ),c);v<d&&(d=v,te(dJ,Zo),te(pJ,Jo),p=_/3)}const g=i.rayBegin,y=i.rayEnd;if(d<u*u){let _=Number.MAX_VALUE;if(Koe(o1(dJ,pJ,fJ),o1(g,y,cje),My)){le(My,My,g);const v=Te(My);ee(My,My,1/v),_=v/ei(g,y)}o(_,My,p,!1)}}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(S.POSITION).data,l=e.vertexAttributes.get(S.SIZE),c=l?l.data[0]:0,u=s[0],d=s[1],p=((c+1)/2+4)*e.screenToWorldRatio;let g=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],T=u-v,x=d-w,E=a[_+3]-v,O=a[_+4]-w,A=me((E*T+O*x)/(E*E+O*O),0,1),$=E*A-T,M=O*A-x,U=$*$+M*M;U<g&&(g=U,y=_/3)}g<p*p&&n(o.dist,o.normal,y,!1)}requiresSlot(e,r){return!(r!==L.Color&&r!==L.Highlight&&r!==L.ObjectAndLayerIdColor||e!==ae.OPAQUE_MATERIAL&&e!==ae.DRAPED_MATERIAL)}createGLMaterial(e){return new oje(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?LBe:$Be;return this.parameters.stipplePattern==null?new v2(e):new aje(e.clone().vec3f(S.AUXPOS1).vec2f(S.UV0))}},oje=class extends ey{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===L.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(Bme,e)}},aje=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(S.POSITION).length}write(e,r,i,s,n){sde(i,this.vertexBufferLayout,e,r,s,n),this._writeAuxpos1(e,i,s,n),this._writeUV0(e,i,s,n)}_writeAuxpos1(e,r,i,s){const n=i.getField(S.AUXPOS1,Os),o=r.indices.get(S.POSITION),a=r.vertexAttributes.get(S.POSITION).data,l=e,c=n.typedBufferStride,u=n.typedBuffer;s*=c;for(let d=0;d<o.length-1;d+=2)for(const p of[1,0]){const g=3*o[d+p],y=a[g],_=a[g+1],v=a[g+2],w=l[0]*y+l[4]*_+l[8]*v+l[12],T=l[1]*y+l[5]*_+l[9]*v+l[13],x=l[2]*y+l[6]*_+l[10]*v+l[14];u[s]=w,u[s+1]=T,u[s+2]=x,s+=c}}_writeUV0(e,r,i,s){var x;const n=i.getField(S.UV0,ty),o=r.indices.get(S.POSITION),a=r.vertexAttributes.get(S.POSITION).data,l=(x=r.vertexAttributes.get(S.DISTANCETOSTART))==null?void 0:x.data,c=n.typedBufferStride,u=n.typedBuffer;let d=0;u[s*=c]=Q$.START,u[s+1]=d,s+=c;const p=3*o[0],g=se(Zo,a[p],a[p+1],a[p+2]);e&&De(g,g,e);const y=Jo,_=o.length-1;let v=1;const w=l?(E,O,A)=>d=l[A]:(E,O,A)=>d+=ei(E,O);for(let E=1;E<_;E+=2){const O=3*o[E];se(y,a[O],a[O+1],a[O+2]),e&&De(y,y,e),w(g,y,v++);for(let A=0;A<2;++A)u[s]=1-A,u[s+1]=d,s+=c;te(g,y)}const T=3*o[_];se(y,a[T],a[T+1],a[T+2]),e&&De(y,y,e),w(g,y,v),u[s]=Q$.END,u[s+1]=d}},lje=class extends OV{constructor(){super(...arguments),this.color=fu,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Zo=C(),Jo=C(),wd=C(),My=C(),$y=mo(),Iy=mo(),dJ=C(),pJ=C(),fJ=id(),cje=id(),uje=C(),cT=[mo(),mo(),mo(),mo()],Qp=[C(),C(),C(),C()],m5=_r(),g5=_r(),y5=_r(),_5=_r(),hje=["mesh"];let dje=class extends Vp{constructor(e,r,i,s){super(e,r,i,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){kr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new hJ({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new hJ({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,hje,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new od),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._materials.forEach(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=r(s);n!=null&&n.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,H0)}slicePlaneEnabledChanged(e,r){return this._materials.forEach(i=>{i.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const s=r(i);s!=null&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(r=>r.material.setParameters({usePBR:e})),!0}updateTransform(e,r,i){const s=this._context.renderCoordsHelper.spatialReference;bu(r,i.origin,gJ,s);const{stageObject:n}=e;return n.transformation=gJ,n.geometries.forEach(o=>o.transformation=i.localMatrix),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof ht?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_materialProperties(e,r,i){const s=this._materialPropertiesDefault(e,i);if(!r.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:u}=r.material,d=this._colorOrTextureUid(n),p=this._colorOrTextureUid(o),g=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${d},ctmuid:${p},ntmuid:${g},ds:${l},ac:${c},am:${u}`,r.material instanceof Nme){const{metallic:y,roughness:_,metallicRoughnessTexture:v,emissiveColor:w,emissiveTexture:T,occlusionTexture:x}=r.material,E=this._colorOrTextureUid(v),O=this._colorOrTextureUid(w),A=this._colorOrTextureUid(T),$=this._colorOrTextureUid(x);s.metallic=y,s.roughness=_,s.metallicRoughnessTexture=v,s.emissiveColor=w,s.emissiveTexture=T,s.occlusionTexture=x,s.colorTextureTransform=r.material.colorTextureTransform,s.normalTextureTransform=r.material.normalTextureTransform,s.emissiveTextureTransform=r.material.emissiveTextureTransform,s.occlusionTextureTransform=r.material.occlusionTextureTransform,s.metallicRoughnessTextureTransform=r.material.metallicRoughnessTextureTransform,s.uid=`${s.uid},mrm:${y},mrr:${_},mrt:${E},emuid:${O},etmuid:${A},otmuid:${$}`}return s}_setInternalColorValueParameters(e,r){r.diffuse=ht.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,Fr.Opaque);return r!=null?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const s=`${e.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new pv(h1(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!h1(i)&&r!==Fr.Opaque,encoding:h1(i)&&i.encoding!=null?i.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Ot.CLAMP_TO_EDGE;case"mirror":return Ot.MIRRORED_REPEAT;default:return Ot.REPEAT}}_setInternalMaterialParameters(e,r){if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);i!=null?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture!=null&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor!=null&&(r.emissiveFactor=ht.toUnitRGB(e.emissiveColor)),e.emissiveTexture!=null&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture!=null&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture!=null&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=np(e.colorTextureTransform),r.normalTextureTransformMatrix=np(e.normalTextureTransform),r.occlusionTextureTransformMatrix=np(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=np(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=np(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=fu;else{const s=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;s!=null?e.externalColor=ht.toUnitRGBA(s):(i=null,e.externalColor=fu)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var y,_,v;const i=(y=r.material)==null?void 0:y.color,s=(_=r.material)==null?void 0:_.colorTexture,n=(v=r.material)==null?void 0:v.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||s!=null&&s.transparent||o),l=this._materialProperties(e,r,a),c=this._materials.get(l.uid);if(c)return c.material;const u={material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},d=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,p={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Va,diffuse:zf,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:ti.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};d||(p.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),r.material&&(p.doubleSided=r.material.doubleSided,p.cullFace=r.material.doubleSided?ti.None:ti.Back,p.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const g=new pm(p);return u.material=g,this._materials.set(l.uid,u),this._context.stage.add(g),g}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Fr.MaskBlend:Fr.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?Fr.Opaque:r.alphaMode==="mask"?Fr.Mask:Fr.Blend}_addDebugNormals(e,r){const i=r.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let g=0;g<i;g++){const y=r[g],_=y.vertexAttributes.get(S.POSITION),v=y.vertexAttributes.get(S.NORMAL),w=y.indices.get(S.POSITION),T=y.indices.get(S.NORMAL),x=_.data,E=v.data;for(let O=0;O<w.length;O++){const A=3*w[O],$=3*T[O];for(let M=0;M<3;M++)o.push(x[A+M]);for(let M=0;M<3;M++)o.push(x[A+M]+E[$+M]*n);if(a.push(a.length),a.push(a.length),O%3==0){this._calculateFaceNormal(x,w,O,Zv),this._getFaceVertices(x,w,O,Kn,Yv,Xv),oe(Kn,Kn,Yv),oe(Kn,Kn,Xv),ee(Kn,Kn,1/3);for(let M=0;M<3;M++)l.push(Kn[M]);for(let M=0;M<3;M++)l.push(Kn[M]+Zv[M]*n);c.push(c.length),c.push(c.length)}}}const u=r[0].transformation,d=new Rs(this._debugVertexNormalMaterial,[[S.POSITION,new Le(o,3,!0)]],[[S.POSITION,a]],null,Wi.Line);r.push(d),d.transformation=u;const p=new Rs(this._debugFaceNormalMaterial,[[S.POSITION,new Le(l,3,!0)]],[[S.POSITION,c]],null,Wi.Line);p.transformation=u,r.push(p)}_createAs3DShape(e,r,i,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;kr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new Rm({geometries:a,layerUid:this._context.layer.uid,graphicUid:s});c.transformation=l;const u=vpe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=u!=null?new sze(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new Bp(this,c,a,null,null,wC,i,d);p.needsElevationUpdates=H0(i.mode),p.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:g,renderCoordsHelper:y}=this._context,_=(v,w)=>_2(v,g,i,y,w);return p.alignedSampledElevation=wC(p,i,g.spatialReference,_,y),p}_getCenterPointInElevationSR(e){const r=fv(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return Toe([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,r,i,s){if(r==null)return this._createComponentNormalsFlat(e,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,Zv);for(let a=0;a<3;a++){const l=3*s[o+a];Kn[0]=r[l],Kn[1]=r[l+1],Kn[2]=r[l+2],pe(Zv,Kn)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new v5(r,s,n)}_createComponentNormalsFlat(e,r){const i=Di(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(e,r,n,Zv);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new v5(i,s,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,Zv);for(let l=0;l<3;l++){const c=r[o+l];let u=i[c];u||(u={normal:C(),count:0},i[c]=u),oe(u.normal,u.normal,a),u.count++}}const s=Di(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(fe(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new v5(s,n,!1)}_getFaceVertices(e,r,i,s,n,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];s[0]=e[a],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,s){return this._getFaceVertices(e,r,i,Kn,Yv,Xv),le(Yv,Yv,Kn),le(Xv,Xv,Kn),Qe(Kn,Yv,Xv),fe(s,Kn),s}_getOrCreateComponents(e){return e.components??pje}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const s=r.reprojection===Zl.ECEF?r.transformBeforeProject:null;if(s!=null&&(i=Ux(new Float64Array(i.length),i,s)),r.reprojection===Zl.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=s!=null?i:new Float64Array(i.length);return Xi(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,r,i){let s=e.vertexAttributes.normal;if(s==null)return null;const n=i.reprojection===Zl.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=QGe(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Zl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return JGe(s,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let s=e.vertexAttributes.tangent;if(s==null)return null;const n=i.reprojection===Zl.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=KGe(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Zl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return eje(s,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var r,i;if(this._requiresSymbolVertexColors()){const s=this._getVertexOpacityAndColor(e),n=C7e((i=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:i.colorMixMode),o=new Uint8Array(4);return eme(s,n,o),o}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s!=null&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n!=null&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),d=this._createNormalBuffer(e,l,a),p=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:p,uvBuffer:n,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===Zl.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(e,l,d,p),geometryTransformation:a.reprojection===Zl.NONE&&a.geometryTransformation!=null?a.geometryTransformation:xe()}}_computeReprojectionInfo(e){const r=e.transform!=null,i=r&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===Re.Local?Zl.NONE:Zl.ECEF;if(r){if(i===Zl.NONE){const n=xe();return bu(e.spatialReference,e.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:n,geometryTransformation:fx(e.transform.localMatrix),needsBufferCopy:!1}}const s=fL(xe(),e.transform.origin);return qi(s,s,e.transform.localMatrix),{reprojection:i,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;LO[0]=o.x,LO[1]=o.y,LO[2]=o.z;const a=xe();return bu(e.spatialReference,LO,a,n),Wn(mJ,a),Ux(r,r,mJ),i==null&&s==null||(Lu(uT,a),Du(uT,uT),i!=null&&G1(i,i,uT),s!=null&&G1(s,s,uT,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??Cx(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return i==null||e.spatialReference.equals(i)?s=r:(s=new Float64Array(r.length),Xi(e.vertexAttributes.position,e.spatialReference,0,s,i,0,n)),li(b5),hc(b5,s,0,n),!Nh(b5,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!R1(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,r);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:d,geometryTransformation:p}=s,g=this._getOrCreateComponents(e),y=new Array;let _=!1;for(const v of g){if(!this._validateFaces(e,v))return null;const w=this._getOrCreateFaces(e,v);if(w.length===0)continue;const T=this._createComponentNormals(n,c,v,w);T.didFlipNormals&&(_=!0);const x=[[S.POSITION,new Le(n,3,!0)],[S.NORMAL,new Le(T.normals,3,!0)]],E=[[S.POSITION,w],[S.NORMAL,T.indices]];a!=null&&(x.push([S.COLOR,new Le(a,4,!0)]),E.push([S.COLOR,w])),l!=null&&(x.push([S.SYMBOLCOLOR,new Le(l,4,!0)]),E.push([S.SYMBOLCOLOR,d2(w.length)])),o!=null&&(x.push([S.UV0,new Le(o,2,!0)]),E.push([S.UV0,w])),u!=null&&(x.push([S.TANGENT,new Le(u,4,!0)]),E.push([S.TANGENT,w]));const O=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(e,v),$=new Rs(A,x,E,null,Wi.Mesh,O);$.transformation=p,y.push($)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:d}}},v5=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const LO=C(),Kn=C(),Yv=C(),Xv=C(),Zv=C(),mJ=xe(),uT=Zi(),gJ=xe(),b5=Bs(),pje=[new ZGe];var Zl;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Zl||(Zl={}));let fje=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){jV(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>_2(o,e,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=C()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,xd),De(e,this._lodRenderer.baseBoundingSphere.center,xd)}getBoundingBoxObjectSpace(e=Bs()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,xd);const r=this._lodRenderer.baseBoundingBox;li(e);for(let i=0;i<8;++i)se(Ic,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),De(Ic,Ic,xd),Ap(e,Ic);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,xd),e.render.origin[0]+=xd[12],e.render.origin[1]+=xd[13],e.render.origin[2]+=xd[14],e.render.num++}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=mje,l=CB(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,xd);for(let u=0;u<l;u++){const d=a[u];Ic[0]=o[d[0]],Ic[1]=o[d[1]],Ic[2]=o[d[2]],De(Ic,Ic,xd),Ly[3*u]=Ic[0],Ly[3*u+1]=Ic[1],Ly[3*u+2]=Ic[2]}if(!e(Ly,0,l))return null;li(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Ly[u+d]),o[d+3]=Math.max(o[d+3],Ly[u+d]);c&&i.push({location:Ly.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(Dh(o,w5),this.elevationContext.mode!=="absolute-height")){let u;const d=BV(o,r.service.spatialReference,r);try{u=await r.service.queryElevation(w5[0],w5[1],s,d,"ground")}catch{}u!=null&&xne(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,r){if(e===cm.Highlight){const i=new y$(e);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const Ly=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ic=C(),w5=C(),mje=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],xd=xe();function gje(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new gpe(r,i))}),{components:e,minScreenSpaceRadius:t.lodThreshold??0,pivotOffset:t.pivotOffset}}function yje(t){return{levels:t.map(e=>gje(e))}}function _je(t){return t=t||globalThis.location.hostname,vje.some(e=>(t==null?void 0:t.match(e))!=null)}function dz(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(Gme)!=null||e.match(Hme)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(jme)!=null||e.match(Wme)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const Gme=/^devext.arcgis.com$/,jme=/^qaext.arcgis.com$/,Hme=/^[\w-]*\.mapsdevext.arcgis.com$/,Wme=/^[\w-]*\.mapsqa.arcgis.com$/,vje=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,Gme,jme,/^jsapps.esri.com$/,Hme,Wme];function bje(t,e,r){if(t.count!==e.count)return void pD.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],d=r[7],p=r[8],g=r[9],y=r[10],_=r[11],v=r[12],w=r[13],T=r[14],x=r[15],E=t.typedBuffer,O=t.typedBufferStride,A=e.typedBuffer,$=e.typedBufferStride;for(let M=0;M<i;M++){const U=M*O,k=M*$,B=A[k],z=A[k+1],Y=A[k+2],W=A[k+3];E[U]=s*B+l*z+p*Y+v*W,E[U+1]=n*B+c*z+g*Y+w*W,E[U+2]=o*B+u*z+y*Y+T*W,E[U+3]=a*B+d*z+_*Y+x*W}}function wje(t,e,r){TG(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function TG(t,e,r,i=4,s=i){if(t.length/i!=e.length/s)return void pD.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],d=r[5],p=r[6],g=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const T=e[_],x=e[_+1],E=e[_+2],O=e[_+3];t[v]=o*T+c*x+p*E,t[v+1]=a*T+u*x+g*E,t[v+2]=l*T+d*x+y*E,t[v+3]=O,_+=s,v+=i}}function xje(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,u=n[c],d=n[c+1],p=n[c+2],g=u*u+d*d+p*p;if(g>0){const y=1/Math.sqrt(g);i[l]=y*u,i[l+1]=y*d,i[l+2]=y*p}}}function Tje(t,e,r){K$(t.typedBuffer,e,r,t.typedBufferStride)}function K$(t,e,r,i=4){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],t[l+3]=r*n[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:xje,scale:K$,scaleView:Tje,transformMat3:TG,transformMat3View:wje,transformMat4:bje},Symbol.toStringTag,{value:"Module"}));function Sje(t,e){SG(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function SG(t,e,r=2,i=r){const s=e.length/2;let n=0,o=0;if(Yh(e)||x1e(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=r,o+=i;return}const a=T1e(e);if(w1e(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=r,o+=i;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=r,o+=i}function Eje(t,e,r,i){const s=t.typedBuffer,n=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:Eje,normalizeIntegerBuffer:SG,normalizeIntegerBufferView:Sje},Symbol.toStringTag,{value:"Module"}));function Cje(t,e){$A(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function $A(t,e,r=3,i=r){const s=e.length/i;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=r,o+=i}function Aje(t,e,r,i,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:$A,copyView:Cje,fill:Aje},Symbol.toStringTag,{value:"Module"}));function Oje(t,e){EG(t.typedBuffer,e,t.typedBufferStride)}function EG(t,e,r=4){const i=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=s}function Rje(t,e,r,i,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:EG,copyView:Oje,fill:Rje},Symbol.toStringTag,{value:"Module"}));let qme=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return Ip(e)?(qt(r),_k(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await Es(r,{responseType:Pje[e]})).data;const s=await rm(this._streamDataRequester.request(r,e,i));if(s.ok===!0)return s.value;throw K1(s.error),new X("",`Request for resource failed: ${s.error}`)}};const Pje={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function Mje(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function $je(t,e={}){return{data:t,parameters:{wrap:{s:Ot.REPEAT,t:Ot.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let Bx=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new X(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new Bx(this.major,this.minor,this._context)}static parse(e,r=""){const[i,s]=e.split("."),n=/^\s*\d+\s*$/;if(!i||!i.match||!n.test(i))throw new X((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!n.test(s))throw new X((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(s,10);return new Bx(o,a,r)}};function BP(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:BP},Symbol.toStringTag,{value:"Module"}));let yJ=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var RE,_J;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(RE||(RE={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(_J||(_J={}));const Yme={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Ije={pbrMetallicRoughness:Yme,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Lje={ESRI_externalColorMixMode:"tint"},vJ=(t={})=>{const e={...Yme,...t.pbrMetallicRoughness},r=Dje({...Lje,...t.extras});return{...Ije,...t,pbrMetallicRoughness:e,extras:r}};function Dje(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const Nje={magFilter:wt.LINEAR,minFilter:wt.LINEAR_MIPMAP_LINEAR,wrapS:Ot.REPEAT,wrapT:Ot.REPEAT},Fje=t=>({...Nje,...t});function Uje(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(e=s||"",r=n||"","")),{dirPart:e,filePart:r}}const DO={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let zje=class zg{constructor(e,r,i,s){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=Uje(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new X("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new X("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new X("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(Ip(r)){const o=y1(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new zg(e,r,l)}catch{}const a=_k(r);if(zg._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new zg(e,r,o)}const s=await e.loadBinary(r,i);if(zg._isGLBData(s))return this._fromGLBData(e,r,s);const n=await e.loadJSON(r,i);return new zg(e,r,n)}static _isGLBData(e){if(e==null)return!1;const r=new yJ(e);return r.remainingBytes()>=4&&r.readUint32()===DO.MAGIC}static async _fromGLBData(e,r,i){const s=await zg._parseGLBData(i);return new zg(e,r,s.json,s.binaryData)}static async _parseGLBData(e){const r=new yJ(e);if(r.remainingBytes()<12)throw new X("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==DO.MAGIC)throw new X("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<n)throw new X("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new X("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),u=r.readUint32();if(l===0){if(u!==DO.CHUNK_TYPE_JSON)throw new X("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new X("gltf-loader-error","No JSON data found.");o=await rje(r.readUint8Array(c))}else if(l===1){if(u!==DO.CHUNK_TYPE_BIN)throw new X("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new X("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new X("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,r);if(s.byteLength!==i.byteLength)throw new X("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,r){if(!this.json.accessors)throw new X("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new X("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[RE.MAT2,RE.MAT3,RE.MAT4])throw new X("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=Vje[i.type],a=Gje[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case Ye.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case Ye.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case Ye.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case Ye.UNSIGNED_BYTE:return BP(this._wrapAccessor(Ex,i));case Ye.UNSIGNED_SHORT:return BP(this._wrapAccessor(BL,i));case Ye.UNSIGNED_INT:return BP(this._wrapAccessor(GL,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new X("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==Ye.FLOAT)throw new X("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Ye[i.componentType]);if(i.componentCount!==3)throw new X("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Os,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new X("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==Ye.FLOAT)throw new X("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Ye[i.componentType]);if(i.componentCount!==3)throw new X("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Os,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new X("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==Ye.FLOAT)throw new X("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Ye[i.componentType]);if(i.componentCount!==4)throw new X("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new ed(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new X("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new X("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===Ye.FLOAT)return this._wrapAccessor(ty,i);if(!i.normalized)throw new X("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return jje(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new X("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new X("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===Ye.FLOAT)return this._wrapAccessor(ed,i);if(i.componentType===Ye.UNSIGNED_BYTE)return this._wrapAccessor(wo,i);if(i.componentType===Ye.UNSIGNED_SHORT)return this._wrapAccessor(dA,i)}else if(i.componentCount===3){if(i.componentType===Ye.FLOAT)return this._wrapAccessor(Os,i);if(i.componentType===Ye.UNSIGNED_BYTE)return this._wrapAccessor(kL,i);if(i.componentType===Ye.UNSIGNED_SHORT)return this._wrapAccessor(VL,i)}throw new X("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Ye[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var n,o,a,l,c,u,d,p,g,y;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const _=e.material!=null?vJ(this.json.materials[e.material]):vJ(),v=_.pbrMetallicRoughness,w=this.hasVertexColors(e),T=this.getTexture(v.baseColorTexture,r),x=this.getTexture(_.normalTexture,r),E=i?this.getTexture(_.occlusionTexture,r):void 0,O=i?this.getTexture(_.emissiveTexture,r):void 0,A=i?this.getTexture(v.metallicRoughnessTexture,r):void 0,$=e.material!=null?e.material:-1;s={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:v.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await T,normalTexture:await x,name:_.name,id:$,occlusionTexture:await E,emissiveTexture:await O,emissiveFactor:_.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await A,hasVertexColors:w,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=v==null?void 0:v.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(p=(d=_.emissiveTexture)==null?void 0:d.extensions)==null?void 0:p.KHR_texture_transform,metallicRoughnessTextureTransform:(y=(g=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:g.extensions)==null?void 0:y.KHR_texture_transform}}return s}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new X("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,s=this.json.textures[i],n=Fje(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return Vte(this._textureCache,i,()=>{const c=d=>d===33071||d===33648||d===10497,u=d=>{throw new X("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:u(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:u(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return kje;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?r=qi(xe(),i,s.matrix):s.translation||s.rotation||s.scale?(r=fx(i),s.translation&&Wa(r,r,s.translation),s.rotation&&(NO[3]=q7(NO,s.rotation),Cl(r,r,NO[3],NO)),s.scale&&dL(r,r,s.scale)):r=fx(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return ac(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=Bx.parse(this.json.asset.version,"glTF");Bje.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new X("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new X("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new kme(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new X("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new X("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new X("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return ije(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await RF(Array.from(this._bufferLoaders.values())),r=await RF(Array.from(this._textureLoaders.values()));return e.reduce((i,s)=>i+((s==null?void 0:s.byteLength)??0),0)+r.reduce((i,s)=>i+(s?h1(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const kje=ooe(xe(),Math.PI/2),Bje=new Bx(2,0,"glTF"),NO=zu(),Vje={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gje={[Ye.BYTE]:1,[Ye.UNSIGNED_BYTE]:1,[Ye.SHORT]:2,[Ye.UNSIGNED_SHORT]:2,[Ye.FLOAT]:4,[Ye.INT]:4,[Ye.UNSIGNED_INT]:4};function jje(t){switch(t.componentType){case Ye.BYTE:return new jL(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ye.UNSIGNED_BYTE:return new zL(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ye.SHORT:return new pA(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ye.UNSIGNED_SHORT:return new j7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ye.UNSIGNED_INT:return new H7(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ye.FLOAT:return new ty(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let Hje=0;async function Xme(t,e,r={},i=!0){const s=await zje.load(t,e,r),n="gltf_"+Hje++,o={lods:[],materials:new Map,textures:new Map,meta:Wje(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await qje(s,async(u,d,p,g)=>{const y=l.get(p)??0;l.set(p,y+1);const _=u.mode!==void 0?u.mode:vt.TRIANGLES,v=_===vt.TRIANGLES||_===vt.TRIANGLE_STRIP||_===vt.TRIANGLE_FAN?_:null;if(v==null)return void ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+vt[_]+"). Skipping primitive.");if(!s.hasPositions(u))return void ne.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(u,r),T=s.getMaterial(u,r,i),x=s.hasNormals(u)?s.getNormalData(u,r):null,E=s.hasTangents(u)?s.getTangentData(u,r):null,O=s.hasTextureCoordinates(u)?s.getTextureCoordinates(u,r):null,A=s.hasVertexColors(u)?s.getVertexColors(u,r):null,$=s.getIndexData(u,r),M={transform:fx(d),attributes:{position:await w,normal:x?await x:null,texCoord0:O?await O:null,color:A?await A:null,tangent:E?await E:null},indices:await $,primitiveType:v,material:Xje(o,await T,n)};let U=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(U=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:g,lodThreshold:U},o.lods[p].parts[y]=M});for(const u of o.lods)u.parts=u.parts.filter(d=>!!d);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function Wje(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const s=i.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function qje(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),Yje(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=r.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=r.meshes[c.mesh];for(const p of d.primitives)n.push(e(p,u,l,d.name))}for(const d of c.children||[])n.push(o(d,l))}await Promise.all(n)}function Yje(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function Xje(t,e,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=$je(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:Zje.includes(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=Mje({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const Zje=[wt.LINEAR_MIPMAP_LINEAR,wt.LINEAR_MIPMAP_NEAREST];function Jje(t,e){switch(e){case vt.TRIANGLES:return Qje(t);case vt.TRIANGLE_STRIP:return Kje(t);case vt.TRIANGLE_FAN:return eHe(t)}}function Qje(t){return typeof t=="number"?Cx(t):Zg(t)?new Uint16Array(t):t}function Kje(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=g$(3*r);if(typeof t=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=t[n],i[s++]=t[n+1],i[s++]=t[n+2]):(i[s++]=t[n+1],i[s++]=t[n],i[s++]=t[n+2])}return i}function eHe(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const s=t[0];let n=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}let tHe=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},rHe=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new tHe,this.numberOfVertices=0}};const wf=ne.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function Zme(t,e){const r=await iHe(t,e),i=await lHe(r.textureDefinitions??{},e);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+Dde(r)}}async function iHe(t,e){const r=e!=null&&e.streamDataRequester;if(r)return sHe(t,r,e);const i=await rm(Es(t,e));if(i.ok===!0)return i.value.data;K1(i.error),Jme(i.error)}async function sHe(t,e,r){const i=await rm(e.request(t,"json",r));if(i.ok===!0)return i.value;K1(i.error),Jme(i.error.details.url)}function Jme(t){throw new X("",`Request for object resource failed: ${t}`)}function nHe(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(wf.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(wf.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(wf.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(wf.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else wf.warn("Indexed geometries must specify faces"),i=!1;break}default:wf.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(wf.warn("Geometry requires material"),i=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(wf.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function oHe(t,e){var y;const r=new Array,i=new Array,s=new Array,n=new p2,o=t.resource,a=Bx.parse(o.version||"1.0","wosr");uHe.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=t.textures;let p=0;const g=new Map;for(let _=0;_<c.length;_++){const v=c[_];if(!nHe(v))continue;const w=cHe(v),T=v.params.vertexAttributes,x=[];for(const z in T){const Y=T[z],W=Y.values;x.push([z,new Le(W,Y.valuesPerElement,!0)])}const E=[];if(v.params.topology!=="PerAttributeArray"){const z=v.params.faces;for(const Y in z)E.push([Y,z[Y].values])}const O=w.texture,A=d&&d[O];if(A&&!g.has(O)){const{image:z,parameters:Y}=A,W=new pv(z,Y);i.push(W),g.set(O,W)}const $=g.get(O),M=$?$.id:void 0,U=w.material;let k=n.get(U,O);if(k==null){const z=u[U.substring(U.lastIndexOf("/")+1)].params;z.transparency===1&&(z.transparency=0);const Y=A&&A.alphaChannelUsage,W=z.transparency>0||Y==="transparency"||Y==="maskAndTransparency",j=A?Qme(A.alphaChannelUsage):void 0,Z={ambient:yl(z.diffuse),diffuse:yl(z.diffuse),opacity:1-(z.transparency||0),transparent:W,textureAlphaMode:j,textureAlphaCutoff:.33,textureId:M,initTextureTransparent:!0,doubleSided:!0,cullFace:ti.None,colorMixMode:z.externalColorMixMode||"tint",textureAlphaPremultiplied:(A==null?void 0:A.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParamsMixin&&Object.assign(Z,e.materialParamsMixin),k=new pm(Z),n.set(U,O,k)}s.push(k);const B=new Rs(k,x,E);p+=((y=E.find(z=>z[0]===S.POSITION))==null?void 0:y[1].length)??0,r.push(B)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:aHe(r)}}function aHe(t){const e=li();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(Ap(e,i.bbMin),Ap(e,i.bbMax))}),e}async function lHe(t,e){const r=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){wf.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Ot.REPEAT,t:Ot.REPEAT},preMultiplyAlpha:Qme(u)!==Fr.Opaque},p=e!=null&&e.disableTextures?Promise.resolve(null):hm(l,e);r.push(p.then(g=>({refId:c,image:g,parameters:d,alphaChannelUsage:u})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function Qme(t){switch(t){case"mask":return Fr.Mask;case"maskAndTransparency":return Fr.MaskBlend;case"none":return Fr.Opaque;default:return Fr.Blend}}function cHe(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const uHe=new Bx(1,2,"wosr"),Jv=2.1;async function Kme(t,e){var d;const r=ege(dz(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):Zme(r.url,e)),{engineResources:g,referenceBoundingBox:y}=oHe(p,e);return{lods:g,referenceBoundingBox:y,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):Xme(new qme(e.streamDataRequester),r.url,e,e.usePBR)),s=(d=i.model.meta)==null?void 0:d.ESRI_proxyEllipsoid,n=i.meta.isEsriSymbolResource&&s!=null&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,fHe(i,s));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[0,1,.2]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},l={...e.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:u}=tge(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function ege(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function tge(t,e,r,i){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=li();return s.lods.forEach((u,d)=>{const p=i.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&d!==i.singleLodIndex;if(p&&d!==0)return;const g=new rHe(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(y=>{const _=p?new pm({}):hHe(s,y,g,e,r,o,a),{geometry:v,vertexCount:w}=dHe(y,_??new pm({})),T=v.boundingInfo;T!=null&&d===0&&(Ap(c,T.bbMin),Ap(c,T.bbMax)),_!=null&&(g.stageResources.geometries.push(v),g.numberOfVertices+=w)}),p||n.push(g)}),{engineResources:n,referenceBoundingBox:c}}function hHe(t,e,r,i,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const d=pHe(l.alphaMode);if(!n.has(a)){if(c){const E=(O,A=!1)=>{if(O!=null&&!o.has(O)){const $=t.textures.get(O);if($!=null){const M=$.data;o.set(O,new pv(h1(M)?M.data:M,{...$.parameters,preMultiplyAlpha:!h1(M)&&A,encoding:h1(M)&&M.encoding!=null?M.encoding:void 0}))}}};E(l.textureColor,d!==Fr.Opaque),E(l.textureNormal),E(l.textureOcclusion),E(l.textureEmissive),E(l.textureMetallicRoughness)}const g=l.color[0]**(1/Jv),y=l.color[1]**(1/Jv),_=l.color[2]**(1/Jv),v=l.emissiveFactor[0]**(1/Jv),w=l.emissiveFactor[1]**(1/Jv),T=l.emissiveFactor[2]**(1/Jv),x=l.textureColor!=null&&c?o.get(l.textureColor):null;n.set(a,new pm({...i,transparent:d===Fr.Blend,customDepthTest:L1.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[g,y,_],ambient:[g,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?ti.None:ti.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?fr.Attribute:fr.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:x!=null?x.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:x!=null&&!!x.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,w,T],mrrFactors:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:np(l.colorTextureTransform),normalTextureTransformMatrix:np(l.normalTextureTransform),occlusionTextureTransformMatrix:np(l.occlusionTextureTransform),emissiveTextureTransformMatrix:np(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:np(l.metallicRoughnessTextureTransform),...s}))}const p=n.get(a);if(r.stageResources.materials.push(p),c){const g=y=>{y!=null&&r.stageResources.textures.push(o.get(y))};g(l.textureColor),g(l.textureNormal),g(l.textureOcclusion),g(l.textureEmissive),g(l.textureMetallicRoughness)}return p}function dHe(t,e){const r=t.attributes.position.count,i=Jje(t.indices||r,t.primitiveType),s=Di(3*r),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;Ux(s,n,t.transform,3,o);const a=[[S.POSITION,new Le(s,3,!0)]],l=[[S.POSITION,i]];if(t.attributes.normal!=null){const c=Di(3*r),{typedBuffer:u,typedBufferStride:d}=t.attributes.normal;Sx(FO,t.transform),G1(c,u,FO,3,d),a.push([S.NORMAL,new Le(c,3,!0)]),l.push([S.NORMAL,i])}if(t.attributes.tangent!=null){const c=Di(4*r),{typedBuffer:u,typedBufferStride:d}=t.attributes.tangent;Sx(FO,t.transform),TG(c,u,FO,4,d),a.push([S.TANGENT,new Le(c,4,!0)]),l.push([S.TANGENT,i])}if(t.attributes.texCoord0!=null){const c=Di(2*r),{typedBuffer:u,typedBufferStride:d}=t.attributes.texCoord0;SG(c,u,2,d),a.push([S.UV0,new Le(c,2,!0)]),l.push([S.UV0,i])}if(t.attributes.color!=null){const c=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof ed?K$(c,t.attributes.color,255):t.attributes.color instanceof wo?EG(c,t.attributes.color):t.attributes.color instanceof dA&&K$(c,t.attributes.color,1/256):(c.fill(255),t.attributes.color instanceof Os?B$(c,t.attributes.color,255,4):t.attributes.color instanceof kL?$A(c,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof VL&&B$(c,t.attributes.color,1/256,4)),a.push([S.COLOR,new Le(c,4,!0)]),l.push([S.COLOR,i])}return{geometry:new Rs(e,a,l),vertexCount:r}}const FO=Zi();function pHe(t){switch(t){case"BLEND":return Fr.Blend;case"MASK":return Fr.Mask;case"OPAQUE":case null:case void 0:return Fr.Opaque}}function fHe(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=C(),c=C(),u=C(),d=new Uint8Array(4*a),p=new Float64Array(3*a),g=Wn(xe(),s.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),De(c,c,s.transform),le(u,c,e.center),RM(u,u,e.radius);const w=u[2],T=Te(u),x=Math.min(.45+.55*T*T,1);RM(u,u,e.radius),g!==null&&De(u,u,g),fe(u,u),r+1!==t.model.lods.length&&t.model.lods.length>1&&Pr(u,u,l,w>-1?.2:Math.min(-4*w-3.8,1)),p[y]=u[0],p[y+1]=u[1],p[y+2]=u[2],y+=3,d[_]=255*x,d[_+1]=255*x,d[_+2]=255*x,d[_+3]=255,_+=4}s.attributes.normal=new Os(p),s.attributes.color=new wo(d)}}}const g_t=Object.freeze(Object.defineProperty({__proto__:null,fetch:Kme,gltfToEngineResources:tge,parseUrl:ege},Symbol.toStringTag,{value:"Module"})),mHe=()=>!!ie("enable-feature:force-wosr"),y_t=()=>!!ie("enable-feature:direct-3d-object-feature-layer-display"),gHe=()=>ie.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),yHe=()=>ie.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),__t=()=>!!ie("enable-i3s-patching"),_He=()=>ie.add("enable-i3s-patching",!0,!0,!0),vHe=()=>ie.add("enable-i3s-patching",!1,!0,!0),v_t=()=>!!ie("enable-feature:SceneLayer-editing"),bHe=(t="i3s-patching")=>{switch(vHe(),yHe(),ie.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":gHe();break;case"i3s-patching":_He()}};bHe("i3s-patching");let x5={};async function wHe(t,e){try{return{data:(await CG(t,e)).data,baseUrl:wk(t),styleUrl:t}}catch(r){return K1(r),null}}function xHe(t,e,r){const i=e.portal!=null?e.portal:vc.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${t}`;return x5[n]||(x5[n]=THe(t,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),x5[n]}function THe(t,e,r){return e.load(r).then(()=>{const i=new Lf({disableExtraQuery:!0,query:`owner:${bJ} AND type:${wJ} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let s=null;const n=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===wJ&&a.owner===bJ){s=a;break}}if(!s)throw new X("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(r)})}function rge(t,e,r){return t&&t.styleUrl!=null?wHe(t.styleUrl,r):t&&t.styleName!=null?xHe(t.styleName,e,r):Promise.reject(new X("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function ige(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function sge(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!mHe())for(const i of r){const s=t.formatInfos.find(n=>n.type===i);if(s)return s.href}return t.webRef}function CG(t,e){const r={responseType:"json",query:{f:"json"},...e};return Es(Gf(t),r)}const bJ="esri_en",wJ="Style",SHe="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",hT={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function EHe(t,e=hT){var a,l;if(!t)return{symbol:null};const{retainId:r=hT.retainId,ignoreDrivers:i=hT.ignoreDrivers,hasLabelingContext:s=hT.hasLabelingContext,retainCIM:n=hT.retainCIM}=e;let o=null;if(O1(t)||t instanceof o2)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new X("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():l0.fromCIMSymbol(t)}else if(t instanceof iv)o=nL.fromSimpleLineSymbol(t);else if(t instanceof cL)o=l0.fromSimpleMarkerSymbol(t);else if(t instanceof aL)o=l0.fromPictureMarkerSymbol(t);else if(t instanceof IB)o=e.geometryType&&e.geometryType==="mesh"?oL.fromSimpleFillSymbol(t):lL.fromSimpleFillSymbol(t);else{if(!(t instanceof sA))return{error:new X("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?sL.fromTextSymbol(t):l0.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&O1(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function b_t(t,e,r,i){const s=nge(t,{},{context:i,isLabelSymbol:!1});s!=null&&(e[r]=s)}function w_t(t,e,r,i){const s=nge(t,{},{context:i,isLabelSymbol:!0});s!=null&&(e[r]=s)}function xJ(t){return t instanceof n2||t instanceof o2}function nge(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:s}=r,n=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(n==="web-scene"&&!xJ(t)){const a=EHe(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,i):(o==null||o.push(new X("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!Ixe(i==null?void 0:i.layer))&&xJ(t)?(o==null||o.push(new X("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function oge(t,e){return wAe(t,null,e)}function CHe(t,e,r,i){const s=t.name;return s==null?Promise.reject(new X("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?AHe(s,e,i):rge(t,e,i).then(n=>OG(gl(n),s,e,r,sge,i))}function AG(t,e){return e.items.find(r=>r.name===t)}function OG(t,e,r,i,s,n){var g;const o=r&&r.portal!=null?r.portal:vc.getDefault(),a={portal:o,url:da(t.baseUrl),origin:"portal-item"},l=AG(e,t.data);if(!l){const y=`The symbol name '${e}' could not be found`;return Promise.reject(new X("symbolstyleutils:symbol-name-not-found",y,{symbolName:e}))}let c=C1(s(l,i),a),u=((g=l.thumbnail)==null?void 0:g.href)??null;const d=l.thumbnail&&l.thumbnail.imageData;_je()&&(c=dz(c)??"",u=dz(u));const p={portal:o,url:da(wk(c)),origin:"portal-item"};return CG(c,n).then(y=>{const _=i==="cimRef"?ige(y.data):y.data,v=oge(_,p);if(v&&O1(v)){if(u){const w=C1(u,a);v.thumbnail=new s1({url:w})}else d&&(v.thumbnail=new s1({url:`data:image/png;base64,${d}`}));t.styleUrl?v.styleOrigin=new JE({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(v.styleOrigin=new JE({portal:r.portal,styleName:t.styleName,name:e}))}return v})}function AHe(t,e,r){const i=SHe.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:vc.getDefault();return CG(i,r).then(n=>{const o=ige(n.data);return oge(o,{portal:s,url:da(wk(i)),origin:"portal-item"})})}const OHe=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:OG,getStyleItemFromStyle:AG,resolveWebStyleSymbol:CHe},Symbol.toStringTag,{value:"Module"}));async function RHe(t){if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new X("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await rge(t,r).catch(()=>null);if(i===null)return null;const s=AG(e,i.data);if(s&&!s.formatInfos.some(a=>a.type==="gltf_basisu"))return null;const n=await OG(i,e,r,"webRef",(a,l)=>sge(a,l,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let PHe=class{constructor(e,r,i){this._elementSize=r,this._buffer=br.createVertex(e,hr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},MHe=class{constructor(e){this.modelOriginHi=e.getField(S.MODELORIGINHI,Os),this.modelOriginLo=e.getField(S.MODELORIGINLO,Os),this.model=e.getField(S.MODEL,k0),this.modelNormal=e.getField(S.MODELNORMAL,k0),this.featureAttribute=e.getField(S.INSTANCEFEATUREATTRIBUTE,ed),this.color=e.getField(S.INSTANCECOLOR,wo),this.objectAndLayerIdColor=e.getField(S.INSTANCEOBJECTANDLAYERIDCOLOR,wo)}},TJ=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){He(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){He(this._updating,"not updating"),this.size<h1e*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){He(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),He(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){He(this._updating,"not updating"),He(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(eI,Math.floor(this._capacity*AI));this._resize(e)}_shrink(){const e=Math.max(eI,Math.floor(this._capacity*u1e));this._resize(e)}_resize(e){if(He(this._updating,"not updating"),e===this._capacity)return;const r=new PHe(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);He(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new MHe(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const eI=64;var yi;function $He(t){let e=Ri().mat4f64(S.LOCALTRANSFORM).mat4f64(S.GLOBALTRANSFORM).vec4f64(S.BOUNDINGSPHERE).vec3f64(S.MODELORIGIN).mat3f(S.MODEL).mat3f(S.MODELNORMAL).vec2f(S.MODELSCALEFACTORS);return t.includes(S.FEATUREATTRIBUTE)&&(e=e.vec4f(S.FEATUREATTRIBUTE)),t.includes(S.COLOR)&&(e=e.vec4u8(S.COLOR)),t.includes(S.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(S.OBJECTANDLAYERIDCOLOR)),e=e.u8(S.STATE).u8(S.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(yi||(yi={}));let SJ=class{constructor(e){this.localTransform=e.getField(S.LOCALTRANSFORM,dC),this.globalTransform=e.getField(S.GLOBALTRANSFORM,dC),this.modelOrigin=e.getField(S.MODELORIGIN,Nu),this.model=e.getField(S.MODEL,k0),this.modelNormal=e.getField(S.MODELNORMAL,k0),this.modelScaleFactors=e.getField(S.MODELSCALEFACTORS,ty),this.boundingSphere=e.getField(S.BOUNDINGSPHERE,UL),this.featureAttribute=e.getField(S.FEATUREATTRIBUTE,ed),this.color=e.getField(S.COLOR,wo),this.objectAndLayerIdColor=e.getField(S.OBJECTANDLAYERIDCOLOR,wo),this.state=e.getField(S.STATE,Ex),this.lodLevel=e.getField(S.LODLEVEL,Ex)}},qb=class extends we{constructor(e,r){super(e),this.events=new ys,this._capacity=0,this._size=0,this._next=0,this._layout=$He(r),this._capacity=eI,this._buffer=this._layout.createBuffer(this._capacity),this._view=new SJ(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,yi.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;He(e>=0&&e<this._capacity&&(r.get(e)&yi.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,yi.ACTIVE)?this._setStateFlags(e,yi.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;He(e>=0&&e<this._capacity&&(r.get(e)&yi.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=tl,s=Ju;r.localTransform.getMat(e,EJ),r.globalTransform.getMat(e,T5);const n=qi(T5,T5,EJ);se(i,n[12],n[13],n[14]),r.modelOrigin.setVec(e,i),Lu(s,n),r.model.setMat(e,s);const o=TOe(tl,n);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),uv(s,s),Du(s,s),r.modelNormal.setMat(e,s),this._setStateFlags(e,yi.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,Ju),i.modelOrigin.getVec(e,tl),r[0]=Ju[0],r[1]=Ju[1],r[2]=Ju[2],r[3]=0,r[4]=Ju[3],r[5]=Ju[4],r[6]=Ju[5],r[7]=0,r[8]=Ju[6],r[9]=Ju[7],r[10]=Ju[8],r[11]=0,r[12]=tl[0],r[13]=tl[1],r[14]=tl[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(tl,this,e),r*=Math.max(tl[0],tl[1],tl[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(tl,this,e),r*=IHe(tl[0],tl[1],tl[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,yi.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,yi.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,yi.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,yi.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(eI,Math.floor(this._capacity*AI)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new SJ(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&yi.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function IHe(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}h([f({constructOnly:!0})],qb.prototype,"shaderTransformation",void 0),h([f()],qb.prototype,"_size",void 0),h([f({readOnly:!0})],qb.prototype,"size",null),qb=h([F("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],qb);const tl=C(),Ju=Zi(),EJ=xe(),T5=xe();let LHe=class extends zh{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=ss(),this._tmpMat4=xe()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);De(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*gx(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},DHe=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const s=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},NHe=class extends HL{constructor(e,r,i,s,n,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function RG(t){return nd(t)&&t.intersector===Ai.LOD&&!!t.target}let FHe=class{constructor(e,r){const i=e.renderContext.rctx,s=r.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=n.allocate(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new Afe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=br.createVertex(i,hr.STATIC_DRAW,l.buffer),this.vao=new sd(i,cr,{geometry:Dl(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,s,(u,d,p,g,y)=>{if(u>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,u))return;const _=new NHe(o.layerUid,o.graphicUid(n),c,p,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(Ai.LOD,_,u,d,e.transform.transform,y),e.options.store!==Yn.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(Ai.LOD,_,u,d,e.transform.transform,y),e.options.store===Yn.ALL){const v=eV(e.results.min.ray);v.set(Ai.LOD,_,u,d,e.transform.transform,y),e.results.all.push(v)}}})}},UHe=class age{static async create(e,r,i){const s=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new FHe(e,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(em);if(Js(i)||n.length!==s.length){n.forEach(o=>o.destroy()),qt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new age(r.minScreenSpaceRadius,n)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(e,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=li();this.components.forEach(r=>{r.boundingInfo!=null&&(Ap(e,r.boundingInfo.bbMin),Ap(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=C();Dh(e,r),this._boundingSphere={center:r,radius:.5*wne(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const zHe=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new DHe(e,r)};let Jc=class extends we{constructor(e,r){super(e),this.type=Ai.LOD,this.isGround=!1,this._handles=new Oi,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new ot,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[ae.OPAQUE_MATERIAL,ae.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new qb({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(r.registerTask(nt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=BHe(this.optionalFields),this._glInstanceBufferLayout=Dl(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(r=>r.forEach(i=>{e.cpu+=i.memoryUsage.cpu,e.gpu+=i.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=i.triangleCount;r.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new TJ(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new TJ(i,this._instanceBufferLayout)),UHe.create(e,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(em);if(Js(r)||n.length!==s.length){n.forEach(o=>o.destroy()),qt(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=zHe(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(ae.TRANSPARENT_MATERIAL,L.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!kr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(la),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>i.push(this._beginComponent(e,s[o],a)))})),i}render(e,r){const i=this._getInstanceDatas(e.output);if(!i)return;let s=0;e.rctx.bindVAO(),i.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[s++],n[a],l,a))}))}_getInstanceDatas(e){const r=e!==L.Highlight&&e!==L.ShadowHighlight,i=e!==L.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=C();le(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,OJ),e.transform.set(OJ),De(RJ,i,e.transform.inverse),De(PJ,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;He((l&yi.ACTIVE)!=0,"invalid instance state"),He(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,r,RJ,PJ,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new LHe(r,this.baseBoundingSphere);for(let s=0;s<r.capacity;++s)i.get(s)&yi.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Oe(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,zh.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(r,zh.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Td),le(Td,Td,n);const a=pe(Td,r)-Td[3];o.boundingSphere.getVec(s,Td),le(Td,Td,n);const l=pe(Td,r)+Td[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:s}=this;this._allRenderInstanceData.forEach(u=>u.forEach(d=>d.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;for(let u=0;u<a&&!e.done;++u){c===this._cycleStartIndex&&this._startUpdateCycle();const d=o.state.get(c);let p=0;if(!(d&yi.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const g=o.lodLevel.get(c);if(d&yi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][g].freeTail(),d&yi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][g].freeTail(),d&yi.REMOVE)n.freeInstance(c);else if(d&yi.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,AJ),y=s.selectLevel(AJ,n.getCombinedMedianScaleFactor(c),i)),p=d&~(yi.ACTIVE|yi.TRANSFORM_CHANGED),y>=0&&(d&yi.HIGHLIGHT?(CJ(this._highlightRenderInstanceData[0][y],o,c),p|=yi.HIGHLIGHT_ACTIVE):(CJ(this._defaultRenderInstanceData[0][y],o,c),p|=yi.DEFAULT_ACTIVE)),o.state.set(c,p),o.lodLevel.set(c,y)}else p=d&~(yi.ACTIVE|yi.TRANSFORM_CHANGED),o.state.set(c,p);if(this._octreeCached!=null){const y=!!(d&yi.ACTIVE),_=!!(p&yi.ACTIVE);!y&&_?this._octreeCached.addInstance(c):y&&!_?this._octreeCached.removeInstance(c):y&&_&&d&yi.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(u=>u.forEach(d=>d.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){const{bindParameters:s,rctx:n,output:o}=e;if(r.size===0||!i.material.requiresSlot(s.slot,e.output))return null;const a=i.glMaterials.load(n,s.slot,o);return a!=null?a.beginSlot(s):null}_renderComponent(e,r,i,s,n){if(!r)return;const{bindParameters:o,rctx:a}=e,l=a.bindTechnique(r,s.material.parameters,o);a.bindVAO(s.vao),r.ensureAttributeLocations(s.vao),l.bindDraw(VHe,o,s.material.parameters),kr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===L.Color&&(l.setUniform4fv("externalColor",MJ[Math.min(n,MJ.length-1)]),l.setUniform1i("colorMixMode",Khe.replace));const c=a.capabilities.instancing,u=i.capacity,d=i.headIndex,p=i.tailIndex,g=i.firstIndex,y=this._glInstanceBufferLayout,_=(v,w)=>{w7(a,cr,i.buffer,y,v),c.drawArraysInstanced(r.primitiveType,0,s.vertexCount,w-v),x7(a,cr,i.buffer,y)};s.material.parameters.transparent&&g!=null?d>p?(He(g>=p&&g<=d,"invalid firstIndex"),_(g,d),_(p,g)):d<p&&(g<=d?(He(g>=0&&g<=d,"invalid firstIndex"),_(g,d),_(p,u),_(0,g)):(He(g>=p&&g<=u,"invalid firstIndex"),_(g,u),_(0,d),_(p,g))):d>p?_(p,d):d<p&&(_(0,d),_(p,u)),a.bindVAO(null)}};function CJ(t,e,r){const i=t.allocateHead();kHe(e,r,t.view,i)}function kHe(t,e,r,i){aDe(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function BHe(t){let e=Ri().vec3f(S.MODELORIGINHI).vec3f(S.MODELORIGINLO).mat3f(S.MODEL).mat3f(S.MODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(S.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(S.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(S.INSTANCEOBJECTANDLAYERIDCOLOR)),e}h([f({constructOnly:!0})],Jc.prototype,"symbol",void 0),h([f({constructOnly:!0})],Jc.prototype,"optionalFields",void 0),h([f({constructOnly:!0})],Jc.prototype,"metadata",void 0),h([f({constructOnly:!0})],Jc.prototype,"shaderTransformation",void 0),h([f()],Jc.prototype,"_instanceData",void 0),h([f()],Jc.prototype,"_cycleStartIndex",void 0),h([f({readOnly:!0})],Jc.prototype,"_enableLevelSelection",null),h([f()],Jc.prototype,"_updateCyclesWithStaticCamera",void 0),h([f({readOnly:!0})],Jc.prototype,"running",null),Jc=h([F("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Jc);const AJ=C(),Td=Ht(),OJ=xe(),RJ=C(),PJ=C(),MJ=[Ct(1,0,1,1),Ct(0,0,1,1),Ct(0,1,0,1),Ct(1,1,0,1),Ct(1,0,0,1)],VHe=new k7e;let $J=class{constructor(e,r,i,s,n,o,a,l,c,u,d,p){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=d,this.pivotOffset=p}},GHe=class extends Vp{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,s){super(e,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&hD(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&oze(r.primitive)?r.primitive:Ine;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await RHe(this.symbol.styleOrigin),i=(r==null?void 0:r.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}_setMaterialTransparencyParams(e,r=(s=>(s=(i=>(i=this.symbolLayer)==null?void 0:i.material)())==null?void 0:s.color)()){const n=this._getCombinedOpacity(r),o=n<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=n,e.cullFace=o?ti.None:ti.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,s=Bs(KCe(e)),n=yl(n3(s)),o=yl(gN(n,i)),a=Te(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:zf,diffuse:zf,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!u.usePBR;this._setMaterialTransparencyParams(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:T,minWorldLength:x,maxWorldLength:E}=p.verticalOffset;u.verticalOffset={screenLength:Fo(T),minWorldLength:x||0,maxWorldLength:E??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=fu;else{const T=i.material!=null?i.material.color:null,x=T!=null?ht.toUnitRGBA(T):fu;u.externalColor=x}this._fastUpdates=Ix(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(S.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(S.COLOR)),ie("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(S.OBJECTANDLAYERIDCOLOR);const g=new pm(u),y=_pe(e,g);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=mO(y).map(T=>({opacity:1,transparent:T.parameters.transparent})),v=await this._createStageResources(y,d,r),w=await this._createLodRenderer(y,r);return new $J(y,w,v,_,n,l,c,s,o,a,d,null)}async _createResourcesForUrl(e,r){var k,B;const i={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=Ix(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(S.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(S.COLOR)),ie("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(S.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:z,minWorldLength:Y,maxWorldLength:W}=s.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:Fo(z),minWorldLength:Y||0,maxWorldLength:W??1/0},i.materialParamsMixin.castShadows=!1}i.signal=r,i.usePBR=this._context.physicalBasedRenderingEnabled,i.skipHighLods=this._context.skipHighSymbolLods;const n=i.usePBR,o=await Kme(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=yje(o.lods);c.levels.sort((z,Y)=>z.minScreenSpaceRadius-Y.minScreenSpaceRadius);const u=this._context,d=this.symbolLayer.material,p=this._getExternalColorParameters(d),g=(B=(k=this.symbolLayer)==null?void 0:k.material)==null?void 0:B.color,y=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=mO(c),w=mO(c).map(z=>({opacity:z.parameters.opacity||1,transparent:z.parameters.transparent}));v.forEach(z=>{const Y=z.parameters;z.setParameters(p);const W=Y.opacity*y,j=W<1||_||Y.transparent;z.setParameters({opacity:W,transparent:j}),u.screenSizePerspectiveEnabled&&z.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const T=o.referenceBoundingBox,x=yl(n3(T)),E=yl(c.levels[0].pivotOffset),O=yl(gN(x,this.symbolLayer)),A=Te(O),$=this._fastUpdates;Lx($,this._context.renderer,this._fastVisualVariableConvertOptions(T,O,x,E))&&v.forEach(z=>z.setParameters($.materialParameters));const M=await this._createStageResources(c,n,r),U=await this._createLodRenderer(c,r);return new $J(c,U,M,w,x,a,l,T,O,A,n,E)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const s=this._context.stage,n=mO(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=WX(e);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,i),qt(i);const a=qX(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,UO),en(u,kU(n.materialParameters,UO,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,UO),v8e(l,n.materialParameters,UO)}}:null,a=new Jc({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=fu:e!=null&&e.color!=null?r.externalColor=ht.toUnitRGBA(e.color):(r.externalColor=fu,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=TC(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new od),n=e.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var n,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const l=i[a],c=(o=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:o.color,u=s[a],d=this._getCombinedOpacity(c,{hasIntrinsicColor:r})*u.opacity,p=d<1||e||u.transparent;l.setParameters({opacity:d,transparent:p}),this._isPrimitive&&l.setParameters({cullFace:p?ti.None:ti.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,H0)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return fs.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!Lx(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return fs.RecreateSymbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return fs.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=ype(e.levels[0]).reduce((n,o)=>n+o.indices.get(S.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>o+ow(a.data),0)+Array.from(n.indices.values()).reduce((o,a)=>o+ow(a),0),s=WX(e).reduce((n,o)=>n+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+qX(e).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...wpe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(bo(r,Qv,this._context.elevationProvider.spatialReference),l!=null&&!SB(l,Qv))return null;const c=this._requiresTerrainElevation(s),u=this._computeGlobalTransform(r,s,S5,zO),d=this._computeLocalTransform(this._resources,this.symbolLayer,i,IJ),p=this._resources.lodRenderer.instanceData,g=p.addInstance();this._instanceIndexToGraphicUid.set(g,n),p.setLocalTransform(g,d,!1),p.setGlobalTransform(g,u),a&&p.setFeatureAttribute(g,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(g,bE(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(g,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const y=new fje(this,g,qUe,s);return c&&(y.alignedSampledElevation=zO.sampledElevation),y.needsElevationUpdates=H0(s.mode),xC(y,r,this._context.elevationProvider),y}_computeGlobalTransform(e,r,i,s){return _2(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),Qv[0]=e.x,Qv[1]=e.y,Qv[2]=s.z,bu(e.spatialReference,Qv,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,s){return $u(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(e,i,s),this._applyAnchor(e,r,s),s}_applyObjectScale(e,r,i){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:e.symbolSize,n=jX(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||dL(i,i,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&TC(r);if(i==null)return!1;const s=this.getGeometryElevationMode(r);return e.elevationContext.mode===s&&(this._computeGlobalTransform(i,e.elevationContext,S5,zO),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=zO.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,S5,!0),xC(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),d=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const p={heading:s,tilt:n,roll:o,anchor:u,anchorPosition:d},g=this._resources;this.loadStatus===sc.LOADED&&e.symbolLayerStatePatches.push(()=>{g.symbolSize=yl(gN(g.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(g,p,_,IJ),w=y.instanceIndex;g.lodRenderer.instanceData.setLocalTransform(w,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=s!=null?ht.toUnitRGBA(s):fu;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){var s;if(!((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)||!r)return NUe(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const s=C();switch(i.anchor){case"center":te(s,Dh(e)),zo(s,s);break;case"top":{const n=Dh(e);se(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=Dh(e);se(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=Dh(e),o=n3(e),a=i.anchorPosition,l=a?Ce(a.x,a.y,a.z):Va;GI(s,o,l),oe(s,s,n),zo(s,s);break}default:r!=null?zo(s,r):te(s,Va)}return s}_applyAnchor(e,r,i){var n;if((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);s&&Wa(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,s){const n=e!=null?yl(n3(e)):zf,o=e!=null?this._computeAnchor(e,s,this.symbolLayer):Va,a=this._context.renderCoordsHelper.unitInMeters,l=jX(r??void 0,r,i,a),c=Ce(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new wA({size:!0,color:!0,rotation:!0,opacity:!1},n,r??zf,a,o,l,c)}};const Qv=C(),IJ=xe(),S5=xe(),UO=Ht(),zO=new SA;let jHe=class{constructor(e,r,i,s){this.vertices=e,this.positionsES=r,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=i[a],c=i[a+1],u=i[a+2];this.origin=Ce(l,c,u),this.positions=Di(3*n);const d=this.offset+3*n;for(let p=this.offset;p<d;p+=3)this.positions[p]=i[p]-l,this.positions[p+1]=i[p+1]-c,this.positions[p+2]=i[p+2]-u;this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const s=this.positions;r.vRight[0]=s[i+3]-s[i],r.vRight[1]=s[i+4]-s[i+1],r.vRight[2]=s[i+5]-s[i+2],i+=3;let n=Te(r.vRight);r.vMinSiblingLength=n,fe(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[i+3]-s[i],l.vRight[1]=s[i+4]-s[i+1],l.vRight[2]=s[i+5]-s[i+2];const c=Te(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,fe(l.vRight,l.vRight)}else te(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,i+=3}}},HHe=class{constructor(e,r,i,s,n,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=QLe(1*this.numVerticesTotal),this.profileRightAxes=Di(4*this.numVerticesTotal),this.profileUpAxes=Di(4*this.numVerticesTotal),this.profileVertexAndNormals=Di(4*this.numVerticesTotal),this.positions=m$(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=m$(e,r,3*i.length);let s=0;const n=(a,l,c,u,d)=>this.emitCapVertex(s,a,l,c,u,d),o=(a,l,c,u)=>this.emitVertex(s,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=1;s<i.length-1;++s)this.extruder.extrude(i[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(i[s],n),s=i.length-1,this.endCap.rebuildCapGeometry(i[s],n)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,u,d)=>{n.push(c),n.push(u),n.push(d),o.push(c),o.push(u),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[d])};for(let c=0;c<r;++c){const u=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let p=0;p<i;++p){const g=p*e+u,y=(p+1)*e+d,_=p*e+d;l(g,(p+1)*e+u,y),l(g,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=bp(n),this.normalIndices=bp(o),this.pathVertexIndices=bp(a)}onPathChanged(){this._rebuildGeometry()}},PG=class{rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],0,0)}},LJ=class extends PG{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},kO=class extends PG{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const s=this.profilePlaneOffset;for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],s,0)}rebuildCapGeometry(e,r){const i=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=lge;Qt(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,n,s)}buildTopology(e,r){const i=this.profile,s=this.vertexBufferStart+i.indices[0];for(let n=1;n<i.numSegments;++n){const o=i.indices[2*n],a=i.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,s):r(s,l,c)}}},DJ=class extends PG{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const s=r.indices[2*i],n=r.indices[2*i+1];r.poleIndices[s]===r.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,s=e.frame,n=.5*this.sign,o=WHe,a=lge;Qt(a,0,0);for(const l of i.poles)l.normal?r(s,l.position,l.normal,n,0):r(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(s,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),d=Math.cos(c);for(let p=0;p<i.vertices.length;++p){const g=i.poles[i.poleIndices[p]];ip(o,i.vertices[p],g.position),Tl(o,o,u),g.normal?(Ch(o,o,g.position),r(s,o,g.normal,n*d,0)):(cC(a,o),Tl(a,a,u),Ch(o,o,g.position),r(s,o,a,n*d,this.sign*d))}}}buildTopology(e,r){const i=this.profile,s=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],u=this.vertexBufferStart+i.poleIndices[l];let d=s+a,p=s+l;for(let g=0;g<this.numSegments-1;++g){const y=n+g*i.vertices.length+a,_=n+g*i.vertices.length+l;this.flip?(r(y,p,d),r(p,y,_)):(r(d,p,y),r(_,y,p)),d=y,p=_}this.flip?(r(c,p,d),c!==u&&r(c,u,p)):(r(d,p,c),c!==u&&r(p,u,c))}}};const WHe=Ie(),lge=Ie();let qHe=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],!1)}},E5=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const s=XHe,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){bc(FJ,.5*-n+c*n/this.numBendSubdivisions,l),YHe(s,a,FJ);for(let u=0;u<r.vertices.length;++u)Is(r.vertices[u],o)*n>=0?i(s,r.vertices[u],r.normals[u],!1):i(a,e.applyMiterStretch(NJ,r.vertices[u]),r.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const u=Is(r.vertices[c],o)*n>=0;i(a,e.applyMiterStretch(NJ,r.vertices[c]),r.normals[c],!u)}}},cge=class{constructor(){this.up=C(),this.right=C()}};function YHe(t,e,r){De(t.up,e.up,r),De(t.right,e.right,r)}const NJ=Ie(),FJ=xe(),XHe=new cge;let ZHe=class extends Rs{constructor(e,r,i,s,n,o,a){super(e,r,i,null,Wi.Mesh,a),this.path=s,this.geometrySR=n,this.stencilWidth=o}};var wp;function uge(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(wp||(wp={}));let hge=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},dge=class extends hge{constructor(e){super(e),this.vertexAttributeColor=Ct(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Di(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let u=i[c];const d=u===0||u===s.vertices.length-1;u*=3;const p=tWe;let g=0,y=0;const _=4*c,v=se(rWe,o[_],o[_+1],o[_+2]),w=se(iWe,a[_],a[_+1],a[_+2]),T=Qt(UJ,l[_]*e[0],l[_+1]*e[1]);if(d)Qe(p,w,v),g=o[_+3]*e[0],y=a[_+3];else{const A=QHe,$=KHe;Qt(A,o[_+3],a[_+3]);const M=g7(A);cC(A,A);const U=Is(T,A);if(Math.abs(U)>M){Qt($,-A[1],A[0]);const k=Is(T,$);Tl(A,A,M*Math.sign(U)),Tl($,$,k),Ch(T,A,$)}se(p,0,0,0)}const x=se(eWe,v[0]*T[0]+w[0]*T[1],v[1]*T[0]+w[1]*T[1],v[2]*T[0]+w[2]*T[1]),E=3*c;this.vertexAttributePosition[E]=n[u]+x[0]+p[0]*g,this.vertexAttributePosition[E+1]=n[u+1]+x[1]+p[1]*g,this.vertexAttributePosition[E+2]=n[u+2]+x[2]+p[2]*g;const O=Qt(UJ,l[_+2],l[_+3]);W1(this.vertexAttributeNormal,c,v[0]*O[0]+w[0]*O[1]+p[0]*y,v[1]*O[0]+w[1]*O[1]+p[1]*y,v[2]*O[0]+w[2]*O[1]+p[2]*y)}}createGeometryData(){const e=this.builder.vertexIndices.length;return new pge([[S.POSITION,new Le(this.vertexAttributePosition,3,!0)],[S.NORMALCOMPRESSED,new Le(this.vertexAttributeNormal,2,!0)],[S.COLOR,new Le(this.vertexAttributeColor,4)]],[[S.POSITION,this.builder.vertexIndices],[S.NORMALCOMPRESSED,this.builder.normalIndices],[S.COLOR,d2(e)]])}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const s=this.builder.vertexIndices,n=new Le(this.vertexAttributePosition,3),o=s.length/3;_A(e,r,0,o,s,n,void 0,void 0,i)}},JHe=class extends hge{constructor(e,r,i,s){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new dge(e),this.vvData=Di(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return new pge([[S.POSITION,new Le(this.builder.positions,3,!0)],[S.PROFILERIGHT,new Le(this.builder.profileRightAxes,4,!0)],[S.PROFILEUP,new Le(this.builder.profileUpAxes,4,!0)],[S.PROFILEVERTEXANDNORMAL,new Le(this.builder.profileVertexAndNormals,4,!0)],[S.FEATUREVALUE,new Le(this.vvData,4,!0)]],[[S.POSITION,this.builder.pathVertexIndices],[S.PROFILERIGHT,this.builder.vertexIndices],[S.PROFILEUP,this.builder.vertexIndices],[S.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[S.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(S.POSITION);r&&(r.data=this.builder.positions)}},pge=class{constructor(e,r){this.vertexAttributes=e,this.indices=r}};const UJ=Ie(),QHe=Ie(),KHe=Ie(),eWe=C(),tWe=C(),rWe=C(),iWe=C();function sWe(t,e){let r=null;const i=t.vertices.length,s=.99619469809,n=C(),o=C(),a=C(),l=C(),c=C(),u=C(),d=_r();let p=t.vertices[0];te(o,e),se(n,0,1,0),_$(p.vRight,o,n,n,a,o,s),te(p.frame.up,o),te(p.frame.right,a);const g=t.positions;let y=t.offset;r=p;for(let _=1;_<i;++_){p=t.vertices[_],oe(c,p.vLeft,p.vRight);let v=Te(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=g[y]+r.frame.up[0],u[1]=g[y+1]+r.frame.up[1],u[2]=g[y+2]+r.frame.up[2],y+=3;const w=se(nWe,g[y],g[y+1],g[y+2]);lA(w,c,d),av(d,wc(u,p.vLeft),l)?(l[0]-=g[y],l[1]-=g[y+1],l[2]-=g[y+2],fe(o,l),Qe(a,c,o),fe(a,a)):_$(c,r.frame.up,r.frame.right,n,a,o,s),te(p.frame.up,o),te(p.frame.right,a),r=p}}const nWe=C();let fge=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(oS(e)),this.normals.push(oS(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:oS(e),normal:r?oS(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};const mge={top:[0,-.5],bottom:[0,.5]};function C5(t){const r=mpe,i=new fge,s={v0:0,v1:0};i.addPole(ir(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),u=ir(l*.5,c*.5),d=ir(l,c);i.addVertex(u,d)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,s)}const n={v0:r-1,v1:0};if(i.addSegment(n,s),t!=="center"){const o=mge[t];i.translate(o[0],o[1])}return i}const oWe={center:C5("center"),top:C5("top"),bottom:C5("bottom")},aWe={center:A5("center"),top:A5("top"),bottom:A5("bottom")};function A5(t){const i=new fge,s=ir(.5*-1,.5*-1),n=ir(.5*1,.5*-1),o=ir(.5*1,.5*1),a=ir(.5*-1,.5*1),l=ir(0,-1),c=ir(1,0),u=ir(0,1),d=ir(-1,0);if(i.addPole(ir(0,.5*1),u),i.addPole(ir(0,.5*1)),i.addPole(ir(0,.5*-1)),i.addPole(ir(0,.5*-1),l),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,u),i.addVertex(a,u),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,d),i.addVertex(s,d),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=mge[t];i.translate(p[0],p[1])}return i}function lWe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function cWe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function gge(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function uWe(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function hWe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*n-s*i;return o?(o=1/o,t[0]=n*o,t[1]=-i*o,t[2]=-s*o,t[3]=r*o,t):null}function dWe(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function pWe(t){return t[0]*t[3]-t[2]*t[1]}function yge(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*a+n*l,t[1]=s*a+o*l,t[2]=i*c+n*u,t[3]=s*c+o*u,t}function fWe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=s*l+o*a,t[2]=i*-a+n*l,t[3]=s*-a+o*l,t}function mWe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function gWe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function yWe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function _We(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function vWe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function bWe(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function wWe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function _ge(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function xWe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function TWe(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=ma();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}function SWe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function EWe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const CWe=yge,AWe=_ge;Object.freeze(Object.defineProperty({__proto__:null,LDU:bWe,add:wWe,adjoint:dWe,copy:lWe,determinant:pWe,equals:TWe,exactEquals:xWe,frob:vWe,fromRotation:gWe,fromScaling:yWe,identity:cWe,invert:hWe,mul:CWe,multiply:yge,multiplyScalar:SWe,multiplyScalarAndAdd:EWe,rotate:fWe,scale:mWe,set:gge,str:_We,sub:AWe,subtract:_ge,transpose:uWe},Symbol.toStringTag,{value:"Module"}));function vge(){return[1,0,0,1]}function OWe(t){return[t[0],t[1],t[2],t[3]]}function RWe(t,e,r,i){return[t,e,r,i]}function PWe(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:OWe,create:vge,createView:PWe,fromValues:RWe},Symbol.toStringTag,{value:"Module"}));let bge=class{constructor(){this.vLeft=C(),this.vRight=C(),this.vMinSiblingLength=0,this.frame=new cge}setFrameFromUpVector(e){te(this.frame.up,e),oe(pT,this.vLeft,this.vRight),fe(pT,pT),ee(BJ,this.frame.up,pe(pT,this.frame.up)),le(BO,pT,BJ),fe(BO,BO),Qe(this.frame.right,BO,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},MWe=class extends bge{get rotationFrameUp(){return this.frame.up}get rotationRight(){return Hoe}get rotationAngle(){return ee(tg,this.frame.up,pe(this.frame.up,this.vLeft)),le(tg,this.vLeft,tg),zo(tg,tg),fe(tg,tg),ee(eb,this.frame.up,pe(this.frame.up,this.vRight)),le(eb,this.vRight,eb),fe(eb,eb),Qe(tI,this.rotationFrameUp,this.vLeft),Math.sign(pe(tI,this.vRight))*(Math.PI-rn(pe(tg,eb)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const s=s6(Math.cos(.5*i));return Qt(e,(s-1+1)*r[0],r[1])}},$We=class extends bge{get rotationFrameUp(){const e=Math.sign(pe(this.frame.right,this.vRight));return Qe(dT,this.vRight,this.vLeft),ee(dT,dT,e),fe(dT,dT)}get rotationRight(){const e=this.rotationFrameUp,r=pe(e,this.frame.up),i=pe(e,this.frame.right);return ee(Kv,this.frame.up,-i),ee(kJ,this.frame.right,r),oe(Kv,Kv,kJ),fe(Kv,Kv),IWe(zJ,this.frame,Kv),zJ}get rotationAngle(){const e=Math.sign(pe(this.frame.right,this.vRight));return zo(tI,this.vLeft),-e*(Math.PI-rn(pe(tI,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*s6(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const s=s6(Math.cos(.5*i)),n=this.rotationRight,o=gge(DWe,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return $le(e,r,o)}};function IWe(t,e,r){Qt(t,pe(r,e.right),pe(r,e.up))}function LWe(t){switch(t){case wp.World:return new MWe;case wp.Path:return new $We}}const dT=C(),zJ=Ie(),Kv=C(),kJ=C(),tI=C(),tg=C(),eb=C(),BJ=C(),pT=C(),BO=C(),DWe=vge(),O5=8;function NWe(t,e){const r=S.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(b`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new mr("size",s=>s.size)),e.vvSize?(i.uniforms.add(new Mt("vvSizeMinSize",s=>s.vvSize.minSize),new Mt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Mt("vvSizeOffset",s=>s.vvSize.offset),new Mt("vvSizeFactor",s=>s.vvSize.factor)),i.code.add(b`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(b`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",O5),i.uniforms.add(new za("vvOpacityValues",s=>s.vvOpacity.values,O5),new za("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,O5)),i.code.add(b`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(b`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",Bw),i.uniforms.add(new za("vvColorValues",s=>s.vvColor.values,Bw),new wde("vvColorColors",s=>s.vvColor.colors,Bw)),i.code.add(b`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(b`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(hA),t.attributes.add(S.PROFILERIGHT,"vec4"),t.attributes.add(S.PROFILEUP,"vec4"),t.attributes.add(S.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(b`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(b`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(b`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(b`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let FWe=class extends xA{constructor(){super(...arguments),this.size=ir(1,1)}};function UWe(t){const e=new ur,{vertex:r,fragment:i}=e;switch(Pl(r,t),e.varyings.add("vpos","vec3"),e.include(NWe,t),t.output!==L.Color&&t.output!==L.Alpha||(e.include(Ba,t),e.include(H1,t),e.include(h2,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(b`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===L.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Tc,t),t.output){case L.Alpha:e.include(rs,t),i.uniforms.add(new Se("opacity",s=>s.opacity)),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case L.Color:e.include(rs,t),e.include(q1,t),e.include(RA,t),e.include(H1,t),e.include(Jfe,t),td(i,t),PA(i),b2(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Mt("ambient",s=>s.ambient),new Mt("diffuse",s=>s.diffuse),new Mt("specular",s=>s.specular),new Se("opacity",s=>s.opacity)),i.include(zp),Up(i),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===Ze.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:e.include(Ba,t),U1(e),e.varyings.add("depth","float"),r.code.add(b`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(rs,t),e.include(dm,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case L.Normal:e.include(Ba,t),e.include(AC,t),Px(r),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(rs,t),i.code.add(b`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case L.Highlight:e.include(Ba,t),e.include(AC,t),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(rs,t),e.include(Am,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const zWe=Object.freeze(Object.defineProperty({__proto__:null,build:UWe},Symbol.toStringTag,{value:"Module"})),wge=new Map([[S.POSITION,0],[S.PROFILERIGHT,1],[S.PROFILEUP,2],[S.PROFILEVERTEXANDNORMAL,3],[S.FEATUREVALUE,4]]);let kWe=class extends FWe{constructor(){super(...arguments),this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.specular=Ce(0,0,0),this.opacity=1}},xge=class Tge extends gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Re.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new pr(e.rctx,Tge.shader.get().build(this.configuration),wge)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===Ze.NONE,s=e===Ze.FrontFace;return xt({blending:r.output!==L.Color&&r.output!==L.Alpha||!r.transparent?null:i?gc:Om(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==Ni.None?Ble:null,depthTest:{func:iy(e)},depthWrite:i||s?Ya:null,colorWrite:$t,stencilWrite:r.hasOccludees?Mp:null,stencilTest:r.hasOccludees?sy:null,polygonOffset:i||s?null:lD})}};xge.shader=new dr(zWe,()=>he(()=>import("./Path.glsl-c800373b.js"),[]));let cn=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.doubleSidedMode=Ni.None,this.transparencyPassType=Ze.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};h([D({count:L.COUNT})],cn.prototype,"output",void 0),h([D({count:Ni.COUNT})],cn.prototype,"doubleSidedMode",void 0),h([D({count:Ze.COUNT})],cn.prototype,"transparencyPassType",void 0),h([D()],cn.prototype,"spherical",void 0),h([D()],cn.prototype,"receiveShadows",void 0),h([D()],cn.prototype,"receiveAmbientOcclusion",void 0),h([D()],cn.prototype,"vvSize",void 0),h([D()],cn.prototype,"vvColor",void 0),h([D()],cn.prototype,"vvOpacity",void 0),h([D()],cn.prototype,"hasSlicePlane",void 0),h([D()],cn.prototype,"transparent",void 0),h([D()],cn.prototype,"hasOccludees",void 0),h([D()],cn.prototype,"hasMultipassTerrain",void 0),h([D()],cn.prototype,"cullAboveGround",void 0),h([D()],cn.prototype,"doublePrecisionRequiresObfuscation",void 0),h([D({constValue:Xe.Disabled})],cn.prototype,"pbrMode",void 0),h([D({constValue:!0})],cn.prototype,"hasVvInstancing",void 0),h([D({constValue:!1})],cn.prototype,"useCustomDTRExponentForWater",void 0),h([D({constValue:!1})],cn.prototype,"useFillLights",void 0);let BWe=class Sge extends ry{constructor(e){super(e,new GWe),this.supportsEdges=!0,this._vertexAttributeLocations=wge,this._configuration=new cn,this._vertexBufferLayout=Sge.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==L.Color&&e!==L.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ni.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ni.WindingOrder:Ni.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==L.Shadow&&e!==L.ShadowExcludeHighlight&&e!==L.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,s,n,o){const a=e;if(!uge(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:w,minSize:T,maxSize:x}=this.parameters.vvSize,E=l.sizeAttributeValue;c[0]*=me(v[0]+E*w[0],T[0],x[0]),c[1]*=me(v[2]+E*w[2],T[2],x[2])}const u=Math.max(c[0],c[1]),d=e.boundingInfo;if(d==null)return void this._intersectTriangles(l,c,s,n,o);const p=E1(d.bbMin[0]-u,d.bbMin[1]-u,d.bbMin[2]-u,d.bbMax[0]+u,d.bbMax[1]+u,d.bbMax[2]+u),g=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),_=[y/g[0],y/g[1],y/g[2]];CV(p,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,r,i,s,n){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,s,n)}createBufferWriter(){return new v2(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case L.Color:case L.Alpha:case L.Depth:case L.Normal:case L.Highlight:case L.ObjectAndLayerIdColor:return e===(this.parameters.transparent?ae.TRANSPARENT_MATERIAL:ae.OPAQUE_MATERIAL)||e===ae.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new VWe(e)}static getVertexBufferLayout(){return Ri().vec3f(S.POSITION).vec4f(S.PROFILERIGHT).vec4f(S.PROFILEUP).vec4f(S.PROFILEVERTEXANDNORMAL).vec4f(S.FEATUREVALUE)}},VWe=class extends ey{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(xge,e)}},GWe=class extends kWe{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const jWe=["polyline"];let HWe=class extends Vp{constructor(e,r,i,s){super(e,r,i,s),this._intrinsicSize=ir(1,1),this._upVectorAlignment=wp.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){var p,g,y,_;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new wA({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((g=(p=this._context.renderer)==null?void 0:p.visualVariables)==null?void 0:g.length)>0?Ix(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?wp.World:wp.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=oWe[i];break;case"quad":this._profile=aWe[i]}switch(this.symbolLayer.join){case"round":this._extruder=new E5(0,fpe);break;case"bevel":this._extruder=new E5(0,1);break;case"miter":this._extruder=new E5(.8*Math.PI,1);break;default:this._extruder=new qHe}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new LJ,this._endCap=new LJ;break;case"butt":default:this._startCap=new kO(this._profile,0),this._endCap=new kO(this._profile,0,!0);break;case"square":this._startCap=new kO(this._profile,-.5),this._endCap=new kO(this._profile,.5,!0);break;case"round":{const v=s==="quad";this._startCap=new DJ({profile:this._profile,flip:!1,breakNormals:v,subdivisions:YU}),this._endCap=new DJ({profile:this._profile,flip:!0,breakNormals:v,subdivisions:YU});break}}const o=(_=(y=this.symbolLayer)==null?void 0:y.material)==null?void 0:_.color,a=this._getCombinedOpacityAndColor(o),l=yl(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||n==="none"?ti.None:ti.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Qt(this._intrinsicSize,e,r),!qU(this._intrinsicSize[0])||!qU(this._intrinsicSize[1])))throw new X("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||Tl(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const v={...d,...this._fastUpdates.materialParameters,size:zoe(this._intrinsicSize)};this._material=new BWe(v)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=fr.Compressed,this._material=new pm(d);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,jWe,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new od),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){var s,n;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,H0)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!Lx(this._fastUpdates,r,this._vvConvertOptions))return fs.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return fs.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of i)r+=d.length;const l=go(3*r);let c,u=0;for(const d of i){s.push({offset:u,numVertices:d.length});for(const p of d)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||n.equals(o)||Xi(l,n,0,l,o,0,r)?(o==null||o.equals(a)?c=sue(l):(c=go(3*r),Xi(l,o,0,c,a,0,r)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,s){var y,_,v;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(w=>w.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=Bs(),u=this._context.renderCoordsHelper,d=new yV(o.vertexDataES);for(const w of o.pathVertexDataInfos){const T=w.numVertices;if(T<2)continue;const x=w.offset;if(this._context.clippingExtent!=null&&(li(c),hc(c,o.vertexDataES,x,T),!Nh(c,this._context.clippingExtent)))continue;const E=new Array,O=x+3*T;for(let Y=x;Y<O;Y+=3){d.offset=Y;const W=FUe(d,this._context.elevationProvider,i,u);se(es,o.vertexDataRS[Y],o.vertexDataRS[Y+1],o.vertexDataRS[Y+2]),u.setAltitude(es,W),o.vertexDataRS[Y]=es[0],o.vertexDataRS[Y+1]=es[1],o.vertexDataRS[Y+2]=es[2],E.push(LWe(this._upVectorAlignment))}const A=new jHe(E,o.vertexDataES,o.vertexDataRS,x);Ege(A,this._upVectorAlignment,this._context.renderCoordsHelper);const $=new HHe(A,this._profile,this._extruder,this._startCap,this._endCap);let M=null;if(this._fastUpdates){const Y=this._fastUpdates.visualVariables,W=Hh((y=Y.size)==null?void 0:y.field,e)??0,j=Hh((_=Y.color)==null?void 0:_.field,e)??0,Z=Hh((v=Y.opacity)==null?void 0:v.field,e)??0;M=new JHe($,W,j,Z)}else{const Y=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Z=r.size;Y[0]*=VJ(Z[0],Z[2]==="symbol-value"?this.symbolLayer.height||0:Z[2],this.symbolLayer.width||0),Y[1]*=VJ(Z[2],Z[0]==="symbol-value"?this.symbolLayer.width||0:Z[0],this.symbolLayer.height||0)}let W;this._drivenProperties.color&&(W=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(W=W?[W[0],W[1],W[2],r.opacity]:[1,1,1,r.opacity]);const j=new dge($);j.bake(Y),W&&j.bakeVertexColors(W),M=j}const{vertexAttributes:U,indices:k}=M.createGeometryData(),B=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),z=new ZHe(this._material,U,k,M,l,this._stencilWidth,B);z.transformation=Wa(xe(),qa,$.path.origin),a.push(z)}if(a.length===0)return null;const p=new Rm({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),g=new Bp(this,p,a,null,null,(w,T,x,E,O)=>qWe(w,T,E,O,this._upVectorAlignment),i);return g.alignedSampledElevation=0,g.needsElevationUpdates=H0(i.mode),g}};function Ege(t,e,r){const{origin:i,positions:s}=t;let n=t.offset;switch(e){default:case wp.World:for(const o of t.vertices)es[0]=s[n++]+i[0],es[1]=s[n++]+i[1],es[2]=s[n++]+i[2],r.worldUpAtPosition(es,es),o.setFrameFromUpVector(es);break;case wp.Path:es[0]=s[n]+i[0],es[1]=s[n+1]+i[1],es[2]=s[n+2]+i[2],r.worldUpAtPosition(es,es),sWe(t,es)}}function VJ(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function WWe(t,e,r,i){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)se(es,l[u],l[u+1],l[u+2]),r(es,R5),s+=R5.sampledElevation,es[0]=a[u]+n[0],es[1]=a[u+1]+n[1],es[2]=a[u+2]+n[2],i.setAltitude(es,R5.z),a[u]=es[0]-n[0],a[u+1]=es[1]-n[1],a[u+2]=es[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function qWe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!uge(l))continue;const c=l.path,u=c.builder.path;a+=WWe(u,e,r,i),s!==wp.World&&Ege(u,s,i),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const es=C(),R5=new SA;function YWe(t,e,r,i,s=1){if(r.isGeographic&&i===Re.Global){const c=go(e.length),u=e.length,d=Cr(r);for(let p=0;p<u;p+=3)GB(e,p,c,p,d);e=c}Qt(Ds,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Ds[0]=Math.min(Ds[0],e[c]),Ds[1]=Math.min(Ds[1],e[c+1]);const n=Ds[0]%s,o=Ds[1]%s,a=Ds[0]-n,l=Ds[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/s,t[u+1]=(e[c+1]-l)/s,t[u+2]=a/s,t[u+3]=l/s}}function Cge(t,e,r,i,s=1){se(Dy,1,0,0),se(Ny,0,1,0),se(rb,0,0,1),JWe(P5,r),XWe(r,GJ)&&ZWe(GJ,Dy,Ny,rb,i,P5),Qt(Ds,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Qt(Fy,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){se(tb,r[u],r[u+1],r[u+2]);const d=pe(Dy,tb),p=pe(Ny,tb);Ds[0]=Math.min(Ds[0],d),Ds[1]=Math.min(Ds[1],p),Fy[0]=Math.max(Fy[0],d),Fy[1]=Math.max(Fy[1],p)}const n=pe(rb,P5);$5(rg,Ds[0],Ds[1],n,Dy,Ny,rb),$5(Uy,Fy[0],Ds[1],n,Dy,Ny,rb),$5(zy,Ds[0],Fy[1],n,Dy,Ny,rb),le(Uy,Uy,rg),ee(Uy,Uy,.5),le(zy,zy,rg),ee(zy,zy,.5),oe(rg,rg,Uy),oe(rg,rg,zy);const o=Ds[0]%s,a=Ds[1]%s,l=Ds[0]-o,c=Ds[1]-a;for(let u=0;u<r.length;u+=3){se(tb,r[u],r[u+1],r[u+2]);const d=u/3,p=4*d;t[p]=(pe(Dy,tb)-l)/s,t[p+1]=(pe(Ny,tb)-c)/s,t[p+2]=l/s,t[p+3]=c/s;const g=9*d;for(let y=0;y<3;y++)e[g+y]=rg[y],e[g+y+3]=Uy[y],e[g+y+6]=zy[y]}}const P5=C(),tb=C(),GJ=_r(),Dy=C(),Ny=C(),rb=C(),Ds=Ie(),Fy=Ie(),rg=C(),Uy=C(),zy=C();function XWe(t,e){const r=t.length/3-1;return dae(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function ZWe(t,e,r,i,s,n){s!=null?(s.basisMatrixAtPosition(n,Sd),se(VO,Sd[0],Sd[1],Sd[2]),se(GO,Sd[4],Sd[5],Sd[6]),se(M5,Sd[8],Sd[9],Sd[10])):(se(VO,1,0,0),se(GO,0,1,0),se(M5,0,0,1));const o=t;pe(o,M5)<0&&ee(o,o,-1),te(i,o);const a=pe(o,GO),l=pe(o,VO);Math.abs(a)<Math.abs(l)?(W_(e,VO,o,-l),fe(e,e),Qe(r,e,o),fe(r,r),ee(r,r,-1)):(W_(r,GO,o,-a),fe(r,r),Qe(e,r,o),fe(e,e))}const Sd=xe(),VO=C(),GO=C(),M5=C();function JWe(t,e){se(fT,0,0,0);for(let r=0;r<e.length-3;r+=3)fT[0]+=e[r],fT[1]+=e[r+1],fT[2]+=e[r+2];ee(t,fT,1/(e.length/3-1))}const fT=C();function $5(t,e,r,i,s,n,o){se(t,e*s[0]+r*n[0]+i*o[0],e*s[1]+r*n[1]+i*o[1],e*s[2]+r*n[2]+i*o[2])}function QWe(t){const e=new ur,{vertex:r,fragment:i,attributes:s,varyings:n}=e;Pl(r,t),e.include(Ba,t),e.include(mv,t),e.include(E0,t),e.include(bA,t),s.add(S.POSITION,"vec3"),t.vvColor&&s.add(S.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha);o&&n.add("depth","float"),r.uniforms.add(new Wt("eColor",c=>c.color));const a=t.output===L.Depth;a&&(e.include(dm,t),U1(e),z0(e)),r.code.add(b`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(rs,t),o&&e.include(Tc,t),i.include(zp);const l=t.output===L.Highlight;return l&&e.include(Am,t),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${t.output===L.ObjectAndLayerIdColor?b`fColor.a = 1.0;`:""}

    if (fColor.a < ${b.float(Gn)}) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(fColor.a);`:""}

    ${t.output===L.Color?b`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===Ze.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?b`outputHighlight();`:""};
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""};
    ${t.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const KWe=Object.freeze(Object.defineProperty({__proto__:null,build:QWe},Symbol.toStringTag,{value:"Module"}));let Age=class Oge extends gr{initializeProgram(e){return new pr(e.rctx,Oge.shader.get().build(this.configuration),cr)}_createPipeline(e,r){const i=this.configuration,s=e===Ze.NONE,n=e===Ze.FrontFace;return xt({blending:i.output!==L.Color&&i.output!==L.Alpha||!i.transparent?null:s?gc:Om(e),culling:IL(i.cullFace),depthTest:{func:iy(e)},depthWrite:(s||n)&&i.writeDepth?Ya:null,colorWrite:$t,stencilWrite:i.hasOccludees?Mp:null,stencilTest:i.hasOccludees?r?Y0:sy:null,polygonOffset:s||n?i.polygonOffset?eqe:null:cD(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};Age.shader=new dr(KWe,()=>he(()=>import("./ColorMaterial.glsl-6ad398e4.js"),[]));const eqe={factor:1,units:1};let to=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.cullFace=ti.None,this.transparencyPassType=Ze.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};h([D({count:L.COUNT})],to.prototype,"output",void 0),h([D({count:ti.COUNT})],to.prototype,"cullFace",void 0),h([D({count:Ze.COUNT})],to.prototype,"transparencyPassType",void 0),h([D()],to.prototype,"hasSlicePlane",void 0),h([D()],to.prototype,"hasVertexColors",void 0),h([D()],to.prototype,"transparent",void 0),h([D()],to.prototype,"polygonOffset",void 0),h([D()],to.prototype,"enableOffset",void 0),h([D()],to.prototype,"writeDepth",void 0),h([D()],to.prototype,"hasOccludees",void 0),h([D()],to.prototype,"hasMultipassTerrain",void 0),h([D()],to.prototype,"cullAboveGround",void 0),h([D()],to.prototype,"objectAndLayerIdColorInstanced",void 0),h([D()],to.prototype,"vvColor",void 0),h([D({constValue:!0})],to.prototype,"hasVvInstancing",void 0),h([D({constValue:!1})],to.prototype,"vvSize",void 0),h([D({constValue:!1})],to.prototype,"vvOpacity",void 0);let jJ=class extends lG{constructor(e){super(e,new rqe),this.supportsEdges=!0,this._configuration=new to}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<aD,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth&&this.parameters.writeLinearDepth||r===L.ObjectAndLayerIdColor?e===ae.DRAPED_MATERIAL?!0:r===L.Highlight?e===ae.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ae.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new tqe(e)}createBufferWriter(){const e=Ri().vec3f(S.POSITION);return ie("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(S.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(S.COLORFEATUREATTRIBUTE):e.vec4u8(S.COLOR),new v2(e)}},tqe=class extends ey{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this.ensureTechnique(Age,e)}},rqe=class extends xA{constructor(){super(...arguments),this.color=gp,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ti.None,this.hasOccludees=!1}};var Vn;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Vn||(Vn={}));const pz=.70710678118,HJ=pz,iqe=.08715574274;function sqe(t){const e=new ur,r=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha),{vertex:i,fragment:s}=e;Pl(i,t),e.include(Ba,t),e.include(mv,t),t.draped?i.uniforms.add(new Se("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):e.attributes.add(S.BOUNDINGRECT,"mat3"),e.attributes.add(S.POSITION,"vec3"),e.attributes.add(S.UVMAPSPACE,"vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r&&e.varyings.add("depth","float");const n=t.style===Vn.ForwardDiagonal||t.style===Vn.BackwardDiagonal||t.style===Vn.DiagonalCross;n&&i.code.add(b`
      const mat2 rotate45 = mat2(${b.float(pz)}, ${b.float(-HJ)},
                                 ${b.float(HJ)}, ${b.float(pz)});
    `),t.draped||(td(i,t),i.uniforms.add(new Se("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),i.code.add(b`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(b`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(b`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${b.float(iqe)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(b`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${n?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${n?" * rotate45":""};

      ${t.draped?"":b`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${b.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=t.output===L.Depth;return o&&(e.include(dm,t),U1(e),z0(e)),i.code.add(b`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(rs,t),s.include(zp),t.draped&&s.uniforms.add(new Se("texelSize",(a,l)=>1/l.camera.pixelRatio)),t.output===L.Highlight&&e.include(Am,t),r&&e.include(Tc,t),t.output!==L.Highlight&&(s.code.add(b`
      const float lineWidth = ${b.float(t.lineWidth)};
      const float spacing = ${b.float(t.patternSpacing)};
      const float spacingINV = ${b.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(b`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.uniforms.add(new Wt("uColor",a=>a.color)),s.code.add(b`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${t.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${t.output!==L.Highlight?b`color.a *= ${nqe(t)};`:""}

      ${t.output===L.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

      if (color.a < ${b.float(Gn)}) {
        discard;
      }

      ${t.output===L.Alpha?b`fragColor = vec4(color.a);`:""}

      ${t.output===L.Color?b`fragColor = color; ${t.transparencyPassType===Ze.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===L.Highlight?b`outputHighlight();`:""}
      ${t.output===L.Depth?b`outputDepth(linearDepth);`:""};
    }
  `),e}function nqe(t){function e(r){return t.draped?b`coverage(vuv.${r}, texelSize)`:b`sampleAA(vuv.${r})`}switch(t.style){case Vn.ForwardDiagonal:case Vn.Horizontal:return e("y");case Vn.BackwardDiagonal:case Vn.Vertical:return e("x");case Vn.DiagonalCross:case Vn.Cross:return b`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const oqe=Object.freeze(Object.defineProperty({__proto__:null,build:sqe},Symbol.toStringTag,{value:"Module"}));let Rge=class Pge extends gr{initializeProgram(e){return new pr(e.rctx,Pge.shader.get().build(this.configuration),Mge)}_setPipelineState(e,r){const i=this.configuration,s=e===Ze.NONE,n=e===Ze.FrontFace;return xt({blending:i.output===L.Color||i.output===L.Alpha?s?gc:Om(e):null,culling:IL(i.cullFace),depthTest:{func:iy(e)},depthWrite:s?i.writeDepth?Ya:null:oD(e),colorWrite:$t,stencilWrite:i.hasOccludees?Mp:null,stencilTest:i.hasOccludees?r?Y0:sy:null,polygonOffset:s||n?i.polygonOffset?aqe:null:cD(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};Rge.shader=new dr(oqe,()=>he(()=>import("./Pattern.glsl-fec5eac9.js"),[]));const aqe={factor:1,units:1};let Qo=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.cullFace=ti.None,this.transparencyPassType=Ze.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};h([D({count:L.COUNT})],Qo.prototype,"output",void 0),h([D({count:ti.COUNT})],Qo.prototype,"cullFace",void 0),h([D({count:Vn.COUNT})],Qo.prototype,"style",void 0),h([D({count:Ze.COUNT})],Qo.prototype,"transparencyPassType",void 0),h([D()],Qo.prototype,"hasSlicePlane",void 0),h([D()],Qo.prototype,"hasVertexColors",void 0),h([D()],Qo.prototype,"polygonOffset",void 0),h([D()],Qo.prototype,"writeDepth",void 0),h([D()],Qo.prototype,"hasOccludees",void 0),h([D()],Qo.prototype,"patternSpacing",void 0),h([D()],Qo.prototype,"lineWidth",void 0),h([D()],Qo.prototype,"enableOffset",void 0),h([D()],Qo.prototype,"draped",void 0),h([D()],Qo.prototype,"hasMultipassTerrain",void 0),h([D()],Qo.prototype,"cullAboveGround",void 0);const Mge=new Map([[S.POSITION,0],[S.COLOR,3],[S.UVMAPSPACE,4],[S.BOUNDINGRECT,5]]);let MG=class extends lG{constructor(e){super(e,new uqe),this.supportsEdges=!0,this._vertexAttributeLocations=Mge,this._configuration=new Qo}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<aD,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth&&this.parameters.writeLinearDepth?e===ae.DRAPED_MATERIAL?!0:r===L.Highlight?e===ae.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?ae.TRANSPARENT_MATERIAL:ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new lqe(e)}createBufferWriter(){const e=Ri().vec3f(S.POSITION).vec4u8(S.COLOR).vec4f(S.UVMAPSPACE);return this.parameters.draped||e.mat3f(S.BOUNDINGRECT),new cqe(e)}},lqe=class extends ey{_updateParameters(e){return this.ensureTechnique(Rge,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},cqe=class extends v2{write(e,r,i,s,n){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case S.POSITION:{He(a.size===3);const c=s.getField(o,Os);c&&sD(l,a.data,e,c,n);break}case S.COLOR:{He(a.size===3||a.size===4);const c=s.getField(o,wo);c&&PV(l,a.data,a.size,c,n);break}case S.UVMAPSPACE:{He(a.size===4);const c=s.getField(o,ed);c&&Mx(l,a.data,c,n);break}case S.BOUNDINGRECT:{He(a.size===9);const c=s.getField(o,k0);c&&this.writeBoundingRect(l,a.data,e,c,n);break}}}}writeBoundingRect(e,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let u=0;u<c;++u){const d=9*e[u],p=r[d],g=r[d+1],y=r[d+2];a[n]=o[0]*p+o[4]*g+o[8]*y+o[12],a[n+1]=o[1]*p+o[5]*g+o[9]*y+o[13],a[n+2]=o[2]*p+o[6]*g+o[10]*y+o[14];for(let _=3;_<9;++_)a[n+_]=r[d+_];n+=l}}},uqe=class extends xA{constructor(){super(...arguments),this.color=Ct(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ti.None,this.hasOccludees=!1,this.style=Vn.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function hqe(t,e){const r=(t==null?void 0:t.pattern)??null;return r==null?new jJ(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=Ct(0,0,0,0),e.transparent=!0),new jJ(e)):(e.style=dqe(r.style),new MG(e))}function dqe(t){switch(t){case"horizontal":return Vn.Horizontal;case"vertical":return Vn.Vertical;case"cross":return Vn.Cross;case"forward-diagonal":return Vn.ForwardDiagonal;case"backward-diagonal":return Vn.BackwardDiagonal;case"diagonal-cross":return Vn.DiagonalCross;default:return}}function pqe(t){return t.material instanceof MG&&!t.material.parameters.draped}function fqe(t,e){if(pqe(t)){const r=t.vertexAttributes.get(S.POSITION).data,i=t.getMutableAttribute(S.UVMAPSPACE).data,s=t.getMutableAttribute(S.BOUNDINGRECT).data;Cge(i,s,r,e)}}function mqe(t,e,r,i,s){const n=ope(t,e,r,i,s),o=t.stageObject.geometries;for(const a of o)fqe(a,s);return n}const gqe=["polyline","polygon","extent"],WJ=new wA({size:!1,color:!0,rotation:!1,opacity:!1});let $ge=class Ige extends Vp{constructor(e,r,i,s){super(e,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=Ix(this._context.renderer,WJ)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){var i,s,n;if(this._material!=null)return;const e=(s=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:s.color,r=this._getCombinedOpacityAndColor(e);this._material=hqe(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(n=this._fastUpdates)==null?void 0:n.materialParameters}),this._needsUV=this._material instanceof MG,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const s=$me(e.pattern);return new bw({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:lz(e.patternCap||"butt")})};this._outlineMaterial=r(Fo(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return e!=null&&e.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,gqe,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new od);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!Lx(this._fastUpdates,r,WJ))return fs.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return fs.FastUpdate}layerOpacityChanged(){var e,r;if(this._material!=null){const i=this._material.parameters.color,s=(r=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:r.color,n=this._getCombinedOpacity(s);this._material.setParameters({color:[i[0],i[1],i[2],n],transparent:n<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const i=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=TA(Ige.elevationModeChangeTypes,i,s);if(n!==Yi.UPDATE)return n;const o=Uu(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var u;const s=EC(e.geometry);if(!s)return null;const n=gG(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new yqe(n,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Di(4*a,!0),o.boundingRect=go(9*a,!0),Cge(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Rm({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Bp(this,l,o.outGeometries,null,null,mqe,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Uu(i.mode),c}_createAs3DShapeFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,mapPositions:o,holeIndices:a,index:l,count:c}of i){if(this._context.clippingExtent!=null&&(li(Qu),hc(Qu,o),!Nh(Qu,this._context.clippingExtent)))continue;const u=Fx(o,a,3);if(u.length===0)continue;const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,p=dZ({material:this._material,indices:u,mapPositions:o,attributeData:{position:n,color:d?null:r.color,colorFeature:d?Hh(d.field,e):null,uvMapSpace:this._needsUV?m$(r.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?xu(r.boundingRect,9*l,9*c):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(p)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:s,position:n}=r[i];if(this._context.clippingExtent!=null&&(li(Qu),hc(Qu,s),!Nh(Qu,this._context.clippingExtent)))continue;const o=cz(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(o)}}_createAsOverlay(e,r){var a;const i=EC(e.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=qfe(i,this._context.overlaySR),n=new _qe(s,r,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Di(4*o,!0),YWe(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=li(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new TD(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,holeIndices:o,index:a,count:l}of i){const c=li(Qu);if(hc(c,n),!Nh(c,this._context.clippingExtent))continue;const u=Fx(n,o,3);if(u.length===0)continue;cx(r.outBoundingBox,c);const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,p=dZ({material:this._material,indices:u,attributeData:{position:n,color:d?null:r.color,colorFeature:d?Hh(d.field,e):null,uvMapSpace:this._needsUV?m$(r.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new kx(p,r))}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(li(Qu),hc(Qu,s),!Nh(Qu,this._context.clippingExtent))continue;cx(e.outBoundingBox,Qu);const n=cz(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new kx(n,e))}}_getOutlineOpacity(){var r,i;const e=(i=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:i.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var i,s;const e=(s=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:s.color,r=this._getOutlineOpacity();return bE(e!=null?ht.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};$ge.elevationModeChangeTypes={definedChanged:Yi.RECREATE,staysOnTheGround:Yi.NONE,onTheGroundChanged:Yi.RECREATE};const Qu=Bs();let yqe=class extends yD{constructor(e,r,i,s){super(e,i,s),this.color=r}},_qe=class extends yD{constructor(e,r,i,s){super(e,i,s),this.color=r}};const qJ="woff2",YJ=new Map;let vqe=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function bqe(t){const e=xqe(t),r=YJ.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${Er.fontsUrl}/woff2/${e}.${qJ}') format('${qJ}')`),s=document.fonts;if(s.has(i)&&i.status==="loading")return i.loaded;const n=i.load().then(()=>(s.add(i),i));return YJ.set(e,new vqe(i,n)),n}function wqe(t){if(!t)return"arial-unicode-ms";const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function xqe(t){const e=Tqe(t)+Sqe(t);return wqe(t.family)+(e.length>0?e:"-regular")}function Tqe(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Sqe(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let Lge=class Dge{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){var p,g,y,_,v;const i=(p=e==null?void 0:e.material)==null?void 0:p.color,s=ht.toUnitRGBA(i)??gp,n=e.size!=null?Fo(e.size):12,o=e.lineHeight,a=e.background!=null?ht.toUnitRGBA(e.background.color):gp,l={family:((g=e.font)==null?void 0:g.family)??"sans-serif",decoration:((y=e.font)==null?void 0:y.decoration)??"none",weight:((_=e.font)==null?void 0:_.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,u=c!=null&&c.color!=null&&c.size>0?{size:Fo(c.size),color:ht.toUnitRGBA(c.color)}:{size:0,color:gp},d=new Dge({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:r});if(e.font){let w=!1;const T=d.fontString(n);try{w=(await document.fonts.load(T)).length>0}catch{ne.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${T}'. Some text symbology may be rendered using the default browser font.`)}if(!w&&!Eqe.has(e.font.family))try{await bqe(e.font),w=!0}catch{}}return d}};const Eqe=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);let Cqe=class{constructor(e,r,i){this._renderer=new Sme(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=oz(Aqe,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new pv(e,{wrap:{s:Ot.CLAMP_TO_EDGE,t:Ot.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Aqe={canvas:null},Oqe=[0,0,1];let Rqe=class extends Vp{constructor(e,r,i,s){super(e,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=hD(this.symbolLayer.size);if(e)throw new X("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await Lge.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=TC(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=$B(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!zne(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new ipe(n,this.symbolLayer.horizontalAlignment,cGe(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,s,o)}createLabel(e,r,i,s){const n=e.graphic,o=TC(n.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return XJ(e,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),Yi.UPDATE}slicePlaneEnabledChanged(e,r){return XJ(e,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Uu(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Mqe}_createAs3DShape(e,r,i,s,n,o){var M;const a=this.setGraphicElevationContext(e,new od,s.elevationOffset),l=((M=e.geometry)==null?void 0:M.type)==="polyline",c=e.uid;let u=null,d=null;if(o==null){const U=Cme(s.horizontalPlacement);u=new Cqe(i,U,this._textRenderParameters);let k=null;if(this._context.sharedResources.textures!=null){d=this._context.sharedResources.textures.fromData(u.key,()=>u.create(),()=>{k!=null&&k.release()});const B=this._context.stage.renderView.textureRepository.acquire(d.texture.id);if(B==null||Sc(B))return d.release(),null;k=B}}const p=Pqe(u,s),g={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:p,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?g.textureId=o.id:d!=null&&(g.textureId=d.texture.id),s.verticalOffset!=null){const{screenLength:U,minWorldLength:k,maxWorldLength:B}=s.verticalOffset;g.verticalOffset={screenLength:Fo(U),minWorldLength:k||0,maxWorldLength:B??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:U,screenSizePerspectiveSettingsLabels:k}=this._context.sharedResources;g.screenSizePerspective=k.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),g.screenSizePerspectiveAlignment=U}let y;if(l&&(g.shaderPolygonOffset=1e-4),g.hasSlicePlane=this._context.slicePlaneEnabled,n!=null){const U=JSON.stringify(g);y=n.get(U),y==null&&(y=new Dx(g),n.add(U,y))}else y=new Dx(g);const _=s.translation,v=u?ir(u.displayWidth,u.displayHeight):Kh,w=s.centerOffset,T=dU(y,Oqe,_,null,v,w,[0,0],null),x=YV(this._context,r,T,a,c);if(x==null)return null;const E=new Bp(this,x.object,[T],n==null?[y]:null,d,wC,a);E.alignedSampledElevation=x.sampledElevation,E.needsElevationUpdates=Uu(a.mode)||a.mode==="absolute-height";const{displayWidth:O,displayHeight:A}=u??s;E.getScreenSize=(U=Ie())=>(U[0]=O,U[1]=A,U);const $=new ppe(s.elevationOffset,i);return E.metadata=$,xC(E,r,this._context.elevationProvider),E}};function XJ(t,e,r){t&&t.forEach(i=>{const s=e(i);s!=null&&r(s,i.graphic)})}function Pqe(t,e){if(e.verticalPlacement==="baseline"){const i=oGe[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return ir(i,s)}const r=lGe(e.horizontalPlacement,e.verticalPlacement);return zP[r]}const Mqe={mode:"relative-to-ground",offset:0},$qe={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Iqe=["polyline","polygon","extent"];let fz=class T_ extends Vp{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Iqe,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new od);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._material!=null)return;const e=new Nfe,r=this.symbolLayer.color;r!=null&&(e.color=ht.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?T_.headingVectorFromAngle(this.symbolLayer.waveDirection):ir(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=$qe[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new Dfe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=TA(T_.elevationModeChangeTypes,i,s);if(n!==Yi.UPDATE)return n;const o=Uu(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var d;const s=EC(e.geometry);if(s==null)return null;const n=gG(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=go(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new Lqe(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(d=this._context.stage.renderView)==null?void 0:d.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Rm({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),u=new Bp(this,c,l.outGeometries,null,null,ope,r);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=Uu(r.mode),u}_createUVCoordsFromVertices(e,r,i,s){const n=fa(s);Au(ig);for(let l=0;l<i;l++)Qt(ZJ,r[3*l],r[3*l+1]),qk(ig,ZJ);Qx(ig,ig,n);const o=ig[0]%T_.unitSizeOfTexture,a=ig[1]%T_.unitSizeOfTexture;jO[0]=ig[0]-o,jO[1]=ig[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*n-jO[0])/T_.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*n-jO[1])/T_.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(li(ky),hc(ky,a),!Nh(ky,this._context.clippingExtent)))continue;const c=Fx(a,l,3);if(c.length===0)continue;const u=xu(i,2*n,2*s),d=pZ({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){var a;const r=EC(e.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority;const i=qfe(r,this._context.overlaySR),s=i.position.length/3,n=go(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new Dqe(i,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=li(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new TD(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(li(ky),hc(ky,s),!Nh(ky,this._context.clippingExtent))continue;cx(e.outBoundingBox,ky);const l=Fx(s,n,3);if(l.length===0)continue;const c=xu(r,2*o,2*a),u=pZ({material:this._material,indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new kx(u,e))}}static headingVectorFromAngle(e){const r=Ie(),i=VI(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};fz.unitSizeOfTexture=100,fz.elevationModeChangeTypes={definedChanged:Yi.RECREATE,staysOnTheGround:Yi.NONE,onTheGroundChanged:Yi.RECREATE};const jO=Ie(),ig=Ut(),ZJ=Ie(),ky=Bs();let Lqe=class extends yD{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}},Dqe=class extends yD{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}};function Nqe(t,e,r,i){var n;const s=((n=Uqe[t.type])==null?void 0:n[e.type])||Fqe[e.type];return s?new s(t,e,r,i):(ne.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const Fqe={icon:az,object:GHe,line:Ime,path:HWe,fill:$ge,extrude:K7e,text:Rqe,water:fz},Uqe={"mesh-3d":{fill:dje}};let zqe=class extends HV{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];s!=null&&(s.symbol=e,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.getItemAt(n);if(o.enabled===!1)continue;HO.renderPriority=1-(1+n)/i,HO.renderPriorityStep=1/i,HO.ignoreDrivers=o.ignoreDrivers;const a=Nqe(this.symbol,o,this._context,HO),l=rk(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await UI(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),qt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e!=null&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,s=this.symbolLayers.map(o=>(o==null?void 0:o.createGraphics3DGraphic(e))??null),n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new oke(i,r||this,s,e.layer,n)}get complexity(){return qV(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Bp?l:null};if(n!=null&&!n.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==sc.LOADED?fs.RecreateSymbol:this.symbolLayers.reduce((i,s)=>i!==fs.RecreateSymbol&&s!=null?Math.min(i,s.applyRendererDiff(e,r)):i,fs.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===sc.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[n];u!=null&&a.graphics3DGraphicPatches.forEach(d=>d(u,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,s)=>i.updateGeometry(s,r))}updateTransform(e,r,i){return this._updateGeometryOrTransform(e,(s,n)=>s.updateTransform(n,r,i))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(s==null)continue;const n=e.layers[i];if(!n||!r(s,n))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const s=e.layers[r];s!=null&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===sc.LOADING?e++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,s){const n=this.symbolLayers.filter(em).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,s)),o=await Promise.all(n);return qt(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const HO=new ake;let kqe=class extends HV{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:WV}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):fs.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i){var s;return((s=this.graphics3DSymbol)==null?void 0:s.updateTransform(e,r,i))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function $G(t){return t instanceof kqe?t.graphics3DSymbol:t instanceof zqe?t:null}const PC=ne.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Bqe(t){const e=Zqe(t);if(e==null)return null;const r=Vqe(t,e);if(r==null)return null;const i=r.anchor,s=!!e.hasLabelVerticalOffset;return jqe({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Ie(),centerOffset:Ct(0,0,0,-1),centerOffsetUnits:"world",translation:C(),elevationOffset:0,hasLabelVerticalOffset:s},r,t)}function Vqe(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=kh[r],s=i||rI(t);return r&&!i&&PC.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),Gqe(s,t)}function IG(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=$G(e);return r!=null?r.symbol.symbolLayers.getItemAt(0):null}function Gqe(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(PC.warnOncePerTick(JJ(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),rI(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return PC.warnOncePerTick(JJ(t==null?void 0:t.placement,`'${i}' geometries`)),rI(e);break;case"point":case"mesh":return t}return t}function JJ(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function rI(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=IG(t);return r!=null&&r.type==="extrude"?kh["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return kh["above-center"];default:return}}function jqe(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":Wqe(t,e,r);break;case"polygon":Hqe(t,e,r);break;case"mesh":LG(t,e,r.graphics3DGraphic.layers[0])}return t}function Hqe(t,e,r){const i=IG(r);if(i!=null)switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(PE),Dh(PE,t.translation),t.translation[2]=Q0(PE)/2):se(t.translation,0,0,0),LG(t,e,s);break}}}function Wqe(t,e,r){const i=IG(r);if(i==null)return;const s=r.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):se(t.translation,0,0,0),i.type){case"icon":case"text":qqe(t,e,r,s);break;case"object":LG(t,e,s)}}function qqe(t,e,r,i){const{graphics3DGraphic:s}=r,n=i!=null?i.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(kh[r.labelClass.labelPlacement]&&PC.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=Yqe(r);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function Yqe(t,e=Jqe){const{graphics3DGraphic:r}=t,i=r.layers[0],s=i!=null?i.stageObject.geometries[0].material:null;if(s&&s instanceof Dx){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function LG(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(PE):PE,s=Ce(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Te(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function Xqe(t){return t==="above-center"}function Zqe(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,s=$G(i.graphics3DSymbol),n=fo(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=kh[e]||rI(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:QJ(n.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&Xqe(o.placement)?{placement:"above-center",verticalOffset:QJ(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(PC.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function QJ(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const kh={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},KJ={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in KJ){const e=KJ[t],r=kh[t];e.forEach(i=>{kh[i]=r})}Object.freeze&&(Object.freeze(kh),Object.keys(kh).forEach(t=>{var e;Object.freeze(kh[t]),Object.freeze((e=kh[t])==null?void 0:e.normalizedOffset)}));const Jqe=[0,0],PE=Bs();let eQ=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const I5=512,L5=4096,Qqe=.85,Kqe=.95;let eYe=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Ht()}},tYe=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new eYe,this.rendered=!1}},$S=class extends we{constructor(e){super(e),this.type=Wi.Texture,this.id=Rl(),this.events=new ys,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Ue(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){const r=new xr;return r.wrapMode=Ot.CLAMP_TO_EDGE,r.flipped=!0,r.samplingMode=wt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,r}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new bt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(nt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=bi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Ue(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",I5.toString()),e.setAttribute("height",I5.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=I5){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,r){let i=Math.max(e,r);return i+=256,i=Hk(i),i=Math.min(i,L5),i}_resizeAtlas(e,r){r=r||e;const i=this._atlas;i.size.width=e,i.size.height=r,this._glTexture!=null&&this._glTexture.resize(e,r),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=mT,e.cursor.y=mT+tQ,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,r=this._elementsToAddOrUpdate.size,i=this._elements.size;return this._getAtlasUsage()/i*(i+r-e)}_addAtlasElement(e,r,i,s){const n=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,oi(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+o)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=i,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].setAttributeData(S.SIZE,[0,0]),r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=n+mT,l=o+mT+tQ;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=this._getExpectedAtlasUsage(),u=c>Qqe&&i.size.width<L5;return u&&this._resizeAtlas(2*i.size.width,2*i.size.height),!r||!u&&c>Kqe&&i.size.width===L5?(this._processRemovals(),ww.OK):(this._repack(),ww.REPACK)}i.cursor.x=mT,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return ww.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].setAttributeData(S.UV0,e.placement.uvMinMax),i.geometries[0].setAttributeData(S.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(this._glTexture==null)return _o.YIELD;let i=!1;if(ao(this._elementsToAddOrUpdate,(n,o)=>{const a=this._elements.get(o);if(a!=null&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const u=c.geometries[0],d=this._elements.get(o);u.setAttributeData(S.UV0,d.placement.uvMinMax),u.setAttributeData(S.SIZE,[d.textRenderer.displayWidth,d.textRenderer.displayHeight]),c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===ww.REPACK&&(i=!0,!0)}),i)return this.runTask(la,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),ao(this._elementsToRender,(n,o)=>(this._processRenderingRequest(n),this._elementsToRender.delete(o),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&jke.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new tYe(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,s)=>e.push({element:i,key:s}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,s)=>i.key.localeCompare(s.key)),this._elements.clear();for(const{element:i,key:s}of e)this._elements.set(s,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:s}=this,n=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:s,resizeAtlas:(o,a)=>n._resizeAtlas(o,a),run:(o,a)=>n.runTask(o,a)}}};h([f({constructOnly:!0})],$S.prototype,"view",void 0),h([f({type:Boolean})],$S.prototype,"updating",void 0),$S=h([F("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],$S);const mT=2,tQ=2;var ww;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(ww||(ww={}));let rQ=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},rYe=class{constructor(e,r,i,s,n){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},iYe=class{constructor(e,r,i,s,n,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new nfe(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},S_=class extends we{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Oi,this._handles.add([ce(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ce(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(nt.LABELER,this)]),this._textTextureAtlas=new $S({view:this.view}),this._hudMaterialCollection=new eQ(this.view._stage),this._calloutMaterialCollection=new eQ(this.view._stage)}dispose(){this._handles=Oe(this._handles),this._textTextureAtlas=Ue(this._textTextureAtlas),this._hudMaterialCollection=Ue(this._hudMaterialCollection),this._calloutMaterialCollection=Ue(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),Ku.graphic=null,Ku.renderingInfo=null,Ku.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const s=new rQ(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s),r.setVisibilityFlag(yn.LABEL,ho.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(yn.LABEL,ho.USER,!1),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),_o.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!iQ(r)){if(sYe(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),D5(r)){this._dirty=!0;continue}if(!iQ(r))continue}ao(r.labelsToInitialize,(i,s)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(s,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),qt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,s=i.layer,n=s.labelingInfo&&s.labelingInfo.filter(c=>!!c.symbol);!n||n.length===0||(await UI(n,async(c,u)=>{const d=c.symbol,p=$G(i.getOrCreateGraphics3DSymbol(d));if(p==null)return void ne.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await p.load(),qt(r);let g=null;$B(d)&&d.hasVisibleCallout()&&(g=Dze(d,i.symbolCreationContext),await g.load(),qt(r));const y=await rm(tpe(c,e.layer.fieldsIndex,this.view.spatialReference));if(qt(r),y.ok===!0){const _=await this._createTextRenderParameters(p.symbol);qt(r),e.labelClassContexts[u]=new rYe(c,p,g,_,y.value)}else ne.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${y.error}`)}),qt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(gs(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.getItemAt(0);return r&&r.type==="text"?Lge.fromSymbol(r,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,yc(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,s,n){const o=new ipe(i.verticalOffset,lJ(i.anchor),aGe(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return Ku.graphic=r,Ku.renderingInfo=null,Ku.layer=s,n.createLabel(Ku,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,s,n){return Ku.graphic=e,Ku.layer=n,Ku.renderingInfo=new Ize(null,r,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(Ku)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,s=i.labelClassContexts;if(!s||s.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let n=!1;const o=r.graphic,a=i.layer,l=WO(i.layer);for(let c=0;c<s.length;c++){const u=e.textRenderers[c],d=e.textLabelPlacements[c];if(u==null||d==null)continue;const p=s[c],g=p.graphics3DSymbol,y=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,_=g.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(i.elevationInfoOverride);const v=this._createTextSymbolGraphic(u,o,d,a,_);if(v==null)return!1;v._labelClass=p.labelClass,v._labelIndex=c,r.addLabelGraphic(v,i.stageLayer),r.setVisibilityFlag(yn.LABEL,ho.USER,l),r.setVisibilityFlag(yn.LABEL,ho.SCALE_RANGE,!0),r.setVisibilityFlag(yn.LABEL,ho.DECONFLICTION,!1),n=!0;const w=p.graphics3DCalloutSymbolLayer;if(w&&d.hasLabelVerticalOffset){w.setElevationInfoOverride(i.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,y,w,d,a);T!=null&&(p.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(T,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const s=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];s!=null&&s.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,!a.textRenderParameters)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const T=l.needsHydrationToEvaluate()?yUe(s,r.layer):s;c=l.evaluate(T)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,d=((n=u.symbol)==null?void 0:n.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const p=e.graphics3DGraphic,g=a.labelClass,y=r.disablePlacement,_=Bqe({graphics3DGraphic:p,labelSymbol:d,labelClass:g,disablePlacement:y});if(_==null)continue;const v=lJ(_.anchor),w=Cme(v);e.textRenderers[o]=new Sme(c,w,a.textRenderParameters),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const s=new rQ(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,s=this._labels.get(i);e.graphics.delete(i),s&&(this._destroyGraphic(s,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const s=e.graphics.get(i);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const s=new Map;r.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const r=WO(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const s=this._labels.get(i);s&&(this._destroyGraphic(s,i),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(i,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const s=i&&i.emptySymbolLabelSupported||!1,n=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new iYe(this.view._stage,a,e,r,s,n,o,WO(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>WO(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(s=>this._removeGraphic(r,s)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,s=this._labels.get(i);s&&s.visible!==r&&(r&&!s.rendered?(this._labelsToAdd.set(i,s),this._labelsToRemove.delete(i),s.textInitialized||s.labelingContext.labelsToInitialize.set(i,s)):!r&&s.rendered&&(this._labelsToRemove.set(i,s),this._labelsToAdd.delete(i)),s.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>D5(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(D5(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function D5(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function iQ(t){return t.labelClassContexts&&t.labelClassContexts.length}function sYe(t){return t.labelClassContexts===null}function WO(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}h([f({constructOnly:!0})],S_.prototype,"view",void 0),h([f({constructOnly:!0})],S_.prototype,"deconflictor",void 0),h([f()],S_.prototype,"_textTextureAtlas",void 0),h([f({type:Boolean,readOnly:!0})],S_.prototype,"updating",null),S_=h([F("esri.views.3d.layers.graphics.Labeler")],S_);const Ku=new Lze(null,null,null);let IS=class Yb{constructor(e,r,i,s=null){this.lij=[0,0,0],this.extent=Ut(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Po.VISIBLE_ON_SURFACE,screenRect:Ut(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,r,i,s)}acquire(e,r,i,s){this.tilingScheme=s,this.id=Yb.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,s.getExtent(e,r,i,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(r,i,s,this.tilingScheme),e[1].acquire(r,i+1,s,this.tilingScheme),e[2].acquire(r,i,s+1,this.tilingScheme),e[3].acquire(r,i+1,s+1,this.tilingScheme),e):[new Yb(r,i,s,this.tilingScheme),new Yb(r,i+1,s,this.tilingScheme),new Yb(r,i,s+1,this.tilingScheme),new Yb(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,sm(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var Po;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Po||(Po={}));const Nge=.5*Math.PI,nYe=Nge/Math.PI*180;let oYe=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:C(),direction:C()};for(let r=0;r<4;r++)this._extent[r]={origin:C(),direction:C(),cap:{next:null,direction:C()}},this._planes[r]=_r();this._planes[Qr.NEAR]=_r(),this._planes[Qr.FAR]=_r(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,r,i),oe(this._center.origin,n[0].origin,n[2].origin),ee(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ee(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,fm(a.cap.direction,a.origin,l.origin),iC(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ee(a.direction,a.direction,-1)}iC(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Qr.NEAR]),s?X9(this._planes[Qr.NEAR],this._planes[Qr.FAR]):(xL(this._planes[Qr.FAR],this._planes[Qr.NEAR]),X9(this._planes[Qr.NEAR],this._planes[Qr.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Cr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Re.Global){const n=this._maxSpanSpatialReference.isGeographic?nYe:Nge*r;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!e.intersectsRay(wc(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&e.intersectsRay(wc(o.origin,o.direction))||e.intersectsLineSegment(o1(o.origin,o.cap.next,lYe),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(KNe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){Yk(e,eh),eh[2]=i,bu(r,eh,N5,this._renderCoordsHelper.spatialReference),Wn(sQ,N5),li(rl);for(const{x0:n,x1:o,y0:a,y1:l}of aYe)for(let c=0;c<5;c++){const u=c/4;eh[0]=_t(e[n],e[o],u),eh[1]=_t(e[a],e[l],u),eh[2]=i,wn(eh,r,eh,this._renderCoordsHelper.spatialReference),De(eh,eh,sQ),Ap(rl,eh)}se(this._extent[0].origin,rl[0],rl[1],rl[2]),se(this._extent[1].origin,rl[3],rl[1],rl[2]),se(this._extent[2].origin,rl[3],rl[4],rl[2]),se(this._extent[3].origin,rl[0],rl[4],rl[2]);for(let n=0;n<4;++n)De(this._extent[n].origin,this._extent[n].origin,N5)}_toRenderBoundingExtentLocal(e,r,i){yL(e,r,Kp,this._renderCoordsHelper.spatialReference),se(this._extent[0].origin,Kp[0],Kp[1],i),se(this._extent[1].origin,Kp[2],Kp[1],i),se(this._extent[2].origin,Kp[2],Kp[3],i),se(this._extent[3].origin,Kp[0],Kp[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case Re.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case Re.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Kr(e.planes[Qr.NEAR],this._center.origin)<0&&pe(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(Kr(e.planes[Qr.NEAR],i.origin)<0&&pe(i.direction,e.direction)<0)return!0}return!1}};const aYe=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],eh=C(),N5=xe(),sQ=xe(),rl=Bs(),Kp=Ut(),lYe=id();let cYe=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new t0(e),this._extendedFrustum=new t0(e),this._intersector=new oYe({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return Po.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===Re.Global&&e.lij[0]>=uYe&&e.lij[0]<hYe,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==Po.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=t0.nearFarLineIndices,i=e.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];le(Bl,l,a),ee(Bl,Bl,pYe),oe(i[o],a,Bl)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=Po.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const s=lQ.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Po.INVISIBLE&&(r=o,o===Po.VISIBLE_ON_SURFACE))break}return lQ.release(s),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Re.Global&&e.lij[0]<dYe?this._calculateSingleTileVisibilitySided(e,!1)===Po.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Cr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Po.VISIBLE_ON_SURFACE:Po.VISIBLE_WHEN_EXTENDED:Po.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Bl);this._aboveGround||zo(r,r);const i=rn(-pe(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Bl),a){case je.FAR_BOTTOM_LEFT:case je.FAR_TOP_LEFT:case je.NEAR_BOTTOM_LEFT:case je.NEAR_TOP_LEFT:Z9(this._extendedFrustum.planes[Qr.LEFT],Bl,Bl);break;case je.FAR_BOTTOM_RIGHT:case je.FAR_TOP_RIGHT:case je.NEAR_BOTTOM_RIGHT:case je.NEAR_TOP_RIGHT:Z9(this._extendedFrustum.planes[Qr.RIGHT],Bl,Bl)}ee(Bl,Bl,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(wc(l,Bl),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),Io(n[je.NEAR_BOTTOM_LEFT],n[je.NEAR_BOTTOM_RIGHT],n[je.NEAR_TOP_RIGHT],oQ),Io(n[je.NEAR_BOTTOM_RIGHT],n[je.NEAR_TOP_RIGHT],n[je.NEAR_TOP_LEFT],aQ),pe(oQ,aQ)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[je.NEAR_BOTTOM_LEFT],o[je.NEAR_BOTTOM_RIGHT]]=[o[je.NEAR_BOTTOM_RIGHT],o[je.NEAR_BOTTOM_LEFT]]:[o[je.NEAR_TOP_LEFT],o[je.NEAR_TOP_RIGHT]]=[o[je.NEAR_TOP_RIGHT],o[je.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-nQ;return{zWithMargin:e,pointIndices:t0.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+nQ;return{zWithMargin:e,pointIndices:t0.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const uYe=2,hYe=6,dYe=12,pYe=.95,nQ=1,Bl=C(),oQ=_r(),aQ=_r(),lQ=new po(Array,t=>{t.length!==4&&(t[0]=new IS,t[1]=new IS,t[2]=new IS,t[3]=new IS)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let fYe=class{constructor(e){this._camera=new ot,this._focusOnMap=[0,0],this._screenRect=Ut(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new cYe(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,Wk(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=rTe(e.extent,this._focusOnMap),e.measures.visibility!==Po.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=mYe,i=1<<r,s=e.measures.screenRect;Au(s);let n=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),u=c*c;for(let d=0;d<i;d++)for(let p=0;p<i;p++)if(n+=this._computeScreenArea(e,o,a+d,l+p,s),n>u)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Po.VISIBLE_WHEN_EXTENDED?this._tileSize*gYe:this._tileSize}_computeScreenArea(e,r,i,s,n){const o=e.measures.visibility===Po.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,sg),Au(F5);for(let a=0;a<4;a++)qk(F5,sg[a]);return b0(n,F5,n),Gq(sg[0],sg[1],sg[2])+Gq(sg[0],sg[2],sg[3])}_projectToScreen(e,r,i,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,gT),this._toRenderCoords(gT,0,3,ng[0]),this._toRenderCoords(gT,2,3,ng[1]),this._toRenderCoords(gT,2,1,ng[2]),this._toRenderCoords(gT,0,1,ng[3]),s&&(this._projectToPlane(ng,this._camera.frustum[Qr.NEAR]),this._projectToPlane(ng,this._camera.frustum[Qr.TOP]),this._projectToPlane(ng,this._camera.frustum[Qr.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(ng[o],cQ),this._camera.renderToScreen(cQ,n[o])}_projectToPlane(e,r){for(let s=0;s<4;s++)_T[s]=Kr(r,e[s]);const i=Math.max(_T[0],_T[1],_T[2],_T[3]);if(i>0){const s=ee(yT,r,-i);for(let n=0;n<4;n++)oe(e[n],e[n],s)}}_toRenderCoords(e,r,i,s){return yT[0]=e[r],yT[1]=e[i],yT[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(yT,this._tilingScheme.spatialReference,s),s}};const F5=Ut(),mYe=2,gYe=5,sg=[Li(),Li(),Li(),Li()],gT=Ut(),yT=C(),ng=[C(),C(),C(),C()],_T=[0,0,0,0],cQ=mo();function I1t(t,e,r){if(t==null||r==null)return!1;let i=!0;return Ls[0]=t.xmin!=null?t.xmin:0,Ls[1]=t.ymin!=null?t.ymin:0,Ls[2]=t.zmin!=null?t.zmin:0,i=i&&Xi(Ls,t.spatialReference,0,e,r,0,1),Ls[0]=t.xmax!=null?t.xmax:0,Ls[1]=t.ymax!=null?t.ymax:0,Ls[2]=t.zmax!=null?t.zmax:0,i=i&&Xi(Ls,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function Fge(t,e,r){if(t==null||r==null)return!1;let i=!0;return Ls[0]=t.xmin!=null?t.xmin:0,Ls[1]=t.ymin!=null?t.ymin:0,Ls[2]=t.zmin!=null?t.zmin:0,i=i&&Xi(Ls,t.spatialReference,0,Ls,r,0,1),e[0]=Ls[0],e[1]=Ls[1],Ls[0]=t.xmax!=null?t.xmax:0,Ls[1]=t.ymax!=null?t.ymax:0,Ls[2]=t.zmax!=null?t.zmax:0,i=i&&Xi(Ls,t.spatialReference,0,Ls,r,0,1),e[2]=Ls[0],e[3]=Ls[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const Ls=C();let zn=class extends we{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void ne.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Ut();return Fge(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new er,this.tileSize=512,this._idToTile=new Map,this._handles=new Oi,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Nt}initialize(){this._handles.add([ce(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Nr),ce(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),Ss)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(nt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=bi(this._frameWorker),this._handles=Oe(this._handles)}addClient(){const e=_Ye();return this._clients.add(e),this._clients.size===1&&this._setDirty(),ha(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(la))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=nt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=nt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new fYe({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new IS(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const s=r.measures.screenRect,n=i.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),Au(qO);for(let r=0;r<e.length;r++)if(b0(qO,e.data[r].measures.screenRect,qO),Xh(qO)>vYe)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!YI(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==Po.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const r=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),i=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===Po.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};h([f({constructOnly:!0})],zn.prototype,"scheduler",void 0),h([f({constructOnly:!0})],zn.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],zn.prototype,"tilingSchemeOwner",void 0),h([f({constructOnly:!0})],zn.prototype,"cameraOnSurface",void 0),h([f({constructOnly:!0})],zn.prototype,"focus",void 0),h([f({constructOnly:!0})],zn.prototype,"viewState",void 0),h([f({constructOnly:!0})],zn.prototype,"terrain",void 0),h([f()],zn.prototype,"tiles",void 0),h([f()],zn.prototype,"tileSize",void 0),h([f({readOnly:!0})],zn.prototype,"tilingScheme",null),h([f()],zn.prototype,"filterExtent",null),h([f({readOnly:!0})],zn.prototype,"_filterExtentRect",null),h([f({readOnly:!0})],zn.prototype,"_rootTileIds",null),h([f({value:!1})],zn.prototype,"suspended",null),h([f({readOnly:!0})],zn.prototype,"updating",null),zn=h([F("esri.views.3d.layers.support.FeatureTileTree3D")],zn);let yYe=0;function _Ye(){return yYe++}const qO=Ut(),vYe=10;let Ui=class extends we{constructor(){super(...arguments),this._propertiesPool=new lm({camera:ot},this),this._lastSeenCameraProjectionValues=new ot,this.mode=vr.ANIMATING,this._cssCamera=new ot,this._camera=new ot,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new ys,this.viewingMode=Re.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new vf({mode:this.viewingMode}))}exit(){var e;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new lm({camera:ot},this)}destroy(){var e,r;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,(r=this._propertiesPool)==null||r.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Re.Global){const e=Cr(this.spatialReference).radius;this.camera=new ot({eye:Ce(4*e,0,0),center:Ce(e,0,0),up:Ce(0,0,1)})}else this.camera=new ot({eye:Ce(0,0,100),center:Ce(0,0,0),up:Ce(0,1,0)})}get animation(){return this.cameraController instanceof mC&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/s),e.width=Math.round(i/s),e}set camera(e){e!==Lc&&Lc.copyFrom(e),Lc.computeUp(this.viewingMode),this.events.emit("before-camera-change",Lc);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Lc)&&(this._lastSeenCameraProjectionValues.copyFrom(Lc),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(Lc)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Lc),this._cameraChanged=!r.almostEquals(Lc),this._cameraChanged)){const i=Bte(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===vr.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Re.Global}get isLocal(){return this.viewingMode===Re.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var r;this.stopActiveCameraController()?((r=this.cameraController)==null||r.destroy(),e&&(this.removeHandles(uQ),this.addHandles(Mu(()=>e.state===$i.Finished||e.state===$i.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),uQ),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=$i.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==$i.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Lc.copyFrom(this._get("camera")),e(Lc),this.camera=Lc,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[Gt.TOP]!==r.padding[Gt.TOP]||e.padding[Gt.RIGHT]!==r.padding[Gt.RIGHT]||e.padding[Gt.BOTTOM]!==r.padding[Gt.BOTTOM]||e.padding[Gt.LEFT]!==r.padding[Gt.LEFT]}};h([f()],Ui.prototype,"mode",void 0),h([f({readOnly:!0,type:bx})],Ui.prototype,"animation",null),h([f({type:ot})],Ui.prototype,"camera",null),h([f({type:ot})],Ui.prototype,"cssCamera",null),h([f()],Ui.prototype,"_cssCamera",void 0),h([f()],Ui.prototype,"_camera",void 0),h([f({readOnly:!0})],Ui.prototype,"pixelRatio",null),h([f()],Ui.prototype,"rasterPixelRatio",void 0),h([f()],Ui.prototype,"contentPixelRatio",void 0),h([f({readOnly:!0})],Ui.prototype,"alignPixelEnabled",null),h([f({readOnly:!0})],Ui.prototype,"updating",null),h([f({})],Ui.prototype,"_contentCamera",void 0),h([f({type:ot})],Ui.prototype,"contentCamera",null),h([f({readOnly:!0})],Ui.prototype,"fixedContentCamera",null),h([f({readOnly:!0})],Ui.prototype,"constraints",void 0),h([f({readOnly:!0})],Ui.prototype,"events",void 0),h([f({readOnly:!0})],Ui.prototype,"isGlobal",null),h([f({readOnly:!0})],Ui.prototype,"isLocal",null),h([f({readOnly:!0})],Ui.prototype,"viewingMode",void 0),h([f({readOnly:!0})],Ui.prototype,"spatialReference",void 0),h([f()],Ui.prototype,"navigating",null),h([f()],Ui.prototype,"stationary",null),h([f()],Ui.prototype,"_cameraChanged",void 0),h([f()],Ui.prototype,"cameraController",null),Ui=h([F("esri.views.3d.state.ViewState")],Ui);const bYe=Ui,Lc=new ot,uQ="ViewStateHandles";let wYe=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Nt,this._tolerance=Ax,this._tmpRay=vn(),this._tmpRegion=Ut(),this._validateHUDIntersector=Fu(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),hQ(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,hQ(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,s){return r.options.selectionMode=!1,r.options.store=Yn.MIN,this.computeIntersection(e,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,s=.5){return e.getRenderCenter(ZO,i,s),ZO[0]+=.0466,ZO[1]-=.0123,uV(e,ZO,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const s=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||nd(s)&&s.intersector!==Ai.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=Ax){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===Ai.TERRAIN?1:i.type===Ai.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Ai.TERRAIN?1:i.type===Ai.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return Due(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==Re.Local||e==null||oe(r,e.origin,fe($e.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,s)}_intersectElevation(e,r,i=0,s=null){if(e==null)return null;const n=r!=null?r.mode:"absolute-height",o=(r==null?void 0:r.offset)??0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,XO)){const T=this._view.computeMapPointFromVec3d(XO);return T.z??(T.z=0),T.z-=o,T}return null}const c=this._view.state.camera,u=$e.get();c.projectToRenderScreen(e.origin,u);const d=new dQ(null,this._forEachLayer),p=this._view.slicePlane,g=p!=null?IY(p):null,y=Fu(this.viewingMode);y.options.store=Yn.MIN,y.options.verticalOffset=l;const _=e.origin,v=oe($e.get(),_,e.direction);y.reset(_,v,c),y.point=u;const w=s?"type"in s&&s.type==="graphics"?T=>T.layerUid!==s.uid:T=>T.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const T=x=>(!w||w(x))&&!!x.lastValidElevationBB;y.intersect(d.layers,u,this._tolerance,null,T),this._externalIntersectionHandlers.forAll(x=>{if(x.type===Ai.I3S||x.type===Ai.TERRAIN){const E=x.slicePlaneEnabled?g:null;x.intersect(y,E,y.rayBegin,y.rayEnd,u)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(T=>{if(T.isGround){const x=T.slicePlaneEnabled?g:null;T.intersect(y,x,y.rayBegin,y.rayEnd,u)}})}if(y.results.min.getIntersectionPoint(XO)){const T=this._view.computeMapPointFromVec3d(XO);return T.z=i,T}return null}computeIntersection(e,r,i){var y;if(e==null)return;const s=this._view.state.camera,n=$e.get();s.projectToRenderScreen(e.origin,n);const o=new dQ(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=oe($e.get(),e.origin,e.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,u=c!=null?IY(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,u);const d=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const v=_.layerUid,w=Array.isArray(v),T=w?v:[v];w&&(r.options.filteredLayerUids=[]);let x=!1;for(const E of T)o.filterLayerUid(E)?x=!0:w&&r.options.filteredLayerUids.push(E);if(r.options.isFiltered=!x,_.isGround&&d||!r.options.isFiltered){const E=_.slicePlaneEnabled?u:null;_.intersect(r,E,a,l,n)}});const p=$e.get(),g=this._view.basemapTerrain;if(i&&i.enableDraped&&g.spatialReference!=null&&r.results.ground.getIntersectionPoint(p)){const _=g.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,w=$e.get();this._view.renderCoordsHelper.fromRenderCoords(p,w,g.spatialReference),w[2]=((y=this._view.elevationProvider)==null?void 0:y.getElevation(p[0],p[1],p[2],v,"ground"))??0,_.intersect(r,w,r.results.ground,T=>o.filterRenderGeometry(T))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;sm(this._tmpRegion,d6);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=w=>{const T=new TYe(w);i.projectToRenderScreen(w.target.center,T.screenPoint),T.screenPoint[0]=Math.floor(T.screenPoint[0]),T.screenPoint[1]=Math.floor(T.screenPoint[1]),s.push(T),qk(n,T.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const w of r.all)r.min.target.object!==w.target.object&&r.max.target.object!==w.target.object&&o(w);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-LS),u=Math.max(0,n[1]-LS),d=Math.min(lc(n)+2*LS,a-c),p=Math.min(Xh(n)+2*LS,l-u),g=new Uint8Array(d*p*4);this._view._stage.renderer.readHUDVisibility(c,u,d,p,g);let y=!0;const _=e.results.max.dist==null;let v=0;for(const w of s)for(const T of xYe)if(g[4*(Math.min(w.screenPoint[0]+T[0],a)-n[0]+(Math.min(w.screenPoint[1]+T[1],l)-n[1])*d)]){y&&(e.results.min.copy(w.result),y=!1),_&&e.results.max.copy(w.result),e.options.store===Yn.ALL&&e.results.all.splice(v++,0,w.result);break}}};const LS=1,xYe=(()=>{const t=[],e=LS;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let TYe=class{constructor(e){this.result=e,this.screenPoint=mo()}},YO;function hQ(t){return YO&&YO.viewingMode===t||(YO=Fu(t)),YO}let dQ=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function pQ(t){return typeof t=="object"&&"intersect"in t}const XO=C(),ZO=mo();let z1t=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,s,n){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,n,i,s)}},SYe=class{constructor(e,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(nt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,s=0){const n=vo(),o={x:e,y:r,minDemResolution:s,result:n,signal:i};return this._queries.push(o),Uo(i,()=>{Xz(this._queries,o),n.reject(wr())}),n.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(u=>u.result.reject()),void e.madeProgress();const s=r.map(u=>[u.x,u.y]),n=r.reduce((u,d)=>Math.min(u,d.minDemResolution),1/0),o=new JC({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let u=0;r.forEach(d=>Uo(d.signal,()=>{u++,d.result.reject(wr()),u===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(u=>{r.forEach((d,p)=>{d.signal!=null&&d.signal.aborted?d.result.reject(wr()):d.result.resolve(u.geometry.points[p][2])})}).catch(u=>{r.forEach(d=>d.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(la)}}},DS=class extends ys.EventedMixin(we){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Oe(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new SYe(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&Sn(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=JO(o,this._im,e,r,i,s,n),o==null&&(o=JO(o,this._ground,e,r,i,s,n)),n==="scene"&&(o=JO(o,this._scene,e,r,i,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,r){let i=1/0,s=-1/0;for(const n of[this._im,this._ground,this._scene])n.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,r);a!=null&&(i=Math.min(i,a.min),s=Math.max(s,a.max))}});return{min:i,max:s}}queryElevation(e,r,i,s,n,o=null,a=0){const l=vo();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{n==="scene"&&(c=JO(c,this._scene,e,r,i,s,n)),l.resolve(c)}).catch(c=>{gs(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,s,n))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){var r;this._handles.has(e)&&((r=this._handles.get(e))==null||r.remove(),this._handles.delete(e));for(const i of[this._im,this._ground,this._scene]){const s=i.indexOf(e);s>-1&&i.splice(s,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function JO(t,e,r,i,s,n,o){for(const a of e){const l=a.getElevation(r,i,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}h([f({constructOnly:!0})],DS.prototype,"view",void 0),h([f()],DS.prototype,"spatialReference",null),DS=h([F("esri.views.3d.support.CombinedElevationProvider")],DS);let NS=class mz{static isValidProfile(e){return e in mz.profiles}static getDefaultProfile(){return ie("esri-iPhone")?"low":"medium"}static apply(e,r){const i=mz.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityShadows=i.highQualityShadows,r.highQualityTransparency=i.highQualityTransparency,r.highQualityAtmosphere=i.highQualityAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function fQ(){const t=!!ie("esri-mobile"),e=!!ie("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityShadows:!1,highQualityTransparency:!1,highQualityAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityShadows:!1,highQualityTransparency:!0,highQualityAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600:750,additionalCacheMemory:t?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ie("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityShadows:!0,highQualityTransparency:!0,highQualityAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}NS.test={reset(){const t=fQ();for(const e of Object.keys(t))NS.profiles[e]=t[e]}},function(t){t.profiles=fQ()}(NS||(NS={}));const VP=NS;function Uge(){return new Float32Array(4)}function EYe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function $p(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function CYe(t,e){return new Float32Array(t,e,4)}function zge(){return Uge()}function kge(){return $p(1,1,1,1)}function Bge(){return $p(1,0,0,0)}function Vge(){return $p(0,1,0,0)}function Gge(){return $p(0,0,1,0)}function jge(){return $p(0,0,0,1)}const AYe=zge(),OYe=kge(),RYe=Bge(),PYe=Vge(),MYe=Gge(),$Ye=jge();Object.freeze(Object.defineProperty({__proto__:null,ONES:OYe,UNIT_W:$Ye,UNIT_X:RYe,UNIT_Y:PYe,UNIT_Z:MYe,ZEROS:AYe,clone:EYe,create:Uge,createView:CYe,fromValues:$p,ones:kge,unitW:jge,unitX:Bge,unitY:Vge,unitZ:Gge,zeros:zge},Symbol.toStringTag,{value:"Module"}));const mQ=new ht([0,255,255]),gQ=new ht([0,0,0]),yQ=1,_Q=.25,vQ=.4,bQ=.2;let jd=class extends we{constructor(){super(...arguments),this.color=mQ.clone(),this.haloColor=null,this.haloOpacity=yQ,this.fillOpacity=_Q,this.shadowOpacity=vQ,this.shadowColor=gQ.clone(),this.shadowDifference=bQ}static toEngineOptions(e){const r=ht.toUnitRGBA(e.color??mQ),i=e.haloColor!=null?ht.toUnitRGBA(e.haloColor):r,s=ht.toUnitRGBA(e.shadowColor??gQ),n=e.haloOpacity??yQ,o=e.fillOpacity??_Q,a=e.shadowOpacity??vQ,l=e.shadowDifference??bQ;return{color:$p(r[0],r[1],r[2],r[3]),haloColor:$p(i[0],i[1],i[2],i[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Ct(s[0],s[1],s[2],s[3]),occludedShadowOpacity:a*(1-l)}}};h([f({type:ht})],jd.prototype,"color",void 0),h([f({type:ht})],jd.prototype,"haloColor",void 0),h([f()],jd.prototype,"haloOpacity",void 0),h([f()],jd.prototype,"fillOpacity",void 0),h([f()],jd.prototype,"shadowOpacity",void 0),h([f({type:ht})],jd.prototype,"shadowColor",void 0),h([f()],jd.prototype,"shadowDifference",void 0),jd=h([F("esri.views.3d.support.HighlightOptions")],jd);const gz=jd;function IYe(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function LYe(t){return typeof t=="string"?da(t):ye(t)}function DYe(t,e,r){const i={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=DYe(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=e?o:JSON.stringify(o)}else i[s]=e?n:JSON.stringify(n);else i[s]=n}return i}function j1t(t){return{geometryType:rB(t[0]),geometries:t.map(e=>e.toJSON())}}function NYe(t,e,r){const i=gTe(e);return t.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let E_=class extends Ke{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:rB(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};h([f()],E_.prototype,"geometries",void 0),h([f({json:{read:{source:"outSR"}}})],E_.prototype,"outSpatialReference",void 0),h([f()],E_.prototype,"transformation",void 0),h([f()],E_.prototype,"transformForward",void 0),E_=h([F("esri.rest.support.ProjectParameters")],E_);const AD=E_,FYe=tn(AD);async function DG(t,e,r){e=FYe(e);const i=LYe(t),s={...i.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=rB(e.geometries[0]),a=IYe(s,r);return Es(i.path+"/project",a).then(({data:{geometries:l}})=>NYe(l,o,n))}async function NG(t=null,e){var s,n;if(Er.geometryServiceUrl)return Er.geometryServiceUrl;if(!t)throw new X("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||vc.getDefault():t,await r.load({signal:e});const i=(n=(s=r.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!i)throw new X("internal:geometry-service-url-not-configured");return i}async function UYe(t,e,r=null,i){const s=await NG(r,i),n=new AD;n.geometries=[t],n.outSpatialReference=e;const o=await DG(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new X("internal:geometry-service-projection-failed")}const zYe=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:NG,projectGeometry:UYe},Symbol.toStringTag,{value:"Module"}));let kYe=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=fa(this.spatialReference,Cr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=NG(e&&e.get("portalItem")).catch(()=>{throw new X("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],s=!1);const n=i.map(l=>l instanceof at?l:new at(l,this.spatialReference)),o=new AD({geometries:n,outSpatialReference:yt.WGS84}),a=(await DG(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},xh=class extends we{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};h([f()],xh.prototype,"minTotalNumberOfFeatures",void 0),h([f()],xh.prototype,"maxTotalNumberOfFeatures",void 0),h([f()],xh.prototype,"maxTotalNumberOfPrimitives",void 0),h([f()],xh.prototype,"snapshotAvailable",void 0),h([f()],xh.prototype,"polygonLodFactor",void 0),h([f()],xh.prototype,"polylineLodFactor",void 0),h([f()],xh.prototype,"skipHighSymbolLods",void 0),xh=h([F("esri.views.3d.support.QualitySettings.Graphics3DSettings")],xh);let xp=class extends we{constructor(){super(...arguments),this.lodFactor=1}};h([f()],xp.prototype,"lodFactor",void 0),xp=h([F("esri.views.3d.support.QualitySettings.LoDFactorSettings")],xp);let iI=class extends xp{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};iI=h([F("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],iI);let Of=class extends we{constructor(){super(...arguments),this.object=new iI,this.point=new xp,this.integratedMesh=new xp,this.pointCloud=new xp,this.uncompressedTextureDownsamplingEnabled=!1}};h([f({type:iI})],Of.prototype,"object",void 0),h([f({type:xp})],Of.prototype,"point",void 0),h([f({type:xp})],Of.prototype,"integratedMesh",void 0),h([f({type:xp})],Of.prototype,"pointCloud",void 0),h([f()],Of.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Of=h([F("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Of);let Yg=class extends we{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};h([f()],Yg.prototype,"lodBias",void 0),h([f()],Yg.prototype,"angledSplitBias",void 0),h([f()],Yg.prototype,"reduceTileLevelDifferences",void 0),h([f()],Yg.prototype,"textureFadeDuration",void 0),Yg=h([F("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Yg);let xw=class extends we{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([f()],xw.prototype,"pixelRatio",void 0),h([f()],xw.prototype,"maxTotalNumberOfFeatures",void 0),xw=h([F("esri.views.3d.support.QualitySettings.HeatmapSettings")],xw);let Fn=class extends we{constructor(){super(...arguments),this.graphics3D=new xh,this.sceneService=new Of,this.tiledSurface=new Yg,this.heatmap=new xw,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highQualityAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.highQualityShadows=!1,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([f({type:xh})],Fn.prototype,"graphics3D",void 0),h([f({type:Of})],Fn.prototype,"sceneService",void 0),h([f({type:Yg})],Fn.prototype,"tiledSurface",void 0),h([f({type:xw})],Fn.prototype,"heatmap",void 0),h([f()],Fn.prototype,"fadeDuration",void 0),h([f()],Fn.prototype,"antialiasingEnabled",void 0),h([f()],Fn.prototype,"physicallyBasedRenderingEnabled",void 0),h([f()],Fn.prototype,"highQualityTransparency",void 0),h([f()],Fn.prototype,"highQualityAtmosphere",void 0),h([f()],Fn.prototype,"reflections",void 0),h([f()],Fn.prototype,"ambientOcclusion",void 0),h([f()],Fn.prototype,"highQualityShadows",void 0),h([f()],Fn.prototype,"memoryLimit",void 0),h([f()],Fn.prototype,"additionalCacheMemory",void 0),h([f()],Fn.prototype,"frameRate",void 0),h([f()],Fn.prototype,"maximumPixelRatio",void 0),Fn=h([F("esri.views.3d.support.QualitySettings.QualitySettings")],Fn);const wQ=Fn;function BYe(t){return qx(t)&&t.length>=3}function VYe(t){return(Yx(t)||Array.isArray(t))&&t.length>=3}function GYe(t){return BYe(t)||VYe(t)}let jYe=class yz{constructor(e,r,i,s){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=JOe(s)}set extent(e){e&&QOe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return oRe(this._coordinateSystem,e)}setAltitude(e,r,i=e){return Aae(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){aRe(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return rRe(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return iRe(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,Al.X,$e.get()),s=this.worldBasisAtPosition(e,Al.Y,$e.get()),n=this.worldBasisAtPosition(e,Al.Z,$e.get());return Fp(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,$e.get()),s=this.worldBasisAtPosition(e,Al.Y,$e.get()),n=rae(r,s,i);return pa(n)}intersectManifoldClosestSilhouette(e,r,i){return ON(this._coordinateSystem,r,this._tmpCoordinateSystem),nRe(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){ON(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=$e.get();return sRe(this._tmpCoordinateSystem,e,s)?te(i,s):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===Re.Global)return this.intersectManifold(e,r,i);ON(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=$e.get();return av(s.plane,e,n)?te(i,n):null}toRenderCoords(e,r,i){return R$(e)?bo(e,r,this.spatialReference):wn(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return R$(r)?(i!=null&&(r.spatialReference=i),Toe(e,this.spatialReference,r)):GYe(r)?wn(e,this.spatialReference,r,i)?r:null:N0(e,this.spatialReference,r)}static create(e,r){switch(e){case Re.Local:return new yz(Re.Local,r,fa(r),tRe());case Re.Global:return new yz(Re.Global,r,1,eRe(r))}}static renderUnitScaleFactor(e,r){return xQ(e)/xQ(r)}};function xQ(t){if(P$(t,Re.Global))return 1;const e=Oae(!1,t);return fa(e)}var op;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(op||(op={}));const HYe=(()=>{const t=new Array;return t[op.ELEVATION]=10,t[op.BASEMAP]=10,t[op.I3S_INDEX]=10,t[op.I3S_DATA]=10,t[op.SYMBOLOGY]=5,t})(),WYe=30;function Hge(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function qYe(t){return new Pa({view:t})}const QO=1,U5=1,YYe=.75,XYe=.6,TQ=1.3;let Pa=class extends we{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Ffe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(QO),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,r){return new KBe(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<XYe&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(QO);else if(e)(this._memoryPredicted>1.1*U5||this._usedMemory>U5)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/TQ),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>U5)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/TQ),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<YYe&&this._quality<QO){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),QO))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l;if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const r=((a=this.view)==null?void 0:a._stage)&&this.view._stage.renderView&&((l=this.view._stage.renderer)==null?void 0:l.edgeView);r!=null&&(e+=r.usedMemory);let i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(c=>{if(Hge(c)){const u=c.ignoresMemoryFactor?this._quality:1;e+=c.usedMemory*u,i+=c.unloadedMemory*u}});const s=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const c=d=>(d/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",u=Math.round(100*this._quality);ne.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${c(n)} Current: ${c(e)} Projected: ${c(e+i)} Quality: ${u}%`)}this._usedMemory=e/n,this._memoryPredicted=(e+i)/n;const o=n-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};h([f({constructOnly:!0})],Pa.prototype,"view",void 0),h([f()],Pa.prototype,"maxMemory",null),h([f()],Pa.prototype,"additionalCacheMemory",null),h([f()],Pa.prototype,"memoryFactor",null),h([f()],Pa.prototype,"updating",null),h([f()],Pa.prototype,"usedMemory",null),h([f()],Pa.prototype,"_quality",void 0),h([f()],Pa.prototype,"_usedMemory",void 0),h([f()],Pa.prototype,"_updating",void 0),h([f()],Pa.prototype,"_stableQuality",void 0),h([f()],Pa.prototype,"_maxMemory",void 0),h([f()],Pa.prototype,"_additionalCacheMemory",void 0),Pa=h([F("esri.views.3d.support.MemoryController")],Pa);let ZYe=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},JYe=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new QYe}},QYe=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},KYe=class{constructor(e,r,i,s){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new JYe(n))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,s)=>this._taskCallback(i,s))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,He(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},GP=class extends we{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new KYe((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,r),i&&(this._frameTask=i.registerTask(nt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=bi(this._frameTask),this._tasks.forEach(e=>yc(e.abortController)),this._loadQueue=Oe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,s={}){const n=vo();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,r,i,s,n);return Uo(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,r,i,s,n,o){const a=new rXe(e,r,i,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;FE(e.resolvers,r),r.reject(wr()),e.resolvers.length===0&&(e.status===Kc.DOWNLOADING&&(e.status=Kc.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=Kc.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,s,n){const o=iXe(s!=null&&s.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,r,i,o,n)}_doneLoadingCB(e,r){this._loadQueue&&(He(e.status===Kc.DOWNLOADING),e.status=Kc.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();qt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==Kc.DOWNLOADED&&(r.err=r.err||wr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!gs(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(r)gs(r)?s.reject(r):s.reject(new X("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const n=i<=0?e.result:ye(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===Kc.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=Kc.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Es(e.url,{...e.options,responseType:s,timeout:i,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===Kc.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,d=tXe(u);if(s="image",e.size=u.byteLength,d==="unknown")return e.request=Es(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then(y=>a(y.data),l);const p=new Blob([u],{type:d}),g=window.URL.createObjectURL(p);o=()=>window.URL.revokeObjectURL(g),e.request=Es(g,{responseType:s,timeout:i,signal:n}),e.request.then(y=>a(new OD(y.data,d,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};h([f({readOnly:!0})],GP.prototype,"updating",void 0),GP=h([F("esri.views.3d.support.StreamDataLoader")],GP);const eXe={numRetries:0};function tXe(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let OD=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},rXe=class extends ZYe{constructor(e,r,i,s,n){super(s),this.url=e,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=Kc.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=eXe.numRetries}};function iXe(t,e,r){return`${t}:${e}:${r}`}var Kc;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Kc||(Kc={}));let jP=class extends we{constructor(){super(...arguments),this.updating=!1}};function sXe(t){return new fh({view:t})}h([f({readOnly:!0})],jP.prototype,"updating",void 0),jP=h([F("esri.views.3d.support.ResourceControllerMain")],jP);let fh=class extends jP{constructor(){super(...arguments),this._immediateTask=vx,this._normalTask=vx,this._updatingObjects=oC([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=vMe(),this._memoryController=qYe(this.view),this._streamDataLoader=new GP,this._streamDataLoader.setup(WYe,HYe,this._scheduler),this.addHandles([ce(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Nr),ce(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Kw({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(nt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(nt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=bi(this._frameTask),this._streamDataLoader=Oe(this._streamDataLoader),this._memoryController=Oe(this._memoryController),this._scheduler=Oe(this._scheduler),this.view=null}get updating(){var e,r,i,s;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(n=>n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,s,n)=>r.request(i,s,e,n),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],ha(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(sk(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};h([f()],fh.prototype,"view",void 0),h([f()],fh.prototype,"_scheduler",void 0),h([f()],fh.prototype,"_memoryController",void 0),h([f()],fh.prototype,"_streamDataLoader",void 0),h([f()],fh.prototype,"_immediateTask",void 0),h([f()],fh.prototype,"_normalTask",void 0),h([f()],fh.prototype,"_updatingObjects",void 0),h([f({readOnly:!0})],fh.prototype,"updating",null),fh=h([F("esri.views.3d.support.ResourceControllerImpl")],fh);function nXe(t){return Hge(t)}function oXe(t){return"performanceInfo"in t}const ib=C(),aXe=C(),ef=C(),tf=C();function lXe(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return Mie(i,e);const s=Math.min(i[2]-i[0],i[3]-i[1]);return tTe(i,e,r*s)}function KO(t,e,r,i){te(ib,r),ib[i]=e[i];const s=le(ib,ib,e),n=le(aXe,t,e),o=pe(n,s),a=pe(s,s);let l;l=o<=0?e:a<=o?r:oe(ib,e,ee(s,s,o/a));const c=le(ib,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function cXe(t,e,r){const i=t.extent;if(i==null)return 0;ef[0]=i[0],ef[1]=i[1],ef[2]=r,tf[0]=i[2],tf[1]=i[3],tf[2]=r;let s=1/0,n=1/0;return e[0]<ef[0]?s=KO(e,ef,tf,0):e[0]>tf[0]&&(s=KO(e,tf,ef,0)),e[1]<ef[1]?n=KO(e,ef,tf,1):e[1]>tf[1]&&(n=KO(e,tf,ef,1)),Math.min(s,n)}function uXe(t,e,r){if(t==null)return p7();if(t.spatialReference.isGeographic&&!M1(t.spatialReference))return new X("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=xl.checkUnsupported(t);if(i!=null)return i;if(r==null)return new X("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=hXe(t,r);if(s)return s;const n=t.spatialReference;return e==null||n.equals(e)||e.isWGS84&&n.isWebMercator?null:new X("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function hXe(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,s=[i*t.size[0],i*t.size[1]],n=[t.origin.x,t.origin.y],o=Rie(e),a=Ut();xl.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>hw){const c=r[0].scale*2**r[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const d=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**d)*10**d,new X("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:hw})}return null}const dXe=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:uXe,isInsideExtent:lXe,tiltToExtentEdge:cXe},Symbol.toStringTag,{value:"Module"}));function pXe(){return!0}function fXe(){return 0}function mXe(t,e){if(t==null)return p7();const r=t.lods.length-1,i=t.spatialReference,s=M1(i)||Lp(i)||Dp(i);if(i.isWebMercator){if(!xl.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new X("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new X("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!xl.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new X("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new X("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new X("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const gXe=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:mXe,isInsideExtent:pXe,tiltToExtentEdge:fXe},Symbol.toStringTag,{value:"Module"})),yXe={[Re.Global]:gXe,[Re.Local]:dXe};function ep(t,e){t||console.warn("Terrain: "+e)}let ks=!1,sI=!1;function _Xe(t){sI=t,ks=ks||t}function vXe(t){ks=t}function ve(t,e){var r;if(ks&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function _z(t){return RD(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function nI(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function RD(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function FG(t){return(t==null?void 0:t.type)==="tile-3d"}function MC(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function Wge(t){return(t==null?void 0:t.type)==="wmts-3d"}function vz(t){return(t==null?void 0:t.type)==="elevation-3d"}function vT(t){return(t==null?void 0:t.type)==="group"}function oI(t){return t&&(FG(t)||Wge(t)||RD(t)||MC(t))}function bz(t){return t&&(FG(t)||RD(t)||MC(t)||Wge(t))}function $C(t){return bz(t)||vz(t)}function bXe(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function wXe(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="vector-tile"}function xXe(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function TXe(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof OD||e instanceof HTMLCanvasElement||e instanceof ImageData}function Gw(t){return t!=null&&"release"in t&&t.release(),null}function SQ(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function UG(t,e,r,i){return yXe[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function PD(t,e,r){let i=null,s=null;if((t==null?void 0:t.type)==="wmts"){const n=SXe(t,e,r);i=n.tileInfo,s=n.fullExtent}else{s=nI(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===Re.Local;if(nI(t))i=t.getCompatibleTileInfo(e,s,n);else if((t==null?void 0:t.type)==="vector-tile"){const o=n&&!EXe(e)||CXe.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&s!=null&&UG(i,s,e,r)==null?{tileInfo:i,fullExtent:s}:null}function SXe(t,e,r){const i=Lxe(t);if(i!=null){if(!er.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>UG(n.tileInfo,n.fullExtent,e,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function EXe(t){return t.isWGS84||t.isWebMercator||Rre(t)||!jE(t)}const CXe={force512VTL:!1};function EQ(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function rf(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function uu(t,e,r=RXe){return Math.abs(t-e)<r}function aI(t){return t===mt.NORTH_EAST?mt.SOUTH_WEST:t===mt.NORTH_WEST?mt.SOUTH_EAST:t===mt.SOUTH_WEST?mt.NORTH_EAST:mt.NORTH_WEST}function lI(t){return t===mt.NORTH?mt.SOUTH:t===mt.EAST?mt.WEST:t===mt.SOUTH?mt.NORTH:mt.EAST}function AXe(t){return t===mt.NORTH_WEST||t===mt.SOUTH_WEST}function OXe(t){return t===mt.NORTH_WEST||t===mt.NORTH_EAST}function CQ(t){return t===mt.NORTH_WEST||t===mt.WEST||t===mt.SOUTH_WEST}function AQ(t){return t===mt.NORTH_EAST||t===mt.EAST||t===mt.SOUTH_EAST}function OQ(t){return t===mt.SOUTH_EAST||t===mt.SOUTH||t===mt.SOUTH_WEST}function RQ(t){return t===mt.NORTH_EAST||t===mt.NORTH||t===mt.NORTH_WEST}const hp=[mt.NORTH,mt.EAST,mt.SOUTH,mt.WEST],IC=[mt.NORTH_EAST,mt.SOUTH_EAST,mt.SOUTH_WEST,mt.NORTH_WEST],RXe=1e-5;let PXe=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=$C(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,oXe(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},MXe=class{constructor(e){var i;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,e.resourceController!=null){const s=e.resourceController.memoryController;this.totalMemory=(s.maxMemory??0)*QM.MEGABYTES,this.usedMemory=Math.round(s.usedMemory*this.totalMemory),this.quality=s.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=r!=null?r.usedMemory:0,e.allLayerViews.items.forEach(s=>{(nXe(s)||$C(s))&&this.layerPerformanceInfos.push(new PXe(s,e))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}},$Xe=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const s=i?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>Xme(new qme(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>Zme(e,n),r)}async _loadOnce(e,r,i,s,n){qt(n);const o=Uo(n,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),qt(n),l}finally{bi(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i!=null&&i.abortController.abort())}},IXe=class extends dw{constructor(e,r,i,s){super(r,s),this._streamDataRequester=e,this._parameters=i}async fromUrl(e,r,i){qt(i);const s=i!=null?i.signal:null,n=this.makeUid(e,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a};const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async u=>{const d=this._createTexture(e,u,r);return c.texture=d,c.abortController=null,this._stage.add(d),await this._stage.load(d),{uid:n,texture:d,release:()=>this._release(n)}},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await tve(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,r,i){var n;const s=this._parameters;if(Tre(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return s.width=r.width,s.height=r.height,new pv(r,s)}},LXe=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(op.SYMBOLOGY),this.objectResourceCache=new $Xe((i,s)=>e.resourceController.memoryController.newCache(i,s)),this.textures=new IXe(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:Ot.CLAMP_TO_EDGE,t:Ot.CLAMP_TO_EDGE}},e.resourceController.scheduler);const r=Cr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=Lhe(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=i9e(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return ha();this._graphicsOwners.push(e);const r=ce(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),ha(()=>{r.remove(),FE(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Oi;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ce(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,Nr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Oe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;eR.distance=e.centerOnSurfaceInfrequent.distance,eR.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(eR),this.screenSizePerspectiveSettingsLabels.update(eR),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const eR={distance:0,fovY:0};let Xb=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new l0({symbolLayers:[new a0({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new ov({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(r==null)return;this.hide();const i=new at({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new om({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},i0=class extends we{constructor(e){super(e),this.handles=new Oi}destroy(){this.handles.destroy()}};h([f({constructOnly:!0})],i0.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],i0.prototype,"surface",void 0),h([f({constructOnly:!0})],i0.prototype,"state",void 0),i0=h([F("esri.views.3d.support.PointOfInterest")],i0);const DXe=Array;let mh=class extends i0{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new lm({location:at,renderLocation:DXe},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=C(),this._tmpPoint=new at}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Ga(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Oe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=ei(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return k1(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),_o.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>NXe&&this.renderCoordsHelper.viewingMode===Re.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?FXe:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{gs(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,_o.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(z5,this._estimatedSurfaceAltitude,this._camera.eye),ca(this._get("renderLocation"),z5)||(this._set("renderLocation",te(this._propertiesPool.get("renderLocation"),z5)),this.notifyChange("renderLocation"))}};h([f({constructOnly:!0})],mh.prototype,"scheduler",void 0),h([f({constructOnly:!0})],mh.prototype,"cache",void 0),h([f({constructOnly:!0})],mh.prototype,"task",void 0),h([f({readOnly:!0})],mh.prototype,"location",null),h([f({constructOnly:!0})],mh.prototype,"map",void 0),h([f({readOnly:!0})],mh.prototype,"renderLocation",void 0),h([f({readOnly:!0})],mh.prototype,"scale",null),h([f({readOnly:!0})],mh.prototype,"updating",null),mh=h([F("esri.views.3d.support.CameraOnSurface")],mh);const z5=C(),NXe=1e5,FXe=1e6,UXe=Array;let eu=class extends i0{constructor(e){super(e),this._propertiesPool=new lm({location:at,renderLocation:UXe},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=C(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=bi(this._frameWorker),this._propertiesPool=Oe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,_o.YIELD}_updateRenderLocation(){const e=kXe;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=BXe;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(te(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=ei(this._camera.eye,e):(ee(e,this._camera.viewForward,this._get("distance")),oe(e,e,this._camera.eye)),ca(this._get("renderLocation"),e)||this._set("renderLocation",te(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var s,n;const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=Cr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=lo(i.eye),c=l<a*a,u=ei(i.eye,r);if(c&&u>o/4){const d=a-Math.sqrt(l);return ee(r,i.viewForward,d),oe(r,r,i.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;o!=null&&yL(o,(n=this.surface)==null?void 0:n.spatialReference,bT,this.renderCoordsHelper.spatialReference)&&(r[0]=me(r[0],bT[0],bT[2]),r[1]=me(r[1],bT[1],bT[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(kr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,s=ei(i,e),n=ei(i,r);if(Math.abs(n-s)/s>zXe)return!0}return!1}};h([f({constructOnly:!0})],eu.prototype,"scheduler",void 0),h([f({constructOnly:!0})],eu.prototype,"task",void 0),h([f()],eu.prototype,"distance",void 0),h([f({constructOnly:!0})],eu.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([f({readOnly:!0})],eu.prototype,"location",null),h([f({readOnly:!0})],eu.prototype,"renderLocation",void 0),h([f()],eu.prototype,"updating",void 0),eu=h([F("esri.views.3d.support.CenterOnSurface")],eu);const zXe=.05,kXe=C(),BXe=C(),bT=Ut();let VXe=class{constructor(e){this._handles=new Oi,this.events=new ys,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Oe(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",GXe)}};const GXe={},jXe=Array;let Hd=class extends i0{constructor(e){super(e),this._propertiesPool=new lm({location:at,renderLocation:jXe},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ce(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ce(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(nt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Oe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,PQ);const n=Math.max(0,(Math.acos(pe(PQ,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!M0(e,r)){const c=this._propertiesPool.get("renderLocation");te(c,r),this._set("renderLocation",c)}return _o.YIELD}const o=1-me(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(MQ);const l=this._propertiesPool.get("renderLocation");return Pr(l,r,MQ,a),e&&M0(e,l)||this._set("renderLocation",l),_o.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(mo());if(i[1]=r.aboveGround?r.padding[Gt.BOTTOM]:r.fullHeight-r.padding[Gt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,wT)){le(wT,wT,r.eye);const n=fe(wT,wT);if(this.renderCoordsHelper.intersectManifold(wc(r.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,r.eye)}updateRenderLocation(){this._dirty=!0}};h([f()],Hd.prototype,"_dirty",void 0),h([f({constructOnly:!0})],Hd.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Hd.prototype,"centerOnSurface",void 0),h([f({constructOnly:!0})],Hd.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([f({readOnly:!0})],Hd.prototype,"updating",null),h([f({readOnly:!0})],Hd.prototype,"location",null),h([f({readOnly:!0})],Hd.prototype,"renderLocation",void 0),Hd=h([F("esri.views.3d.support.pointsOfInterest.Focus")],Hd);const PQ=C(),wT=C(),MQ=C();let xf=class extends we{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=C();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Oi}initialize(){this.view.state.isLocal&&(this._handles.add([ce(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),Ga(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=Yk(this.surfaceView.extent),r=new at({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{gs(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};h([f({constructOnly:!0})],xf.prototype,"view",void 0),h([f({constructOnly:!0})],xf.prototype,"cache",void 0),h([f()],xf.prototype,"surface",null),h([f()],xf.prototype,"surfaceView",null),h([f({readOnly:!0})],xf.prototype,"location",void 0),h([f({readOnly:!0})],xf.prototype,"renderLocation",null),xf=h([F("esri.views.3d.terrain.StableSurfaceCenter")],xf);let Tf=class extends we{constructor(e){super(e),this._tileGeometryUpdateExtent=Au(),this._tileGeometryUpdateSpatialReference=null,this.events=new ys,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(nt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",HXe),Au(this._tileGeometryUpdateExtent),this._set("updating",!1)),_o.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,b0(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,s=WXe,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,By,r),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Vy,r),By[0]<Vy[0]?(s[0]=By[0],s[2]=Vy[0]):(s[0]=Vy[0],s[2]=By[0]),By[1]<Vy[1]?(s[1]=By[1],s[3]=Vy[1]):(s[1]=Vy[1],s[3]=By[1]),YI(s,e)}};h([f({constructOnly:!0})],Tf.prototype,"state",void 0),h([f({constructOnly:!0})],Tf.prototype,"centerOnSurfaces",void 0),h([f({constructOnly:!0})],Tf.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Tf.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Tf.prototype,"surface",void 0),h([f({readOnly:!0})],Tf.prototype,"updating",void 0),Tf=h([F("esri.views.3d.support.SurfaceGeometryUpdates")],Tf);const HXe={},By=C(),Vy=C(),WXe=Au();let $a=class extends we{constructor(e){super(e),this._handles=new Oi,this._tmpRay=vn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new lm({renderPointOfView:qXe},this),this.renderPointOfView=C(),this._pois=new Array,this._debugCenters=new Map}initialize(){var u;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:s}=this.view;this._surfaceIntersector=Fu(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Yn.MIN,this._contentIntersector=Fu(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new eu({...l,task:nt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new eu({...l,task:nt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new eu({...l,task:nt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new mh({...l,cache:a,task:nt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new Tf({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new VXe({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new xf({cache:a,view:this.view})),this._set("focus",new Hd({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(d,p)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Xb(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Xb(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new Xb(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Xb(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new Xb(c,"green","Focus")),this._handles.add([ce(()=>e.contentCamera,d=>this._cameraChanged(d),Nr),ce(()=>r.extent,()=>this._updateCenterPointsOfInterest()),Mu(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),Nr),Ga(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Ga(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Mu(()=>kr.SHOW_POI,d=>this._setDebug(d),Tr)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,sb,XXe)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(sb):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=oe(sb,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(sb)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(sb)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const s=uV(r,e,YXe);if(s==null)return null;const n=s.origin,o=oe(sb,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;ca(this.renderPointOfView,r)||this._set("renderPointOfView",te(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(ce(()=>r.renderLocation,i=>{var s;return(s=this._debugCenters.get(r))==null?void 0:s.show(i,r.renderCoordsHelper.spatialReference)},Tr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};h([f({readOnly:!0})],$a.prototype,"centerOnContent",void 0),h([f({readOnly:!0})],$a.prototype,"centerOnSurfaceFrequent",void 0),h([f({readOnly:!0})],$a.prototype,"centerOnSurfaceInfrequent",void 0),h([f({readOnly:!0})],$a.prototype,"cameraOnSurface",void 0),h([f({readOnly:!0})],$a.prototype,"focus",void 0),h([f({readOnly:!0})],$a.prototype,"renderPointOfView",void 0),h([f({readOnly:!0})],$a.prototype,"surfaceOrigin",void 0),h([f({readOnly:!0})],$a.prototype,"contentGeometryUpdates",void 0),h([f({readOnly:!0})],$a.prototype,"surfaceGeometryUpdates",void 0),h([f({constructOnly:!0})],$a.prototype,"view",void 0),h([f({readOnly:!0})],$a.prototype,"updating",null),$a=h([F("esri.views.3d.support.PointsOfInterest")],$a);const qXe=Array,sb=C(),YXe=vn(),XXe={exclude:new Set([Kg])},LC=new er,ME=new WeakMap;function ZXe(t){qge(t)&&LC.push(t)}function JXe(t){qge(t)&&LC.includes(t)&&LC.remove(t)}function qge(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function Yge(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:Yge(e,t%e):0}let k5=0,tR=0;function QXe(){const t=Date.now();for(const e of LC)e.refreshInterval&&t-(ME.get(e)??0)+5>=6e4*e.refreshInterval&&(ME.set(e,t),e.refresh(t))}Ute(()=>{const t=Date.now();let e=0;for(const r of LC)e=Yge(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?ME.get(r)||ME.set(r,t):ME.delete(r);if(e!==tR){if(tR=e,clearInterval(k5),tR===0)return void(k5=0);k5=setInterval(QXe,tR)}});function KXe(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const Svt=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=ik(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||ZXe(this)},()=>{})}destroy(){JXe(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){cM(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{ne.getLogger(this.declaredClass).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return h([f({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),h([f({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),h([f()],e.prototype,"refreshParameters",null),e=h([F("esri.layers.mixins.RefreshableLayer")],e),e};let eZe=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},tZe=class{constructor(e,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}},Xge=class{constructor(e,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=QAe(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>ne.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),ha(()=>{i.removed=!0,Xz(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const s=this._transferLists[e],n=s?s(r):[];return this._thread.invoke(e,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(qt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},$Q=class extends Xge{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&($E.forEach((e,r)=>{e===this&&$E.delete(r)}),this.destroy())}};const $E=new Map;function rZe(t=null){let e=$E.get(t);return e||(t!=null?(e=new $Q(r=>t.immediate.schedule(r)),$E.set(t,e)):(e=new $Q,$E.set(null,e))),++e.ref,e}var bl,IQ,LQ;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(bl||(bl={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(IQ||(IQ={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(LQ||(LQ={}));let iZe=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},Pvt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function $vt(t,e,r,i,s,n){const o=r-s;if(o>=0)return(e>>o)+(i-(n<<o))*(t>>o);const a=-o;return e-(n-(i<<a))*(t>>a)<<a}let Ivt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,r,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function sZe(t,e,r,i,s,n){const o=e[i++];for(let a=0;a<o;a++){const l=new iZe(n);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let p=0;p<c;p++){const g=e[i++],y=e[i++],_=e[i++],v=e[i++],w=!!e[i++],T=e[i++],x=r[i++],E=r[i++],O=e[i++],A=e[i++];l.colliders.push({xTile:g,yTile:y,dxPixels:_,dyPixels:v,hard:w,partIndex:T,width:O,height:A,minLod:x,maxLod:E})}const u=t[i++];for(let p=0;p<u;p++)l.textVertexRanges.push([t[i++],t[i++]]);const d=t[i++];for(let p=0;p<d;p++)l.iconVertexRanges.push([t[i++],t[i++]]);s.push(l)}return i}function Dvt(t,e,r){for(const[i,s]of t.symbols)nZe(t,e,r,s,i)}function nZe(t,e,r,i,s){const n=t.layerData.get(s);if(n.type===bl.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let d=c;d<c+u;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let d=c;d<c+u;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let MD=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e,this.memoryUsed=e.byteLength;let i=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},oZe=class extends MD{constructor(e,r){super(e,r),this.type=bl.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],u=i[s++];o.set(l,[c,u])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.lineVertexArrayObject!=null&&this.lineVertexArrayObject.dispose(),this.lineVertexBuffer!=null&&this.lineVertexBuffer.dispose(),this.lineIndexBuffer!=null&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.lineVertexBuffer=br.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.lineIndexBuffer=br.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new Iu(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}},aZe=class extends MD{constructor(e,r){super(e,r),this.type=bl.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],u=i[s++];o.set(l,[c,u])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVertexArrayObject!=null&&this.fillVertexArrayObject.dispose(),this.fillVertexBuffer!=null&&this.fillVertexBuffer.dispose(),this.fillIndexBuffer!=null&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,this.outlineVertexArrayObject!=null&&this.outlineVertexArrayObject.dispose(),this.outlineVertexBuffer!=null&&this.outlineVertexBuffer.dispose(),this.outlineIndexBuffer!=null&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.fillVertexBuffer=br.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.fillIndexBuffer=br.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.outlineVertexBuffer=br.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.outlineIndexBuffer=br.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c;const u=this.layer,d=u.fillMaterial,p=u.outlineMaterial;this.fillVertexArrayObject=new Iu(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new Iu(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}},lZe=class extends MD{constructor(e,r,i){super(e,r),this.type=bl.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let p=0;p<l;p++){const g=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(g,[y,_])}const c=s[a++];for(let p=0;p<c;p++){const g=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(g,[y,_])}const u=s[a++],d=s[a++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(d),a=sZe(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVertexArrayObject!=null&&this.iconVertexArrayObject.dispose(),this.iconVertexBuffer!=null&&this.iconVertexBuffer.dispose(),this.iconOpacityBuffer!=null&&this.iconOpacityBuffer.dispose(),this.iconIndexBuffer!=null&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,this.textVertexArrayObject!=null&&this.textVertexArrayObject.dispose(),this.textVertexBuffer!=null&&this.textVertexBuffer.dispose(),this.textOpacityBuffer!=null&&this.textOpacityBuffer.dispose(),this.textIndexBuffer!=null&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconOpacityBuffer;e.length>0&&e.byteLength===r.size&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,s=this.textOpacityBuffer;i.length>0&&i.byteLength===s.size&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.iconVertexBuffer=br.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.iconIndexBuffer=br.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.textVertexBuffer=br.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.textIndexBuffer=br.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c,this.iconOpacityBuffer=br.createVertex(e,hr.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=br.createVertex(e,hr.STATIC_DRAW,this.textOpacity.buffer);const u=this.layer,d=u.iconMaterial,p=u.textMaterial;this.iconVertexArrayObject=new Iu(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new Iu(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}},cZe=class extends MD{constructor(e,r){super(e,r),this.type=bl.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.circleVertexArrayObject!=null&&this.circleVertexArrayObject.dispose(),this.circleVertexBuffer!=null&&this.circleVertexBuffer.dispose(),this.circleIndexBuffer!=null&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.circleVertexBuffer=br.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.circleIndexBuffer=br.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new Iu(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}};const Bvt=!0,Vvt=32,DQ=200,uZe=1/ie("mapview-transitions-duration");let hZe=class extends ys{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=vo(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=vo(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=e*uZe;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},wz=class C_{static getId(e,r,i,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${s}`}constructor(e,r,i,s){this.set(e,r,i,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,s){this.set(e,r,i,s)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new C_(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new C_(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new C_(e,r,i,s),new C_(e,r,i+1,s),new C_(e,r+1,i,s),new C_(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};wz.pool=new po(wz,null,null,25,50);let dZe=class extends hZe{constructor(e,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new wz(e),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;R7(i,o,0,0,0,a,0,s,n,1),Tx(this.transforms.dvs,e.displayViewMat3,i)}},B5=class Zge extends dZe{constructor(e,r,i,s,n,o,a,l=null){super(e,r,i,s,n,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<DQ}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<DQ)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let r=!1;for(const i of e)if(this.layerData.has(i)){const s=this.layerData.get(i);this._memoryUsedByLayerData-=s.memoryUsed,s.type===bl.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),s.destroy(),this.layerData.delete(i),this.layerCount--}this._memCache!=null&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(Jge.delete(this),Zge._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let r=!1;if(e){const{bucketsWithData:i,emptyBuckets:s}=e,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===bl.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;this._memCache!=null&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[i,s]of this.layerData)s.type===bl.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;P7(o),u$(o,o,n),M7(o,o,Math.PI*e.rotation/180),$7(o,o,[i,s,1])}_createTransforms(){return{dvs:Ha(),tileMat3:Ha(),tileUnitsToPixels:Ha()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const s of e){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case bl.FILL:i=new aZe(e,this.styleRepository);break;case bl.LINE:i=new oZe(e,this.styleRepository);break;case bl.SYMBOL:i=new lZe(e,this.styleRepository,this);break;case bl.CIRCLE:i=new cZe(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const Jge=new Map;function pZe(){Jge.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const Hvt={value:.5,readOnly:!0},fZe={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let Tw=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},mZe=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},gZe=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new mZe(i,r)}computeMinMaxValue(e,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,d=.5*nC;let p=(c-1)/o,g=(i-this.j*o)*p,y=(r-this.i*o)*p;if(p<1){const _=Math.floor(g),v=Math.floor(y),w=_+v*c,T=u[w],x=u[w+1],E=u[w+c],O=u[w+c+1];if(T+x+E+O<d){const A=g-_,$=y-v,M=m3(T,x,E,O,A,$),U=m3(T,x,E,O,A+p,$),k=m3(T,x,E,O,A,$+p),B=m3(T,x,E,O,A+p,$+p);return s.min=Math.min(M,U,k,B),s.max=Math.max(M,U,k,B),s}g=_,y=v,p=1}else g=Math.floor(g),y=Math.floor(y),p=Math.ceil(p);for(let _=g;_<=g+p;_++)for(let v=y;v<=y+p;v++){const w=u[_+v*c];w<d?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const yZe=.5*nC;function Ii(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=me(i.dy*(i.y1-e),0,s),o=me(i.dx*(t-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,u=a*c+l,d=i.data.values,p=d[u],g=d[u+1],y=u+c,_=d[y],v=d[y+1];if(p+_+g+v<yZe){n-=a,o-=l;const w=p+(g-p)*o;return w+(_+(v-_)*o-w)*n}}return null}let Qc=class extends we{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=Qge(i.fullExtent,this.viewSpatialReference);s!=null&&e.push(Rie(s))}}),e}};function _Ze(t,e){return t===Re.Global?new xz(e):new Tz(e)}h([f({readOnly:!0})],Qc.prototype,"layerViewsExtent",null),h([f({readOnly:!0})],Qc.prototype,"tiledLayersExtent",null),h([f({readOnly:!0})],Qc.prototype,"stencilEnabledExtents",null),h([f()],Qc.prototype,"viewSpatialReference",void 0),h([f()],Qc.prototype,"tilingScheme",void 0),h([f()],Qc.prototype,"defaultTiledLayersExtent",void 0),h([f({constructOnly:!0})],Qc.prototype,"layers",void 0),h([f({constructOnly:!0})],Qc.prototype,"layerViews",void 0),Qc=h([F("esri.views.3d.terrain.ExtentHelper")],Qc);let xz=class extends Qc{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?ile:kPe}};xz=h([F("esri.views.3d.terrain.ExtentHelperGlobal")],xz);let Tz=class extends Qc{_computeLayerViewsExtent(){const e=Au(),r=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=Qge("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,r);b0(e,a,e)}});const i=c6(e)?e:null,s=this._get("layerViewsExtent");return r1(i,s)?s:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=Au();this.layers.forEach(o=>{if(o.loaded&&QS(o)){const a=PD(o,r,Re.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(nI(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&b0(i,c,i)}}),b0(i,this.defaultTiledLayersExtent,i);const s=c6(i)?i:null,n=this._get("tiledLayersExtent");return r1(s,n)?n:s}};function Qge(t,e){return t==null||t.spatialReference.equals(e)?t:boe(t,t.spatialReference,e)}Tz=h([F("esri.views.3d.terrain.ExtentHelperLocal")],Tz);var jt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(jt||(jt={}));const A_=[jt.ELEVATION,jt.MAP];function Kge(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.search(".glsl")!==-1&&delete t[i]}}const vZe=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let og,Ko=class extends we{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||kr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Cr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Oi,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ie("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){var s;const e=this.view;this.renderer=new dh({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const r=()=>this.setDrawTexturesDirty();this._groundIntersector=Fu(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{r(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",n=>{var o;return(o=e._stage)==null?void 0:o.renderer.setParameters({hasOverlayWater:n})}),this.renderer.events.on("renders-occluded",()=>{r(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",r),ce(()=>e.state.camera.pixelRatio,r),ce(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ce(()=>{var n,o,a;return[(n=e.pointsOfInterest)==null?void 0:n.renderPointOfView,(a=(o=e.pointsOfInterest)==null?void 0:o.centerOnSurfaceFrequent)==null?void 0:a.location]},()=>this.setPlacementDirty()),ce(()=>{var n,o;return[(n=e.state)==null?void 0:n.pixelRatio,(o=e.state)==null?void 0:o.contentPixelRatio]},()=>this.setPlacementDirty(),Nr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(nt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",n=>{this._updateOverlays(la,n.camera,ts.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,ts.BACKGROUND,n)})]);let i=n=>this._renderOverlayCallback(n);this._removeRenderOverlayCallback=()=>{i=()=>{}},(s=e._stage)==null||s.renderer.setParameters({renderOverlay:n=>i(n)})}_renderOverlayCallback(e){this._contentUpdated=!1;const r=this.renderer;r.processSyncDrapeSources(),r.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(r.overlays,ts.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){var e,r;this._handles=Oe(this._handles),this._removeRenderOverlayCallback(),(r=(e=this.view)==null?void 0:e._stage)==null||r.renderer.setParameters({renderOverlay:()=>{}}),og!=null&&(og.hide(),og=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new $0(-20037508342787e-6,20037508342787e-6):new $0(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Xl)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,ts.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return _o.YIELD;const s=this._computeOverlayResolution(r);this._computeOverlayExtents(r,s,sf);const n=lc(sf.inner)/lc(sf.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(Ci.INNER,sf.inner,s,1*sf.pixelRatioAdjustment,sf.mapUnitsPerPixel),a=this._updateOverlay(Ci.OUTER,sf.outer,s,n*sf.pixelRatioAdjustment,sf.mapUnitsPerPixel);o!==Jd.EXTENT&&a!==Jd.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===Jd.NONE&&a===Jd.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,s=e.fullHeight/e.pixelRatio*r;return Math.min(Hk(Math.max(i,s)+256),this._maxResolution)}_updateOverlay(e,r,i,s,n){if(this.renderer.overlays.length===0)return Jd.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,bZe(r,o.extent)&&i===o.resolution)return a===n?Jd.NONE:Jd.RERENDER_ONLY;sm(o.extent,r),o.resolution=i;const l=Yk(o.extent);return o.renderLocalOrigin=G$(l[0],l[1],0,"OV_"+this._latestOriginId++),Jd.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Ci.INNER],s=this.renderer.overlays[Ci.OUTER],n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,Ci.INNER,r),this._setTileOverlayData(n,Ci.OUTER,r)):(this._clearTileOverlayData(Ci.INNER,r),this._clearTileOverlayData(Ci.OUTER,r))}else this._clearTileOverlayData(Ci.INNER,r),this._clearTileOverlayData(Ci.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[Ci.INNER],i=this.renderer.overlays[Ci.OUTER],s=this._pointIsInExtent(e,r.extent)?r:i;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[r].extent,n=lc(s),o=Xh(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,lc(e)/n,Xh(e)/o),i.setOffset(r,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){Kge(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(la)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,s=new ede(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,TZe,r,i);if(n==null)return!1;const o=n.origin,a=oe(rR,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=me(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=rR;c2(bL(wL,Cr(this.view.spatialReference).radius+l),wc(e.eye,e.viewForward),u),le(u,u,e.eye);const d=I0.normalize(rae(e.viewForward,u,e.viewRight))/e.fovY+.5,p=d<=0||d>=1?.5:s;i=c?p*d:d+p*(1-d)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(u),p=Ct(0,d,1,0),g=uc(p,p,e.projectionMatrix)[1],y=me(.5+.5*g,0,1);i=y===1||y===0?.5:c?y*s:1-(1-y)*s}return!!this._intersectGroundFromView(e,.5,i,r)&&jI(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=C();this._findHorizonBasedPointOfInterest(e,n)||te(n,s);const o=Math.max(.1,ei(e.eye,n)),a=G0(this.view.renderCoordsHelper,s,e.eye),l=Math.PI/2-Math.abs(a-Math.PI/2);kr.OVERLAY_SHOW_CENTER?(og==null&&(og=new Xb(this.view.graphics,"red")),og.show(n,this._renderSR)):og!=null&&og.hide(),this._overlaySREqualsRenderSR||wn(n,this._renderSR,n,this._spatialReference);const c=this.surface.extent,u=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,d=u&&this._spatialReference!=null?1/Cr(this._spatialReference).metersPerDegree:1,p=this.view.state.contentPixelRatio,g=e.perScreenPixelRatio/p*o*d;i.mapUnitsPerPixel=g/this._worldToPCSRatio;let y=r*g/2,_=!1,v=u?90:1/0;this._isSpherical&&c!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(y/=Math.cos(EM(n[1])),v=c[3]):(_=!0,y/=Cr(this._spatialReference).metersPerDegree,v=90),y>=v&&(y=v,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let w=1;_&&(w=1/Math.max(.2,Math.cos(Math.abs(At(n[1])))),y*w>180&&(w=180/y),i.mapUnitsPerPixel*=w);const T=Math.log(2)/12;y=Math.exp(Math.round(Math.log(y)/T)*T);const x=y*w,E=32,O=.5*r/(E*x),A=.5*r/(E*y);n[0]=Math.round(n[0]*O)/O,n[1]=Math.round(n[1]*A)/A;const $=i.inner;$[0]=n[0]-x,$[1]=n[1]-y,$[2]=n[0]+x,$[3]=n[1]+y,this._isSpherical&&this._shiftExtentToFitBounds($,1/0,v);const M=i.outer;if(6*x>lc(c))sm(M,c);else if(l<=.25*Math.PI)M[0]=$[0]-x,M[1]=$[1]-y,M[2]=$[2]+x,M[3]=$[3]+y;else{wn(e.eye,this._renderSR,rR,this._spatialReference),ip(Gy,n,rR);let k=-Math.atan2(Gy[1],Gy[0])+.125*Math.PI;k<0&&(k+=2*Math.PI);const B=Math.floor(k/(.25*Math.PI));Qx(Gy,vZe[B],2*y),Gy[0]*=w,Gy[2]*=w,kk(M,$,Gy)}if(this._isSpherical)M[0]=this._longitudeCyclical.clamp(M[0]),M[2]=this._longitudeCyclical.clamp(M[2]),M[1]=Math.max(M[1],-v),M[3]=Math.min(M[3],v);else{const k=u6($,c,wZe),B=u6(M,c,xZe);vH(k,B)&&(M[2]=M[0],M[3]=M[1])}const U=Math.abs($[2]-$[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,U),i.pixelRatioAdjustment=i.mapUnitsPerPixel/U}_drawOverlayTextures(e,r,i){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[Ci.INNER],i),o=this._drawOverlay(e[Ci.OUTER],i);n!==xx.CHANGED&&o!==xx.CHANGED||this.surface.updateTileOverlayParams(ts.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(r),r===ts.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(ts.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):YI(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:vH(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,s=e.y;return i>r[0]&&i<r[2]&&s>r[1]&&s<r[3]}_shiftExtentToFitBounds(e,r,i){let s=0,n=0;e[0]<-r?s=e[0]+r:e[2]>r&&(s=r-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),LM(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(la)}}};function bZe(t,e){const i=kr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}h([f()],Ko.prototype,"_spatialReference",void 0),h([f({readOnly:!0})],Ko.prototype,"running",null),h([f()],Ko.prototype,"_placementDirty",void 0),h([f()],Ko.prototype,"_contentUpdated",void 0),h([f()],Ko.prototype,"_isSpherical",null),h([f()],Ko.prototype,"_worldToPCSRatio",null),h([f({autoDestroy:!0})],Ko.prototype,"renderer",void 0),h([f({constructOnly:!0})],Ko.prototype,"view",void 0),h([f({constructOnly:!0})],Ko.prototype,"surface",void 0),h([f()],Ko.prototype,"suspended",null),h([f()],Ko.prototype,"updating",null),h([f({type:Boolean})],Ko.prototype,"hasHighlights",null),h([f({type:Boolean})],Ko.prototype,"rendersOccluded",null),Ko=h([F("esri.views.3d.terrain.OverlayManager")],Ko);const Gy=Ht(),rR=C(),sf={inner:Ut(),outer:Ut(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},wZe=Ut(),xZe=Ut(),TZe=vn();var Jd;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(Jd||(Jd={}));let e0e=class Sz{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!Sz.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+s),r}}release(e){if(Sz.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new Nt({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};e0e.test={disabled:!1};let SZe=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=li(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},NQ=class{constructor(e,r,i,s,n){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return ve(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),oe(e,e,this.localOrigin)}getNormal(e,r){const{typedBuffer:i,typedBufferStride:s}=this.attributes.normalCompressed;S7e(e,i,this.getAttributeIndex(r),s)}_setNormal(e,r,i,s){const{typedBuffer:n,typedBufferStride:o}=this.attributes.normalCompressed;W1(n,e,r,i,s,o)}_setUV(e,r,i){Wh(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,s){this._setNormal(this.getAttributeIndex(e),r,i,s)}setVertexFromValuesRawPositionUV(e,r,i,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,s,n,o,a,l,c){const u=this.getAttributeIndex(e);this.attributes.position.setValues(u,r,i,s),this._setUV(u,n,o),this._setNormal(u,a,l,c)}};const EZe=Ri().vec3f(S.POSITION).vec2i16(S.UV0).vec2i16(S.NORMALCOMPRESSED,{glNormalized:!0}),zG=new e0e(t=>EZe.createBuffer(t),t=>t.count);function CZe(){zG.clear()}function t0e(t){return zG.acquire(t)}function AZe(t){zG.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const FQ=16384;function Wh(t,e,r,i){t.setValues(e,r*FQ,i*FQ)}function Eu(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let OZe=class{constructor(){this.sinLonLUT=new Array(lS+1),this.cosLonLUT=new Array(lS+1),this.sinLatLUT=new Array(lS+1),this.cosLatLUT=new Array(lS+1)}update(e,r,i){const s=r[0],n=r[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},iR=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},RZe=class{constructor(){this.cornerNeighborData=[new iR,new iR,new iR,new iR],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},PZe=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new RZe}},r0e=class HP{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Oe(this._current),this._next=Oe(this._next),this._waiting=Oe(this._waiting),this._delayed=Oe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=HP.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Zf.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==Ns.FADING,n=e-this._fadeStart>=r;(i||s||n)&&(Oe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=HP.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=Zf.Immediate){this._delayed=Oe(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=HP.test.fadeMoment||performance.now();return r!==Zf.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Oe(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Zf;r0e.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Zf||(Zf={}));var Vx;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(Vx||(Vx={}));let i0e=class{constructor(){this._queue=new Nt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},MZe=class{constructor(){this._q=new Nt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function IE(t,e,r){if(e==null||e.fullExtent==null)return!1;const i=e.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function Jf(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function s0e(t,e,r=null){r==null||r.length===0?t===Vx.BACK_TO_FRONT?e.sort($Ze):e.sort(IZe):e.sort((i,s)=>LZe(i,s,t,r))}function $Ze(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function IZe(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function n0e(t,e,r){const i=t.screenDepth,s=e.screenDepth;return i<s?-r:i>s?r:Jf(t,e)}function LZe(t,e,r,i){return UQ(t,i)===UQ(e,i)?n0e(t,e,r):t?r:-r}function UQ(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function DZe(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function NZe(t,e){const r=t.length;for(let i=0;i<r;++i)t.getItemAt(i).updateDistanceToPOI(e);t.sort(DZe)}function FZe(t,e,r){let i=1,s=0,n=0;for(;t!==e;)if(i*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,s,n,i)}function UZe(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function abt(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,s=r?e:t,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}let kG=class{get updating(){return!!this._tileRequested}init(e,r,i,s){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Ns.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),s=_z(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?IE:()=>!0;let u=this.tile;const d=u.level;let p;const g=this._tileLayerInfo.upsampleInfo,y=g!=null?g.tile.level:-1,_=g!=null&&y-d>=a,v=s==null?void 0:s.tilemapCache,w=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;u&&c(u,s,!1)&&u.level>=n;){const T=u.level,x=d-T,E=u.layerInfo[r][e];if(E.data&&x>=a){(!_||T>y)&&this._setUpsampleTile(u),E.dataInvalidated&&(p=u);break}const O=(w==null?void 0:w.getLevelRowColumn(u.lij))??u.lij;if((v==null?void 0:v.getAvailability(O[0],O[1],u.lij[2]))!=="unavailable"&&T<=o&&!E.data&&!E.dataMissing&&((!p||u.level===n||T%rle==0||d-p.level<a)&&(p=u),x>=l))break;u=u.parent}if(p!=null&&d-p.level<a)if(g)p=null;else{const T=this._findAncestorWithData();T!=null&&(this._setUpsampleTile(T),p=T.layerInfo[r][e].dataInvalidated?T:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=r)return s;i=s}return i}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Ns.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},zZe=class extends kG{get _desiredMinLevelDelta(){throw zQ}get _progressiveLevelModulo(){throw zQ}dispose(){}};const zQ=new Error("Abstract method called on TileAgent"),il=new zZe;let o0e=class extends kG{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return r8(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},a0e=class extends kG{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return rle}};var d1,Y1;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(d1||(d1={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(Y1||(Y1={}));function kZe(t){t.fragment.uniforms.add(new We("u_colormap",e=>e.u_colormap),new Se("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Se("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Se("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(b`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function BZe(t){t.fragment.uniforms.add(new We("u_transformGrid",e=>e.u_transformGrid),new mr("u_transformSpacing",e=>e.common.u_transformSpacing),new mr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(b`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let l0e=class extends Ar{constructor(){super(...arguments),this.scale=1,this.offset=Kh}};function c0e(t){t.attributes.add(S.POSITION,"vec2"),t.attributes.add(S.UV0,"vec2"),t.vertex.uniforms.add(new Se("scale",e=>e.scale)),t.vertex.uniforms.add(new mr("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let VZe=class extends l0e{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function GZe(t,e){t.include(BZe),t.fragment.uniforms.add(new We("u_image",i=>i.u_image),new vp("u_flipY",i=>i.common.u_flipY),new vp("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new mr("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(b`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(b`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(b`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Ae;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Ae||(Ae={}));const Ez={normal:Ae.Normal,average:Ae.Average,lighten:Ae.Lighten,lighter:Ae.Lighter,screen:Ae.Screen,plus:Ae.Plus,"color-dodge":Ae.ColorDodge,darken:Ae.Darken,multiply:Ae.Multiply,"color-burn":Ae.ColorBurn,overlay:Ae.Overlay,"soft-light":Ae.SoftLight,"hard-light":Ae.HardLight,"vivid-light":Ae.VividLight,hue:Ae.Hue,saturation:Ae.Saturation,luminosity:Ae.Luminosity,color:Ae.Color,difference:Ae.Difference,exclusion:Ae.Exclusion,minus:Ae.Minus,invert:Ae.Invert,reflect:Ae.Reflect,"destination-over":Ae.DestinationOver,"destination-atop":Ae.DestinationAtop,"destination-in":Ae.DestinationIn,"destination-out":Ae.DestinationOut,"source-atop":Ae.SourceAtop,"source-in":Ae.SourceIn,"source-out":Ae.SourceOut,xor:Ae.Xor};function jZe(t){return t===Ae.DestinationOver||t===Ae.DestinationAtop||t===Ae.DestinationIn||t===Ae.DestinationOut||t===Ae.SourceAtop||t===Ae.SourceIn||t===Ae.SourceOut||t===Ae.Xor}function BG(t){t.code.add(b`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.float(257)};
      if(pos < 0.5 || pos > ${b.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function HZe(t,e){const r=e.blendMode;r!==Ae.Normal&&(r===Ae.Reflect&&t.code.add(b`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Ae.ColorDodge&&r!==Ae.VividLight||t.code.add(b`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Ae.ColorBurn&&r!==Ae.VividLight||t.code.add(b`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Ae.Overlay&&t.code.add(b`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Ae.HardLight&&t.code.add(b`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Ae.SoftLight&&t.code.add(b`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Ae.VividLight&&t.code.add(b`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Ae.Hue&&r!==Ae.Saturation&&r!==Ae.Color&&r!==Ae.Luminosity||(t.code.add(b`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Ae.Hue&&r!==Ae.Saturation||t.code.add(b`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(b`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Ae.Multiply?b`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Average?b`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Lighten?b`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Darken?b`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Lighter?b`return vec4(cl * ol + cb * ob, ol + ob);`:r===Ae.Plus?b`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Ae.Minus?b`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Ae.Screen?b`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Difference?b`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Invert?b`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ae.DestinationOver?b`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Ae.DestinationAtop?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Ae.DestinationOut?b`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Ae.SourceAtop?b`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ae.SourceOut?b`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Ae.Xor?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Ae.DestinationIn?b`return vec4(cb * ob * ol, ol * ob);`:r===Ae.SourceIn?b`return vec4(cl * ol * ob, ol * ob);`:r===Ae.Hue?b`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Saturation?b`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Color?b`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Luminosity?b`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Exclusion?b`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Reflect?b`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.ColorDodge?b`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.ColorBurn?b`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Overlay?b`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.SoftLight?b`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.HardLight?b`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.VividLight?b`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:b``}
    }
  `))}var Xs,Bh,Oh;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(Xs||(Xs={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(Bh||(Bh={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Oh||(Oh={}));function u0e(t,e){const r=e.output===Xs.GridComposite,i=e.output===Xs.ColorComposite,s=e.output===Xs.GroupBackgroundComposite,n=e.output===Xs.Composite;r&&t.fragment.include(BG),i&&t.fragment.uniforms.add(new Mt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===Bh.Required;o&&t.fragment.uniforms.add(new Se("baseOpacity",c=>c.baseOpacity)),n&&t.fragment.uniforms.add(new We("fboColor",c=>c.fboTexture));const a=e.blendMode!==Ae.Normal,l=e.premultipliedSource===Oh.On;t.fragment.include(HZe,e),t.fragment.code.add(b`
    vec4 getBackground(vec2 uv) {
      return ${o?b`baseOpacity *`:""} ${s?b`vec4(0.0, 0.0, 0.0, 0.0)`:i?b`vec4(backgroundColor, 1.0)`:r?b`vec4(gridColor(uv), 1.0)`:b`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?b`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:b`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?b`colorLayer * opacity;`:b`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let $D=class extends VZe{constructor(e,r,i,s,n,o){super(e,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Va,this.fboTexture=null,this.baseOpacity=1}},WZe=class extends $D{},qZe=class extends $D{};function YZe(t){const e=new ur;return e.include(c0e),e.include(GZe,t),e.include(kZe,t),e.include(u0e,t),e.fragment.code.add(b`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===d1.Stretch?ZZe(e,t):t.colorizerType===d1.Lut?XZe(e):t.colorizerType===d1.Hillshade&&JZe(e,t),e}function XZe(t){t.fragment.code.add(b`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function ZZe(t,e){t.fragment.uniforms.add(new OA("u_bandCount",i=>i.symbolizer.u_bandCount),new za("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new za("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new za("u_factor",i=>i.symbolizer.u_factor,3),new Se("u_minOutput",i=>i.symbolizer.u_minOutput),new Se("u_maxOutput",i=>i.symbolizer.u_maxOutput),new vp("u_useGamma",i=>i.symbolizer.u_useGamma),new za("u_gamma",i=>i.symbolizer.u_gamma,3),new za("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Se("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(b`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?b`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:b`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(b`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===Y1.Noop?b`
        fragColor = applyBackgroundBlend(currentPixel);`:b`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function JZe(t,e){const r=t.fragment;r.uniforms.add(new We("u_image",s=>s.u_image),new OA("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new za("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new za("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new za("u_cosZs",s=>s.symbolizer.u_cosZs,6),new za("u_weights",s=>s.symbolizer.u_weights,6),new mr("u_factor",s=>s.symbolizer.u_factor),new Se("u_minValue",s=>s.symbolizer.u_minValue),new Se("u_maxValue",s=>s.symbolizer.u_maxValue),new mr("u_srcImageSize",s=>s.common.u_srcImageSize)),r.include(zp),r.code.add(b`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(b`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?b`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:b`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(b`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const QZe=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:qZe,ColorizerStretchUniforms:WZe,ColorizerUniforms:$D,build:YZe},Symbol.toStringTag,{value:"Module"}));function KZe(t,e,r="nearest",i=!1){var c;const s=!(i&&e.pixelType==="u8"),n=s?Cs.FLOAT:Cs.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new xr;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===Jt.WEBGL2&&s?ft.RGBA32F:Pt.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?wt.NEAREST:wt.LINEAR,l.dataType=n,l.wrapMode=Ot.CLAMP_TO_EDGE,new bt(t,l,o)}function eJe(t,e){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=e,a=r[0]>1,l=new xr;l.width=a?4*n:n,l.height=o,l.internalFormat=t.type===Jt.WEBGL2?ft.RGBA32F:Pt.RGBA,l.dataType=Cs.FLOAT,l.samplingMode=wt.NEAREST,l.wrapMode=Ot.CLAMP_TO_EDGE;const c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let u=0,d=0;u<s.length;u++)c[d++]=s[u],u%3==2&&(c[d++]=1);else for(let u=0;u<o;u++)for(let d=0;d<n;d++){const p=4*(u*n+d),g=2*(d*o+u);c[p]=i[g],c[p+1]=i[g+1],c[p+3]=i[g]===-1?0:1}return new bt(t,l,c)}function kQ(t,e){const r=new xr;return r.internalFormat=Pt.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=wt.NEAREST,r.wrapMode=Ot.CLAMP_TO_EDGE,new bt(t,r,e)}function tJe(t,e,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:Kh,u_transformGridSize:t?t.size:Kh,u_targetImageSize:e,u_srcImageSize:r}}function rJe(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function iJe(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function sJe(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const BQ={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let nJe=class{constructor(e,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=Ue(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...BQ,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||BQ}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>{var s;return!!((s=this._bandIds)!=null&&s[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?wt.LINEAR:wt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=Ue(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=eJe(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:s,opacity:n}=this,o=tJe(r,[i,s],[this.source.width,this.source.height],n),a=rJe(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?iJe(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?sJe(this.symbolizerParameters):null;return new $D(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Ue(this._rasterTexture),this._transformGridTexture=Ue(this._transformGridTexture),this._colormapTexture=Ue(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Ue(this._rasterTexture));const s=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=Ue(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=KZe(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=Ue(this._colormapTexture),this._colormapTexture=kQ(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=kQ(e,i),void(this._colormap=i)):(this._colormapTexture=Ue(this._colormapTexture),void(this._colormap=null))}},WP=class{constructor(){this.waitingAgents=new Nt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=V5.acquire();return r._init(e),r}release(){this.dispose(),qP.delete(this),V5.release(this)}dispose(){this.loadingAgent=Ue(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=Gw(this._data)}static prune(){V5.prune(0)}_init(e){this.waitingAgents.clear(),this._data=Gw(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=yc(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),FZe(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){Gw(this._data),this._data=e}};const V5=new po(WP,null,()=>{}),qP=new Map;function oJe(){qP.size>0&&(console.log(`${qP.size} live TilePerLayerInfo allocations:`),qP.forEach(t=>console.log(t,`
`)))}let Zb=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}};var dt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(dt||(dt={}));const aJe=.1;let VG=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Ut(),this._elevationBounds=Ie(),this.layerInfo=[[],[]],this.extentInRadians=Ut(),this.centerAtSeaLevel=C(),this._center=[C(),ss(),C()],this.up=Nk(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=C()}static prune(){GG.prune(0),jG.prune(0),WP.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[vs.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=(e==null?void 0:e.frustumVisibility)??$o.INTERSECTS;this._frustumVisibility=r===$o.INSIDE?$o.INSIDE:r===$o.OUTSIDE?$o.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==$o.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=Cr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[vs.MIDDLE][3]=0,this.elevationLevel=e?e[0]:0,r&&r.elevationBounds?Vs(this._elevationBounds,r.elevationBounds):Qt(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of A_){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=WP.acquire(this._surface.upsampleInfoPool),s===jt.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,lS)}release(){ep(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of A_){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[jt.MAP].reduce((e,r)=>e+(r instanceof B5?r.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:i}of this.layerInfo[jt.MAP])i instanceof B5?e+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[jt.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=N1(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===jt.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===jt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof Zb?N1(e.texture):e instanceof HTMLImageElement||e instanceof OD?this._cpuImageMemorySize:e instanceof B5||e instanceof nJe?e.memoryUsage:0}updateScreenDepth(e){const r=this._center[vs.MIDDLE],i=e,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===$o.OUTSIDE))return dt.NONE;const s=this.level;le(nR,this._center[vs.MIDDLE],r);let n=lo(nR),o=nR,a=vs.MIDDLE;le(G5,this._center[vs.TOP],r);const l=lo(G5);l<n&&(n=l,o=G5,a=vs.TOP),le(j5,this._center[vs.BOTTOM],r);const c=lo(j5);if(c<n&&(n=c,o=j5,a=vs.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return dt.SPLIT;const u=i!=null?i-s:1/0,d=Math.sqrt(n),p=e.fovX*d*2,g=this._edgeLen/p,y=()=>{if(s<e.maxLod)return this.elevationLevel=s,dt.NONE;const $=s+Math.ceil(-Math.log2(e.relativeWidthLimit/g));return $!==this.elevationLevel?(this.elevationLevel=$,dt.ELEVATION):dt.NONE};if(u<=.5)return y();const _=pe(this.up,nR),v=this._elevationBounds[1]-this._elevationBounds[0],w=v/this.edgeLen;if(e.aboveGround&&_>0&&w<.001&&_/d-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-w>0)return dt.NONE;const T=i!=null?3-Math.min(u,2):1;if(g*T<e.relativeWidthLimit||s>=e.maxLod)return y();if(s<7)return dt.SPLIT;ee(Pn,this.up,_),le(Pn,Pn,o);const x=lo(Pn);if(x<=this.radius*this.radius)return dt.SPLIT;ee(Pn,Pn,this.radius/Math.sqrt(x)),oe(Pn,Pn,this._center[a]),le(Pn,r,Pn);const E=Math.min(1,(Math.abs(pe(Pn,this.up))+.5*v+this._curvatureHeight)/Te(Pn)),O=aJe/e.angledSplitBias,A=e.fovY*d*2;return E*(this._edgeLen/A*T)<O*e.relativeHeightLimit?dt.NONE:dt.SPLIT}setChildren(e,r,i,s){ep(!!(e&&r&&i&&s),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of A_)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of A_){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==il&&(sR(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(dt.GEOMETRY),this.resetPendingUpdate(dt.TEXTURE_NOFADING),this.resetPendingUpdate(dt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[jt.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==il&&(sR(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(r1(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(dt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of A_){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==il&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(dt.SPLIT)||e!==jt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===dt.SPLIT||e===dt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const s=this.layerInfo[r][e];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),i.dataArrived(this),!0;if(s.requestPromise)return!0;yc(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return lo(le(Pn,this._center[vs.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const s=this.layerInfo[r][e],n=s.waitingAgents,o=n.removeUnordered(i)!=null;ep(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const s=this.layerInfo[r][e];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const s=this.layerInfo[r][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r){switch(e){case jt.MAP:return this._updateTexture(r);case jt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Ns.FADING?dt.TEXTURE_NOFADING:dt.TEXTURE_FADING),this.setPendingUpdate(e===Ns.FADING?dt.TEXTURE_FADING:dt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(dt.GEOMETRY);for(const e of this.layerInfo[jt.ELEVATION])e.pendingUpdates|=dt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];Qt(e,1/0,-1/0);const s=this.layerInfo[jt.ELEVATION];let n=!0;for(const o of s)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;ee(Pn,this.up,r),oe(i[vs.MIDDLE],this.centerAtSeaLevel,Pn),ee(Pn,this.up,e[0]),oe(i[vs.TOP],this.centerAtSeaLevel,Pn),ee(Pn,this.up,e[1]),oe(i[vs.BOTTOM],this.centerAtSeaLevel,Pn)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[jt.ELEVATION][e],s=r8(this.level),n=Math.max(this.elevationLevel-s,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,jt.ELEVATION),l=_z(a);if(!IE(this,l,!1))return;const c=cJe;let u=!1;const d=i.data;if(d&&d.level<=n){const p=i.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,g,y=0;for(let _=this._parent;_&&(!g||y<s)&&(y=this.elevationLevel-_.level,p=g||p,g=_.layerInfo[jt.ELEVATION][e].data,!(!g&&p&&_.level<=n));_=_.parent);g=g||p,g&&(g.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=g.level,u=!0))}u&&(i.elevationBounds==null&&(i.elevationBounds=new Tw),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==il&&(sR(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:WP.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Ns.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===il&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of A_){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==il&&(i.loadingAgent.setSuspension(r),i.loadingAgent===il&&this.updateRenderData(e,Ns.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==il&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=il,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||ix(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var s,n,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(oI(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||ix((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=e;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=_z(l);if(o.loadingAgent?IE(this,c,!1)?(o.loadingAgent!==il&&o.loadingAgent.setSuspension(s),o.loadingAgent!==il&&(a=o.loadingAgent.update())):o.dispose():IE(this,c,!1)&&(o.loadingAgent=lJe(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===il&&this.setPendingUpdate(dt.GEOMETRY):(sR(o.loadingAgent),o.loadingAgent=il)),o.loadingAgent===il&&this.updateRenderData(r,Ns.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,r8(this.level)-r),s=me(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const s of i)if(uJe(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(e,r){const i=this.lij,s=this.getNeighborLIJ(i,e);return s?hJe(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(e,r){const i=e===mt.NORTH_EAST?1:e===mt.NORTH_WEST?0:e===mt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,s=>r(s)||s.level===this.level))==null?void 0:i.findCorner(aI(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===mt.NORTH?[0,1]:e===mt.NORTH_EAST?[1]:e===mt.EAST?[1,3]:e===mt.SOUTH_EAST?[3]:e===mt.SOUTH?[2,3]:e===mt.SOUTH_WEST?[2]:e===mt.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}forallNeighbors(e){IC.forEach(r=>this.findNeighborCornerTileExact(r,e)),hp.forEach(r=>{var i;return(i=this.findNeighborTile(r,s=>s.level===this.level||e(s)))==null?void 0:i.forAllSubtreeOnSide(lI(r),e)})}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(ve(!ks||i>=0),i===0)return 0;const s=2**i,n=(1&e)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,u=n?s-1-c:c;return ks&&(ve(a<=l&&l<a+s),ve(0<=u&&u<s)),u}forEachLoadedNeighbor(e){const r=this.level,i=s=>s.level===r||s.isLoaded;hp.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(lI(s),o=>!!o.isLoaded&&(e(o,s),!0))}),IC.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,i))==null?void 0:o.findCorner(aI(s),a=>a.isLoaded);ve(!n||Cz(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,r){const i=RQ(r)?-1:OQ(r)?1:0,s=CQ(r)?-1:AQ(r)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=(e==null?void 0:e[1])??null;return r!=null&&this.extent[1]+ma()>=r}checkGeometryWaterproofness(){var e;sI&&(ve(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(RQ(e)&&r[3]+s>=i[3]||OQ(e)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&CQ(e)&&r[0]-s<=i[0])&&!(!n&&AQ(e)&&r[2]+s>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;te(this._lastPOI,e);const i=this._center[vs.MIDDLE],s=e[0]-i[0],n=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}};function lJe(t,e,r,i){const s=r===jt.ELEVATION?jG.acquire():GG.acquire();return s.init(t,e,r,i),s}function sR(t){t.dispose(),t instanceof o0e?jG.release(t):t instanceof a0e&&GG.release(t)}const GG=new po(a0e),jG=new po(o0e),cJe=new Tw;var vs;function uJe(t,e){const r=t.level,i=e[0];if(r>i)return!1;const s=i-r,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function hJe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function dJe(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===mt.EAST||t.isWestEnd&&e.isEastEnd&&r===mt.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case mt.NORTH:return uu(t.extent[3],e.extent[1],i);case mt.SOUTH:return uu(t.extent[1],e.extent[3],i);case mt.EAST:return uu(t.extent[2],e.extent[0],i)||uu(t.extent[2],-e.extent[0],i);case mt.WEST:return uu(t.extent[0],e.extent[2],i)||uu(t.extent[0],-e.extent[2],i)}}function Cz(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?VQ(t,e,r):VQ(e,t,aI(r)))}function VQ(t,e,r){ve(t.level>=e.level);const i=AXe(r),s=OXe(r),n=t.extent,o=e.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=uu(a[0],l[0],c)||t.surface.isGlobal&&uu(a[0],-l[0],c),d=uu(a[1],l[1],c);if(u&&d)return!0;if(t.level===e.level||!u&&!d)return ve(!1),!1;const p=u?GQ(o[1],o[3],n[1],n[3],c):GQ(o[0],o[2],n[0],n[2],c);return ve(p),p}function GQ(t,e,r,i,s){return t-s<=r&&r<=i&&i<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(vs||(vs={}));const nR=C(),G5=C(),j5=C(),Pn=C();let pJe=class{constructor(){this._scales=Ct(-1,-1,-1,-1),this._offsets=Ct(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function fJe(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(b`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let HG=class extends Ofe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=C(),this.origin=this.slicePlaneLocalOrigin}};var Sl;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Sl||(Sl={}));let mJe=class extends HG{constructor(){super(...arguments),this.identifier=Sl.Material,this.output=L.Color,this.transparent=!1,this.integratedMesh=!1}},gJe=class extends HG{constructor(){super(...arguments),this.identifier=Sl.ShadowMap}},yJe=class extends HG{constructor(){super(...arguments),this.identifier=Sl.Highlight}},cI=class extends Ji{constructor(e,r){super(e,"vec4",zr.Draw,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}};var Qf;function _Je(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new cI("overlayTexOffset",(s,n)=>vJe(s,n)),new cI("overlayTexScale",(s,n)=>bJe(s,n))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new We("ovColorTex",(s,n)=>Az(s,n))),h0e(t,e)}function h0e(t,e){e.pbrMode!==Xe.Water&&e.pbrMode!==Xe.WaterOnIntegratedMesh&&e.pbrMode!==Xe.TerrainWithWater||t.include($fe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(b`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(b`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(b`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(b`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==Xe.Water&&e.pbrMode!==Xe.WaterOnIntegratedMesh&&e.pbrMode!==Xe.TerrainWithWater||(vm(i),Up(i),i.code.add(b`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Az(t,e){return e.overlays.length===0?null:t.identifier===Sl.Material&&t.output===L.Color?e.overlays[Ci.INNER].getColorTextureNoRasterImage():t.identifier===Sl.Material&&t.output===L.ObjectAndLayerIdColor?e.overlays[Ci.INNER].getColorTexture(Da.ObjectAndLayerIdColor):t.identifier===Sl.Highlight?e.overlays[Ci.INNER].getValidTexture(Bi.Highlight):null}function vJe(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Pie(s)>0&&(jw[2*i]=t.toMapSpace[0]/lc(s)-s[0]/lc(s),jw[2*i+1]=t.toMapSpace[1]/Xh(s)-s[1]/Xh(s))}return jw}function bJe(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Pie(s)>0&&(jw[2*i]=t.toMapSpace[2]/lc(s),jw[2*i+1]=t.toMapSpace[3]/Xh(s))}return jw}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Qf||(Qf={}));const jw=Ht();var dp;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(dp||(dp={}));let wJe=class extends Ar{constructor(){super(...arguments),this.overlayOpacity=1}};function xT(t,e){t.vertex.uniforms.add(new uI("overlayTexOffset"),new uI("overlayTexScale")),t.fragment.uniforms.add(new Se("overlayOpacity",r=>r.overlayOpacity),new We("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[Ci.INNER].getColorTexture(r.overlaySource))),h0e(t,e)}function xJe(t,e){const{vertex:r,fragment:i,varyings:s}=t;s.add("vtc","vec2"),r.uniforms.add(new uI("texOffsetAndScale")),i.uniforms.add(new jQ("tex")),i.uniforms.add(new H5("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(r.uniforms.add(new uI("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new jQ("texNext")),i.uniforms.add(new H5("nextTexOpacities")),i.uniforms.add(new TJe("fadeFactor")));const o=e.tileBlendInput===dp.ColorComposite,a=e.tileBlendInput===dp.GridComposite;a&&i.include(BG),o&&i.uniforms.add(new H5("backgroundColor")),r.code.add(b`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?b`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b``}
  }`),i.code.add(b`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?b`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?b`backgroundColor`:b`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:b`return color;`}
    }`),n?i.code.add(b`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(b`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let TJe=class extends Ji{constructor(e){super(e,"float")}},H5=class extends Ji{constructor(e){super(e,"vec3")}},uI=class extends Ji{constructor(e){super(e,"vec4")}},jQ=class extends Ji{constructor(e){super(e,"sampler2D")}},d0e=class extends wJe{};function SJe(t){const e=new ur,{vertex:r,fragment:i,varyings:s}=e;e.include(hA),e.include(AA,t),e.include(_p,t);const n=()=>{e.include(AC,t),r.code.add(b`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Pl(r,t),e.include(Ba,t);const o=t.overlayMode!==Qf.Disabled;switch(t.output){case L.Color:{e.include(xJe,t),e.include(q1,t),o&&e.include(xT,{...t,pbrMode:t.pbrMode===Xe.Terrain?Xe.TerrainWithWater:Xe.Water});const a=t.overlayMode===Qf.EnabledWithWater;a&&e.include(fJe,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&Px(r);const l=t.receiveShadows&&!t.renderOccluded;l&&e.include(h2,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(b`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${a?b`forwardVertexTangent(vnormal);`:b``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?b`setOverlayVTC(uv);`:""}
          ${t.tileBorders?b`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?b`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?b`forwardLinearDepth();`:""}

        }
      `),e.include(rs,t),e.include(q1,t),e.include(RA,t),e.include(H1,t),td(i,t),PA(i),b2(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Mt("viewDirection",(c,u)=>fe(HQ,se(HQ,u.camera.viewMatrix[12],u.camera.viewMatrix[13],u.camera.viewMatrix[14])))),a&&i.uniforms.add(new We("ovWaterTex",(c,u)=>u.overlays.length===0?null:u.overlays[Ci.INNER].getNormalTexture(c.overlaySource)),new Vhe("view",(c,u)=>Wa(EJe,u.camera.viewMatrix,c.origin))),i.code.add(b`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),vm(i),Up(i),i.code.add(b`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?b`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?b`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===Xe.Terrain||t.pbrMode===Xe.TerrainWithWater?b`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:b`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${a?b`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?b`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?b`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:b`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?b`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case L.Depth:o&&e.include(xT,t),e.include(dm,t),z0(e),U1(e),r.code.add(b`
              void main(void) {
                ${o?b`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(b`
              void main() {
                ${o&&t.invisible?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:e.include(dm,t),z0(e),U1(e),r.code.add(b`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(b`void main() {
outputDepth(linearDepth);
}`);break;case L.Normal:o&&e.include(xT,t),s.add("vnormal","vec3"),Px(r),n(),r.code.add(b`
            void main(void) {
              ${o?b`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(b`
            void main() {
              ${o&&t.invisible?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case L.Highlight:o&&e.include(xT,t),r.code.add(b`
          void main() {
            ${o?b`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Am,t),i.code.add(b`
          void main() {
            ${o?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===L.ObjectAndLayerIdColor&&(e.include(xT,{...t,pbrMode:Xe.Disabled}),r.code.add(b`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(b`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const EJe=xe(),HQ=C(),CJe=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:d0e,build:SJe},Symbol.toStringTag,{value:"Module"}));let p0e=class f0e extends gr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===Re.Global}initializeProgram(e){return new pr(e.rctx,f0e.shader.get().build(this.configuration),m0e)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return xt({blending:r.renderOccluded?Il(_e.ONE,_e.ONE_MINUS_SRC_ALPHA):null,culling:i?v7:null,depthTest:r.renderOccluded?null:{func:Br.LESS},depthWrite:r.renderOccluded?null:Ya,colorWrite:$t,stencilTest:e?uBe(ja.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};p0e.shader=new dr(CJe,()=>he(()=>import("./Terrain.glsl-ac184326.js"),[]));const m0e=new Map([[S.POSITION,0],[S.UV0,1],[S.NORMALCOMPRESSED,2]]);let AJe=class{constructor(){this.geometry=new SZe,this.intersectionData=null,this.geometryState=null,this._textureRef=new r0e(()=>this.tile.surface.textureFadeDuration),this.overlay=new pJe,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometry;r.indices=null,r.vertexAttributes=null,li(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new PZe,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),ks&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)ve(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(c!=null&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return s}const n=i.level,o=hp[e];if(!r)return ve(((l=i.surface)==null?void 0:l.rootTiles)==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const c=r,u=c.renderData.geometryState,d=n-c.level;if(ve(d>=0),d===0){const y=u.numVerticesPerSide-1;return Math.max(y,s)}const p=2**d,g=u.neighborData.edgeResolutions[(e+2)%4]/p;return Math.max(1,g)}ve(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(lI(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(ve(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(hp[l],i),u=G_(e,c),d=((a=u==null?void 0:u.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,p=s[l],g=u!==G_(e,p),y=n[l]!==d;s[l]=c,(g||y)&&(n[l]=d,this._markEdgeDirty(l));const _=r.edgeResolutions[l],v=this._calculateEdgeResolution(l,c);ve(T1(v)),ve(v>=1),r.edgeResolutions[l]=v,_!==v&&this._markEdgeResolutionDirty(l)}const o=r.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(IC[l],i);o[l]=c;const u=G_(e,s[l]),d=G_(e,s[(l+1)%4]),p=G_(e,c);th[l]=p,th[(l+1)%4]=d,th[(l+2)%4]=e,th[(l+3)%4]=u,ve(th.some(v=>(v==null?void 0:v.isLoaded)||v===e));const g=th.reduce((v,w)=>Math.min(v,(w==null?void 0:w.level)??1/0),1/0);th.forEach((v,w)=>{v&&(v==null?void 0:v.level)>g&&(th[w]=null)}),ve(th.some(v=>(v==null?void 0:v.isLoaded)||v===e));const y=r.cornerNeighborData[l].cornerTiles,_=r.cornerNeighborData[l].cornerTileSamplerVersions;for(let v=0;v<4;++v){const w=th[v],T=(w==null?void 0:w.renderData.geometryState.samplerDataVersion)??-1,x=y[v]!==w,E=!x&&_[v]!==T;(x||E)&&(y[v]=w,_[v]=T,this._markCornerDirty(l))}ve(y.some(v=>(v==null?void 0:v.isLoaded)||v===e))}ks&&ve(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)th[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;ks&&ve(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometry.vertexAttributes,n=!i||!s||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,AZe(this.geometry),!0)}ensureTexture(e,r){return this._texture!=null&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),Kf(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,s=e.gl;this._vao=new sd(e,m0e,{geometry:Dl(r.layout)},{geometry:br.createVertex(e,s.STATIC_DRAW,r.buffer)},br.createIndex(e,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=Zf.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[jt.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let u=0;u<i;u++){const d=r[u];if(d.upsampleInfo!=null){const p=d.upsampleInfo.tile,g=p.layerInfo[jt.ELEVATION][u].data,y=g&&g.samplerData;e&&e[n]===y||(a=!0),s[n++]=y,o=Math.max(o,p.lij[0])}else if(d.data){const p=this.tile.surface.layerViewByIndex(u,jt.ELEVATION);if(IE(this.tile,p.layer,!1)){const g=d.data;e&&e[n]===g.samplerData||(a=!0),s[n++]=g.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,s;const e=((r=this.intersectionData)==null?void 0:r.estimatedMemoryUsage)??0;return(((i=this.geometry.indices)==null?void 0:i.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get textureDescriptor(){return this._texture!=null?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!ks)return;const e=this.tile;if(ve(e==null?void 0:e.isLoaded),!e.isLoaded||!e.intersectsClippingArea)return;const r=e.renderData;if(e.level===0)return;const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const s=hp.map((l,c)=>i!=null&&(c<2?-1:1)*(e.extent[3-c]-i[3-c])<0),n=e.level;ve(this._dirtyCorners===0),ve(this._dirtyEdges===0),ve(this._dirtyEdgeResolutions===0),ve(!this._numVerticesPerSideChanged),ve(!this._samplerDataChanged),ve(!this._clippingAreaChanged),ve(!this._wireframeChanged);const o=IC.map(l=>e.findNeighborCornerTileExact(l,c=>!c.intersectsClippingArea||c.isLoaded||c.level===e.level)??null).map(l=>l!=null&&l.intersectsClippingArea?l:null),a=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=a.cornerPeerNeighbors[l],u=o[l];ve(u===c,`Tile[${e.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${u==null?void 0:u.lij}]`)}hp.forEach((l,c)=>{if(s[c])return;const u=e.findNeighborTile(l,I=>(I.level===n||(I==null?void 0:I.isLoaded))&&(I==null?void 0:I.intersectsClippingArea));if(!u){const I=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(l);return void ve(!I)}ve(u.isLoaded||u.level===e.level),ve(u===this.geometryState.neighborData.edgePeerNeighbors[c]);const d=n-u.level;if(!u.isLoaded)return ve(!u.isLeaf),void ve(d===0);const p=u.renderData;ve(dJe(e,u,l)),ve(d>=0);const g=2**d;if(d<0)return void ve(!1);const y=r.geometry,_=y.outerEdges[c],v=y.numVerticesPerSide-1,w=p.geometry;if(!w)return void ve(!1);{const I=this.geometryState.neighborData.edgePeerNeighbors[c];if(I!=null&&I.isLoaded){const N=I.renderData;ve(I==I),ve(r.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===N.geometryState.samplerDataVersion),ve(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===N.geometryState.samplerDataVersion)}}const T=(c+2)%4,x=w.outerEdges[T],E=_.count-1,O=x.count-1;ve(E*g===O,`Tile[${e.lij}]:e${c},res=${E} edgeRes mismatch with Neighbor[${u.lij}]:e${T},res=${O} (expected:${E*g})`);const A=e.extent,$=l===mt.NORTH||l===mt.SOUTH,M=x.count-1,U=M/2**d,k=_.count-1;if(U<1)return void ve(k===1);ve(U===k),ve(T1(U));const B=w.numVerticesPerSide-1;ve(d>0||U===Math.max(B,v));const z=e.getNeighborEdgeStartVertexIndex(c,u);ve(0<=z&&z<g);const Y=z*U;ve(0<=Y&&Y<=M-U);let W=0,j=Y;_.getVertexPos(Ed,0),_.getVertexPos(Cd,_.count-1);const Z=ei(Ed,Cd),R=Math.max(OJe,1e-4*Z);for(let I=0;I<=U;++I){_.getVertexPos(Ed,W),x.getVertexPos(Cd,j);const N=I/U,V=$?A[0]+N*(A[2]-A[0]):l===mt.WEST?A[0]:A[2],q=$?l===mt.SOUTH?A[1]:A[3]:A[1]+N*(A[3]-A[1]),J=e.surface.extent;if(J==null||qI(J,V,q)){const K=ZC(Ed,Cd),ge=pl(Ed)-Yt.radius,Me=pl(Cd)-Yt.radius,pt=K<R;if(!pt){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${c}[${W}/${_.count}] and [${u.lij}].edge${T}[${j}/${x.count}]`),J!=null&&console.warn("  surface extent= ",J," x,y=",V,",",q);const tt=C();le(tt,r.localOrigin,p.localOrigin),pl(tt)>0&&console.warn(`   localOrigins: ${r.localOrigin} vs ${p.localOrigin} d=${pl(tt)} [${tt}]`),(()=>{const Ne=ms(Ed),de=ms(Cd);e.updateEdgeElevations(),u.updateEdgeElevations(),_.getVertexPos(Ed,W),x.getVertexPos(Cd,j);const rt=C();_n(rt,Ed,Ne),pl(rt)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ne} vs ${Ed} d=${pl(rt)} [${rt}]`),_n(rt,Cd,de),pl(rt)>0&&console.warn(`  XXX Neighbor[${u.lij}] edge out of date: ${de} vs ${Cd} d=${pl(rt)} [${rt}]`)})(),ve(pt,`Mismatch in tile [${e.lij}].edge[${c}][${W}/${_.count}] vs neighbor [${u.lij}].edge[${T}][${j}/${x.count}] ${rf(Ed)} vs ${rf(Cd)}  dist=${K} h(t|n|d)=${ge}|${Me}|${Me-ge}`)}_.getNormal(nb,W),x.getNormal(ob,j),fe(WQ,nb),fe(qQ,ob);const Tt=pe(WQ,qQ),et=1-Tt<.01||!1||e===u;if(!et){const tt=C();_n(tt,nb,ob);const Ne=()=>`Mismatch in tile edge normal ${EQ(e.lij)} (${W}/${_.count-1}) edge ${c} vs neighbor ${EQ(u.lij)}  (${j}/${x.count-1}) nedge ${T} :${rf(nb)} vs ${rf(ob)}  dot = ${Tt} : ${rf(tt)}`;console.warn("Mismatch in tile edge normal: ",Ne());{e.updateEdgeElevations(),u.updateEdgeElevations();const de=C(),rt=C();_.getNormal(de,W),x.getNormal(rt,j),M0(nb,de)||console.warn("Missing update in tile normal: ",rf(nb)," => ",rf(de)),M0(ob,rt)||console.warn("Missing update in neighbor normal: ",rf(ob)," => ",rf(rt))}ve(et,Ne())}}W+=1,j+=1}})}};const Ed=C(),Cd=C(),nb=C(),ob=C(),WQ=C(),qQ=C(),OJe=1,th=[null,null,null,null];function G_(t,e){return e!=null&&e.isLoaded||e===t?e:null}const RJe=65536;function PJe(t,e){const r=t.tile,{extent:i,extentInRadians:s,surface:n}=r,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=a.numVerticesPerSide,u=c-1,d=(c-2)**2,p=l&&(e===cu.HAS_SOUTH_POLE||e===cu.HAS_BOTH_POLES),g=l&&(e===cu.HAS_NORTH_POLE||e===cu.HAS_BOTH_POLES),y=6,_=((p?1:0)+(g?1:0))*y*(u+1),v=a.neighborData,w=v.edgeResolutions.reduce(($,M)=>$+M+1,0),T=t0e(d+_+w),x=t.geometry;x.numVerticesPerSide=a.numVerticesPerSide,x.vertexAttributes=T;const E=x.boundingBox;li(E);const O=WG(t);kn.update(u,s,O),MJe(t),E0e(t,d),g0e(t);const A=[];if((()=>{let $=d+w;const M=o[0],U=o[1],k=o[2],B=r.ellipsoid.radius,z=i[1],Y=i[3],W=(j,Z)=>{const R=Z*c;Eu(-M,-U,j*B-k,E),A.push({connectedRowOffset:R,connectedOuterEdgeOffset:j===1?0:2,rowOffset:$,latitudeResolution:y});const I=v0e(j===-1?z:Y,B),N=j*Math.PI/2-I,V=.99*(j===1?1:-1),q=B+0,J=T.position,K=T.uv0,{typedBuffer:ge,typedBufferStride:Me}=T.normalCompressed;for(let pt=1;pt<=y;++pt){const Tt=I+N*(pt/y),et=Math.cos(Tt),tt=Math.sin(Tt);for(let Ne=0;Ne<=u;Ne++){const de=Ne/u,rt=kn.sinLonLUT[Ne],kt=kn.cosLonLUT[Ne]*et,Ee=rt*et,Fe=tt,ze=kt*q-M,lt=Ee*q-U,it=Fe*q-k;Eu(ze,lt,it,E),J.setValues($,ze,lt,it),Wh(K,$,de,V),W1(ge,$,kt,Ee,Fe,Me),++$}}};p&&W(-1,0),g&&W(1,u)})(),S0e(x,a.numVerticesPerSide,A,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,ks)for(let $=0;$<4;++$)ve(x.outerEdges[$].count===v.edgeResolutions[$]+1)}function MJe(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=t.geometryState,i=r.numVerticesPerSide,s=i-2,n=i-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:u,typedBufferStride:d}=a.normalCompressed,p=e.extent,g=p[0],y=p[2],_=p[1],v=p[3],w=e.ellipsoid.radius,T=r.samplerData,x=t.localOrigin,E=x[0],O=x[1],A=x[2],$=l.typedBuffer,M=l.typedBufferStride,U=1/n,k=o.boundingBox;let B=0;if(1<=s){const z=U,Y=_*(1-z)+v*z,W=kn.sinLatLUT[1],j=kn.cosLatLUT[1];for(let Z=1;Z<=s;Z++){const R=Z*U,I=g*(1-R)+y*R,N=kn.sinLonLUT[Z],V=kn.cosLonLUT[Z],q=w+Ii(I,Y,T),J=q*V*j-E,K=q*N*j-O,ge=q*W-A;Eu(J,K,ge,k);const Me=(Z-1)*M;$[Me]=J,$[Me+1]=K,$[Me+2]=ge,Wh(c,Z-1,R,z)}}for(let z=1;z<=s;z++){const Y=z*U,W=_*(1-Y)+v*Y,j=kn.sinLatLUT[z],Z=kn.cosLatLUT[z],R=z+1,I=R*U,N=_*(1-I)+v*I,V=kn.sinLatLUT[R],q=kn.cosLatLUT[R],J=kn.sinLonLUT[0],K=kn.cosLonLUT[0],ge=w+Ii(g,W,T);let Me=K*Z*ge-E,pt=J*Z*ge-O,Tt=j*ge-A;const et=B*M;let tt=$[et],Ne=$[et+1],de=$[et+2];for(let rt=1;rt<=s;rt++){const kt=rt*U,Ee=g*(1-kt)+y*kt,Fe=kn.sinLonLUT[rt],ze=kn.cosLonLUT[rt];let lt=0,it=0,sr=0;if(rt<s){const or=(B+1)*M;lt=$[or],it=$[or+1],sr=$[or+2]}else{const or=kn.sinLonLUT[n],Zr=kn.cosLonLUT[n],xi=w+Ii(y,W,T);lt=Zr*Z*xi-E,it=or*Z*xi-O,sr=j*xi-A}const ke=Me,ct=pt,nr=Tt;Me=tt,pt=Ne,Tt=de,tt=lt,Ne=it,de=sr;const Je=lt-ke,st=it-ct,ut=sr-nr;let Et=0,It=0,ci=0;if(z>1){const or=(B-s)*M;Et=$[or],It=$[or+1],ci=$[or+2]}else{const or=kn.sinLatLUT[0],Zr=kn.cosLatLUT[0],xi=w+Ii(Ee,_,T);Et=ze*Zr*xi-E,It=Fe*Zr*xi-O,ci=or*xi-A}const Ir=w+Ii(Ee,N,T),ri=ze*q*Ir-E,Rt=Fe*q*Ir-O,Yr=V*Ir-A;if(z<s){const or=B+s,Zr=or*M;$[Zr]=ri,$[Zr+1]=Rt,$[Zr+2]=Yr,Eu(ri,Rt,Yr,k),Wh(c,or,kt,I)}const Sr=Et-ri,Vr=It-Rt,yr=ci-Yr;let ui=ze*Z,Or=Fe*Z,Xr=j;Xr*Xr<.999&&(ui=ut*Vr-st*yr,Or=Je*yr-ut*Sr,Xr=st*Sr-Je*Vr);const Gr=1/Math.sqrt(ui*ui+Or*Or+Xr*Xr);W1(u,B,ui*Gr,Or*Gr,Xr*Gr,d),++B}}}function $Je(t){t.tile.intersectsClippingArea&&(g0e(t),ID(t))}function IJe(t){t.tile.intersectsClippingArea&&(_0e(t),y0e(t,!0),ID(t))}function g0e(t){t.tile.intersectsClippingArea&&(_0e(t),y0e(t))}function y0e(t,e=!1){const r=t.geometryState,i=t.geometry,s=r.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,u=c[0],d=c[2],p=c[1],g=c[3],y=r.samplerData,_=a[0],v=a[2],w=a[1],T=a[3],x=WG(t),E=i.boundingBox,O=t.localOrigin,A=O[0],$=O[1],M=O[2],U=i.vertexAttributes,k=U.position,B=k.typedBuffer,z=k.typedBufferStride,Y=U.uv0;for(let W=0;W<4;++W){const j=W===1||W===3,Z=s.edgeResolutions[W];ve(T1(Z));const R=Z+1,I=G_(n,s.edgePeerNeighbors[W]);if(O0e(n,I,W)){C0e(t,W,I);continue}const N=I!=null;ve(!N||I.level===n.level),ve(!N||Jf(n,I)<=0);const V=I==null?void 0:I.renderData,q=V==null?void 0:V.geometryState;if(ks){const Je=n.surface;if(!I&&Je&&!Je.updatingRootTiles){const st=hp[W],ut=n.findNeighborTile(st,Et=>Et.isLoaded||Et.isLeaf||Et.level===n.level);ut?ut.intersectsClippingArea&&(ve(!ut.isLoaded),ve(!ut.isLeaf),ve(ut.level===o)):ve((Je==null?void 0:Je.rootTiles)==null||!n.shouldHaveNeighbor(st))}}const J=W===1?a[2]:a[0],K=I==null?void 0:I.extent,ge=K&&j?W===1?K[0]:K[2]:J,Me=W===0?a[3]:a[1],pt=W===1?1:0,Tt=W===0?1:0,et=W===1?d:u,tt=W===0?g:p,Ne=Math.sin(et),de=Math.cos(et),rt=Math.sin(tt),kt=Math.cos(tt),Ee=q==null?void 0:q.samplerData,Fe=N?(Je,st,ut)=>.5*(Ii(Je,st,y)+Ii(ut,st,Ee)):(Je,st,ut)=>Ii(Je,st,y),ze=i.outerEdges[W],lt=e&&R>3?R-3:1,it=y!=null&&y.some(Je=>Je!=null),sr=Ee!=null&&Ee.some(Je=>Je!=null),ke=it||sr,ct=1/Z,nr=ze.index0;ve(!K||uu(K[2]-K[0],a[2]-a[0])),(()=>{const Je=W===1?-1:W===3?1:0,st=W===0?-1:W===2?1:0,ut=(a[2]-a[0])*ct,Et=Je*ut,It=st*ut,ci=j?Je*((d-u)*ct):0,Ir=j?0:st*ct,ri=Tt,Rt=j?et+ci:et,Yr=j?Math.sin(Rt):Ne,Sr=j?Math.cos(Rt):de,Vr=j?et-ci:et,yr=j?Math.sin(Vr):Ne,ui=j?Math.cos(Vr):de,Or=j?tt:x(ri+Ir),Xr=j?rt:Math.sin(Or),Gr=j?kt:Math.cos(Or),or=j?tt:x(ri-Ir),Zr=j?rt:Math.sin(or),xi=j?kt:Math.cos(or);let En=0,Cn=0,An=0;{const Lr=0*ct,sn=j?J:_*(1-Lr)+v*Lr,Jn=j?ge:sn,Vo=j?w*(1-Lr)+T*Lr:Me,re=j?et:u*(1-Lr)+d*Lr,hi=j?Ne:Math.sin(re),Vu=j?de:Math.cos(re),nn=j?x(Lr):tt,Gu=j?Math.sin(nn):rt,qe=j?Math.cos(nn):kt,Za=l+Fe(sn,Vo,Jn);En=Vu*qe*Za,Cn=hi*qe*Za,An=Gu*Za}let On=0,Pi=0,Ti=0;{const Lr=1*ct,sn=j?J:_*(1-Lr)+v*Lr,Jn=j?ge:sn,Vo=j?w*(1-Lr)+T*Lr:Me,re=j?et:u*(1-Lr)+d*Lr,hi=j?Ne:Math.sin(re),Vu=j?de:Math.cos(re),nn=j?x(Lr):tt,Gu=j?Math.sin(nn):rt,qe=j?Math.cos(nn):kt,Za=l+Fe(sn,Vo,Jn);On=Vu*qe*Za,Pi=hi*qe*Za,Ti=Gu*Za}for(let Lr=1;Lr<R-1;Lr+=lt){let sn=0,Jn=0,Vo=0;{const Go=(Lr+1)*ct,Ja=j?J:_*(1-Go)+v*Go,ld=j?ge:Ja,an=j?w*(1-Go)+T*Go:Me,Fi=j?et:u*(1-Go)+d*Go,$m=j?Ne:Math.sin(Fi),ly=j?de:Math.cos(Fi),cy=j?x(Go):tt,gv=j?Math.sin(cy):rt,uy=j?Math.cos(cy):kt,Im=l+Fe(Ja,an,ld);sn=ly*uy*Im,Jn=$m*uy*Im,Vo=gv*Im}const re=sn,hi=Jn,Vu=Vo,nn=On,Gu=Pi,qe=Ti;On=re,Pi=hi,Ti=Vu;{const Go=nr+Lr,Ja=Go*z,ld=nn-A,an=Gu-$,Fi=qe-M;B[Ja]=ld,B[Ja+1]=an,B[Ja+2]=Fi,Eu(ld,an,Fi,E);const $m=Lr*ct;Wh(Y,Go,j?pt:$m,j?$m:Tt)}const Za=En,on=Cn,ny=An;En=nn,Cn=Gu,An=qe;const oy=nn,ga=Gu,Gp=qe,ay=1/Math.sqrt(oy*oy+ga*ga+Gp*Gp),Bt=Gp*ay;let Pm=0,jp=0,Mm=0;if(ke&&Bt*Bt<.999){let Go=0,Ja=0,ld=0;{const an=W===0?-1:1;Go=an*(re-Za),Ja=an*(hi-on),ld=an*(Vu-ny)}{const an=Lr*ct,Fi=j?J:_*(1-an)+v*an,$m=j?ge:Fi,ly=j?w*(1-an)+T*an:Me,cy=j?et:u*(1-an)+d*an,gv=j?Ne:Math.sin(cy),uy=j?de:Math.cos(cy),Im=j?x(an):tt,kA=j?Math.sin(Im):rt,ya=j?Math.cos(Im):kt;let T2=oy,S2=ga,G=Gp;if(N){const ue=l+Ii($m-Et,ly-It,Ee),be=j?ya:xi;T2=(j?ui:uy)*be*ue,S2=(j?yr:gv)*be*ue,G=(j?kA:Zr)*ue}{const ue=l+Ii(Fi+Et,ly+It,y),be=j?ya:Gr,tr=(j?Sr:uy)*be*ue,ws=(j?Yr:gv)*be*ue,ii=(j?kA:Xr)*ue;N||(T2=2*oy-tr,S2=2*ga-ws,G=2*Gp-ii);const jo=W===3?-1:1,hy=jo*(T2-tr),pj=jo*(S2-ws),fj=jo*(G-ii);Pm=ld*pj-Ja*fj,jp=Go*fj-ld*hy,Mm=Ja*hy-Go*pj;const kD=1/Math.sqrt(Pm*Pm+jp*jp+Mm*Mm);Pm*=kD,jp*=kD,Mm*=kD}}}else Pm=oy*ay,jp=ga*ay,Mm=Gp*ay;ze.setNormalFromValues(Lr,Pm,jp,Mm)}})()}}function _0e(t){A0e(t)}function v0e(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function LJe(t,e,r,i){return v0e(t*(1-i)+e*i,r)}function DJe(t,e,r){return t*(1-r)+e*r}function WG(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,s=e.ellipsoid.radius;return n=>LJe(i[1],i[3],s,n)}const r=e.extentInRadians;return i=>DJe(r[1],r[3],i)}function NJe(t,e){const r=t.tile.extent,i=t.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=l!=null?Math.max(0,(l[0]-s)/o):0,u=l!=null?Math.max(0,(l[1]-n)/a):0,d=l!=null?Math.min(1,(l[2]-s)/o):1,p=l!=null?Math.min(1,(l[3]-n)/a):1,g=i.numVerticesPerSide,y=(g-2)**2,_=i.neighborData.edgeResolutions.reduce((x,E)=>x+E+1,0),v=t0e(y+_),w=t.geometry,T=w.boundingBox;li(T),w.numVerticesPerSide=i.numVerticesPerSide,w.vertexAttributes=v,oi(w.uvRange,c,u,d,p),FJe(t),E0e(t,y),b0e(t),S0e(w,i.numVerticesPerSide,[],[0,g-1],[0,g-1],i.wireframe),t.intersectionData=null}function FJe(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=e.surface,i=t.geometryState,s=i.samplerData,n=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??qG,c=e.extent,u=c[0],d=c[1],p=c[2],g=c[3],y=Math.max(u,l[0]),_=Math.min(p,l[2]),v=Math.max(d,l[1]),w=Math.min(g,l[3]),T=e.ellipsoid.radius,x=e.horizontalScale,E=i.numVerticesPerSide,O=E-1,A=E-2,$=t.geometry,M=$.vertexAttributes,U=M.position,k=M.uv0,{typedBuffer:B,typedBufferStride:z}=M.normalCompressed,Y=$.uvRange,W=Y[0],j=Y[1],Z=Y[2],R=Y[3],I=$.boundingBox,N=n[0],V=n[1],q=n[2],J=U.typedBuffer,K=U.typedBufferStride;let ge=0;const Me=me(d,v,w),pt=o?(Math.PI/2-2*Math.atan(Math.exp(-Me/T)))*T:Me*x,Tt=1/O,et=me(d*(1-Tt)+g*Tt,v,w);let tt=pt,Ne=o?(Math.PI/2-2*Math.atan(Math.exp(-et/T)))*T:et*x;for(let de=1;de<=A;de++){const rt=de/O,kt=me(d*(1-rt)+g*rt,v,w),Ee=me(rt,j,R),Fe=Ne,ze=(de-1)/O,lt=me(d*(1-ze)+g*ze,v,w),it=tt,sr=(de+1)/O,ke=me(d*(1-sr)+g*sr,v,w),ct=o?(Math.PI/2-2*Math.atan(Math.exp(-ke/T)))*T:ke*x,nr=me(sr,j,R);tt=Ne,Ne=ct;const Je=me(u,y,_);let st=Je*x,ut=Ii(Je,kt,s);const Et=1/O,It=me(Et,W,Z),ci=me(u*(1-It)+p*It,y,_);let Ir=It,ri=ci,Rt=ci*x,Yr=Ii(ci,kt,s);if(de===1){const Sr=Rt-N,Vr=tt-V,yr=Yr-q,ui=0*K;J[ui]=Sr,J[ui+1]=Vr,J[ui+2]=yr,Eu(Sr,Vr,yr,I);const Or=me(Et,W,Z);Wh(k,ge,Or,Ee)}for(let Sr=1;Sr<=A;Sr++){const Vr=Rt,yr=Yr,ui=(Sr+1)/O,Or=me(ui,W,Z),Xr=me(u*(1-ui)+p*ui,y,_),Gr=ri;ri=Xr;{const Pi=ge+1,Ti=Pi*K;if(de===1||Sr===A){const Lr=Xr*x,sn=Ii(Xr,kt,s);if(de===1&&Sr<A){const Jn=Lr-N,Vo=Fe-V,re=sn-q;J[Ti]=Jn,J[Ti+1]=Vo,J[Ti+2]=re,Eu(Jn,Vo,re,I),Wh(k,Pi,Or,Ee)}Rt=Lr,Yr=sn}else Rt=J[Ti]+N,Yr=J[Ti+2]+q}const or=Rt,Zr=Yr,xi=st,En=ut;st=Vr,ut=yr;const Cn=(ge-A)*K,An=de===1?Ii(Gr,lt,s):J[Cn+2]+q,On=Ii(Gr,ke,s);if(de<A){const Pi=ge+A,Ti=Pi*K,Lr=Vr-N,sn=ct-V,Jn=On-q;J[Ti]=Lr,J[Ti+1]=sn,J[Ti+2]=Jn,Eu(Lr,sn,Jn,I);const Vo=Ir;Ir=Or,Wh(k,Pi,Vo,nr)}{const Pi=or-xi,Ti=it-ct,Lr=Ti*(Zr-En),sn=Pi*(An-On),Jn=-Ti*Pi,Vo=Lr*Lr+sn*sn+Jn*Jn;if(Vo===0)W1(B,ge,0,0,1,z);else{const re=1/Math.sqrt(Vo);W1(B,ge,Lr*re,sn*re,Jn*re,z)}}++ge}}}function UJe(t,e){t.tile.intersectsClippingArea&&(x0e(t),w0e(t,!0),ID(t))}function zJe(t,e){t.tile.intersectsClippingArea&&(b0e(t),ID(t))}function b0e(t,e){t.tile.intersectsClippingArea&&(x0e(t),w0e(t,!1))}function w0e(t,e){const r=t.geometryState,i=r.neighborData,s=t.tile,n=s.surface,o=s.extent,a=r.clippingArea,l=a??qG,c=o[0],u=o[2],d=o[1],p=o[3],g=[p>l[3],u>l[2],d<l[1],c<l[0]],y=t.geometry,_=s.horizontalScale,v=T0e(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,_),w=y.boundingBox,T=y.uvRange[0],x=y.uvRange[1],E=y.uvRange[2],O=y.uvRange[3],A=Math.max(c,l[0]),$=Math.min(u,l[2]),M=Math.max(d,l[1]),U=Math.min(p,l[3]),k=t.localOrigin,B=k[0],z=k[1],Y=k[2],W=r.samplerData;for(let j=0;j<4;++j){const Z=j===1||j===3,R=i.edgeResolutions[j];ve(T1(R));const I=R+1,N=g[j],V=G_(s,i.edgePeerNeighbors[j]);if(!N&&O0e(s,V,j)){C0e(t,j,V);continue}const q=V!=null&&!N,J=V==null?void 0:V.renderData,K=J==null?void 0:J.geometryState;if(ks&&(ve(!q||V.level===s.level),ve(!q||Jf(s,V)<=0),s&&!V&&!n.updatingRootTiles)){const Je=hp[j],st=s.findNeighborTile(Je,ut=>ut.isLoaded||ut.isLeaf||ut.level===s.level);n.updatingRootTiles||(st?st.intersectsClippingArea&&(ve(!st.isLoaded),ve(!st.isLeaf),ve(st.level===s.level)):ve((n==null?void 0:n.rootTiles)==null||!s.shouldHaveNeighbor(Je)))}const ge=me(j===1?u:c,A,$),Me=me(j===0?p:d,M,U),pt=K==null?void 0:K.samplerData,Tt=y.outerEdges[j],et=e&&I>3?I-3:1,tt=me(j===1?1:0,T,E),Ne=me(j===0?1:0,x,O),de=q?(Je,st)=>.5*(Ii(Je,st,pt)+Ii(Je,st,W)):(Je,st)=>Ii(Je,st,W),rt=(u-c)/R,kt=Z?j===1?rt:-rt:0,Ee=Z?0:j===0?rt:-rt,Fe=-kt,ze=-Ee;let lt=0,it=0,sr=0;{const Je=0/R,st=Z?ge:me(c*(1-Je)+u*Je,A,$),ut=Z?me(d*(1-Je)+p*Je,M,U):Me,Et=de(st,ut);lt=st*_,it=v(ut),sr=Et}let ke=0,ct=0,nr=0;{const Je=1/R,st=Z?ge:me(c*(1-Je)+u*Je,A,$),ut=Z?me(d*(1-Je)+p*Je,M,U):Me,Et=de(st,ut);ke=st*_,ct=v(ut),nr=Et}for(let Je=1;Je<I-1;Je+=et){const st=Je/R,ut=ke,Et=ct,It=nr;{const Or=Z?tt:me(st,T,E),Xr=Z?me(st,x,O):Ne,Gr=ut-B,or=Et-z,Zr=It-Y;Eu(ut,or,Zr,w),Tt.setVertexFromValuesRawPositionUV(Je,Gr,or,Zr,Or,Xr)}{const Or=(Je+1)/R,Xr=Z?ge:me(c*(1-Or)+u*Or,A,$),Gr=Z?me(d*(1-Or)+p*Or,M,U):Me,or=de(Xr,Gr);ke=Xr*_,ct=v(Gr),nr=or}const ci=ke,Ir=nr,ri=lt,Rt=it,Yr=sr;lt=ut,it=Et,sr=It;let Sr=0,Vr=0,yr=0;if(Z){const Or=ct-Et,Xr=Ir-It,Gr=Rt-Et,or=Yr-It,Zr=me(d*(1-st)+p*st,M,U),xi=ge+Fe,En=xi*_-ut,Cn=Ii(xi,Zr,W)-It,An=j===3?-1:1;if(Sr=An*(-Gr+Or)*Cn,Vr=An*En*(-or+Xr),yr=-An*En*(-Gr+Or),q){const On=ge+kt,Pi=On*_-ut;Sr=(-Gr+Or)*(Cn-(Ii(On,Zr,pt)-It)),Vr=(En-Pi)*(-or+Xr),yr=-(En-Pi)*(-Gr+Or)}}else{const Or=ci-ut,Xr=Ir-It,Gr=ri-ut,or=Yr-It,Zr=me(c*(1-st)+u*st,A,$),xi=Me+ze,En=Ii(Zr,xi,W)-It,Cn=v(xi)-Et,An=j===2?-1:1;if(Sr=An*Cn*(-or+Xr),Vr=An*(-Gr+Or)*En,yr=-An*Cn*(-Gr+Or),q){const On=Zr,Pi=Me+Ee,Ti=v(Pi)-Et;Sr=(-Cn+Ti)*(-or+Xr),Vr=(-Gr+Or)*(-En+(Ii(On,Pi,pt)-It)),yr=-(-Cn+Ti)*(-Gr+Or)}}const ui=1/Math.sqrt(Sr*Sr+Vr*Vr+yr*yr);Tt.setNormalFromValues(Je,Sr*ui,Vr*ui,yr*ui)}}}function x0e(t,e){A0e(t)}function kJe(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function BJe(t,e){return t*e}function T0e(t,e,r){return t?i=>kJe(i,e):i=>BJe(i,r)}function S0e(t,e,r,i,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=hp.map((x,E)=>E===0&&s[1]<e-2||E===1&&i[1]<e-2||E===2&&s[0]>1||E===3&&i[0]>1),u=t.outerEdges.reduce((x,E,O)=>x+(c[O]?0:o-2+E.count-1),0),d=r.reduce((x,E)=>x+o*(2*(E.latitudeResolution-1)+1),0),p=n?2:1,g=3*(l+u+d)*p,y=a>=RJe?new Uint32Array(g):new Uint16Array(g);let _=0;const v=e-2,w=o-2;ve(w>=0);const T=(x,E,O,A,$,M)=>{const U=x*$,k=M[U],B=M[U+1],z=M[U+2],Y=E*$,W=M[Y],j=M[Y+1],Z=M[Y+2],R=O*$,I=M[R],N=M[R+1],V=M[R+2],q=A*$,J=M[q],K=M[q+1],ge=M[q+2];return(W-J)*(W-J)+(j-K)*(j-K)+(Z-ge)*(Z-ge)>(k-I)*(k-I)+(B-N)*(B-N)+(z-V)*(z-V)};if(n){const x=(O,A,$)=>{y[_++]=O,y[_++]=A,y[_++]=A,y[_++]=$,y[_++]=$,y[_++]=O,ks&&(ve(O<a),ve(A<a),ve($<a),ve(_<=g))};(()=>{for(let O=Math.max(s[0],1)-1;O<Math.min(s[1],e-2)-1;++O){const A=O*v;for(let $=Math.max(i[0],1)-1;$<Math.min(i[1],e-2)-1;++$){const M=O*v+$,U=M+1,k=U+v,B=k-1,z=A+$,Y=z+1,W=Y+v,j=W-1,Z=t.vertexAttributes.position.typedBuffer,R=t.vertexAttributes.position.typedBufferStride;T(z,Y,W,j,R,Z)?(x(M,U,k),x(k,B,M)):(x(M,U,B),x(B,k,U))}}})(),ve(_===3*l*p),(()=>{for(let O=0;O<4;++O){const A=_;if(c[O])continue;const $=t.outerEdges[O],M=t.innerEdges[O];let U=0,k=0;const B=$.count,z=M.count;ve(z===o-1);let Y=0;const W=O===1||O===2?(j,Z,R)=>x(j,Z,R):(j,Z,R)=>x(j,R,Z);for(;U<B-1||k<z-1;){const j=M.getVertexIndex(k),Z=$.getVertexIndex(U),R=U<B-1,I=k<z-1;R&&(!I||(R?0+o*(U+.5)/(B-1):0)<=(I?1+w*(k+.5)/(z-1):0))?(++U,ks&&ve(U<B),W(j,Z,$.getVertexIndex(U)),Y++):(++k,ks&&ve(k<z),W(j,Z,M.getVertexIndex(k)),Y++)}ks&&(ve(U===B-1),ve(k===z-1),ve(Y===B+z-2),ve(Y===o-2+$.count-1),ve(_===A+3*Y*p))}})(),ve(_===3*(l+u)*p);const E=O=>{const A=t.outerEdges[O.connectedOuterEdgeOffset];let $=A.getVertexIndex(0),M=A.stride;for(let U=0;U<O.latitudeResolution;++U){const k=U===0?O.rowOffset:$+e;for(let B=0;B<o;B++)x($,$+1,k+B),U<O.latitudeResolution-1&&x($+1,k+B+1,k+B),$+=M;$=k,M=1}};r.forEach(E)}else{(()=>{const E=Math.max(s[0],1)-1,O=Math.min(s[1],e-2)-1,A=Math.max(i[0],1)-1,$=Math.min(i[1],e-2)-1;for(let M=E;M<O;++M){const U=M*v;for(let k=A;k<$;++k){const B=U+k,z=B+1,Y=z+v,W=Y-1,j=t.vertexAttributes.position.typedBuffer,Z=t.vertexAttributes.position.typedBufferStride;T(B,z,Y,W,Z,j)?(y[_]=B,y[_+1]=z,y[_+2]=Y,y[_+3]=Y,y[_+4]=W,y[_+5]=B):(y[_]=B,y[_+1]=z,y[_+2]=W,y[_+3]=W,y[_+4]=z,y[_+5]=Y),_+=6}}})(),ve(_===3*l*p),(()=>{for(let E=0;E<4;++E){if(c[E])continue;const O=t.outerEdges[E],A=t.innerEdges[E];let $=0,M=0;const U=O.count,k=A.count;ve(k===o-1);const B=E===1||E===2,z=B?1:2,Y=B?2:1,W=O.index0,j=O.stride,Z=A.index0,R=A.stride;for(;$<U-1||M<k-1;){const I=Z+M*R,N=W+$*j,V=$<U-1,q=M<k-1,J=V&&(!q||(V?0+o*($+.5)/(U-1):0)<=(q?1+w*(M+.5)/(k-1):0));J?++$:++M;const K=J?N+j:I+R;y[_]=I,y[_+z]=N,y[_+Y]=K,_+=3}}})(),ve(_===3*(l+u)*p);const x=E=>{const O=t.outerEdges[E.connectedOuterEdgeOffset];let A=O.getVertexIndex(0),$=O.stride;for(let M=0;M<E.latitudeResolution;++M){const U=M===0?E.rowOffset:A+e;for(let k=0;k<o;k++){const B=U+k;y[_]=A,y[_+1]=A+1,y[_+2]=B,M<E.latitudeResolution-1?(y[_+3]=A+1,y[_+4]=B+1,y[_+5]=B,_+=6):_+=3,A+=$}A=U,$=1}};r.forEach(x)}ve(_===g),t.indices=y,t.indexCount=g}function E0e(t,e){const r=t.localOrigin,i=t.geometry,s=t.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?n-1:0)*n+(l===1?n-1:0),d=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new NQ(o,r,u,d,n)}{const c=a,u=s[l]+1;i.outerEdges[l]=new NQ(o,r,c,1,u),a+=u}}}function C0e(t,e,r){const i=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];ve(T1(c));const u=c+1,d=t.geometry,p=d.boundingBox,g=d.outerEdges[e],y=d.uvRange[0],_=d.uvRange[1],v=d.uvRange[2],w=d.uvRange[3],T=me(e===1?1:0,y,v),x=me(e===0?1:0,_,w),E=r.renderData,O=E.geometryState,A=E.geometry.outerEdges[i],$=n.getNeighborEdgeStartVertexIndex(e,r)*c,M=c*2**a;ve(O.neighborData.edgeResolutions[i]===M),ve(A.count-1===M);const U=E.localOrigin[0]-t.localOrigin[0],k=E.localOrigin[1]-t.localOrigin[1],B=E.localOrigin[2]-t.localOrigin[2],z=g.attributes,Y=g.index0,W=g.stride,j=z.position.typedBuffer,Z=z.position.typedBufferStride,R=z.normalCompressed.typedBuffer,I=z.normalCompressed.typedBufferStride,N=z.uv0,V=A.attributes,q=A.index0,J=A.stride,K=V.position.typedBuffer,ge=V.position.typedBufferStride,Me=V.normalCompressed.typedBuffer,pt=V.normalCompressed.typedBufferStride;for(let Tt=1;Tt<u-1;++Tt){const et=Y+W*Tt,tt=q+J*($+Tt),Ne=et*Z,de=tt*ge,rt=K[de]+U,kt=K[de+1]+k,Ee=K[de+2]+B;j[Ne]=rt,j[Ne+1]=kt,j[Ne+2]=Ee,Eu(rt,kt,Ee,p);const Fe=et*I,ze=tt*pt;R[Fe]=Me[ze],R[Fe+1]=Me[ze+1];const lt=Tt/c,it=l?T:me(lt,y,v),sr=l?me(lt,_,w):x;Wh(N,et,it,sr)}}function A0e(t){var Ne;const e=t.geometryState,r=e.neighborData,i=t.localOrigin,s=r.cornerNeighborData,n=t.geometry,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=((Ne=t.tile.surface.view)==null?void 0:Ne.viewingMode)==="local",u=l.ellipsoid.radius,d=l.extentInRadians,p=l.horizontalScale;let g=0,y=0,_=0;const v=(de,rt,kt)=>{const Ee=d[rt===0?1:3],Fe=d[de===0?0:2],ze=Math.cos(Ee),lt=Math.sin(Ee),it=Math.sin(Fe),sr=Math.cos(Fe),ke=u+kt;g=sr*ze*ke,y=it*ze*ke,_=lt*ke},w=c?(()=>{const de=t.geometryState.clippingArea,rt=l.extent,kt=de!=null&&(rt[3]>de[3]||rt[2]>de[2]||rt[1]<de[1]||rt[0]<de[0]),Ee=T0e(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,p);return(Fe,ze,lt)=>{const it=Fe===0?Y[0]:Y[2],sr=ze===0?Y[1]:Y[3],ke=kt?me(it,de[0],de[2]):it,ct=kt?me(sr,de[1],de[3]):sr,nr=lt;g=ke*p,y=Ee(ct),_=nr}})():v;let T=0,x=0,E=0,O=0,A=0,$=0,M=0,U=0,k=0;const B=c&&t.tile.surface.isWebMercatorOnPlateeCarree,z=(de,rt,kt,Ee,Fe)=>{let ze=0,lt=0,it=0;if(c){const sr=rt*p,ke=B?(Math.PI/2-2*Math.atan(Math.exp(-kt/u)))*u:kt*p;ze=sr-g,lt=ke-y,it=Ee-_}else{const sr=WG(de),ke=de.tile,ct=ke.extent,nr=ke.extentInRadians,Je=(rt-ct[0])/(ct[2]-ct[0]),st=(kt-ct[1])/(ct[3]-ct[1]),ut=nr[0]*(1-Je)+nr[2]*Je,Et=sr(st),It=Math.cos(Et),ci=Math.sin(Et),Ir=Math.sin(ut),ri=Math.cos(ut),Rt=u+Ee;ze=ri*It*Rt-g,lt=Ir*It*Rt-y,it=ci*Rt-_}switch(Fe){case 0:M+=ze,U+=lt,k+=it;break;case 1:O-=ze,A-=lt,$-=it;break;case 2:M-=ze,U-=lt,k-=it;break;case 3:O+=ze,A+=lt,$+=it}},Y=l.extent,W=e.clippingArea,j=W??qG,Z=Y[0],R=Y[2],I=Y[1],N=Y[3],V=[N>j[3],R>j[2],I<j[1],Z<j[0]],q=Math.max(Z,j[0]),J=Math.min(R,j[2]),K=Math.max(I,j[1]),ge=Math.min(N,j[3]),Me=n.uvRange[0],pt=n.uvRange[1],Tt=n.uvRange[2],et=n.uvRange[3],tt=de=>{var sr;const rt=s[de].cornerTiles;T=0,x=0,E=1,O=0,A=0,$=0,M=0,U=0,k=0;let kt=1/0;for(let ke=0;ke<4;++ke)kt=Math.min(kt,((sr=rt[ke])==null?void 0:sr.level)??1/0);for(let ke=0;ke<4;++ke){const ct=rt[ke];TT[ke]=(ct==null?void 0:ct.level)===kt?ct:null}let Ee=1,Fe=0;for(let ke=0;ke<4;++ke){const ct=TT[ke];ct&&(Ee=Math.max(Ee,ct==null?void 0:ct.renderData.geometryState.numVerticesPerSide),Fe=ct.extent[2]-ct.extent[0])}const ze=Fe,lt=Ee;ve(lt>1);const it=ze/lt;for(let ke=0;ke<4;++ke){const ct=TT[(ke+3)%4],nr=TT[ke%4];if(!ct&&!nr)continue;const Je=ke===0?1:ke===1?2:ke===2?3:0,st=ke===0?2:ke===1?3:ke===2?0:1;if(ct&&nr){const ut=W5[ke][0]*it,Et=W5[ke][1]*it,It=ct.extent,ci=It[Je===0||Je===1?2:0]+ut,Ir=It[Je===0||Je===3?3:1]+Et,ri=nr.extent,Rt=ri[st===0||st===1?2:0]+ut,Yr=ri[st===0||st===3?3:1]+Et,Sr=ct.renderData,Vr=nr.renderData,yr=Ii(ci,Ir,Sr.geometryState.samplerData),ui=Ii(Rt,Yr,Vr.geometryState.samplerData);z(Sr,ci,Ir,.5*(yr+ui),ke)}else{const ut=ct??nr,Et=ct?Je:st,It=ut.extent,ci=W5[ke],Ir=It[Et===0||Et===1?2:0]+ci[0]*it,ri=It[Et===0||Et===3?3:1]+ci[1]*it,Rt=ut.renderData,Yr=Ii(Ir,ri,Rt.geometryState.samplerData);z(Rt,Ir,ri,Yr,ke)}}if(!c){const ke=Math.sqrt(g*g+y*y+_*_);T=g/ke,x=y/ke,E=_/ke}if(c||E*E<.999){const ke=Math.sqrt(O*O+A*A+$*$);O/=ke,A/=ke,$/=ke;const ct=Math.sqrt(M*M+U*U+k*k);M/=ct,U/=ct,k/=ct,T=$*U-A*k,x=O*k-$*M,E=A*M-O*U;const nr=1/Math.sqrt(T*T+x*x+E*E);T*=nr,x*=nr,E*=nr}};for(let de=0;de<4;++de){const rt=de,kt=(de+1)%4,Ee=de===0||de===1?1:0,Fe=de===0||de===3?1:0,ze=me(Ee,Me,Tt),lt=me(Fe,pt,et),it=o[rt],sr=de===0||de===3?it.count-1:0,ke=o[kt],ct=de===0||de===1?ke.count-1:0,nr=s[de].cornerTiles;let Je=-1;for(let Et=0;Et<4;++Et){const It=nr[Et];It&&(Je===-1||Jf(nr[Je],It)>0)&&(Je=Et)}const st=Je,ut=nr[st];if(ut!==l){const Et=l.level-ut.level,It=2**Et,ci=[ut.lij[0]+Et,ut.lij[1]*It,ut.lij[2]*It],Ir=[ci[1]+It===l.lij[1],de===0&&(st===1||st===0&&ut!==nr[3])||de===1&&(st===0||st===1&&ut!==nr[2]),ci[1]===l.lij[1]+1,de===2&&(st===3||st===2&&ut!==nr[1])||de===3&&(st===2||st===3&&ut!==nr[0])],ri=Ir.reduce((yr,ui)=>yr+(ui?1:0),0);ve(ri===1||ri===2);let Rt=-1,Yr=-1;const Sr=ut.renderData;if(ri===1){const yr=Ir.findIndex(Or=>Or);ve(0<=yr&&yr<=3),Rt=(yr+2)%4;const ui=t.geometryState.neighborData.edgeResolutions[yr];Yr=l.getNeighborEdgeStartVertexIndex(yr,ut)*ui+ui*(yr===0&&de===0||yr===1&&de===0||yr===2&&de===1||yr===3&&de===3?1:0)}else{ve(Ir[1]||Ir[3]),Rt=Ir[1]?3:1;const yr=Sr.geometryState.neighborData.edgeResolutions[Rt];Yr=de===0||de===3?0:yr}const Vr=Sr.geometry.outerEdges[Rt];{const yr=it.index0+sr*it.stride,ui=ke.index0+ct*ke.stride,Or=Vr.index0+Yr*Vr.stride;{const Xr=Vr.attributes.position,Gr=Xr.typedBuffer,or=Or*Xr.typedBufferStride,Zr=t.localOrigin,xi=Vr.localOrigin,En=Gr[or]+xi[0]-Zr[0],Cn=Gr[or+1]+xi[1]-Zr[1],An=Gr[or+2]+xi[2]-Zr[2];Eu(En,Cn,An,a);{const On=it.attributes.position,Pi=On.typedBuffer,Ti=yr*On.typedBufferStride;Pi[Ti]=En,Pi[Ti+1]=Cn,Pi[Ti+2]=An}{const On=ke.attributes.position,Pi=On.typedBuffer,Ti=ui*On.typedBufferStride;Pi[Ti]=En,Pi[Ti+1]=Cn,Pi[Ti+2]=An}}Wh(it.attributes.uv0,yr,ze,lt),Wh(ke.attributes.uv0,ui,ze,lt);{const Xr=Vr.attributes.normalCompressed.typedBuffer,Gr=Or*Vr.attributes.normalCompressed.typedBufferStride;{const or=it.attributes.normalCompressed,Zr=or.typedBuffer,xi=yr*or.typedBufferStride;Zr[xi]=Xr[Gr],Zr[xi+1]=Xr[Gr+1]}{const or=ke.attributes.normalCompressed,Zr=or.typedBuffer,xi=ui*or.typedBufferStride;Zr[xi]=Xr[Gr],Zr[xi+1]=Xr[Gr+1]}}}}else{const Et=V[rt],It=V[kt];let ci;if(Et||It){const Yr=me(Z*(1-Ee)+R*Ee,q,J),Sr=me(I*(1-Fe)+N*Fe,K,ge),Vr=e.samplerData;ci=Ii(Yr,Sr,Vr)}else ci=VJe(nr);w(Ee,Fe,ci),tt(de);const Ir=g-i[0],ri=y-i[1],Rt=_-i[2];Eu(Ir,ri,Rt,a),it.setVertexFromValuesRawPositionUVNormal(sr,Ir,ri,Rt,ze,lt,T,x,E),ke.setVertexFromValuesRawPositionUVNormal(ct,Ir,ri,Rt,ze,lt,T,x,E)}}for(let de=0;de<4;++de)TT[de]=null}function VJe(t){var n,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);ks&&(ve(!t[0]||!t[2]||Cz(t[0],t[2],mt.SOUTH_WEST)),ve(!t[1]||!t[3]||Cz(t[1],t[3],mt.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,u=a===0||a===3,d=l.extent,p=d[c?0:2],g=d[u?1:3],y=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;i+=Ii(p,g,y),r++}}const s=r?i/r:0;return ve(s!=null),s}function ID(t){const e=t.vao,r=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const W5=[[0,1],[1,0],[0,-1],[-1,0]],kn=new OZe,qG=Wk(-1/0,-1/0,1/0,1/0),TT=[null,null,null,null];function O0e(t,e,r){if(!e)return!1;const i=Jf(t,e);return i>0||i===0&&r>=2}let GJe=class extends VG{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Ut(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=s!=null&&Tk(s)&&n!=null&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const u=Ce(c[0],c[1],0);wn(u,yt.WebMercator,u,yt.PlateCarree);const d=Ce(c[2],c[3],0);wn(d,yt.WebMercator,d,yt.PlateCarree),l[0]=u[0],l[1]=u[1],l[2]=d[0],l[3]=d[1]}else for(let u=0;u<4;++u)l[u]=c[u]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[vs.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let u=0;u<6;u++){const d=e[u],p=d[0],g=d[1],y=d[2],_=d[3];if(p*(p>0?i:o)+g*(g>0?s:a)+y*(y>0?n:l)+_>=0)return $o.OUTSIDE;c=c&&p*(p<0?i:o)+g*(g<0?s:a)+y*(y<0?n:l)+_<=0}return c?$o.INSIDE:$o.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return YCe(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,s){return oR[0]=1/r[0],oR[1]=1/r[1],oR[2]=1/r[2],AV(this._aabb(),e,oR,i,s)}createGeometry(){NJe(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){UJe(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){zJe(this.renderData,this._horizontalScaleFactor)}};const oR=C();let jJe=class{constructor(){this.extent=Ht(),this.minLevel=0,this.maxLevel=0,this.callback=null}},YP=class extends we{constructor(){super(...arguments),this._queries=new Nt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Nt({initialSize:30}),this._queryPool=new po(jJe)}queryVisibleLevelRange(e,r,i,s){const n=this._queryPool.acquire();gu(n.extent,e),n.minLevel=r??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};h([f()],YP.prototype,"updating",null),YP=h([F("esri.views.3d.terrain.ScaleRangeQueries")],YP);let HJe=class extends VG{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=ss(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],u=_t(o,l,.5),d=_t(n,a,.5),p=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(p)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),H3e(this.centerAtSeaLevel,d,u,this.ellipsoid.radius),fe(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[vs.MIDDLE],0,0,0),se(e[vs.TOP],0,0,0),se(e[vs.BOTTOM],0,0,0),e[vs.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[vs.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,WJe(r,i,3*n));e[vs.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!m0(e,this._boundingSphere))return $o.OUTSIDE;if(this.lij[0]<10)return $o.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<u2;n++){const o=n===Qr.NEAR,a=e[n],l=a[0],c=a[1],u=a[2],d=a[3]-(o?i:0);let p=!1;for(let g=0;g<8;++g){const y=3*g;if(l*r[y]+c*r[y+1]+u*r[y+2]+d<0){if(p=!0,!s)break}else s=!1}if(!p)return $o.OUTSIDE}return s?$o.INSIDE:$o.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){PJe(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),ks&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)se(r,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];jy(ZQ,a,l,s),jy(JQ,a,c,s),oe(r,ZQ,JQ);const u=.5*(i[0]+i[1]);ee(r,r,(s+u)/pl(r));const d=this.convexHull;let p=0;const g=(_,v)=>{const w=_[0]-d[3*v],T=_[1]-d[3*v+1],x=_[2]-d[3*v+2];return Math.sqrt(w*w+T*T+x*x)};for(let _=0;_<8;++_){const v=g(r,_);p=Math.max(p,v)}const y=p;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===cu.HAS_NORTH_POLE,a=n&&s===cu.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=e[0],d=e[2],p=a?-c:e[1],g=o?c:e[3],y=.5*(u+d),_=i[0],v=r+(l?Math.min(0,_-1):_),w=(Z,R,I)=>jy(Z,R,I,v),T=C(),x=C(),E=C(),O=C();w(T,u,p),w(x,u,g),w(E,d,g),w(O,d,p);const A=(Z,R)=>{for(let I=0;I<3;++I)this._convexHull[3*R+I]=Z[I]};A(T,0),A(x,1),A(E,2),A(O,3);const $=i[1],M=r+(l?Math.max(0,$+1):$),U=C(),k=C(),B=C();jy(k,y,g,v),jy(B,y,p,v),oe(U,k,B),fe(U,U);const z=C(),Y=C(),W=(Z,R)=>{_n(Y,Z,R),fe(Y,Y);const I=-pe(Z,z)/pe(Y,z);ve(I>=0),ee(Y,Y,I),oe(Z,Z,Y)};if(2**this.lij[0]>2*this.lij[1]){const Z=B,R=C();Qe(R,XQ,Z),fe(R,R),Qe(z,Z,R),fe(z,z),ve(uu(pe(z,Z)/pl(Z),0)),W(T,x),W(O,E),A(T,0),A(O,3)}else if(2**this.lij[0]!==2*this.lij[1]){const Z=k,R=C();Qe(R,XQ,Z),fe(R,R),Qe(z,R,Z),fe(z,z),W(x,T),W(E,O),A(x,1),A(E,2)}const j=(Z,R)=>{const I=M/pe(R,U);for(let N=0;N<3;++N)this._convexHull[3*Z+N]=R[N]*I};j(4,T),j(5,x),j(6,E),j(7,O)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?cu.HAS_BOTH_POLES:cu.HAS_NORTH_POLE:i?cu.HAS_SOUTH_POLE:cu.REGULAR}intersectsRay(e,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-e[0],c=n[1]-e[1],u=n[2]-e[2],d=(l*r[0]+c*r[1]+u*r[2])/a,p=r[0]*d-l,g=r[1]*d-c,y=r[2]*d-u;return p*p+g*g+y*y<o*o}getDefaultVerticesPerSide(){return this.level<YQ.length?YQ[this.level]+1:2}updateCornerElevations(){IJe(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){$Je(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var kt;if(!ks||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,s=C(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,u=this._center[vs.MIDDLE][3],d=this.convexHull,p=(Ee,Fe)=>{for(let ze=0;ze<3;++ze)Ee[ze]=d[3*Fe+ze]};{const Ee=C(),Fe=C(),ze=C(),lt=C(),it=C(),sr=(ke,ct,nr,Je)=>{p(Fe,ke),p(ze,ct),p(lt,nr),_n(Fe,Fe,ze),_n(lt,lt,ze),Qe(Ee,Fe,lt),fe(Ee,Ee);const st=pe(Ee,ze);p(it,Je);const ut=pe(Ee,it),Et=Math.abs(ut-st);ve(uu(Et,0),`Non coplanar ${ke},${ct},${nr},${Je} diff = ${Et}`)};sr(0,1,2,3),sr(4,5,6,7),sr(0,1,4,5),sr(1,2,5,6),sr(2,3,6,7),sr(3,0,7,4)}const g=go(24),y=(Ee,Fe,ze)=>{const lt=4*Ee;for(let it=0;it<3;++it)g[lt+it]=Fe[it];g[lt+3]=ze},_=C(),v=C(),w=C(),T=C(),x=(Ee,Fe,ze,lt)=>{p(_,Fe),p(v,ze),p(w,lt),_n(_,_,v),fe(_,_),_n(w,w,v),fe(w,w),Qe(T,_,w),fe(T,T);const it=pe(T,v);y(Ee,T,it)};x(0,0,1,2),x(1,1,0,4),x(2,1,5,2),x(3,3,2,6),x(4,4,0,3),x(5,4,6,5);const E=1,O=(Ee,Fe,ze,lt)=>{const it=4*Ee;return g[it]*Fe+g[it+1]*ze+g[it+2]*lt-g[it+3]},A=(Ee,Fe,ze,lt)=>O(Ee,Fe,ze,lt)>=-E,$=(Ee,Fe)=>A(Ee,Fe[0],Fe[1],Fe[2]),M=2**this.lij[0]>2*this.lij[1],U=(Ee,Fe,ze)=>Math.sqrt(R0e(Ee,Fe,ze,i[0],i[1],i[2]))<r,k=Ee=>U(Ee[0],Ee[1],Ee[2]),B=(Ee,Fe)=>U(Ee[Fe],Ee[Fe+1],Ee[Fe+2]),z=this.extentInRadians,Y=.5*(z[0]+z[2]),W=z[1],j=z[3],Z=C(),R=C();jy(Z,Y,j,a),jy(R,Y,W,a);const I=M?"Upper":"Lower";let N=!0;for(let Ee=0;Ee<6;++Ee){for(let Fe=0;Fe<8;++Fe){const ze=3*Fe,lt=A(Ee,d[ze],d[ze+1],d[ze+2]);N&&(N=lt),ve(lt,`Tile[${this.lij}] Convex hull point ${Fe} outside of plane ${Ee}`)}ve($(Ee,R),`Tile[${this.lij}] (${I}) bottom mid outside of plane ${Ee}`),ve($(Ee,Z),`Tile[${this.lij}] (${I}) top mid outside of plane ${Ee}`)}ve(N,"Not all convex hull points are inside  convex hull polyhedron"),ve(k(R),`Tile[${this.lij}] (${I}) bottom mid outside of bounding sphere`),ve(k(Z),`Tile[${this.lij}] (${I}) top mid outside of bounding sphere`);for(let Ee=0;Ee<8;++Ee){const Fe=B(d,3*Ee);ve(Fe,`Tile[${this.lij}] Convex hull point ${Ee} outside of bounding sphere`)}for(let Ee=0;Ee<6;++Ee)for(let Fe=0;Fe<8;++Fe){const ze=3*Fe;A(Ee,d[ze],d[ze+1],d[ze+2])||console.error(`Tile[${this.lij}] Convex hull point ${Fe} outside of plane ${Ee}`)}const V=this.extentInRadians,q=Math.max(V[2]-V[0],V[3]-V[1]),J=Math.round(q*n),K=this.renderData;if(!K)return;const{geometry:ge,localOrigin:Me}=K,pt=(kt=ge.vertexAttributes)==null?void 0:kt.position;if(!pt)return;const Tt=pt.count,et=C(),tt=ge.numVerticesPerSide-2,Ne=tt*tt,de=K.geometryState.neighborData,rt=de.edgeResolutions.reduce((Ee,Fe)=>Ee+Fe+1,0);for(let Ee=0;Ee<Tt;++Ee){const Fe=Ee<Ne,ze=!Fe&&Ee<Ne+rt;let lt=!1,it=-1;if(ze){let Rt=Ne;for(let Yr=0;Yr<4;++Yr){const Sr=de.edgeResolutions[Yr];if(Ee===Rt||Ee===Rt+Sr-1){lt=!0;break}if(Rt+=Sr,Ee<Rt){it=Yr;break}}}const sr=ze?de.edgePeerNeighbors[it]:null,ke=ze&&sr&&Jf(this,sr)>0;pt.getVec(Ee,s),oe(et,s,Me);const ct=pl(et)-n;let nr=0,Je=!1;const st=o[0]-ct,ut=ct-o[1],Et=st>l,It=ut>l,ci=Et||It,Ir=()=>{const Rt=Fe?"internal":ze&&!lt?"edge":lt?"corner":"pole";return`Tile[${this.lij}].vertex[${Ee}]:${Rt}`+(Et?"(below)":It?"(above)":"")+(ke?"(Neighbor)":"")},ri=ZC(et,i);if(ri>=r+c){const Rt=ri-r;ci||(console.error(`${Ir()} is out of the bounding sphere by ${Rt.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${ct.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Rt/r).toFixed(0)})`),Je=!0)}for(let Rt=0;Rt<6;++Rt)if(!A(Rt,et[0],et[1],et[2])){const Yr=O(Rt,et[0],et[1],et[2]),Sr=Ee%tt,Vr=(Ee-Sr)/tt;Rt===0&&st||Rt===5&&ut||(console.error(`${Ir()} (${Sr},${Vr})|${tt}] is out of the bounding trapezoid plane ${Rt} h=${Math.round(ct)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(Yr)} radii = ${Math.round(r)}/${Math.round(u)}} : maxL = ${J}`),++nr)}if(Je||nr>0)break}}};const YQ=[128,64,64,32,16,8,8,4];function WJe(t,e,r){return R0e(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function R0e(t,e,r,i,s,n){const o=i-t,a=s-e,l=n-r;return o*o+a*a+l*l}const jy=(t,e,r,i)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*s,t[1]=i*o*n,t[2]=i*a},XQ=[0,0,1],ZQ=C(),JQ=C();let gh=class extends we{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};h([f()],gh.prototype,"fovX",void 0),h([f()],gh.prototype,"fovY",void 0),h([f()],gh.prototype,"relativeWidthLimit",void 0),h([f()],gh.prototype,"relativeHeightLimit",void 0),h([f()],gh.prototype,"maxLod",void 0),h([f()],gh.prototype,"angledSplitBias",void 0),h([f()],gh.prototype,"aboveGround",void 0),h([f()],gh.prototype,"frustum",void 0),gh=h([F("esri.views.3d.terrain.SplitLimits")],gh);let P0e=class extends Bo{constructor(){super(...arguments),this.blendMode=Ae.Normal}};h([D({count:Ae.COUNT})],P0e.prototype,"blendMode",void 0);let LE=class extends P0e{constructor(){super(...arguments),this.output=Xs.Composite,this.baseOpacityMode=Bh.NotRequired,this.premultipliedSource=Oh.Off}};h([D({count:Xs.COUNT})],LE.prototype,"output",void 0),h([D({count:Bh.COUNT})],LE.prototype,"baseOpacityMode",void 0),h([D()],LE.prototype,"premultipliedSource",void 0);var X1;function qJe(t){const e=new ur;if(e.include(c0e),t.background===X1.Only){const r=t.output===Xs.ColorComposite;return r?e.fragment.uniforms.add(new Mt("backgroundColor",i=>i.backgroundColor)):e.fragment.include(BG),e.fragment.code.add(b`
    void main() {
      fragColor = vec4(${r?b`backgroundColor`:b`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(u0e,t),e.fragment.uniforms.add(new We("tex",r=>r.texture)),e.fragment.uniforms.add(new Se("opacity",r=>r.opacity)),e.fragment.code.add(b`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(X1||(X1={}));const YJe=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return X1},build:qJe},Symbol.toStringTag,{value:"Module"}));let XJe=class extends l0e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Va}},M0e=class $0e extends gr{initializeProgram(e){return new pr(e.rctx,$0e.shader.get().build(this.configuration),cr)}initializePipeline(){return xt({blending:Il(_e.ONE,_e.ONE_MINUS_SRC_ALPHA),colorWrite:$t})}};M0e.shader=new dr(YJe,()=>he(()=>import("./BlendLayers.glsl-2462336f.js"),[]));let I0e=class extends LE{constructor(){super(...arguments),this.background=X1.BelowLayer}};h([D()],I0e.prototype,"background",void 0);let q5=class{constructor(e,r,i,s,n,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Ct(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Ce(s,n,o)}destroy(){this.texture.release()}};function ZJe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function JJe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function QJe(t,e,r,i,s,n,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t}function L0e(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=r*n-i*s;return l?(l=1/l,t[0]=n*l,t[1]=-i*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*a-n*o)*l,t[5]=(i*o-r*a)*l,t):null}function KJe(t){return t[0]*t[3]-t[1]*t[2]}function D0e(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1],d=r[2],p=r[3],g=r[4],y=r[5];return t[0]=i*c+n*u,t[1]=s*c+o*u,t[2]=i*d+n*p,t[3]=s*d+o*p,t[4]=i*g+n*y+a,t[5]=s*g+o*y+l,t}function YG(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),u=Math.cos(r);return t[0]=i*u+n*c,t[1]=s*u+o*c,t[2]=i*-c+n*u,t[3]=s*-c+o*u,t[4]=a,t[5]=l,t}function N0e(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i*c,t[1]=s*c,t[2]=n*u,t[3]=o*u,t[4]=a,t[5]=l,t}function XG(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=i*c+n*u+a,t[5]=s*c+o*u+l,t}function eQe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function tQe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function ZG(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function rQe(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function iQe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function sQe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function F0e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function nQe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function oQe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function aQe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function lQe(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],d=e[3],p=e[4],g=e[5],y=ma();return Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-u)<=y*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-d)<=y*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=y*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-g)<=y*Math.max(1,Math.abs(a),Math.abs(g))}const cQe=D0e,uQe=F0e;Object.freeze(Object.defineProperty({__proto__:null,add:sQe,copy:ZJe,determinant:KJe,equals:lQe,exactEquals:aQe,frob:iQe,fromRotation:eQe,fromScaling:tQe,fromTranslation:ZG,identity:JJe,invert:L0e,mul:cQe,multiply:D0e,multiplyScalar:nQe,multiplyScalarAndAdd:oQe,rotate:YG,scale:N0e,set:QJe,str:rQe,sub:uQe,subtract:F0e,translate:XG},Symbol.toStringTag,{value:"Module"}));function U0e(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function hQe(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function dQe(t,e,r,i,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function pQe(t,e){return new Float32Array(t,e,6)}function z0e(t,e,r,i){const s=e[i],n=e[i+1];t[i]=r[0]*s+r[2]*n+r[4],t[i+1]=r[1]*s+r[3]*n+r[5]}function fQe(t,e,r,i=0,s=0,n=2){const o=s||e.length/n;for(let a=i;a<o;a++)z0e(t,e,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:hQe,create:U0e,createView:pQe,fromValues:dQe,transform:z0e,transformMany:fQe},Symbol.toStringTag,{value:"Module"}));function XP(){return[1,0,0,1,0,0]}function mQe(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function gQe(t,e,r,i,s,n){return[t,e,r,i,s,n]}function yQe(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:mQe,create:XP,createView:yQe,fromValues:gQe},Symbol.toStringTag,{value:"Module"}));function _Qe(t){return t instanceof Float32Array&&t.length>=2}function vQe(t){return Array.isArray(t)&&t.length>=2}function Y5(t){return _Qe(t)||vQe(t)}const bQe=96,wQe=39.37;function JG(t,e){return e.type?Qt(t,e.x,e.y):Vs(t,e)}function xQe(t){return fa(t)}function TQe(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const SQe=function(){const t=Ie();return function(e,r,i){const s=r.targetGeometry;JG(t,s);const n=.5*LD(r);return e.xmin=t[0]-n*i[0],e.ymin=t[1]-n*i[1],e.xmax=t[0]+n*i[0],e.ymax=t[1]+n*i[1],e.spatialReference=s.spatialReference,e}}();function LD(t){return t.scale*EQe(t.targetGeometry)}function EQe(t){return t!=null&&No(t.spatialReference)?1/(xQe(t.spatialReference)*wQe*bQe):1}function CQe(t){return VI(t.rotation)||0}const QG=function(){const t=Ie(),e=Ie(),r=Ie();return function(i,s,n,o,a,l){return y7(t,s),Tl(e,n,.5*l),Qt(r,1/o*l,-1/o*l),ZG(i,e),a&&YG(i,i,a),N0e(i,i,r),XG(i,i,t),i}}(),AQe=function(){const t=Ie();return function(e,r,i,s){const n=LD(r),o=CQe(r);return JG(t,r.targetGeometry),QG(e,t,i,n,o,s)}}(),OQe=function(){const t=Ie();return function(e,r,i,s){const n=LD(r);return JG(t,r.targetGeometry),QG(e,t,i,n,0,s)}}();function RQe(t){const e=e1(t);return e?e.valid[1]-e.valid[0]:0}function PQe(t,e){return Math.round(RQe(t)/e)}var Oz;const nf=[0,0];let kg=Oz=class extends Ke{constructor(t){super(t),this._viewpoint2D={center:Ie(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Wr,this.id=0,this.inverseTransform=XP(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=XP(),this.transformNoRotation=XP(),this.displayMat3=Ha(),this.displayViewMat3=Ha(),this.viewMat3=Ha(),this.viewMat2d=U0e(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=TQe(r,t.viewpoint),this._set("size",Vs(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new Oz({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return Y5(e)?m_(t,e,this.inverseTransform):(nf[0]=e,nf[1]=r,m_(t,nf,this.inverseTransform))}toScreen(t,e,r){return Y5(e)?m_(t,e,this.transform):(nf[0]=e,nf[1]=r,m_(t,nf,this.transform))}toScreenNoRotation(t,e,r){return Y5(e)?m_(t,e,this.transformNoRotation):(nf[0]=e,nf[1]=r,m_(t,nf,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return QG(t,r,s,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Qh({targetGeometry:new at(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!e||!r)return;this.resolution=LD(o),this.rotation=i,this.scale=r,this.spatialReference=e,Vs(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;R7(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=P7(this.viewMat3),u=lu(n[0]/2,n[1]/2),d=lu(-n[0]/2,-n[1]/2),p=VI(i);u$(c,c,u),M7(c,c,p),u$(c,c,d),Tx(this.displayViewMat3,this.displayMat3,c);const g=ZG(this.viewMat2d,u);return YG(g,g,p),XG(g,g,d),SQe(this.extent,o,n),AQe(this.transform,o,n,s),L0e(this.inverseTransform,this.transform),OQe(this.transformNoRotation,o,n,s),this.worldScreenWidth=PQe(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};h([f({readOnly:!0})],kg.prototype,"id",void 0),h([f({value:1,json:{write:!0}})],kg.prototype,"pixelRatio",null),h([f({json:{write:!0}})],kg.prototype,"size",null),h([f()],kg.prototype,"spatialReference",void 0),h([f({type:Qh,json:{write:!0}})],kg.prototype,"viewpoint",null),kg=Oz=h([F("esri.views.2d.ViewState")],kg);const MQe=kg,$Qe=.125;let IQe=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new MQe({viewpoint:new Qh({targetGeometry:new at(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,s,n,o,a,l,c,u){const d=o.adjustLevel(r[0]),p=this._renderParams;p.context=e,p.painter=s,p.glyphMosaic=s.glyphMosaic,p.spriteMosaic=s.spriteMosaic,p.pixelRatio=u,p.displayLevel=d,p.requiredLevel=d;const g=o.getScale(r[0]),[y,_]=o.getShift(r,a*g),v=$Qe*a*g/c,w=i.transforms.dvs;w[0]=v,w[4]=-v,w[6]=-1-y-l[0]*a*2,w[7]=1+_+(1-l[1])*a*2-2,p.state.size[0]=c,p.state.size[1]=c,i.stage||i.attachWithContext(e),i.triangleCount=0,s.drawTile(p,i,n)}},k0e=class B0e extends gr{initializeProgram(e){return new pr(e.rctx,B0e.shader.get().build(this.configuration),cr)}initializePipeline(){return xt({blending:Il(_e.ONE,_e.ONE_MINUS_SRC_ALPHA),colorWrite:$t})}};k0e.shader=new dr(QZe,()=>he(()=>import("./RasterColorizer.glsl-f9e14f1c.js"),[]));let FS=class extends LE{constructor(){super(...arguments),this.colorizerType=d1.Stretch,this.stretchType=Y1.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};h([D({count:d1.COUNT})],FS.prototype,"colorizerType",void 0),h([D({count:Y1.COUNT})],FS.prototype,"stretchType",void 0),h([D()],FS.prototype,"applyColormap",void 0),h([D()],FS.prototype,"requireBilinearWithNN",void 0);let QQ=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new As(this._rctx,new xr(e),new q$(xs.DEPTH_COMPONENT16,e));return this._fbos.set(e,i),i}};const LQe=ne.getLogger("esri.views.3d.terrain");let DQe=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new IQe,this._bindParameters=new DL(null,null,null),this._blendLayersTechniqueConfig=new I0e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Xa(this._rctx,cA)}dispose(){this._fbos.forEach(Ue),this._fbos=null,this._vtFBO=Ue(this._vtFBO),this._vaoQuad=Ue(this._vaoQuad),this._vectorTileHelper=Ue(this._vectorTileHelper),this._backgroundTechnique=vi(this._backgroundTechnique),this._applyOpacityTechnique=vi(this._applyOpacityTechnique),this._blendLayersTechnique=vi(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,s=Oh.Off,n=X1.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(M0e,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Ae.Normal,r?Xs.ColorComposite:Xs.GridComposite,Bh.NotRequired,Oh.Off,X1.Only),s=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(vt.TRIANGLE_STRIP,0,co(this._vaoQuad,"geometry"))}drawGroup(e,r,i,s,n,o=Oh.On){r===Xs.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,s,n,o=Oh.Off){if(e.texture==null)return;e.fboTexture=r===Xs.GroupBackgroundComposite||s===Ae.Normal&&n===Bh.NotRequired&&o===Oh.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,jt.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===Ae.Normal&&n===Bh.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,c,null);this._render(u)}_getRasterColorizerTechnique(e,r,i,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new FS,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?Y1.Noop:Y1.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(k0e,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,s,n,o,a,l,c){const u=this._rctx,d=o.sourceLayerInfo.data,p=o.tile.surface.layerViewByIndex(o.layerIndex,jt.MAP),g=n===Bh.Required||e.opacity<1||s!==Ae.Normal||r!==Xs.Composite,y=g?Oh.On:Oh.Off;this._getBlendLayersTechnique(s,r,n,y).bindPipelineState(u);let _=null,v=null;g?(v=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new QQ(this._rctx)),_=this._vtFBO.get(i),u.bindFramebuffer(_),this._clearCurrentFBO()):c&&u.clearSafe(mi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(u,o.sourceLod,d,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(w){LQe.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return _==null||(u.bindFramebuffer(v),e.texture=_.colorTexture,e.offset=Kh,e.scale=1,this.drawRasterData(e,r,i,s,n,y),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,bt.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;r.gl.copyTexImage2D(ji.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),r.bindTexture(i,bt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(mi.COLOR_BUFFER_BIT|mi.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new QQ(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},NQe=class{constructor(e,r,i,s){this.start=e,this.end=r,this.blendMode=i,this.opacity=s}},FQe=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new XJe,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new DQe(this._rctx,this._techniqueRepository),this._blackTex=new Zb(bIe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Ue(this._composition),this._backgroundTexture=vi(this._backgroundTexture),this._blackTex=vi(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let u=!1;hI.clear(),ab.length=0;const d=e.layerInfo[jt.MAP];let p=d.length,g=0,y=null;for(;g<d.length;g++){const v=i.layerViewByIndex(g,jt.MAP),w=v.layer.opacity;KQ[g]=w;const T=v.fullOpacity;if(eK[g]=T,Qre(v.layer)&&p>=d.length&&(p=g),oI(v)){tK[g]=v.layer.blendMode;let E=v.layer.blendMode!=="normal";if(ix(v.layer.parent)){const O=Rz(v.layer.parent);O!=null&&O!==""&&(E=V0e(v.layer.parent)||E)}E&&(u=E,l=!1)}if(w===0&&!u){d[g].pendingUpdates&=~(dt.TEXTURE_NOFADING&dt.TEXTURE_FADING);continue}++o;const x=X5(e,g);if(x){if(d[g].pendingUpdates&=~(dt.TEXTURE_NOFADING&dt.TEXTURE_FADING),ix(v.layer.parent)){const E=Rz(v.layer.parent);E!=null&&E!==""&&G0e(v.layer.parent,g)}MC(v)?a=Math.max(a,this.tileSize*c):s===1&&T===1&&(v.isOpaque||this._dataToTexture(x)&&x.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,y===null&&(y=g)}}const _=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),n!==0&&y!==null?n===1&&!u&&this._useLayerTexture(e,y,p,eK[y])||this._composeMapLayers(e,r,g-1,p,KQ,tK,a,_,!l||u,hI,u):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=Kh,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=Zf.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=Zf.Delayed);const s=e.renderData;this._backgroundTexture&&s.textureReference==null&&(i=Zf.Immediate),s.setTextureReference(this._backgroundTexture!=null?new q5(this._backgroundTexture,Ns.FADING,rK,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,s){const n=r<i,o=n?1:e.surface.baseOpacity,a=n?e.surface.baseOpacity:1,l=X5(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new q5(l.sourceLayerInfo.data,Ns.FADING,l,o,a,s)),!0)}_composeMapLayers(e,r,i,s,n,o,a,l,c,u,d){this._composition.ensureBuffer(a);const p=e.surface.baseOpacity;let g=!1,y=wt.LINEAR_MIPMAP_LINEAR,_=!1,v=0;for(let x=i;x>=0;x--){const E=X5(e,x);if(!E||n[x]===0&&!d)continue;const O=x<s&&p<1&&!g;this._passParameters.baseOpacity=O?p:1;const A=this._passParameters.baseOpacity<1?Bh.Required:Bh.NotRequired;O&&(g=!0);let $=!1;u.forEach(B=>{B.start===x&&(ab.push(B),this._composition.openGroup(a),$=!0)});const M=v===0,U=$?Xs.GroupBackgroundComposite:c&&M?this.backgroundIsGrid?Xs.GridComposite:Xs.ColorComposite:Xs.Composite,k=Ez[o[x]];for(wXe(E)?(this._passParameters.opacity=n[x],_=this._composition.drawVectorData(this._passParameters,U,a,k,A,E,l,this.tileSize,_)):bXe(E)?(this._passParameters.opacity=n[x],this._composition.drawImageryTileData(this._passParameters,U,a,k,A,E),this._hasNearestInterpolation(E)&&(y=wt.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._passParameters.opacity=n[x],this._composition.drawRasterData(this._passParameters,U,a,k,A));ab.length>0&&ab[ab.length-1].end===x;){const B=ab.pop();this._passParameters.opacity=B.opacity,this._passParameters.offset=Kh,this._passParameters.scale=1;const z=c&&M?this.backgroundIsGrid?Xs.GridComposite:Xs.ColorComposite:Xs.Composite;this._composition.drawGroup(this._passParameters,z,a,Ez[B.blendMode],A)}v++}const w=e.renderData,T=w.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(T),this._composition.unbind(),w.setTextureReference(new q5(T,r,rK,g?1:p,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(TXe(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return xXe(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=wt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const i=new xr;i.wrapMode=Ot.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0;const s=this._rctx;let n;if(typeof e=="number")i.width=i.height=e,n=new Zb(new bt(s,i));else if(e instanceof OD)i.isOpaque=e.isOpaque,n=new Zb(new bt(s,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,n=new Zb(new bt(s,i,e))}catch{n=new Zb(tce(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,bt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,bt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function X5(t,e){Vl.layerIndex=e;const r=t.layerInfo[jt.MAP][e];if(r.data!=null)return Qt(Vl.offset,0,0),Vl.tile=t,Vl.scale=1,Vl.sourceLod=t.lij,Vl.sourceLayerInfo=r,Vl;const i=r.upsampleInfo;if(i!=null){const s=i.tile.layerInfo[jt.MAP][e];return Vl.tile=i.tile,Vs(Vl.offset,i.offset),Vl.scale=i.scale,Vl.sourceLod=i.tile.lij,Vl.sourceLayerInfo=s,Vl}return null}function Rz(t){return t.get("uid")}function V0e(t){let e=t.blendMode!=="normal";return ix(t.parent)&&(e=V0e(t.parent)||e),e}function G0e(t,e){ix(t.parent)&&G0e(t.parent,e);const r=Rz(t);if(r!=null&&r!==""){const i=hI.get(r);i?i.start=e:hI.set(r,new NQe(e,e,t.blendMode,t.opacity))}}const KQ=new Array,eK=new Array,tK=new Array,hI=new Map,ab=new Array,Vl={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},rK={offset:[0,0],scale:1},j0e=200,Z5=40,UQe=.8,zQe=10,US=1e-6;function kQe(t,e,r){const i=e,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(s[a]<=US)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-US){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(i[a]>l){if(s[a]>=-US)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=US){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let iK=class{constructor(e,r,i,s,n){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}},KG=class Pz{constructor(e,r,i,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=C(),this.bspNodeTree=new Array;const n=i-r,o=n<=H0e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=HQe(e,r,i,s.data,s.stride),l=me(Math.log2(n/Z5),2,zQe),c=(u,d,p)=>{const g=GQe(o,a,u,d),y=d-u;if(y<=Z5){const E=new iK(g,void 0,0,u,d);return this.bspNodeTree.push(E),E}const{axis:_,midValue:v}=jQe(g),w=VQe(o,a,u,d,_,v),T=(E,O)=>{if(p>l)return;const A=O-E;return A<Z5||A>=UQe*y?void 0:c(E,O,p+1)},x=new iK(g,_,v,w.next,w.mid);return this.bspNodeTree.push(x),x.leftNode=T(u,w.next),x.rightNode=T(w.mid,d),x};c(0,n,0),this.triangleVertexIndices=WQe(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,d=u[0],p=u[1],g=u[2];for(let y=e,_=3*e;y<r;++y){let v=i[_++]*n;const w=s[v++],T=s[v++],x=s[v];v=i[_++]*n;const E=s[v++],O=s[v++],A=s[v];v=i[_++]*n;const $=E-w,M=O-T,U=A-x,k=s[v++]-w,B=s[v++]-T,z=s[v]-x,Y=p*z-B*g,W=g*k-z*d,j=d*B-k*p,Z=$*Y+M*W+U*j;if(Math.abs(Z)<=Number.EPSILON)continue;const R=a-w,I=l-T,N=c-x,V=R*Y+I*W+N*j;if(Z>0){if(V<0||V>Z)continue}else if(V>0||V<Z)continue;const q=I*U-M*N,J=N*$-U*R,K=R*M-$*I,ge=d*q+p*J+g*K;if(Z>0){if(ge<0||V+ge>Z)continue}else if(ge>0||V+ge<Z)continue;const Me=(k*q+B*J+z*K)/Z;if(Me>=0){const pt=this.indices[y]+this.firstTriangleIndex,Tt=EV($,M,U,k,B,z,BQe);this._callback(Me,Tt,pt,!1)}}}Pz.numFacesTested+=r-e}intersectRay(e,r){Pz.numFacesTested=0;const i=Ce(e.r0[0],e.r0[1],e.r0[2]),s=Ce(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<US)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const u=this.bspNodeTree[0];this.intersectRayBSP(u,0,c)}intersectRayBSP(e,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!kQe(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=r,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};KG.numFacesTested=0;const BQe=C(),lb=[1/0,1/0,1/0],cb=[-1/0,-1/0,-1/0];function VQe(t,e,r,i,s,n){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function GQe(t,e,r,i){if(i<=r)return E1(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[r];for(let n=0;n<3;++n)lb[n]=e[s+0+n],cb[n]=e[s+3+n]}for(let s=r+1;s<i;++s){const n=6*t[s];for(let o=0;o<3;++o)lb[o]=Math.min(lb[o],e[n+0+o]),cb[o]=Math.max(cb[o],e[n+3+o])}return E1(lb[0],lb[1],lb[2],cb[0],cb[1],cb[2])}function jQe(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],s=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function HQe(t,e,r,i,s){const n=r-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,u=t[l+1]*s,d=t[l+2]*s;for(let p=0;p<3;++p){const g=i[c+p],y=i[u+p],_=i[d+p];o[6*a+p]=Math.min(g,y,_),o[6*a+3+p]=Math.max(g,y,_)}}return o}function WQe(t,e,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=H0e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const H0e=65535;let _s=class extends uo{constructor(){super(...arguments),this.output=L.Color,this.overlayMode=Qf.Disabled,this.tileBlendInput=dp.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Xe.Terrain}};h([D({count:L.COUNT})],_s.prototype,"output",void 0),h([D({count:Qf.COUNT})],_s.prototype,"overlayMode",void 0),h([D({count:dp.COUNT})],_s.prototype,"tileBlendInput",void 0),h([D()],_s.prototype,"spherical",void 0),h([D()],_s.prototype,"doublePrecisionRequiresObfuscation",void 0),h([D()],_s.prototype,"receiveShadows",void 0),h([D()],_s.prototype,"hasSlicePlane",void 0),h([D()],_s.prototype,"backfaceCullingEnabled",void 0),h([D()],_s.prototype,"textureFadingEnabled",void 0),h([D()],_s.prototype,"renderOccluded",void 0),h([D()],_s.prototype,"hasScreenSpaceReflections",void 0),h([D()],_s.prototype,"hasCloudsReflections",void 0),h([D()],_s.prototype,"invisible",void 0),h([D()],_s.prototype,"tileBorders",void 0),h([D()],_s.prototype,"visualizeNormals",void 0),h([D()],_s.prototype,"screenSizePerspective",void 0),h([D()],_s.prototype,"receiveAmbientOcclusion",void 0),h([D({count:Xe.COUNT})],_s.prototype,"pbrMode",void 0),h([D({constValue:fr.Compressed})],_s.prototype,"normalType",void 0),h([D({constValue:ps.Compressed})],_s.prototype,"textureCoordinateType",void 0),h([D({constValue:!1})],_s.prototype,"highStepCount",void 0),h([D({constValue:!1})],_s.prototype,"useCustomDTRExponentForWater",void 0),h([D({constValue:!1})],_s.prototype,"useFillLights",void 0);const J5=7,qQe=10,Q5=Bs();var Ws;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(Ws||(Ws={}));let al=class extends we{get _isGlobal(){return this._stage.viewingMode===Re.Global}constructor(e){super(e),this.type=Ai.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new _s,this._passParameters=new d0e,this._rctx=null,this._renderDataPool=new po(AJe),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new i0e,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=Ws.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=_i.Occlude}initialize(){const e=[ae.OPAQUE_TERRAIN,ae.TRANSPARENT_TERRAIN,ae.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),CZe()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===Ws.TransparentWithDraped||e===Ws.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return Kg}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?X$:_i.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,dt.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===dt.TEXTURE_FADING?Ns.FADING:Ns.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[jt.ELEVATION])i.pendingUpdates&=~dt.GEOMETRY;e.resetPendingUpdate(dt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=qQe-J5,i=Math.max(0,Math.floor((e.level-r)/J5)*J5);if(this._isGlobal&&i===0)return Va;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=ts.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=ts.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=ts.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new FQe(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=tce(this._rctx)}uninitializeRenderContext(){this._emptyTex=Ue(this._emptyTex),this._tileRenderer=Ue(this._tileRenderer)}intersect(e,r,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==Ws.Opaque)return;const n=YQe,o=XQe;le(n,s,i),se(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===Yn.MIN,d=!!e.results.ground.target,p=R4e(e.verticalOffset),g=e.tolerance;let y,_=u&&a.dist!=null?a.dist:1/0;const v=T=>{const x=T.renderData;if(!(x!=null&&x.vao))return;const E=x.geometry;rL(Q5,E.boundingBox);const O=x.localOrigin;p!=null&&(p.localOrigin=O,p.applyToAabb(Q5));const A=Q5;if(ub[0]=i[0]-O[0],ub[1]=i[1]-O[1],ub[2]=i[2]-O[2],!AV(A,ub,o,g,_))return;const $=(j,Z,R)=>{j.set(this.type,T,Z,R,qa),_=u&&a.dist!=null?a.dist:1/0},M=(j,Z)=>{if(Z!=null&&j>=0&&(e.options.backfacesTerrain||pe(Z,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,s,j))){if((c.dist==null||j<c.dist)&&$(c,j,Z),e.options.isFiltered)return;e.options.store===Yn.ALL&&(y==null?(y=eV(e.ray),$(y,j,Z),e.results.all.push(y)):j<y.dist&&$(y,j,Z)),(a.dist==null||j<a.dist)&&$(a,j,Z),e.options.store!==Yn.MIN&&(l.dist==null||j>l.dist)&&$(l,j,Z)}},U=ZQe;le(U,s,O);const k=E.indices,B=E.vertexAttributes,z=B.getField(S.POSITION,Os),Y=new Le(z.typedBuffer,3,!1,B.stride/4),W=E.indexCount/3;if(!p&&W>j0e){const j=T.renderData;j.intersectionData==null&&(j.intersectionData=new KG(k,0,W,Y)),j.intersectionData.intersectRay({r0:ub,r1:U},M)}else _A(ub,U,0,W,k,Y,null,p,M)},w=this._rootTiles;w!=null&&(()=>{const T=this._tileIterator;T.reset(w);const x=e.options.invisibleTerrain;for(let E=T.next();E;E=T.next())!(E.visible||x&&E.intersectsClippingArea)||p==null&&!E.intersectsRay(i,n,g,_)||d&&this._useStencilForTile(E)?T.skipSubtree():v(E)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const s of this._patchGroups.values())for(const n of s)((i=n.renderData)==null?void 0:i.textureReference)!=null&&e.queriesForTile(n);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===ae.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&X$))return null}else{const r=this.transparency===Ws.Opaque?ae.OPAQUE_TERRAIN:ae.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case L.Color:return this.transparency===Ws.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?Qf.Disabled:this._overlayRenderer.hasWater?Qf.EnabledWithWater:Qf.Enabled,this._updateTechnique(L.Color,e.bindParameters.slot===ae.OCCLUDED_TERRAIN));case L.Shadow:case L.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Shadow,!1)):null;case L.Depth:return this.transparency===Ws.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Depth,!1));case L.Normal:return this.transparency===Ws.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Normal,!1));case L.ObjectAndLayerIdColor:return this.transparency===Ws.Empty?null:this._updateTechnique(L.ObjectAndLayerIdColor,!1);case L.Highlight:return this.transparency!==Ws.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case L.Color:{const s=e.bindParameters.slot===ae.OCCLUDED_TERRAIN?Da.Occluded:Da.ColorAndWater;this.transparency===Ws.Opaque?this._renderMaterialPass(e,r,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case L.Depth:case L.Normal:this._renderAuxiliaryPass(e,r,Da.None);break;case L.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,Da.Highlight);break;case L.Shadow:case L.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,Da.None);break;case L.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Da.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:s}=e;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const s=e.rctx;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i=null;if(e!=null){const s=ht.toUnitRGBA(e);i=Ce(s[0]||0,s[1]||0,s[2]||0)}r.setBackground(i),this._allTiles.forAll(s=>r.updateTileTexture(s,Ns.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?dp.GridComposite:r.backgroundColor!=null?dp.ColorComposite:dp.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==Vx.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)s0e(this.renderOrder,i,r);e.sort((i,s)=>n0e(i[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(e!=null){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),s=i.renderData;if(!s){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const n=s.localOrigin;let o=this._patchGroups.get(n);o||(o=new Array,this._patchGroups.set(n,o)),o.push(i),(!this._highestVisibleLODTile||i.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;r.program.bindDraw(new iz(o),e.bindParameters,this._passParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,r,n[a],vt.TRIANGLES,s,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const s=e.bindParameters.camera,n=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const d=Lhe(this._stage.viewingMode,this._ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;d.update({distance:p,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===Da.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",Va),n.setUniform4fv("texOffsetAndScale",gp));const l=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:Va;this._techniqueConfiguration.tileBlendInput===dp.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?vt.LINES:vt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const u=this._patchGroups;for(const d of u.values()){const p=d[0].renderData.localOrigin;r.program.bindDraw(new iz(p),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const g of d){const y=g.renderData,_=y.textureReference;if(_!=null){if(!a){n.setUniform4fv("texOffsetAndScale",_.offsetAndScale),n.bindTexture("tex",_.texture.texture);const v=y.textureFadeFactor,w=v<1?y.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&w!=null&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",w.offsetAndScale),n.setUniform3fv("nextTexOpacities",w.opacities),n.bindTexture("texNext",w.texture.texture)):n.setUniform1f("fadeFactor",1),y.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,r,g,c,o,i),g.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,s,n,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(c==null)return void(ks&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const u=r.program;o===Da.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),n&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const d=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(p0e,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};h([f({constructOnly:!0})],al.prototype,"_overlayRenderer",void 0),h([f({constructOnly:!0})],al.prototype,"_stage",void 0),h([f({readOnly:!0})],al.prototype,"_isGlobal",null),h([f({constructOnly:!0})],al.prototype,"_allTiles",void 0),h([f({constructOnly:!0})],al.prototype,"_ellipsoidRadius",void 0),h([f({value:!1})],al.prototype,"renderingDisabled",null),h([f()],al.prototype,"renderPatchBorders",null),h([f()],al.prototype,"visualizeNormals",null),h([f()],al.prototype,"cullBackFaces",null),h([f({value:Vx.FRONT_TO_BACK})],al.prototype,"renderOrder",null),h([f()],al.prototype,"wireframe",null),al=h([F("esri.views.3d.terrain.TerrainRenderer")],al);const YQe=C(),XQe=C(),ub=C(),ZQe=C();let JQe=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Wd=class extends we{constructor(e){super(e),this._handles=new Oi}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ce(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Oe(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!QS(r)||r.isRejected())&&!(r.isFulfilled()&&!QQe(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||nI(r)))),e)if(e.isResolved()){const r=PD(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new xl(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===Re.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=xl.makeWebMercatorAuxiliarySphere(r):M1(e.spatialReference)&&(e=xl.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ce(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Re.Global){const e=this.extentHelper.viewSpatialReference,r=M1(e)||Lp(e)||Dp(e);e.isWebMercator?this.tilingScheme=xl.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=xl.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||r1(e,this.extent)||(this.tilingScheme=xl.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function QQe(t,e,r){return PD(t,e,r)!=null}h([f()],Wd.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],Wd.prototype,"extent",void 0),h([f({value:!1})],Wd.prototype,"tilingSchemeLocked",void 0),h([f({constructOnly:!0})],Wd.prototype,"viewSpatialReference",void 0),h([f({constructOnly:!0})],Wd.prototype,"layers",void 0),h([f({constructOnly:!0})],Wd.prototype,"extentHelper",void 0),h([f({constructOnly:!0})],Wd.prototype,"viewingMode",void 0),Wd=h([F("esri.views.3d.terrain.TilingSchemeLogic")],Wd);let KQe=class{constructor(){this.offset=Ie(),this.scale=0,this.tile=null}init(e,r,i,s){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},Ft=class extends ys.EventedMixin(we){constructor(e){var r,i;super(e),this._scaleRangeQueries=new YP,this._iteratorPool=new po(i0e,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new MZe,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new JQe,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=C(),this._eyePosSurfaceSR=C(),this._splitLimits=new gh,this._frustum=hC(),this._viewProjectionMatrix=xe(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Oi,this._watchUpdatingTracking=new mp,this._frameTask=vx,this._allTiles=new Nt,this._upsampleInfoPool=new po(KQe),this._rootTilesExtent=Ut(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=yt.WebMercator,this.visibleElevationBounds=new Tw(1/0,-1/0),this.rootTileElevationBounds=new Tw(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new Ko({...e,surface:this}),this._isGlobal=!((i=(r=e.view)==null?void 0:r.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=rZe(this.view.resourceController),this._tilePool=this.view.state.isLocal?new po(GJe):new po(HJe);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",o=>o.unloadMapData()),this._elevationQueryCache=new eZe(e.newCache("elevation-query")),this._handles.add([ce(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),ce(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),ce(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new al({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Cr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([ce(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Ns.UNFADED:Ns.IMMEDIATE)},Ss),ce(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Ns.UNFADED:Ns.IMMEDIATE),Ss),ce(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},Nr),ce(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},Ss),ce(()=>this.snapLevel,()=>this._viewChanged=!0,Nr),ce(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),ce(()=>kr.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?he(()=>import("./TerrainTileTree3DDebugger-ccbda5dd.js"),["assets/TerrainTileTree3DDebugger-ccbda5dd.js","assets/TileTreeDebugger-842c5f90.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&kr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=Oe(this._treeDebugger))},Tr)]);const{spatialReference:r}=this.view;this._extentHelper=_Ze(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new YE({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),s=new Wd({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",s),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(op.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(op.BASEMAP);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(nt.TERRAIN_SURFACE,this),this._handles.add([ce(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Tr),ce(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Nr),ce(()=>this.extent,()=>this._updateRootTiles(),Tr),this.view.on("resize",()=>this._viewChangeUpdate()),ce(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),Ss),ce(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,Tr),ce(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?Xe.Terrain:Xe.Disabled,Tr),ce(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Nr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=vi(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Oe(this._upsampleMapCache),this._elevationQueryCache=Oe(this._elevationQueryCache),this._set("tilingSchemeLogic",Oe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Oe(this.overlayManager)),this._tilePool=Oe(this._tilePool),VG.prune(),this._treeDebugger=Oe(this._treeDebugger),this._renderer=Oe(this._renderer),this._iteratorPool=Oe(this._iteratorPool),this._set("view",null),this._extentHelper=Oe(this._extentHelper),this._upsampleInfoPool=Oe(this._upsampleInfoPool),pZe(),oJe()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,r;if(this.lodSnapping===SE.ON){const i=this.view,s=this.tilingScheme,n=(r=(e=i.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:r.scale;if(s&&n){const o=i.state.contentCamera;let a=KL(i,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=s.levelAtScale(n)-l,u=Math.min(c,this._splitLimits.maxLod||1/0);return u<=0?null:u}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?SE.ON:SE.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(r==null||e==null)return null;const i=Ut(),s=Fge(r,i,e)?i:null,n=this._get("extent");return r1(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=u6(this.groundExtent,this._userClippingExtent,Ut()),r=this._get("extent");return r1(e,r)?r:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){var e,r;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(e=this._watchUpdatingTracking)!=null&&e.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(r=this.overlayManager)!=null&&r.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var e,r,i;return((i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity)??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}get wireframe(){var e;return(e=this._renderer)==null?void 0:e.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===Ws.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,s){this._renderer.intersect(e,r,i,s)}getElevation(e,r,i,s){const n=this._rootTiles;if(n==null||!n.length||n[0].layerInfo[jt.ELEVATION].length===0)return null;const o=Sa;return o[0]=e,o[1]=r,o[2]=i,wn(o,s,o,this._spatialReference)?nK(n,o[0],o[1]):(ne.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const s=this._rootTiles,n=s?s[0].layerInfo[jt.ELEVATION].length:0;if(s!=null&&s.length&&n!==0)for(let o=0;o<r;++o){const a=3*o;i(o,nK(s,e[a],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!bo(e,Sa,this.spatialReference))return ne.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(r!=null){for(const i of r)if(i!=null&&i.containsPoint(Sa)){let s=i;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let o=0;Sa[0]>n[2]&&(o+=1),Sa[1]<n[1]&&(o+=2),s=s.children[o]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}getSphereElevationBounds(e,r){var a;if(Sa[0]=e[0],Sa[1]=e[1],Sa[2]=e[2],Sa[3]=e[3],!wn(Sa,r,Sa,(a=this.tilingScheme)==null?void 0:a.spatialReference))return ne.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,s=-1/0;const n=l=>{if(l&&_H(l.extent,Sa))if(l.isLeaf||l.rendered)i=Math.min(i,l.elevationBounds[0]),s=Math.max(s,l.elevationBounds[1]);else for(const c of l.children)n(c)},o=this._rootTiles;if(o!=null)for(const l of o)n(l);return{min:i,max:s}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!bo(e,Sa,this.spatialReference))return ne.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Sa[3]=r;let i=null;const s=o=>{if(o&&_H(o.extent,Sa)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)s(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},n=this._rootTiles;if(n!=null)for(const o of n)s(o);return i}queryVisibleScaleRange(e,r,i,s){const n=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+a,o+a,s)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,s=this._allSurfaceLayersTransparent()?r?Ws.Empty:Ws.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Ws.Opaque:Ws.Semitransparent,n=i!==s;return n&&(this._renderer.transparency=s,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){var i,s,n;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;ep(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((s=(i=this.view)==null?void 0:i.state)!=null&&s.isLocal),this.tilingScheme&&this._removeAllTiles();const r=(e==null?void 0:e.spatialReference)??yt.WebMercator;this._spatialReference=r,this._isWebMercator=!!(r!=null&&r.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&Tk((n=this.view)==null?void 0:n.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,s){const n=this._tilePool.acquire();return aR[0]=e,aR[1]=r,aR[2]=i,n.init(aR,s,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=rKe;let s=r.rootTilesInExtent(e,i,5*hw);if(this._rootTiles!=null){if(s.length>hw)return void ne.getLogger(this.declaredClass).warn(BPe);const n=this._rootTiles.map(a=>a.lij),o=d1e(n,s,sK);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>sK(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,s.length>hw&&(ne.getLogger(this.declaredClass).warn(VPe),s=r.rootTilesInExtent(e,i,hw)),this._setRootTiles(s.map(n=>this._newRootTile(n)));r1(i,this._rootTilesExtent)||(this._rootTilesExtent=Ut(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Jf);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===dt.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(dt.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(dt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const r=UZe(e),i=this.visibleElevationBounds;let s=r?i.min:1/0,n=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(dt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(dt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(s=Math.min(c.elevationBounds[0],s),n=Math.max(c.elevationBounds[1],n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(i.min!==s||i.max!==n)&&(this.visibleElevationBounds=new Tw(s,n))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBounds:n})=>{e=Math.min(e,n[0]),r=Math.max(r,n[1])});const s=this.rootTileElevationBounds;s.min===e&&s.max===r||(this.rootTileElevationBounds=new Tw(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),s=Math.tan(.5*r.fovY),n=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=hC()),h$(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,h$(this._frustum,e.frustum),qi(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),te(this._eyePosRenderSR,r.eye),wn(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(W0e(e)?this._loadChildren(e):tKe(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(dt.TEXTURE_FADING)?dt.TEXTURE_FADING:!!e.resetPendingUpdate(dt.TEXTURE_NOFADING)&&dt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=eF.extent;Au(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>b0(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),eF.spatialReference=this.spatialReference,this.emit("elevation-change",eF)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(s,n,i);if(a!==dt.SPLIT){if(o.resetPendingUpdate(dt.SPLIT)&&o.updateAgentSuspension(),a===dt.ELEVATION&&o.updateAgents(jt.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(dt.MERGE),o.resetPendingUpdate(dt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let u=l.next();!l.done;u=l.next())this._updateClippingStatus(u),u.updateVisibility(),u.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(dt.MERGE),o.isLeaf&&(o.setPendingUpdate(dt.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(dt.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(NZe(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){ve(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea),i=(n,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<n.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(Jf);const s=r.length;for(let n=0;n<s;++n){const o=r[n];ve(o.isLoaded),ve(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData.cornerPeerNeighbors,u=d=>{var g;const p=IC[d];i(o,(g=c[d])==null?void 0:g.findCorner(aI(p),y=>y.isLoaded))};for(let d=0;d<4;++d)if(l&1<<d){const p=a.geometryState.neighborData.edgePeerNeighbors[d];p&&(p==null?void 0:p.level)>=o.level&&p.forAllSubtreeOnSide(lI(hp[d]),g=>!(!g.isLoaded||!g.intersectsClippingArea)&&(ve(e.has(g)||Jf(o,g)<0),i(o,g),!0)),u((d+1)%4),u(d)}}e.clear(),this._updateTilesGeometries(r),ks&&sI&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let o=!1;const a=!this._allTiles.some(l=>{var u;if(!i&&!s&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(dt.MERGE)){if(!r)return l.setPendingUpdate(dt.MERGE),e.done;for(;(u=c.parent)!=null&&u.resetPendingUpdate(dt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(dt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(dt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(dt.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ts.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*zPe}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=me(e-this._lodBias,0,r.length-1),s=i-Math.floor(i);return r[Math.floor(i)].scale*(1-s)+r[Math.ceil(i)].scale*s}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){ep(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],s=2*e.lij[2];e.setChildren(this._createTile(r,i,s,e),this._createTile(r,i,s+1,e),this._createTile(r,i+1,s,e),this._createTile(r,i+1,s+1,e)),e.setPendingUpdate(dt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){lR.spatialReference=this.spatialReference,lR.extent=e.extent,lR.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",lR)}_createTile(e,r,i,s){ep(!!s,"_createTile sanity check");const n=this._acquireTile(e,r,i,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(dt.SPLIT),n}get shortBatches(){return this.view.state.mode!==vr.IDLE}_mergeTile(e){ep(!e.hasPendingUpdate(dt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(ep(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){ep(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const s=r[i];this._unloadChildren(s),this._unloadTile(s)}}_loadTile(e){e.load(),e.setPendingUpdate(dt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const s=new gZe(e.lij,e.extent,i);e.dataArrived(r,jt.ELEVATION,s);const n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=la){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let s=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),$C(n)||vT(n))if(this._basemapLayerViewHandles.has(n.uid)&&!vT(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<s||s==null)&&(r=!0),s=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((n,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var r,i;let e=((i=(r=this.view.map)==null?void 0:r.ground)==null?void 0:i.opacity)===0;for(const s of this.view.allLayerViews.items)if(bz(s)&&!Qre(s.layer)&&s.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((oI(e)||vT(e))&&jZe(Ez[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return vz(e)?jt.ELEVATION:jt.MAP}_registerTiledLayerView(e){const r=[];if((oI(e)||vT(e))&&r.push(ce(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Ns.UNFADED)})),!vT(e)){const i=this._layerClassFromLayerView(e);r.push(ce(()=>e.suspended,()=>this._updateTiledLayers())),r.push(ce(()=>e.fullOpacity,()=>this._updateTileTextures(Ns.UNFADED))),r.push(ce(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),r.push(e.on("data-changed",()=>{const s=this._getLayerIdxByUID(i,e.uid);s!=null&&this._invalidateLayerData(s,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(const i of r)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(s=>{if(!s.layer||s.suspended||!$C(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===jt.MAP){const o=s.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[n].push(s)});for(const s of A_){const n=this._layerViews[s],o=r[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),u=new Array(n.length);this._layerIndexByUid[s].clear();for(let d=0;d<a;d++){const p=o[d].uid;this._layerIndexByUid[s].set(p,d);const g=n.indexOf(o[d]);c[d]=g,d!==g&&(l=!0),g>-1&&(u[g]=d)}if(l){const d=this._postorderIterator;for(d.reset(this._rootTiles);!d.done;)d.next().modifyLayers(u,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===jt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(jt.MAP),e===Ns.IMMEDIATE?this.renderer.updateTileTexture(r,dt.TEXTURE_NOFADING):r.updateRenderData(jt.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=ts.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,s){const n=this.layerViewByIndex(r,i),o=n.layer;return!o.tilemapCache||MC(n)?this._requestTileData(e,i,n,s):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,qt(s),gs(a)||this._dataMissing(e,i,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,n,s),s.signal)))}_requestTileData(e,r,i,s){return r===jt.ELEVATION?vz(i)?this._requestElevationTileData(e,i,s):Promise.reject():bz(i)?this._requestMapTileData(e,i,s):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const s=a=>{if(Js(i))return;const l=this._layerIndexByUid[jt.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):ne.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",jt.ELEVATION,e.lij.toString())},n=a=>{gs(a)||(this._dataMissing(e,jt.ELEVATION,r,a),this.requestUpdate())};if(SQ(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:nC,signal:i.signal}).then(a=>{if(!Js(i))return this._frameTask.schedule(()=>s(a),i.signal,n);ne.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:nC},i.signal)).then(a=>{a?s(new tZe(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const s=(u,d)=>{--this._asyncWorkItems,Gw(d),Js(i)||(this._dataMissing(e,jt.MAP,r,u),this.requestUpdate())},n=u=>d=>s(d,u),o=u=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Js(i)?Gw(u):this._mapTileDataArrived(e,r,u)},i.signal,n(u)).catch(n(u)),a=(u,d=null)=>this._frameTask.schedule(()=>s(u,d));if(MC(r)){const u=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(u[0],u[1],u[2],i).then(o,a)}if(RD(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(FG(r)&&SQ(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(u=>{if(Js(i))return ne.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(wr());o(u)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);KXe(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const s=this._getLayerIdxByUID(jt.MAP,r.uid);s!=null?e.dataArrived(s,jt.MAP,i):(Gw(i),ne.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,s){const n=this._getLayerIdxByUID(r,i.uid);n!=null?e.dataMissing(n,r,s):ne.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=0;const i=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(i,e.uid);return s!=null&&this._allTiles.forAll(n=>r+=n.getUsedMemoryForLayer(i,s)),r}getTile(e){if(e==null||this._rootTiles==null)return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],s=Math.floor(r[1]/i),n=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===s&&a.lij[2]===n&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return ep(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){K5.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&K5.push(i)});const r=K5.toArray();return s0e(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!sI)return;const e=this._rootTiles;if(e==null)return;const r=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometry)==null?void 0:l.indices)==null?void 0:c.length)>0},i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},s=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometry&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometry)||(((l=o.renderData.geometry.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometry),r(o)){o.checkGeometryWaterproofness();for(const c of o.children)i(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)s(c)},n=o=>{var u;const a=((u=o.parent)==null?void 0:u.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const d of o.children)n(d)};for(const o of e)s(o),n(o)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const s=(i+(i<0?r:0))%r;return[e[0],e[1],s]}enableInternalChecks(e){vXe(e)}enableWaterproofnessChecks(e){_Xe(e)}};h([f()],Ft.prototype,"_renderer",void 0),h([f({constructOnly:!0})],Ft.prototype,"_scaleRangeQueries",void 0),h([f({constructOnly:!0})],Ft.prototype,"view",void 0),h([f({constructOnly:!0})],Ft.prototype,"overlayManager",void 0),h([f()],Ft.prototype,"_hasPendingUpdates",void 0),h([f()],Ft.prototype,"_asyncWorkItems",void 0),h([f()],Ft.prototype,"_allTilesDirty",void 0),h([f()],Ft.prototype,"_allTilesSorted",void 0),h([f()],Ft.prototype,"_viewChanged",void 0),h([f()],Ft.prototype,"_splitLimits",void 0),h([f({readOnly:!0})],Ft.prototype,"_watchUpdatingTracking",void 0),h([f()],Ft.prototype,"_frameTask",void 0),h([f({readOnly:!0})],Ft.prototype,"snapLevel",null),h([f({readOnly:!0})],Ft.prototype,"lodSnapping",null),h([f()],Ft.prototype,"_userClippingExtent",null),h([f()],Ft.prototype,"_rootTilesExtent",void 0),h([f({readOnly:!0})],Ft.prototype,"extent",null),h([f({readOnly:!0})],Ft.prototype,"groundExtent",null),h([f({readOnly:!0})],Ft.prototype,"_tilingSchemeExtent",null),h([f({readOnly:!0})],Ft.prototype,"updating",null),h([f({readOnly:!0})],Ft.prototype,"running",null),h([f(fZe)],Ft.prototype,"updatingProgress",void 0),h([f({readOnly:!0})],Ft.prototype,"updatingProgressValue",null),h([f()],Ft.prototype,"_maxNumUpdating",void 0),h([f()],Ft.prototype,"baseOpacity",null),h([f()],Ft.prototype,"hasCompositeBlendMode",void 0),h([f({readOnly:!0})],Ft.prototype,"viewingMode",null),h([f()],Ft.prototype,"maxTextureScale",void 0),h([f({readOnly:!0})],Ft.prototype,"ready",null),h([f({value:Vx.FRONT_TO_BACK})],Ft.prototype,"renderOrder",null),h([f({readOnly:!0})],Ft.prototype,"rootTiles",null),h([f()],Ft.prototype,"_rootTiles",void 0),h([f({readOnly:!0})],Ft.prototype,"spatialReference",null),h([f({type:ht})],Ft.prototype,"backgroundColor",null),h([f({value:!1})],Ft.prototype,"slicePlaneEnabled",null),h([f({readOnly:!0})],Ft.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],Ft.prototype,"tilingSchemeLocked",null),h([f({readOnly:!0})],Ft.prototype,"tilingSchemeLogic",void 0),h([f()],Ft.prototype,"wireframe",null),h([f({value:!1})],Ft.prototype,"suspended",null),h([f()],Ft.prototype,"textureFadeDuration",null),h([f()],Ft.prototype,"visibleElevationBounds",void 0),h([f()],Ft.prototype,"rootTileElevationBounds",void 0),h([f()],Ft.prototype,"_layerViewsDirty",void 0),h([f()],Ft.prototype,"renderPatchBorders",null),h([f()],Ft.prototype,"visualizeNormals",null),h([f()],Ft.prototype,"renderingDisabled",null),Ft=h([F("esri.views.3d.terrain.TerrainSurface")],Ft);const eKe=Ft;function sK(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function W0e(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(W0e(r))return!0;return!1}function tKe(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const Sa=Ht(),rKe=Ut(),aR=[0,0,0],K5=new Nt,eF={spatialReference:null,extent:Ut(),context:"ground"},lR={spatialReference:null,extent:null,scale:0};function nK(t,e,r){var i;for(const s of t){if(!s.containsPointXY(e,r))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(r<n.extentMidY?2:0);n=n.children[a]}const o=((i=n==null?void 0:n.renderData)==null?void 0:i.geometryState.samplerData)??null;return Ii(e,r,o)}return null}let iKe=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},zS=class extends we{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},u)=>{let d=!1;if(l===Mi.UPDATE){const p=o.get(u);if(p){if(c&Ys.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,a,p)&&(d=!0)}d||r.updates.push({renderGeometry:p,updateType:c})}else He(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===Mi.REMOVE||d){const p=o.get(u);p?(r.removes.push(p),o.delete(u)):l===Mi.REMOVE&&He(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===Mi.ADD||d){const p=this.model.getObject(n);if(p!=null){const g=this.model.getRenderGeometry(p,a);r.adds.push(g),o.set(u,g)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(s=>s.forEach(n=>r.push(n)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,Mi.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Ys.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Ys.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Ys.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,Mi.UPDATE,Ys.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryAdded(r,s,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryRemoved(r,s,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,r,Mi.UPDATE,Ys.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Mi.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Mi.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,s,n=Ys.NONE){i=i??this._getParentLayerId(e);const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const u=c.operation;u===Mi.REMOVE&&s===Mi.ADD&&c.states!==Ys.NONE?c.operation=Mi.UPDATE:u===Mi.REMOVE&&s===Mi.ADD||u===Mi.ADD&&s===Mi.REMOVE?l.delete(a):u!==Mi.UPDATE||s!==Mi.REMOVE&&s!==Mi.UPDATE?(He((u===Mi.REMOVE||u===Mi.ADD)&&s===Mi.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(a,new iKe(s,r,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}get _hasDirtyGeometryRecords(){return ao(this._dirtyGeomRecords,e=>ao(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:hve}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,s)=>{i.forEach((n,o)=>{r.length>0&&(r+=`
`),r+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,s)=>e.commitLayer(s,r))}}};h([f({constructOnly:!0})],zS.prototype,"model",void 0),h([f()],zS.prototype,"dirty",void 0),zS=h([F("esri.views.3d.webgl-engine.lib.ModelDirtySet")],zS);const sKe=zS;let ZP=class extends we{constructor(){super(...arguments),this.dirtySet=new sKe({model:this}),this._content=new Map,this._originFactory=new oG(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;He(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),j$(e)&&this.dirtySet.layerAdded(e)}remove(e){He(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),j$(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)r!=null&&(He(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)He(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:s}=r,n=new kx(r,{shaderTransformer:i,castShadow:e.castShadow});return n.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),n.localOrigin=s??this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.updateTransformation(n=>e.getCombinedStaticTransformation(r,n));const s=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==s}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<Wi.COUNT;++i)e[i]=r.filter(s=>s.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};h([f({constructOnly:!0})],ZP.prototype,"dirtySet",void 0),ZP=h([F("esri.views.3d.webgl-engine.parts.Model")],ZP);function nKe(){const t=new Float32Array(4);return t[3]=1,t}function q0e(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function oKe(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Y0e(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:q0e,create:nKe,createView:Y0e,fromValues:oKe},Symbol.toStringTag,{value:"Module"}));const Gx=1e-6,ST=[0,0,0],cR=[0,0,0];function aKe(t,e){const{data:r,size:i}=t,s=r.length/i;if(s<=0)return;const n=new gKe(t);JP(ST,n.minProj,n.maxProj),j_(ST,ST,.5),hu(cR,n.maxProj,n.minProj);const o=Mz(cR),a=new yKe;a.quality=o,s<14&&(t=new Le(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[0,0,0],p=[0,0,0],g=[0,0,0],y=[0,0,0];switch(lKe(n,t,y,l,c,u,d,p,g,a)){case 1:return void cK(ST,cR,e);case 2:return void mKe(t,d,e)}cKe(t,y,l,c,u,d,p,g,a),X0e(t,a.b0,a.b1,a.b2,Ww,qw);const _=[0,0,0];hu(_,qw,Ww),a.quality=Mz(_),a.quality<o?Z0e(a.b0,a.b1,a.b2,Ww,qw,_,e):cK(ST,cR,e)}function lKe(t,e,r,i,s,n,o,a,l,c){return uKe(t,i,s),$z(i,s)<Gx?1:(hu(o,i,s),io(o,o),hKe(e,i,o,n)<Gx?2:(hu(a,s,n),io(a,a),hu(l,n,i),io(l,l),du(r,a,o),io(r,r),O_(e,r,o,a,l,c),0))}const ET=[0,0,0],CT=[0,0,0],Dc=[0,0,0],Nc=[0,0,0],Fc=[0,0,0],ag=[0,0,0],lg=[0,0,0],cg=[0,0,0];function cKe(t,e,r,i,s,n,o,a,l){dKe(t,e,r,ET,CT),ET[0]!==void 0&&(hu(Dc,ET,r),io(Dc,Dc),hu(Nc,ET,i),io(Nc,Nc),hu(Fc,ET,s),io(Fc,Fc),du(ag,Nc,n),io(ag,ag),du(lg,Fc,o),io(lg,lg),du(cg,Dc,a),io(cg,cg),O_(t,ag,n,Nc,Dc,l),O_(t,lg,o,Fc,Nc,l),O_(t,cg,a,Dc,Fc,l)),CT[0]!==void 0&&(hu(Dc,CT,r),io(Dc,Dc),hu(Nc,CT,i),io(Nc,Nc),hu(Fc,CT,s),io(Fc,Fc),du(ag,Nc,n),io(ag,ag),du(lg,Fc,o),io(lg,lg),du(cg,Dc,a),io(cg,cg),O_(t,ag,n,Nc,Dc,l),O_(t,lg,o,Fc,Nc,l),O_(t,cg,a,Dc,Fc,l))}function uKe(t,e,r){let i=$z(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=$z(t.maxVert[n],t.minVert[n]);o>i&&(i=o,s=n)}Ol(e,t.minVert[s]),Ol(r,t.maxVert[s])}const Uc=[0,0,0];function hKe(t,e,r,i){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Uc[0]=s[l]-e[0],Uc[1]=s[l+1]-e[1],Uc[2]=s[l+2]-e[2];const c=r[0]*Uc[0]+r[1]*Uc[1]+r[2]*Uc[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],d=Uc[0]*Uc[0]+Uc[1]*Uc[1]+Uc[2]*Uc[2]-c*c/u;d>o&&(o=d,a=l)}return Ol(i,s,a),o}const qs=[0,0];function dKe(t,e,r,i,s){fKe(t,e,qs,s,i);const n=Q0e(r,e);qs[1]-Gx<=n&&(i[0]=void 0),qs[0]+Gx>=n&&(s[0]=void 0)}const oK=[0,0,0],aK=[0,0,0],lK=[0,0,0],hb=[0,0,0],db=[0,0,0],uR=[0,0,0];function O_(t,e,r,i,s,n){if(J0e(e)<Gx)return;du(oK,r,e),du(aK,i,e),du(lK,s,e),Hw(t,e,qs),db[1]=qs[0],hb[1]=qs[1],uR[1]=hb[1]-db[1];const o=[r,i,s],a=[oK,aK,lK];for(let l=0;l<3;++l){Hw(t,o[l],qs),db[0]=qs[0],hb[0]=qs[1],Hw(t,a[l],qs),db[2]=qs[0],hb[2]=qs[1],uR[0]=hb[0]-db[0],uR[2]=hb[2]-db[2];const c=Mz(uR);c<n.quality&&(Ol(n.b0,o[l]),Ol(n.b1,e),Ol(n.b2,a[l]),n.quality=c)}}const pKe=[0,0,0];function Hw(t,e,r){const{data:i,size:s}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*e[0]+i[n+1]*e[1]+i[n+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function fKe(t,e,r,i,s){const{data:n,size:o}=t;Ol(i,n),Ol(s,i),r[0]=Q0e(pKe,e),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<r[0]&&(r[0]=l,Ol(i,n,a)),l>r[1]&&(r[1]=l,Ol(s,n,a))}}function cK(t,e,r){Ol(r.center,t),j_(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const of=[0,0,0],pb=[0,0,0],AT=[0,0,0],Ww=[0,0,0],qw=[0,0,0],uK=[0,0,0];function mKe(t,e,r){Ol(of,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?of[0]=0:Math.abs(e[1])>Math.abs(e[2])?of[1]=0:of[2]=0,J0e(of)<Gx&&(of[0]=of[1]=of[2]=1),du(pb,e,of),io(pb,pb),du(AT,e,pb),io(AT,AT),X0e(t,e,pb,AT,Ww,qw),hu(uK,qw,Ww),Z0e(e,pb,AT,Ww,qw,uK,r)}function X0e(t,e,r,i,s,n){Hw(t,e,qs),s[0]=qs[0],n[0]=qs[1],Hw(t,r,qs),s[1]=qs[0],n[1]=qs[1],Hw(t,i,qs),s[2]=qs[0],n[2]=qs[1]}const hR=[0,0,0],Ad=[1,0,0,0,1,0,0,0,1],fb=[0,0,0];function Z0e(t,e,r,i,s,n,o){Ad[0]=t[0],Ad[1]=t[1],Ad[2]=t[2],Ad[3]=e[0],Ad[4]=e[1],Ad[5]=e[2],Ad[6]=r[0],Ad[7]=r[1],Ad[8]=r[2],_Ke(o.quaternion,Ad),JP(fb,i,s),j_(fb,fb,.5),j_(o.center,t,fb[0]),j_(hR,e,fb[1]),JP(o.center,o.center,hR),j_(hR,r,fb[2]),JP(o.center,o.center,hR),j_(o.halfSize,n,.5)}const Gl=7;let gKe=class{constructor(e){this.minVert=new Array(Gl),this.maxVert=new Array(Gl);const r=64*Gl;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Gl),i+=8*Gl,this.maxProj=new Float64Array(this.buffer,i,Gl),i+=8*Gl;for(let l=0;l<Gl;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Gl;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Gl;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Gl),n=new Array(Gl),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Gl;++l){let c=s[l];Ol(this.minVert[l],o,c),c=n[l],Ol(this.maxVert[l],o,c)}}},yKe=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function Mz(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function JP(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function hu(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function j_(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function Ol(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function du(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o}function io(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function J0e(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function $z(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function Q0e(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function _Ke(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*n+n]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+i]+e[3*i+s])*o,t[n]=(e[3*n+i]+e[3*i+n])*o}}const p1=zu(),ia=C(),Iz=C(),vKe=Zi();let lwt=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:Dk(this.buffer,56*a+0),halfSize:ice(this.buffer,56*a+24),quaternion:Y0e(this.buffer,56*a+36)}}};function K0e(t=[0,0,0],e=[-1,-1,-1],r=zu()){return{center:ms(t),halfSize:c$(e),quaternion:q0e(r)}}function hK(t){return K0e(t.center,t.halfSize,t.quaternion)}function uwt(t,e){te(e.center,t.center),te(e.halfSize,t.halfSize),X7(e.quaternion,t.quaternion)}function hwt(t,e){return e=e||K0e(),aKe(t,e),e}function R_(t,e){const r=Kr(e,t.center),i=DD(t,e);return r>i?1:r<-i?-1:0}function dwt(t,e){return ia[0]=t.center[0]-e[0],ia[1]=t.center[1]-e[1],ia[2]=t.center[2]-e[2],B0(p1,t.quaternion),vu(ia,ia,p1),PM(ia,ia),zk(Iz,ia,t.halfSize),jI(Iz,ia)<e[3]*e[3]}function pwt(t,e){e||(e=Bs());const r=I7(vKe,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),s=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),n=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+i,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function fwt(t,e){return Kr(e,t.center)-DD(t,e)}function mwt(t,e){return Kr(e,t.center)+DD(t,e)}function gwt(t,e){return R_(t,e[0])<=0&&R_(t,e[1])<=0&&R_(t,e[2])<=0&&R_(t,e[3])<=0&&R_(t,e[4])<=0&&R_(t,e[5])<=0}function ywt(t,e,r,i=0){B0(p1,t.quaternion),le(ia,e,t.center);const s=vu(ia,ia,p1),n=vu(Iz,r,p1);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+t.halfSize[l]-s[l])/n[l],u=(-i-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,u)),a=Math.min(a,Math.max(c,u))}else if(s[l]>t.halfSize[l]+i||s[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function DD(t,e){B0(p1,t.quaternion),vu(ia,e,p1);const r=t.halfSize;return Math.abs(ia[0]*r[0])+Math.abs(ia[1]*r[1])+Math.abs(ia[2]*r[2])}function _wt(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],vu(i,i,t.quaternion),oe(i,i,t.center)}}function bKe(t){return pl(t.halfSize)}function wKe(t,e,r,i,s){if(X7(s.quaternion,t.quaternion),i===Re.Global){B0(dR,t.quaternion),vu(ug,t.center,dR),PM(mb,ug),zk(gb,mb,t.halfSize),_n(gb,mb,gb);const n=Te(gb);oe(gb,mb,t.halfSize);const o=Te(gb);if(n<r)te(s.center,t.center),se(ug,r,r,r),oe(s.halfSize,t.halfSize,ug);else{const a=o>0?1+e/o:1,l=n>0?1+r/n:1,c=(l+a)/2,u=(l-a)/2;ee(s.halfSize,mb,u),W_(s.halfSize,s.halfSize,t.halfSize,c),ee(s.center,mb,c),W_(s.center,s.center,t.halfSize,u),cie(ug,ug),GI(s.center,s.center,ug),vu(s.center,s.center,s.quaternion)}}else{const n=se(ug,0,0,1);W_(s.center,t.center,n,(r+e)/2),B0(dR,t.quaternion),vu(n,n,dR),PM(n,n),W_(s.halfSize,t.halfSize,n,(r-e)/2)}return s}const ug=C(),mb=C(),gb=C(),dR=zu();let xKe=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=TKe(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!e(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=e[n],l=e[o];r[s]=a,r[s+1]=l-a}return r}};function TKe(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let s=1;s<t.length;s++){const n=t[s];r+i===n?i+=1:(e.push(r),e.push(i),r=n,i=1)}return e.push(r),e.push(i),e}let SKe=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new xKe(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=EKe(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function EKe(t,e,r){const i=[],s=[];let n=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let kS=class extends we{constructor(){super(...arguments),this.visible=Yw.Hidden}};var Yw;h([f({autoDestroy:!0})],kS.prototype,"renderable",void 0),h([f({autoDestroy:!0})],kS.prototype,"components",void 0),kS=h([F("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],kS),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(Yw||(Yw={}));function CKe(t,e,r,i){if(r>=e)return t;t==null&&(t=AKe());const s=t.isVisibleBit;let n=t.data;const o=tye(n),a=r/o|0,l=r-o*a,c=(e-1)/o|0,u=n,d=i===s;if(!(r<u.length*o)&&d){const p=a+1,g=Math.ceil(u.length*AI),y=c+1;let _=Math.max(p,g);_=Math.min(_,y),n=new Uint32Array(_),n.set(u)}return a<n.length&&(n[a]=RKe(n[a],l,d)),t.data=n,t}function eye(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,s=tye(i);return e<i.length*s?OKe(r,i,e,s):!t.isVisibleBit}function AKe(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function OKe(t,e,r,i){const s=r/i|0,n=r-s*i;return PKe(e[s],n)===t}function tye(t){return t.BYTES_PER_ELEMENT*8}function RKe(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function PKe(t,e){return(t&1<<e)!=0}let MKe=class{constructor(e,r){this._components=r,this._indices=e.indices!=null?bp(e.indices):Cx(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,s,n,o,a){const l=new Le(this._positions,3,!1,3),c=this._indices,u=this._components.offsets,d=Zhe(e,r,$Ke),p=e[2],g=r[2];this._components.visibility.forEachComponent(y=>{if(!eye(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,IKe);if(o!=null){const x=o[y];n!=null?n.componentOffset=x:(e[2]=p-x,r[2]=g-x)}if(n!=null&&n.applyToAabb(_),!CV(_,e,d,i))return!0;const v=u[y]/3,w=u[y+1]/3,T=(x,E,O)=>a(y,x,El(E,E,s),O);return n==null&&w-v>j0e?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new KG(this._indices,v,w,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:r},T)):_A(e,r,v,w,c,l,void 0,n,T),!0})}_computePerComponentAabbs(){const e=this._components.count,r=Di(6*e),i=this._indices,s=this._positions,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let u=1/0,d=1/0,p=1/0,g=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const w=3*i[v],T=s[w],x=s[w+1],E=s[w+2];u=Math.min(u,T),d=Math.min(d,x),p=Math.min(p,E),g=Math.max(g,T),y=Math.max(y,x),_=Math.max(_,E)}r[o++]=u,r[o++]=d,r[o++]=p,r[o++]=g,r[o++]=y,r[o++]=_}return r}get positions(){return this._positions}get indices(){return this._indices}};const $Ke=C(),IKe=Bs();let LKe=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},DKe=class{constructor(e,r,i,s){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}},NKe=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function FKe(t,e){return{near:t,far:e}}function IA(t){return t?DC(t,1/0,-1/0):FKe(1/0,-1/0)}function DC(t,e,r){return t.near=e,t.far=r,t}function jx(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function pR(t,e){return t.near<=e&&e<=t.far}const Lz={near:0,far:0};function UKe(t,e){const r=IA(),{eye:i,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=pe(_n(ql,a.center,i),n),c=DD(a,n);if(pR(r,l-c)&&pR(r,l+c))return;const u=GKe(a,s);if(u===-1)return;if(u===0)return af.far=l+c,af.near=l-c,void jx(r,af);const d=fR.pushNew();d.near=l-c,d.far=l+c,d.mask=u,d.object=o});for(let o=0;o<fR.length;o++){const a=fR.data[o];if(pR(r,a.near)&&pR(r,a.far))continue;af.far=a.far,af.near=1/0,VKe(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,zKe,c=>{let u=kKe;for(let d=0;d<rye&&c.length>0;d++){if(!(a.mask&1<<d))continue;BKe(s[d],c,u);const p=c;c=u,u=p}for(let d=0;d<c.length;d+=3){se(Ia,c.data[d],c.data[d+1],c.data[d+2]);const p=pe(_n(Ia,Ia,i),n);af.near=Math.min(af.near,p)}})===0&&(af.near=0),jx(r,af)}return fR.length=0,r}const fR=new Nt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=Wx(t.object),t)}),af=IA(),Ia=C(),Hy=C(),zKe=new Nt({deallocator:null}),kKe=new Nt({deallocator:null});function BKe(t,e,r){r.length=0;const i=e.length-3;tF(Ia,e,i);const s=Kr(t,Ia);s<=0&&(r.push(Ia[0]),r.push(Ia[1]),r.push(Ia[2]));let n=0,o=s;for(;n<i;n+=3){tF(Hy,e,n);const a=Kr(t,Hy);o*a<0&&(Pr(Ia,Hy,Ia,a/(a-o)),La(r,Ia)),a<=0&&La(r,Hy),o=a,te(Ia,Hy)}o*s<0&&(tF(Hy,e,i),Pr(Ia,Hy,Ia,s/(s-o)),La(r,Ia))}function tF(t,e,r){return se(t,e.data[r],e.data[r+1],e.data[r+2])}function La(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function VKe(t,e,r,i){B0(pK,t.quaternion),_n(ql,e,t.center),vu(ql,ql,pK);const s=8*((ql[0]<-t.halfSize[0]?-1:ql[0]>t.halfSize[0]?1:0)+3*(ql[1]<-t.halfSize[1]?-1:ql[1]>t.halfSize[1]?1:0)+9*(ql[2]<-t.halfSize[2]?-1:ql[2]>t.halfSize[2]?1:0)+13),n=dK[s];if(n===0)return n;I7(mR,t.quaternion),$7(mR,mR,t.halfSize);const o=(a,l)=>{const c=dK[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),El(a,a,mR),oe(a,t.center,a)};return r.length=0,La(r,o(rF,0)),La(r,o(fK,1)),La(r,o(ql,2)),La(r,o(mK,3)),i(r),n===1||(r.length=0,La(r,rF),La(r,mK),La(r,o(ql,4)),La(r,o(gK,5)),i(r),n===2||(r.length=0,La(r,rF),La(r,gK),La(r,o(ql,6)),La(r,fK),i(r))),n}const dK=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),rye=4;function GKe(t,e){let r=0;for(let i=0;i<rye;i++){const s=R_(t,e[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const mR=Zi(),pK=zu(),ql=C(),rF=C(),fK=C(),mK=C(),gK=C();let jKe=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?UKe(e,this._objects.visibleObjects):null}};function HKe(t){const e=Ri().vec3f(S.POSITION);return t.normals&&e.vec2i16(S.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===ps.Default?e.vec2f(S.UV0):t.textureCoordinates===ps.Atlas&&(e.vec2f(S.UV0),e.vec4u16(S.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(S.COLOR,{glNormalized:!0}),e}let WKe=class{constructor(){this.externalColor=Ht(),this.externalColorMixMode=Us.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},qKe=class extends Ji{constructor(e,r){super(e,"int",zr.Draw,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};var Tp;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Tp||(Tp={}));const ej=429496.7296;function iye(t,e){vC(t/ej*.5+.5,e)}function YKe(t,e){switch(e.componentData){case Tp.Varying:return XKe(t,e);case Tp.Uniform:return ZKe(t);case Tp.COUNT:return;default:e.componentData}}function XKe(t,e){const{vertex:r,fragment:i}=t;r.include(Ll),r.uniforms.add(new wu("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(S.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===L.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(tme),r.constants.add("elevationScale","float",2*ej),r.constants.add("stride","float",ie("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(b`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(b`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?b`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:b`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(b`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?b`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function ZKe(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new cI("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new qKe("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(b`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(b`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var mu;function JKe(t,e){const r=t.vertex;switch(r.code.add(b`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case mu.None:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) {}`);break;case mu.Opaque:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case mu.Transparent:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(mu||(mu={}));var Sp;function Rwt(t){return t&&Lp(t)?Sp.Mars:t&&Dp(t)?Sp.Moon:Sp.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Sp||(Sp={}));var oc;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(oc||(oc={}));let rr=class extends Bo{constructor(){super(...arguments),this.output=L.Color,this.textureCoordinateType=ps.None,this.componentData=Tp.Uniform,this.cullFace=ti.Back,this.vertexDiscardMode=mu.None,this.doubleSidedMode=Ni.WindingOrder,this.alphaDiscardMode=Fr.Opaque,this.integratedMeshMode=oc.None,this.transparencyPassType=Ze.NONE,this.ellipsoidMode=Sp.Earth,this.pbrMode=Xe.Disabled,this.normalType=fr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};h([D({count:L.COUNT})],rr.prototype,"output",void 0),h([D({count:ps.COUNT})],rr.prototype,"textureCoordinateType",void 0),h([D({count:Tp.COUNT})],rr.prototype,"componentData",void 0),h([D({count:ti.COUNT})],rr.prototype,"cullFace",void 0),h([D({count:mu.COUNT})],rr.prototype,"vertexDiscardMode",void 0),h([D({count:Ni.COUNT})],rr.prototype,"doubleSidedMode",void 0),h([D({count:Fr.COUNT})],rr.prototype,"alphaDiscardMode",void 0),h([D({count:oc.COUNT})],rr.prototype,"integratedMeshMode",void 0),h([D({count:Ze.COUNT})],rr.prototype,"transparencyPassType",void 0),h([D({count:Sp.COUNT})],rr.prototype,"ellipsoidMode",void 0),h([D({count:Xe.COUNT})],rr.prototype,"pbrMode",void 0),h([D({count:fr.COUNT})],rr.prototype,"normalType",void 0),h([D()],rr.prototype,"spherical",void 0),h([D()],rr.prototype,"doublePrecisionRequiresObfuscation",void 0),h([D()],rr.prototype,"hasVertexColors",void 0),h([D()],rr.prototype,"hasNormals",void 0),h([D()],rr.prototype,"hasSlicePlane",void 0),h([D()],rr.prototype,"hasBaseColorTexture",void 0),h([D()],rr.prototype,"receiveAmbientOcclusion",void 0),h([D()],rr.prototype,"receiveShadows",void 0),h([D()],rr.prototype,"blendingEnabled",void 0),h([D()],rr.prototype,"hasScreenSpaceReflections",void 0),h([D()],rr.prototype,"hasPolygonOffset",void 0),h([D()],rr.prototype,"hasMetallicRoughnessTexture",void 0),h([D()],rr.prototype,"hasEmissionTexture",void 0),h([D()],rr.prototype,"hasOcclusionTexture",void 0),h([D()],rr.prototype,"hasNormalTexture",void 0),h([D()],rr.prototype,"hasOccludees",void 0),h([D()],rr.prototype,"hasMultipassTerrain",void 0),h([D()],rr.prototype,"cullAboveGround",void 0),h([D()],rr.prototype,"hasCloudsReflections",void 0),h([D()],rr.prototype,"snowCover",void 0),h([D()],rr.prototype,"objectAndLayerIdColor",void 0),h([D({constValue:zr.Draw})],rr.prototype,"pbrTextureBindType",void 0),h([D({constValue:!0})],rr.prototype,"hasSliceHighlight",void 0),h([D({constValue:!1})],rr.prototype,"hasSliceInVertexProgram",void 0),h([D({constValue:!1})],rr.prototype,"useCustomDTRExponentForWater",void 0),h([D({constValue:!1})],rr.prototype,"hasVertexTangents",void 0),h([D({constValue:!0})],rr.prototype,"supportsTextureAtlas",void 0),h([D({constValue:!1})],rr.prototype,"highStepCount",void 0),h([D({constValue:!1})],rr.prototype,"instancedDoublePrecision",void 0),h([D({constValue:!0})],rr.prototype,"useFillLights",void 0),h([D({constValue:!1})],rr.prototype,"objectAndLayerIdColorInstanced",void 0);function yK(t,e){t.include(mv,e),t.fragment.include(OC);const r=t.fragment;r.uniforms.add(new cI("baseColor",i=>i.baseColor)),r.uniforms.add(new c1("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(b`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(b`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(b`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function _K(t,e){const r=t.fragment;switch(e.doubleSidedMode){case Ni.None:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Ni.View:t.include(Lw,e),r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Ni.WindingOrder:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Ni.COUNT:}switch(e.normalType){case fr.Attribute:case fr.Compressed:t.include(_D,e),r.code.add(b`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case fr.ScreenDerivative:t.include(Lw,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case fr.Ground:e.spherical?(t.include(Lw,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(b`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(b`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case fr.COUNT:}}function QKe(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===L.Color||e.alphaDiscardMode!==Fr.Opaque)){t.include(S7,e);const i=e.textureCoordinateType===ps.Atlas;r.uniforms.add(new wu("baseColorTexture",s=>s.texture)),i?(t.include(lce),r.code.add(b`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(b`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(b`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function KKe(t){const e=new ur;e.include(Lw,t),e.include(_D,t),e.include(mv,t),e.include(_p,t),e.include(h2,t),e.include(YKe,t),e.include(P7e,t),e.include(r8e,t),e.include(QKe,t),e.include(JKe,t);const{vertex:r,fragment:i}=e;t.pbrMode!==Xe.Normal&&t.pbrMode!==Xe.Schematic||(e.include(C7,t),t.hasNormalTexture&&e.include(nme,t));const s=t.output===L.Shadow||t.output===L.ShadowHighlight||t.output===L.ShadowExcludeHighlight;s&&t.componentData===Tp.Varying?r.code.add(b`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(b`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===oc.ColorOverlay||t.integratedMeshMode===oc.ColorOverlayWithWater,o=n&&t.output===L.Color&&t.pbrMode===Xe.WaterOnIntegratedMesh;return n&&(e.include(q1,t),e.include(_Je,t),t.spherical?r.code.add(b`
      const float invEllipsoidRadius = ${b.float(1/(t.ellipsoidMode===Sp.Earth?Yt.radius:t.ellipsoidMode===Sp.Mars?pp.radius:im.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(b`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(b`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===L.ObjectAndLayerIdColor?b`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${b.float(Gn)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===L.ObjectAndLayerIdColor?b`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?b`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:b`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?b`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===L.Alpha&&(i.include(xc),e.include(Tc,t),e.include(yK,t),n&&i.uniforms.add(new We("ovColorTex",(a,l)=>Az(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===L.Color&&(i.include(xc),e.include(Tc,t),e.include(yK,t),e.include(_K,t),e.include(q1,t),t.receiveShadows?(e.include(vD,t),i.code.add(b`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(b`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new We("ovColorTex",(a,l)=>Az(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===Xe.Normal||t.pbrMode===Xe.Schematic?(Up(i),i.code.add(b`
        ${t.pbrMode===Xe.Normal?b`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(b`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(b`vec3 shadingNormal = normalVertex;`),i.code.add(b`${t.spherical?b`vec3 normalGround = normalize(positionWorld());`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(b`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?b`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(b`float shadow = evaluateShadow();`):t.spherical?(b2(i),i.code.add(b`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(b`float shadow = 0.0;`),o&&i.uniforms.add(new We("ovNormalTex",(a,l)=>tj(l))),t.snowCover&&i.code.add(b`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(b`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?b`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(b`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===Ze.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===L.Depth||s)&&(e.include(dm,t),i.code.add(b`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===L.Normal&&(e.include(_K,t),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===fr.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===L.ObjectAndLayerIdColor&&e.fragment.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===L.Highlight&&(e.include(Am,t),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function tj(t){return t.overlays.length===0?null:t.overlays[Ci.INNER].getValidTexture(Bi.Water)}const eet=Object.freeze(Object.defineProperty({__proto__:null,build:KKe,getOverlayNormalTexture:tj},Symbol.toStringTag,{value:"Module"}));let sye=class nye extends gr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Re.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new pr(e.rctx,nye.shader.get().build(this.configuration),oye)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==oc.None,s=e===Ze.NONE,n=e===Ze.FrontFace;return xt({blending:r.output!==L.Color&&r.output!==L.Alpha||!r.blendingEnabled?null:s?gc:Om(e),culling:IL(r.cullFace),depthTest:{func:iy(e)},depthWrite:s||n?Ya:null,colorWrite:$t,stencilWrite:i||r.hasOccludees?Mp:null,stencilTest:i?hBe(ja.IntegratedMeshMaskExcluded):r.hasOccludees?sy:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:lD})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};sye.shader=new dr(eet,()=>he(()=>import("./ComponentShader.glsl-708595ca.js"),[]));const oye=new Map([[S.POSITION,0],[S.NORMAL,1],[S.NORMALCOMPRESSED,1],[S.COLOR,2],[S.UV0,3],[S.UVREGION,4],[S.COMPONENTINDEX,5]]);let tet=class extends Ar{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},rj=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function zi(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(s){this[i]!==s&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function vK(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let ND=class{constructor(e){this._low=C(),this._high=C(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){te(this._low,te(bK,e));const r=_n(bK,e,this._low);te(this._high,r)}get(e){return oe(e,this._low,this._high)}getLowScaled(e){return ee(e,this._low,1)}};const bK=Vi();let un=class extends tet{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Ct(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ce(1,1,.5),this.emissiveFactor=Ce(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new QP,this.componentParameters=new DE,this.textureAlphaCutoff=U$,this.alphaDiscardMode=Fr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Sp.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new rr;const i=new ND(e.position),s=ome(e.rotationScale);uv(s,s),this.transformNormalGlobalFromModel=Noe(Du(s,s)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=vi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=r.identifier===Sl.Material&&i.transparencyPassType!=null?i.transparencyPassType:Ze.NONE,n.hasMultipassTerrain=r.identifier===Sl.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===Sl.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Ni.View:Ni.None,n.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();n.blendingEnabled=o===ta.Transparent||o===ta.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?iet(i)?tj(i)?oc.ColorOverlayWithWater:oc.ColorOverlay:oc.NoOverlay:oc.None,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(n.pbrMode=n.integratedMeshMode===oc.ColorOverlayWithWater?Xe.WaterOnIntegratedMesh:this.usePBR?a?Xe.Schematic:Xe.Normal:Xe.Disabled,n.normalType=n.integratedMeshMode===oc.None?n.hasNormals?fr.Compressed:fr.ScreenDerivative:fr.Ground,n.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===Sl.ShadowMap)n.output=L.Shadow,n.vertexDiscardMode=mu.None;else if(r.identifier===Sl.Highlight)n.output=L.Highlight,n.vertexDiscardMode=mu.None;else{switch(this._computeWhichMaterialPass()===ta.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?mu.Opaque:mu.Transparent:n.vertexDiscardMode=mu.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case L.Color:n.receiveAmbientOcclusion=i.ssaoHelper.active,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=i.cloudsFade.data!=null;break;case L.Alpha:n.hasOccludees=i.hasOccludees;break;case L.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(sye,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case ta.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case ta.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case ta.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case ta.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),ret(r)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const u=this.componentParameters.castShadows!==Zs.None;u&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),u&&e.highlightShadowMap.submitDraw(this,s,l,o)),u&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?ta.IntegratedMesh:this.objectOpacity<1?ta.Transparent:this.componentParameters.opaqueOverride===Zs.All?ta.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Fr.Blend||this.alphaDiscardMode===Fr.MaskBlend?ta.Transparent:this.componentParameters.transparent===Zs.None?ta.Opaque:this.componentParameters.transparent===Zs.All?ta.Transparent:ta.OpaqueAndTransparent}};var ta,Zs;h([zi({vectorOps:yie})],un.prototype,"baseColor",void 0),h([zi()],un.prototype,"usePBR",void 0),h([zi()],un.prototype,"hasParametersFromSource",void 0),h([zi({vectorOps:hH})],un.prototype,"mrrFactors",void 0),h([zi({vectorOps:hH})],un.prototype,"emissiveFactor",void 0),h([zi({dispose:!0})],un.prototype,"baseColorTexture",void 0),h([zi({dispose:!0})],un.prototype,"metallicRoughnessTexture",void 0),h([zi({dispose:!0})],un.prototype,"emissionTexture",void 0),h([zi({dispose:!0})],un.prototype,"occlusionTexture",void 0),h([zi({dispose:!0})],un.prototype,"normalTexture",void 0),h([zi()],un.prototype,"objectOpacity",void 0),h([vK()],un.prototype,"commonMaterialParameters",void 0),h([vK()],un.prototype,"componentParameters",void 0),h([zi()],un.prototype,"textureAlphaCutoff",void 0),h([zi()],un.prototype,"alphaDiscardMode",void 0),h([zi()],un.prototype,"isIntegratedMesh",void 0),h([zi()],un.prototype,"polygonOffsetEnabled",void 0),h([zi()],un.prototype,"ellipsoidMode",void 0),h([zi()],un.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(ta||(ta={}));let QP=class extends rj{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=ti.Back,this.hasSlicePlane=!0}};h([zi()],QP.prototype,"doubleSided",void 0),h([zi()],QP.prototype,"cullFace",void 0),h([zi()],QP.prototype,"hasSlicePlane",void 0);let DE=class extends rj{constructor(){super(...arguments),this.externalColor=Ct(1,1,1,1),this.externalColorMixMode=Us.Multiply,this.castShadows=Zs.All}get transparent(){return this.externalColor[3]<1?Zs.All:Zs.None}get opaqueOverride(){return this.externalColorMixMode===Us.Replace&&this.externalColor[3]===1?Zs.All:Zs.None}get visible(){return this.externalColor[3]>0?Zs.All:Zs.None}get type(){return Tp.Uniform}};h([zi({vectorOps:yie})],DE.prototype,"externalColor",void 0),h([zi()],DE.prototype,"externalColorMixMode",void 0),h([zi()],DE.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Zs||(Zs={}));let BS=class extends rj{constructor(){super(...arguments),this.texture=null,this.transparent=Zs.None,this.opaqueOverride=Zs.None,this.castShadows=Zs.None}get type(){return Tp.Varying}};function ret(t){return t.overlays.length!==0&&t.overlays[Ci.INNER].getValidTexture(Bi.Highlight)!=null}function iet(t){return t.overlays.length!==0&&t.overlays[Ci.INNER].getColorTextureNoRasterImage()!=null}h([zi()],BS.prototype,"texture",void 0),h([zi()],BS.prototype,"transparent",void 0),h([zi()],BS.prototype,"opaqueOverride",void 0),h([zi()],BS.prototype,"castShadows",void 0);const dI=Ri().vec3f(S.POSITION).u16(S.COMPONENTINDEX).u16(S.U16PADDING),aye=Ri().vec2u8(S.SIDENESS),set=Dl(aye),lye=Ri().vec3f(S.POSITION0).vec3f(S.POSITION1).u16(S.COMPONENTINDEX).u8(S.VARIANTOFFSET,{glNormalized:!0}).u8(S.VARIANTSTROKE).u8(S.VARIANTEXTENSION,{glNormalized:!0}).u8(S.U8PADDING,{glPadding:!0}).u16(S.U16PADDING,{glPadding:!0}),Dz=lye.clone().vec3f(S.NORMAL),Nz=lye.clone().vec3f(S.NORMALA).vec3f(S.NORMALB),cye=new Map([[S.POSITION0,0],[S.POSITION1,1],[S.COMPONENTINDEX,2],[S.VARIANTOFFSET,3],[S.VARIANTSTROKE,4],[S.VARIANTEXTENSION,5],[S.NORMAL,6],[S.NORMALA,6],[S.NORMALB,7],[S.SIDENESS,8]]);function wK(t,e,r){const i=e/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(w,T)=>{w<T?s[w+1]++:n[T+1]++};for(let w=0;w<i;w++){const T=t[3*w],x=t[3*w+1],E=t[3*w+2];o(T,x),o(x,E),o(E,T)}let a=0,l=0;for(let w=0;w<r;w++){const T=s[w+1],x=n[w+1];s[w+1]=a,n[w+1]=l,a+=T,l+=x}const c=new Uint32Array(6*i),u=s[r],d=(w,T,x)=>{if(w<T){const E=s[w+1]++;c[2*E]=T,c[2*E+1]=x}else{const E=n[T+1]++;c[2*u+2*E]=w,c[2*u+2*E+1]=x}};for(let w=0;w<i;w++){const T=t[3*w],x=t[3*w+1],E=t[3*w+2];d(T,x,w),d(x,E,w),d(E,T,w)}const p=(w,T)=>{const x=2*w,E=T-w;for(let O=1;O<E;O++){const A=c[x+2*O],$=c[x+2*O+1];let M=O-1;for(;M>=0&&c[x+2*M]>A;M--)c[x+2*M+2]=c[x+2*M],c[x+2*M+3]=c[x+2*M+1];c[x+2*M+2]=A,c[x+2*M+3]=$}};for(let w=0;w<r;w++)p(s[w],s[w+1]),p(u+n[w],u+n[w+1]);const g=new Int32Array(3*i),y=(w,T)=>w===t[3*T]?0:w===t[3*T+1]?1:w===t[3*T+2]?2:-1,_=(w,T)=>{const x=y(w,T);g[3*T+x]=-1},v=(w,T,x,E)=>{const O=y(w,T);g[3*T+O]=E;const A=y(x,E);g[3*E+A]=T};for(let w=0;w<r;w++){let T=s[w];const x=s[w+1];let E=n[w];const O=n[w+1];for(;T<x&&E<O;){const A=c[2*T],$=c[2*u+2*E];A===$?(v(w,c[2*T+1],$,c[2*u+2*E+1]),T++,E++):A<$?(_(w,c[2*T+1]),T++):(_($,c[2*u+2*E+1]),E++)}for(;T<x;)_(w,c[2*T+1]),T++;for(;E<O;)_(c[2*u+2*E],c[2*u+2*E+1]),E++}return g}let uye=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?oet:net}write(e,r,i){const s=this._edgeHashFunction(i);yR.seed=s;const n=yR.getIntRange(0,255),o=yR.getIntRange(0,this.settings.variants-1),a=.7,l=yR.getFloat(),c=255*(.5*aet(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const ij=new Float32Array(6),pI=new Uint32Array(ij.buffer),_0=new Uint32Array(1);function net(t){const e=ij;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],_0[0]=5381;for(let r=0;r<pI.length;r++)_0[0]=31*_0[0]+pI[r];return _0[0]}function oet(t){const e=ij;e[0]=yb(t.position0[0]),e[1]=yb(t.position0[1]),e[2]=yb(t.position0[2]),e[3]=yb(t.position1[0]),e[4]=yb(t.position1[1]),e[5]=yb(t.position1[2]),_0[0]=5381;for(let r=0;r<pI.length;r++)_0[0]=31*_0[0]+pI[r];return _0[0]}const xK=1e4;function yb(t){return Math.round(t*xK)/xK}function aet(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let fI=class{constructor(){this._commonWriter=new uye}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Dz.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),oe(gR,i.faceNormal0,i.faceNormal1),fe(gR,gR),e.normal.setVec(r,gR)}trim(e,r){return this._commonWriter.trim(e,r)}};fI.Layout=Dz,fI.glLayout=Dl(Dz,1);let mI=class{constructor(){this._commonWriter=new uye}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Nz.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};mI.Layout=Nz,mI.glLayout=Dl(Nz,1);const gR=C(),yR=new WS,P_=-1;var gI;function cet(t,e,r,i=met){const s=t.vertices.position,n=t.vertices.componentIndex,o=At(i.anglePlanar),a=At(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=Fz.edge,d=u.position0,p=u.position1,g=u.faceNormal0,y=u.faceNormal1,_=fet(t),v=pet(t),w=v.length/4,T=e.allocate(w);let x=0;const E=w,O=r.allocate(E);let A=0,$=0,M=0;const U=m1e(0,w),k=new Float32Array(w);k.forEach((j,Z,R)=>{s.getVec(v[4*Z],d),s.getVec(v[4*Z+1],p),R[Z]=ei(d,p)}),U.sort((j,Z)=>k[Z]-k[j]);const B=new Array,z=new Array;for(let j=0;j<w;j++){const Z=U[j],R=k[Z],I=v[4*Z],N=v[4*Z+1],V=v[4*Z+2],q=v[4*Z+3],J=q===P_;if(s.getVec(I,d),s.getVec(N,p),J)se(g,_[3*V],_[3*V+1],_[3*V+2]),te(y,g),u.componentIndex=n.get(I),u.cosAngle=pe(g,y);else{if(se(g,_[3*V],_[3*V+1],_[3*V+2]),se(y,_[3*q],_[3*q+1],_[3*q+2]),u.componentIndex=n.get(I),u.cosAngle=pe(g,y),het(u,c))continue;u.cosAngle<-.9999&&te(y,g)}$+=R,M++,J||uet(u,l)?(e.write(T,x++,u),B.push(R)):det(u,o)&&(r.write(O,A++,u),z.push(R))}const Y=new Float32Array(B.reverse()),W=new Float32Array(z.reverse());return{regular:{instancesData:e.trim(T,x),lodInfo:{lengths:Y}},silhouette:{instancesData:r.trim(O,A),lodInfo:{lengths:W}},averageEdgeLength:$/M}}function uet(t,e){return t.cosAngle<e}function het(t,e){return t.cosAngle>e}function det(t,e){const r=rn(t.cosAngle),i=Fz.fwd,s=Fz.ortho;return fm(i,t.position1,t.position0),r*(pe(Qe(s,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function pet(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],d=r[3*a],p=r[3*a+1],g=r[3*a+2];s+=l===P_||d<p?1:0,s+=c===P_||p<g?1:0,s+=u===P_||g<d?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],d=r[3*a],p=r[3*a+1],g=r[3*a+2];(l===P_||d<p)&&(n[o++]=d,n[o++]=p,n[o++]=a,n[o++]=l),(c===P_||p<g)&&(n[o++]=p,n[o++]=g,n[o++]=a,n[o++]=c),(u===P_||g<d)&&(n[o++]=g,n[o++]=d,n[o++]=a,n[o++]=u)}return n}function fet(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,s=iF.v0,n=iF.v1,o=iF.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],u=i[3*l+1],d=i[3*l+2];r.getVec(c,s),r.getVec(u,n),r.getVec(d,o),le(n,n,s),le(o,o,s),Qe(s,n,o),fe(s,s),a[3*l]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(gI||(gI={}));const Fz={edge:{position0:C(),position1:C(),faceNormal0:C(),faceNormal1:C(),componentIndex:0,cosAngle:0},ortho:C(),fwd:C()},iF={v0:C(),v1:C(),v2:C()},met={anglePlanar:4,angleSignificantEdge:35};function get(t){const e=yet(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return TK.updateSettings(t.writerSettings),SK.updateSettings(t.writerSettings),cet(e,TK,SK)}function yet(t,e,r,i){if(e){const o=wK(r,i,t.count);return new _et(r,i,o,t)}const s=QU(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),n=wK(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:dI.createView(s.buffer)}}let _et=class{constructor(e,r,i,s){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=s}};const TK=new fI,SK=new mI,Vwt=Ri().vec3f(S.POSITION0).vec3f(S.POSITION1),vet=Ri().vec3f(S.POSITION0).vec3f(S.POSITION1).u16(S.COMPONENTINDEX).u16(S.U16PADDING,{glPadding:!0});let bet=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},wet=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new xr;i.samplingMode=wt.NEAREST,i.wrapMode=Ot.CLAMP_TO_EDGE,i.width=this.textureWidth,i.height=1,this._texture=new bt(this._rctx,i),this._data=new wo(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,s,n,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,r,i,s){const n=e*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}getDataElement(e,r,i){const s=e*this._fieldCount+r;return this._dirty=!0,this._data.get(s,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,s=new wo(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const hye=65536;let xet=class{constructor(e,r=1){this.textureBuffer=new wet(e,r),this._indexManager=new bet(hye)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},dye=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>hye)return null;const r=new xet(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const EK=ne.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Tet{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new Nt,new Nt],this._renderSubmit=new jKe(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ie("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new dye(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){He(this._objects[Yw.Hidden].length===0&&this._objects[Yw.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(r=>r.toArray());for(const r of e)r==null||r.destroy()}createObject(e){const r=new kS;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=hK(e.obb),r.components=new SKe(this._componentBufferManager,bp(e.geometry.componentOffsets)),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new MKe(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=Hn(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new WKe,c=o.textureBuffer,u=new Uint8Array(4),d=new Uint32Array(u.buffer);let p=0,g=0,y=0,_=n.verticalOffsets,v=1/0,w=-1/0,T=!1,x=!1,E=0;for(let O=0;O<n.count;O++){r(O,l),p+=+(l.externalColor[3]<1),g+=+(l.externalColorMixMode===Us.Replace&&l.externalColor[3]===1),y+=+l.castShadows,eme(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[O],0,u[0],u[1],u[2],u[3]),T||(T=O>0&&E!==d[0]),E=d[0],x||(x=l.elevationOffset!==0),x&&_==null&&(_=new Array(O).fill(0)),_!=null&&(_[O]=l.elevationOffset),v=Math.min(v,l.elevationOffset),w=Math.max(w,l.elevationOffset),iye(l.elevationOffset,u),c.setData(a[O],1,u[0],u[1],u[2],u[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[O],2,A[0],A[1],A[2],A[3]),l.pickable!==eye(n.pickability,O)&&(n.pickability=CKe(n.pickability,n.count,O,l.pickable))}n.verticalOffsets=x?_:null,i.offsetObb=x?wKe(i.obb,v,w,this._viewingMode,i.offsetObb!=null?i.offsetObb:hK(i.obb)):null,T||x||this._hasObjectAndLayerId?(s.componentParameters=new BS,s.componentParameters.castShadows=sF(y,n.count),s.componentParameters.transparent=sF(p,n.count),s.componentParameters.opaqueOverride=sF(g,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new DE,s.componentParameters.castShadows=l.castShadows?Zs.All:Zs.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,s=!1){e.intersectionGeometry.getComponentAabb(r,i);const n=e,o=n.components.verticalOffsets;if(s||o==null)return i;const a=o[r];if(this._viewingMode===Re.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=O4e(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,s,n,o){const a=e;n!=null&&(n.localOrigin=a.transform.position);const l=uv(CK,a.transform.rotationScale);_n(_R,r,a.transform.position),_n(vR,i,a.transform.position),El(_R,_R,l),El(vR,vR,l);const c=Du(CK,l);return a.intersectionGeometry.intersect(_R,vR,s,c,n,a.components.verticalOffsets,o)}addEdges(e,r,i,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(e,n.transform,{center:n.obb.center,radius:bKe(n.obb)},a,o,l,i,s)}async extractEdgeInformation(e,r,i){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:vet.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=dI.createBuffer(a.length/3);$A(c.position.typedBuffer,a,c.position.typedBufferStride,3),qpe(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,d=this._computeVisibilityIndices(o,n,l,u);return{origin:ms(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,r,i,s){if(e&&r.allVisible())return e;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=Yh(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const u=i[l],d=i[c];for(let p=u;p<d;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void EK.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else EK.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[Yw.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=br.createVertex(i,hr.STATIC_DRAW,s.vertices.data),a=fo(s.indices,_=>br.createIndex(i,hr.STATIC_DRAW,_)),l=Dl(HKe(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],w=r.offsets[_+1],T=r.materialDataIndices[_];if(s.indices!=null)for(let x=v;x<w;x++)c[s.indices[x]]=T;else for(let x=v;x<w;x++)c[x]=T}const u=br.createVertex(i,hr.STATIC_DRAW,c.buffer),d=new un(e.transform,e.toMapSpace),p=new Iu(i,oye,{data:l,componentIndices:Eet},{data:o,componentIndices:u},a),g=new DKe(p,vt.TRIANGLES,n,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+u.byteSize+(a!=null?a.byteSize:0)};return new LKe(d,g,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const Eet=Dl(Ri().u16(S.COMPONENTINDEX));function sF(t,e){return t===e?Zs.All:t===0?Zs.None:Zs.Some}const CK=Ha(),_R=C(),vR=C();let pye=class extends Ar{constructor(){super(...arguments),this.renderScale=Ie()}};function Cet(t){const e=new ur;e.include(Ac),e.fragment.uniforms.add(new mr("renderScale",i=>i.renderScale),new We("tex",i=>i.texture),new We("depthTex",i=>i.depthTex));const r=t.haze;return e.fragment.code.add(b`
    void main() {
      ${r?b`vec4`:b`float`} depthSample = texture(depthTex, uv) ${r?"":b`.r`};
      if (depthSample ${r?b`== vec4(0)`:b`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, renderScale * uv);
    }
    `),e}const Aet=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:pye,build:Cet},Symbol.toStringTag,{value:"Module"}));let fye=class mye extends gr{initializeProgram(e){return new pr(e.rctx,mye.shader.get().build(this.configuration),cr)}initializePipeline(){return this.configuration.haze?xt({blending:Xn(_e.ONE,_e.ZERO,_e.ONE_MINUS_SRC_COLOR,_e.ONE),depthTest:{func:Br.ALWAYS},colorWrite:$t}):xt({blending:Il(_e.ONE,_e.ONE_MINUS_SRC_ALPHA),depthTest:{func:Br.ALWAYS},colorWrite:$t})}};fye.shader=new dr(Aet,()=>he(()=>import("./AtmosphereCompositing.glsl-379be847.js"),[]));let gye=class extends Ar{constructor(){super(...arguments),this.opacity=1}};function Oet(t){const e=new ur;return e.include(Ac),e.fragment.uniforms.add(new We("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Se("opacity",r=>r.opacity)),e.fragment.code.add(b`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const Ret=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:gye,build:Oet},Symbol.toStringTag,{value:"Module"}));var Do;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Do||(Do={}));let Uz=class extends Bo{constructor(){super(...arguments),this.alphaMode=Do.None,this.hasOpacityFactor=!1}};h([D({count:Do.COUNT})],Uz.prototype,"alphaMode",void 0),h([D()],Uz.prototype,"hasOpacityFactor",void 0);let yye=class _ye extends gr{initializeProgram(e){return new pr(e.rctx,_ye.shader.get().build(this.configuration),cr)}initializePipeline(){switch(this.configuration.alphaMode){case Do.None:return xt({colorWrite:$t});case Do.Alpha:return xt({blending:Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),colorWrite:$t});case Do.PremultipliedAlpha:case Do.COUNT:return xt({blending:Il(_e.ONE,_e.ONE_MINUS_SRC_ALPHA),colorWrite:$t})}}};yye.shader=new dr(Ret,()=>he(()=>import("./Compositing.glsl-d9f1daa4.js"),[]));let vye=class extends Ar{};function Pet(){const t=new ur;return t.include(Ac),t.fragment.uniforms.add(new We("tex",e=>e.texture)),t.fragment.code.add(b`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const Met=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:vye,build:Pet},Symbol.toStringTag,{value:"Module"}));let bye=class wye extends gr{initializeProgram(e){return new pr(e.rctx,wye.shader.get().build(),cr)}initializePipeline(){return xt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};bye.shader=new dr(Met,()=>he(()=>import("./HUDCompositing.glsl-b27013ff.js"),[]));let xye=class extends Ar{};function $et(){const t=new ur;return t.include(Ac),t.fragment.uniforms.add(new We("colorTexture",e=>e.colorTexture),new We("alphaTexture",e=>e.alphaTexture),new We("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(b`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const Iet=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:xye,build:$et},Symbol.toStringTag,{value:"Module"}));let Tye=class Sye extends gr{initializeProgram(e){return new pr(e.rctx,Sye.shader.get().build(),cr)}initializePipeline(){return xt({blending:Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),colorWrite:$t})}};Tye.shader=new dr(Iet,()=>he(()=>import("./OITCompositing.glsl-1d777f77.js"),[]));let Eye=class extends Ar{constructor(){super(...arguments),this.overlayIndex=Ci.INNER,this.opacity=1}};function Let(){const t=new ur;return t.include(Ac),t.fragment.uniforms.add(new We("tex",e=>e.texture)),t.fragment.uniforms.add(new OA("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Se("opacity",e=>e.opacity)),t.fragment.code.add(b`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const Det=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Eye,build:Let},Symbol.toStringTag,{value:"Module"}));let Cye=class Aye extends gr{initializeProgram(e){return new pr(e.rctx,Aye.shader.get().build(),cr)}initializePipeline(){return xt({blending:Il(_e.ONE,_e.ONE_MINUS_SRC_ALPHA),colorWrite:$t})}};Cye.shader=new dr(Det,()=>he(()=>import("./OverlayCompositing.glsl-55c47572.js"),[]));let Net=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new Uz,this._atmosphereConfiguration=new l$,this._passParameters=new gye,this._atmosphereParameters=new pye,this._oitParameters=new xye,this._hudParameters=new vye,this._overlayParameters=new Eye}destroy(){this._vao=Ue(this._vao)}compositeOIT(e,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(Tye);n.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(vt.TRIANGLE_STRIP,0,co(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(bye);i.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(vt.TRIANGLE_STRIP,0,co(n,"geometry")),s.release()}compositeOverlay(e,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(Cye);n.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(vt.TRIANGLE_STRIP,0,co(a,"geometry")),o.release()}compositeAtmosphere(e,r,i,s,n){const o=this._rctx;this._atmosphereParameters.texture=r,this._atmosphereParameters.depthTex=i,this._atmosphereParameters.renderScale=s,this._atmosphereConfiguration.haze=n;const a=this._techniqueRepository.acquire(fye,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(vt.TRIANGLE_STRIP,0,co(l,"geometry")),a.release()}composite(e,r,i=Do.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(yye,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(vt.TRIANGLE_STRIP,0,co(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=Xa(this._rctx)),this._vao}};const Fet=1e4,zz=100,Uet=500,zet=500,ket=.1;function Bet(t,e,r){return MV(e,t)*(r[1]-r[0])+r[0]}function Vet(t,e,r){let i=0;if(!e.some(n=>(i+=n.numGeometries,i>=Fet)))return Zet.compute(t,e);const s=IA();return r.forAll(n=>{n.visible&&jx(s,Get(t,n))}),s}function Get(t,e){if(!e.visible)return;const r=IA(),i=e.getSpatialQueryAccelerator();return i!=null?jet(r,t,i):Het(r,t,e.objects),r}function jet(t,e,r){const i=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<Uet)DC(su,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,s,zh.DepthOrder.FRONT_TO_BACK,su,(l,c)=>{kz(t,e,l),su.far=t.near,c.setRange(su)},n,o),DC(su,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,s,zh.DepthOrder.BACK_TO_FRONT,su,(l,c)=>{kz(t,e,l),su.near=t.far,c.setRange(su)},n,o);else{const l=Math.max(Math.min(a,zet),Math.ceil(a*ket)),c=r.findClosest(s,zh.DepthOrder.FRONT_TO_BACK,n,o,l),u=r.findClosest(s,zh.DepthOrder.BACK_TO_FRONT,n,o,l);c&&u&&(AK(t,e,c.boundingVolumeWorldSpace.bounds),AK(t,e,u.boundingVolumeWorldSpace.bounds))}}function Het(t,e,r){_b.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&_b.add(i)}),_b.empty||(_b.sort(e),DC(su,e.near,Math.min(t.near,e.far)),_b.forEachInDepthRange(su,zh.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<t.near&&kz(t,e,i)}),DC(su,Math.max(t.far,e.near),e.far),_b.forEachInDepthRange(su,zh.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{t.far=Math.max(t.far,n)}))}function kz(t,e,r){if(!r.visible||!m0(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=Xet;r.geometries.forEach(n=>{qi(s,i,n.shaderTransformation);const o=gx(s);Oye(t,e,n.boundingInfo,s,o)})}function Oye(t,e,r,i,s){if(r==null)return;De(sa,r.center,i);const{eye:n,viewForward:o}=e,a=o[0]*(sa[0]-n[0])+o[1]*(sa[1]-n[1])+o[2]*(sa[2]-n[2]);if(sa[3]=r.radius*s,!(a-sa[3]>t.near&&a+sa[3]<t.far)&&m0(e.frustum,sa))if(r.radius>zz&&r.getChildren())for(const l of r.getChildren())Oye(t,e,l,i,s);else Bz.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function AK(t,e,r){const i=e.eye,s=e.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];t.near=Math.min(t.near,n-r[3]),t.far=Math.max(t.far,n+r[3])}let Wet=class{constructor(){this._items=new Nt({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,r,i){if(r===zh.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}}},qet=class{constructor(){this._view=xe(),this._viewProj=xe(),this._frustum=hC(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),en(this._view,e.viewMatrix),qi(this._viewProj,e.projectionMatrix,this._view),h$(this._frustum,e.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(p=>p.forEachGeometry(g=>{if(!g.visible||!g.castShadow)return;const y=g.boundingSphere,_=s*y[0]+n*y[1]+o*y[2]+a,v=_-y[3],w=_+y[3];this._geometries.push(g),this._near.push(-w),this._far.push(-v)}));const l=new NKe;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,d=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[d++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,g)=>this._near[p]<this._near[g]?-1:this._near[p]>this._near[g]?1:0),this._farCandidates.sort((p,g)=>this._far[p]<this._far[g]?1:this._far[p]>this._far[g]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const g=this._nearCandidates[p];if(this._near[g]<l.near){const y=this._geometries[g],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const g=this._farCandidates[p];if(this._far[g]>l.far){const y=this._geometries[g],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const s=e.center;De(sa,s,r);const n=gx(r),o=sa[0],a=sa[1],l=sa[2],c=e.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=d+c;if(!(-(d-c)<2||-p>=i.near))if(-p>this._looseRange.near)i.near=-p;else{if(c>zz){const g=e.getChildren();if(g!==void 0){for(const y of g)this._includeNearBoundingInfoRec(y,r,i);return}}Bz.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let s=e.radius;const n=e.center;De(sa,n,r);const o=gx(r),a=sa[0],l=sa[1],c=sa[2];s*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>s)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-d<=i.far))if(-d<this._looseRange.far)i.far=-d;else{if(s>zz){const p=e.getChildren();if(p!==void 0){for(const g of p)this._includeFarBoundingInfoRec(g,r,i);return}}Bz.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},Yet=class{constructor(){this._modelViewProj=xe(),this._clipPosition=[Ht(),Ht(),Ht(),Ht(),Ht(),Ht(),Ht(),Ht()]}unionDepthRangeWithAABB(e,r,i,s,n){const o=this._modelViewProj;qi(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],p=l<4?s[2]:n[2];c[0]=o[0]*u+o[4]*d+o[8]*p+o[12],c[1]=o[1]*u+o[5]*d+o[9]*p+o[13],c[2]=o[2]*u+o[6]*d+o[10]*p+o[14],c[3]=o[3]*u+o[7]*d+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[nF[l][0]],u=this._clipPosition[nF[l][1]],d=this._clipPosition[nF[l][2]],p=this._clipTriangle(c,u,d);let g=!0;for(let y=0;y<p.length;++y)if(p[y][3]>=2){g=!1;break}if(!g){a=!0;for(let y=0;y<p.length;++y){const _=p[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void He(!1)}_intersect(e,r,i){let s=0;return i===0?s=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?s=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?s=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(s=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),Gk(Ht(),e,r,s)}_clipTriangle(e,r,i){let s=[e,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const nF=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],sa=ss(),Xet=xe(),su=IA(),_b=new Wet,Zet=new qet,Bz=new Yet;let Jet=class{},Qet=class extends Ar{constructor(){super(...arguments),this.textures=new Jet}};function Ket(){const t=new ur;return t.attributes.add(S.POSITION,"vec2"),t.vertex.uniforms.add(new Wt("drawPosition",(e,r)=>ett(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(b`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new We("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new We("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new We("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new vp("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new vp("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(b`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function ett(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,s=t.magnifier.offset.y*r;tp(t.magnifier.position,OK);const n=e.camera.screenToRender(OK,ttt),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return oi(rtt,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const OK=Li(),ttt=dne(),rtt=Ht();async function itt(t){const e=he(()=>import("./mask-svg-023bbc42.js"),[]),r=he(()=>import("./overlay-svg-d62383f3.js"),[]),i=hm((await e).default,{signal:t}),s=hm((await r).default,{signal:t}),n={mask:await i,overlay:await s};return qt(t),n}let Jb=class extends we{constructor(){super(...arguments),this._handles=new Oi,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Qet,this.events=new ys,this.attributeLocations=new Map([[S.POSITION,0]]),this._tmpScreenPoint=Li(),this._tmpRenderPoint=dne()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(ce(()=>fo(this._magnifier,i=>i.version),r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const s=r.camera.pixelRatio,n=Math.ceil(s*i.size);if(this._updateResources(e,n),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),tp(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,u=r.camera.fullHeight,d=.5*a,p=.5*a;l[0]=me(l[0],d,c-d-1),l[1]=me(l[1],p,u-p-1);const g=Math.floor(l[0]-d),y=Math.floor(l[1]-p),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,g,y,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(vt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:Zx(async s=>{const n=r==null||i==null?itt(s):null,o=r!=null?hm(r,{signal:s}):n.then(l=>l.mask),a=i!=null?hm(i,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const s=this._createTextureResources(e,r);if(s==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:Xa(e,b7,this.attributeLocations,0,1),pipelineState:xt({blending:Il(_e.ONE,_e.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:$t})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new xr;i.internalFormat=Pt.RGBA,i.wrapMode=Ot.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!Tre(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const s=new bt(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=Pt.ALPHA,i.preMultiplyAlpha=!1;const n=new bt(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=Pt.RGBA,i.flipped=!1,{input:new bt(e,i),mask:n,overlay:s,size:r}}_createProgram(e){return new pr(e,Ket(),this.attributeLocations)}};h([f()],Jb.prototype,"_imageSources",void 0),h([f()],Jb.prototype,"_imageLoadTask",void 0),h([f({readOnly:!0})],Jb.prototype,"updating",null),Jb=h([F("esri/views/3d/webgl-engine/lib/MagnifierHelper")],Jb);let stt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new wo(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,s,n,o=null,a=null,l=null){if(!(e&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Ct(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return ne.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let s=i.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new wo(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||ne.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):ne.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||ne.getLogger(this.declaredClass).warn("no layerId found for uid "+i.layerUid),n&&o&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var NC;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(NC||(NC={}));let hg=class{constructor(e,r,i=NC.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Nt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=e,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===n&&l.configuration.transparencyPassType===Ze.NONE||(s.bindTechnique(l,e,r),n=l);const c=this._draws.data[a],u=c.geometry;s.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,p=d.length;if(c.indexType!==0){const g=KP.get(c.indexType);for(let y=0;y<p;y+=2){const _=d[y],v=d[y+1];s.drawElements(u.primitiveType,v,c.indexType,_*g)}}else for(let g=0;g<p;g+=2){const y=d[g],_=d[g+1];s.drawArrays(u.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===NC.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=e*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.size-i.geometry.vao.size})}get count(){return this._draws.length}};const KP=new Map;KP.set(Ye.UNSIGNED_BYTE,1),KP.set(Ye.UNSIGNED_SHORT,2),KP.set(Ye.UNSIGNED_INT,4);let ntt=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new mJe,this._shadowPassParameters=new gJe,this._highlightPassParameters=new yJe,this._systems=new Set,this._passes={materialOpaque:new hg(e,r),materialTransparent:new hg(e,r,NC.BackToFront),materialIntegratedMesh:new hg(e,r),shadowMap:new hg(e,r),highlight:new hg(e,r),highlightIntegratedMesh:new hg(e,r),highlightShadowMap:new hg(e,r),defaultShadowMap:new hg(e,r)}}destroy(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(e){return this._systems.size===0?null:(this._configure(e),this._materialPassParameters.output=e.output,this._invoke(e,(r,i)=>r.prepare(i,e.bindParameters)))}render(e,r){this._invoke(e,(i,s)=>i.dispatch(s,e.bindParameters,r))}_invoke(e,r){switch(e.bindParameters.slot){case ae.OPAQUE_MATERIAL:switch(e.output){case L.Color:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case L.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case L.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case L.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case L.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case ae.TRANSPARENT_MATERIAL:switch(e.output){case L.Color:case L.Alpha:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case ae.INTEGRATED_MESH:switch(e.output){case L.Color:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case L.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[ae.OPAQUE_MATERIAL,ae.TRANSPARENT_MATERIAL,ae.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(e);s!=null&&jx(r,s,r)}),r}_configure(e){const r=e.output===L.Shadow||e.output===L.ShadowHighlight||e.output===L.ShadowExcludeHighlight?this._shadowPassParameters:e.output===L.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,s=i.viewInverseTransposeMatrix;se(oF,s[3],s[7],s[11]),aF.set(oF),te(r.transformWorldFromViewTH,aF.high),te(r.transformWorldFromViewTL,aF.low),te(r.slicePlaneLocalOrigin,oF),Lu(r.transformViewFromCameraRelativeRS,i.viewMatrix),en(r.transformProjFromView,i.projectionMatrix),r.identifier===Sl.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===ae.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===ae.INTEGRATED_MESH,Du(RK,r.transformViewFromCameraRelativeRS),uv(r.transformNormalViewFromGlobal,RK))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const oF=C(),RK=Zi(),aF=new ND;let ott=class{constructor(){this._step=$K,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ie("enable-feature:high-quality-idle")){const s=r?performance.now()-this._firstIdleTime:0;if(s>=PK+ltt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=PK?ctt:1}else this._dilation=1;const i=me(e/att,$K,htt);this._step===1/0?this._step=i:this._step=this._step*MK+i*(1-MK)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const att=.5,PK=12e4,ltt=1e4,ctt=10,MK=.9,utt=30,$K=1e3/1,htt=1e3/utt,dtt=8.6,ptt=.4;function ftt(){const t=new ur,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(S.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(S.UV0,"vec2"),e.uniforms.add(new We("coverageTex",n=>n.coverageTexture)),i.add(b`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new We("tex",n=>n.blurColorTexture),new We("origin",n=>n.highlightColorTexture),new Wt("uColor",n=>n.color),new Wt("haloColor",n=>n.haloColor),new Wt("opacities",n=>oi(mtt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",dtt),r.constants.add("blurSize","float",ptt),s.add(b`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const mtt=Ht(),gtt=Object.freeze(Object.defineProperty({__proto__:null,build:ftt},Symbol.toStringTag,{value:"Module"}));let Rye=class Pye extends gr{initializeProgram(e){return new pr(e.rctx,Pye.shader.get().build(),cr)}initializePipeline(){return xt({blending:Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),colorWrite:$t})}};Rye.shader=new dr(gtt,()=>he(()=>import("./HighlightApply.glsl-4bde477d.js"),[]));let Mye=class extends Ar{constructor(){super(...arguments),this.blurSize=Ie()}};function ytt(){const t=new ur,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(S.POSITION,"vec2"),t.attributes.add(S.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new We("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new hG("blurSize",n=>n.blurSize)),i.add(b`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new wu("tex",n=>n.blurInputTexture)),s.add(b`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const _tt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Mye,build:ytt},Symbol.toStringTag,{value:"Module"}));let $ye=class Iye extends gr{initializeProgram(e){return new pr(e.rctx,Iye.shader.get().build(),cr)}initializePipeline(){return xt({colorWrite:$t})}};$ye.shader=new dr(_tt,()=>he(()=>import("./HighlightBlur.glsl-0ec465a0.js"),[]));let Lye=class extends Ar{constructor(){super(...arguments),this.invFramebufferDim=Ie()}};function vtt(){const t=new ur,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(S.POSITION,"vec2"),i.add(b`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new wu("tex",n=>n.inputTexture)),r.uniforms.add(new hG("invFramebufferDim",n=>n.invFramebufferDim)),s.add(b`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const btt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Lye,build:vtt},Symbol.toStringTag,{value:"Module"}));let Dye=class Nye extends gr{initializeProgram(e){return new pr(e.rctx,Nye.shader.get().build(),cr)}initializePipeline(){return xt({colorWrite:$t})}};Dye.shader=new dr(btt,()=>he(()=>import("./HighlightDownsample.glsl-83b269e3.js"),[]));let IK=class extends Ar{constructor(){super(...arguments),this.color=$p(1,0,1,1),this.haloColor=$p(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Ct(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const wtt=32;let xtt=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=Ht(),this._passParameters=new IK,this._downsampleDrawParameters=new Lye,this._blurDrawParameters=new Mye,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Xa(this._rctx);const e=new xr;e.wrapMode=Ot.CLAMP_TO_EDGE,this._blur0Fbo=new As(this._rctx,e),this._blur1Fbo=new As(this._rctx,e),this._blurTechnique=this._techniqueRep.acquire($ye),this._downsampleTechnique=this._techniqueRep.acquire(Dye),this._applyTechnique=this._techniqueRep.acquire(Rye)}dispose(){if(this._blurTechnique=vi(this._blurTechnique),this._downsampleTechnique=vi(this._downsampleTechnique),this._applyTechnique=vi(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=Ue(this._blur0Fbo),this._blur1Fbo=Ue(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new IK,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=e.camera;gu(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const u=this._rctx;u.bindVAO(this._quadVAO);let d=null;this._gridUpdateResources(r,wtt),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,d=this._grid.vao;const p=u.bindTechnique(this._blurTechnique,this._passParameters,e);u.bindVAO(d),u.bindFramebuffer(this._blur0Fbo),u.setViewport(0,0,l,c),u.setClearColor(0,0,0,0),u.clear(mi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,Qt(this._blurDrawParameters.blurSize,1/l,0),p.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,co(d,"geometry")),u.bindFramebuffer(this._blur1Fbo),u.clear(mi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,Qt(this._blurDrawParameters.blurSize,0,1/c),p.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,co(d,"geometry")),u.bindFramebuffer(i),u.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,u.bindTechnique(this._applyTechnique,this._passParameters,e),u.drawArrays(this._applyTechnique.primitiveType,0,co(d,"geometry")),u.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],u=new xr(Math.ceil(c.width/2),Math.ceil(c.height/2));u.pixelFormat=Pt.RGB,u.dataType=Cs.UNSIGNED_SHORT_5_6_5,u.wrapMode=Ot.CLAMP_TO_EDGE,s.coverageMipmap[l+1]=new As(i,u)}}const o=Math.ceil(e.height/s.cellPixelSize),a=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,u=1/o,d=1/a,p=6,g=4,y=new Float32Array(p*g*l*c);let _=0;for(let v=0;v<l;v++)for(let w=0;w<c;w++)y[_]=(w-.5)*d*2-1,y[_+1]=(v-.5)*u*2-1,y[_+2]=w*d,y[_+3]=v*u,y[_+4]=(w+.5)*d*2-1,y[_+5]=(v-.5)*u*2-1,y[_+6]=w*d,y[_+7]=v*u,y[_+8]=(w-.5)*d*2-1,y[_+9]=(v+.5)*u*2-1,y[_+10]=w*d,y[_+11]=v*u,y[_+12]=(w-.5)*d*2-1,y[_+13]=(v+.5)*u*2-1,y[_+14]=w*d,y[_+15]=v*u,y[_+16]=(w+.5)*d*2-1,y[_+17]=(v-.5)*u*2-1,y[_+18]=w*d,y[_+19]=v*u,y[_+20]=(w+.5)*d*2-1,y[_+21]=(v+.5)*u*2-1,y[_+22]=w*d,y[_+23]=v*u,_+=p*g;s.vao&&s.vao.dispose(!0),s.vao=new sd(i,cr,{geometry:cA},{geometry:br.createVertex(i,hr.STATIC_DRAW,y)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,Qt(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(vt.TRIANGLE_STRIP,0,co(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const Ttt={dataType:Cs.UNSIGNED_BYTE,internalFormat:Pt.RGBA},Stt={};let Ett=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._fbos.forEach(e=>e.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._fbos.forEach((s,n)=>{s.colorTexture!==i&&s.depthStencilAttachment!==i||(s.detachColorTexture(),s.detachDepthStencilTexture(),s.dispose(),this._fbos.delete(n))}),i.dispose(),e.delete(r))}_getDepthTexture(e,r,i){let s=this._depthTextures.get(e.id);if(!s||s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=null),!s){const n=new xr(r,i);n.pixelFormat=Pt.DEPTH_STENCIL,n.dataType=Cs.UNSIGNED_INT_24_8,n.samplingMode=wt.NEAREST,n.wrapMode=Ot.CLAMP_TO_EDGE,s=new bt(this._rctx,n),this._depthTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getColorTexture(e,r,i){let s=this._colorTextures.get(e.id);if(s&&(s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=Wx())),!s){const n=new xr(r,i);n.internalFormat=e.internalFormat,n.dataType=e.dataType,n.samplingMode=e.samplingMode!=null?e.samplingMode:wt.LINEAR,n.wrapMode=Ot.CLAMP_TO_EDGE,s=new bt(this._rctx,n),this._colorTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:Rl(),...Stt,...e}}registerColorTarget(e={}){return{id:Rl(),...Ttt,...e}}getFramebuffer(e,r,i,s){const n=this._getKey(i,s);let o=this._fbos.get(n);const a=this.getColorTexture(i,e,r),l=s?this._getDepthTexture(s,e,r):void 0;return o?((o.width!==e||o.height!==r||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e,r),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new As(this._rctx,a,l),this._fbos.set(n,o),o)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),e+=N1(s))};return this._colorTextures.forEach(i),this._depthTextures.forEach(i),e}},Ctt=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new Ett(e);const i=this._renderTargetHelper;this._mainColorTargets=[i.registerColorTarget({name:"mainColorTarget0"}),i.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=i.registerColorTarget({name:"frontFaceTarget"});const s=n=>i.registerColorTarget({name:n,dataType:Cs.FLOAT,internalFormat:ft.RGBA32F,samplingMode:wt.NEAREST});this.colorFloatTarget=s("colorFloatTarget"),this.alphaFloatTarget=s("alphaFloatTarget"),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:wt.NEAREST}),this.terrainLinearDepth=i.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=i.registerColorTarget({name:"geometryLinearDepth"}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",internalFormat:ft.RGBA4,dataType:Cs.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",internalFormat:ft.RGBA4,dataType:Cs.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"}),this.hudColor=i.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(e){const r=this._rctx;this.width=e.fullWidth,this.height=e.fullHeight,J_(this,r.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(mi.COLOR_BUFFER_BIT|mi.DEPTH_BUFFER_BIT|mi.STENCIL_BUFFER_BIT)}composite(e){this.colorTexture!=null&&this._compositingHelper.composite(e,this.colorTexture,Do.None)}renderTmpAndCompositeToMain(e,r,i,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,Att),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}compositeAtmosphereToMain(e,r,i,s){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(e,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),i,s,r),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,Ott)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let s,n;switch(r){case Ze.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case Ze.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case Ze.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0];break;case Ze.NONE:case Ze.COUNT:return}i?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Do.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Do.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(mi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=mi.COLOR_BUFFER_BIT}i&&(o|=mi.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=mi.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,s,n,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this.width,this.height)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const Att=[0,0,0,0],Ott=[0,1,0,1];let VS=class extends we{constructor(e){super({}),this._context=e,this._renderPlugins=new Nt,this._slots=[];for(let r=0;r<ae.MAX_SLOTS;++r)this._slots[r]=[]}normalizeCtorArgs(){return{}}add(e,r,i){const s=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),wr();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},n=r.initializeRenderContext(this._context,i);if(Sc(n))return n.then(s);s(),this.notifyChange("updating")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("updating")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}prepareSlots(e){for(const r of e)this._context.renderContext.bindParameters.slot=r,this._slots[r].filter(i=>{i.canRender&&(LK(i)&&i.prepareTechnique(this._context.renderContext),DK(i)&&i.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(LK(i)){const s=i.prepareTechnique(this._context.renderContext);return s!=null&&(r.push(s),!0)}if(DK(i)){const s=i.prepareTechniques(this._context.renderContext);return s!=null&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this._context.renderContext,r[s]))}queryDepthRange(e){const r=Rtt;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(e);s&&jx(r,s,r)}}),r}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>!!e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>!!e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>!!e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[ae.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,_i.None)}};function LK(t){return"prepareTechnique"in t}function DK(t){return"prepareTechniques"in t}h([f()],VS.prototype,"_renderPlugins",void 0),h([f({readOnly:!0})],VS.prototype,"updating",null),VS=h([F("esri.views.3d.webgl-engine.lib.RenderPluginManager")],VS);const Rtt={near:0,far:0};let Fye=class extends Pfe{};const FD=255,Ptt=1/FD;function Mtt(t){const e=new ur,r=e.fragment;return r.include(Ll),r.include(xc),e.include(bD),e.include(Ac),e.include(vD,t),r.uniforms.add(new We("depthMap",i=>i.linearDepthTexture),new wi("inverseViewMatrix",(i,s)=>Wn(NK,Wa(NK,s.camera.viewMatrix,s.camera.center))),new mr("nearFar",(i,s)=>s.camera.nearFar)),r.constants.add("sampleValue","float",Ptt),r.code.add(b`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),e}const NK=xe(),$tt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:Fye,ShadowCastMaxSamples:FD,build:Mtt},Symbol.toStringTag,{value:"Module"}));var Z1;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(Z1||(Z1={}));let Vz=class extends Bo{constructor(){super(...arguments),this.visualization=Z1.Gradient,this.bandsEnabled=!1}};h([D({count:Z1.COUNT})],Vz.prototype,"visualization",void 0),h([D()],Vz.prototype,"bandsEnabled",void 0);let Uye=class extends Ar{constructor(e){super(),this.shadowCastMap=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=aA(Itt),this.bandSize=.1,this.threshold=.5}};const Itt=Ct(.01,0,.25,1);function Ltt(t){const e=new ur,r=e.fragment;r.include(Ll),r.include(xc),e.include(bD),e.include(Ac);const{visualization:i,bandsEnabled:s}=t;r.constants.add("inverseSampleValue","float",FD),r.uniforms.add(new We("shadowCastMap",a=>a.shadowCastMap),new Se("sampleScale",a=>a.sampleScale),new Se("opacityFromElevation",a=>a.opacityFromElevation),new Wt("uColor",a=>a.color));const n=i===Z1.Gradient,o=i===Z1.Threshold;return n&&s?r.uniforms.add(new Se("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Se("threshold",a=>a.threshold)),r.code.add(b`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?b`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?b`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?b`* strength`:""});
      }
    `),e}const Dtt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Uye,build:Ltt},Symbol.toStringTag,{value:"Module"}));let zye=class kye extends gr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new pr(e.rctx,kye.shader.get().build(this.configuration),cr)}initializePipeline(){return xt({blending:gc,colorWrite:$t,depthTest:null,depthWrite:null})}get primitiveType(){return vt.TRIANGLE_STRIP}};zye.shader=new dr(Dtt,()=>he(()=>import("./ShadowCastVisualize.glsl-a569a8f2.js"),[]));const Ntt=4e4,Ftt=5e4,Bye=1/512;let eM=class extends we{constructor(e,r,i,s){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=s,this._passParameters=new Uye(this._data.shadowCastTexture),this._techniqueConfig=new Vz,this._enabled=!1,this._vao=Xa(r),this._techniqueConfig.visualization=Z1.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Ue(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(zye,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,co(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>Bye}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;Pw(e,r)||(gu(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([f()],eM.prototype,"opacityFromElevation",null),eM=h([F("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],eM);let sj=class extends Bo{constructor(){super(...arguments),this.receiveShadows=!0}};h([D()],sj.prototype,"receiveShadows",void 0);let Vye=class Gye extends gr{constructor(e){super(e,new sj,()=>this.destroy())}initializeProgram(e){return new pr(e.rctx,Gye.shader.get().build(this.configuration),cr)}initializePipeline(){return xt({blending:Xn(_e.ONE,_e.ONE,_e.ONE,_e.ONE),colorWrite:$t,depthTest:null,depthWrite:null})}get primitiveType(){return vt.TRIANGLE_STRIP}};Vye.shader=new dr($tt,()=>he(()=>import("./ShadowCastAccumulate.glsl-396551a6.js"),[]));let Ma=class extends we{constructor(e,r,i,s,n,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new Fye,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=Lz,this._previewing=!1,this._handles=new Oi,this._cameraForcedForScreenshot=!1,this._bindParameters=new DL(new aG(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Xa(e);const a=new xr;a.wrapMode=Ot.CLAMP_TO_EDGE,this._fbo=new As(e,a),this._accumulationRenderer=new eM(r,e,this,o);const l=this._stage.view.resourceController.scheduler;this._handles.add([l.registerTask(nt.SHADOW_ACCUMULATOR,this),ce(()=>i.renderView,c=>{this._handles.remove(FK),c!=null&&this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),FK)},Ss),ce(()=>this._previewing,()=>this._requestRenderIfEnabled(),Nr)])}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Ue(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ue(this._fbo),this._vao=Ue(this._vao),this._accumulationTechniqueCached=vi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new Vye(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==Lz&&this._opacityFromElevation>Bye}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(Kf(r,e,M0))return;const i=Math.min(FD,e.length);r.length=i,this._sampleCount=i;for(let s=0;s<i;++s)r[s]=te(r[s]??C(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,s){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Utt,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||r<0||r>this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,Pt.RGBA,Cs.UNSIGNED_BYTE,UK),UK[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(mi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,co(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*ztt%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-qE(Ntt,Ftt,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};h([f()],Ma.prototype,"_progress",void 0),h([f()],Ma.prototype,"_sampleCount",void 0),h([f()],Ma.prototype,"_enabledInternal",void 0),h([f()],Ma.prototype,"_depthRange",void 0),h([f()],Ma.prototype,"_previewing",void 0),h([f()],Ma.prototype,"_accumulationRenderer",void 0),h([f()],Ma.prototype,"_isRefining",null),h([f()],Ma.prototype,"_isActive",null),h([f()],Ma.prototype,"canAccumulate",null),h([f()],Ma.prototype,"_isDoneAccumulating",null),h([f()],Ma.prototype,"_opacityFromElevation",null),h([f()],Ma.prototype,"running",null),Ma=h([F("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Ma);const Utt=6,FK="renderView",ztt=104729,UK=new Uint8Array(4),zK={highlightedThreshold:.99999,selfShadowThreshold:.025};function ktt(t){const e=new ur;e.include(H1,t);const r=e.fragment;return r.include(Ll),r.include(xc),e.include(bD),e.include(Ac),r.uniforms.add(new We("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(zx.Default)),new We("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(zx.Highlight)),new We("depthMap",(i,s)=>s.linearDepthTexture),new We("highlightMap",(i,s)=>s.highlightColorTexture),new Wt("uColor",i=>i.shadowColor),new mr("nearFar",(i,s)=>s.camera.nearFar),new Se("opacity",i=>i.shadowOpacity),new Se("occludedOpacity",i=>i.occludedShadowOpacity),new Se("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Mt("lightingMainDirectionView",(i,s)=>fe(BK,De(BK,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new mr("texelSize",(i,s)=>s.linearDepthTexture!=null?Qt(Btt,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):Kh),new wi("inverseViewMatrix",(i,s)=>Wn(kK,Wa(kK,s.camera.viewMatrix,s.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",bde).add("highlightedThreshold","float",zK.highlightedThreshold).add("selfShadowThreshold","float",zK.selfShadowThreshold),r.code.add(b`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(b`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const kK=xe(),BK=C(),Btt=Ie(),Vtt=Object.freeze(Object.defineProperty({__proto__:null,build:ktt},Symbol.toStringTag,{value:"Module"}));let Gtt=class extends Ar{constructor(){super(...arguments),this.shadowColor=Ct(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},jye=class Hye extends gr{constructor(e){super(e,new sj,()=>this.destroy())}initializeProgram(e){return new pr(e.rctx,Hye.shader.get().build(this.configuration),cr)}initializePipeline(){return xt({blending:Xn(_e.SRC_ALPHA,_e.ONE,_e.ONE_MINUS_SRC_ALPHA,_e.ONE_MINUS_SRC_ALPHA),colorWrite:$t,depthTest:null,depthWrite:null})}get primitiveType(){return vt.TRIANGLE_STRIP}};jye.shader=new dr(Vtt,()=>he(()=>import("./ShadowHighlight.glsl-3a16a59b.js"),[]));const jtt=.001953125,Htt=4e4,Wtt=5e4;let qtt=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new Gtt,this._drawParameters=new Pfe,this._vao=Xa(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new jye({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,co(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.size)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-qE(Htt,Wtt,e.relativeElevation);const i=this._viewingMode===Re.Global?fe(VK,e.center):se(VK,0,0,1),s=pe(i,r);this._passParameters.dayNightTerminator=qE(0,1,me(30*s,0,1))}dispose(){this._vao=Ue(this._vao),this._techniqueCached=vi(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=jtt}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const VK=C(),GK=_m();let Ytt=class{constructor(){this._plane=_m()}get isEnabled(){return!wae(this.plane,GK)}get plane(){return this._plane}set plane(e){lv(e||GK,this._plane)}},Xtt=class extends Ar{};function FC(t){t.uniforms.add(new Wt("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,s=r.height;return oi(Ztt,1/i,1/s,i,s)}))}const Ztt=Ht(),vb={maxSearchSteps:8,maxDistanceAreaTex:16};function Jtt(){const t=new ur,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(S.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),FC(i),i.code.add(b`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.int(vb.maxSearchSteps)} );
      }
    `),s.uniforms.add(new We("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new We("areaTexture",n=>n.areaTexture)),s.uniforms.add(new We("searchTexture",n=>n.searchTexture)),FC(s),s.code.add(b`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(vb.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(vb.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(vb.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(vb.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.int(vb.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const Qtt=Object.freeze(Object.defineProperty({__proto__:null,build:Jtt},Symbol.toStringTag,{value:"Module"}));let Wye=class qye extends gr{initializeProgram(e){return new pr(e.rctx,qye.shader.get().build(),cr)}initializePipeline(){return xt({colorWrite:$t})}};Wye.shader=new dr(Qtt,()=>he(()=>import("./BlendWeights.glsl-4c1f887f.js"),[]));function Ktt(){const t=new ur,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(S.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),FC(i),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new We("blendWeightsTexture",n=>n.blend.colorTexture),new We("colorTexture",n=>n.colorTexture)),FC(s),s.code.add(b`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const ert=Object.freeze(Object.defineProperty({__proto__:null,build:Ktt},Symbol.toStringTag,{value:"Module"}));let Yye=class Xye extends gr{initializeProgram(e){return new pr(e.rctx,Xye.shader.get().build(),cr)}initializePipeline(){return xt({colorWrite:$t})}};Yye.shader=new dr(ert,()=>he(()=>import("./Blur.glsl-2d80879d.js"),[]));const jK={threshold:.05,localConstrastAdaption:2};function trt(){const t=new ur,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(S.POSITION,"vec2"),FC(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new We("colorTexture",n=>n.colorTexture)),s.code.add(b`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.float(jK.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${b.float(jK.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const rrt=Object.freeze(Object.defineProperty({__proto__:null,build:trt},Symbol.toStringTag,{value:"Module"}));let Zye=class Jye extends gr{initializeProgram(e){return new pr(e.rctx,Jye.shader.get().build(),cr)}initializePipeline(){return xt({colorWrite:$t})}};Zye.shader=new dr(rrt,()=>he(()=>import("./EdgeDetect.glsl-52387f7f.js"),[]));let GS=class extends we{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new Xtt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=yc(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const r=this._abortController.signal;return he(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return qt(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,wt.LINEAR,Pt.RGB),this._loadTextureFromBase64(e.searchTexure,wt.NEAREST,Pt.LUMINANCE)]).then(([i,s])=>{Js(r)?(i.dispose(),s.dispose(),qt(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=s)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const i=new Bo;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(Zye,i,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(Wye,i,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(Yye,i,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=vIe(this._rctx);const r=new xr(4,4);return r.pixelFormat=Pt.RGB,r.wrapMode=Ot.CLAMP_TO_EDGE,this._passParameters.edges=new As(this._rctx,r),r.pixelFormat=Pt.RGBA,this._passParameters.blend=new As(this._rctx,r),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=Ue(this._vao),this._passParameters.areaTexture=Ue(this._passParameters.areaTexture),this._passParameters.searchTexture=Ue(this._passParameters.searchTexture),this._passParameters.blend=Ue(this._passParameters.blend),this._passParameters.edges=Ue(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(r==null)return;r.colorTexture=e;const i=this._rctx,s=i.getBoundFramebufferObject(),n=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,n,o),r.edges.resize(n,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(mi.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(vt.TRIANGLES,0,3),r.blend.resize(n,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(mi.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(vt.TRIANGLES,0,3),i.bindFramebuffer(s),i.setClearColor(0,1,0,1),i.clear(mi.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(vt.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return hm(e).then(s=>{const n=new xr;return n.pixelFormat=i,n.wrapMode=Ot.CLAMP_TO_EDGE,n.width=s.width,n.height=s.height,n.samplingMode=r,new bt(this._rctx,n,s)})}};h([f()],GS.prototype,"_abortController",void 0),h([f({readOnly:!0})],GS.prototype,"updating",null),GS=h([F("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],GS);function irt(t,e){const r=-t[0],i=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*r,e[1]+=n*i,e[2]+=n*s,e[4]+=o*r,e[5]+=o*i,e[6]+=o*s,e[8]+=a*r,e[9]+=a*i,e[10]+=a*s,e[12]+=l*r,e[13]+=l*i,e[14]+=l*s}function srt(t,e){const r=t[0],i=t[1],s=t[2];e[12]+=r*e[0]+i*e[4]+s*e[8],e[13]+=r*e[1]+i*e[5]+s*e[9],e[14]+=r*e[2]+i*e[6]+s*e[10],e[14]+=r*e[3]+i*e[7]+s*e[11]}let nrt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new ort(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{en(r.viewMatrix,e),srt(r.origin.vec3,r.viewMatrix)})}},ort=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=xe()}},art=class extends Fce{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=Zi()}},lrt=class extends Uce{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Zi(),this.slicePlaneLocalOrigin=C(),this.transformNormalGlobalFromModel=Zi()}};function crt(t){const e=b`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const urt=ir(.5,-4e-4);function hrt(t,e){const r=t.vertex;r.include(crt),r.constants.add("depthBias","vec2",urt),r.uniforms.add(new mr("inverseViewport",(i,s)=>s.inverseViewport)),e.legacy?(r.uniforms.add(new wi("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new kp("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new wi("transformProjFromView",i=>i.transformProjFromView)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(b`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function drt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(b`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(b`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function prt(t,e){const r=t.vertex;e.silhouette?(r.code.add(b`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function frt(t,e){const r=t.vertex;r.include(Ll),r.uniforms.add(new Se("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(b`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new wu("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(S.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*ej),r.code.add(b`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new uC("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(S.NORMALA,"vec3"),t.attributes.add(S.NORMALB,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(S.NORMAL,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(b`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(p$,e),r.include(p$,e),r.uniforms.add(new kp("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new uC("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new mc("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new mc("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Mt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Mt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(b`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?b`normalize(transformWorldFromModelTL + rotatedModelPosition);`:b`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new wi("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(b`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function mrt(t){return t.mode===zs.SKETCH||t.mode===zs.MIXED}var zs,H_;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(zs||(zs={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(H_||(H_={}));function nj(t,e){const r=t.vertex;switch(t.attributes.add(S.SIDENESS,"vec2"),e.mode===zs.MIXED?r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case zs.MIXED:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case zs.SKETCH:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case zs.SOLID:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case zs.COUNT:break;default:e.mode}}function grt(t,e){const r=t.vertex;switch(t.include(nj,e),e.mode){case zs.SOLID:r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case zs.SKETCH:r.uniforms.add(new c1("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case zs.MIXED:r.uniforms.add(new c1("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function yrt(t,e){t.include(nj,e);const{vertex:r,fragment:i}=t;switch(mrt(e)&&(r.uniforms.add(new wu("strokesTexture",s=>s.strokesTexture.texture)),r.uniforms.add(new c1("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new c1("strokeVariants",s=>s.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new wu("strokesTexture",s=>s.strokesTexture.texture),new c1("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),r.code.add(b`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Ll),i.code.add(b`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case zs.SOLID:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(b`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case zs.SKETCH:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(b`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case zs.MIXED:t.varyings.add("vType","float"),r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(b`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function _rt(t){const e=new ur,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new HK("model"),new HK("localView")),e.include(hrt,t),e.include(frt,t),e.include(grt,t),e.include(nj,t),e.include(yrt,t),e.include(rs,t),e.include(prt,t),e.include(drt,t),e.include(Tc,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new mr("pixelToNDC",(s,n)=>Qt(vrt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Wt("viewport",(s,n)=>n.camera.fullViewport),new Se("pixelRatio",(s,n)=>n.camera.pixelRatio)),e.attributes.add(S.POSITION0,"vec3"),e.attributes.add(S.POSITION1,"vec3"),e.attributes.add(S.VARIANTOFFSET,"float"),e.attributes.add(S.VARIANTSTROKE,"float"),e.attributes.add(S.VARIANTEXTENSION,"float"),r.code.add(b`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?b`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:b`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===zs.SKETCH?b`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===zs.MIXED?b`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(b`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const vrt=Ie();let HK=class extends Ji{constructor(e){super(e,"mat4")}};const brt=Object.freeze(Object.defineProperty({__proto__:null,build:_rt},Symbol.toStringTag,{value:"Module"}));let Qye=class Kye extends gr{initializeProgram(e){return new pr(e.rctx,Kye.shader.get().build(this.configuration),cye)}initializePipeline(e){return e.blendMinMax?xt({blending:Xn(_e.ONE,_e.ONE,_e.ZERO,_e.ONE,Op.ADD,e.blendMinMax.MAX),depthTest:{func:Br.LEQUAL},colorWrite:$t}):xt({depthTest:{func:Br.LEQUAL},depthWrite:Ya,colorWrite:$t})}};Qye.shader=new dr(brt,()=>he(()=>import("./EdgeShader.glsl-011b2dd2.js"),[]));let qd=class extends uo{constructor(){super(...arguments),this.mode=zs.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};h([D({count:zs.COUNT})],qd.prototype,"mode",void 0),h([D()],qd.prototype,"hasSlicePlane",void 0),h([D()],qd.prototype,"silhouette",void 0),h([D()],qd.prototype,"legacy",void 0),h([D()],qd.prototype,"antialiasing",void 0),h([D()],qd.prototype,"doublePrecisionRequiresObfuscation",void 0),h([D()],qd.prototype,"hasMultipassTerrain",void 0),h([D()],qd.prototype,"cullAboveGround",void 0),h([D()],qd.prototype,"spherical",void 0);const wrt=8,lF=128,xrt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},Trt={solid:zs.SOLID,sketch:zs.SKETCH,uber:zs.MIXED};let cF=class e_e{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new qd,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Dt.TRANSPARENT]:{[Dt.TRANSPARENT]:new Nt,[Dt.OPAQUE]:new Nt},[Dt.OPAQUE]:{[Dt.TRANSPARENT]:new Nt,[Dt.OPAQUE]:new Nt}},this._renderablesDirty=!1,this._drawParameters=new lrt,this._settings={...xrt,...i},this.key=e_e.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:kr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=Trt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=vi(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){if(this._renderablesDirty&&this._sortRenderables(),r!==Dt.INVISIBLE){const i=this._sortedRenderables[r];i[Dt.TRANSPARENT].forAll(e),i[Dt.OPAQUE].forAll(e)}}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(Qye,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,s,n){this._render(e,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(e,r,i,s,n){this._render(e,r,r.silhouette.vao,i,s,n)}_render(e,r,i,s,n,o){o>0&&(this._bindDraw(e,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(vt.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new ND(r.transform.position),o=Du(WK,uv(WK,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Dt.TRANSPARENT][Dt.TRANSPARENT].clear(),this._sortedRenderables[Dt.TRANSPARENT][Dt.OPAQUE].clear(),this._sortedRenderables[Dt.OPAQUE][Dt.TRANSPARENT].clear(),this._sortedRenderables[Dt.OPAQUE][Dt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==Dt.INVISIBLE&&r.edgeTransparency!==Dt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Dt.TRANSPARENT][Dt.TRANSPARENT].sort(e),this._sortedRenderables[Dt.TRANSPARENT][Dt.OPAQUE].sort(e),this._sortedRenderables[Dt.OPAQUE][Dt.TRANSPARENT].sort(e),this._sortedRenderables[Dt.OPAQUE][Dt.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const WK=Ha();function Lxt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new XLe(t.layout)}}function bR(t){return new eue(t.layout).createView(t.buffer)}let Srt=class extends Xge{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return get(e);const s=await this.invoke(new uF(e),r);return this._unpackOutput(s)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new uF(e),r);return bR(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new uF(e),r);return bR(i)}_unpackOutput(e){return{regular:{instancesData:bR(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:bR(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},uF=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Yh(e.indices)?e.indices:e.indices.buffer,this.indicesType=Yh(e.indices)?"Array":PI(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function Ert(t){const r=OT.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=OT.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,u=OT.strokes.length;let d=(c-1)*u*l;for(const{distance:y,pressure:_}of OT.strokes){let v=y,w=_,T=d;for(let x=0;x<c;x++){x!==0&&(v=qK(v,UC.DISTANCE),w=qK(w,UC.PRESSURE));for(let E=0;E<OT.resolution;E++){const O=.5+(v?v[E%v.length]/a:0),A=w?w[E%w.length]:1;vC(O,s,T),vC(A,s,T+n),T+=4}T-=l*(u+1)}d+=l}const p=new xr;p.width=p.height=r;const g=new bt(t,p,s);return new Art(r,a,o,u,g)}function qK(t,e){if(!t)return null;const r=t.length/2,i=Crt*r,s=new Array(r);let n=0;const o=e===UC.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*YK):Math.min(i,l*YK)}return s}var UC;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(UC||(UC={}));const Crt=.1,YK=.5;let Art=class{constructor(e,r,i,s,n){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=Ue(this.texture)}};const OT={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function XK(t){let e=null;for(const r of t){const i=r.type;if(Ort(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function ZK(t){let e=Dt.INVISIBLE;for(const{material:r}of t)if(t_e(r)){if(r.color[3]*r.opacity<1)return Dt.TRANSPARENT;e=Dt.OPAQUE}return e}function JK(t){let e=Dt.INVISIBLE;for(const{material:r}of t)if(t_e(r)){switch(r.objectTransparency){case Dt.TRANSPARENT:case Dt.INVISIBLE:return Dt.TRANSPARENT;case Dt.OPAQUE:if(r.opacity<1)return Dt.TRANSPARENT}e=Dt.OPAQUE}return e}function t_e(t){return t.size*t.color[3]*t.opacity>0}function Ort(t){return t.size*t.color[3]>0}function QK(t,e,r,i){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let yh=class extends we{constructor(t){super(t),this._updatingHandles=new mp,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=C(),this._localOrigins=new nrt(new oG(t.renderSR))}initialize(){this._worker=new Srt(this.schedule),this._componentColorManager=new dye(this.rctx,3);const t=aye.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=br.createVertex(this.rctx,hr.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=Ue(this._strokesTexture),this._componentColorManager=Oe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=Ue(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",Lrt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,r,i,s,n,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new eee(new Promise(d=>l=d),r.center,r.radius);this._perObjectData.set(t,c);const u=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,i,s,n,o,a));return this.setNeedsRender(),l(),u}async addOrUpdateObject3D(t,e,r,i){if(this.destroyed)return void ne.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(t);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const o=t.boundingVolumeWorldSpace.bounds,a=new eee(new Promise(c=>n=c),o,jf(o));this._perObjectData.set(t,a);const l=new Array;if(r.mergeGeometries&&t.geometries.length>1&&Rrt(t))l.push(this._addObjectMergedGeometries(t,a,e,r,i));else for(let c=0;c<t.geometries.length;c++){const u=t.geometries[c];u.material.supportsEdges&&l.push(this._addGeometry(t,a,u,e[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(r==null)return;const i=e instanceof Array?s=>e[s]:()=>e;r.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=i(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,r,i){const s=t instanceof Rm,n=!!r.hasSlicePlane,o=XK(e),a=cF.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const u=this._renderers.get(c.rendererKey),d=this._acquireRenderer(o,n,s);u.removeRenderable(c),--u.refCount,c.rendererKey=a,d.addRenderable(c)}for(let u=0;u<e.length;u++)c.components.meta[u].material=e[u];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>{const s=i.components.meta;for(let n=0;n<s.length;n++)i.components.meta[n].verticalOffset=(e==null?void 0:e[n])??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>i.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const r=t.camera.viewInverseTransposeMatrix,i=C(),s=new ND;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,u=!0;l.forEachRenderable(d=>{d.visible&&(n+=d.statistics.averageEdgeLength,o++,c&&d.regular&&(l.updateTechnique(t,!1),c=!1),u&&d.silhouette&&(l.updateTechnique(t,!0),u=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new art(40*n/o,e);se(i,r[3],r[7],r[11]),s.set(i),te(a.transformWorldFromViewTH,s.high),te(a.transformWorldFromViewTL,s.low),Lu(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),Du(see,a.transformViewFromCameraRelativeRS),uv(a.transformNormalViewFromGlobal,see),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=ZK(t.components.meta),r=JK(t.components.meta);e===t.edgeTransparency&&r===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=r,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,r){t.getCombinedStaticTransformation(e,r);const i=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(se(this._tmpModelPosition,r[12],r[13],r[14]));return e.localOrigin=i.origin,irt(i.origin.vec3,r),i}_updateComponentBuffer(t){const{meta:e,buffer:r}=t,i=new Uint8Array(4);for(let s=0;s<e.length;s++){const n=e[s].material,o=e[s].index,a=me(Math.round(n.size*wrt),0,255),l=me(n.extensionLength,-lF,255-lF)+lF,c=n.type==="solid"?gI.SOLID:gI.SKETCH,u=255*n.opacity,d=n.color,p=255*d[0],g=255*d[1],y=255*d[2],_=255*d[3];r.textureBuffer.setData(o,0,p,g,y,_),r.textureBuffer.setData(o,1,a,l,c,u),iye(e[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,r=this._componentColorManager.getBuffer(t.length);for(let s=0;s<t.length;s++){const n=t[s],o=r.acquireIndex();e.push({index:o,verticalOffset:0,material:n})}const i=new Prt(r,e);return this._updateComponentBuffer(i),i}_extractEdges(t,e,r,i,s,n=s.length){return this._worker.process({data:e,indices:s,indicesLength:n,writerSettings:t,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(t,e,r,i,s){const n=c=>this._verticesBufferObject!=null?new Mrt(new sd(this.rctx,cye,{vertices:set,instances:c===H_.REGULAR?fI.glLayout:mI.glLayout},{vertices:this._verticesBufferObject,instances:br.createVertex(this.rctx,hr.STATIC_DRAW,c===H_.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===H_.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?n(H_.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?n(H_.SILHOUETTE):null,l=(o!=null?o.vao.size:0)+(a!=null?a.vao.size:0);return new Irt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:t.averageEdgeLength},r,ZK(e.meta),JK(e.meta),e,i)}async _addGeometry(t,e,r,i,s,n){const o=r.vertexAttributes.get(S.POSITION),a=r.indices.get(S.POSITION),l=xe(),c=this._computeModelTransformWithLocalOrigin(t,r,l),u=new iee(o,a,l,c);return this._addPositionData(e,u,r.edgeIndicesLength,i,s,n)}async _addPositionData(t,e,r,i,s,n=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([i]);if(o==null||r<=0)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,u=e.indices,d=e.position,p=d.data.length/d.size,g=dI.createBuffer(p);for(let v=0;v<p;v++)g.position.set(v,0,d.data[v*d.size]),g.position.set(v,1,d.data[v*d.size+1]),g.position.set(v,2,d.data[v*d.size+2]);QK(o.meta,[0,g.componentIndex.count],g.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,g,!1,n,u,r));if(t.loaded==null)return;const _=this._createRenderable(y,o,new $rt(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,r,i,s,n,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(n);if(a==null)return 0;const l=XK(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=dI.createBuffer(r.length/3);$A(u.position.typedBuffer,r,u.position.typedBufferStride,3),QK(a.meta,s,u.componentIndex,i);const d=!0,p=c.writerSettings,g=await this._updatingHandles.addPromise(this._extractEdges(p,u,d,!1,i));if(e.loaded==null)return 0;const y=this._createRenderable(g,a,t,c.key,!0);return e.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,r,i,s){const n=new Map;let o=0,a=null,l=0;for(let w=0;w<t.geometries.length;w++){const T=t.geometries[w];if(!T.material.supportsEdges)continue;!a&&T.localOrigin&&(a=T);const x=T.vertexAttributes.get(S.POSITION);l+=x.data.length/x.size,o+=T.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,u=o?new c(o):null,d=[];let p=0;for(let w=0;w<t.geometries.length;w++){const T=t.geometries[w];if(!T.material.supportsEdges)continue;const x=T.vertexAttributes.get(S.POSITION),E=T.indices.get(S.POSITION);let O=n.get(x.data);if(O==null){O=d.length/3;for(let A=0;A<x.data.length;A+=x.size)d.push(x.data[A]),d.push(x.data[A+1]),d.push(x.data[A+2]);n.set(x.data,O)}if(E)for(let A=0;A<T.edgeIndicesLength;A++)u[p++]=O+E[A]}const g=a||t.geometries[0],y=xe(),_=this._computeModelTransformWithLocalOrigin(t,g,y);for(let w=0;w<t.geometries.length;w++)t.geometries[w].localOrigin=_.origin;const v=new iee({data:d,size:3},u,y,_);await this._updatingHandles.addPromise(this._addPositionData(e,v,u.length,r[0],i,s))}_acquireRenderer(t,e,r){const i=cF.getKey(t,e,r);let s=this._renderers.get(i);return this._strokesTexture==null&&(this._strokesTexture=Ert(this.rctx)),s||(s=new cF(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===Re.Global}),this._renderers.set(i,s)),++s.refCount,s}_removeRenderable(t){KK(t.regular),KK(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const r of t.components.meta)t.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,r=t.camera.viewForward,i=C(),s=n=>{_n(i,n.center,e);const o=pe(i,r),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(t,e,r){const i=t.bindRegularEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!tee(o)||!o.visible)return;const a=wR(o.regular.lod.lengths,o.distanceToCamera,n);t.renderRegularEdges(i,o,r,e,a)},s)}_renderSilhouetteEdges(t,e,r){const i=t.bindSilhouetteEdges(r,e),s=r.transparency,n=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!ree(o)||!o.visible)return;const a=wR(o.silhouette.lod.lengths,o.distanceToCamera,n);t.renderSilhouetteEdges(i,o,r,e,a)},s)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const r=t.perScreenPixelRatio,i=(s,n)=>s.forEachRenderable(o=>{o.visible&&!e&&(tee(o)&&(e=wR(o.regular.lod.lengths,o.distanceToCamera,r)>0),!e&&ree(o)&&(e=wR(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},n);return this._renderers.forEach(s=>{e||(i(s,Dt.OPAQUE),i(s,Dt.TRANSPARENT))}),e}}}};function KK(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.dispose(!1),t.vao=null)}function Rrt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const s=t.geometries[i];if(s.material.supportsEdges){if(e){if(!Kf(e,s.transformation))return!1}else e=s.transformation;if(r||s.localOrigin==null){if(r&&r.localOrigin!=null&&s.localOrigin!=null&&r.localOrigin.id!==s.localOrigin.id)return!1}else r=s}}return!0}h([f({constructOnly:!0})],yh.prototype,"rctx",void 0),h([f({constructOnly:!0})],yh.prototype,"renderSR",void 0),h([f({constructOnly:!0})],yh.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],yh.prototype,"techniqueRepository",void 0),h([f({constructOnly:!0})],yh.prototype,"setNeedsRender",void 0),h([f({constructOnly:!0})],yh.prototype,"schedule",void 0),h([f({readOnly:!0})],yh.prototype,"_updatingHandles",void 0),h([f({readOnly:!0})],yh.prototype,"updating",null),yh=h([F("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],yh);class eee{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}let Prt=class{constructor(e,r){this.buffer=e,this.meta=r}};class Mrt{constructor(e,r){this.vao=e,this.lod=r}}class $rt{constructor(e,r){this.modelMatrix=e,this.origin=r}}let Irt=class{constructor(e,r,i,s,n,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function tee(t){return t.regular!=null}function ree(t){return t.silhouette!=null}function wR(t,e,r){const i=e*r,s=g1e(t,i,!0);return s===-1?i<t[0]?t.length:0:t.length-s}class iee{constructor(e,r,i,s){this.position=e,this.indices=r,this.modelTransform=i,this.origin=s}}const see=Zi(),Lrt=()=>Promise.reject();function ad(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let nee=class{constructor(e,r,i,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},Sf=!1;function Drt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&ad(t)?new nee(()=>t.createQuery(),i=>{t.deleteQuery(i),Sf=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{Sf||(Sf=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),Sf=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new nee(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),Sf=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{Sf||(Sf=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),Sf=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function Nrt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new Frt(r,e)}let Frt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){Sf||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var ni;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(ni||(ni={}));const oee="Total";let Urt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Uf(oee),this._cpuTimeSamplers=new Map(Object.values(ni).map(r=>[r,new Uf(r)])),this._enableGPUTimer=0,this._totalGPUTime=new Uf("GPU"),this._gpuTimeSamplers=new Map(Object.values(ni).map(r=>[r,new Uf(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const e=[...Object.values(ni),oee];this._gpuTimerPool=Nrt(this._rctx,e)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:ek(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Ue(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(ni.FINISH);this._gpuTimeSamplers.get(ni.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},ll=class extends we{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(t,e=this._state){return this._renderStateFeatures.get(e,t)??!1}setFeatureEnabled(t,e,r){this._renderStateFeatures.set(e,t,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Ts.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Ts.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Ts.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(t,e,r,i,s,n,o,a){super({}),this._stage=t,this._materialRepository=e,this._techniqueRepository=i,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new Nt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new Ytt,this._state=vr.IDLE,this._renderStateFeatures=pY(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=Ws.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new ott,this._handles=new Oi,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new GS(this._rctx,i),a(),this._offscreen=new Ctt(this._rctx,this._compositingHelper),this.performanceInfo=new Urt(this._rctx),this._shadowMap=new aG(this._rctx,t.viewingMode),this._ssaoHelper=new Hfe(t.view,i,this._rctx,a),this._highlight=new xtt(i,this._rctx),this._shadowHighlight=new qtt(this._rctx,t.viewingMode),this._shadowAccumulator=new Ma(this._rctx,i,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,u)=>{l.shadowMap.start(l.camera,c,u,!0),this._renderShadowCascades(L.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new wBe(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new VS({renderContext:this._renderContext,techniqueRepository:i,textureRepository:r,materialRepository:this._materialRepository,requestRender:a,controller:t}),this.renderPassManager=new ntt(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ce(()=>this._stage.view.state.camera,()=>a(),Ss),ce(()=>kr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(Dt.TRANSPARENT):()=>{},a()},Tr),ce(()=>this._ssaoEnabled||this.isFeatureEnabled(Ts.SSAO),l=>this._ssaoHelper.enabled=l,Ss)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=bi(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=Ue(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Oe(this._edgeView),this.renderPassManager.destroy(),oue.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const t=this._stage.view.resourceController;this._edgeView=new yh({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:zrt(t)}),this._handles.add(ce(()=>fo(this._edgeView,e=>e.updating),()=>this._requestRender(),Nr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return zB(this._bindParameters.ssr.reprojectionMatrix,qa)}set _reprojectionMatrix(t){Yz(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var t;return!!((t=this._shadowMap)!=null&&t.enabled)}setParameters(t){var i,s;const{_shadowMap:e,_bindParameters:r}=this;if(((i=t.qualitySettings)==null?void 0:i.reflections)!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),((s=t.qualitySettings)==null?void 0:s.ambientOcclusion)!==void 0&&this._ssaoEnabled!==t.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=t.qualitySettings.ambientOcclusion,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);const n=t.environment.lighting.type!=="virtual";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}t.background&&this._offscreen.background!==t.background&&(this._offscreen.background=t.background,this._requestRender()),t.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==t.antialiasingEnabled&&(this._antialiasingEnabled=t.antialiasingEnabled,this._requestRender()),t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(t.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(t.defaultHighlightOptions),this._requestRender()),t.overlays!==void 0&&this._bindParameters.overlays!==t.overlays&&(this._bindParameters.overlays=t.overlays,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.renderOverlay!==void 0&&this._renderOverlay!==t.renderOverlay&&(this._renderOverlay=t.renderOverlay,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==t.terrainRenderingEnabled&&(this._terrainRenderingEnabled=t.terrainRenderingEnabled,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:s}=t;if(r.length===0&&i.length===0&&s.length===0)return;const n=Sfe(t);let o=!1;n.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(u=>u.material===l);c==null&&a.adds.length>0&&(c=new Ufe(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(u=>t.removes.removeUnordered(u)),a.adds.forEach(u=>t.adds.removeUnordered(u)),a.updates.forEach(u=>t.updates.removeUnordered(u)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(ae.LINE_CALLOUTS_HUD_DEPTH,L.Color)||a.requiresSlot(ae.HUD_MATERIAL,L.Color)||a.requiresSlot(ae.LABEL_MATERIAL,L.Color)),this._requestRender()}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?bi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(t,e,r,i,s){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:n,contentCamera:o,mode:a,alignPixelEnabled:l}=r;this._state=a,this._renderOverlay(s),this.performanceInfo.advance(ni.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=Ze.NONE,this._bindParameters.alignPixelEnabled=l;const c=this._offscreen;c.setupRenderTarget(this.hasReflections);const u=_m(this._sliceHelper.plane);i===D1.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(t),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(ni.PREPARE);const d=this._computeDepthRange(n);this._renderShadowMap(t,n,this._bindParameters.lighting.mainLight.direction,d),this.performanceInfo.advance(ni.SHADOW_MAP),c.initializeFrame(n),this._ensureBindParameters(n,o);const p=this._terrainRenderingEnabled&&(this._terrainTransparency===Ws.Semitransparent||this._terrainTransparency===Ws.TransparentWithDraped),g=this._highQualityTransparency&&p,y=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(g,y),this._renderLinearDepth(),this.performanceInfo.advance(ni.LINEAR_DEPTH),this._accumulateShadows(d,n,o),this.performanceInfo.advance(ni.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(ni.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(ni.SSAO),this._renderContext.output=L.Color,c.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(ni.OPAQUE),this._renderTerrainLinearDepth(g),this._setMultipassTerrain(g),this._renderEdges(Dt.OPAQUE),this.performanceInfo.advance(ni.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(ae.VOXEL),this.performanceInfo.advance(ni.VOXEL),this._renderHiddenTransparentEdges(),y&&(this._oitEnabled?this._renderOITPass(Sw.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(ni.TRANSPARENT),this._renderGeometryLinearDepth(g);const _=this._renderHUDVisibility(g);g||this._renderInternalSlot(ae.LINE_CALLOUTS),this.performanceInfo.advance(ni.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(ni.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Dt.TRANSPARENT,g),this.performanceInfo.advance(ni.TRANSPARENT_EDGES),this._renderTransparentTerrain(),p&&_&&(g?this._renderLineCallouts(dl.Occluded):c.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(dl.Occluded,c.framebuffer),this.performanceInfo.advance(ni.HUD_OCCLUDED)),this.performanceInfo.advance(ni.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),p&&(c.compositeTransparentTerrainOntoMain(this._bindParameters),g&&(this._renderEdges(Dt.OPAQUE),this.performanceInfo.advance(ni.OPAQUE_EDGES),y&&(this._oitEnabled?this._renderOITPass(Sw.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(ni.TRANSPARENT),this._renderEdges(Dt.TRANSPARENT),this.performanceInfo.advance(ni.TRANSPARENT_EDGES))),g&&this._renderLineCallouts(dl.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),c.renderToTargets(()=>{this._renderInternalSlot(ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(ae.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(ae.LASERLINES)},c.currentColorTarget,c.mainDepth),this.performanceInfo.advance(ni.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&c.renderTmpAndCompositeToMain(()=>this._renderSlot(ae.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Do.PremultipliedAlpha),this.performanceInfo.advance(ni.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(ni.OCCLUDED);const v=i===D1.ON&&this._magnifierHelper.enabled,w=v&&t==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):t;this._rctx.bindFramebuffer(w);const T=this._offscreen.colorTexture;this._renderAntiAliasing(T)||T==null||this._compositingHelper.composite(this._bindParameters,T,Do.None),this.performanceInfo.advance(ni.ANTIALIASING),this._renderHUD(dl.NotOccluded,w),this.performanceInfo.advance(ni.HUD),this._renderHighlights(w,this._bindParameters),this.performanceInfo.advance(ni.HIGHLIGHTS),v&&this._magnifierHelper.render(this._rctx,this._bindParameters),w!==t&&(this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,Do.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=u,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(t,e){this._renderContext.output=L.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(t),this._prepareSlots(ae.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),t||this._prepareInternalSlots(this._materialRenderers,ae.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(ae.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,ae.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(t){if(t!=null&&ie("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(L.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=dl.NotOccluded,this._renderInternalSlot(ae.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,r=t===ts.BACKGROUND;if(r||e){const i=r?this.performanceInfo.elapsedTime:0,s=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(i,s);this._animationTimestep.frame(n,r)}}readDepthPixels(t,e,r){const i=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=mi.COLOR_BUFFER_BIT|mi.DEPTH_BUFFER_BIT|mi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(L.Depth)}i.readPixels(e[0],e[1],e[2],e[3],Pt.RGBA,Cs.UNSIGNED_BYTE,r)}readHUDVisibility(t,e,r,i,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(t,e,r,i,Pt.RGBA,Cs.UNSIGNED_BYTE,s)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setMultipassEnabled(t),this._setTerrainCulling(t)}_setMultipassEnabled(t){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_prepareSlots(...t){this._renderPlugins.prepareSlots(t)}_renderSlot(t){this._bindParameters.slot=t,this._renderPlugins.render()}_renderEdges(t,e=!1){const r=this._edgeView;r!=null&&r.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,t),this._bindParameters,Do.Alpha,e)}_renderShadowMap(t,e,r,i){const s=this._shadowMap;s.enabled&&(s.start(e,r,i,this._stage.view.qualitySettings.highQualityShadows||this.isFeatureEnabled(Ts.HighQualityShadows)),this._shadowHighlight.updateParameters(e,r),this._needsShadowHighlight?(this._renderShadowCascades(L.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,zx.Highlight)),s.clear(),this._renderShadowCascades(L.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,zx.Default),this._renderGeometryAndTransparentTerrainPass(L.ShadowHighlight)})):this._renderShadowCascades(L.Shadow),s.finish(t),e.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap,r=i=>{}){for(const i of e.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(t),r(i)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(L.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=L.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(t){if(t){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(L.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(L.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return Lz;const e=Vet(t,this._materialRenderers,this._stage.layers);return jx(e,this.renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderGeometryAndTransparentTerrainPass(t){this._renderContext.output=t,this._prepareSlots(ae.TRANSPARENT_TERRAIN),this._renderGeometryPass(t),this._renderTransparentTerrain()}_renderGeometryPass(t){this._renderContext.output=t,this._prepareSlots(ae.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(t){this._ssaoHelper.render(this._bindParameters,t,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(ae.INTEGRATED_MESH,ae.OPAQUE_TERRAIN,ae.OPAQUE_MATERIAL,ae.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,ae.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(ae.INTEGRATED_MESH),this._renderSlot(ae.OPAQUE_TERRAIN),this._renderInternalSlot(ae.OPAQUE_MATERIAL),this._renderSlot(ae.OPAQUE_MATERIAL),this._renderSlot(ae.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(ae.TRANSPARENT_MATERIAL),this._renderSlot(ae.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(ae.TRANSPARENT_TERRAIN)}_renderHUDVisibility(t){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(ae.OCCLUSION_PIXELS)},t),e}_renderLineCallouts(t){this._bindParameters.renderTransparentlyOccludedHUD=t,t===dl.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(ae.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(ae.LINE_CALLOUTS)}_renderHUD(t,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(Sw.HUD,t),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,Do.PremultipliedAlpha)):t===dl.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(dl.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(t))}_renderHUDElements(t){this._bindParameters.renderTransparentlyOccludedHUD=t,this._prepareInternalSlots(this._materialRenderers,ae.LINE_CALLOUTS_HUD_DEPTH,ae.HUD_MATERIAL,ae.LABEL_MATERIAL),this._renderInternalSlot(ae.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(ae.HUD_MATERIAL),this._renderInternalSlot(ae.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(t,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const r=this._highlight,i=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(L.Highlight),this._rctx.clearSafe(mi.DEPTH_BUFFER_BIT),this._renderHUDElements(dl.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,t),r.render(this._bindParameters,i,t)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(t,e,r){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,t,e,r)}_prepareTransparencySlots(){this._renderContext.output=L.Alpha,this._bindParameters.transparencyPassType=Ze.Alpha,this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_MATERIAL),this._prepareSlots(ae.TRANSPARENT_MATERIAL),this._renderContext.output=L.Color,this._bindParameters.transparencyPassType=Ze.Color,this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_MATERIAL),this._prepareSlots(ae.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Ze.FrontFace,this._prepareInternalSlots(this._materialRenderers,ae.TRANSPARENT_MATERIAL),this._prepareSlots(ae.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Ze.NONE}_renderOITPass(t,e=dl.Both){const r=t===Sw.HUD,i=r?()=>this._renderHUDElements(e):()=>this._renderTransparentGeometry(),s=o=>{this._bindParameters.transparencyPassType=o,this._offscreen.renderOITPass(i,o,r)},n=this._renderContext.output;this._renderContext.output=L.Alpha,s(Ze.Alpha),this._renderContext.output=L.Color,s(Ze.Color),s(Ze.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,r),this._bindParameters.transparencyPassType=Ze.NONE,this._renderContext.output=n,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let t=0;jl.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===_i.OccludeAndTransparentStencil&&(t|=n.material.renderOccluded,jl.push(n))});const e=this._offscreen,r=(n,o,a,l,c)=>{t&o&&(e.renderToTargets(a,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,n))};jl.length!==0&&(this._prepareInternalSlots(jl,ae.OCCLUDER_MATERIAL,ae.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(ae.OCCLUDER_MATERIAL,jl),r(.5,_i.OccludeAndTransparentStencil,()=>this._renderInternalSlot(ae.TRANSPARENT_OCCLUDER_MATERIAL,jl),!1,!1)),jl.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===_i.OccludeAndTransparent||n.material.renderOccluded===_i.Transparent||n.material.renderOccluded===_i.Opaque)&&(t|=n.material.renderOccluded,jl.push(n))});const i=this._renderPlugins.renderOccludedFlags;if(t|=i,!t)return;const s=n=>{this._renderContext.renderOccludedMask=n,this._prepareInternalSlots(jl,ae.OPAQUE_MATERIAL,ae.TRANSPARENT_MATERIAL,ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),i>_i.Occlude&&this._renderSlot(ae.OCCLUDED_TERRAIN),this._renderInternalSlot(ae.OPAQUE_MATERIAL,jl),this._renderInternalSlot(ae.TRANSPARENT_MATERIAL,jl),this._renderInternalSlot(ae.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,jl),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=L.Color,r(.5,_i.OccludeAndTransparent,()=>s(_i.OccludeAndTransparent),!0,ja.OutlineVisualElementMask),r(.5,_i.Transparent,()=>s(_i.Transparent),!0,ja.OutlineVisualElementMask),r(1,_i.Opaque,()=>s(_i.Opaque),!0,ja.OutlineVisualElementMask),jl.clear()}_renderAntiAliasing(t){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&t!=null)return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(r=>r.requiresSlot(ae.TRANSPARENT_MATERIAL,L.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=r.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=qa:(Wn(lee,this._bindParameters.camera.viewMatrix),Wn(aee,this._bindParameters.camera.projectionMatrix),qi(bb,lee,aee),qi(bb,this._renderContext.lastFrameCamera.viewMatrix,bb),qi(bb,this._renderContext.lastFrameCamera.projectionMatrix,bb),this._reprojectionMatrix=bb),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(t,...e){for(const r of e)this._bindParameters.slot=r,t.forAll(i=>{i.material.shouldRender(this._renderContext)&&i.prepareTechnique(this._renderContext)})}_renderInternalSlot(t,e=this._materialRenderers){let r=!1;return this._bindParameters.slot=t,e.forAll(i=>{if(i.material.shouldRender(this._renderContext)){const s=i.prepareTechnique(this._renderContext);s!=null&&(i.render(this._renderContext,s),r=!0)}}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=rce(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var t,e,r,i,s;return{offscreen:((t=this._offscreen)==null?void 0:t.gpuMemoryUsage)??0,highlights:(((e=this._highlight)==null?void 0:e.gpuMemoryUsage)??0)+(((r=this._shadowHighlight)==null?void 0:r.gpuMemoryUsage)??0),shadows:((i=this._shadowMap)==null?void 0:i.gpuMemoryUsage)??0,ssao:((s=this._ssaoHelper)==null?void 0:s.gpuMemoryUsage)??0}}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=pY()},getFramebufferTexture:e=>{switch(e){case Xg.Color:return t._offscreen.colorTexture;case Xg.LinearDepth:return t._offscreen.linearDepthTexture;case Xg.Normals:return t._offscreen.normalTexture;case Xg.ShadowMap:return t._shadowMap.depthTexture;case Xg.HudVisibility:return t._offscreen.hudVisibilityTexture;case Xg.Highlight:return t._offscreen.highlightTexture}}}}};var Sw,Xg;h([f()],ll.prototype,"_renderPlugins",void 0),h([f()],ll.prototype,"_shadowAccumulator",void 0),h([f()],ll.prototype,"_state",void 0),h([f()],ll.prototype,"_renderStateFeatures",void 0),h([f()],ll.prototype,"_antialiasingEnabled",void 0),h([f({readOnly:!0})],ll.prototype,"_antialiasing",null),h([f()],ll.prototype,"_ssaoEnabled",void 0),h([f()],ll.prototype,"_smaaPass",void 0),h([f({autoDestroy:!0})],ll.prototype,"_edgeView",void 0),h([f()],ll.prototype,"updating",null),h([f()],ll.prototype,"isCameraFinal",null),ll=h([F("esri.views.3d.webgl-engine.lib.Renderer")],ll),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(Sw||(Sw={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(Xg||(Xg={}));const jl=new Nt,aee=xe(),lee=xe(),bb=xe();function zrt(t){return e=>t.immediate.schedule(e)}let cee=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:_e.ONE,dstRGB:_e.ZERO,srcAlpha:_e.ONE,dstAlpha:_e.ZERO},this.blendEquation={mode:Op.ADD,modeAlpha:Op.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Uh.BACK,this.frontFace=wx.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Br.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Uh.FRONT_AND_BACK,func:Br.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Uh.FRONT_AND_BACK,fail:is.KEEP,zFail:is.KEEP,zPass:is.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},krt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${i}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const Brt={RECORD_ALLOCATIONS:!1};let Vrt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new krt(Brt.RECORD_ALLOCATIONS);this._current.length<Ks.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<Ks.COUNT;++r){const i=this._current[r];i>0&&(e+=`${Ks[r]}: ${i}
`)}}return e+=this._allocations.information,e}},Grt=class{constructor(e,r,i){const s=r.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),ad(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const jrt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var uee,r_e={exports:{}};(uee=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(r_e.exports=uee);const Hrt=mA(r_e.exports);var hee,Gz={exports:{}};Gz.exports,hee=Gz,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(hee.exports=e)}();const dee=mA(Gz.exports);var i_e={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(i_e);const Wrt=mA(i_e.exports);var rh=999,pee=9999,hF=0,dF=1,fee=2,mee=3,gee=4,xR=5,qrt=6,Yrt=7,Xrt=8,yee=9,Zrt=10,_ee=11,Jrt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Qrt(){var t,e,r,i=0,s=0,n=rh,o=[],a=[],l=1,c=0,u=0,d=!1,p=!1,g="";return function(z){return a=[],z!==null?_(z.replace?z.replace(/\r\n/g,`
`):z):v()};function y(z){z.length&&a.push({type:Jrt[n],data:z,position:u,line:l,column:c})}function _(z){var Y;for(i=0,r=(g+=z).length;t=g[i],i<r;){switch(Y=i,n){case hF:i=O();break;case dF:i=E();break;case fee:i=x();break;case mee:i=A();break;case gee:i=U();break;case _ee:i=M();break;case xR:i=k();break;case pee:i=B();break;case yee:i=T();break;case rh:i=w()}Y!==i&&(g[Y]===`
`?(c=0,++l):++c)}return s+=i,g=g.slice(i),a}function v(z){return o.length&&y(o.join("")),n=Zrt,y("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=s+i-1,n=hF,e=t,i+1):e==="/"&&t==="/"?(u=s+i-1,n=dF,e=t,i+1):t==="#"?(n=fee,u=s+i,i):/\s/.test(t)?(n=yee,u=s+i,i):(d=/\d/.test(t),p=/[^\w_]/.test(t),u=s+i,n=d?gee:p?mee:pee,i)}function T(){return/[^\s]/g.test(t)?(y(o.join("")),n=rh,i):(o.push(t),e=t,i+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(y(o.join("")),n=rh,i)}function E(){return x()}function O(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),n=rh,i+1):(o.push(t),e=t,i+1)}function A(){if(e==="."&&/\d/.test(t))return n=xR,i;if(e==="/"&&t==="*")return n=hF,i;if(e==="/"&&t==="/")return n=dF,i;if(t==="."&&o.length){for(;$(o););return n=xR,i}if(t===";"||t===")"||t==="("){if(o.length)for(;$(o););return y(t),n=rh,i+1}var z=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||z){for(;$(o););return n=rh,i}return o.push(t),e=t,i+1}function $(z){for(var Y,W,j=0;;){if(Y=dee.indexOf(z.slice(0,z.length+j).join("")),W=dee[Y],Y===-1){if(j--+z.length>0)continue;W=z.slice(0,1).join("")}return y(W),u+=W.length,(o=o.slice(W.length)).length}}function M(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),n=rh,i):(o.push(t),e=t,i+1)}function U(){return t==="."||/[eE]/.test(t)?(o.push(t),n=xR,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(n=_ee,o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=rh,i):(o.push(t),e=t,i+1)}function k(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=rh,i):(o.push(t),e=t,i+1)}function B(){if(/[^\d\w_]/.test(t)){var z=o.join("");return n=Hrt.indexOf(z)>-1?Xrt:Wrt.indexOf(z)>-1?Yrt:qrt,y(o.join("")),n=rh,i}return o.push(t),e=t,i+1}}function Krt(t){var e=Qrt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function eit(t){return Krt(t)}function tit(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const pF=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function rit(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return s.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function iit(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function jS(t,e,r,i){i=i||r;for(const s of t)if(s.type==="ident"&&s.data===r)return i in e?e[i]++:e[i]=0,jS(t,e,i+"_"+e[i],i);return r}function s_e(t,e,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const d=l[u];if(d.type==="operator"&&d.data===";")return u}return null}function s(l){let c=-1,u=0,d=-1;for(let p=0;p<l.length;p++){const g=l[p];if(g.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(g.data)?++u:/\#endif\s*.*/.test(g.data)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||g.type==="preprocessor"&&/^#version/.test(g.data)&&(d=Math.max(d,p)),r==="afterPrecision"&&g.type==="keyword"&&g.data==="precision"){const y=i(l,p);if(y===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,y)}c<d&&u===0&&(c=p)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function sit(t,e,r,i="lowp"){s_e(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function nit(t,e,r,i,s="lowp"){s_e(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function oit(t,e){let r,i,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),s}function vee(t,e){if(t.startsWith("#version 300"))return t;const r=eit(t);if(rit(r,"100","300 es")==="300 es")return t;let i=null,s=null;const n={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===nc.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===nc.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===nc.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=jS(r,n,"fragColor"),sit(r,i,"vec4")),l.data=i),e===nc.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=oit(r,a+1),u=jS(r,n,"fragData");nit(r,u,"vec4",c,"mediump"),l.data=u}else e===nc.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=jS(r,n,"gl_FragDepth")),l.data=s);break;case"ident":if(jrt.includes(l.data)){if(e===nc.VERTEX_SHADER&&iit(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=jS(r,n,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&pF.includes(c[1].trim())){const p=r[a+1];r.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&pF.includes(u[1].trim())&&(l.data="#if 1");const d=l.data.match(/\#ifndef\s+(.*)/);d&&d[1]&&pF.includes(d[1].trim())&&(l.data="#if 0")}}return ait(t,tit(r))}function ait(t,e){return e}const lit=4294967295;let cit=class{constructor(e,r,i,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Jt.WEBGL2&&(r=vee(r,nc.VERTEX_SHADER),i=vee(i,nc.FRAGMENT_SHADER)),this._vShader=bee(this._context,nc.VERTEX_SHADER,r),this._fShader=bee(this._context,nc.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Ks.Shader,this),w8()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),w8()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Jt.WEBGL2){const l=o;for(const[c,u]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<lit&&l.uniformBlockBinding(a,d,u)}}this._glName=a,this._context.instanceCounter.increment(Ks.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Ks.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Ks.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&this.glName!=null&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){Od(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){Od(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){Od(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){Od(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){Od(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),s[0]=r,s[1]=i)}setUniform2fv(e,r){Od(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),this._nameToUniform3.set(e,[r,i,s])):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(e,r){Od(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),this._nameToUniform4.set(e,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(e,r){Od(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){Od(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){Od(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function bee(t,e,r){const i=t.gl,s=i.createShader(e);return i.shaderSource(s,r),i.compileShader(s),w8()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===nc.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(uit(r))),s}function uit(t){let e=2;return t.replaceAll(`
`,()=>`
`+hit(e++)+":")}function hit(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Od(t,e,r){const i=t.get(e);return i?Yz(i,r):(t.set(e,Array.from(r)),!0)}let dit=class{constructor(e){this._rctx=e,this._store=new p2}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,s){const n=this._store.get(e,r);if(n!=null)return n.ref(),n;const o=new cit(this._rctx,e,r,i,s);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},LA=class{constructor(){this._result=!1}dispose(){this._program=Ue(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},pit=class extends LA{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===Jt.WEBGL2&&ie("mac")&&ie("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new xr(1);i.wrapMode=Ot.CLAMP_TO_EDGE,i.samplingMode=wt.NEAREST;const s=new As(r,i),n=br.createIndex(this._rctx,hr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(n,gt.ELEMENT_ARRAY_BUFFER),r.drawElements(vt.POINTS,1,Ye.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(vt.TRIANGLES,0,258);const o=new Uint8Array(4);return s.readPixels(0,0,1,1,Pt.RGBA,Cs.UNSIGNED_BYTE,o),s.dispose(),n.dispose(),o[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${b.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${b.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=Efe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},fit=class extends LA{constructor(e){super(),this._rctx=e,this._program=wee(this._rctx,!1),this._obfuscated=wee(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Ue(this._obfuscated)}_test(e){if(ie("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new xr(1);i.wrapMode=Ot.CLAMP_TO_EDGE,i.samplingMode=wt.NEAREST;const s=new As(r,i),n=br.createVertex(r,hr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Iu(r,new Map([["position",0]]),{geometry:[new qn("position",2,Ye.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Ce(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ce(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);cU(a,c,3);const u=new Float32Array(6);cU(l,u,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(vt.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,Pt.RGBA,Cs.UNSIGNED_BYTE,d),o.dispose(!1),n.dispose(),s.dispose();const p=(a[2]-l[2])/25,g=MV(d);return Math.abs(p-g)}};function wee(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}let mit=class extends LA{constructor(e){var s,n,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===Jt.WEBGL1)return void(this._result=!(!((s=e.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new xr(1);i.wrapMode=Ot.CLAMP_TO_EDGE,i.dataType=Cs.FLOAT,i.internalFormat=ft.RGBA32F,i.samplingMode=wt.NEAREST;const s=new As(r,i),n=br.createVertex(r,hr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Iu(r,new Map([["a_pos",0]]),{geometry:[new qn("a_pos",2,Ye.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:u,height:d}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(vt.TRIANGLE_STRIP,0,4);const p=xt({blending:Cde});r.setPipelineState(p),r.drawArrays(vt.TRIANGLE_STRIP,0,4);const g=r.gl.getError();return r.setViewport(l,c,u,d),r.bindFramebuffer(a),o.dispose(!1),n.dispose(),s.dispose(),g!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},git=class extends LA{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new xr(1);i.wrapMode=Ot.CLAMP_TO_EDGE,i.samplingMode=wt.NEAREST;const s=new As(r,i),n=new Uint8Array(4),o=br.createVertex(r,hr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new Iu(r,new Map([["a_position",0]]),{geometry:[new qn("a_position",2,Ye.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new bt(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(s),r.useProgram(e);const{x:u,y:d,width:p,height:g}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(vt.TRIANGLE_STRIP,0,4),r.setViewport(u,d,p,g),s.readPixels(0,0,1,1,Pt.RGBA,Cs.UNSIGNED_BYTE,n),a.dispose(!1),o.dispose(),s.dispose();const y=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return y&&ne.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(c),y}};new qn("a_pos",2,Ye.BYTE,0,2);new qn("a_pos",2,Ye.BYTE,0,4),new qn("a_tex",2,Ye.BYTE,2,4);const yit={geometry:[new qn("a_pos",2,Ye.UNSIGNED_SHORT,0,4)]};let _it=class extends LA{constructor(e){super(),this._rctx=e,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new xr(1);i.wrapMode=Ot.CLAMP_TO_EDGE,i.samplingMode=wt.NEAREST;const s=new As(r,i),n=br.createVertex(r,hr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Iu(r,new Map([["a_pos",0]]),yit,{geometry:n});i.samplingMode=wt.LINEAR,i.wrapMode=Ot.CLAMP_TO_EDGE;const a=new bt(r,i,this._image);r.useProgram(e),r.bindTexture(a,0),e.setUniform1i("u_texture",0);const l=r.getBoundFramebufferObject(),{x:c,y:u,width:d,height:p}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(mi.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(vt.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return s.readPixels(0,0,1,1,Pt.RGBA,Cs.UNSIGNED_BYTE,g),o.dispose(!1),n.dispose(),s.dispose(),a.dispose(),r.setViewport(c,u,d,p),r.bindFramebuffer(l),g[0]!==255}},vit=class{constructor(e){this.rctx=e,this.floatBufferBlend=new mit(e),this.svgPremultipliesAlpha=new _it(e),this.doublePrecisionRequiresObfuscation=new fit(e),this.ignoresSamplerPrecision=new git(e),this.drawArraysRequiresIndicesTypeReset=new pit(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function bit(t,e){if(e.disjointTimerQuery)return null;if(ad(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function wit(t){if(ad(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function xit(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Tit(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function Sit(t,e){if(ad(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function Eit(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Cit(t,e){if(ad(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function Ait(t,e){if(ad(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function xee(t,e,r,i,s){if(i&&ad(t))return!0;if(e[r])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function Oit(t,e){if(!ad(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function Rit(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function Pit(t,e){if(ad(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let Mit=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=bit(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=wit(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=Pit(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=xit(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=Tit(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=Eit(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=Drt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=Cit(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=Ait(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=Sit(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=xee(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=Rit(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=Oit(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=xee(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},$it=class{constructor(e,r){this.gl=e,this.instanceCounter=new Vrt,this.programCache=new dit(this),this._state=new cee,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=ad(e)?Jt.WEBGL2:Jt.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===Jt.WEBGL1?null:this.gl}configure(e){this._capabilities=new Mit(this.gl,e),this._parameters=new Grt(this.gl,this._capabilities,e),bt.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new cee,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new cIe({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),Ue(this._driverTest),this._driverTest=new vit(this)}dispose(){Ue(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(gt.ARRAY_BUFFER),this.unbindBuffer(gt.ELEMENT_ARRAY_BUFFER),this.type===Jt.WEBGL2&&(this.unbindBuffer(gt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(gt.PIXEL_PACK_BUFFER),this.unbindBuffer(gt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(gt.COPY_READ_BUFFER),this.unbindBuffer(gt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,tu()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,s){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,r,i,s),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,r,i,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,s){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(e,r,i,s),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,s){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(e,r,i,s),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(e,r,i,s),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=Uh.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,r,i,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===Uh.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=Uh.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,r,i,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(BN+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&mi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&mi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&mi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(tu()&&(this._numOfDrawCalls++,this._numOfTriangles+=Tee(e,i)),this.gl.drawArrays(e,r,i),tu()){const s=Cq(this);s&&console.error("drawArrays:",s)}}drawElements(e,r,i,s){if(tu()&&(this._numOfDrawCalls++,this._numOfTriangles+=Tee(e,r)),this.gl.drawElements(e,r,i,s),tu()){const n=Cq(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:r,type:i,offset:s},d=(a==null?void 0:a.size)??0,p=s+r,g=d<p?`. Buffer is too small. Attempted to draw index ${p} of ${d}`:"";console.error(`drawElements: ${n}${g}`,{args:u,vao:c})}}}logInfo(){tu()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){tu()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===r&&n.width===i&&n.height===s||(n.x=e,n.y=r,n.width=i,n.height=s,this.gl.viewport(e,r,i,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return e==null||e.glName==null?(s!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,s):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(Bn.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Bn.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const s=r===Bn.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),s?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,s=0,n=e.width,o=e.height,a=0,l=0,c=r.width,u=r.height,d=mi.COLOR_BUFFER_BIT,p=wt.NEAREST){this.bindFramebufferSeparate(e,Bn.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,Bn.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,u,d,p)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case gt.ARRAY_BUFFER:this._state.vertexBuffer=sl(this.gl,e,r,this._state.vertexBuffer);break;case gt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=sl(this.gl,e,r,this._state.indexBuffer);break;case gt.UNIFORM_BUFFER:this._state.uniformBuffer=sl(this.gl,e,r,this._state.uniformBuffer);break;case gt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=sl(this.gl,e,r,this._state.pixelPackBuffer);break;case gt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=sl(this.gl,e,r,this._state.pixelUnpackBuffer);break;case gt.COPY_READ_BUFFER:this._state.copyReadBuffer=sl(this.gl,e,r,this._state.copyReadBuffer);break;case gt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=sl(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[r];return s==null&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(e,r,i){const s=this._getBufferBinding(e,r);s!=null&&(s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0))}bindBufferRange(e,r,i,s,n){const o=this._getBufferBinding(e,r);if(o!=null&&!(o.buffer===i&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n}}bindUBO(e,r,i,s){r!=null?(tu()&&(s??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(gt.UNIFORM_BUFFER,e,r.buffer,i,s):this.bindBufferBase(gt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(gt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(gt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case gt.ARRAY_BUFFER:this._state.vertexBuffer=sl(this.gl,null,e,this._state.vertexBuffer);break;case gt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=sl(this.gl,null,e,this._state.indexBuffer);break;case gt.UNIFORM_BUFFER:this._state.uniformBuffer=sl(this.gl,null,e,this._state.uniformBuffer);break;case gt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=sl(this.gl,null,e,this._state.pixelPackBuffer);break;case gt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=sl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case gt.COPY_READ_BUFFER:this._state.copyReadBuffer=sl(this.gl,null,e,this._state.copyReadBuffer);break;case gt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=sl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(b8.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(Ks.Sync,i),r.flush();do await UE(e),s=r.clientWaitSync(i,0,0);while(s===a$.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Ks.Sync,i),r.deleteSync(i),s===a$.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Bn.FRAMEBUFFER){return e===Bn.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(gt.ARRAY_BUFFER),this.unbindBuffer(gt.ELEMENT_ARRAY_BUFFER),this.type===Jt.WEBGL2&&(this.unbindBuffer(gt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(gt.PIXEL_PACK_BUFFER),this.unbindBuffer(gt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(gt.COPY_READ_BUFFER),this.unbindBuffer(gt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(_e.ONE,_e.ZERO),this.setBlendEquation(Op.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Uh.BACK),this.setFrontFace(wx.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Br.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Br.ALWAYS,0,0),this.setStencilOp(is.KEEP,is.KEEP,is.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var n,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)r.disableVertexAttribArray(l);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(gt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(gt.ELEMENT_ARRAY_BUFFER,null),i!=null){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(gt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(c!=null){const{buffer:u,offset:d,size:p}=c;u!==null?d===0&&p===0?i.bindBufferBase(gt.UNIFORM_BUFFER,l,u.glName):i.bindBufferRange(gt.UNIFORM_BUFFER,l,u.glName,d,p):i.bindBufferBase(gt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(gt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(gt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(gt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(gt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(Bn.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(Bn.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(Ql.COLOR_ATTACHMENT0)),i.bindFramebuffer(Bn.DRAW_FRAMEBUFFER,((n=this._state.drawFramebuffer)==null?void 0:n.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(Bn.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}r.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){r.activeTexture(BN+l),r.bindTexture(ji.TEXTURE_2D,null),r.bindTexture(ji.TEXTURE_CUBE_MAP,null),this.type===Jt.WEBGL2&&(r.bindTexture(ji.TEXTURE_3D,null),r.bindTexture(ji.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];c!=null&&r.bindTexture(c.descriptor.target,c.glName)}r.activeTexture(BN+this._state.activeTexture);const s=this._state.viewport;r.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===Jt.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function sl(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function Tee(t,e){switch(t){case vt.POINTS:return 2*e;case vt.TRIANGLES:return e/3;case vt.TRIANGLE_STRIP:case vt.TRIANGLE_FAN:return e-2;default:return 0}}let Iit=class extends $it{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(e,r,i,s){return this.useProgram(e.program),e.bindPipelineState(this,i==null?void 0:i.slot,!!s),e.program.bindPass(r,i),e.program}get test(){return this.programCache.test}},Qb=class extends we{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ys,this._frameTask=e.view.resourceController.scheduler.registerTask(nt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Wi.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(pG,new fG)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",ts.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return He(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),s=new Lit(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&r.unload()})});return this._textures.set(e,s),s.ref(),r.glTexture!=null?(this._updateGLTexture(s,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=r.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,gs(l)||ne.getLogger(this.declaredClass).error(l),null);return Sc(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",ts.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};h([f()],Qb.prototype,"_loadingCount",void 0),h([f()],Qb.prototype,"_frameTask",void 0),h([f()],Qb.prototype,"updating",null),Qb=h([F("esri.views.3d.webgl-engine.lib.TextureRepository")],Qb);let Lit=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(ne.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}},HS=class extends we{constructor(){super(...arguments),this._passParameters=new Dit,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=Ue(this._passParameters.waveNormal),this._passParameters.wavePertubation=Ue(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return Hf.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return Hf.LOADED;const r=new xr;return r.samplingMode=wt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.maxAnisotropy=8,++this._loading,hm(Rr("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new bt(e,{...r,width:i.width,height:i.height},i)).catch(i=>ne.getLogger(this.declaredClass).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,hm(Rr("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new bt(e,{...r,width:i.width,height:i.height},i)).catch(i=>ne.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),Hf.LOADING}};h([f()],HS.prototype,"_loading",void 0),h([f({type:Boolean,readOnly:!0})],HS.prototype,"updating",null),HS=h([F("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],HS);let Dit=class extends Ar{};const See=2048,Nit=1.5,Fit=8;function Uit(t,e){const{format:r,quality:i,rotation:s,disableDecorations:n}=t||{},o=oj(t,e.padding),a=Hit(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=jit(t,a),u=Yit(r),d=Kit[u];return{format:u,quality:me(i??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function zit(t,e){const r=Uit(t,e),i=r.area,s=r.width/i.width,n=oj(r,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*s+o),d=Math.floor(c*s+a),p=t&&t.layers?t.layers:[],g=r.ignoreBackground,y=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:g,ignorePadding:y,objectAndLayerIdColor:!1}}function fF(t,e,r){const{ctx:i,canvas:s}=n_e(t,r),n=i.getImageData(0,0,t.width,t.height),o=Bit(s,e);return o_e(s),{dataUrl:o,data:n}}function mF(t,e){const{ctx:r,canvas:i}=n_e(t,e),s=r.getImageData(0,0,t.width,t.height);return o_e(i),s}function n_e(t,e){const r=kit();e.premultipliedAlpha&&Zit(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&Xit(i),{ctx:i,canvas:r}}function o_e(t){t.width=0,t.height=0}function kit(){return gF==null&&(gF=document.createElement("canvas")),gF}let gF=null;function Bit(t,e){const r=Jit[e.format],i=e.quality/100;return t.toDataURL(r,i)}function Vit(t,e,r,i=0,s=0,n=t.width-i,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:u,data:d}=e,p=n/c,g=o/u,y=Math.ceil(p/2),_=Math.ceil(g/2),v=t.width;for(let w=0;w<u;w++)for(let T=0;T<c;T++){const x=4*(T+(a?u-w-1:w)*c);let E=0,O=0,A=0,$=0,M=0,U=0;const k=(w+.5)*g;for(let B=Math.floor(w*g);B<(w+1)*g;B++){const z=Math.abs(k-(B+.5))/_,Y=(T+.5)*p,W=z*z;for(let j=Math.floor(T*p);j<(T+1)*p;j++){const Z=Math.abs(Y-(j+.5))/y,R=Math.sqrt(W+Z*Z);if(R>=1)continue;let I=2*R*R*R-3*R*R+1;const N=4*(i+j+(s+B)*v);U+=I*l[N+3],O+=I,!r&&l[N+3]<255&&(I=I*l[N+3]/255),A+=I*l[N],$+=I*l[N+1],M+=I*l[N+2],E+=I}}d[x]=A/E,d[x+1]=$/E,d[x+2]=M/E,d[x+3]=U/O}return e}function Git(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=t,a=oj(t,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,d=s-c,p=Math.min(Fit,Math.min((See-l)/u,(See-c)/d));return p<Nit?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(d*p)+c,pixelRatio:n*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:i,height:s}}}function jit(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const s=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function Hit(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return Wit(qit(r,t),e)}function Wit(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),s={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),u=s.height-c;return{x:s.x,y:Math.floor(s.y+u/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function qit(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const n=Math.floor(t.height*r);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/r);return t.y-=(s-t.height)/2,t.height=s,t}function oj(t,e){return!e||t&&t.ignorePadding?est:e}function Yit(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Qit}}function Xit(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Zit(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const s=e[i+3];if(s!==255&&s>0){const n=255/s;e[i]=e[i]*n,e[i+1]=e[i+1]*n,e[i+2]=e[i+2]*n}}}const Jit={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Eee=98,Qit="png",Kit={png:100,jpg:Eee,jpeg:Eee},est={top:0,right:0,bottom:0,left:0};let tst=class{constructor(e,r){this.parameters=e,this.frameHasDecorations=r}},rst=class{constructor(e,r,i,s){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(ts.BACKGROUND);const r=vo();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const s=e.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(e,r),s.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=d5(i,s,a);this._rctx.gl.readPixels(0,0,i,s,Pt.RGBA,Ye.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=d5(n.width,n.height,a);return Vit(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=d5(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,Pt.RGBA,Ye.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,r,i){let s=null;const n=e.parameters.camera,o={width:r.framebufferWidth,height:r.framebufferHeight};J_(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=r.disableDecorations&&e.frameHasDecorations,c=o.width!==n.fullWidth||o.height!==n.fullHeight,u=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,d=c||l||u||r.objectAndLayerIdColor,p=r.objectAndLayerIdColor?new As(this._rctx,new xr(o.width,o.height),new q$(xs.DEPTH_STENCIL,o.width,o.height)):null;if(d){const v=n.clone();if(r.ignorePadding){const O=aA(v.padding);for(let A=0;A<4;A++)O[A]=Math.round(O[A]/v.pixelRatio*r.pixelRatio);v.padding=O}v.fullWidth=o.width,v.fullHeight=o.height,v.pixelRatio=r.pixelRatio;const w=n.fovX-v.fovX,T=n.fovY-v.fovY;w<0&&w<T?v.fovX=n.fovX:T<0&&T<w&&(v.fovY=n.fovY);const x={camera:v,contentCamera:v,mode:vr.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),a=!0,s=new As(this._rctx,new xr(o.width,o.height),new q$(xs.DEPTH_STENCIL,o.width,o.height));const E=r.disableDecorations?D1.OFF:D1.ON;this._renderFunctions.renderScene(s,p,x,E,i),this._disposeOffscreenBuffers()}const g=()=>{this._rctx.bindFramebuffer(null),Ue(s)},y=this._readbackScreenshot(r,g);g();let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),Ue(p)};this._rctx.bindFramebuffer(p),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null),v()}if(d&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return a&&this._forceCameraHook(e.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Un=class extends we{constructor(e){super({}),this.events=new ys,this.waterTextureRepository=new HS,this._magnifierHelper=new Jb,this.objectAndLayerIdRenderHelper=ie("enable-feature:objectAndLayerId-rendering")?new stt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([ce(()=>{var i;return(i=this.waterTextureRepository)==null?void 0:i.updating},()=>this.requestRender(),Tr),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]),this._stippleTextureRepository=new afe(this._rctx),this._shaderTechniqueRepository=new tfe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new Qb(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",i=>this.requestRender(i))),this._materialRepository=new rfe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new Net(this._rctx,this._shaderTechniqueRepository),this.renderer=new ll(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,i=>this.requestRender(i));const r={renderScene:(i,s,n,o,a)=>this.renderer.render(i,s,n,o,a),requestRenderScene:i=>this.requestRender(i),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(i,s)=>e.options.screenshot.renderOverlay(i,s)};this._screenshotManager=new rst(this._rctx,r,i=>this.events.emit("force-camera-for-screenshot",i),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=bi(this._frameTask),this._shaderTechniqueRepository=Oe(this._shaderTechniqueRepository)}requestRender(e=ts.UPDATE){this._needsRender=!0,e===ts.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,s,n,o=n){const a=s.constrainWindowSize(r,i,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const d=Bet(4*u,l,s.nearFar);c>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(c=d)}if(e!=null){const u=e.pickDepth(r*s.pixelRatio,i*s.pixelRatio,s);u!=null&&c>u&&u!==s.nearFar[0]&&u!==s.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){Kge(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,s=ts.BACKGROUND,n=!1;const o={preRender:({time:a})=>{i=this.updating,s=this._needsUpdate?ts.UPDATE:ts.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new ede(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(ts.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,D1.ON,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(ts.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new tst(r,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(r.mode===vr.IDLE?s:ts.UPDATE),n=!1)}};this._frameTask=Kw(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},s=dIe("3d",this._canvas,i);s!=null?(this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&ne.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ie("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):ne.getLogger(this.declaredClass).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>r.view.resourceController.memoryController.newCache(n,o);return new Iit(e,i,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new Tet(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};h([f({type:Boolean,readOnly:!0})],Un.prototype,"updating",null),h([f({autoDestroy:!0})],Un.prototype,"_rctx",void 0),h([f({autoDestroy:!0})],Un.prototype,"_container",void 0),h([f({autoDestroy:!0})],Un.prototype,"_canvas",void 0),h([f({autoDestroy:!0})],Un.prototype,"_stippleTextureRepository",void 0),h([f({autoDestroy:!0})],Un.prototype,"waterTextureRepository",void 0),h([f({autoDestroy:!0})],Un.prototype,"_magnifierHelper",void 0),h([f({readOnly:!0})],Un.prototype,"objectAndLayerIdRenderHelper",void 0),h([f({autoDestroy:!0})],Un.prototype,"_textureRepository",void 0),h([f({autoDestroy:!0})],Un.prototype,"_compositingHelper",void 0),h([f({autoDestroy:!0,readOnly:!0})],Un.prototype,"renderer",void 0),h([f({autoDestroy:!0})],Un.prototype,"_screenshotManager",void 0),h([f()],Un.prototype,"componentObjectCollection",null),h([f({autoDestroy:!0})],Un.prototype,"_componentObjectCollection",void 0),h([f()],Un.prototype,"_needsUpdate",void 0),h([f()],Un.prototype,"_needsWaterReflectionUpdate",void 0),Un=h([F("esri.views.3d.webgl-engine.parts.RenderView")],Un);let Yl=class extends we{constructor(e){super(e),this._model=new ZP,this._layers=new Nt,this._asyncChangeSet=new rz,this._syncChangeSet=new rz,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Un(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(nt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),j$(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),j$(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var r,i;e!=null&&((r=this._model)==null||r.removeMany(e),(i=this.renderView)==null||i.requestRender())}async load(e,r){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>i.glTexture==null).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const s=this._layerSyncSet.has(i.id)||i.updatePolicy===C0.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,s?la:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,la),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==C0.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===C0.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,la),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,la),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,la))}addRenderPlugin(e,r,i){const s=this.renderer.renderPlugins.add(e,r,i),n=()=>{pQ(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(Sc(s))return s.then(n);n()}removeRenderPlugin(e){this.destroyed||(pQ(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};Yl.DebugSettings={endFrameContentValidation:!1},h([f({constructOnly:!0})],Yl.prototype,"view",void 0),h([f({constructOnly:!0})],Yl.prototype,"options",void 0),h([f({readOnly:!0})],Yl.prototype,"viewingMode",null),h([f({constructOnly:!0})],Yl.prototype,"container",void 0),h([f({readOnly:!0})],Yl.prototype,"updating",null),h([f({constructOnly:!0})],Yl.prototype,"_model",void 0),h([f({autoDestroy:!0})],Yl.prototype,"renderView",void 0),h([f({readOnly:!0})],Yl.prototype,"renderer",null),h([f({readOnly:!0})],Yl.prototype,"running",null),Yl=h([F("esri.views.3d.webgl-engine.Stage")],Yl);let p2t=class extends HL{constructor(e,r,i,s){super(r,i),this.point=e,this.createGraphic=s}};function a_e(t){return nd(t)&&t.intersector===Ai.PCL&&!!t.target}let m2t=class extends Tue{constructor(e,r,i,s,n){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}},y2t=class extends HL{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function UD(t){return nd(t)&&t.intersector===Ai.I3S&&!!t.target}function l_e(t){return nd(t)&&t.intersector===Ai.VOXEL&&!!t.target}function Cee(t,e){var r,i;return WL(t)||qL(t)?zC((r=t.target)==null?void 0:r.object,e):OBe(t)?(i=e.map)==null?void 0:i.ground:a_e(t)||UD(t)||Tfe(t)||l_e(t)?zC(t.target,e):null}function v2t(t,e){const r=jz(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function jz(t,e){var r;if(t==null)return null;if(WL(t)||qL(t))return Aee((r=t.target)==null?void 0:r.object,e);if(a_e(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(l_e(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return Tfe(t)||RG(t)?Aee(t.target,e):UD(t)?ist(t.target,e):null}function Aee(t,e){if(t==null||t.graphicUid==null)return null;const r=zC(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function ist(t,e){const r=zC(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?nst(i.getGraphicFromIntersectorTarget(t)):null}function sst(t,e){const r=zC(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function nst(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function zC(t,e){return t&&t.layerUid!=null?e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid):null}function b2t(t,e){if(WL(t)||qL(t))return jf(t.target.object.boundingVolumeWorldSpace.bounds);if(RG(t)){coe(TR,t.transformation);const r=Math.max(TR[0],TR[1],TR[2]);return t.target.baseBoundingSphere.radius*r}return UD(t)?fo(sst(t.target,e),r=>.5*wne(r)):null}function w2t(t){return!WL(t)&&!qL(t)&&(RG(t)?t.target.numLodLevels>1:!!UD(t))}const TR=C();async function ost(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+ast),s=r.results.findIndex(n=>(n.distance??0)>i);return s!==-1&&(r.results=r.results.slice(0,s)),r}const ast=.05;function x2t(t){return t&&typeof t.highlight=="function"}function lst(t){return t&&typeof t.maskOccludee=="function"}function T2t(t,e,r){return t==null||t>r&&(e===0||t<e)}function S2t(t,e){return t!=null&&t>0||e!=null&&e>0}function E2t(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let yF,_F;function cst(t){const e=Qle(t);for(;e.length>1;){const r=Oee(e.shift());if(r.available)return r}return Oee(e.shift())}function Oee(t){switch(t){case Jt.WEBGL1:return ust();case Jt.WEBGL2:return hst()}}function ust(){return yF||(yF=fst()),yF}function hst(){return _F||(_F=mst()),_F}let c_e=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},dst=class extends c_e{constructor(){super(...arguments),this.type=Jt.WEBGL1}},pst=class extends c_e{constructor(){super(...arguments),this.type=Jt.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function u_e(t,e){if(t===Jt.WEBGL1&&typeof WebGLRenderingContext>"u"||t===Jt.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=x8(r,t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=x8(r,t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;if(t===Jt.WEBGL1){const n=i.getParameter(i.VERSION),o=n==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),i}function fst(){const t=new dst,e=u_e(Jt.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function mst(){const t=new pst,e=u_e(Jt.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function gst(t){const e=cst(t);if(!e.available)return new X("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new X("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new X("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new X("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===Jt.WEBGL1){if(!e.supportsElementIndexUint)return new X("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new X("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new X("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function yst(t){return t&&"nodeType"in t}function _st(t){return t&&typeof t.render=="function"}const Ree={component:"esri-component"};let M_=class extends we{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(Ree.component),r&&r.classList.remove(Ree.component),this._set("node",e))}castNode(e){var r;return(r=this.widget)==null||r.destroy(),e?typeof e=="string"||yst(e)?(this._set("widget",null),hL(e)):(_st(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};h([f({dependsOn:[]})],M_.prototype,"id",null),h([f()],M_.prototype,"node",null),h([Gi("node")],M_.prototype,"castNode",null),h([f({readOnly:!0})],M_.prototype,"widget",void 0),M_=h([F("esri.views.ui.Component")],M_);const tM=M_,h_e="calcite-mode-";function vst(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function bst(){return vst().startsWith("dark")}function wst(){return`${h_e}${bst()?"dark":"light"}`}function xst(t){Tst(t),t.classList.add(wst())}function Tst(t){Array.from(t.classList).forEach(e=>{e.startsWith(h_e)&&t.classList.remove(e)})}const Sst={left:0,top:0,bottom:0,right:0},d_e={bottom:30,top:15,right:15,left:15},lf="esri-ui",Ea={ui:lf,corner:`${lf}-corner`,innerContainer:`${lf}-inner-container`,manualContainer:`${lf}-manual-container`,cornerContainer:`${lf}-corner-container`,topLeft:`${lf}-top-left`,topRight:`${lf}-top-right`,bottomLeft:`${lf}-bottom-left`,bottomRight:`${lf}-bottom-right`};function Est(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function SR(t){return t===0?"0":`${t}px`}function vF(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function bF(t,{top:e,bottom:r,left:i,right:s}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=s}let Yd=class extends ys.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=Gh(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&bF(r,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&bF(r,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ce(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Tr),ce(()=>this.padding,this._applyUIPadding,Tr),ce(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},Tr),Wre(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(Ea.ui),xst(e),this._attachContainers(e)),r&&(r.classList.remove(Ea.ui),bF(r,{top:"",bottom:"",left:"",right:""}),Qne(r)),this._set("container",e))}get height(){var n;const e=((n=this.view)==null?void 0:n.height)??0;if(e===0)return e;const r=this._getViewPadding(),{top:i,bottom:s}=r;return Math.max(e-i-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...d_e,...e}}get width(){var n;const e=((n=this.view)==null?void 0:n.width)??0;if(e===0)return e;const r=this._getViewPadding(),{left:i,right:s}=r;return Math.max(e-i-s,0)}get test(){return{components:this._components}}add(e,r){let i,s;if(Array.isArray(e))return void e.forEach(o=>this.add(o,r));const n=vF(e);n&&({index:i,position:r,component:e,key:s}=n),r&&typeof r=="object"&&({index:i,key:s,position:r}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,s)}remove(e,r){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,r));const i=this._find(e);if(i){if(this._componentToKey.has(e)&&this._componentToKey.get(e)!==r)return;const s=this._components.indexOf(i),n=i.node.parentNode;return n==null||n.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(r=>this.empty(r)).reduce((r,i)=>r.concat(i)):(e??(e="manual"),e==="manual"?Array.from(this._manualContainer.children).filter(r=>!r.classList.contains(Ea.corner)).map(r=>this.remove(r)):this._isValidPosition(e)?Array.from(this._cornerNameToContainerLookup[e].children).map(r=>this.remove(r),this):null)}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const s=vF(e)||vF(r);if(s&&(i=s.index,r=s.position,e=s.component||e),r&&!this._isValidPosition(r))return;const n=this.remove(e);n&&this.add(n,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getComponents(e){return e?Array.isArray(e)?e.map(r=>this._getComponentsAtPosition(r)).flat():this._getComponentsAtPosition(e):this._components.map(({widget:r,node:i})=>r??i)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,s){e instanceof tM||(e=new tM({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),s&&this._componentToKey.set(e,s)}_find(e){return e?e instanceof tM?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??Sst}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Ea.innerContainer,Ea.cornerContainer);const r=document.createElement("div");r.classList.add(Ea.innerContainer,Ea.manualContainer);const i=document.createElement("div");i.classList.add(Ea.topLeft,Ea.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(Ea.topRight,Ea.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Ea.bottomLeft,Ea.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(Ea.bottomRight,Ea.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=dPe();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:i,"top-trailing":a?i:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.position??"manual",{component:i,index:s}=e,n=this._positionNameToContainerLookup[r],o=s!=null&&s>-1;if(Est(i.widget)&&i.widget.startup(),!o)return void n.appendChild(i.node);const a=Array.prototype.slice.call(n.children);if(s===0)return void(n.firstChild?eW(i.node,n.firstChild):n.appendChild(i.node));s>=a.length?n.appendChild(i.node):eW(i.node,a[s])}_toPixelPosition(e){return{top:SR(e.top),left:SR(e.left),right:SR(e.right),bottom:SR(e.bottom)}}_findByComponent(e){return this._components.find(r=>r===e)??null}_findById(e){return this._components.find(({id:r})=>r===e)??null}_findByNode(e){return this._components.find(({node:r})=>r===e)??null}_getComponentsAtPosition(e){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(i=>this._findByNode(i)).filter(em).map(({widget:i,node:s})=>i??s)}};h([f()],Yd.prototype,"_locale",void 0),h([f()],Yd.prototype,"container",null),h([f()],Yd.prototype,"height",null),h([f({value:d_e})],Yd.prototype,"padding",null),h([Gi("padding")],Yd.prototype,"castPadding",null),h([f()],Yd.prototype,"view",void 0),h([f()],Yd.prototype,"width",null),Yd=h([F("esri.views.ui.UI")],Yd);const Cst=Yd,Ast="randomUUID"in crypto;function p_e(){if(Ast)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function M2t(){return`{${p_e()}}`}const Ost={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},Rst={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},Pst=t=>({...Rst,...t}),Mst=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},$st=(t,e)=>t.find(e),Pee=(t,e,r=!1)=>{let i=t;return e.forEach((s,n)=>{const o=i!=null&&i.children?$st(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==e.length-1||(i=o)}),i},Ist=t=>{let e;const r={...Ost,...t},i=Pst(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],u=(p,g,y)=>{var w;let _;i.eventHandlerInterceptor=(T,x,E,O)=>function(A){let $;s("domEvent",A);const M=Mst(A.currentTarget,_.domNode),U=M.some(B=>{var z;return customElements.get((z=B==null?void 0:B.tagName)==null?void 0:z.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!U)M.reverse(),$=Pee(_.getLastRender(),M);else{const B=A.composedPath(),z=B.slice(B.indexOf(A.currentTarget),B.indexOf(_.domNode)).filter(Y=>Y.getRootNode()===Y.ownerDocument).reverse();$=Pee(_.getLastRender(),z,!0)}let k;return $&&(k=r.handleInterceptedEvent(e,$,this,A)),s("domEventProcessed",A),k},(w=r.postProcessProjectionOptions)==null||w.call(r,i);const v=y();_=p(g,v,i),l.push(_),c.push(y),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let p=0;p<l.length;p++){const g=c[p]();s("rendered",void 0),l[p].update(g),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(d=r.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,g)=>{u(f0.append,p,g)},insertBefore:(p,g)=>{u(f0.insertBefore,p,g)},merge:(p,g)=>{u(f0.merge,p,g)},replace:(p,g)=>{u(f0.replace,p,g)},detach:p=>{for(let g=0;g<c.length;g++)if(c[g]===p)return c.splice(g,1),l.splice(g,1)[0];throw new Error("renderFunction was not found")}},e},Kb={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let ew,f_e,zD,m_e=!1,yI=!1,aj=!1,ic=!1,Mee=null,Hz=!1;const Lst=t=>{const e=new URL(t,xo.$resourcesUrl$);return e.origin!==FA.location.origin?e.href:e.pathname},Dst=t=>xo.$resourcesUrl$=t,J1=(t,e="")=>()=>{},$ee="http://www.w3.org/1999/xlink",Iee={},Nst="http://www.w3.org/2000/svg",Fst="http://www.w3.org/1999/xhtml",Ust=t=>t!=null,lj=t=>(t=typeof t,t==="object"||t==="function");function zst(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const g_e=(t,e,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=d=>{for(let p=0;p<d.length;p++)i=d[p],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!lj(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?_I(null,i):i),a=o)};if(c(r),e){e.key&&(s=e.key),e.name&&(n=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(p=>d[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,Vst);const u=_I(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},_I=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},kst={},Bst=t=>t&&t.$tag$===kst,Vst={forEach:(t,e)=>t.map(Lee).forEach(e),map:(t,e)=>t.map(Lee).map(e).map(Gst)},Lee=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),Gst=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),g_e(t.vtag,r,...t.vchildren||[])}const e=_I(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},jst=t=>ynt.map(e=>e(t)).find(e=>!!e),Hst=(t,e)=>t!=null&&!lj(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,Wst=t=>t,$2t=(t,e,r)=>{const i=Wst(t);return{emit:s=>qst(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},qst=(t,e,r)=>{const i=xo.ce(e,r);return t.dispatchEvent(i),i},Dee=new WeakMap,Yst=(t,e,r)=>{let i=bI.get(t);bnt&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,bI.set(t,i)},Xst=(t,e,r,i)=>{var s;let n=y_e(e,r);const o=bI.get(n);if(t=t.nodeType===11?t:qh,o)if(typeof o=="string"){t=t.head||t;let a=Dee.get(t),l;if(a||Dee.set(t,a=new Set),!a.has(n)){{l=qh.createElement("style"),l.innerHTML=o;const c=(s=xo.$nonce$)!==null&&s!==void 0?s:zst(qh);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(n)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return n},Zst=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,s=J1("attachStyles",e.$tagName$),n=Xst(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},y_e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Nee=(t,e,r,i,s,n)=>{if(r!==i){let o=kee(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Fee(r),u=Fee(i);l.remove(...c.filter(d=>d&&!u.includes(d))),l.add(...u.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):kee(FA,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&xo.rel(t,e,r,!1),i&&xo.ael(t,e,i,!1);else{const l=lj(i);if((o||l&&i!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=i;else{const u=i??"";e==="list"?o=!1:(r==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS($ee,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS($ee,e,i):t.setAttribute(e,i))}}},Jst=/\s/,Fee=t=>t?t.split(Jst):[],__e=(t,e,r,i)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||Iee,o=e.$attrs$||Iee;for(i in n)i in o||Nee(s,i,n[i],void 0,r,e.$flags$);for(i in o)Nee(s,i,n[i],o[i],r,e.$flags$)},vI=(t,e,r,i)=>{const s=e.$children$[r];let n=0,o,a,l;if(m_e||(aj=!0,s.$tag$==="slot"&&(ew&&i.classList.add(ew+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=qh.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=qh.createTextNode("");else{if(ic||(ic=s.$tag$==="svg"),o=s.$elm$=qh.createElementNS(ic?Nst:Fst,s.$flags$&2?"slot-fb":s.$tag$),ic&&s.$tag$==="foreignObject"&&(ic=!1),__e(null,s,ic),Ust(ew)&&o["s-si"]!==ew&&o.classList.add(o["s-si"]=ew),s.$children$)for(n=0;n<s.$children$.length;++n)a=vI(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?ic=!1:o.tagName==="foreignObject"&&(ic=!0)}return o["s-hn"]=zD,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=f_e,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===s.$tag$&&t.$elm$&&kC(t.$elm$,!1)),o},kC=(t,e)=>{xo.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==zD&&s["s-ol"]&&(w_e(s).insertBefore(s,cj(s)),s["s-ol"].remove(),s["s-ol"]=void 0,aj=!0),e&&kC(s,e)}xo.$flags$&=-2},v_e=(t,e,r,i,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===zD&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=vI(null,r,s,t),a&&(i[s].$elm$=a,o.insertBefore(a,cj(e))))},b_e=(t,e,r,i,s)=>{for(;e<=r;++e)(i=t[e])&&(s=i.$elm$,S_e(i),yI=!0,s["s-ol"]?s["s-ol"].remove():kC(s,!0),s.remove())},Qst=(t,e,r,i)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],u=e[l],d=i.length-1,p=i[0],g=i[d],y,_;for(;s<=l&&n<=d;)if(c==null)c=e[++s];else if(u==null)u=e[--l];else if(p==null)p=i[++n];else if(g==null)g=i[--d];else if(ER(c,p))tw(c,p),c=e[++s],p=i[++n];else if(ER(u,g))tw(u,g),u=e[--l],g=i[--d];else if(ER(c,g))(c.$tag$==="slot"||g.$tag$==="slot")&&kC(c.$elm$.parentNode,!1),tw(c,g),t.insertBefore(c.$elm$,u.$elm$.nextSibling),c=e[++s],g=i[--d];else if(ER(u,p))(c.$tag$==="slot"||g.$tag$==="slot")&&kC(u.$elm$.parentNode,!1),tw(u,p),t.insertBefore(u.$elm$,c.$elm$),u=e[--l],p=i[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===p.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==p.$tag$?y=vI(e&&e[n],r,o,t):(tw(_,p),e[o]=void 0,y=_.$elm$),p=i[++n]):(y=vI(e&&e[n],r,n,t),p=i[++n]),y&&w_e(c.$elm$).insertBefore(y,cj(c.$elm$))}s>l?v_e(t,i[d+1]==null?null:i[d+1].$elm$,r,i,n,d):n>d&&b_e(e,s,l)},ER=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,cj=t=>t&&t["s-ol"]||t,w_e=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,tw=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(ic=n==="svg"?!0:n==="foreignObject"?!1:ic,n==="slot"||__e(t,e,ic),i!==null&&s!==null?Qst(r,i,e,s):s!==null?(t.$text$!==null&&(r.textContent=""),v_e(r,null,e,s,0,s.length-1)):i!==null&&b_e(i,0,i.length-1),ic&&n==="svg"&&(ic=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},x_e=t=>{const e=t.childNodes;let r,i,s,n,o,a;for(i=0,s=e.length;i<s;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){r.hidden=!0;break}}x_e(r)}},Ih=[],T_e=t=>{let e,r,i,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(Uee(r,s)?(n=Ih.find(u=>u.$nodeToRelocate$===r),yI=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=e:Ih.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&Ih.map(u=>{Uee(u.$nodeToRelocate$,r["s-sn"])&&(n=Ih.find(d=>d.$nodeToRelocate$===r),n&&!u.$slotRefNode$&&(u.$slotRefNode$=n.$slotRefNode$))})):Ih.some(u=>u.$nodeToRelocate$===r)||Ih.push({$nodeToRelocate$:r}));e.nodeType===1&&T_e(e)}},Uee=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",S_e=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(S_e)},Kst=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,s=t.$vnode$||_I(null,null),n=Bst(e)?e:g_e(null,null,e);zD=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,ew=r["s-sc"],f_e=r["s-cr"],m_e=(i.$flags$&1)!==0,yI=!1,tw(s,n);{if(xo.$flags$|=1,aj){T_e(n.$elm$);let o,a,l,c,u,d,p=0;for(;p<Ih.length;p++)o=Ih[p],a=o.$nodeToRelocate$,a["s-ol"]||(l=qh.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(p=0;p<Ih.length;p++)if(o=Ih[p],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,u=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){u=d;break}(!u&&c!==a.parentNode||a.nextSibling!==u)&&a!==u&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,u))}else a.nodeType===1&&(a.hidden=!0)}yI&&x_e(n.$elm$),xo.$flags$&=-2,Ih.length=0}},ent=(t,e)=>{},uj=(t,e)=>(t.$flags$|=16,ent(t,t.$ancestorComponent$),Tnt(()=>tnt(t,e))),tnt=(t,e)=>{const r=t.$hostElement$,i=J1("scheduleUpdate",t.$cmpMeta$.$tagName$),s=r;let n;return e?n=Xw(s,"componentWillLoad"):n=Xw(s,"componentWillUpdate"),n=zee(n,()=>Xw(s,"componentWillRender")),i(),zee(n,()=>rnt(t,s,e))},rnt=async(t,e,r)=>{const i=t.$hostElement$,s=J1("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&Zst(t);const n=J1("render",t.$cmpMeta$.$tagName$);int(t,e,i),n(),s(),snt(t)},int=(t,e,r)=>{try{Mee=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(Kb.hasRenderFn||Kb.reflect)&&(Kb.vdomRender||Kb.reflect)&&(Kb.hydrateServerSide||Kst(t,e))}catch(a){NA(a,t.$hostElement$)}return Mee=null,null},snt=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=J1("postUpdate",e),s=r;t.$ancestorComponent$,Xw(s,"componentDidRender"),t.$flags$&64?(Xw(s,"componentDidUpdate"),i()):(t.$flags$|=64,Xw(s,"componentDidLoad"),i())},I2t=t=>{{const e=DA(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&uj(e,!1),r}},Xw=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){NA(i)}},zee=(t,e)=>t&&t.then?t.then(e):e(),nnt=(t,e)=>DA(t).$instanceValues$.get(e),ont=(t,e,r,i)=>{const s=DA(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;r=Hst(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const d=i.$watchers$[e];d&&d.map(p=>{try{l[p](r,o,e)}catch(g){NA(g,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;uj(s,!1)}}}},ant=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),s=t.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return nnt(this,n)},set(a){ont(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){xo.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},lnt=async(t,e,r,i,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=jst(t)]);const a=y_e(r,e.$modeName$);if(!bI.has(a)){const l=J1("registerStyles",r.$tagName$);Yst(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>uj(e,!0))()},cnt=t=>{},unt=t=>{if(!(xo.$flags$&1)){const e=DA(t),r=e.$cmpMeta$,i=J1("connectedCallback",r.$tagName$);e.$flags$&1?(E_e(t,e,r.$listeners$),cnt(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&hnt(t),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),lnt(t,e,r)),i()}},hnt=t=>{const e=t["s-cr"]=qh.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},dnt=t=>{if(!(xo.$flags$&1)){const e=DA(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},L2t=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){gnt(this,r)},connectedCallback(){unt(this),i&&i.call(this)},disconnectedCallback(){dnt(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,ant(t,r)},D2t=(t,e)=>e,E_e=(t,e,r,i)=>{r&&r.map(([s,n,o])=>{const a=fnt(t,s),l=pnt(e,o),c=mnt(s);xo.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>xo.rel(a,n,l,c))})},pnt=(t,e)=>r=>{try{Kb.lazyLoad||t.$hostElement$[e](r)}catch(i){NA(i)}},fnt=(t,e)=>e&4?qh:e&8?FA:e&16?qh.body:t,mnt=t=>_nt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,C_e=new WeakMap,DA=t=>C_e.get(t),gnt=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return E_e(t,r,e.$listeners$),C_e.set(t,r)},kee=(t,e)=>e in t,NA=(t,e)=>(0,console.error)(t,e),bI=new Map,ynt=[],FA=typeof window<"u"?window:{},qh=FA.document||{head:{}},N2t=FA.HTMLElement||class{},xo={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},_nt=(()=>{let t=!1;try{qh.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),vnt=t=>Promise.resolve(t),bnt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Bee=[],A_e=[],wnt=(t,e)=>r=>{t.push(r),Hz||(Hz=!0,e&&xo.$flags$&4?xnt(Wz):xo.raf(Wz))},Vee=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){NA(r)}t.length=0},Wz=()=>{Vee(Bee),Vee(A_e),(Hz=Bee.length>0)&&xo.raf(Wz)},xnt=t=>vnt().then(t),Tnt=wnt(A_e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.3.1
 */const O_e="calcite-mode-auto",R_e="calcite-mode-dark",Snt="calcite-mode-light",F2t={autoMode:O_e,darkMode:R_e,lightMode:Snt,rtl:"calcite--rtl"};/*!
* tabbable 6.1.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var P_e=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],wI=P_e.join(","),M_e=typeof Element>"u",Q1=M_e?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,xI=!M_e&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},TI=function t(e,r){var i;r===void 0&&(r=!0);var s=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),n=s===""||s==="true",o=n||r&&e&&t(e.parentNode);return o},Ent=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},$_e=function(e,r,i){if(TI(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(wI));return r&&Q1.call(e,wI)&&s.unshift(e),s=s.filter(i),s},I_e=function t(e,r,i){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!TI(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var u=Q1.call(o,wI);u&&i.filter(o)&&(r||!e.includes(o))&&s.push(o);var d=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),p=!TI(d,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(d&&p){var g=t(d===!0?o.children:d.children,!0,i);i.flatten?s.push.apply(s,g):s.push({scopeParent:o,candidates:g})}else n.unshift.apply(n,o.children)}}return s},L_e=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Ent(e))&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},Cnt=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},D_e=function(e){return e.tagName==="INPUT"},Ant=function(e){return D_e(e)&&e.type==="hidden"},Ont=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},Rnt=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},Pnt=function(e){if(!e.name)return!0;var r=e.form||xI(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(e.name));else try{s=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=Rnt(s,e.form);return!n||n===e},Mnt=function(e){return D_e(e)&&e.type==="radio"},$nt=function(e){return Mnt(e)&&!Pnt(e)},Int=function(e){var r,i=e&&xI(e),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,u,d;i=xI(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((u=s)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},Gee=function(e){var r=e.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},Lnt=function(e,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=Q1.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(Q1.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=xI(e);if(l&&!l.shadowRoot&&s(l)===!0)return Gee(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(Int(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return Gee(e);return!1},Dnt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return Q1.call(r,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}r=r.parentElement}return!1},SI=function(e,r){return!(r.disabled||TI(r)||Ant(r)||Lnt(r,e)||Ont(r)||Dnt(r))},qz=function(e,r){return!($nt(r)||L_e(r)<0||!SI(e,r))},Nnt=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},Fnt=function t(e){var r=[],i=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=L_e(a,o),c=o?t(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(Cnt).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},Unt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=I_e([e],r.includeContainer,{filter:qz.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:Nnt}):i=$_e(e,r.includeContainer,qz.bind(null,r)),Fnt(i)},U2t=function(e,r){r=r||{};var i;return r.getShadowRoot?i=I_e([e],r.includeContainer,{filter:SI.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=$_e(e,r.includeContainer,SI.bind(null,r)),i},z2t=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Q1.call(e,wI)===!1?!1:qz(r,e)},znt=P_e.concat("iframe").join(","),k2t=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Q1.call(e,znt)===!1?!1:SI(r,e)};const knt={getShadowRoot:!0};function B2t(t){const e="dir",r=`[${e}]`,i=Bnt(t,r);return i?i.getAttribute(e):"ltr"}function N_e(t){return t.getRootNode()}function F_e(t){return t.host||null}function V2t(t,{selector:e,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=N_e(s),o=r?"getElementById"in n?n.getElementById(r):null:e?n.querySelector(e):null,a=F_e(n);return o||(a?i(a):null)}return i(t)}function Bnt(t,e){function r(i){return i?i.closest(e)||r(F_e(N_e(i))):null}return r(t)}function Vnt(t,e){return U_e(t,e)}function U_e(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return U_e(i instanceof ShadowRoot?i.host:i,e)}function G2t(t,e){return!!Vnt(e,r=>r===t?!0:void 0)}function Gnt(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function j2t(t){if(t)return Gnt(t)?t.setFocus():t.focus()}function H2t(t){t&&(Unt(t,knt)[0]||t).focus()}const BC=":not([slot])";function W2t(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:BC;return r!=null&&r.all?jnt(t,i,r):Hnt(t,i,r)}function z_e(t,e){return t?Array.from(t.children||[]).filter(r=>r==null?void 0:r.matches(e)):[]}function jnt(t,e,r){let i=e===BC?z_e(t,BC):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===t),i=r!=null&&r.matches?i.filter(n=>n==null?void 0:n.matches(r.matches)):i;const s=r==null?void 0:r.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function Hnt(t,e,r){let i=e===BC?z_e(t,BC)[0]||null:t.querySelector(e);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===t?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const s=r==null?void 0:r.selector;return s?i==null?void 0:i.querySelector(s):i}function q2t(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function Y2t(t){return(!!t).toString()}function X2t(t){return!!Wnt(t).length}function Wnt(t){return t.target.assignedElements({flatten:!0})}function Z2t(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.3.1
 */function jee(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(R_e)||t.contains(O_e)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function qnt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?jee():document.addEventListener("DOMContentLoaded",()=>jee(),{once:!0}))}const Ynt=qnt;Ynt();let k_e;function Xnt(){try{Lst(".")}catch{Dst(ac(Rr(k_e)))}}function J2t(t){var r;const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push((r=t[i])==null?void 0:r.call(t));return Promise.all(e)}k_e="components/assets";const B_e=Symbol("widget"),Znt=Symbol("widget-test-data"),Jnt=[],Qnt={},EI=new WeakMap;function V_e(t,e){let r=e.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=V_e(t,r[s]);else r=Jnt;const i=e.vnodeSelector;if(hj(i)){const s=e.properties||Qnt,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:Knt,afterUpdate:eot,afterRemoved:G_e,parentWidget:t,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return e}function Knt(t,e,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,EI.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i._internalHandles.add(ha(()=>G_e(t)))}function eot(t,e,r,{widgetProperties:i}){var n;const s=EI.get(t);s&&(s.set(i),(n=s.afterUpdate)==null||n.call(s,s,t))}function G_e(t){var r;const e=EI.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),EI.delete(t))}function hj(t){return typeof t=="function"&&t[B_e]}const Hee=new Set;function tot(t){Hee.add(t),t.finally(()=>Hee.delete(t))}var j_e;const rot="esri.widgets.Widget";let iot=0;const sot={widgetIcon:"esri-icon-checkbox-unchecked"};function H_e(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?H_e(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const not=Ist({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,s,n,o)=>{const a=e==null?void 0:e(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),u=g=>a==null?void 0:a.call(n,g);n.addEventListener(c,u,l);const d=()=>n.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=g=>{p==null||p(g),d()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(Gae(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let wF=!1,hn=class extends uk(ys.EventedAccessor){constructor(t,e){super(t,e),this._attached=!1,this._internalHandles=new Oi,this._projector=not,this._readyForTrueRender=!1,this.iconClass=sot.widgetIcon,this.icon=null,this.key=this,this._loadLocale=ik(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await X0(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{if(this.destroyed)return;let l=await Zre(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=H_e(ye(l),this.uiStrings)),this[a]=l}));if(this.destroyed)return;for(const o of n)o.error&&ne.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),Xnt();const r="esri-widget-uid-"+p_e(),i=this.render.bind(this);this._trackingTarget=new NI(()=>this.scheduleRender());const s=()=>{var u;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const n=i();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=r),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(u=n.children)==null||u.forEach(d=>{if(hj(d.vnodeSelector))return;let{properties:p}=d;p||(d.properties=p={}),p.key||(p.key=`${this.id}--${c++}`)}),V_e(this,n)};this.render=()=>{if(wF)return s();let n=nPe(this)??null;if(n)return n;this._trackingTarget.clear(),wF=!0;try{n=tm(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{wF=!1}return n&&oPe(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),tot(this._resourcesFetch)}normalizeCtorArgs(t,e){const r={...t};return e&&(r.container=e),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(Aj)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Oe(this._trackingTarget),Oe(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,MN(this))}set container(t){this._get("container")||this._set("container",t)}castContainer(t){return hL(t)}get domNode(){return this.container}set domNode(t){this.container=t}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+iot++}set id(t){t&&this._set("id",t)}get label(){return this.declaredClass.split(".").pop()}set label(t){this._overrideIfSome("label",t)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(t){this._set("visible",t)}get[(j_e=B_e,Znt)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(MN(this),this._projector.scheduleRender())}classes(...t){return hPe.apply(this,t)}renderNow(){MN(this),this._projector.renderNow()}_postInitialize(){var e;if(this.destroyed)return;this.scheduleRender(),(e=this._delegatedEventNames)!=null&&e.length&&this._internalHandles.add(ce(()=>this.viewModel,(r,i)=>{i&&this._internalHandles.remove("delegated-events"),r&&LI(r)&&this._internalHandles.add(this._delegatedEventNames.map(s=>HC(r,s,n=>{this.emit(s,n)})),"delegated-events")},Tr)),this.postInitialize();const t=async()=>{await this._loadLocale().catch(Aj),this.scheduleRender()};this._internalHandles.add([Wre(t),ce(()=>this.uiStrings,t),Mu(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(t){t&&(this._projector.merge(t,this.render),this._attached=!0)}_detach(t){var e;this._attached&&(this._projector.detach(this.render),this._attached=!1),(e=t==null?void 0:t.parentNode)==null||e.removeChild(t)}};hn[j_e]=!0,h([f()],hn.prototype,"_readyForTrueRender",void 0),h([f({value:null})],hn.prototype,"container",null),h([Gi("container")],hn.prototype,"castContainer",null),h([f()],hn.prototype,"iconClass",void 0),h([f()],hn.prototype,"icon",void 0),h([f()],hn.prototype,"id",null),h([f()],hn.prototype,"label",null),h([f()],hn.prototype,"renderable",null),h([f()],hn.prototype,"uiStrings",void 0),h([f()],hn.prototype,"viewModel",void 0),h([f({value:!0})],hn.prototype,"visible",null),h([f()],hn.prototype,"key",void 0),h([f()],hn.prototype,"children",void 0),h([f()],hn.prototype,"afterCreate",void 0),h([f()],hn.prototype,"afterUpdate",void 0),h([f()],hn.prototype,"afterRemoved",void 0),hn=h([F(rot)],hn);const x2=hn;function Wee(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function oot(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function CR(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function aot(t){return t.type==="bing-maps"}const dg=[];let rw=class extends tC{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new er,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>ce(()=>{var s;return[i.suspended,(s=i.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),e&&e.removed&&e.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([Ga(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Mu(()=>{var e;return((e=this.view)==null?void 0:e.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t==null?void 0:t.allLayerViews;dg.length=0,t&&e?(e.forEach(r=>{var n;if(r.suspended||!((n=r.layer)!=null&&n.attributionVisible))return;const i=r.layer;if(Wee(i,"user"))return void CR(dg,r,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(r)){const o=this._fetchedAttributionData.get(r);return void(o?CR(dg,r,this._getDynamicAttribution(o,t,i)):Wee(i)&&CR(dg,r,i.copyright))}return void this._fetchAttributionData(r)}const s=i.get("portalItem.accessInformation");CR(dg,r,s||i.copyright)}),oot(this.items,dg)&&(this.items.removeAll(),this.items.addMany(dg)),dg.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await rm(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const r=e.ok?this._createContributionIndex(e.value,aot(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,r)}this._updateAttributionItems()}_createContributionIndex(t,e){const r=t.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),u=a.zoomMax-(e&&a.zoomMax?1:0),d=new Wr({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:yt.WGS84}),p={extent:Ow(d),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let g=c;g<=u;g++)i[g]??(i[g]=[]),i[g].push(p)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(t,e,r){var c;const{extent:i,scale:s}=e;let n=((c=r.tileInfo)==null?void 0:c.scaleToZoom(s))??0;if(n=Math.min(t.maxKey??0,Math.round(n)),!i||n==null||n<=-1)return"";const o=t[n],a=ev(i.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(u=>{const d=u.id,p=!l.has(d)&&a&&u.extent&&Mk(u.extent,a);return p&&l.add(d),p}).sort((u,d)=>d.score-u.score||u.objectId-d.objectId).map(u=>u.attribution).join(", "):""}};h([f({readOnly:!0,type:er})],rw.prototype,"items",void 0),h([f({readOnly:!0})],rw.prototype,"state",null),h([f()],rw.prototype,"view",void 0),rw=h([F("esri.widgets.Attribution.AttributionViewModel")],rw);const W_e=rw;function UA(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:cot(t[e])}}}function lot(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function cot(t){return function(e,...r){lot(e)?gPe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function zA(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var uot=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},q_e=function(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];Array.isArray(s)?q_e(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=uot(s)),e.push(s))}},hot=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var s=[];return q_e(r,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function jn(t,e,...r){return typeof t!="function"||hj(t)?hot(t,e,...r):t(e,...r)}const wb="esri-attribution",pg={base:`${wb} esri-widget`,poweredBy:`${wb}__powered-by`,sources:`${wb}__sources`,open:`${wb}--open`,sourcesOpen:`${wb}__sources--open`,link:`${wb}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let ea=class extends x2{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=pg.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new W_e}initialize(){this.addHandles(Ga(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[pg.open]:this._isOpen};return jn("div",{bind:this,class:this.classes(pg.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return jn("div",{class:pg.poweredBy},"Powered by"," ",jn("a",{class:pg.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:s}=this,n={[pg.sourcesOpen]:e,[pg.interactive]:r};return jn("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(pg.sources,n),innerHTML:s,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};h([f()],ea.prototype,"_isOpen",void 0),h([f()],ea.prototype,"_isInteractive",null),h([f()],ea.prototype,"_attributionTextOverflowed",void 0),h([f()],ea.prototype,"_prevSourceNodeHeight",void 0),h([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],ea.prototype,"attributionText",null),h([f()],ea.prototype,"iconClass",void 0),h([f()],ea.prototype,"icon",void 0),h([f()],ea.prototype,"itemDelimiter",void 0),h([f()],ea.prototype,"label",null),h([f(),zA("esri/widgets/Attribution/t9n/Attribution")],ea.prototype,"messages",void 0),h([f()],ea.prototype,"view",null),h([f({type:W_e})],ea.prototype,"viewModel",void 0),h([UA()],ea.prototype,"_toggleState",null),ea=h([F("esri.widgets.Attribution")],ea);const dot=ea,Y_e=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return CI(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return h([f()],e.prototype,"goToOverride",void 0),h([f()],e.prototype,"view",void 0),e=h([F("esri.widgets.support.GoTo")],e),e},pot="esri.widgets.CompassViewModel";let $_=class extends Y_e(we){constructor(e){super(e),this._handles=new Oi,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ce(()=>this.view,this._updateRotationWatcher,Tr))}destroy(){bi(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var r;if(!this.get("view.ready"))return;const e={};((r=this.view)==null?void 0:r.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ce(()=>e==null?void 0:e.rotation,this._updateForRotation,Tr):ce(()=>e==null?void 0:e.camera,this._updateForCamera,Tr))}};h([f({readOnly:!0})],$_.prototype,"canShowNorth",null),h([f()],$_.prototype,"orientation",void 0),h([f({readOnly:!0})],$_.prototype,"state",null),h([f()],$_.prototype,"view",void 0),$_=h([F(pot)],$_);const X_e=$_,fg={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let _h=class extends x2{constructor(e,r){super(e,r),this.iconClass=fg.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new X_e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",s=(r==="rotation"?"rotation":"compass")=="compass",n=i?-1:0,o={[fg.disabled]:i,[fg.interactive]:!i},a={[fg.northIcon]:s,[fg.rotationIcon]:!s},{messages:l}=this;return jn("div",{bind:this,class:this.classes(fg.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},jn("span",{"aria-hidden":"true",class:this.classes(fg.icon,a),styles:this._toRotationTransform(e)}),jn("span",{class:fg.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};h([f()],_h.prototype,"goToOverride",null),h([f()],_h.prototype,"iconClass",void 0),h([f()],_h.prototype,"icon",void 0),h([f()],_h.prototype,"label",null),h([f(),zA("esri/widgets/Compass/t9n/Compass")],_h.prototype,"messages",void 0),h([f()],_h.prototype,"view",null),h([f({type:X_e})],_h.prototype,"viewModel",void 0),h([UA()],_h.prototype,"_reset",null),_h=h([F("esri.widgets.Compass")],_h);const fot=_h,xb="esri-navigation-toggle",zc={base:`${xb} esri-widget`,button:`${xb}__button esri-widget--button`,activeButton:`${xb}__button--active`,panButton:`${xb}__button--pan`,rotateButton:`${xb}__button--rotate`,isLayoutHorizontal:`${xb}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let iw=class extends we{constructor(t){super(t),this.navigationMode="pan",this.view=null}initialize(){this.own(Mu(()=>{var t;return(t=this.view)==null?void 0:t.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var t;return this.get("view.ready")&&((t=this.view)==null?void 0:t.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};h([f({readOnly:!0})],iw.prototype,"state",null),h([f()],iw.prototype,"navigationMode",void 0),h([f()],iw.prototype,"view",void 0),iw=h([F("esri.widgets.NavigationToggleViewModel")],iw);const Z_e=iw;let vh=class extends x2{constructor(e,r){super(e,r),this.iconClass=zc.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new Z_e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[zc.disabled]:e,[zc.isLayoutHorizontal]:this.layout==="horizontal"},s={[zc.activeButton]:r},n={[zc.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return jn("div",{bind:this,class:this.classes(zc.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},jn("div",{class:this.classes(zc.button,zc.panButton,s)},jn("span",{class:zc.panIcon})),jn("div",{class:this.classes(zc.button,zc.rotateButton,n)},jn("span",{class:zc.rotationIcon})))}_toggle(){this.toggle()}};h([f()],vh.prototype,"iconClass",void 0),h([f()],vh.prototype,"icon",void 0),h([f()],vh.prototype,"label",null),h([f({value:"vertical"})],vh.prototype,"layout",null),h([f(),zA("esri/widgets/NavigationToggle/t9n/NavigationToggle")],vh.prototype,"messages",void 0),h([f()],vh.prototype,"view",null),h([f({type:Z_e})],vh.prototype,"viewModel",void 0),h([UA()],vh.prototype,"_toggle",null),vh=h([F("esri.widgets.NavigationToggle")],vh);const mot=vh,RT={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Ef=class extends x2{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,r={[RT.disabled]:!this.enabled,[RT.interactive]:this.enabled};return jn("div",{bind:this,class:this.classes(RT.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},jn("span",{"aria-hidden":"true",role:"presentation",class:this.classes(RT.icon,this.iconClass??"")}),jn("span",{class:RT.iconText},this.title))}_triggerAction(){this.action.call(this)}};h([f()],Ef.prototype,"action",void 0),h([f()],Ef.prototype,"enabled",void 0),h([f()],Ef.prototype,"iconClass",void 0),h([f()],Ef.prototype,"icon",void 0),h([f()],Ef.prototype,"title",void 0),h([UA()],Ef.prototype,"_triggerAction",null),Ef=h([F("esri.widgets.IconButton")],Ef);const qee=Ef;let sw=class extends we{get canZoomIn(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMaxScale");return e===0||t>e}get canZoomOut(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMinScale");return e===0||t<e}};h([f({readOnly:!0})],sw.prototype,"canZoomIn",null),h([f({readOnly:!0})],sw.prototype,"canZoomOut",null),h([f()],sw.prototype,"view",void 0),sw=h([F("esri.widgets.Zoom.ZoomConditions2D")],sw);const got=sw;let nw=class extends we{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};h([f({readOnly:!0})],nw.prototype,"canZoomIn",null),h([f({readOnly:!0})],nw.prototype,"canZoomOut",null),h([f()],nw.prototype,"view",void 0),nw=h([F("esri.widgets.Zoom.ZoomConditions3D")],nw);const yot=nw;let Bg=class extends we{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new got({view:e}):e.type==="3d"&&(this._zoomConditions=new yot({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():cM(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():cM(e.goTo({zoomFactor:.5}))}};h([f()],Bg.prototype,"_zoomConditions",void 0),h([f()],Bg.prototype,"canZoomIn",null),h([f()],Bg.prototype,"canZoomOut",null),h([f({readOnly:!0})],Bg.prototype,"state",null),h([f()],Bg.prototype,"view",null),Bg=h([F("esri.widgets.Zoom.ZoomViewModel")],Bg);const J_e=Bg,PT={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let Xd=class extends x2{constructor(e,r){super(e,r),this.iconClass=PT.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new J_e}initialize(){this._zoomInButton=new qee({action:this.zoomIn.bind(this),iconClass:PT.zoomInIcon}),this._zoomOutButton=new qee({action:this.zoomOut.bind(this),iconClass:PT.zoomOutIcon})}destroy(){this._zoomInButton=Oe(this._zoomInButton),this._zoomOutButton=Oe(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[PT.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:s}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=s;const{zoomIn:n,zoomOut:o}=this.messages;return this._zoomInButton.title=n,this._zoomOutButton.title=o,jn("div",{class:this.classes(PT.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};h([f()],Xd.prototype,"iconClass",void 0),h([f()],Xd.prototype,"icon",void 0),h([f()],Xd.prototype,"label",null),h([f({value:"vertical"})],Xd.prototype,"layout",null),h([f(),zA("esri/widgets/Zoom/t9n/Zoom")],Xd.prototype,"messages",void 0),h([f()],Xd.prototype,"view",null),h([f({type:J_e})],Xd.prototype,"viewModel",void 0),Xd=h([F("esri.widgets.Zoom")],Xd);const _ot=Xd;function vot(t){return(t==null?void 0:t.view)!==void 0}let rM=class extends Cst{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const s=this._find(i),n=s&&s.widget;vot(n)&&(n.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([ce(()=>this.components,this._componentsWatcher,Tr),ce(()=>this.view,this._updateViewAwareWidgets,Tr)])}_add(e,r,i,s){let n=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;n=this._createComponent(e)}super._add(n,r,i,s)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);if(r)return new tM({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new dot({view:r});case"compass":return new fot({view:r});case"navigation-toggle":return new mot({view:r});case"zoom":return new _ot({view:r})}}};h([f()],rM.prototype,"components",void 0),rM=h([F("esri.views.ui.DefaultUI")],rM);const Q_e=rM;let iM=class extends Q_e{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([f()],iM.prototype,"components",void 0),iM=h([F("esri.views.ui.3d.DefaultUI3D")],iM);const K_e=iM;let Ge=class extends dRe(nMe(MPe(GMe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new lm({slicePlane:fae},this),this._resourceController=sXe(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new BU({view:this}),this.labeler=new S_({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new yx,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new k_,this.environmentManager=new uh,this.floors=new er,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new WMe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new bYe,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new K_e,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new gz,this.voxelWasm=null,this.voxelWasmPromise=null,JAe(),t&&t.environment||(this._defaults.environment=new kb,this.environment=this._defaults.environment);const e=(r=null)=>{r!=null&&r.type===jr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([Ga(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),ce(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new Q6e({view:this}),this.stateManager=new js({view:this})}initialize(){this.groundView=new WPe({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(Ga(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Tr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Tr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>ove(e>0?1e3/Math.ceil(e):0),Tr),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Ss),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Ss),this.addHandles(ce(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Nr))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Oe(this.sharedSymbolResources),this._set("labeler",Oe(this.labeler)),this._set("deconflictor",Oe(this.deconflictor)),this._resourceController=Oe(this._resourceController),this._set("stateManager",Oe(this.stateManager)),this._set("inputManager",Oe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Oe(this.environmentManager)),this.groundView=Oe(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof Wr?this.spatialReference&&(t=AR(t,this.spatialReference),t==null)?(ne.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(ne.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?ne.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Re.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:AR(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||yt.WGS84,r=AR(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||yt.WGS84;let e;const r=n=>{const o=AR(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const n=i.groundExtent;r(new Wr({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof kb?t:t instanceof Ole?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):kb.fromWebsceneEnvironment(t):tn(kb,t):new kb}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){VP.isValidProfile(t)&&(VP.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||VP.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");lv(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?lRe(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?nA.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||$C(a))return;++r,t+=a.updatingProgress}}else++r});for(const a of this._updatingObjects)a!=null&&a.updating&&(r+=.1,t+=.5*.1);for(const a of this._updatingObjectsWithProgress)a!=null&&a.updating&&(++r,t+=a.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.updating||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(t!=null)return NN(t);const e=this.spatialReference;return e?((r=this.defaultsFromMap)==null?void 0:r.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?NN(this.defaultsFromMap.viewingMode):P$(e,Re.Global)?"global":"local":"global"}set viewingMode(t){this.ready?ne.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new MXe(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return ne.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),s=sq(t)?iq(this,t):t,n=tp(s);r.enableDraped=r.include&&!r.include.has(Kg)||r.exclude&&r.exclude.has(Kg);const o=this.sceneIntersectionHelper,a=Fu(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?Yn.ALL:Yn.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=jz(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return ne.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?cp(this.elevationProvider,t):null)??0;return bo(t,Tb,this.renderSpatialReference,e),this.state.camera.projectToScreen(Tb,xF),Pu(xF[0],xF[1])}pixelSizeAt(t){return this.ready?t?(bo(t,Tb,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Tb)):0:(ne.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return ne.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=sq(t)?iq(this,t):t,i=Li(r.x,r.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=Fu(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=Yn.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Cee(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,u={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:nd(a)?a.distanceInRenderSpace:0,layer:c}};return kr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=n),Promise.resolve(u)}async popupHitTest(t){const{results:e,ground:r}=await ost(this,t);let i=null;return!(e.length===0||Math.abs((e[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new X("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return fF(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return mF(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[mF(r[0],this._pixelFormat()),mF(r[1],this._pixelFormat())]}_completeSettings(t){const e=zit(t,this);return e.pixelRatio/=this.state.pixelRatio,Git(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!ie("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=fF(r[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[i,fF(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return dq.importLayerView(t)}hasLayerViewModule(t){return dq.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r,i;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=gst(this.type);const e=ie("safari");if(e&&e<9&&(t=new X("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw ne.getLogger(this.declaredClass).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?cq(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,Re.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Re.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,Re.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Re.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!P$(t,r)&&(e==null||!!cH(e)||(!QS(e)||PD(e,t,r)!=null)&&(!lH(e)||r!==Re.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,s=t.isWGS84;return cH(e)&&(i||s)?!s||r===Re.Local||UG(e.tileInfo,e.fullExtent,t,Re.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:yt.WebMercator,viewingMode:r}]:[{spatialReference:i?yt.WGS84:yt.WebMercator,viewingMode:r}]:QS(e)||lH(e)||!i&&!s?QS(e)&&i&&r!==Re.Global?[{spatialReference:t,viewingMode:r},{spatialReference:yt.WGS84,viewingMode:Re.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?yt.WGS84:yt.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?ne.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${NN(r)} viewing mode.`):t.isGeographic&&ne.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||yt.WGS84;return wn(t,this.renderSpatialReference,t,r)||(r=yt.WGS84,wn(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new at(t,r),e}trackGraphicState(t){if(!t.graphic)return ne.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const s=n=>{var o;!i&&n!=null&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return Zw(t.map(r=>this.highlight(r)));if(er.isCollection(t))return Zw(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):ha()}maskOccludee(t){if(!t)return ne.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const s=n=>{!i&&n!=null&&lst(n)&&(r=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await QE(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new X("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,NE.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,NE.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(Tb)?(e=this.computeMapPointFromVec3d(Tb,e),t.intersector===Ai.TERRAIN&&this.basemapTerrain&&(e.z=cp(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let s=0;s<t.length;s++){const n=t[s],o=Cee(n,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=jz(n,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&s!==t.length-1&&(i=new Set),i!=null){const u=this._getGraphicFilterUid(a.graphic);if(i.has(u))continue;i.add(u)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){var s;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const n=i.objectIdField??uRe,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof om)bot(r,this._getGraphicFilterUid(t)),e===NE.INCLUDE&&(this.graphicsView!=null&&t.layer===this?MT(r,this.graphicsView.processor.layer.id):t.layer&&MT(r,t.layer.uid));else if(SF(t))for(const i of t)i===this.graphics&&this.graphicsView!=null?MT(r,this.graphicsView.processor.layer.id):i===this.map.ground?MT(r,Kg):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&MT(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new eKe({view:this})),this._set("elevationProvider",new DS({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new $a({view:this})),this._set("featureTiles",new zn({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?oA(WI(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>kr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(he(()=>import("./FeatureTileTree3DDebugger-6745319f.js"),["assets/FeatureTileTree3DDebugger-6745319f.js","assets/TileTreeDebugger-842c5f90.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&kr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||kr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Ss),this.updatingHandles.add(()=>this.clippingArea,t,Ss),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Ss)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new kYe(this.map,t));const e=this.state.isGlobal,r=Oae(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",jYe.create(this.state.viewingMode,r)),e||this.addHandles(ce(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const s=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!yL(i,this.basemapTerrain.spatialReference,Yee,s)||(this.renderCoordsHelper.extent=Yee)},Nr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Ax/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===jr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(ce(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Nr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new wYe(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const r=hL(this.surface);this._stage=new Yl({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Tr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),Tr),ce(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,Ss),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()}),HC(this._stage.renderView.canvas,"webglcontextlost",s=>this.fatalError=new X("webgl-context-lost",s.statusMessage))],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:gz.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Ax/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Oe(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new LXe({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await he(()=>import("./GraphicsView3D-77932b29.js"),["assets/GraphicsView3D-77932b29.js","assets/GraphicsProcessor-5c0bb4fd.js","assets/diffUtils-149561ab.js","assets/Query-02316d46.js","assets/Graphics3DObjectStates-e0749d1f.js","assets/UniqueValueRenderer-6bfde73c.js","assets/ColorStop-c9dfec3d.js","assets/colorRamps-5cc134e8.js","assets/jsonUtils-a30c08d1.js","assets/DictionaryLoader-d7f4a828.js","assets/LRUCache-2af9f319.js","assets/FieldsIndex-f92177f9.js","assets/heatmapUtils-b7e5e306.js","assets/defaults-a3afa070.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-faf2ce2d.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-5ef79871.js","assets/quickselect-6ad44cba.js"])).default;qt(t),await QE(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=cq(this.viewingMode);if(t===Re.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(Ga(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Kg);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Kg);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=he(()=>import("./VoxelWasmPerSceneView-3fac9a7f.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function MT(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function bot(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function AR(t,e){return t!=null&&R1(t.spatialReference,e)?oA(t,e):null}var NE;Ge.type="3d",h([f()],Ge.prototype,"_userClippingArea",void 0),h([f()],Ge.prototype,"_resourceController",void 0),h([f()],Ge.prototype,"_stage",void 0),h([f({readOnly:!0})],Ge.prototype,"deconflictor",void 0),h([f({readOnly:!0})],Ge.prototype,"labeler",void 0),h([f(M9(yx,"analyses"))],Ge.prototype,"analyses",void 0),h([f({type:bx,readOnly:!0})],Ge.prototype,"animation",null),h([f({readOnly:!0})],Ge.prototype,"basemapTerrain",void 0),h([f({readOnly:!0})],Ge.prototype,"elevationProvider",void 0),h([f()],Ge.prototype,"camera",null),h([f({type:Ru})],Ge.prototype,"contentCamera",null),h([f({readOnly:!0})],Ge.prototype,"canvas",void 0),h([f({type:at})],Ge.prototype,"center",null),h([f({type:Wr})],Ge.prototype,"clippingArea",null),h([f({type:k_})],Ge.prototype,"constraints",void 0),h([f({type:Wr,readOnly:!0})],Ge.prototype,"renderDataExtent",null),h([f({type:Wr,readOnly:!0})],Ge.prototype,"dataExtent",null),h([f({type:Wr,readOnly:!0})],Ge.prototype,"_groundAndLayersExtent",null),h([f({value:null,type:kb})],Ge.prototype,"environment",null),h([Gi("environment")],Ge.prototype,"castEnvironment",null),h([f({readOnly:!0})],Ge.prototype,"environmentManager",void 0),h([f({type:Wr})],Ge.prototype,"extent",null),h([f()],Ge.prototype,"floors",void 0),h([f()],Ge.prototype,"screenCenter",null),h([f()],Ge.prototype,"frustum",null),h([f({type:Number,readOnly:!0})],Ge.prototype,"fullOpacity",void 0),h([f({readOnly:!0})],Ge.prototype,"graphicsView",void 0),h([f({readOnly:!0})],Ge.prototype,"analysisViewManager",void 0),h([f()],Ge.prototype,"groundView",void 0),h([f({type:Boolean})],Ge.prototype,"initialExtentRequired",null),h([f()],Ge.prototype,"_defaultsFromMapSettings",null),h([f()],Ge.prototype,"interacting",null),h([f()],Ge.prototype,"stationary",null),h([f()],Ge.prototype,"navigating",null),h([f()],Ge.prototype,"map",void 0),h([f({readOnly:!0})],Ge.prototype,"mapCoordsHelper",void 0),h([f()],Ge.prototype,"padding",null),h([f({type:$a,readOnly:!0})],Ge.prototype,"pointsOfInterest",void 0),h([f({type:zn,readOnly:!0})],Ge.prototype,"featureTiles",void 0),h([f()],Ge.prototype,"_featureTreeDebugger",void 0),h([f({type:Boolean})],Ge.prototype,"screenSizePerspectiveEnabled",void 0),h([f({constructOnly:!0})],Ge.prototype,"deactivatedWebGLExtensions",void 0),h([f({constructOnly:!0})],Ge.prototype,"debugWebGLExtensions",void 0),h([f({constructOnly:!0})],Ge.prototype,"renderCanvas",void 0),h([f({constructOnly:!0})],Ge.prototype,"state",void 0),h([f({readOnly:!0})],Ge.prototype,"inputManager",void 0),h([f({readOnly:!0})],Ge.prototype,"stateManager",void 0),h([f({type:["low","medium","high"]})],Ge.prototype,"qualityProfile",null),h([f({type:wQ,get(){let t=this._get("qualitySettings");return t||(t=new wQ,VP.apply(this.qualityProfile,t)),t}})],Ge.prototype,"qualitySettings",void 0),h([f()],Ge.prototype,"slicePlane",null),h([f({readOnly:!0})],Ge.prototype,"typeSpecificPreconditionsReady",null),h([f({readOnly:!0})],Ge.prototype,"renderCoordsHelper",void 0),h([f({readOnly:!0})],Ge.prototype,"sceneIntersectionHelper",void 0),h([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ge.prototype,"resolution",null),h([f({type:Number})],Ge.prototype,"scale",null),h([f()],Ge.prototype,"heightModelInfo",null),h([f()],Ge.prototype,"spatialReference",void 0),h([f({type:Boolean,constructOnly:!0})],Ge.prototype,"alphaCompositingEnabled",void 0),h([f({constructOnly:!0})],Ge.prototype,"preserveDrawingBufferEnabled",void 0),h([f({type:Boolean})],Ge.prototype,"supersampleScreenshotsEnabled",void 0),h([f({readOnly:!0})],Ge.prototype,"type",void 0),h([f(),Gi(t=>t instanceof Q_e?t:ex(K_e,t))],Ge.prototype,"ui",void 0),h([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],Ge.prototype,"updating",null),h([f()],Ge.prototype,"_updatingObjects",null),h([f()],Ge.prototype,"_updatingObjectsWithProgress",null),h([f({type:Number,readOnly:!0,dependsOn:["updating"]})],Ge.prototype,"updatingProgress",void 0),h([f({type:["global","local"]})],Ge.prototype,"viewingMode",null),h([f({type:Qh})],Ge.prototype,"viewpoint",null),h([f({type:Number})],Ge.prototype,"zoom",null),h([f({type:gz})],Ge.prototype,"highlightOptions",void 0),Ge=h([F("esri.views.SceneView")],Ge),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(NE||(NE={}));const Tb=C(),xF=Li(),Yee=Ut(),wot=Ge;function xot(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const r=e._delegatedEventNames,i=Array.isArray(t)?t:Tot(t);r.push(...i)}}function Tot(t){return t.split(",").map(e=>e.trim())}new Tn({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"});new Tn({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});let Wy=class extends Ke{constructor(e){super(e),this.deviationUnit=null,this.geometries=null,this.maxDeviation=null}};h([f({type:String,json:{write:!0}})],Wy.prototype,"deviationUnit",void 0),h([f({json:{read:{reader:t=>t?t.map(e=>Ou(e)).filter(em):null},write:{writer:(t,e)=>{e.geometries=(t==null?void 0:t.map(r=>r.toJSON()))??null}}}})],Wy.prototype,"geometries",void 0),h([f({type:Number,json:{write:!0}})],Wy.prototype,"maxDeviation",void 0),Wy=h([F("esri.rest.support.GeneralizeParameters")],Wy),Wy.from=tn(Wy);new Tn({preserveShape:"preserve-shape"});let mg=class extends Ke{constructor(e){super(e),this.calculationType=null,this.geodesic=null,this.lengthUnit=null,this.polylines=null}};h([f({type:String,json:{write:!0}})],mg.prototype,"calculationType",void 0),h([f({type:Boolean,json:{write:!0}})],mg.prototype,"geodesic",void 0),h([f({json:{write:!0}})],mg.prototype,"lengthUnit",void 0),h([f({type:[Kx],json:{read:{reader:t=>t?t.map(e=>Ou(e)):null},write:{writer:(t,e)=>{e.polylines=t.map(r=>r.toJSON())}}}})],mg.prototype,"polylines",void 0),mg=h([F("esri.rest.support.LengthsParameters")],mg),mg.from=tn(mg);new Tn({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"});new Tn({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});let cf=class extends Ke{constructor(e){super(e),this.bevelRatio=null,this.geometries=null,this.offsetDistance=null,this.offsetHow=null,this.offsetUnit=null}};h([f({type:Number,json:{write:!0}})],cf.prototype,"bevelRatio",void 0),h([f({json:{read:{reader:t=>t?t.map(e=>Ou(e)).filter(em):null},write:{writer:(t,e)=>{e.geometries=(t==null?void 0:t.map(r=>r.toJSON()))??null}}}})],cf.prototype,"geometries",void 0),h([f({type:Number,json:{write:!0}})],cf.prototype,"offsetDistance",void 0),h([f({type:String,json:{write:!0}})],cf.prototype,"offsetHow",void 0),h([f({type:String,json:{write:!0}})],cf.prototype,"offsetUnit",void 0),cf=h([F("esri.rest.support.OffsetParameters")],cf),cf.from=tn(cf);new Tn({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});let gg=class extends Ke{constructor(t){super(t),this.geometries1=null,this.geometries2=null,this.relation=null,this.relationParameter=null}};h([f({json:{read:{reader:t=>t?t.map(e=>Ou(e)).filter(em):null},write:{writer:(t,e)=>{e.geometries1=(t==null?void 0:t.map(r=>r.toJSON()))??null}}}})],gg.prototype,"geometries1",void 0),h([f({json:{read:{reader:t=>t?t.map(e=>Ou(e)).filter(em):null},write:{writer:(t,e)=>{e.geometries2=(t==null?void 0:t.map(r=>r.toJSON()))??null}}}})],gg.prototype,"geometries2",void 0),h([f({type:String,json:{write:!0}})],gg.prototype,"relation",void 0),h([f({type:String,json:{write:!0}})],gg.prototype,"relationParameter",void 0),gg=h([F("esri.rest.support.RelationParameters")],gg),gg.from=tn(gg);new Tn({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});let qy=class extends Ke{constructor(t){super(t),this.extendHow="default-curve-extension",this.polylines=null,this.trimExtendTo=null}};h([f({type:String,json:{write:!0}})],qy.prototype,"extendHow",void 0),h([f({type:[Kx],json:{read:{reader:t=>t?t.map(e=>Ou(e)):null},write:{writer:(t,e)=>{e.polylines=t.map(r=>r.toJSON())}}}})],qy.prototype,"polylines",void 0),h([f({json:{read:{reader:t=>t?Ou(t):null},write:{writer:(t,e)=>{e.trimExtendTo=t.toJSON()}}}})],qy.prototype,"trimExtendTo",void 0),qy=h([F("esri.rest.support.TrimExtendParameters")],qy),qy.from=tn(qy);const e1e=ne.getLogger("esri.widgets.support.geolocationUtils");function Sot(){const t=ie("esri-geolocation");return t||e1e.warn("geolocation-unsupported","Geolocation unsupported."),t}function Eot(){const t=window.isSecureContext;return t||e1e.warn("insecure-context","Geolocation requires a secure origin."),t}function Cot(){return Sot()&&Eot()}function Aot(t,e){const{position:r,view:i}=t,s=Oot(r),n=s==null?void 0:s.coords;if(!n)throw new X("geometry-service:no-coords","Geolocation has no coordinates");return Pot(Rot(n),i,e)}function Oot(t){const e=t&&t.coords||{},r={accuracy:e.accuracy,altitude:e.altitude,altitudeAccuracy:e.altitudeAccuracy,heading:e.heading,latitude:e.latitude,longitude:e.longitude,speed:e.speed};return t&&{coords:r,timestamp:t.timestamp}}function Rot({longitude:t,latitude:e,altitude:r}){return new at({longitude:t,latitude:e,z:r||void 0,spatialReference:{wkid:4326}})}function Pot(t,e,r){if(!e)return Promise.resolve(t);const i=e.spatialReference;return i.isWGS84?Promise.resolve(t):i.isWebMercator?Promise.resolve(Ow(t)):Mot(r).then(s=>{if(!s)throw new X("geometry-service:missing-url","Geometry service URL is missing");const n=new AD({geometries:[t],outSpatialReference:i});return DG(s,n,r).then(o=>o[0])})}function Mot(t){if(Er.geometryServiceUrl)return Promise.resolve(Er.geometryServiceUrl);const e=vc.getDefault();return e.load(t).catch(()=>{}).then(()=>e.get("helperServices.geometry.url"))}const $ot=2500,t1e={type:"CIMPictureMarker",primitiveName:"headingOverride",enable:!0,anchorPoint:{x:0,y:-.5},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:36,billboardMode3D:"FaceNearPlane",invertBackfaceTexture:!0,scaleX:1,textureFilter:"Picture",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAkCAYAAACe0YppAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAYaSURBVHgBvVfNb1VFFD/nzP16xRYJKYREEiJoDLLShQkrSNzoHv8I2QgxwY8FJWHhxoVxISEu2AordWNiQjAxEBeEsKAmhCCwkPDRAn1t33v33jnH37n3Fam0pa8kTjOde+/MnN/5+J0z85jW08yYTpxgfzx0bS+fO0R0YHqyeb9w7YEtLTv+9rSdOH7ciNleJJJX/Do1JQ3AltdlT35fiN6gG8kD8akdmzO+6w/zM7wdw725rUY78DBXtmATA6PZntFgm9Kjm6o/HFJpdi5Xhp+16sDBC+H+gUmZfjIXHKC+35U42ZHZfpe30BZS7okNFnhu8wTRk2ek5LEV2q+N8nEj6yuNVRjHddftrt4ahyJbOxF+Uppi/Rf47NlA05Pp9vkyRNkkD8sqUJHwOGfSpYFQFXhTJryQBaZSeAxbFus+U1K0gJm2oy3QKwuZzqeuSK5kpW6BEsE6+nCsAHDXQWuaOljzU8uP/ToxUW4KcwKg8QzOSdFL6Swm0hurAC7N2qIW7ncwNgYKF4la3/w7RnzrUK29KseXWqmTKXGl45Zrd9CLrsSjr96fcw4kS46mTsJznSTrVBR6VQJQdDbpZTWexxgCYCFz30cquD8oYVQgtUAUzfo8wGtqGoNRFmFZ1KKulJMQu3Vpm/I8Pup3ekvES57GaabXo4lsszEA6zrkhcmAAkBNshi59O9wVsokBLZUCQAxllXVBkyCDRQuTlLLiLSEqw3gfUqU0kVdsKymsnzyPLm8fXZxDxVZgvUhg9QyaKDI7AhpSlRVEaA83JM+/V8pGO0PMTHyZwra9FQVk4i1e0D6dPK9v5agkmXAhc0Bw5MjlAQQE0lSDbUmbBX4kGfsiiQWuSZtdle1S4F73cUKJgviyw4mmmqlVSoR/FAK2d1noWQZ8N79MySw0tgNzhN00jRFaPM6y3IyLWBxXuOdvMfhaIy1MQctmvnEMGrMq2Y/ekC3dHF14I84gmZP2s0pgiJFHVwYhIIrMC1zgT4fQgsS0CG48LWtslAsgeKZK5U1c5Slj+nEvvJZqOWubr5ks8iE3bVqCMQCz4p5aiUqpMrOdHz2qLFTxAMSPLwY8WpmntNwrXIMCWvESGH+7n9hVi6ZJ6/sR5gnycFFQgsCQEEB8T9TbsCGy4PrZrEBjGyIt4EApoGRXWKP6Mt3fnvOvhWBjR4gdjtJEDmGQQkBSCS6Teys5qECABTPWOBwcPWgAPIU+E2+Rq3J8lsrQawMHNPbqAXvRqasWcMB/mK42N3twM6/FsbJTZK2Fru15K7niPVIp6RHn++9vRKErAg8ta+MFq4LBxAJKY1EajpxLj5KUzFzOMTni4btxoUzXPzIIOwLnEPxGVqlyWoTdO/WNRUXJhDmAgNAJVd0eABj8FTCvLbpEnxdOycJlFNXVq6MDvzthwOQ654LaMGGVofQWIWtXhM9xaCQp85QIZFMPXcpuUPH3uquJj6htVonvySD+KY6c2AulPAzHdVaZElvPCGBgvkIRUECr1J4qmV6LdGyJvAnu+94HZMla1Eg1AuGVyQWnNCwzqsUXK5+AIsUyPRc1Rbpi93X1xK9tsXtkj9U7INWSWvU0DaZ6OlVAmUDiqgbrwY2Z3ThRVKFXrgi/R0x9GMplxAyER6ynAtZin1DQoLVznLMU+/mywMf3dlDpbyMlbjLQDhLw/Sh24sm5dhTrlHKgS/T0X2zLw/sLeGr5OlEbg2uHwAFw5reKuKsJj8kcIj0zq9H5PqAj+z6E8y+YRIaUhnAEOrcWgv9m3shQ1H7mz5duVJtDLhZqZcNlrEDwXKwCzncdFg+PJeVf1m3uPUupLR7Hq6tHNyLhw1TCmdGbm0BmaUjr63LzaMBH943D9f+yO5uZ7HfcLktqdwqMU0jtPUDN6vDOfzgKFrXtta6q83vfHU4M5KoURbT4W3zsPIqrgQFO8GozV8ocZGOTN4dRdRowN6CnOLmKkk5t7H1i+HPNGJj2kj7buYajoRXh2+36eOt+2nENrrF3ozODEmFC0D4hjbQNgYc+DSYjd9qqGSJXqL/tZ16/DWdfvw9bbCt41hcpYn9RAEX9Q22fwC74ny5v9iplQAAAABJRU5ErkJggg=="},Iot=new s2({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:14,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:17,ymax:17},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[8.5,0],[7.02,.13],[5.59,.51],[4.25,1.14],[3.04,1.99],[1.99,3.04],[1.14,4.25],[.51,5.59],[.13,7.02],[0,8.5],[.13,9.98],[.51,11.41],[1.14,12.75],[1.99,13.96],[3.04,15.01],[4.25,15.86],[5.59,16.49],[7.02,16.87],[8.5,17],[9.98,16.87],[11.41,16.49],[12.75,15.86],[13.96,15.01],[15.01,13.96],[15.86,12.75],[16.49,11.41],[16.87,9.98],[17,8.5],[16.87,7.02],[16.49,5.59],[15.86,4.25],[15.01,3.04],[13.96,1.99],[12.75,1.14],[11.41,.51],[9.98,.13],[8.5,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:10,width:2,color:[255,255,255,255]},{type:"CIMSolidFill",enable:!0,color:[0,122,194,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:16,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:17,ymax:17},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[8.5,0],[7.02,.13],[5.59,.51],[4.25,1.14],[3.04,1.99],[1.99,3.04],[1.14,4.25],[.51,5.59],[.13,7.02],[0,8.5],[.13,9.98],[.51,11.41],[1.14,12.75],[1.99,13.96],[3.04,15.01],[4.25,15.86],[5.59,16.49],[7.02,16.87],[8.5,17],[9.98,16.87],[11.41,16.49],[12.75,15.86],[13.96,15.01],[15.01,13.96],[15.86,12.75],[16.49,11.41],[16.87,9.98],[17,8.5],[16.87,7.02],[16.49,5.59],[15.86,4.25],[15.01,3.04],[13.96,1.99],[12.75,1.14],[11.41,.51],[9.98,.13],[8.5,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:10,width:0,color:[255,255,255,255]},{type:"CIMSolidFill",enable:!0,color:[0,0,0,66]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,offsetX:0,offsetY:-1},t1e],angleAlignment:"Map"},primitiveOverrides:[{type:"CIMPrimitiveOverride",primitiveName:"headingOverride",propertyName:"Rotation",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Rotation override",expression:"360 - $feature.heading",returnType:"Default"}},{type:"CIMPrimitiveOverride",primitiveName:"headingOverride",propertyName:"TintColor",valueExpressionInfo:{type:"CIMExpressionInfo",title:"TintColor override",expression:"IIF(IsEmpty($feature.heading), [255, 255, 255, 0], [255, 255, 255, 1])",returnType:"Default"}}]}});let Zd=class extends Y_e(ys.EventedMixin(we)){constructor(){super(...arguments),this._geolocationUsable=!0,this.geolocationOptions=null,this.goToLocationEnabled=!0,this.graphic=new om({symbol:Iot}),this.scale=null,this.rotationEnabled=!0,this.view=null}initialize(){Cot()||(this._geolocationUsable=!1)}destroy(){this._clear(),this.view=null}_clear(){const{view:e,graphic:r}=this;e&&r&&e.graphics.remove(r)}_getScaleWithinConstraints(e,r){if(!r)return e;if(r.type==="2d"){const{effectiveMaxScale:i,effectiveMinScale:s}=r.constraints;return Math.min(s,Math.max(i,e))}return e}_getScale(e){const{scale:r}=this,i=typeof r=="number"?r:$ot;return this._getScaleWithinConstraints(i,e)}_getHeading(e,r){var o;const i=r==null?void 0:r.spatialReference,s=(i==null?void 0:i.isWebMercator)||(i==null?void 0:i.isGeographic),n=(o=e.coords)==null?void 0:o.heading;return!s||typeof n!="number"||isNaN(n)||n<0||n>360?null:n}_addHeading(e){const{heading:r,target:i,view:s}=e;s&&r!==null&&(s.type!=="3d"?s.type==="2d"&&(i.rotation=360-r):i.heading=r)}async _animatePoint(e,r,i,s){const{view:n}=this;if(!this.goToLocationEnabled||!n)return;const o={target:e,scale:r};this.rotationEnabled&&this._addHeading({heading:i,target:o,view:n});const a={signal:s.signal};qt(a),await this.callGoTo({target:o,options:a})}async updatePosition(e,r){try{const i=this.view,s=await Aot({position:e,view:i},{signal:r.signal}),{graphic:n}=this,{timestamp:o,coords:a}=e,{accuracy:l,altitude:c,altitudeAccuracy:u,latitude:d,longitude:p,speed:g}=a,y=this._getHeading(e,i);t1e.enable=i.type==="2d";const _={timestamp:o,accuracy:l,altitude:c,altitudeAccuracy:u,heading:y,latitude:d,longitude:p,speed:g};n&&(n.geometry=s,n.attributes=_);const v=this._getScale(i);await this._animatePoint(s,v,y,r)}catch(i){if(!gs(i))throw new X("geolocation-positioning:invalid-point","Cannot position invalid point",{error:i})}return e}};h([f()],Zd.prototype,"_geolocationUsable",void 0),h([f()],Zd.prototype,"geolocationOptions",void 0),h([f()],Zd.prototype,"goToLocationEnabled",void 0),h([f({type:om,nonNullable:!0})],Zd.prototype,"graphic",void 0),h([f()],Zd.prototype,"scale",void 0),h([f()],Zd.prototype,"rotationEnabled",void 0),h([f()],Zd.prototype,"view",void 0),Zd=h([F("esri.widgets.support.GeolocationPositioning")],Zd);const Lot=Zd,Dot=15e3,Not="esri.widgets.Track.TrackViewModel";let bh=class extends Lot{constructor(e){super(e),this._watchId=void 0,this._trackStartingTimeoutId=void 0,this._settingPosition=null,this._trackController=null,this.positionFilterFunction=null}destroy(){this._stopTracking()}get state(){return this._geolocationUsable?this.view&&!this.view.ready?"disabled":this._settingPosition||this._trackStartingTimeoutId!==void 0?"waiting":this.tracking?"tracking":"ready":"feature-unsupported"}get tracking(){return this._watchId!==void 0}start(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._startTracking()}stop(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._stopTracking()}_stopWatchingPosition(){this._watchId!==void 0&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0)}_stopTracking(){this._abortTrack(),this._clearWaitingTimer(),this._stopWatchingPosition(),this._clear()}_startTracking(){this._stopTracking();const e=ik(async r=>{this._abortTrack();const i=new AbortController;this._trackController=i;const{timestamp:s,coords:n}=r,o={timestamp:s,coords:{...n}};try{if(typeof this.positionFilterFunction=="function"&&!this.positionFilterFunction.call(null,{position:o})||(await this.updatePosition(r,i),this._trackController!==i))return;this._clearWaitingTimer();const{view:a,graphic:l}=this;if(a&&a.graphics.remove(l),l){const c=l.clone();this.graphic=c,a&&a.graphics.push(c)}this.emit("track",{position:r}),this._trackController=null}catch(a){if(gs(a))return;throw this._trackController=null,this._emitError(a),this._clearWaitingTimer(),a}},0);this._watchId=navigator.geolocation.watchPosition(r=>{this._settingPosition=e(r).catch(cM)},this._handleWatchPositionError.bind(this),this.geolocationOptions??void 0),this._trackStartingTimeoutId=setTimeout(()=>{this._trackStartingTimeoutId=void 0},Dot)}_handleWatchPositionError(e){e.code===e.PERMISSION_DENIED&&this._stopTracking(),this._emitError(e)}_abortTrack(){var e;(e=this._trackController)==null||e.abort(),this._trackController=null}_clearWaitingTimer(){clearTimeout(this._trackStartingTimeoutId),this._trackStartingTimeoutId=void 0,this._settingPosition=null}_emitError(e){this.emit("track-error",{error:e})}};h([f()],bh.prototype,"_watchId",void 0),h([f()],bh.prototype,"_trackStartingTimeoutId",void 0),h([f()],bh.prototype,"_settingPosition",void 0),h([f()],bh.prototype,"positionFilterFunction",void 0),h([f({readOnly:!0})],bh.prototype,"state",null),h([f({readOnly:!0})],bh.prototype,"tracking",null),h([f()],bh.prototype,"start",null),h([f()],bh.prototype,"stop",null),bh=h([F(Not)],bh);const r1e=bh,Rd={base:"esri-track esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-icon",loading:"esri-icon-loading-indicator",rotating:"esri-rotating",startTrackingIcon:"esri-icon-tracking",stopTrackingIcon:"esri-icon-pause",widgetIcon:"esri-icon-tracking",disabled:"esri-disabled",hidden:"esri-hidden"},i1e="esri.widgets.Track",Xee=ne.getLogger(i1e);let ro=class extends x2{constructor(t,e){super(t,e),this.iconClass=Rd.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new r1e}get geolocationOptions(){return this.viewModel.geolocationOptions}set geolocationOptions(t){this.viewModel.geolocationOptions=t}get goToLocationEnabled(){return this.viewModel.goToLocationEnabled}set goToLocationEnabled(t){this.viewModel.goToLocationEnabled=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get rotationEnabled(){return this.viewModel.rotationEnabled}set rotationEnabled(t){this.viewModel.rotationEnabled=t}get scale(){return this.viewModel.scale}set scale(t){this.viewModel.scale=t}get tracking(){return this.viewModel.tracking}get useHeadingEnabled(){return ap(Xee,"useHeadingEnabled",{replacement:"rotationEnabled",version:"4.27",warnOnce:!0}),this.viewModel.rotationEnabled}set useHeadingEnabled(t){ap(Xee,"useHeadingEnabled",{replacement:"rotationEnabled",version:"4.27",warnOnce:!0}),this.viewModel.rotationEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}start(){this.viewModel.start()}stop(){this.viewModel.stop()}render(){const t=this.get("viewModel.state"),e={[Rd.disabled]:t==="disabled",[Rd.hidden]:t==="feature-unsupported"},r=t==="tracking",i={[Rd.startTrackingIcon]:!r&&t!=="waiting",[Rd.stopTrackingIcon]:r,[Rd.rotating]:t==="waiting",[Rd.loading]:t==="waiting"},{messages:s}=this,n=(r?s==null?void 0:s.stopTracking:s==null?void 0:s.startTracking)??"";return jn("div",{bind:this,class:this.classes(Rd.base,e),hidden:t==="feature-unsupported",onclick:this._toggleTracking,onkeydown:this._toggleTracking,role:"button",tabIndex:0,"aria-label":n,title:n},jn("span",{"aria-hidden":"true",class:this.classes(Rd.icon,i)}),jn("span",{class:Rd.text},n))}_toggleTracking(){const t=this.viewModel;t&&t.state!=="feature-unsupported"&&t.state!=="disabled"&&(t.state!=="tracking"&&t.state!=="waiting"?this.viewModel.start():this.viewModel.stop())}};h([f()],ro.prototype,"geolocationOptions",null),h([f()],ro.prototype,"goToLocationEnabled",null),h([f()],ro.prototype,"goToOverride",null),h([f()],ro.prototype,"graphic",null),h([f()],ro.prototype,"iconClass",void 0),h([f()],ro.prototype,"icon",void 0),h([f()],ro.prototype,"label",null),h([f(),zA("esri/widgets/Track/t9n/Track")],ro.prototype,"messages",void 0),h([f()],ro.prototype,"rotationEnabled",null),h([f()],ro.prototype,"scale",null),h([f({readOnly:!0})],ro.prototype,"tracking",null),h([f()],ro.prototype,"useHeadingEnabled",null),h([f()],ro.prototype,"view",null),h([f({type:r1e}),xot(["track","track-error"])],ro.prototype,"viewModel",void 0),h([UA()],ro.prototype,"_toggleTracking",null),ro=h([F(i1e)],ro);const Fot=ro;Er.assetsPath="./assets2";console.log("Version",YC);let OR=[];const Uot=document.getElementById("geolocationDiv"),zot=new qie({basemap:"topo-vector"}),dj=new wot({container:"viewDiv",map:zot,zoom:4,center:[15,65]}),Hx=new Fot({view:dj,geolocationOptions:{maximumAge:0,timeout:3e4,enableHighAccuracy:!0}});Hx.viewModel.positionFilterFunction=t=>{let e=null;return OR.push(t.position.coords),OR.length>4?e=OR.pop():e=t,console.log("filter",OR),e};dj.ui.add(Hx,"top-left");Hx.on("track",t=>{var i,s,n,o,a,l;const e=t.position.coords.longitude.toFixed(4),r=t.position.coords.latitude.toFixed(4);console.log("Track1",`${e}, ${r}`),console.log("Track:",t),Uot.innerText=`
  Latitude: ${(i=t.position.coords.latitude)==null?void 0:i.toFixed(4)}
  Longitude: ${(s=t.position.coords.longitude)==null?void 0:s.toFixed(4)}
  Altitude: ${(n=t.position.coords.altitude)==null?void 0:n.toFixed(1)}
  Heading: ${(o=t.position.coords.heading)==null?void 0:o.toFixed(0)}
  Speed: ${(a=t.position.coords.speed)==null?void 0:a.toFixed(2)}
  Accuracy: ${(l=t.position.coords.accuracy)==null?void 0:l.toFixed(0)}m
  Position Filter: ${typeof Hx.viewModel.positionFilterFunction=="function"}
  Version: ${YC}`});Hx.on("track-error",t=>{console.error("Geolocation error:",t)});dj.when(()=>{Hx.start()});export{Ut as $,Yn as A,om as B,C,y2t as D,ae as E,Oae as F,X0 as G,Yre as H,Br as I,mZe as J,X as K,Es as L,eV as M,Uh as N,is as O,oA as P,Uut as Q,lut as R,Rie as S,CI as T,jYe as U,er as V,fa as W,tve as X,K1 as Y,FPe as Z,he as _,F as a,vTe as a$,rm as a0,JC as a1,Kx as a2,at as a3,vH as a4,II as a5,L0 as a6,Nxe as a7,hct as a8,zT as a9,Jct as aA,bst as aB,eve as aC,GM as aD,HM as aE,VM as aF,eSe as aG,mm as aH,cM as aI,UE as aJ,ys as aK,Mu as aL,fo as aM,bCe as aN,Aj as aO,FW as aP,zyt as aQ,Dyt as aR,Nyt as aS,Fyt as aT,wB as aU,wCe as aV,Y_e as aW,IB as aX,Nr as aY,Ow as aZ,uRe as a_,aB as aa,dct as ab,dCe as ac,lx as ad,hCe as ae,Gi as af,zA as ag,x2 as ah,Ga as ai,J2t as aj,jn as ak,Iut as al,$ut as am,dPe as an,hPe as ao,me as ap,UB as aq,yCe as ar,ine as as,ht as at,Lyt as au,OI as av,Vte as aw,Kie as ax,em as ay,pCe as az,Rr as b,pe as b$,x2t as b0,ap as b1,Lut as b2,QE as b3,xot as b4,UA as b5,R1 as b6,uk as b7,hze as b8,Us as b9,cMe as bA,Ke as bB,ex as bC,Ur as bD,qr as bE,klt as bF,LYe as bG,DYe as bH,IYe as bI,ha as bJ,cL as bK,lRe as bL,XE as bM,TE as bN,WI as bO,Mi as bP,Yot as bQ,Sc as bR,Rs as bS,S as bT,Le as bU,kx as bV,Ys as bW,mG as bX,pv as bY,Ot as bZ,Xge as b_,aA as ba,LTe as bb,Qlt as bc,QTe as bd,nt as be,yc as bf,Ss as bg,Kot as bh,RF as bi,vo as bj,Zw as bk,fZe as bl,wr as bm,Zx as bn,Js as bo,C0 as bp,ure as bq,g1 as br,ik as bs,KU as bt,rB as bu,Put as bv,iB as bw,Ou as bx,Wr as by,yt as bz,mp as c,br as c$,uwt as c0,Bs as c1,pwt as c2,Pct as c3,WCe as c4,R_ as c5,lwt as c6,y$ as c7,cm as c8,Ar as c9,Ya as cA,$t as cB,Mp as cC,sy as cD,D as cE,uo as cF,qn as cG,Ye as cH,Nt as cI,_r as cJ,le as cK,Te as cL,ee as cM,zo as cN,oi as cO,xne as cP,fwt as cQ,mwt as cR,ywt as cS,SB as cT,lo as cU,aOe as cV,vt as cW,rL as cX,Ict as cY,Ue as cZ,sd as c_,Lct as ca,xmt as cb,ur as cc,rs as cd,Vhe as ce,qi as cf,fL as cg,wi as ch,hG as ci,Qt as cj,mr as ck,mc as cl,se as cm,n6 as cn,U1 as co,NL as cp,b as cq,Ll as cr,Am as cs,xe as ct,Ie as cu,dr as cv,gr as cw,pr as cx,cr as cy,xt as cz,ne as d,ao as d$,hr as d0,p2t as d1,yMe as d2,I1t as d3,YF as d4,JUe as d5,fv as d6,op as d7,S2t as d8,yL as d9,kyt as dA,v_t as dB,sue as dC,dut as dD,BI as dE,ev as dF,JM as dG,Wk as dH,iN as dI,b0 as dJ,EF as dK,nae as dL,HE as dM,_1 as dN,Yt as dO,nte as dP,El as dQ,oe as dR,W0 as dS,YI as dT,EB as dU,_c as dV,go as dW,Xi as dX,JH as dY,hc as dZ,Ene as d_,Mie as da,qde as db,ES as dc,hae as dd,E2t as de,qt as df,te as dg,c$ as dh,ow as di,E2 as dj,Fo as dk,UI as dl,T2t as dm,Sn as dn,li as dp,wn as dq,Ap as dr,Qe as ds,fe as dt,YE as du,tC as dv,e0t as dw,t0t as dx,yUe as dy,agt as dz,h as e,U$ as e$,l0 as e0,gl as e1,FE as e2,Kw as e3,Au as e4,Fu as e5,u3e as e6,De as e7,O4e as e8,m2t as e9,Ype as eA,Xpe as eB,lgt as eC,WC as eD,T3e as eE,hwt as eF,Kwe as eG,rx as eH,Jmt as eI,g1e as eJ,ye as eK,NI as eL,tm as eM,nct as eN,rct as eO,BB as eP,p_e as eQ,sae as eR,ti as eS,kme as eT,zre as eU,__t as eV,mx as eW,wOe as eX,ss as eY,Df as eZ,xdt as e_,QM as ea,Uo as eb,K0e as ec,kr as ed,WO as ee,nde as ef,Dl as eg,HKe as eh,Z3e as ei,Cr as ej,dwt as ek,cut as el,hK as em,Yw as en,mpt as eo,bp as ep,fx as eq,o3e as er,Lu as es,Zi as et,put as eu,Ct as ev,ps as ew,Fge as ex,n2 as ey,Dt as ez,L as f,ho as f$,Fr as f0,Rwt as f1,Fat as f2,ac as f3,rk as f4,fat as f5,hC as f6,Tk as f7,od as f8,hgt as f9,Ec as fA,tn as fB,R0 as fC,Zte as fD,uUe as fE,Tn as fF,EHe as fG,hT as fH,nL as fI,lL as fJ,oL as fK,rA as fL,LCe as fM,egt as fN,$3e as fO,V1 as fP,zqe as fQ,Dze as fR,Ize as fS,Xz as fT,$ct as fU,wgt as fV,bgt as fW,lm as fX,vx as fY,Xgt as fZ,yn as f_,pgt as fa,Sce as fb,gu as fc,FUe as fd,wKe as fe,gwt as ff,m0 as fg,hOe as fh,Hn as fi,CL as fj,cq as fk,_H as fl,WYe as fm,la as fn,y_t as fo,Xot as fp,Nat as fq,$de as fr,Ide as fs,fTe as ft,ov as fu,sA as fv,_t as fw,O0 as fx,Kt as fy,Qs as fz,ce as g,ywe as g$,z1t as g0,oG as g1,dgt as g2,nfe as g3,_o as g4,Tat as g5,Dh as g6,sc as g7,Kmt as g8,gW as g9,LB as gA,Wct as gB,Rh as gC,vc as gD,C1 as gE,ux as gF,rge as gG,$1e as gH,iv as gI,bte as gJ,Ylt as gK,s2 as gL,Jh as gM,Gk as gN,Ht as gO,Wot as gP,Ffe as gQ,oct as gR,Xlt as gS,mA as gT,glt as gU,xht as gV,qA as gW,da as gX,mwe as gY,so as gZ,gwe as g_,qmt as ga,ize as gb,sL as gc,o2 as gd,kqe as ge,kV as gf,fs as gg,sm as gh,Pie as gi,oYe as gj,Cve as gk,bie as gl,vie as gm,bs as gn,mke as go,pke as gp,fke as gq,Qgt as gr,Mo as gs,m1 as gt,XI as gu,S1 as gv,Vct as gw,b_t as gx,jct as gy,Cc as gz,Tr as h,Myt as h$,_we as h0,P0 as h1,QAe as h2,lre as h3,Svt as h4,Xx as h5,kI as h6,Zlt as h7,Tht as h8,m7 as h9,Aht as hA,Eht as hB,Bct as hC,Mat as hD,Pat as hE,GE as hF,Vat as hG,Gf as hH,qre as hI,Vbe as hJ,eht as hK,LN as hL,A1 as hM,CUe as hN,Gct as hO,Hct as hP,w_t as hQ,Ixe as hR,rgt as hS,epe as hT,zV as hU,igt as hV,sgt as hW,Sht as hX,FM as hY,Klt as hZ,$yt as h_,mle as ha,Jlt as hb,ACe as hc,j1t as hd,NYe as he,Er as hf,e1 as hg,po as hh,tB as hi,sat as hj,ai as hk,lbe as hl,pbe as hm,xte as hn,AF as ho,gbe as hp,oUe as hq,aUe as hr,une as hs,sle as ht,Hi as hu,_lt as hv,slt as hw,nlt as hx,nA as hy,Cht as hz,Ai as i,$lt as i$,ugt as i0,Got as i1,Fze as i2,$gt as i3,zMe as i4,Rht as i5,Hvt as i6,UG as i7,sct as i8,lc as i9,v2 as iA,IBe as iB,E7 as iC,OV as iD,Ebe as iE,bu as iF,dze as iG,nKe as iH,Jz as iI,Qz as iJ,X7 as iK,I7 as iL,_wt as iM,Y7 as iN,B0 as iO,_n as iP,vu as iQ,C7e as iR,Wn as iS,qk as iT,eat as iU,lr as iV,uut as iW,fUe as iX,Dlt as iY,Qot as iZ,abt as i_,Xh as ia,bpt as ib,Di as ic,r1 as id,Ci as ie,u6 as ig,UYe as ih,Pl as ii,Ba as ij,Tc as ik,We as il,Se as im,zp as io,Ze as ip,Il as iq,_e as ir,Om as is,IL as it,iy as iu,oD as iv,Y0 as iw,cD as ix,lG as iy,aD as iz,tv as j,cx as j$,Qmt as j0,xl as j1,pat as j2,Tlt as j3,v0 as j4,Ac as j5,R7e as j6,gc as j7,Xl as j8,xr as j9,No as jA,Ggt as jB,sZ as jC,Hgt as jD,zlt as jE,Hie as jF,eB as jG,Ore as jH,nwe as jI,Dgt as jJ,Bpe as jK,Gpe as jL,zpe as jM,UVe as jN,uZ as jO,dke as jP,act as jQ,Vmt as jR,Gie as jS,Y2e as jT,Plt as jU,sxe as jV,hxe as jW,jpe as jX,Mk as jY,ult as jZ,KBe as j_,As as ja,Xa as jb,Cs as jc,bt as jd,vi as je,mi as jf,co as jg,Op as jh,Ri as ji,ry as jj,n$ as jk,ey as jl,sD as jm,wmt as jn,wt as jo,Pt as jp,ft as jq,Lde as jr,Bmt as js,Ngt as jt,bo as ju,Wi as jv,Uyt as jw,aw as jx,XS as jy,mW as jz,gs as k,cst as k$,Kze as k0,Nlt as k1,Yte as k2,MI as k3,OB as k4,ZE as k5,dc as k6,aAe as k7,lAe as k8,qat as k9,zB as kA,qa as kB,ca as kC,foe as kD,ms as kE,zu as kF,Sx as kG,G1 as kH,dL as kI,QGe as kJ,KGe as kK,Zmt as kL,ect as kM,tct as kN,ict as kO,Jde as kP,jr as kQ,$R as kR,_2 as kS,SA as kT,jgt as kU,aut as kV,Kk as kW,Qk as kX,Olt as kY,YD as kZ,nJe as k_,Dct as ka,wk as kb,yk as kc,xH as kd,Kyt as ke,JGe as kf,eje as kg,e_t as kh,Qyt as ki,t_t as kj,ZGe as kk,$c as kl,Cm as km,oY as kn,Ipt as ko,bc as kp,aY as kq,Va as kr,Z0 as ks,$pt as kt,i0t as ku,i4 as kv,Ce as kw,v$ as kx,l3e as ky,Ux as kz,Oe as l,mo as l$,I9 as l0,ls as l1,$9 as l2,D9 as l3,ZM as l4,P3e as l5,wz as l6,Ivt as l7,Vvt as l8,ome as l9,xut as lA,Tut as lB,I1 as lC,JF as lD,Gq as lE,At as lF,cp as lG,ZOe as lH,Rut as lI,M3e as lJ,Wt as lK,Xn as lL,ir as lM,_i as lN,Vs as lO,Pw as lP,Jyt as lQ,Wre as lR,blt as lS,tlt as lT,elt as lU,Zre as lV,sut as lW,out as lX,nut as lY,ip as lZ,cC as l_,DQ as la,$vt as lb,Dvt as lc,Pvt as ld,dP as le,B5 as lf,NP as lg,UP as lh,$p as li,Ha as lj,vlt as lk,Iu as ll,Tpe as lm,lu as ln,IQ as lo,EXe as lp,CXe as lq,vC as lr,Lxe as ls,Eut as lt,N3e as lu,F3e as lv,Fx as lw,M1 as lx,Al as ly,hut as lz,we as m,Tct as m$,en as m0,Rm as m1,bw as m2,Wyt as m3,cz as m4,ilt as m5,qF as m6,Pu as m7,Li as m8,Ch as m9,Aut as mA,Cut as mB,y$e as mC,b$e as mD,rlt as mE,Kat as mF,Qat as mG,W_ as mH,bUe as mI,jI as mJ,rq as mK,xpt as mL,tq as mM,oB as mN,$u as mO,nBe as mP,pa as mQ,LL as mR,id as mS,vn as mT,EYe as mU,o1 as mV,pLe as mW,Vdt as mX,kdt as mY,Bdt as mZ,vut as m_,Tl as ma,y7 as mb,g7 as mc,dne as md,Pr as me,$e as mf,Sut as mg,SOe as mh,au as mi,zoe as mj,Lle as mk,yl as ml,M0 as mm,ZB as mn,jk as mo,Kf as mp,h$e as mq,Is as mr,Mle as ms,fm as mt,vL as mu,lA as mv,Kr as mw,aE as mx,xL as my,pae as mz,Jt as n,wut as n$,x0 as n0,V$ as n1,npe as n2,vpt as n3,x$e as n4,oS as n5,Mw as n6,i6 as n7,ma as n8,Jw as n9,sde as nA,He as nB,Os as nC,Mct as nD,QB as nE,hJ as nF,jJ as nG,aC as nH,qC as nI,mut as nJ,Kg as nK,xc as nL,bD as nM,Wa as nN,Bo as nO,uc as nP,Qhe as nQ,yut as nR,g9e as nS,wc as nT,nOe as nU,ude as nV,Dx as nW,Hk as nX,dU as nY,IV as nZ,wlt as n_,Kz as na,fht as nb,Qw as nc,LGe as nd,aBe as ne,j1 as nf,gp as ng,ot as nh,ek as ni,tgt as nj,tp as nk,Due as nl,av as nm,KB as nn,wct as no,but as np,Llt as nq,Fp as nr,HB as ns,Eoe as nt,td as nu,Px as nv,Mt as nw,Gn as nx,lD as ny,qhe as nz,wH as o,cct as o$,UD as o0,e$ as o1,OBe as o2,v2t as o3,w2t as o4,b2t as o5,ZC as o6,Ilt as o7,eq as o8,Bd as o9,lte as oA,tx as oB,Aw as oC,_re as oD,Gat as oE,HC as oF,Rbe as oG,zI as oH,jC as oI,alt as oJ,swe as oK,Gmt as oL,Gh as oM,get as oN,yet as oO,cet as oP,Lxt as oQ,dI as oR,Vwt as oS,vet as oT,Bgt as oU,kgt as oV,lUe as oW,eke as oX,Hpe as oY,Ugt as oZ,Fgt as o_,iC as oa,t7 as ob,dx as oc,xct as od,H5e as oe,r7 as of,aoe as og,hx as oh,rae as oi,_m as oj,jOe as ok,am as ol,SL as om,mNe as on,gut as oo,Hq as op,wpt as oq,lv as or,r3e as os,rZe as ot,tZe as ou,VE as ov,Zot as ow,vat as ox,NMe as oy,Wat as oz,je as p,KKe as p$,uct as p0,lct as p1,D2e as p2,Ymt as p3,nZ as p4,Hmt as p5,Rl as p6,CTe as p7,qCe as p8,Wgt as p9,Bvt as pA,bl as pB,LQ as pC,Eie as pD,Awe as pE,d0e as pF,SJe as pG,hE as pH,k$e as pI,RIe as pJ,gce as pK,mce as pL,eLe as pM,Lce as pN,ULe as pO,zce as pP,F7 as pQ,jLe as pR,IDe as pS,GDe as pT,b8e as pU,z$ as pV,Eze as pW,efe as pX,zke as pY,X1 as pZ,qJe as p_,Vgt as pa,$Ae as pb,R9 as pc,WS as pd,G4 as pe,j4 as pf,jot as pg,Hot as ph,Igt as pi,wl as pj,nm as pk,QC as pl,ua as pm,uMe as pn,zgt as po,Mr as pp,Vi as pq,k9 as pr,pOe as ps,zh as pt,_ut as pu,bOe as pv,Vot as pw,Wbe as px,bk as py,c1e as pz,Qr as q,UWe as q$,tj as q0,pye as q1,Cet as q2,gye as q3,Oet as q4,vye as q5,Pet as q6,xye as q7,$et as q8,Eye as q9,dG as qA,qZe as qB,WZe as qC,$D as qD,YZe as qE,H$ as qF,lBe as qG,ftt as qH,Mye as qI,ytt as qJ,Lye as qK,vtt as qL,Fye as qM,FD as qN,Mtt as qO,ktt as qP,Jtt as qQ,Ktt as qR,trt as qS,n3 as qT,KCe as qU,jBe as qV,Uye as qW,Ltt as qX,_rt as qY,$Ge as qZ,sje as q_,Let as qa,vce as qb,iLe as qc,mat as qd,lw as qe,H2e as qf,Elt as qg,Rlt as qh,Xk as qi,Oie as qj,Clt as qk,nTe as ql,Z2e as qm,Alt as qn,Flt as qo,Mlt as qp,wqe as qq,QVe as qr,lB as qs,Ip as qt,y1 as qu,F7e as qv,V7e as qw,Npt as qx,a7e as qy,h7e as qz,Re as r,Unt as r$,sqe as r0,QWe as r1,Ph as r2,pne as r3,mre as r4,R3e as r5,aL as r6,wTe as r7,bTe as r8,V2e as r9,Ep as rA,xre as rB,ate as rC,Vh as rD,kat as rE,Bj as rF,Mne as rG,Qxe as rH,RM as rI,GI as rJ,Oht as rK,Bat as rL,Oj as rM,P as rN,Jat as rO,L2t as rP,N2t as rQ,I2t as rR,g_e as rS,Y2t as rT,kst as rU,G2t as rV,Bnt as rW,Lst as rX,B2t as rY,j2t as rZ,knt as r_,uH as ra,olt as rb,Dve as rc,Eke as rd,Zpe as re,Eat as rf,Ult as rg,tat as rh,E1 as ri,Rct as rj,Bx as rk,nk as rl,O1 as rm,lE as rn,M9 as ro,d6 as rp,Du as rq,Tx as rr,LIe as rs,R7 as rt,Y3e as ru,uv as rv,VI as rw,Blt as rx,jat as ry,axe as rz,sB as s,D0e as s$,U2t as s0,z2t as s1,k2t as s2,$2t as s3,H2t as s4,V2t as s5,Z2t as s6,D2t as s7,Wnt as s8,q2t as s9,uke as sA,Aje as sB,wje as sC,xje as sD,Rje as sE,Sje as sF,Eje as sG,ed as sH,Tje as sI,wo as sJ,Oje as sK,dA as sL,kL as sM,cke as sN,Cje as sO,VL as sP,Nu as sQ,ty as sR,Jv as sS,gae as sT,kOe as sU,Po as sV,_Me as sW,oC as sX,Srt as sY,U0e as sZ,eQe as s_,W2t as sa,kot as sb,F2t as sc,X2t as sd,Yat as se,M2t as sf,Uxe as sg,Ik as sh,d1e as si,ylt as sj,pNe as sk,J3e as sl,X3e as sm,zf as sn,Nme as so,h1 as sp,iNe as sq,Hat as sr,zq as ss,qme as st,Xme as su,OE as sv,Jje as sw,lke as sx,qpe as sy,xlt as sz,Oi as t,fQe as t0,m_ as t1,XG as t2,YG as t3,qgt as t4,JJe as t5,SHe as t6,CG as t7,ige as t8,AG as t9,sge as ta,_je as tb,dz as tc,llt as td,jwe as te,ngt as tf,Kgt as tg,g_t as th,t0 as u,ie as v,Ts as w,bi as x,f as y,ei as z};
