import{gO as C,dk as g,gP as E,gQ as F,ap as G}from"./index-bdad94d1.js";const p=2.4;function Q(t){return C(t*p)}function S(t){return g(t)/p}function T(t,o,r,a){let{color:u,ratio:c}=o,{color:f,ratio:n}=r;n===c&&(n===1?c-=1e-6:n+=1e-6);const e=G((a-c)/(n-c),0,1);E(t,u.toArray(),f.toArray(),e)}function U(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:n})=>n>=0&&n<=1).sort((n,e)=>n.ratio-e.ratio).map(({color:n,ratio:e})=>({color:n,ratio:Math.max(e,.001)})),t.length<1)return r;let a=t[0],u=t[0],c=1;const f=F();for(let n=0;n<512;n++){const e=(n+.5)/512;for(;e>u.ratio&&c<t.length;)a=u,u=t[c++];T(f,a,u,e),r.set(f,4*n)}return r}function V(t,o,r,a){const{radius:u,fieldOffset:c,field:f}=o,n=Math.round(g(u)),e=new Float64Array(r*a);let s,m=Number.NEGATIVE_INFINITY;const A=q(f,c),x=new Set;for(const I of t){const l=I.getCursor();for(;l.next();){const M=l.getObjectId();if(x.has(M))continue;x.add(M);const i=l.readLegacyPointGeometry(),d=128;if(i.x<-d||i.x>=r+d||i.y<-d||i.y>a+d)continue;const b=+A(l),N=Math.max(0,Math.round(i.x)-n),w=Math.max(0,Math.round(i.y)-n),O=Math.min(a,Math.round(i.y)+n),P=Math.min(r,Math.round(i.x)+n);for(let h=w;h<O;h++)for(let y=N;y<P;y++){const $=h*r+y,j=k(i.x-y,i.y-h,n);s=e[$]+=j*b,s>m&&(m=s)}}}return{matrix:e.buffer,max:m}}function k(t,o,r){const a=Math.sqrt(t**2+o**2)/r;return a>1?0:3/(Math.PI*r**2)*(1-a**2)**2}function Y(t,o){return typeof t=="function"?t:t?typeof o=="string"?r=>-1*+r[t]:r=>+r[t]+o:()=>1}function q(t,o){return t!=null?typeof o=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+o:r=>1}export{p as a,S as c,Q as i,k as m,V as s,U as u,Y as y};
