import{o as Be}from"./_commonjsHelpers-2f3e7994.js";import{c as R,n as Le}from"./WGLContainer-4b22933a.js";import{be as Nt,m as it,bf as Ue,L as Ot,bg as Qt,bh as Ve,bi as Ne,s as Z,n as B,J as xe,bj as Oe,c as Ge,d as Jt,bk as qe,b6 as mt,u as et,bl as He,t as Kt,bm as je,F as E,bn as H,bo as Ze,bp as Ye,bq as We,x as Xe,ab as M,ac as I,ad as st,an as nt,br as te,b8 as Qe,e as Me,g as Je,bs as Ke,bt as $e,bu as Pt,K as Ct,b4 as Se,bv as St,bw as ti,aK as ei,bx as ii,by as si,bz as ni,b3 as pt,bA as ri,bB as Gt,bC as ai,bD as oi,B as gt,bE as ee}from"./index-e1d30004.js";import{u as hi,a as _t,l as ie,t as se,b as li,c as ui,o as ci,e as di,d as mi,i as pi}from"./ExpandedCIM-0ff0446e.js";import{r as gi,e as _i}from"./rasterizingUtils-9b04fcb2.js";import{e as P,c as Ft,z as ne,y as re,k as fi,U as yi,V as vi}from"./definitions-43101aab.js";import{u as wi,_ as ft,p as bi,l as xi,n as ae,r as Mi,I as $i,f as yt,s as oe,d as he,i as Si,o as zi,m as Ii,T as Ti}from"./color-a87af45a.js";import{t as C}from"./Rect-ea14f53a.js";import{P as zt,G as Zt,L as qt,R as Q,M as Di,D as Pi}from"./enums-10aa9b05.js";import{m as Yt}from"./Texture-a64c7d5d.js";import{o as Ci}from"./floatRGBA-3bf773ec.js";import{e as le}from"./GeometryUtils-dd03fc25.js";import{o as Ri}from"./imageutils-1a10e5f7.js";import{d as O}from"./enums-55085e26.js";import{e as Ai}from"./Matcher-32ed4360.js";import{t as Fi}from"./CircularArray-ef508845.js";import{T as ki}from"./DisjointTimerQuery-b21930a9.js";import{t as Ei}from"./ComputedAttributeStorage-b498a8b2.js";import{a as Bi}from"./ProgramTemplate-99344654.js";var ue,Ht={};ue=function(){return function(a){var t={};function e(i){if(t[i])return t[i].exports;var s=t[i]={exports:{},id:i,loaded:!1};return a[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}return e.m=a,e.c=t,e.p="",e(0)}([function(a,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.isNotPNG=h,t.isNotAPNG=u,t.default=c;var i=n(e(1)),s=e(2);function n(_){return _&&_.__esModule?_:{default:_}}var r=new Error("Not a PNG"),o=new Error("Not an animated PNG");function h(_){return _===r}function u(_){return _===o}var l=new Uint8Array([137,80,78,71,13,10,26,10]);function c(_){var f=new Uint8Array(_);if(Array.prototype.some.call(l,function(A,T){return A!==f[T]}))return r;var w=!1;if(d(f,function(A){return!(w=A==="acTL")}),!w)return o;var b=[],$=[],D=null,x=null,q=0,N=new s.APNG;if(d(f,function(A,T,S,rt){var F=new DataView(T.buffer);switch(A){case"IHDR":D=T.subarray(S+8,S+8+rt),N.width=F.getUint32(S+8),N.height=F.getUint32(S+12);break;case"acTL":N.numPlays=F.getUint32(S+8+4);break;case"fcTL":x&&(N.frames.push(x),q++),(x=new s.Frame).width=F.getUint32(S+8+4),x.height=F.getUint32(S+8+8),x.left=F.getUint32(S+8+12),x.top=F.getUint32(S+8+16);var Ee=F.getUint16(S+8+20),At=F.getUint16(S+8+22);At===0&&(At=100),x.delay=1e3*Ee/At,x.delay<=10&&(x.delay=100),N.playTime+=x.delay,x.disposeOp=F.getUint8(S+8+24),x.blendOp=F.getUint8(S+8+25),x.dataParts=[],q===0&&x.disposeOp===2&&(x.disposeOp=1);break;case"fdAT":x&&x.dataParts.push(T.subarray(S+8+4,S+8+rt));break;case"IDAT":x&&x.dataParts.push(T.subarray(S+8,S+8+rt));break;case"IEND":$.push(g(T,S,12+rt));break;default:b.push(g(T,S,12+rt))}}),x&&N.frames.push(x),N.frames.length==0)return o;var Fe=new Blob(b),ke=new Blob($);return N.frames.forEach(function(A){var T=[];T.push(l),D.set(v(A.width),0),D.set(v(A.height),4),T.push(y("IHDR",D)),T.push(Fe),A.dataParts.forEach(function(S){return T.push(y("IDAT",S))}),T.push(ke),A.imageData=new Blob(T,{type:"image/png"}),delete A.dataParts,T=null}),N}function d(_,f){var w=new DataView(_.buffer),b=8,$=void 0,D=void 0,x=void 0;do D=w.getUint32(b),x=f($=m(_,b+4,4),_,b,D),b+=12+D;while(x!==!1&&$!="IEND"&&b<_.length)}function m(_,f,w){var b=Array.prototype.slice.call(_.subarray(f,f+w));return String.fromCharCode.apply(String,b)}function p(_){for(var f=new Uint8Array(_.length),w=0;w<_.length;w++)f[w]=_.charCodeAt(w);return f}function g(_,f,w){var b=new Uint8Array(w);return b.set(_.subarray(f,f+w)),b}var y=function(_,f){var w=_.length+f.length,b=new Uint8Array(w+8),$=new DataView(b.buffer);$.setUint32(0,f.length),b.set(p(_),4),b.set(f,8);var D=(0,i.default)(b,4,w);return $.setUint32(w+4,D),b},v=function(_){return new Uint8Array([_>>>24&255,_>>>16&255,_>>>8&255,255&_])}},function(a,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,h=-1,u=o,l=o+(arguments.length>2&&arguments[2]!==void 0?arguments[2]:r.length-o);u<l;u++)h=h>>>8^e[255&(h^r[u])];return-1^h};for(var e=new Uint32Array(256),i=0;i<256;i++){for(var s=i,n=0;n<8;n++)s=1&s?3988292384^s>>>1:s>>>1;e[i]=s}},function(a,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.Frame=t.APNG=void 0;var i=function(){function o(h,u){for(var l=0;l<u.length;l++){var c=u[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(h,c.key,c)}}return function(h,u,l){return u&&o(h.prototype,u),l&&o(h,l),h}}(),s=n(e(3));function n(o){return o&&o.__esModule?o:{default:o}}function r(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")}t.APNG=function(){function o(){r(this,o),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[]}return i(o,[{key:"createImages",value:function(){return Promise.all(this.frames.map(function(h){return h.createImage()}))}},{key:"getPlayer",value:function(h){var u=this,l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this.createImages().then(function(){return new s.default(u,h,l)})}}]),o}(),t.Frame=function(){function o(){r(this,o),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.imageData=null,this.imageElement=null}return i(o,[{key:"createImage",value:function(){var h=this;return this.imageElement?Promise.resolve():new Promise(function(u,l){var c=URL.createObjectURL(h.imageData);h.imageElement=document.createElement("img"),h.imageElement.onload=function(){URL.revokeObjectURL(c),u()},h.imageElement.onerror=function(){URL.revokeObjectURL(c),h.imageElement=null,l(new Error("Image creation error"))},h.imageElement.src=c})}}]),o}()},function(a,t,e){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function u(l,c){for(var d=0;d<c.length;d++){var m=c[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(l,m.key,m)}}return function(l,c,d){return c&&u(l.prototype,c),d&&u(l,d),l}}();function s(u){return u&&u.__esModule?u:{default:u}}function n(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}function r(u,l){if(!u)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!l||typeof l!="object"&&typeof l!="function"?u:l}function o(u,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof l);u.prototype=Object.create(l&&l.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),l&&(Object.setPrototypeOf?Object.setPrototypeOf(u,l):u.__proto__=l)}var h=function(u){function l(c,d,m){n(this,l);var p=r(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return p.playbackRate=1,p._currentFrameNumber=0,p._ended=!1,p._paused=!0,p._numPlays=0,p._apng=c,p.context=d,p.stop(),m&&p.play(),p}return o(l,u),i(l,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,this._apng.numPlays!==0&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this._prevFrame&&this._prevFrame.disposeOp==1?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&this._prevFrame.disposeOp==2&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var c=this.currentFrame;this._prevFrame=c,this._prevFrameData=null,c.disposeOp==2&&(this._prevFrameData=this.context.getImageData(c.left,c.top,c.width,c.height)),c.blendOp==0&&this.context.clearRect(c.left,c.top,c.width,c.height),this.context.drawImage(c.imageElement,c.left,c.top),this.emit("frame",this._currentFrameNumber),this._ended&&this.emit("end")}},{key:"play",value:function(){var c=this;this.emit("play"),this._ended&&this.stop(),this._paused=!1;var d=performance.now()+this.currentFrame.delay/this.playbackRate,m=function p(g){if(!c._ended&&!c._paused){if(g>=d){for(;g-d>=c._apng.playTime/c.playbackRate;)d+=c._apng.playTime/c.playbackRate,c._numPlays++;do c.renderNextFrame(),d+=c.currentFrame.delay/c.playbackRate;while(!c._ended&&g>d)}requestAnimationFrame(p)}};requestAnimationFrame(m)}},{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop"),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]),l}(s(e(4)).default);t.default=h},function(a,t){function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(o){return typeof o=="function"}function s(o){return typeof o=="number"}function n(o){return typeof o=="object"&&o!==null}function r(o){return o===void 0}a.exports=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(o){if(!s(o)||o<0||isNaN(o))throw TypeError("n must be a positive number");return this._maxListeners=o,this},e.prototype.emit=function(o){var h,u,l,c,d,m;if(this._events||(this._events={}),o==="error"&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((h=arguments[1])instanceof Error)throw h;var p=new Error('Uncaught, unspecified "error" event. ('+h+")");throw p.context=h,p}if(r(u=this._events[o]))return!1;if(i(u))switch(arguments.length){case 1:u.call(this);break;case 2:u.call(this,arguments[1]);break;case 3:u.call(this,arguments[1],arguments[2]);break;default:c=Array.prototype.slice.call(arguments,1),u.apply(this,c)}else if(n(u))for(c=Array.prototype.slice.call(arguments,1),l=(m=u.slice()).length,d=0;d<l;d++)m[d].apply(this,c);return!0},e.prototype.addListener=function(o,h){var u;if(!i(h))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",o,i(h.listener)?h.listener:h),this._events[o]?n(this._events[o])?this._events[o].push(h):this._events[o]=[this._events[o],h]:this._events[o]=h,n(this._events[o])&&!this._events[o].warned&&(u=r(this._maxListeners)?e.defaultMaxListeners:this._maxListeners)&&u>0&&this._events[o].length>u&&(this._events[o].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[o].length),typeof console.trace=="function"&&console.trace()),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(o,h){if(!i(h))throw TypeError("listener must be a function");var u=!1;function l(){this.removeListener(o,l),u||(u=!0,h.apply(this,arguments))}return l.listener=h,this.on(o,l),this},e.prototype.removeListener=function(o,h){var u,l,c,d;if(!i(h))throw TypeError("listener must be a function");if(!this._events||!this._events[o])return this;if(c=(u=this._events[o]).length,l=-1,u===h||i(u.listener)&&u.listener===h)delete this._events[o],this._events.removeListener&&this.emit("removeListener",o,h);else if(n(u)){for(d=c;d-- >0;)if(u[d]===h||u[d].listener&&u[d].listener===h){l=d;break}if(l<0)return this;u.length===1?(u.length=0,delete this._events[o]):u.splice(l,1),this._events.removeListener&&this.emit("removeListener",o,h)}return this},e.prototype.removeAllListeners=function(o){var h,u;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[o]&&delete this._events[o],this;if(arguments.length===0){for(h in this._events)h!=="removeListener"&&this.removeAllListeners(h);return this.removeAllListeners("removeListener"),this._events={},this}if(i(u=this._events[o]))this.removeListener(o,u);else if(u)for(;u.length;)this.removeListener(o,u[u.length-1]);return delete this._events[o],this},e.prototype.listeners=function(o){return this._events&&this._events[o]?i(this._events[o])?[this._events[o]]:this._events[o].slice():[]},e.prototype.listenerCount=function(o){if(this._events){var h=this._events[o];if(i(h))return 1;if(h)return h.length}return 0},e.listenerCount=function(o,h){return o.listenerCount(h)}}])},{get exports(){return Ht},set exports(a){Ht=a}}.exports=ue();const $n=Be(Ht);var X={},ze={},G={};Object.defineProperty(G,"__esModule",{value:!0}),G.loop=G.conditional=G.parse=void 0;var Li=function a(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:i;if(Array.isArray(e))e.forEach(function(r){return a(t,r,i,s)});else if(typeof e=="function")e(t,i,s,a);else{var n=Object.keys(e)[0];Array.isArray(e[n])?(s[n]={},a(t,e[n],i,s[n])):s[n]=e[n](t,i,s,a)}return i};G.parse=Li;var Ui=function(a,t){return function(e,i,s,n){t(e,i,s)&&n(e,a,i,s)}};G.conditional=Ui;var Vi=function(a,t){return function(e,i,s,n){for(var r=[],o=e.pos;t(e,i,s);){var h={};if(n(e,a,i,h),e.pos===o)break;o=e.pos,r.push(h)}return r}};G.loop=Vi;var z={};Object.defineProperty(z,"__esModule",{value:!0}),z.readBits=z.readArray=z.readUnsigned=z.readString=z.peekBytes=z.readBytes=z.peekByte=z.readByte=z.buildStream=void 0;var Ni=function(a){return{data:a,pos:0}};z.buildStream=Ni;var Ie=function(){return function(a){return a.data[a.pos++]}};z.readByte=Ie;var Oi=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(t){return t.data[t.pos+a]}};z.peekByte=Oi;var Rt=function(a){return function(t){return t.data.subarray(t.pos,t.pos+=a)}};z.readBytes=Rt;var Gi=function(a){return function(t){return t.data.subarray(t.pos,t.pos+a)}};z.peekBytes=Gi;var qi=function(a){return function(t){return Array.from(Rt(a)(t)).map(function(e){return String.fromCharCode(e)}).join("")}};z.readString=qi;var Hi=function(a){return function(t){var e=Rt(2)(t);return a?(e[1]<<8)+e[0]:(e[0]<<8)+e[1]}};z.readUnsigned=Hi;var ji=function(a,t){return function(e,i,s){for(var n=typeof t=="function"?t(e,i,s):t,r=Rt(a),o=new Array(n),h=0;h<n;h++)o[h]=r(e);return o}};z.readArray=ji;var Zi=function(a,t,e){for(var i=0,s=0;s<e;s++)i+=a[t+s]&&Math.pow(2,e-s-1);return i},Yi=function(a){return function(t){for(var e=Ie()(t),i=new Array(8),s=0;s<8;s++)i[7-s]=!!(e&1<<s);return Object.keys(a).reduce(function(n,r){var o=a[r];return o.length?n[r]=Zi(i,o.index,o.length):n[r]=i[o.index],n},{})}};z.readBits=Yi,function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var t=G,e=z,i={blocks:function(l){for(var c=0,d=[],m=l.data.length,p=0,g=(0,e.readByte)()(l);g!==c&&g;g=(0,e.readByte)()(l)){if(l.pos+g>=m){var y=m-l.pos;d.push((0,e.readBytes)(y)(l)),p+=y;break}d.push((0,e.readBytes)(g)(l)),p+=g}for(var v=new Uint8Array(p),_=0,f=0;f<d.length;f++)v.set(d[f],_),_+=d[f].length;return v}},s=(0,t.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(l){var c=(0,e.peekBytes)(2)(l);return c[0]===33&&c[1]===249}),n=(0,t.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,t.conditional)({lct:(0,e.readArray)(3,function(l,c,d){return Math.pow(2,d.descriptor.lct.size+1)})},function(l,c,d){return d.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},i]}]},function(l){return(0,e.peekByte)()(l)===44}),r=(0,t.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(l,c,d){return(0,e.readBytes)(d.text.blockSize)(l)}},i]},function(l){var c=(0,e.peekBytes)(2)(l);return c[0]===33&&c[1]===1}),o=(0,t.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(l,c,d){return(0,e.readString)(d.blockSize)(l)}},i]},function(l){var c=(0,e.peekBytes)(2)(l);return c[0]===33&&c[1]===255}),h=(0,t.conditional)({comment:[{codes:(0,e.readBytes)(2)},i]},function(l){var c=(0,e.peekBytes)(2)(l);return c[0]===33&&c[1]===254}),u=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,t.conditional)({gct:(0,e.readArray)(3,function(l,c){return Math.pow(2,c.lsd.gct.size+1)})},function(l,c){return c.lsd.gct.exists}),{frames:(0,t.loop)([s,o,h,n,r],function(l){var c=(0,e.peekByte)()(l);return c===33||c===44})}];a.default=u}(ze);var It={};Object.defineProperty(It,"__esModule",{value:!0}),It.deinterlace=void 0;var Wi=function(a,t){for(var e=new Array(a.length),i=a.length/t,s=function(l,c){var d=a.slice(c*t,(c+1)*t);e.splice.apply(e,[l*t,t].concat(d))},n=[0,4,2,1],r=[8,8,4,2],o=0,h=0;h<4;h++)for(var u=n[h];u<i;u+=r[h])s(u,o),o++;return e};It.deinterlace=Wi;var Tt={};Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.lzw=void 0;var Xi=function(a,t,e){var i,s,n,r,o,h,u,l,c,d,m,p,g,y,v,_,f=4096,w=-1,b=e,$=new Array(e),D=new Array(f),x=new Array(f),q=new Array(f+1);for(o=(s=1<<(d=a))+1,i=s+2,u=w,n=(1<<(r=d+1))-1,l=0;l<s;l++)D[l]=0,x[l]=l;for(m=p=g=y=v=_=0,c=0;c<b;){if(y===0){if(p<r){m+=t[_]<<p,p+=8,_++;continue}if(l=m&n,m>>=r,p-=r,l>i||l==o)break;if(l==s){n=(1<<(r=d+1))-1,i=s+2,u=w;continue}if(u==w){q[y++]=x[l],u=l,g=l;continue}for(h=l,l==i&&(q[y++]=g,l=u);l>s;)q[y++]=x[l],l=D[l];g=255&x[l],q[y++]=g,i<f&&(D[i]=u,x[i]=g,!(++i&n)&&i<f&&(r++,n+=i)),u=h}y--,$[v++]=q[y],c++}for(c=v;c<b;c++)$[c]=0;return $};Tt.lzw=Xi,Object.defineProperty(X,"__esModule",{value:!0});var Qi=X.decompressFrames=X.decompressFrame=rs=X.parseGIF=void 0,Ji=ss(ze),Ki=G,ts=z,es=It,is=Tt;function ss(a){return a&&a.__esModule?a:{default:a}}var ns=function(a){var t=new Uint8Array(a);return(0,Ki.parse)((0,ts.buildStream)(t),Ji.default)},rs=X.parseGIF=ns,as=function(a){for(var t=a.pixels.length,e=new Uint8ClampedArray(4*t),i=0;i<t;i++){var s=4*i,n=a.pixels[i],r=a.colorTable[n]||[0,0,0];e[s]=r[0],e[s+1]=r[1],e[s+2]=r[2],e[s+3]=n!==a.transparentIndex?255:0}return e},Te=function(a,t,e){if(a.image){var i=a.image,s=i.descriptor.width*i.descriptor.height,n=(0,is.lzw)(i.data.minCodeSize,i.data.blocks,s);i.descriptor.lct.interlaced&&(n=(0,es.deinterlace)(n,i.descriptor.width));var r={pixels:n,dims:{top:a.image.descriptor.top,left:a.image.descriptor.left,width:a.image.descriptor.width,height:a.image.descriptor.height}};return i.descriptor.lct&&i.descriptor.lct.exists?r.colorTable=i.lct:r.colorTable=t,a.gce&&(r.delay=10*(a.gce.delay||10),r.disposalType=a.gce.extras.disposal,a.gce.extras.transparentColorGiven&&(r.transparentIndex=a.gce.transparentColorIndex)),e&&(r.patch=as(r)),r}console.warn("gif frame does not have associated image.")};X.decompressFrame=Te;var os=function(a,t){return a.frames.filter(function(e){return e.image}).map(function(e){return Te(e,a.gct,t)})};Qi=X.decompressFrames=os;const hs=512;let ls=class{constructor(t){this._resourceManager=t,this._rasterizationCanvas=null}dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(t,e,i){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),t.type==="simple-fill"||t.type==="esriSFS"){const[m,p,g]=gi(this._rasterizationCanvas,t.style,e);return{size:[p,g],image:new Uint32Array(m.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:Nt(Math.ceil(e))}}if(t.type==="simple-line"||t.type==="esriSLS"||t.type==="line"&&t.dashTemplate){let m,p;if(t.type==="simple-line"||t.type==="esriSLS")switch(m=hi(t.style,t.cap),t.cap){case"butt":p="Butt";break;case"square":p="Square";break;default:p="Round"}else m=t.dashTemplate,p=t.cim.capStyle;const[g,y,v]=_i(m,p);return{size:[y,v],image:new Uint32Array(g.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let s,n=null,r=null,o=1;if(t.type==="simple-marker"||t.type==="esriSMS"||t.type==="line-marker"?(s=_t.fromSimpleMarker(t),r=ie(s)):t.cim&&t.cim.type==="CIMHatchFill"?(s=_t.fromCIMHatchFill(t.cim,e),n=new se(s.frame.xmin,-s.frame.ymax,s.frame.xmax-s.frame.xmin,s.frame.ymax-s.frame.ymin),o=e):t.cim.markerPlacement&&t.cim.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"?(s=_t.fromCIMInsidePolygon(t.cim),n=new se(s.frame.xmin,-s.frame.ymax,s.frame.xmax-s.frame.xmin,s.frame.ymax-s.frame.ymin)):(s=t.cim,t.avoidSDFRasterization||(r=ie(s))),r&&!i){const[m,p,g]=ui(r);return m?{size:[p,g],image:new Uint32Array(m.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:o}:null}const[h,u,l,c,d]=_t.rasterize(this._rasterizationCanvas,s,n,this._resourceManager,!i);return h?{size:[u,l],image:new Uint32Array(h.buffer),sdf:!1,simplePattern:!1,anchorX:c,anchorY:d}:null}rasterizeImageResource(t,e,i,s){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=t,this._rasterizationCanvas.height=e;const n=this._rasterizationCanvas.getContext("2d");i instanceof ImageData?n.putImageData(i,0,0):(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`),n.drawImage(i,0,0,t,e));const r=n.getImageData(0,0,t,e),o=new Uint8Array(r.data);if(s){for(const m of s)if(m&&m.oldColor&&m.oldColor.length===4&&m.newColor&&m.newColor.length===4){const[p,g,y,v]=m.oldColor,[_,f,w,b]=m.newColor;if(p===_&&g===f&&y===w&&v===b)continue;for(let $=0;$<o.length;$+=4)p===o[$]&&g===o[$+1]&&y===o[$+2]&&v===o[$+3]&&(o[$]=_,o[$+1]=f,o[$+2]=w,o[$+3]=b)}}let h;for(let m=0;m<o.length;m+=4)h=o[m+3]/255,o[m]=o[m]*h,o[m+1]=o[m+1]*h,o[m+2]=o[m+2]*h;let u=o,l=t,c=e;const d=hs;if(l>=d||c>=d){const m=l/c;m>1?(l=d,c=Math.round(d/m)):(c=d,l=Math.round(d*m)),u=new Uint8Array(4*l*c);const p=new Uint8ClampedArray(u.buffer);li(o,t,e,p,l,c,!1)}return{size:[l,c],image:new Uint32Array(u.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}};const zn={shaders:{vertexShader:R("bitBlit/bitBlit.vert"),fragmentShader:R("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};let Dt=class{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new C(0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new C;let i=null,s=-1;for(let n=0;n<this._free.length;++n){const r=this._free[n];t<=r.width&&e<=r.height&&(i===null||r.y<=i.y&&r.x<=i.x)&&(i=r,s=n)}return i===null?new C:(this._free.splice(s,1),i.width<i.height?(i.width>t&&this._free.push(new C(i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new C(i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new C(i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new C(i.x,i.y+e,t,i.height-e))),new C(i.x,i.y,t,e))}release(t){for(let e=0;e<this._free.length;++e){const i=this._free[e];if(i.y===t.y&&i.height===t.height&&i.x+i.width===t.x)i.width+=t.width;else if(i.x===t.x&&i.width===t.width&&i.y+i.height===t.y)i.height+=t.height;else if(t.y===i.y&&t.height===i.height&&t.x+t.width===i.x)i.x=t.x,i.width+=t.width;else{if(t.x!==i.x||t.width!==i.width||t.y+t.height!==i.y)continue;i.y=t.y,i.height+=t.height}this._free.splice(e,1),this.release(t)}this._free.push(t)}};const us=256,cs=a=>Math.floor(a/256);function ds(a){const t=new Set;for(const e of a)t.add(cs(e));return t}function ms(a,t,e){return a.has(t)||a.set(t,e().then(()=>{a.delete(t)}).catch(i=>{a.delete(t),Ue(i)})),a.get(t)}const ps=a=>({rect:new C(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:a,sdf:!0});let gs=class{constructor(t,e,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this._preloadCache={},this.width=t,this.height=e,this._glyphSource=i,this._binPack=new Dt(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyph(){const t=[117,149,181,207,207,181,149,117],e=[];for(let s=0;s<t.length;s++){const n=t[s];for(let r=0;r<11;r++)e.push(n)}const i={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)};this._recordGlyph(i)}async getGlyphItems(t,e,i){const s=this._getGlyphCache(t);return await this._fetchRanges(t,e,i),e.map(n=>this._getMosaicItem(s,t,n))}bind(t,e,i,s){const n=this._getTexture(t,i);n.setSamplingMode(e),this._dirties[i]&&(n.setData(this._glyphData[i]),this._dirties[i]=!1),t.bindTexture(n,s)}preloadASCIIGlyphCache(t){const e=this._preloadCache[t];if(e!=null)return e;const i=this._glyphSource.preloadASCIIRange(t).then(()=>{const s=this._getGlyphCache(t);for(let n=0;n<256;n++)this._getMosaicItem(s,t,n)});return this._preloadCache[t]=i,i}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_getTexture(t,e){return this._textures[e]||(this._textures[e]=new Yt(t,{pixelFormat:zt.ALPHA,dataType:Zt.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[e]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(t,e,i){const s=ds(e),n=[];s.forEach(r=>{n.push(this._fetchRange(t,r,i))}),await Promise.all(n)}async _fetchRange(t,e,i){if(e>us)return;const s=t+e;return ms(this._rangePromises,s,()=>this._glyphSource.getRange(t,e,i))}_getMosaicItem(t,e,i){if(!t[i]){const s=this._glyphSource.getGlyph(e,i);if(!s||!s.metrics)return ps(i);const n=this._recordGlyph(s),r=this._currentPage,o=s.metrics;t[i]={rect:n,page:r,metrics:o,code:i,sdf:!0},this._invalidate()}return t[i]}_recordGlyph(t){const e=t.metrics;let i;if(e.width===0)i=new C(0,0,0,0);else{const n=e.width+6,r=e.height+2*3;i=this._binPack.allocate(n,r),i.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new Dt(this.width-4,this.height-4),i=this._binPack.allocate(n,r));const o=this._glyphData[this._currentPage],h=t.bitmap;let u,l;if(h)for(let c=0;c<r;c++){u=n*c,l=this.width*(i.y+c)+i.x;for(let d=0;d<n;d++)o[l+d]=h[u+d]}it("esri-glyph-debug")&&this._showDebugPage(o)}return i}_showDebugPage(t){const e=document.createElement("canvas"),i=e.getContext("2d"),s=new ImageData(this.width,this.height),n=s.data;e.width=this.width,e.height=this.height,e.style.border="1px solid black";for(let r=0;r<t.length;++r)n[4*r]=t[r],n[4*r+1]=0,n[4*r+2]=0,n[4*r+3]=255;i.putImageData(s,0,0),document.body.appendChild(e)}},ce=class{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const i=e.getMessage();let s,n,r,o,h,u,l;for(;i.next();)switch(i.tag()){case 1:s=i.getUInt32();break;case 2:n=i.getBytes();break;case 3:r=i.getUInt32();break;case 4:o=i.getUInt32();break;case 5:h=i.getSInt32();break;case 6:u=i.getSInt32();break;case 7:l=i.getUInt32();break;default:i.skip()}i.release(),s&&(this._metrics[s]={width:r,height:o,left:h,top:u,advance:l},this._bitmaps[s]=n);break}default:e.skip()}e.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}},_s=class{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}},fs=class{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,e,i){const s=this._getFontStack(t);if(s.getRange(e))return Promise.resolve();const n=256*e,r=n+255,o=this._baseURL.replace("{fontstack}",t).replace("{range}",n+"-"+r);return Ot(o,{responseType:"array-buffer",...i}).then(h=>{s.addRange(e,new ce(new Qt(new Uint8Array(h.data),new DataView(h.data))))})}async preloadASCIIRange(t){const e=this._getFontStack(t),i=0,s=255,n=this._baseURL.replace("{fontstack}",t).replace("{range}",i+"-"+s),r=await Ot(n,{responseType:"array-buffer"}),o=new ce(new Qt(new Uint8Array(r.data),new DataView(r.data)));for(let h=i;h<=s;h++)e.getRange(h)||e.addRange(h,o)}getGlyph(t,e){const i=this._getFontStack(t);if(!i)return;const s=Math.floor(e/256);if(s>256)return;const n=i.getRange(s);return n?{metrics:n.getMetrics(e),bitmap:n.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new _s),e}};const at=1e20;let ys=class{constructor(t){this._svg=null,this.size=t;const e=document.createElement("canvas");e.width=e.height=t,this._context=e.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(t,e,i=31){this._initSVG();const s=this.createSVGString(t);return new Promise((n,r)=>{const o=new Image;o.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(s),o.onload=()=>{o.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(o,0,0,this.size,this.size);const u=this._context.getImageData(0,0,this.size,this.size),l=new Uint8Array(this.size*this.size*4);for(let c=0;c<this.size*this.size;c++){const d=u.data[4*c+3]/255;this._gridOuter[c]=d===1?0:d===0?at:Math.max(0,.5-d)**2,this._gridInner[c]=d===1?at:d===0?0:Math.max(0,d-.5)**2}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let c=0;c<this.size*this.size;c++){const d=this._gridOuter[c]-this._gridInner[c];Ci(.5-d/(2*i),l,4*c)}n(l)};const h=e&&e.signal;h&&Ve(h,()=>r(Ne()))})}_initSVG(){if(!this._svg){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t}return this._svg}createSVGString(t){const e=this._initSVG(),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",t),e.appendChild(i);const s=i.getBBox(),n=s.width/s.height,r=this.size/2;let o,h,u,l;if(n>1){h=o=r/s.width;const p=r*(1/n);u=this.size/4,l=r-p/2}else o=h=r/s.height,u=r-r*n/2,l=this.size/4;const c=-s.x*o+u,d=-s.y*h+l;i.setAttribute("style",`transform: matrix(${o}, 0, 0, ${h}, ${c}, ${d})`);const m=`<svg style="fill:red;" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${e.innerHTML}</svg>`;return e.removeChild(i),m}_edt(t,e,i){const s=this._f,n=this._d,r=this._v,o=this._z;for(let h=0;h<e;h++){for(let u=0;u<i;u++)s[u]=t[u*e+h];this._edt1d(s,n,r,o,i);for(let u=0;u<i;u++)t[u*e+h]=n[u]}for(let h=0;h<i;h++){for(let u=0;u<e;u++)s[u]=t[h*e+u];this._edt1d(s,n,r,o,e);for(let u=0;u<e;u++)t[h*e+u]=Math.sqrt(n[u])}}_edt1d(t,e,i,s,n){i[0]=0,s[0]=-at,s[1]=+at;for(let r=1,o=0;r<n;r++){let h=(t[r]+r*r-(t[i[o]]+i[o]*i[o]))/(2*r-2*i[o]);for(;h<=s[o];)o--,h=(t[r]+r*r-(t[i[o]]+i[o]*i[o]))/(2*r-2*i[o]);o++,i[o]=r,s[o]=h,s[o+1]=+at}for(let r=0,o=0;r<n;r++){for(;s[o+1]<r;)o++;e[r]=(r-i[o])*(r-i[o])+t[i[o]]}}};function Y(a){return a&&a.type==="static"}let vs=class De{constructor(t,e,i=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(t<=0||e<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=e,i>0&&(this._maxItemSize=i),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new Dt(this._pageWidth,this._pageHeight);const s=Math.floor(this._pageWidth),n=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(s*n)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,e,i,s,n,r,o=1){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let h,u,l;if(Y(i))[h,u,l]=this._allocateImage(e[0],e[1]);else{h=new C(0,0,e[0],e[1]),u=this._mosaicPages.length;const d=void 0;this._mosaicPages.push({mosaicsData:i,size:[e[0]+2*P,e[1]+2*P],dirty:!0,texture:d})}if(h.width<=0||h.height<=0)return null;const c={rect:h,width:e[0],height:e[1],sdf:n,simplePattern:r,pixelRatio:o,page:u};return this._mosaicRects.set(t,c),Y(i)&&(it("esri-mosaic-debug")&&this._showDebugSprite(e,i.data),this._copy({rect:h,spriteSize:e,spriteData:i.data,page:u,pageSize:l,repeat:s,sdf:n})),c}hasItemsToProcess(){return this._spriteCopyQueue.length!==0}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getSpriteItems(t){const e={};for(const i of t)e[i]=this.getSpriteItem(i);return e}getMosaicItemPosition(t){const e=this.getSpriteItem(t),i=e&&e.rect;if(!i)return null;i.width=e.width,i.height=e.height;const s=e.width,n=e.height,r=P,o=this._mosaicPages[e.page].size;return{size:[e.width,e.height],tl:[(i.x+r)/o[0],(i.y+r)/o[1]],br:[(i.x+r+s)/o[0],(i.y+r+n)/o[1]],page:e.page}}bind(t,e,i=0,s=0){const n=this._mosaicPages[i],r=n.mosaicsData;let o=n.texture;o||(o=bs(t,n.size),n.texture=o),o.setSamplingMode(e),Y(r)?(t.bindTexture(o,s),n.dirty&&(o.setData(new Uint8Array(r.data.buffer)),o.generateMipmap(),it("esri-mosaic-debug")&&this._showDebugPage(i))):(r.data.bindFrame(t,o,s),o.generateMipmap()),n.dirty=!1}dispose(){this._binPack=null;for(const t of this._mosaicPages){const e=t.texture;e&&e.dispose();const i=t.mosaicsData;Y(i)||i.data.destroy()}this._mosaicPages=null,this._mosaicRects.clear()}static _copyBits(t,e,i,s,n,r,o,h,u,l,c){let d=s*e+i,m=h*r+o;if(c){m-=r;for(let p=-1;p<=l;p++,d=((p+l)%l+s)*e+i,m+=r)for(let g=-1;g<=u;g++)n[m+g]=t[d+(g+u)%u]}else for(let p=0;p<l;p++){for(let g=0;g<u;g++)n[m+g]=t[d+g];d+=e,m+=r}}_copy(t){if(t.page>=this._mosaicPages.length)return;const e=this._mosaicPages[t.page],i=e.mosaicsData;if(!Y(e.mosaicsData))throw new Z("mapview-invalid-resource","unsuitable data type!");const s=t.spriteData,n=i.data;n&&s||console.error("Source or target images are uninitialized!"),De._copyBits(s,t.spriteSize[0],0,0,n,t.pageSize[0],t.rect.x+P,t.rect.y+P,t.spriteSize[0],t.spriteSize[1],t.repeat),e.dirty=!0}_allocateImage(t,e){t+=2*P,e+=2*P;const i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){const n=2**Math.ceil(le(t)),r=2**Math.ceil(le(e)),o=new C(0,0,t,e);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(n*r)},size:[n,r],dirty:!0,texture:void 0}),[o,this._mosaicPages.length-1,[n,r]]}const s=this._binPack.allocate(t,e);if(s.width<=0){const n=this._mosaicPages[this._currentPage];return!n.dirty&&Y(n.mosaicsData)&&(n.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new Dt(this._pageWidth,this._pageHeight),this._allocateImage(t,e)}return[s,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([t,e],i){const s=document.createElement("canvas");s.width=t,s.height=e,s.setAttribute("style",`position: absolute; top: ${4+204*ws++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const n=s.getContext("2d"),r=new ImageData(t,e);r.data.set(new Uint8Array(i.buffer)),n.putImageData(r,0,0),document.body.appendChild(s)}_showDebugPage(t){const e=this._mosaicPages[t],{size:[i,s],mosaicsData:n}=e;if(!Y(n))return void console.error("Could not show sprite mosaic debug for non-static resource");const r=`mosaicDebugPage${t}`,o=document.getElementById(r)??document.createElement("canvas");o.id=r,o.width=i,o.height=s,o.setAttribute("style",`position: absolute; top: ${4+204*t}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);const h=o.getContext("2d"),u=new ImageData(i,s);u.data.set(new Uint8Array(n.data.buffer)),h.putImageData(u,0,0),document.body.appendChild(o)}},ws=0;function bs(a,t){return new Yt(a,{pixelFormat:zt.RGBA,dataType:Zt.UNSIGNED_BYTE,width:t[0],height:t[1]},null)}function Pe(a){return B(a.frameDurations.reduce((t,e)=>t+e,0))}function xs(a){const{width:t,height:e}=a;return{frameDurations:a.frameDurations.reverse(),getFrame:i=>{const s=a.frameDurations.length-1-i;return a.getFrame(s)},width:t,height:e}}function Ms(a,t){const{width:e,height:i,getFrame:s}=a,n=t/Pe(a);return{frameDurations:a.frameDurations.map(r=>B(r*n)),getFrame:s,width:e,height:i}}function $s(a,t){const{width:e,height:i,getFrame:s}=a,n=a.frameDurations.slice(),r=n.shift();return n.unshift(B(r+t)),{frameDurations:n,getFrame:s,width:e,height:i}}function de(a,t){const{width:e,height:i,getFrame:s}=a,n=a.frameDurations.slice(),r=n.pop();return n.push(B(r+t)),{frameDurations:n,getFrame:s,width:e,height:i}}let Ss=class{constructor(t,e,i,s){this._animation=t,this._repeatType=i,this._onFrameData=s,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let n=0;for(;e>n;)n+=this.timeToFrame,this.nextFrame();const r=this._animation.getFrame(this._currentFrame);this._onFrameData(r)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case O.None:this._currentFrame-=this._direction;break;case O.Loop:this._currentFrame=0;break;case O.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(this._currentFrame===-1)switch(this._repeatType){case O.None:this._currentFrame-=this._direction;break;case O.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case O.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}};function zs(a,t,e,i){let s,{repeatType:n}=t;if(n==null&&(n=O.Loop),t.reverseAnimation===!0&&(a=xs(a)),t.duration!=null&&(a=Ms(a,B(1e3*t.duration))),t.repeatDelay!=null){const r=1e3*t.repeatDelay;n===O.Loop?a=de(a,B(r)):n===O.Oscillate&&(a=$s(de(a,B(r/2)),B(r/2)))}if(t.startTimeOffset!=null)s=B(1e3*t.startTimeOffset);else if(t.randomizeStartTime!=null){const r=ci(e),o=82749913,h=t.randomizeStartSeed!=null?t.randomizeStartSeed:o,u=di(r,h);s=B(u*Pe(a))}else s=B(0);return new Ss(a,s,n,i)}function Is(a,t,e,i){const s=t.playAnimation==null||t.playAnimation,n=zs(a,t,e,i);let r,o=n.timeToFrame;function h(){r=s?setTimeout(()=>{n.nextFrame(),o=n.timeToFrame,h()},o):void 0}return h(),{remove:()=>{s&&clearTimeout(r)}}}const jt=document.createElement("canvas"),vt=jt.getContext("2d");function Ts(a,t,e){jt.width=t,jt.height=e;const i=[],s=a.frameDurations.length;for(let n=0;n<s;n++){const r=a.getFrame(n);vt.clearRect(0,0,t,e),r instanceof ImageData?vt.drawImage(Ri(r),0,0,t,e):vt.drawImage(r,0,0,t,e),i.push(vt.getImageData(0,0,t,e))}return{width:t,height:e,frameDurations:a.frameDurations,getFrame:n=>i[n]}}let Ds=class{constructor(t,e,i,s){this._animation=t,this._frameData=null;const n=r=>{this._frameData=r,e.requestRender()};this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=Is(this._animation,i,s,n)}destroy(){this._playHandle.remove()}bindFrame(t,e,i){t.bindTexture(e,i),this._frameData!=null&&(e.updateData(0,P,P,this._frameData.width,this._frameData.height,this._frameData),this._frameData=null)}};function Ps(a){switch(a.type){case"esriSMS":return`${a.style}.${a.path}`;case"esriSLS":return`${a.style}.${a.cap}`;case"esriSFS":return`${a.style}`;case"esriPFS":case"esriPMS":return a.imageData?`${a.imageData}${a.width}${a.height}`:`${a.url}${a.width}${a.height}`;default:return"mosaicHash"in a?a.mosaicHash:JSON.stringify(a)}}const me=He(),pe="arial-unicode-ms-regular",Ce=xe.getLogger("esri.views.2d.engine.webgl.TextureManager");function ge(a,t){const e=Math.round(et(t)*window.devicePixelRatio),i=e>=128?2:4;return Math.min(a,e*i)}const kt=(a,t,e)=>Ce.error(new Z(a,t,e));class Wt{static fromMosaic(t,e){return new Wt(t,e.page,e.sdf)}constructor(t,e,i){this.mosaicType=t,this.page=e,this.sdf=i}}class kn{constructor(t,e,i){this._requestRender=t,this.resourceManager=e,this._allowNonPowerOfTwo=i,this._invalidFontsMap=new Map,this._sdfConverter=new ys(Ft),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new Oe({concurrency:10,process:async(s,n)=>{Ge(n);try{return await Ot(s,{responseType:"image",signal:n})}catch(r){throw Jt(r)?r:new Z("mapview-invalid-resource",`Could not fetch requested resource at ${s}`,r)}}}),this._spriteMosaic=new vs(2048,2048,500),this._glyphSource=new fs(`${qe.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new gs(1024,1024,this._glyphSource),this._rasterizer=new ls(e)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}async rasterizeItem(t,e,i,s){if(t==null)return kt("mapview-null-resource","Unable to rasterize null resource"),null;switch(t.type){case"text":case"esriTS":{const n=await this._rasterizeText(t,i,s);return n.forEach(r=>this._setTextureBinding(ft.GLYPH,r)),{glyphMosaicItems:n}}default:{if(wi(t))return kt("mapview-invalid-type",`MapView does not support symbol type: ${t.type}`,t),null;const n=await this._rasterizeSpriteSymbol(t,e,s);return Ai(n)&&n&&this._setTextureBinding(ft.SPRITE,n),{spriteMosaicItem:n}}}}bindTextures(t,e,i,s=!1){if(i.textureBinding===0)return;const n=this._bindingInfos[i.textureBinding-1],r=n.page,o=s?qt.LINEAR_MIPMAP_LINEAR:qt.LINEAR;switch(n.mosaicType){case ft.SPRITE:{const h=this.sprites.getWidth(r),u=this.sprites.getHeight(r),l=mt(me,h,u);return this._spriteMosaic.bind(t,o,r,re),e.setUniform1i("u_texture",re),void e.setUniform2fv("u_mosaicSize",l)}case ft.GLYPH:{const h=this.glyphs.width,u=this.glyphs.height,l=mt(me,h,u);return this._glyphMosaic.bind(t,o,r,ne),e.setUniform1i("u_texture",ne),void e.setUniform2fv("u_mosaicSize",l)}default:Ce.error("mapview-texture-manager",`Cannot handle unknown type ${n.mosaicType}`)}}_hashMosaic(t,e){return 1|t<<1|(e.sdf?1:0)<<2|e.page<<3}_setTextureBinding(t,e){const i=this._hashMosaic(t,e);if(!this._hashToBindingIndex.has(i)){const s=Wt.fromMosaic(t,e),n=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,n),this._bindingInfos.push(s)}e.textureBinding=this._hashToBindingIndex.get(i)}async _rasterizeText(t,e,i){let s,n;if("cim"in t){const h=t;s=h.fontName,n=h.text}else{const h=t;s=mi(h.font),n=h.text}const r=this._invalidFontsMap.has(s),o=e||bi(pi(n)[0]);try{const h=r?pe:s;return it("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(h),await this._glyphMosaic.getGlyphItems(h,o,i)}catch{return kt("mapview-invalid-resource",`Couldn't find font ${s}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(s,!0),this._glyphMosaic.getGlyphItems(pe,o,i)}}async _rasterizeSpriteSymbol(t,e,i){if(xi(t))return;const s=Ps(t);if(this._spriteMosaic.has(s))return this._spriteMosaic.getSpriteItem(s);if(ae(t)||Mi(t)&&!$i(t))return this._handleAsyncResource(s,t,i);const n=fi,r=this._rasterizer.rasterizeJSONResource(t,n);if(r){const{size:o,image:h,sdf:u,simplePattern:l,rasterizationScale:c}=r;return this._addItemToMosaic(s,o,{type:"static",data:h},yt(t),u,l,c)}return new Z("TextureManager","unrecognized or null rasterized image")}async _handleAsyncResource(t,e,i){if(this._ongoingRasterizations.has(t))return this._ongoingRasterizations.get(t);let s;s=ae(e)?this._handleSVG(e,t,i):this._handleImage(e,t,i),this._ongoingRasterizations.set(t,s);try{await s,this._ongoingRasterizations.delete(t)}catch{this._ongoingRasterizations.delete(t)}return s}async _handleSVG(t,e,i){const s=[Ft,Ft],n=await this._sdfConverter.draw(t.path,i);return this._addItemToMosaic(e,s,{type:"static",data:new Uint32Array(n.buffer)},!1,!0,!0)}async _handleGIFOrPNG(t,e,i){const s=oe(t);await this.resourceManager.fetchResource(s,i);let n=this.resourceManager.getResource(s);if(n==null)return new Z("mapview-invalid-resource",`Could not fetch requested resource at ${s}.`);let r=n.width,o=n.height;if(n instanceof HTMLImageElement){t.type==="esriPMS"&&(r=Math.round(ge(n.width,he(t))),o=Math.round(n.height*(r/n.width)));const c="cim"in t?t.cim.colorSubstitutions:void 0,{size:d,sdf:m,image:p}=this._rasterizer.rasterizeImageResource(r,o,n,c);return this._addItemToMosaic(e,d,{type:"static",data:p},yt(t),m,!1)}this._allowNonPowerOfTwo||(r=Nt(n.width+2*P)-2*P,o=Nt(n.height+2*P)-2*P),r===n.width&&o===n.height||(n=Ts(n,r,o));const h=t.animatedSymbolProperties||{},u=t.objectId,l=new Ds(n,this._requestRender,h,u);return this._addItemToMosaic(e,[l.width,l.height],{type:"animated",data:l},yt(t),!1,!1)}async _handleImage(t,e,i){if(Si(t)||zi(t))return this._handleGIFOrPNG(t,e,i);const s=oe(t);try{let n;const r=this.resourceManager.getResource(s);if(r!=null&&r instanceof HTMLImageElement)n=r;else{const{data:m}=await this._imageRequestQueue.push(s,{...i});n=m}if(Ii(s)){if("width"in t&&"height"in t)n.width=et(t.width),n.height=et(t.height);else if("cim"in t){const m=t.cim;n.width=et(m.width??m.scaleX*m.size),n.height=et(m.size)}}if(!n.width||!n.height)return null;let o=n.width,h=n.height;t.type==="esriPMS"&&(o=Math.round(ge(n.width,he(t))),h=Math.round(n.height*(o/n.width)));const u="cim"in t?t.cim.colorSubstitutions:void 0,{size:l,sdf:c,image:d}=this._rasterizer.rasterizeImageResource(o,h,n,u);return this._addItemToMosaic(e,l,{type:"static",data:d},yt(t),c,!1)}catch(n){if(!Jt(n))return new Z("mapview-invalid-resource",`Could not fetch requested resource at ${s}. ${n.message}`)}}_addItemToMosaic(t,e,i,s,n,r,o){return this._spriteMosaic.addSpriteItem(t,e,i,s,n,r,o)}}const En={shaders:{vertexShader:R("stencil/stencil.vert"),fragmentShader:R("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])},Cs=a=>a.replace("-","_").toUpperCase(),_e=a=>`#define ${Cs(a)}
`;function fe(a){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:_e(a)+R("blend/blend.vert"),fragmentShader:_e(a)+R("blend/blend.frag")}}}const ye=xe.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");let Bn=class{constructor(){this._size=[0,0]}dispose(t){this._backBufferTexture=Kt(this._backBufferTexture),this._quad=Kt(this._quad)}draw(t,e,i,s,n){const{context:r,drawPhase:o}=t;if(this._setupShader(r),s&&s!=="normal"&&o!==Ti.LABEL)return void this._drawBlended(t,e,i,s,n);const h=fe("normal"),u=r.programCache.acquire(h.shaders.vertexShader,h.shaders.fragmentShader,h.attributes);if(!u)return void ye.error(new Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'));r.useProgram(u),e.setSamplingMode(i),r.bindTexture(e,0),u.setUniform1i("u_layerTexture",0),u.setUniform1f("u_opacity",n),r.setBlendingEnabled(!0),r.setBlendFunction(Q.ONE,Q.ONE_MINUS_SRC_ALPHA);const l=this._quad;l.draw(),l.unbind(),u.dispose()}_drawBlended(t,e,i,s,n){const{context:r,state:o,pixelRatio:h,inFadeTransition:u}=t,{size:l}=o,c=r.getBoundFramebufferObject();let d,m;if(c!=null){const _=c.descriptor;d=_.width,m=_.height}else d=Math.round(h*l[0]),m=Math.round(h*l[1]);this._createOrResizeTexture(t,d,m);const p=this._backBufferTexture;c.copyToTexture(0,0,d,m,0,0,p),r.setStencilTestEnabled(!1),r.setStencilWriteMask(0),r.setBlendingEnabled(!0),r.setDepthTestEnabled(!1),r.setDepthWriteEnabled(!1);const g=fe(s),y=r.programCache.acquire(g.shaders.vertexShader,g.shaders.fragmentShader,g.attributes);if(!y)return void ye.error(new Z("mapview-BlendEffect",`Error creating shader program for blend mode ${s}`));r.useProgram(y),p.setSamplingMode(i),r.bindTexture(p,0),y.setUniform1i("u_backbufferTexture",0),e.setSamplingMode(i),r.bindTexture(e,1),y.setUniform1i("u_layerTexture",1),y.setUniform1f("u_opacity",n),y.setUniform1f("u_inFadeOpacity",u?1:0),r.setBlendFunction(Q.ONE,Q.ZERO);const v=this._quad;v.draw(),v.unbind(),y.dispose(),r.setBlendFunction(Q.ONE,Q.ONE_MINUS_SRC_ALPHA)}_setupShader(t){this._quad||(this._quad=new Le(t,[-1,-1,1,-1,-1,1,1,1]))}_createOrResizeTexture(t,e,i){const{context:s}=t;this._backBufferTexture!==null&&e===this._size[0]&&i===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(e,i):this._backBufferTexture=new Yt(s,{target:Di.TEXTURE_2D,pixelFormat:zt.RGBA,internalFormat:zt.RGBA,dataType:Zt.UNSIGNED_BYTE,wrapMode:Pi.CLAMP_TO_EDGE,samplingMode:qt.LINEAR,flipped:!1,width:e,height:i}),this._size[0]=e,this._size[1]=i)}};const Un={shaders:{vertexShader:R("highlight/textured.vert"),fragmentShader:R("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},Vn={shaders:{vertexShader:R("highlight/textured.vert"),fragmentShader:R("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},k=it("esri-2d-profiler");let Nn=class{constructor(t,e){if(this._events=new je,this._entries=new Map,this._timings=new Fi(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!k)return;this._ext=ki(t.gl,{}),this._debugOutput=e;const i=t.gl;if(!this.enableCommandLogging)return;let s;for(s in i)if(typeof i[s]=="function"){const n=i[s],r=s.includes("draw");i[s]=(...o)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:s,args:o,isDrawCommand:r}),this._currentSummary&&(this._currentSummary.commands++,r&&this._currentSummary.drawCommands++),n.apply(i,o))}}get enableCommandLogging(){return!(typeof k=="object"&&k.disableCommands)}recordContainerStart(t){k&&(this._currentContainer=t)}recordContainerEnd(){k&&(this._currentContainer=null)}recordPassStart(t){k&&(this._currentPass=t,this._initSummary())}recordPassEnd(){k&&(this._currentPass=null,this._emitSummary())}recordBrushStart(t){k&&(this._currentBrush=t)}recordBrushEnd(){k&&(this._currentBrush=null)}recordStart(t){if(k&&this._ext!=null){if(this._entries.has(t)){const i=this._entries.get(t),s=this._ext.resultAvailable(i.query),n=this._ext.disjoint();if(s&&!n){const r=this._ext.getResult(i.query)/1e6;let o=0;if(this._timings.enqueue(r)!=null){const l=this._timings.entries,c=l.length;let d=0;for(const m of l)d+=m;o=d/c}const h=r.toFixed(2),u=o?o.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${t}, ${h} ms (${u} last 10 avg)
${i.commandsLen} Commands (${i.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(i.summaries),console.log("Commands: ",i.commands),console.groupEnd()):console.log(`Frame report for ${t}, ${h} ms (${u} last 10 avg)`),this._debugOutput.innerHTML=`${h} (${u})`}for(const r of i.handles)r.remove();this._ext.deleteQuery(i.query),this._entries.delete(t)}const e={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",i=>{e.commandsLen++,e.commands.push(i),i.isDrawCommand&&e.drawCommands++})),e.handles.push(this._events.on("summary",i=>{e.summaries.push(i)}))),this._ext.beginTimeElapsed(e.query),this._entries.set(t,e)}}recordEnd(t){k&&this._ext!=null&&this._entries.has(t)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}};const wt=2,U=1,ut=0,ct=1,dt=2;let Rs=class{constructor(t,e,i){this._debugMap=new Map,this._width=t*i,this._height=e*i,this._pixelRatio=i;const s=Math.ceil(this._width/U),n=Math.ceil(this._height/U);this._cols=s,this._rows=n,this._cells=Ei.create(s*n)}insertMetrics(t){const e=this._hasCollision(t);return e===ut&&this._markMetrics(t),e}getCellId(t,e){return t+e*this._cols}has(t){return this._cells.has(t)}hasRange(t,e){return this._cells.hasRange(t,e)}set(t){this._cells.set(t)}setRange(t,e){this._cells.setRange(t,e)}_collide(t,e,i,s){const n=t-i/2,r=e-s/2,o=n+i,h=r+s;if(o<0||h<0||n>this._width||r>this._height)return ct;const u=E(Math.floor(n/U),0,this._cols),l=E(Math.floor(r/U),0,this._rows),c=E(Math.ceil(o/U),0,this._cols),d=E(Math.ceil(h/U),0,this._rows);for(let m=l;m<=d;m++)for(let p=u;p<=c;p++){const g=this.getCellId(p,m);if(this.has(g))return dt}return ut}_mark(t,e,i,s,n){const r=t-i/2,o=e-s/2,h=r+i,u=o+s,l=E(Math.floor(r/U),0,this._cols),c=E(Math.floor(o/U),0,this._rows),d=E(Math.ceil(h/U),0,this._cols),m=E(Math.ceil(u/U),0,this._rows);for(let p=c;p<=m;p++)for(let g=l;g<=d;g++){const y=this.getCellId(g,p);this._debugMap.set(y,n),this.set(y)}return!1}_hasCollision(t){const e=t.id;let i=0,s=0;t.save();do{const n=t.boundsCount;i+=n;for(let r=0;r<n;r++){const o=t.boundsComputedAnchorX(r),h=t.boundsComputedAnchorY(r),u=(t.boundsWidth(r)+wt)*this._pixelRatio,l=(t.boundsHeight(r)+wt)*this._pixelRatio;switch(this._collide(o,h,u,l)){case dt:return dt;case ct:s++}}}while(t.peekId()===e&&t.next());return t.restore(),i===s?ct:ut}_markMetrics(t){const e=t.id;t.save();do{const i=t.boundsCount;for(let s=0;s<i;s++){const n=t.boundsComputedAnchorX(s),r=t.boundsComputedAnchorY(s),o=(t.boundsWidth(s)+wt)*this._pixelRatio,h=(t.boundsHeight(s)+wt)*this._pixelRatio;this._mark(n,r,o,h,t.id)}}while(t.peekId()===e&&t.next());t.restore()}};const As=Math.PI;function Re(a,t){switch(t.transformationType){case H.Additive:return Fs(a,t);case H.Constant:return ks(t,a);case H.ClampedLinear:return Es(a,t);case H.Proportional:return Bs(a,t);case H.Stops:return Ls(a,t);case H.RealWorldSize:return Us(a,t);case H.Identity:return a;case H.Unknown:return null}}function L(a,t){return typeof a=="number"?a:Re(t,a)}function Fs(a,t){return a+(L(t.minSize,a)||t.minDataValue)}function ks(a,t){const e=a.stops;let i=e&&e.length&&e[0].size;return i==null&&(i=a.minSize),L(i,t)}function Es(a,t){const e=t.minDataValue,i=t.maxDataValue,s=(a-e)/(i-e),n=L(t.minSize,a),r=L(t.maxSize,a);return a<=e?n:a>=i?r:n+s*(r-n)}function Bs(a,t){const e=a/t.minDataValue,i=L(t.minSize,a),s=L(t.maxSize,a);let n=null;return n=e*i,E(n,i,s)}function Ls(a,t){const[e,i,s]=Vs(a,t.cache.ipData);if(e===i)return L(t.stops[e].size,a);{const n=L(t.stops[e].size,a);return n+(L(t.stops[i].size,a)-n)*s}}function Us(a,t){const e=Ze[t.valueUnit],i=L(t.minSize,a),s=L(t.maxSize,a),{valueRepresentation:n}=t;let r=null;return r=n==="area"?2*Math.sqrt(a/As)/e:n==="radius"||n==="distance"?2*a/e:a/e,E(r,i,s)}function Vs(a,t){if(!t)return;let e=0,i=t.length-1;return t.some((s,n)=>a<s?(i=n,!0):(e=n,!1)),[e,i,(a-t[e])/(t[i]-t[e])]}const Et=254,bt=255,ot=0;function J(a,t){const e=[];a.forEachTile(i=>e.push(i)),e.sort((i,s)=>i.instanceId-s.instanceId),e.forEach(i=>{i.labelMetrics!=null&&i.isReady&&t(i,i.labelMetrics.getCursor())})}function Ns(a){return a.layer&&(a.layer.type==="feature"||a.layer.type==="csv"||a.layer.type==="geojson"||a.layer.type==="ogc-feature"||a.layer.type==="stream"||a.layer.type==="subtype-group"||a.layer.type==="wfs")}function Os(a){return t=>et(Re(t,a))}function Gs(a){const t=a!=null&&"visualVariables"in a&&a.visualVariables;if(!t)return null;for(const e of t)if(e.type==="size")return Os(e);return null}function qs(a){for(const t of a){const e="featureReduction"in t&&t.featureReduction&&"labelingInfo"in t.featureReduction?t.featureReduction:void 0,i=[...t.labelingInfo||[],...(e==null?void 0:e.labelingInfo)||[]];if(!(!t.labelsVisible||!i.length)&&i.some(s=>s.deconflictionStrategy==="none"))return!0}return!1}function Hs(a,t){var h;if(!Ns(t))return;const e=t.layer.type==="subtype-group"?t.layer.sublayers.items:[t.layer],i=t.layer.geometryType,s=!qs(e),n={};if(t.layer.type!=="subtype-group"){if(((h=t.tileRenderer)==null?void 0:h.type)==="heatmap")return;const u=Gs(t.layer.renderer);n[0]=u}const r=t.tileRenderer;if(r==null)return;const o=t.layer.visible&&!t.suspended;a.push({tileRenderer:r,vvEvaluators:n,deconflictionEnabled:s,geometryType:i,visible:o})}let js=class{run(t,e,i){const s=[];for(let n=t.length-1;n>=0;n--)Hs(s,t[n]);this._transformMetrics(s),this._runCollision(s,e,i)}_runCollision(t,e,i){const[s,n]=e.state.size,r=new Rs(s,n,e.pixelRatio);for(const{tileRenderer:o,deconflictionEnabled:h,visible:u}of t){const l=o.featuresView.attributeView;h?u?(this._prepare(o),this._collideVisible(r,o,i),this._collideInvisible(r,o)):J(o,(c,d)=>{for(;d.nextId();)l.setLabelMinZoom(d.id,bt)}):J(o,(c,d)=>{for(;d.nextId();)l.setLabelMinZoom(d.id,ot),u&&r.insertMetrics(d)})}}_isFiltered(t,e,i){const s=e.getFilterFlags(t),n=!i.hasFilter||!!(s&yi),r=i.featureEffect==null||i.featureEffect.excludedLabelsVisible||!!(s&vi);return!(n&&r)}_prepare(t){const e=t.featuresView.attributeView,i=new Set;J(t,(s,n)=>{for(;n.nextId();)if(!i.has(n.id)){if(i.add(n.id),this._isFiltered(n.id,e,t.layerView)){e.setLabelMinZoom(n.id,Et);continue}e.getLabelMinZoom(n.id)!==ot?e.setLabelMinZoom(n.id,bt):e.setLabelMinZoom(n.id,ot)}})}_collideVisible(t,e,i){const s=e.featuresView.attributeView,n=new Set;J(e,(r,o)=>{for(;o.nextId();)if(!n.has(o.id))if(r.key.level===i){if(s.getLabelMinZoom(o.id)===0)switch(t.insertMetrics(o)){case ct:break;case dt:s.setLabelMinZoom(o.id,Et),n.add(o.id);break;case ut:s.setLabelMinZoom(o.id,ot),n.add(o.id)}}else s.setLabelMinZoom(o.id,Et)})}_collideInvisible(t,e){const i=e.featuresView.attributeView,s=new Set;J(e,(n,r)=>{for(;r.nextId();)if(!s.has(r.id)&&i.getLabelMinZoom(r.id)===bt)switch(t.insertMetrics(r)){case ct:break;case dt:i.setLabelMinZoom(r.id,bt),s.add(r.id);break;case ut:i.setLabelMinZoom(r.id,ot),s.add(r.id)}})}_transformMetrics(t){for(const{tileRenderer:e,geometryType:i,vvEvaluators:s}of t)J(e,(n,r)=>{const o=e.featuresView.attributeView,h=n.transforms.labelMat2d;h[4]=Math.round(h[4]),h[5]=Math.round(h[5]);const u=i==="polyline";for(;r.next();){const l=r.boundsCount,c=r.anchorX,d=r.anchorY;let m=r.size;const p=s[0];if(p!=null){const v=p(o.getVVSize(r.id));m=isNaN(v)||v==null||v===1/0?m:v}const g=r.directionX*(m/2),y=r.directionY*(m/2);for(let v=0;v<l;v++){let _=c,f=r.anchorY;if(u){let w=_+r.boundsX(v)+g,b=f+r.boundsY(v)+y;w=h[0]*w+h[2]*b+h[4],b=h[1]*w+h[3]*b+h[5],r.setBoundsComputedAnchorX(v,Math.floor(w)),r.setBoundsComputedAnchorY(v,Math.floor(b))}else{_=h[0]*c+h[2]*d+h[4],f=h[1]*c+h[3]*d+h[5];const w=_+r.boundsX(v)+g,b=f+r.boundsY(v)+y;r.setBoundsComputedAnchorX(v,w),r.setBoundsComputedAnchorY(v,b)}}}})}};const Zs=32;let W=class extends Ye(nt){constructor(t){super(t),this._applyVisibilityPassThrottled=We(this._applyVisibilityPass,Zs,this),this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}initialize(){this.collisionEngine=new js}destroy(){this.collisionEngine=null,this._applyVisibilityPassThrottled=Xe(this._applyVisibilityPassThrottled)}get updating(){return it("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:
-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(t){this._applyVisibilityPassThrottled(t)}viewChange(){this.requestUpdate()}requestUpdate(){var t;this.updateRequested||(this.updateRequested=!0,(t=this.view)==null||t.requestUpdate())}processUpdate(t){this._set("updateParameters",t),this.updateRequested&&(this.updateRequested=!1,this.update(t))}_applyVisibilityPass(t){const e=this.view;if(e)try{const i=e.featuresTilingScheme.getClosestInfoForScale(t.state.scale).level;this.collisionEngine.run(e.allLayerViews.items,t,i)}catch{}}};M([I()],W.prototype,"updateRequested",void 0),M([I({readOnly:!0})],W.prototype,"updateParameters",void 0),M([I()],W.prototype,"updating",null),M([I()],W.prototype,"view",void 0),W=M([st("esri.views.2d.layers.labels.LabelManager")],W);const jn=W,xt="esri-zoom-box",Mt={container:`${xt}__container`,overlay:`${xt}__overlay`,background:`${xt}__overlay-background`,box:`${xt}__outline`},Bt={zoom:"Shift",counter:"Ctrl"};let ht=class extends nt{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._handles=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this._handles&&this._handles.forEach(e=>{e.remove()}),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[Bt.zoom],e=>this._handleDrag(e,1),te.INTERNAL),t.on("drag",[Bt.zoom,Bt.counter],e=>this._handleDrag(e,-1),te.INTERNAL))}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,i,s){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=s,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,i,s,n){const r=this.view,o=r.toMap(Qe(t+.5*i,e+.5*s));let h=Math.max(i/r.width,s/r.height);n===-1&&(h=1/h),this._destroyOverlay(),this.navigation.end(),r.goTo({center:o,scale:r.scale*h})}_updateBox(t,e,i,s){const n=this._boxShape;n.setAttributeNS(null,"x",""+t),n.setAttributeNS(null,"y",""+e),n.setAttributeNS(null,"width",""+i),n.setAttributeNS(null,"height",""+s),n.setAttributeNS(null,"class",Mt.box)}_updateBackground(t,e,i,s){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,s,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=Mt.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",Mt.background);const s=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttributeNS(null,"class",Mt.overlay),n.appendChild(i),n.appendChild(s),this._container.appendChild(n),this._backgroundShape=i,this._boxShape=s,this._overlay=n}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,i,s,n,r){const o=t+i,h=e+s;return"M 0 0 L "+n+" 0 L "+n+" "+r+" L 0 "+r+" ZM "+t+" "+e+" L "+t+" "+h+" L "+o+" "+h+" L "+o+" "+e+" Z"}_handleDrag(t,e){const i=t.x,s=t.y,n=t.origin.x,r=t.origin.y;let o,h,u,l;switch(i>n?(o=n,u=i-n):(o=i,u=n-i),s>r?(h=r,l=s-r):(h=s,l=r-s),t.action){case"start":this._start();break;case"update":this._update(o,h,u,l);break;case"end":this._end(o,h,u,l,e)}t.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:t,y:e,width:i,height:s}=this._box;this._updateBox(t,e,i,s),this._updateBackground(t,e,i,s),this._rafId=requestAnimationFrame(this._redraw)}};M([I()],ht.prototype,"navigation",void 0),M([I()],ht.prototype,"view",null),ht=M([st("esri.views.2d.navigation.ZoomBox")],ht);const Ys=ht;let j=class{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const e=this.computeDelta(t);this._updateDelta(e)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return this.lastValue===void 0?NaN:t-this.lastValue}_updateDelta(t){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}},Xt=class{constructor(t,e,i){this._initialVelocity=t,this._stopVelocity=e,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,e){const i=this.value(t);return this.value(t+e)-i}valueFromInitialVelocity(t,e){e=Math.min(e,this.duration);const i=1-this.friction;return t*(i**e-1)/Math.log(i)}};class Ws extends Xt{constructor(t,e,i,s,n){super(t,e,i),this._sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class Xs{constructor(t=300,e=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this.enabled=!0,this._time=new j(.6),this._screen=[new j(.4),new j(.4)],this._scene=[new j(.6),new j(.6),new j(.6)],this._tmpDirection=Me()}add(t,e,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(e[0]),this._scene[1].update(e[1]),this._scene[2].update(e[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,e=this._screen[1].filteredDelta,i=t==null||e==null?0:Math.sqrt(t*t+e*e),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,e,i){Je(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Ke(this._tmpDirection);s>0&&$e(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new Ws(t,e,i,n==null?0:s/n,this._tmpDirection)}}let K=class extends nt{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new Xs(500,6,.92),this.momentum=null,this.tmpMomentum=Me(),this.momentumFinished=!1,this.viewpoint=new Pt({targetGeometry:new Ct,scale:0,rotation:0}),this._previousDrag=null,Se(()=>this.momentumFinished,()=>this.navigation.stop())}begin(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this._previousDrag=e}update(t,e){this.addToEstimator(e);let i=e.center.x,s=e.center.y;const n=this._previousDrag;i=n?n.center.x-i:-i,s=n?s-n.center.y:s,t.viewpoint=St(this.viewpoint,t.viewpoint,[i||0,s||0]),this._previousDrag=e}end(t,e){this.addToEstimator(e);const i=t.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}addToEstimator(t){const e=t.center.x,i=t.center.y,s=ti(-e,i),n=ei(-e,i,0);this.momentumEstimator.add(s,n,.001*t.timestamp)}onAnimationUpdate(t){var e;(e=this.navigation.animationManager)==null||e.animateContinous(t.viewpoint,(i,s)=>{const{momentum:n,animationTime:r,tmpMomentum:o}=this,h=.001*s;if(!(this.momentumFinished=!n||n.isFinished(r))){const u=n.valueDelta(r,h);$e(o,n.direction,u),St(i,i,o),t.constraints.constrainByGeometry(i)}this.animationTime+=h})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};M([I()],K.prototype,"momentumFinished",void 0),M([I()],K.prototype,"viewpoint",void 0),M([I()],K.prototype,"navigation",void 0),K=M([st("esri.views.2d.navigation.actions.Pan")],K);const Qs=K;let Ae=class{constructor(t=2.5,e=.01,i=.95,s=12){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new j(.8),this.time=new j(.3)}add(t,e){if(this.enabled&&e!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(t);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(e),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=E(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,e,i){return new Xt(t,e,i)}},Js=class extends Ae{constructor(t=3,e=.01,i=.95,s=12){super(t,e,i,s)}add(t,e){const i=this.value.lastValue;if(i!=null){let s=t-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=i+s}super.add(t,e)}};class Ks extends Xt{constructor(t,e,i){super(t,e,i)}value(t){const e=super.value(t);return Math.exp(e)}valueDelta(t,e){const i=super.value(t),s=super.value(t+e)-i;return Math.exp(s)}}class tn extends Ae{constructor(t=2.5,e=.01,i=.95,s=12){super(t,e,i,s)}add(t,e){super.add(Math.log(t),e)}createMomentum(t,e,i){return new Ks(t,e,i)}}let tt=class extends nt{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new Js(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new tn,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new Pt({targetGeometry:new Ct,scale:0,rotation:0}),this.addHandles(Se(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)}update(t,e){this._updateTimestamp===null&&(this._updateTimestamp=e.timestamp);const i=e.angle,s=e.radius,n=e.center,r=Math.abs(180*(i-this._startAngle)/Math.PI),o=Math.abs(s-this._startRadius),h=this._startRadius/s;if(this._previousRadius&&this._previousCenter){const u=s/this._previousRadius;let l=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=l>=0?1:-1,this._zoomDirection=u>=1?1:-1,t.constraints.rotationEnabled?(this._zoomOnly===null&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=o-r>0),this._zoomOnly===null||this._zoomOnly?l=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):l=0,this.addToZoomEstimator(e,h),this.navigation.setViewpoint([n.x,n.y],1/u,l,[this._previousCenter.x-n.x,n.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=s,this._previousCenter=n}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,e){this._rotationMomentumEstimator.add(t,.001*e)}addToZoomEstimator(t,e){this._zoomMomentumEstimator.add(e,.001*t.timestamp)}canZoomIn(t){const e=t.scale,i=t.constraints.effectiveMaxScale;return i===0||e>i}canZoomOut(t){const e=t.scale,i=t.constraints.effectiveMinScale;return i===0||e<i}onAnimationUpdate(t){var e;(e=this.navigation.animationManager)==null||e.animateContinous(t.viewpoint,(i,s)=>{const n=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,r=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),o=n||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),h=.001*s;if(this._momentumFinished=r&&o,!this._momentumFinished){const u=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,h))*this._rotationDirection*180/Math.PI:0;let l=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,h)):1;const c=pt(),d=pt();if(this._previousCenter){mt(c,this._previousCenter.x,this._previousCenter.y),ii(d,t.size,t.padding),si(c,c,d);const{constraints:m,scale:p}=t,g=p*l;l<1&&!m.canZoomInTo(g)?(l=p/m.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):l>1&&!m.canZoomOutTo(g)&&(l=p/m.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),ni(i,t.viewpoint,l,u,c,t.size),t.constraints.constrainByGeometry(i)}}this._animationTime+=h})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};M([I()],tt.prototype,"_momentumFinished",void 0),M([I()],tt.prototype,"viewpoint",void 0),M([I()],tt.prototype,"navigation",void 0),tt=M([st("esri.views.2d.navigation.actions.Pinch")],tt);const en=tt,Lt=pt(),ve=pt();let lt=class extends nt{constructor(a){super(a),this._previousCenter=pt(),this.viewpoint=new Pt({targetGeometry:new Ct,scale:0,rotation:0})}begin(a,t){this.navigation.begin(),mt(this._previousCenter,t.center.x,t.center.y)}update(a,t){const{state:{size:e,padding:i}}=a;mt(Lt,t.center.x,t.center.y),ri(ve,e,i),a.viewpoint=Gt(this.viewpoint,a.state.paddedViewState.viewpoint,ai(ve,this._previousCenter,Lt)),oi(this._previousCenter,Lt)}end(){this.navigation.end()}};M([I()],lt.prototype,"viewpoint",void 0),M([I()],lt.prototype,"navigation",void 0),lt=M([st("esri.views.2d.actions.Rotate")],lt);const sn=lt,$t=10,we=1,Ut=new Pt({targetGeometry:new Ct}),Vt=[0,0],be=250;let V=class extends nt{constructor(a){super(a),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new Qs({navigation:this}),this.rotate=new sn({navigation:this}),this.pinch=new en({navigation:this}),this.zoomBox=new Ys({view:this.view,navigation:this})}destroy(){this.pan=gt(this.pan),this.rotate=gt(this.rotate),this.pinch=gt(this.pinch),this.zoomBox=gt(this.zoomBox),this.animationManager=null}begin(){this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(be)}async zoom(a,t=this._getDefaultAnchor()){if(this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return a<1?this.zoomIn(t):this.zoomOut(t);this.setViewpoint(t,a,0,[0,0])}async zoomIn(a){const t=this.view,e=t.constraints.snapToNextScale(t.scale);return this._zoomToScale(e,a)}async zoomOut(a){const t=this.view,e=t.constraints.snapToPreviousScale(t.scale);return this._zoomToScale(e,a)}setViewpoint(a,t,e,i){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,a,t,e,i),this.end()}setViewpointImmediate(a,t=0,e=[0,0],i=this._getDefaultAnchor()){this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,i,a,t,e)}continousRotateClockwise(){var t;const a=this.get("view.viewpoint");(t=this.animationManager)==null||t.animateContinous(a,e=>{Gt(e,e,-we)})}continousRotateCounterclockwise(){var t;const a=this.get("view.viewpoint");(t=this.animationManager)==null||t.animateContinous(a,e=>{Gt(e,e,we)})}resetRotation(){this.view.rotation=0}continousPanLeft(){this._continuousPan([-$t,0])}continousPanRight(){this._continuousPan([$t,0])}continousPanUp(){this._continuousPan([0,$t])}continousPanDown(){this._continuousPan([0,-$t])}stop(){var a;this.pan.stopMomentumNavigation(),(a=this.animationManager)==null||a.stop(),this.end(),this._endTimer!==null&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(a){var e;const t=this.view.viewpoint;(e=this.animationManager)==null||e.animateContinous(t,i=>{St(i,i,a),this.view.constraints.constrainByGeometry(i)})}_startTimer(a){return this._endTimer!==null||(this._endTimer=setTimeout(()=>{this._endTimer=null;const t=performance.now()-(this._lastEventTimestamp??0);t<be?this._endTimer=this._startTimer(t):this._set("interacting",!1)},a)),this._endTimer}_getDefaultAnchor(){const{size:a,padding:{left:t,right:e,top:i,bottom:s}}=this.view;return Vt[0]=.5*(a[0]-e+t),Vt[1]=.5*(a[1]-s+i),Vt}async _zoomToScale(a,t=this._getDefaultAnchor()){const{view:e}=this,{constraints:i,scale:s,viewpoint:n,size:r,padding:o}=e,h=i.canZoomInTo(a),u=i.canZoomOutTo(a);if(!(a<s&&!h||a>s&&!u))return ee(Ut,n,a/s,0,t,r,o),i.constrainByGeometry(Ut),e.goTo(Ut,{animate:!0})}_scaleRotateTranslateViewpoint(a,t,e,i,s){const{view:n}=this,{size:r,padding:o,constraints:h,scale:u,viewpoint:l}=n,c=u*e,d=h.canZoomInTo(c),m=h.canZoomOutTo(c);return(e<1&&!d||e>1&&!m)&&(e=1),St(l,l,s),ee(a,l,e,i,t,r,o),h.constrainByGeometry(a)}};M([I()],V.prototype,"animationManager",void 0),M([I({type:Boolean,readOnly:!0})],V.prototype,"interacting",void 0),M([I()],V.prototype,"pan",void 0),M([I()],V.prototype,"pinch",void 0),M([I()],V.prototype,"rotate",void 0),M([I()],V.prototype,"view",void 0),M([I()],V.prototype,"zoomBox",void 0),V=M([st("esri.views.2d.navigation.MapViewNavigation")],V);const tr=V,nn={shaders:{vertexShader:R("magnifier/magnifier.vert"),fragmentShader:R("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function er(a){return Bi(a,nn)}export{rs as C,kn as Y,Vn as a,Qi as b,er as c,nn as d,zn as e,$n as i,Bn as l,Nn as n,En as r,Un as t,jn as u,tr as y};
