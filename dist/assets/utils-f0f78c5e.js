import{ax as u,eb as h,eq as y,er as b,es as d,_ as k,et as g}from"./index-65afe59f.js";import"./parser-8554880e.js";import{e as z}from"./ItemCache-bb571b5e.js";new z(1e3);new u([128,128,128]);const S=new u("white");function A(t,l){if(!t)return null;let n=null;return h(t)?n=x(t):y(t)&&(n=t.color?new u(t.color):null),n?s(n,l):null}function x(t){const l=t.symbolLayers;if(!l)return null;let n=null;return l.forEach(o=>{var i;o.type==="object"&&((i=o.resource)==null?void 0:i.href)!=null||(n=o.type==="water"?o.color:o.material!=null?o.material.color:null)}),n?new u(n):null}function s(t,l){if(l==null||t==null)return t;const n=t.toRgba();return n[3]=n[3]*l,new u(n)}function _(t,l,n){const o=t.symbolLayers;if(!o)return;const i=r=>s(l=l??r??null??(n!=null?S:null),n);o.forEach(r=>{var c;if(r.type!=="object"||((c=r.resource)==null?void 0:c.href)==null||l)if(r.type==="water")r.color=i(r.color);else{const f=r.material!=null?r.material.color:null,e=i(f);r.material==null?r.material=new g({color:e}):r.material.color=e,n!=null&&"outline"in r&&r.outline!=null&&r.outline.color!=null&&(r.outline.color=s(r.outline.color,n))}})}function v(t,l,n){(l=l??t.color)&&(t.color=s(l,n)),n!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=s(t.outline.color,n))}function D(t,l,n){t&&(l||n!=null)&&(l&&(l=new u(l)),h(t)?_(t,l,n):y(t)&&v(t,l,n))}async function L(t,l){const n=t.symbolLayers;n&&await b(n,async o=>j(o,l))}async function j(t,l){switch(t.type){case"extrude":R(t,l);break;case"icon":case"line":case"text":E(t,l);break;case"path":I(t,l);break;case"object":await $(t,l)}}function E(t,l){const n=w(l);n!=null&&(t.size=n)}function w(t){for(const l of t)if(typeof l=="number")return l;return null}function R(t,l){t.size=typeof l[2]=="number"?l[2]:0}async function $(t,l){const{resourceSize:n,symbolSize:o}=await O(t),i=p(l,n,o);t.width=a(l[0],o[0],n[0],i),t.depth=a(l[1],o[1],n[1],i),t.height=a(l[2],o[2],n[2],i)}function I(t,l){const n=p(l,d,[t.width,void 0,t.height]);t.width=a(l[0],t.width,1,n),t.height=a(l[2],t.height,1,n)}function p(t,l,n){for(let o=0;o<3;o++){const i=t[o];switch(i){case"symbol-value":{const r=n[o];return r!=null?r/l[o]:1}case"proportional":break;default:if(i&&l[o])return i/l[o]}}return 1}async function O(t){const l=await k(()=>import("./symbolLayerUtils-7b6158e5.js"),["assets/symbolLayerUtils-7b6158e5.js","assets/index-65afe59f.js","assets/index-001d3307.css","assets/ItemCache-bb571b5e.js","assets/MemCache-b8f96232.js"]),n=await l.computeObjectLayerResourceSize(t,10),{width:o,height:i,depth:r}=t,c=[o,r,i];let f=1;for(let e=0;e<3;e++){const m=c[e];if(m!=null){f=m/n[e];break}}for(let e=0;e<3;e++)c[e]==null&&(c[e]=n[e]*f);return{resourceSize:n,symbolSize:c}}function a(t,l,n,o){switch(t){case"proportional":return n*o;case"symbol-value":return l??n;default:return t}}function C(t,l){const n=w(l);if(n!=null)switch(t.type){case"simple-marker":t.size=n;break;case"picture-marker":{const o=t.width/t.height;o>1?(t.width=n,t.height=n*o):(t.width=n*o,t.height=n);break}case"simple-line":t.width=n;break;case"text":t.font.size=n}}async function J(t,l){if(t&&l)return h(t)?L(t,l):void(y(t)&&C(t,l))}function T(t,l,n){if(t&&l!=null)if(h(t)){const o=t.symbolLayers;o&&o.forEach(i=>{if(i&&i.type==="object")switch(n){case"tilt":i.tilt=l;break;case"roll":i.roll=l;break;default:i.heading=l}})}else y(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=l))}async function U(t,l){return await t.fetchSymbol(l)||t.fetchCIMSymbol(l)}export{U as J,J as M,T as R,D as g,A as h};
