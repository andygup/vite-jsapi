import{p as O,ax as N,E as F}from"./index-37fc1c1b.js";import{y as m,a as R,b}from"./color-af3426c7.js";import{M as H}from"./MaterialKey-c607442c.js";import{D as v,C as E}from"./definitions-3f56d206.js";import{D as a}from"./enums-08489827.js";import{g as w}from"./heatmapUtils-f0d5531e.js";class u{static getStorageSpec(e){return null}static createOrUpdateRendererSchema(e,r){return e!=null&&e.type==="default"?e:{type:"default"}}static getVariation(e){return{}}static getVariationHash(e){return 0}}u.type="default";u.programSpec=null;class g extends u{static getStorageSpec({attributes:e}){return{visualVariables:!1,attributes:e??null}}static _createRendererSchema(){return{type:"dot-density",colors:new Float32Array(8*4),dotValue:-1,dotSize:-1,dotScale:-1,dotBlending:!1,backgroundColor:new Float32Array(4),activeDots:new Float32Array(8),seed:-1}}static createOrUpdateRendererSchema(e,r){const{attributes:d,dotValue:p,referenceScale:y,dotSize:c,dotBlendingEnabled:l,seed:o,backgroundColor:s}=r,i=e!=null&&e.type==="dot-density"?e:this._createRendererSchema();i.dotValue=p,i.dotSize=c,i.dotScale=y,i.dotBlending=l,i.seed=o;const{colors:T,activeDots:S,backgroundColor:h}=i;for(let t=0;t<v;t++){const D=t>=d.length?null:d[t].color;m(T,D,t*4)}for(let t=0;t<8;t++)S[t]=t<r.attributes.length?1:0;return m(h,s),i}static getVariation(e){return{ddDotBlending:e.dotBlending}}static getVariationHash(e){return e.dotBlending?1:0}}g.type="dot-density";g.programSpec={shader:"materials/fill",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:a.SHORT},{location:1,name:"a_id",count:3,type:a.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:a.UNSIGNED_BYTE},{location:3,name:"a_inverseArea",count:1,type:a.FLOAT}]}};class _ extends u{static getStorageSpec({field:e,valueExpression:r}){return{visualVariables:!1,attributes:e||r?[{field:e,valueExpression:r}]:null}}static _createRendererSchema(){return{type:"heatmap",radius:-1,referenceScale:-1,isFieldActive:0,minDensity:-1,densityRange:-1,kernel:null,gradient:null,gradientHash:"invalid"}}static createOrUpdateRendererSchema(e,r){const{radius:d,minDensity:p,maxDensity:y,referenceScale:c,field:l,valueExpression:o,colorStops:s}=r,i=y-p,T=l||o?1:0,S=s.map(({color:D,ratio:A})=>`${A}:${D.toString()}`).join();let h=!0,t;return e!=null&&e.type==="heatmap"?(t=e,h=S!==e.gradientHash):t=this._createRendererSchema(),t.radius=O(d),t.minDensity=p,t.densityRange=i,t.referenceScale=c,t.isFieldActive=T,h&&(t.gradient=w(s),t.gradientHash=S),t}}_.type="heatmap";_.programSpec={shader:"materials/icon/heatmapAccumulate",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:a.SHORT},{location:1,name:"a_vertexOffset",count:2,type:a.SHORT},{location:4,name:"a_id",count:4,type:a.UNSIGNED_BYTE}]}};class f extends u{static getStorageSpec({attributes:e}){return{visualVariables:!0,attributes:e??null}}static _createRendererSchema(){return{type:"pie-chart",colors:new Float32Array(E*4),defaultColor:new Float32Array(4),othersColor:new Float32Array(4),outlineColor:new Float32Array(4),holePercentage:0,sectorThreshold:0,outlineWidth:1,numberOfFields:10}}static createOrUpdateRendererSchema(e,r){const{attributes:d,defaultColor:p,holePercentage:y,othersCategory:c,outline:l}=r,o=e!=null&&e.type==="pie-chart"?e:this._createRendererSchema();for(let s=0;s<E;s++){const i=s>=d.length?new N([0,0,0,0]):d[s].color;m(o.colors,i,s*4)}return m(o.defaultColor,p),m(o.othersColor,c==null?void 0:c.color),m(o.outlineColor,l==null?void 0:l.color),o.outlineWidth=O((l==null?void 0:l.width)||0),o.holePercentage=y,o.sectorThreshold=(c==null?void 0:c.threshold)||0,o.numberOfFields=d.length,o}static getVariation(e){return{numberOfFields:e.numberOfFields}}static getVariationHash(e){return e.numberOfFields}}f.type="pie-chart";f.programSpec={shader:"materials/pie",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:a.SHORT},{location:1,name:"a_vertexOffset",count:2,type:a.SHORT},{location:2,name:"a_texCoords",count:2,type:a.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:a.UNSIGNED_SHORT},{location:4,name:"a_id",count:4,type:a.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:a.UNSIGNED_BYTE,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:a.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:a.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:a.UNSIGNED_SHORT}]},hittestAttributes:["a_vertexOffset","a_texCoords"]};function V(n,e){if(n.type!==e)throw new F("material-view-model:unexpected-renderer-schema",`expected to find renderer schema of type "${e}" but found type "${n.type}"`)}function L(n){switch(n==null?void 0:n.type){case"dot-density":return g;case"heatmap":return _;case"pie-chart":return f;default:return u}}function Y(n){const{geometryType:e,symbologyType:r}=H.load(n);switch(e){case R.FILL:switch(r){case b.DOT_DENSITY:return g}break;case R.MARKER:switch(r){case b.HEATMAP:return _;case b.PIE_CHART:return f}break}return u}export{u as T,Y as a,V as b,L as g};
