import{a as S}from"./quickselect-322ec8e1.js";function B(i,n){if(!(this instanceof B))return new B(i,n);this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&(typeof n=="function"?this.toBBox=n:this._initFormat(n)),this.clear()}function E(i,n,t){if(!t)return n.indexOf(i);for(var h=0;h<n.length;h++)if(t(i,n[h]))return h;return-1}function u(i,n){x(i,0,i.children.length,n,i)}function x(i,n,t,h,a){a||(a=f(null)),a.minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(var e,r=n;r<t;r++)e=i.children[r],d(a,i.leaf?h(e):e);return a}function d(i,n){return i.minX=Math.min(i.minX,n.minX),i.minY=Math.min(i.minY,n.minY),i.maxX=Math.max(i.maxX,n.maxX),i.maxY=Math.max(i.maxY,n.maxY),i}function _(i,n){return i.minX-n.minX}function v(i,n){return i.minY-n.minY}function Y(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function p(i){return i.maxX-i.minX+(i.maxY-i.minY)}function w(i,n){return(Math.max(n.maxX,i.maxX)-Math.min(n.minX,i.minX))*(Math.max(n.maxY,i.maxY)-Math.min(n.minY,i.minY))}function F(i,n){var t=Math.max(i.minX,n.minX),h=Math.max(i.minY,n.minY),a=Math.min(i.maxX,n.maxX),e=Math.min(i.maxY,n.maxY);return Math.max(0,a-t)*Math.max(0,e-h)}function g(i,n){return i.minX<=n.minX&&i.minY<=n.minY&&n.maxX<=i.maxX&&n.maxY<=i.maxY}function M(i,n){return n.minX<=i.maxX&&n.minY<=i.maxY&&n.maxX>=i.minX&&n.maxY>=i.minY}function f(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(i,n,t,h,a){for(var e,r=[n,t];r.length;)(t=r.pop())-(n=r.pop())<=h||(e=n+Math.ceil((t-n)/h/2)*h,S(i,e,n,t,a),r.push(n,e,e,t))}B.prototype={all:function(){return this._all(this.data,[])},search:function(i){var n=this.data,t=[],h=this.toBBox;if(!M(i,n))return t;for(var a,e,r,o,s=[];n;){for(a=0,e=n.children.length;a<e;a++)r=n.children[a],M(i,o=n.leaf?h(r):r)&&(n.leaf?t.push(r):g(i,o)?this._all(r,t):s.push(r));n=s.pop()}return t},collides:function(i){var n=this.data,t=this.toBBox;if(!M(i,n))return!1;for(var h,a,e,r,o=[];n;){for(h=0,a=n.children.length;h<a;h++)if(e=n.children[h],M(i,r=n.leaf?t(e):e)){if(n.leaf||g(i,r))return!0;o.push(e)}n=o.pop()}return!1},load:function(i){if(!i||!i.length)return this;if(i.length<this._minEntries){for(var n=0,t=i.length;n<t;n++)this.insert(i[n]);return this}var h=this._build(i.slice(),0,i.length-1,0);if(this.data.children.length)if(this.data.height===h.height)this._splitRoot(this.data,h);else{if(this.data.height<h.height){var a=this.data;this.data=h,h=a}this._insert(h,this.data.height-h.height-1,!0)}else this.data=h;return this},insert:function(i){return i&&this._insert(i,this.data.height-1),this},clear:function(){return this.data=f([]),this},remove:function(i,n){if(!i)return this;for(var t,h,a,e,r=this.data,o=this.toBBox(i),s=[],l=[];r||s.length;){if(r||(r=s.pop(),h=s[s.length-1],t=l.pop(),e=!0),r.leaf&&(a=E(i,r.children,n))!==-1)return r.children.splice(a,1),s.push(r),this._condense(s),this;e||r.leaf||!g(r,o)?h?(t++,r=h.children[t],e=!1):r=null:(s.push(r),l.push(t),t=0,h=r,r=r.children[0])}return this},toBBox:function(i){return i},compareMinX:_,compareMinY:v,toJSON:function(){return this.data},fromJSON:function(i){return this.data=i,this},_all:function(i,n){for(var t=[];i;)i.leaf?n.push.apply(n,i.children):t.push.apply(t,i.children),i=t.pop();return n},_build:function(i,n,t,h){var a,e=t-n+1,r=this._maxEntries;if(e<=r)return u(a=f(i.slice(n,t+1)),this.toBBox),a;h||(h=Math.ceil(Math.log(e)/Math.log(r)),r=Math.ceil(e/Math.pow(r,h-1))),(a=f([])).leaf=!1,a.height=h;var o,s,l,m,c=Math.ceil(e/r),X=c*Math.ceil(Math.sqrt(r));for(b(i,n,t,X,this.compareMinX),o=n;o<=t;o+=X)for(b(i,o,l=Math.min(o+X-1,t),c,this.compareMinY),s=o;s<=l;s+=c)m=Math.min(s+c-1,l),a.children.push(this._build(i,s,m,h-1));return u(a,this.toBBox),a},_chooseSubtree:function(i,n,t,h){for(var a,e,r,o,s,l,m,c;h.push(n),!n.leaf&&h.length-1!==t;){for(m=c=1/0,a=0,e=n.children.length;a<e;a++)s=Y(r=n.children[a]),(l=w(i,r)-s)<c?(c=l,m=s<m?s:m,o=r):l===c&&s<m&&(m=s,o=r);n=o||n.children[0]}return n},_insert:function(i,n,t){var h=this.toBBox,a=t?i:h(i),e=[],r=this._chooseSubtree(a,this.data,n,e);for(r.children.push(i),d(r,a);n>=0&&e[n].children.length>this._maxEntries;)this._split(e,n),n--;this._adjustParentBBoxes(a,e,n)},_split:function(i,n){var t=i[n],h=t.children.length,a=this._minEntries;this._chooseSplitAxis(t,a,h);var e=this._chooseSplitIndex(t,a,h),r=f(t.children.splice(e,t.children.length-e));r.height=t.height,r.leaf=t.leaf,u(t,this.toBBox),u(r,this.toBBox),n?i[n-1].children.push(r):this._splitRoot(t,r)},_splitRoot:function(i,n){this.data=f([i,n]),this.data.height=i.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},_chooseSplitIndex:function(i,n,t){var h,a,e,r,o,s,l,m;for(s=l=1/0,h=n;h<=t-n;h++)r=F(a=x(i,0,h,this.toBBox),e=x(i,h,t,this.toBBox)),o=Y(a)+Y(e),r<s?(s=r,m=h,l=o<l?o:l):r===s&&o<l&&(l=o,m=h);return m},_chooseSplitAxis:function(i,n,t){var h=i.leaf?this.compareMinX:_,a=i.leaf?this.compareMinY:v;this._allDistMargin(i,n,t,h)<this._allDistMargin(i,n,t,a)&&i.children.sort(h)},_allDistMargin:function(i,n,t,h){i.children.sort(h);var a,e,r=this.toBBox,o=x(i,0,n,r),s=x(i,t-n,t,r),l=p(o)+p(s);for(a=n;a<t-n;a++)e=i.children[a],d(o,i.leaf?r(e):e),l+=p(o);for(a=t-n-1;a>=n;a--)e=i.children[a],d(s,i.leaf?r(e):e),l+=p(s);return l},_adjustParentBBoxes:function(i,n,t){for(var h=t;h>=0;h--)d(n[h],i)},_condense:function(i){for(var n,t=i.length-1;t>=0;t--)i[t].children.length===0?t>0?(n=i[t-1].children).splice(n.indexOf(i[t]),1):this.clear():u(i[t],this.toBBox)},_initFormat:function(i){var n=["return a"," - b",";"];this.compareMinX=new Function("a","b",n.join(i[0])),this.compareMinY=new Function("a","b",n.join(i[1])),this.toBBox=new Function("a","return {minX: a"+i[0]+", minY: a"+i[1]+", maxX: a"+i[2]+", maxY: a"+i[3]+"};")}};export{B as i};
