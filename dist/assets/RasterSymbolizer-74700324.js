import{bS as $t,s as pe,dx as ur,bV as cr,_ as hr,ak as fr,X as Fe,ae as B,af as O,ai as Be,bD as Me,bF as dr,bG as pr,K as mr,cF as Q,bf as Ct,bt as gr,cH as Vt,ax as wt,J as vt}from"./index-6e11f365.js";import{e as ct,u as te,o as Te,h as yr,s as bt,i as Ye,j as Cr,k as Tt,l as Pe}from"./dataUtils-b335321a.js";import{y as Ve,z as St,v as kt,p as wr}from"./colorUtils-c0f43caf.js";var Ke,It,xt,Qe={exports:{}};Qe.exports,It=Qe,Ke=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(t){var r=this.buffer,i=r?r.byteLength:0;if(t<i)return r;for(var s=512;s<t;)s<<=1;for(var n=new Uint8Array(s),h=0;h<i;++h)n[h]=r[h];return this.buffer=n},getByte:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var r=this.pos;if(t){this.ensureBuffer(r+t);for(var i=r+t;!this.eof&&this.bufferLength<i;)this.readBlock();var s=this.bufferLength;i>s&&(i=s)}else{for(;!this.eof;)this.readBlock();i=this.bufferLength}return this.pos=i,this.buffer.subarray(r,i)},lookChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,r,i){for(var s=t+r;this.bufferLength<=s&&!this.eof;)this.readBlock();return new Stream(this.buffer,t,r,i)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=0}},e}(),(xt=function(){if(!self||!self.Uint32Array)return null;var e=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),i=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],s=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function n(o){throw new Error(o)}function h(o){var c=0,u=o[c++],a=o[c++];u!=-1&&a!=-1||n("Invalid header in flate stream"),(15&u)!=8&&n("Unknown compression method in flate stream"),((u<<8)+a)%31!=0&&n("Bad FCHECK in flate stream"),32&a&&n("FDICT bit set in flate stream"),this.bytes=o,this.bytesPos=c,this.codeSize=0,this.codeBuf=0,Ke.call(this)}return h.prototype=Object.create(Ke.prototype),h.prototype.getBits=function(o){for(var c,u=this.codeSize,a=this.codeBuf,g=this.bytes,f=this.bytesPos;u<o;)(c=g[f++])===void 0&&n("Bad encoding in flate stream"),a|=c<<u,u+=8;return c=a&(1<<o)-1,this.codeBuf=a>>o,this.codeSize=u-=o,this.bytesPos=f,c},h.prototype.getCode=function(o){for(var c=o[0],u=o[1],a=this.codeSize,g=this.codeBuf,f=this.bytes,d=this.bytesPos;a<u;){var w;(w=f[d++])===void 0&&n("Bad encoding in flate stream"),g|=w<<a,a+=8}var m=c[g&(1<<u)-1],C=m>>16,l=65535&m;return(a==0||a<C||C==0)&&n("Bad encoding in flate stream"),this.codeBuf=g>>C,this.codeSize=a-C,this.bytesPos=d,l},h.prototype.generateHuffmanTable=function(o){for(var c=o.length,u=0,a=0;a<c;++a)o[a]>u&&(u=o[a]);for(var g=1<<u,f=new Uint32Array(g),d=1,w=0,m=2;d<=u;++d,w<<=1,m<<=1)for(var C=0;C<c;++C)if(o[C]==d){var l=0,p=w;for(a=0;a<d;++a)l=l<<1|1&p,p>>=1;for(a=l;a<g;a+=m)f[a]=d<<16|C;++w}return[f,u]},h.prototype.readBlock=function(){function o(P,W,F,N,$){for(var J=P.getBits(F)+N;J-- >0;)W[m++]=$}var c=this.getBits(3);if(1&c&&(this.eof=!0),(c>>=1)!=0){var u,a;if(c==1)u=i,a=s;else if(c==2){for(var g=this.getBits(5)+257,f=this.getBits(5)+1,d=this.getBits(4)+4,w=Array(e.length),m=0;m<d;)w[e[m++]]=this.getBits(3);for(var C=this.generateHuffmanTable(w),l=0,p=(m=0,g+f),y=new Array(p);m<p;){var v=this.getCode(C);v==16?o(this,y,2,3,l):v==17?o(this,y,3,3,l=0):v==18?o(this,y,7,11,l=0):y[m++]=l=v}u=this.generateHuffmanTable(y.slice(0,g)),a=this.generateHuffmanTable(y.slice(g,p))}else n("Unknown block type in flate stream");for(var b=(R=this.buffer)?R.length:0,S=this.bufferLength;;){var T=this.getCode(u);if(T<256)S+1>=b&&(b=(R=this.ensureBuffer(S+1)).length),R[S++]=T;else{if(T==256)return void(this.bufferLength=S);var k=(T=t[T-=257])>>16;k>0&&(k=this.getBits(k)),l=(65535&T)+k,T=this.getCode(a),(k=(T=r[T])>>16)>0&&(k=this.getBits(k));var I=(65535&T)+k;S+l>=b&&(b=(R=this.ensureBuffer(S+l)).length);for(var A=0;A<l;++A,++S)R[S]=R[S-I]}}}else{var x,D=this.bytes,E=this.bytesPos;(x=D[E++])===void 0&&n("Bad block header in flate stream");var G=x;(x=D[E++])===void 0&&n("Bad block header in flate stream"),G|=x<<8,(x=D[E++])===void 0&&n("Bad block header in flate stream");var L=x;(x=D[E++])===void 0&&n("Bad block header in flate stream"),(L|=x<<8)!=(65535&~G)&&n("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var U=this.bufferLength,R=this.ensureBuffer(U+G),z=U+G;this.bufferLength=z;for(var _=U;_<z;++_){if((x=D[E++])===void 0){this.eof=!0;break}R[_]=x}this.bytesPos=E}},h}())!==void 0&&(It.exports=xt);const Ge=$t(Qe.exports);let vr=class jt{constructor(t){this._canvas=null,this._ctx=null,t&&(this._canvas=t.canvas,this._ctx=t.ctx||t.canvas&&t.canvas.getContext("2d"))}decode(t,r,i){if(!t||t.byteLength<10)throw new pe("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:s=0,height:n=0,format:h}=r;const{applyJpegMask:o}=r;if(o&&(!s||!n))throw new pe("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((c,u)=>{let a=null;h==="jpg"&&o&&(a=jt._getMask(t,{width:s,height:n}));const g=new Blob([new Uint8Array(t)],{type:"image/"+h=="jpg"?"jpeg":h}),f=URL.createObjectURL(g),d=new Image;let w;d.src=f,d.onload=()=>{if(URL.revokeObjectURL(f),ur(i))return void u(cr());s=d.width,n=d.height,this._canvas&&this._ctx?(this._canvas.width===s&&this._canvas.height===n||(this._canvas.width=s,this._canvas.height=n),this._ctx.clearRect(0,0,s,n)):(this._canvas=document.createElement("canvas"),this._canvas.width=s,this._canvas.height=n,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(d,0,0);const m=this._ctx.getImageData(0,0,s,n);let C;if(w=m.data,r.renderOnCanvas){if(a)for(C=0;C<a.length;C++)a[C]?w[4*C+3]=255:w[4*C+3]=0;return this._ctx.putImageData(m,0,0),void c(null)}const l=s*n,p=new Uint8Array(l),y=new Uint8Array(l),v=new Uint8Array(l);if(a)for(C=0;C<l;C++)p[C]=w[4*C],y[C]=w[4*C+1],v[C]=w[4*C+2];else for(a=new Uint8Array(l),C=0;C<l;C++)p[C]=w[4*C],y[C]=w[4*C+1],v[C]=w[4*C+2],a[C]=w[4*C+3];c({width:s,height:n,pixels:[p,y,v],mask:a,pixelType:"u8"})},d.onerror=()=>{URL.revokeObjectURL(f),u("cannot load image")}})}static _getMask(t,r){let i=null;try{const s=new Uint8Array(t),n=Math.ceil(s.length/2);let h=0;const o=s.length-2;for(h=n;h<o&&(s[h]!==255||s[h+1]!==217);h++);if(h+=2,h<s.length-1){const c=new Ge(s.subarray(h)).getBytes();i=new Uint8Array(r.width*r.height);let u=0;for(let a=0;a<c.length;a++)for(let g=7;g>=0;g--)i[u++]=c[a]>>g&1}}catch{}return i}};var At,Dt,Et,et={exports:{}};et.exports,At=et,Dt=function(){var e=function(){function t(r){this.message="JPEG error: "+r}return t.prototype=new Error,t.prototype.name="JpegError",t.constructor=t,t}();return function(){if(!self||!self.Uint8ClampedArray)return null;var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,i=799,s=3406,n=2276,h=1567,o=3784,c=5793,u=2896;function a(){this.decodeTransform=null,this.colorTransform=-1}function g(l,p){for(var y,v,b=0,S=[],T=16;T>0&&!l[T-1];)T--;S.push({children:[],index:0});var k,I=S[0];for(y=0;y<T;y++){for(v=0;v<l[y];v++){for((I=S.pop()).children[I.index]=p[b];I.index>0;)I=S.pop();for(I.index++,S.push(I);S.length<=y;)S.push(k={children:[],index:0}),I.children[I.index]=k.children,I=k;b++}y+1<T&&(S.push(k={children:[],index:0}),I.children[I.index]=k.children,I=k)}return S[0].children}function f(l,p,y){return 64*((l.blocksPerLine+1)*p+y)}function d(l,p,y,v,b,S,T,k,I){var A=y.mcusPerLine,x=y.progressive,D=p,E=0,G=0;function L(){if(G>0)return G--,E>>G&1;if((E=l[p++])===255){var M=l[p++];if(M)throw new e("unexpected marker "+(E<<8|M).toString(16))}return G=7,E>>>7}function U(M){for(var j=M;;){if(typeof(j=j[L()])=="number")return j;if(typeof j!="object")throw new e("invalid huffman sequence")}}function R(M){for(var j=0;M>0;)j=j<<1|L(),M--;return j}function z(M){if(M===1)return L()===1?1:-1;var j=R(M);return j>=1<<M-1?j:j+(-1<<M)+1}function _(M,j){var H=U(M.huffmanTableDC),q=H===0?0:z(H);M.blockData[j]=M.pred+=q;for(var re=1;re<64;){var le=U(M.huffmanTableAC),X=15&le,ie=le>>4;if(X!==0){var lr=t[re+=ie];M.blockData[j+lr]=z(X),re++}else{if(ie<15)break;re+=16}}}function P(M,j){var H=U(M.huffmanTableDC),q=H===0?0:z(H)<<I;M.blockData[j]=M.pred+=q}function W(M,j){M.blockData[j]|=L()<<I}var F=0;function N(M,j){if(F>0)F--;else for(var H=S,q=T;H<=q;){var re=U(M.huffmanTableAC),le=15&re,X=re>>4;if(le!==0){var ie=t[H+=X];M.blockData[j+ie]=z(le)*(1<<I),H++}else{if(X<15){F=R(X)+(1<<X)-1;break}H+=16}}}var $,J=0;function oe(M,j){for(var H,q,re=S,le=T,X=0;re<=le;){var ie=t[re];switch(J){case 0:if(X=(q=U(M.huffmanTableAC))>>4,(H=15&q)==0)X<15?(F=R(X)+(1<<X),J=4):(X=16,J=1);else{if(H!==1)throw new e("invalid ACn encoding");$=z(H),J=X?2:3}continue;case 1:case 2:M.blockData[j+ie]?M.blockData[j+ie]+=L()<<I:--X==0&&(J=J===2?3:0);break;case 3:M.blockData[j+ie]?M.blockData[j+ie]+=L()<<I:(M.blockData[j+ie]=$<<I,J=0);break;case 4:M.blockData[j+ie]&&(M.blockData[j+ie]+=L()<<I)}re++}J===4&&--F==0&&(J=0)}function Se(M,j,H,q,re){var le=H%A;j(M,f(M,(H/A|0)*M.v+q,le*M.h+re))}function ke(M,j,H){j(M,f(M,H/M.blocksPerLine|0,H%M.blocksPerLine))}var ce,ne,he,me,K,Ee,ge=v.length;Ee=x?S===0?k===0?P:W:k===0?N:oe:_;var se,ye,Oe,_e,fe=0;for(ye=ge===1?v[0].blocksPerLine*v[0].blocksPerColumn:A*y.mcusPerColumn;fe<ye;){var Ue=b?Math.min(ye-fe,b):ye;for(ne=0;ne<ge;ne++)v[ne].pred=0;if(F=0,ge===1)for(ce=v[0],K=0;K<Ue;K++)ke(ce,Ee,fe),fe++;else for(K=0;K<Ue;K++){for(ne=0;ne<ge;ne++)for(Oe=(ce=v[ne]).h,_e=ce.v,he=0;he<_e;he++)for(me=0;me<Oe;me++)Se(ce,Ee,fe,he,me);fe++}G=0,(se=C(l,p))&&se.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+se.invalid),p=se.offset);var Ce=se&&se.marker;if(!Ce||Ce<=65280)throw new e("marker was not found");if(!(Ce>=65488&&Ce<=65495))break;p+=2}return(se=C(l,p))&&se.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+se.invalid),p=se.offset),p-D}function w(l,p,y){var v,b,S,T,k,I,A,x,D,E,G,L,U,R,z,_,P,W=l.quantizationTable,F=l.blockData;if(!W)throw new e("missing required Quantization Table.");for(var N=0;N<64;N+=8)D=F[p+N],E=F[p+N+1],G=F[p+N+2],L=F[p+N+3],U=F[p+N+4],R=F[p+N+5],z=F[p+N+6],_=F[p+N+7],D*=W[N],E|G|L|U|R|z|_?(E*=W[N+1],G*=W[N+2],L*=W[N+3],U*=W[N+4],R*=W[N+5],z*=W[N+6],_*=W[N+7],b=(v=(v=c*D+128>>8)+(b=c*U+128>>8)+1>>1)-b,P=(S=G)*o+(T=z)*h+128>>8,S=S*h-T*o+128>>8,A=(k=(k=u*(E-_)+128>>8)+(A=R<<4)+1>>1)-A,I=(x=(x=u*(E+_)+128>>8)+(I=L<<4)+1>>1)-I,T=(v=v+(T=P)+1>>1)-T,S=(b=b+S+1>>1)-S,P=k*n+x*s+2048>>12,k=k*s-x*n+2048>>12,x=P,P=I*i+A*r+2048>>12,I=I*r-A*i+2048>>12,A=P,y[N]=v+x,y[N+7]=v-x,y[N+1]=b+A,y[N+6]=b-A,y[N+2]=S+I,y[N+5]=S-I,y[N+3]=T+k,y[N+4]=T-k):(P=c*D+512>>10,y[N]=P,y[N+1]=P,y[N+2]=P,y[N+3]=P,y[N+4]=P,y[N+5]=P,y[N+6]=P,y[N+7]=P);for(var $=0;$<8;++$)D=y[$],(E=y[$+8])|(G=y[$+16])|(L=y[$+24])|(U=y[$+32])|(R=y[$+40])|(z=y[$+48])|(_=y[$+56])?(b=(v=4112+((v=c*D+2048>>12)+(b=c*U+2048>>12)+1>>1))-b,P=(S=G)*o+(T=z)*h+2048>>12,S=S*h-T*o+2048>>12,T=P,A=(k=(k=u*(E-_)+2048>>12)+(A=R)+1>>1)-A,I=(x=(x=u*(E+_)+2048>>12)+(I=L)+1>>1)-I,P=k*n+x*s+2048>>12,k=k*s-x*n+2048>>12,x=P,P=I*i+A*r+2048>>12,I=I*r-A*i+2048>>12,D=(D=(v=v+T+1>>1)+x)<16?0:D>=4080?255:D>>4,E=(E=(b=b+S+1>>1)+(A=P))<16?0:E>=4080?255:E>>4,G=(G=(S=b-S)+I)<16?0:G>=4080?255:G>>4,L=(L=(T=v-T)+k)<16?0:L>=4080?255:L>>4,U=(U=T-k)<16?0:U>=4080?255:U>>4,R=(R=S-I)<16?0:R>=4080?255:R>>4,z=(z=b-A)<16?0:z>=4080?255:z>>4,_=(_=v-x)<16?0:_>=4080?255:_>>4,F[p+$]=D,F[p+$+8]=E,F[p+$+16]=G,F[p+$+24]=L,F[p+$+32]=U,F[p+$+40]=R,F[p+$+48]=z,F[p+$+56]=_):(P=(P=c*D+8192>>14)<-2040?0:P>=2024?255:P+2056>>4,F[p+$]=P,F[p+$+8]=P,F[p+$+16]=P,F[p+$+24]=P,F[p+$+32]=P,F[p+$+40]=P,F[p+$+48]=P,F[p+$+56]=P)}function m(l,p){for(var y=p.blocksPerLine,v=p.blocksPerColumn,b=new Int16Array(64),S=0;S<v;S++)for(var T=0;T<y;T++)w(p,f(p,S,T),b);return p.blockData}function C(l,p,y){function v(I){return l[I]<<8|l[I+1]}var b=l.length-1,S=y<p?y:p;if(p>=b)return null;var T=v(p);if(T>=65472&&T<=65534)return{invalid:null,marker:T,offset:p};for(var k=v(S);!(k>=65472&&k<=65534);){if(++S>=b)return null;k=v(S)}return{invalid:T.toString(16),marker:k,offset:S}}return a.prototype={parse:function(l){function p(){var M=l[T]<<8|l[T+1];return T+=2,M}function y(){var M=p(),j=T+M-2,H=C(l,j,T);H&&H.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+H.invalid),j=H.offset);var q=l.subarray(T,j);return T+=q.length,q}function v(M){for(var j=Math.ceil(M.samplesPerLine/8/M.maxH),H=Math.ceil(M.scanLines/8/M.maxV),q=0;q<M.components.length;q++){K=M.components[q];var re=Math.ceil(Math.ceil(M.samplesPerLine/8)*K.h/M.maxH),le=Math.ceil(Math.ceil(M.scanLines/8)*K.v/M.maxV),X=j*K.h,ie=H*K.v*64*(X+1);K.blockData=new Int16Array(ie),K.blocksPerLine=re,K.blocksPerColumn=le}M.mcusPerLine=j,M.mcusPerColumn=H}var b,S,T=0,k=null,I=null,A=[],x=[],D=[],E=p();if(E!==65496)throw new e("SOI not found");for(E=p();E!==65497;){var G,L,U;switch(E){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var R=y();E===65504&&R[0]===74&&R[1]===70&&R[2]===73&&R[3]===70&&R[4]===0&&(k={version:{major:R[5],minor:R[6]},densityUnits:R[7],xDensity:R[8]<<8|R[9],yDensity:R[10]<<8|R[11],thumbWidth:R[12],thumbHeight:R[13],thumbData:R.subarray(14,14+3*R[12]*R[13])}),E===65518&&R[0]===65&&R[1]===100&&R[2]===111&&R[3]===98&&R[4]===101&&(I={version:R[5]<<8|R[6],flags0:R[7]<<8|R[8],flags1:R[9]<<8|R[10],transformCode:R[11]});break;case 65499:for(var z=p()+T-2;T<z;){var _=l[T++],P=new Uint16Array(64);if(_>>4){if(_>>4!=1)throw new e("DQT - invalid table spec");for(L=0;L<64;L++)P[t[L]]=p()}else for(L=0;L<64;L++)P[t[L]]=l[T++];A[15&_]=P}break;case 65472:case 65473:case 65474:if(b)throw new e("Only single frame JPEGs supported");p(),(b={}).extended=E===65473,b.progressive=E===65474,b.precision=l[T++],b.scanLines=p(),b.samplesPerLine=p(),b.components=[],b.componentIds={};var W,F=l[T++],N=0,$=0;for(G=0;G<F;G++){W=l[T];var J=l[T+1]>>4,oe=15&l[T+1];N<J&&(N=J),$<oe&&($=oe);var Se=l[T+2];U=b.components.push({h:J,v:oe,quantizationId:Se,quantizationTable:null}),b.componentIds[W]=U-1,T+=3}b.maxH=N,b.maxV=$,v(b);break;case 65476:var ke=p();for(G=2;G<ke;){var ce=l[T++],ne=new Uint8Array(16),he=0;for(L=0;L<16;L++,T++)he+=ne[L]=l[T];var me=new Uint8Array(he);for(L=0;L<he;L++,T++)me[L]=l[T];G+=17+he,(ce>>4?x:D)[15&ce]=g(ne,me)}break;case 65501:p(),S=p();break;case 65498:p();var K,Ee=l[T++],ge=[];for(G=0;G<Ee;G++){var se=b.componentIds[l[T++]];K=b.components[se];var ye=l[T++];K.huffmanTableDC=D[ye>>4],K.huffmanTableAC=x[15&ye],ge.push(K)}var Oe=l[T++],_e=l[T++],fe=l[T++],Ue=d(l,T,b,ge,S,Oe,_e,fe>>4,15&fe);T+=Ue;break;case 65535:l[T]!==255&&T--;break;default:if(l[T-3]===255&&l[T-2]>=192&&l[T-2]<=254){T-=3;break}throw new e("unknown marker "+E.toString(16))}E=p()}for(this.width=b.samplesPerLine,this.height=b.scanLines,this.jfif=k,this.eof=T,this.adobe=I,this.components=[],G=0;G<b.components.length;G++){var Ce=A[(K=b.components[G]).quantizationId];Ce&&(K.quantizationTable=Ce),this.components.push({output:m(b,K),scaleX:K.h/b.maxH,scaleY:K.v/b.maxV,blocksPerLine:K.blocksPerLine,blocksPerColumn:K.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(l,p){var y,v,b,S,T,k,I,A,x,D,E,G=this.width/l,L=this.height/p,U=0,R=this.components.length,z=l*p*R,_=new Uint8ClampedArray(z),P=new Uint32Array(l),W=4294967288;for(I=0;I<R;I++){for(v=(y=this.components[I]).scaleX*G,b=y.scaleY*L,U=I,E=y.output,S=y.blocksPerLine+1<<3,T=0;T<l;T++)A=0|T*v,P[T]=(A&W)<<3|7&A;for(k=0;k<p;k++)for(D=S*((A=0|k*b)&W)|(7&A)<<3,T=0;T<l;T++)_[U]=E[D+P[T]],U+=R}var F=this.decodeTransform;if(F)for(I=0;I<z;)for(A=0,x=0;A<R;A++,I++,x+=2)_[I]=(_[I]*F[x]>>8)+F[x+1];return _},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(l){for(var p,y,v,b=0,S=l.length;b<S;b+=3)p=l[b],y=l[b+1],v=l[b+2],l[b]=p-179.456+1.402*v,l[b+1]=p+135.459-.344*y-.714*v,l[b+2]=p-226.816+1.772*y;return l},_convertYcckToRgb:function(l){for(var p,y,v,b,S=0,T=0,k=l.length;T<k;T+=4)p=l[T],y=l[T+1],v=l[T+2],b=l[T+3],l[S++]=y*(-660635669420364e-19*y+.000437130475926232*v-54080610064599e-18*p+.00048449797120281*b-.154362151871126)-122.67195406894+v*(-.000957964378445773*v+.000817076911346625*p-.00477271405408747*b+1.53380253221734)+p*(.000961250184130688*p-.00266257332283933*b+.48357088451265)+b*(-.000336197177618394*b+.484791561490776),l[S++]=107.268039397724+y*(219927104525741e-19*y-.000640992018297945*v+.000659397001245577*p+.000426105652938837*b-.176491792462875)+v*(-.000778269941513683*v+.00130872261408275*p+.000770482631801132*b-.151051492775562)+p*(.00126935368114843*p-.00265090189010898*b+.25802910206845)+b*(-.000318913117588328*b-.213742400323665),l[S++]=y*(-.000570115196973677*y-263409051004589e-19*v+.0020741088115012*p-.00288260236853442*b+.814272968359295)-20.810012546947+v*(-153496057440975e-19*v-.000132689043961446*p+.000560833691242812*b-.195152027534049)+p*(.00174418132927582*p-.00255243321439347*b+.116935020465145)+b*(-.000343531996510555*b+.24165260232407);return l},_convertYcckToCmyk:function(l){for(var p,y,v,b=0,S=l.length;b<S;b+=4)p=l[b],y=l[b+1],v=l[b+2],l[b]=434.456-p-1.402*v,l[b+1]=119.541-p+.344*y+.714*v,l[b+2]=481.816-p-1.772*y;return l},_convertCmykToRgb:function(l){for(var p,y,v,b,S=0,T=1/255,k=0,I=l.length;k<I;k+=4)p=l[k]*T,y=l[k+1]*T,v=l[k+2]*T,b=l[k+3]*T,l[S++]=255+p*(-4.387332384609988*p+54.48615194189176*y+18.82290502165302*v+212.25662451639585*b-285.2331026137004)+y*(1.7149763477362134*y-5.6096736904047315*v-17.873870861415444*b-5.497006427196366)+v*(-2.5217340131683033*v-21.248923337353073*b+17.5119270841813)-b*(21.86122147463605*b+189.48180835922747),l[S++]=255+p*(8.841041422036149*p+60.118027045597366*y+6.871425592049007*v+31.159100130055922*b-79.2970844816548)+y*(-15.310361306967817*y+17.575251261109482*v+131.35250912493976*b-190.9453302588951)+v*(4.444339102852739*v+9.8632861493405*b-24.86741582555878)-b*(20.737325471181034*b+187.80453709719578),l[S++]=255+p*(.8842522430003296*p+8.078677503112928*y+30.89978309703729*v-.23883238689178934*b-14.183576799673286)+y*(10.49593273432072*y+63.02378494754052*v+50.606957656360734*b-112.23884253719248)+v*(.03296041114873217*v+115.60384449646641*b-193.58209356861505)-b*(22.33816807309886*b+180.12613974708367);return l},getData:function(l,p,y){if(this.numComponents>4)throw new e("Unsupported color mode");var v=this._getLinearizedBlockData(l,p);if(this.numComponents===1&&y){for(var b=v.length,S=new Uint8ClampedArray(3*b),T=0,k=0;k<b;k++){var I=v[k];S[T++]=I,S[T++]=I,S[T++]=I}return S}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(v);if(this.numComponents===4){if(this._isColorConversionNeeded())return y?this._convertYcckToRgb(v):this._convertYcckToCmyk(v);if(y)return this._convertCmykToRgb(v)}return v}},a}()},(Et=Dt())!==void 0&&(At.exports=Et);const zt=$t(et.exports);let br=class{static decode(t,r=!1){const i=new Uint8Array(t),s=new zt;s.parse(i);const{width:n,height:h,numComponents:o,eof:c}=s,u=s.getData(n,h,!0),a=n*h;let g,f=null,d=0,w=0,m=0;if(!r&&c<i.length-1)try{const C=new Ge(i.subarray(c)).getBytes();f=new Uint8Array(a);let l=0;for(d=0;d<C.length;d++)for(m=7;m>=0;m--)f[l++]=C[d]>>m&1}catch{}if(o===1&&u.length===n*h){const C=new Uint8Array(u.buffer);g=[C,C,C]}else{for(g=[],d=0;d<3;d++)g.push(new Uint8Array(a));for(m=0,w=0;w<a;w++)for(d=0;d<3;d++)g[d][w]=u[m++]}return{width:n,height:h,pixels:g,mask:f}}};const Wt=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let Je=null;function Ht(){return Je||(Je=hr(()=>import("./lerc-wasm-fd5c862b.js"),["assets/lerc-wasm-fd5c862b.js","assets/index-6e11f365.js","assets/index-001d3307.css"]).then(e=>e.l).then(({default:e})=>e({locateFile:t=>fr(`esri/layers/support/rasterFormats/${t}`)})).then(e=>{Sr(e)}),Je)}const je={getBlobInfo:null,decode:null};function Tr(e){return 16+(e>>3<<3)}function de(e,t,r){r.set(e.slice(t,t+r.length))}function Sr(e){const{_malloc:t,_free:r,_lerc_getBlobInfo:i,_lerc_getDataRanges:s,_lerc_decode_4D:n,asm:h}=e;let o;const c=Object.values(h).find(a=>a&&"buffer"in a&&a.buffer===e.HEAPU8.buffer),u=a=>{const g=a.map(m=>Tr(m)),f=g.reduce((m,C)=>m+C),d=t(f);o=new Uint8Array(c.buffer);let w=g[0];g[0]=d;for(let m=1;m<g.length;m++){const C=g[m];g[m]=g[m-1]+w,w=C}return g};je.getBlobInfo=a=>{const d=new Uint8Array(48),w=new Uint8Array(8*3),[m,C,l]=u([a.length,d.length,w.length]);o.set(a,m),o.set(d,C),o.set(w,l);let p=i(m,a.length,C,l,12,3);if(p)throw r(m),new Error(`lerc-getBlobInfo: error code is ${p}`);o=new Uint8Array(c.buffer),de(o,C,d),de(o,l,w);const y=new Uint32Array(d.buffer),v=new Float64Array(w.buffer),[b,S,,T,k,I,A,x,D,E,G]=y,L={version:b,depthCount:E,width:T,height:k,validPixelCount:A,bandCount:I,blobSize:x,maskCount:D,dataType:S,minValue:v[0],maxValue:v[1],maxZerror:v[2],statistics:[],bandCountWithNoData:G};if(G)return L;if(E===1&&I===1)return r(m),L.statistics.push({minValue:v[0],maxValue:v[1]}),L;const U=E*I*8,R=new Uint8Array(U),z=new Uint8Array(U);let _=m,P=0,W=0,F=!1;if(o.byteLength<m+2*U?(r(m),F=!0,[_,P,W]=u([a.length,U,U]),o.set(a,_)):[P,W]=u([U,U]),o.set(R,P),o.set(z,W),p=s(_,a.length,E,I,P,W),p)throw r(_),F||r(P),new Error(`lerc-getDataRanges: error code is ${p}`);o=new Uint8Array(c.buffer),de(o,P,R),de(o,W,z);const N=new Float64Array(R.buffer),$=new Float64Array(z.buffer),J=L.statistics;for(let oe=0;oe<I;oe++)if(E>1){const Se=N.slice(oe*E,(oe+1)*E),ke=$.slice(oe*E,(oe+1)*E),ce=Math.min.apply(null,Se),ne=Math.max.apply(null,ke);J.push({minValue:ce,maxValue:ne,depthStats:{minValues:Se,maxValues:ke}})}else J.push({minValue:N[oe],maxValue:$[oe]});return r(_),F||r(P),L},je.decode=(a,g)=>{const{maskCount:f,depthCount:d,bandCount:w,width:m,height:C,dataType:l,bandCountWithNoData:p}=g,y=Wt[l],v=m*C,b=new Uint8Array(v*w),S=v*d*w*y.size,T=new Uint8Array(S),k=new Uint8Array(w),I=new Uint8Array(8*w),[A,x,D,E,G]=u([a.length,b.length,T.length,k.length,I.length]);o.set(a,A),o.set(b,x),o.set(T,D),o.set(k,E),o.set(I,G);const L=n(A,a.length,f,x,d,m,C,w,l,D,E,G);if(L)throw r(A),new Error(`lerc-decode: error code is ${L}`);o=new Uint8Array(c.buffer),de(o,D,T),de(o,x,b);let U=null;if(p){de(o,E,k),de(o,G,I),U=[];const R=new Float64Array(I.buffer);for(let z=0;z<k.length;z++)U.push(k[z]?R[z]:null)}return r(A),{data:T,maskData:b,noDataValues:U}}}function kr(e,t,r,i,s){if(r<2)return e;const n=new i(t*r);if(s)for(let h=0,o=0;h<t;h++)for(let c=0,u=h;c<r;c++,u+=t)n[u]=e[o++];else for(let h=0,o=0;h<t;h++)for(let c=0,u=h;c<r;c++,u+=t)n[o++]=e[u];return n}function Yt(e,t={}){const r=t.inputOffset??0,i=e instanceof Uint8Array?e.subarray(r):new Uint8Array(e,r),s=je.getBlobInfo(i),{data:n,maskData:h,noDataValues:o}=je.decode(i,s),{width:c,height:u,bandCount:a,depthCount:g,dataType:f,maskCount:d,statistics:w}=s,m=Wt[f],C=new m.ctor(n.buffer),l=[],p=[],y=c*u,v=y*g;for(let A=0;A<a;A++){const x=C.subarray(A*v,(A+1)*v);if(t.returnInterleaved)l.push(x);else{const D=kr(x,y,g,m.ctor,!0);l.push(D)}p.push(h.subarray(A*v,(A+1)*v))}const b=d===0?null:d===1?p[0]:new Uint8Array(y);if(d>1){b.set(p[0]);for(let A=1;A<p.length;A++){const x=p[A];for(let D=0;D<y;D++)b[D]=b[D]&x[D]}}const{noDataValue:S}=t,T=S!=null&&m.range[0]<=S&&m.range[1]>=S;if(d>0&&T)for(let A=0;A<a;A++){const x=l[A],D=p[A]||b;for(let E=0;E<y;E++)D[E]===0&&(x[E]=S)}const k=d===a&&a>1?p:null,{pixelType:I}=m;return{width:c,height:u,bandCount:a,pixelType:I,depthCount:g,statistics:w,pixels:l,mask:b,bandMasks:k,noDataValues:o}}function Ir(e,t,r,i=!0){if(t%4!=0||r%4!=0){const s=new ArrayBuffer(4*Math.ceil(r/4)),n=new Uint8Array(s),h=new Uint8Array(e,t,r);if(i)for(let o=0;o<n.length;o+=4)n[o]=h[o+3],n[o+1]=h[o+2],n[o+2]=h[o+1],n[o+3]=h[o];else n.set(h);return new Uint32Array(n.buffer)}if(i){const s=new Uint8Array(e,t,r),n=new Uint8Array(s.length);for(let h=0;h<n.length;h+=4)n[h]=s[h+3],n[h+1]=s[h+2],n[h+2]=s[h+1],n[h+3]=s[h];return new Uint32Array(n.buffer)}return new Uint32Array(e,t,r/4)}function Pt(){const e=[];for(let t=0;t<=257;t++)e[t]=[t];return e}function Rt(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}const Ie=new Set;function ht(e,t,r,i=!0){const s=Ir(e,t,r,i);let n=9,h=Pt(),o=32,c=h.length,u=[],a=1,g=s[0],f=0;const d=s.length,w=8*(4*d-r),m=[];for(;g!=null;){if(o>=n)o-=n,f=g>>>32-n,g<<=n;else{f=g>>>32-o,g=s[a++];const l=n-o;o=32-l,f=(f<<l)+(g>>>o),g<<=l}if(f===257)break;if(f===256){n=9,h=Pt(),c=h.length,u=[];continue}const C=h[f];if(C==null){if(f>h.length)throw new Error("data integrity issue: code does not exist on code page");u.push(u[0]),h[c++]=u.slice(),Rt(m,u)}else Rt(m,C),u.push(C[0]),u.length>1&&(h[c++]=u.slice()),u=C.slice();if(Ie.has(c)&&n++,o===0&&(g=s[a++],o=32),a>d||a===d&&o<=w)break}return new Uint8Array(m)}Ie.add(511),Ie.add(1023),Ie.add(2047),Ie.add(4095),Ie.add(8191);const Lt=(e,t)=>{const r=t.width*t.height,i=t.pixelType;return Math.floor(e.byteLength/(r*Kt(i)))},Kt=e=>{let t=1;switch(e){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t},xr=(e,t)=>{if(8*e.byteLength<t)return null;const r=new Uint8Array(e,0,Math.ceil(t/8)),i=new Uint8Array(t);let s=0,n=0,h=0,o=0;for(h=0;h<r.length-1;h++)for(n=r[h],o=7;o>=0;o--)i[s++]=n>>o&1;for(o=7;s<t-1;)n=r[r.length-1],i[s++]=n>>o&1,o--;return i};let Ar=class{static decode(t,r){const i=r.pixelType,s=[],n=r.width*r.height,h=Lt(t,r),{bandIds:o,format:c}=r,u=o&&o.length||Lt(t,r),a=t.byteLength-t.byteLength%(n*Kt(i)),g=new i(t,0,n*h);let f,d,w,m,C=null;if(c==="bip")for(f=0;f<u;f++){for(w=new i(n),m=o?o[f]:f,d=0;d<n;d++)w[d]=g[d*h+m];s.push(w)}else if(c==="bsq")for(f=0;f<u;f++)m=o?o[f]:f,s.push(g.subarray(m*n,(m+1)*n));return a<t.byteLength-1&&(C=xr(t.slice(a),n)),{pixels:s,mask:C}}};function Dr(e,t){let r=0,i="",s=0,n=0;const h=e.length;for(;r<h;)n=e[r++],s=n>>4,s<8?s=1:s===15?(s=4,n=(7&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++]):s===14?(s=3,n=(15&n)<<12|(63&e[r++])<<6|63&e[r++]):(s=2,n=(31&n)<<6|63&e[r++]),(n!==0||t)&&(i+=String.fromCharCode(n));return i}const ft=(()=>{const e=[];return e[254]="NEWSUBFILETYPE",e[255]="SUBFILETYPE",e[256]="IMAGEWIDTH",e[257]="IMAGELENGTH",e[258]="BITSPERSAMPLE",e[259]="COMPRESSION",e[262]="PHOTOMETRICINTERPRETATION",e[263]="THRESHHOLDING",e[264]="CELLWIDTH",e[265]="CELLLENGTH",e[266]="FILLORDER",e[269]="DOCUMENTNAME",e[270]="IMAGEDESCRIPTION",e[271]="MAKE",e[272]="MODEL",e[273]="STRIPOFFSETS",e[274]="ORIENTATION",e[277]="SAMPLESPERPIXEL",e[278]="ROWSPERSTRIP",e[279]="STRIPBYTECOUNTS",e[280]="MINSAMPLEVALUE",e[281]="MAXSAMPLEVALUE",e[282]="XRESOLUTION",e[283]="YRESOLUTION",e[284]="PLANARCONFIGURATION",e[285]="PAGENAME",e[286]="XPOSITION",e[287]="YPOSITION",e[288]="FREEOFFSETS",e[289]="FREEBYTECOUNTS",e[290]="GRAYRESPONSEUNIT",e[291]="GRAYRESPONSECURVE",e[292]="T4OPTIONS",e[293]="T6OPTIONS",e[296]="RESOLUTIONUNIT",e[297]="PAGENUMBER",e[300]="COLORRESPONSEUNIT",e[301]="TRANSFERFUNCTION",e[305]="SOFTWARE",e[306]="DATETIME",e[315]="ARTIST",e[316]="HOSTCOMPUTER",e[317]="PREDICTOR",e[318]="WHITEPOINT",e[319]="PRIMARYCHROMATICITIES",e[320]="COLORMAP",e[321]="HALFTONEHINTS",e[322]="TILEWIDTH",e[323]="TILELENGTH",e[324]="TILEOFFSETS",e[325]="TILEBYTECOUNTS",e[326]="BADFAXLINES",e[327]="CLEANFAXDATA",e[328]="CONSECUTIVEBADFAXLINES",e[330]="SUBIFD",e[332]="INKSET",e[333]="INKNAMES",e[334]="NUMBEROFINKS",e[336]="DOTRANGE",e[337]="TARGETPRINTER",e[338]="EXTRASAMPLES",e[339]="SAMPLEFORMAT",e[340]="SMINSAMPLEVALUE",e[341]="SMAXSAMPLEVALUE",e[342]="TRANSFERRANGE",e[347]="JPEGTABLES",e[512]="JPEGPROC",e[513]="JPEGIFOFFSET",e[514]="JPEGIFBYTECOUNT",e[515]="JPEGRESTARTINTERVAL",e[517]="JPEGLOSSLESSPREDICTORS",e[518]="JPEGPOINTTRANSFORM",e[519]="JPEGQTABLES",e[520]="JPEGDCTABLES",e[521]="JPEGACTABLES",e[529]="YCBCRCOEFFICIENTS",e[530]="YCBCRSUBSAMPLING",e[531]="YCBCRPOSITIONING",e[532]="REFERENCEBLACKWHITE",e[700]="XMP",e[33550]="GEOPIXELSCALE",e[33922]="GEOTIEPOINTS",e[33432]="COPYRIGHT",e[42112]="GDAL_METADATA",e[42113]="GDAL_NODATA",e[50844]="RPCCOEFFICIENT",e[34264]="GEOTRANSMATRIX",e[34735]="GEOKEYDIRECTORY",e[34736]="GEODOUBLEPARAMS",e[34737]="GEOASCIIPARAMS",e[34665]="EXIFIFD",e[34853]="GPSIFD",e[40965]="INTEROPERABILITYIFD",e})(),Er=(()=>{const e=ft.slice();return e[36864]="ExifVersion",e[40960]="FlashpixVersion",e[40961]="ColorSpace",e[42240]="Gamma",e[37121]="ComponentsConfiguration",e[37122]="CompressedBitsPerPixel",e[40962]="PixelXDimension",e[40963]="PixelYDimension",e[37500]="MakerNote",e[37510]="UserComment",e[40964]="RelatedSoundFile",e[36867]="DateTimeOriginal",e[36868]="DateTimeDigitized",e[36880]="OffsetTime",e[36881]="OffsetTimeOriginal",e[36882]="OffsetTimeDigitized",e[37520]="SubSecTime",e[37521]="SubSecTimeOriginal",e[37522]="SubSecTimeDigitized",e[37888]="Temperature",e[37889]="Humidity",e[37890]="Pressure",e[37891]="WaterDepth",e[37892]="Acceleration",e[37893]="CameraElevationAngle",e[42016]="ImageUniqueID",e[42032]="CameraOwnerName",e[42033]="BodySerialNumber",e[42034]="LensSpecification",e[42035]="LensMake",e[42036]="LensModel",e[42037]="LensSerialNumber",e[33434]="ExposureTime",e[33437]="FNumber",e[34850]="ExposureProgram",e[34852]="SpectralSensitivity",e[34855]="PhotographicSensitivity",e[34856]="OECF",e[34864]="SensitivityType",e[34865]="StandardOutputSensitivity",e[34866]="RecommendedExposureIndex",e[34867]="ISOSpeed",e[34868]="ISOSpeedLatitudeyyy",e[34869]="ISOSpeedLatitudezzz",e[37377]="ShutterSpeedValue",e[37378]="ApertureValue",e[37379]="BrightnessValue",e[37380]="ExposureBiasValue",e[37381]="MaxApertureValue",e[37382]="SubjectDistance",e[37383]="MeteringMode",e[37384]="LightSource",e[37385]="Flash",e[37386]="FocalLength",e[37396]="SubjectArea",e[41483]="FlashEnergy",e[41484]="SpatialFrequencyResponse",e[41486]="FocalPlaneXResolution",e[41487]="FocalPlaneYResolution",e[41488]="FocalPlaneResolutionUnit",e[41492]="SubjectLocation",e[41493]="ExposureIndex",e[41495]="SensingMethod",e[41728]="FileSource",e[41729]="SceneType",e[41730]="CFAPattern",e[41985]="CustomRendered",e[41986]="ExposureMode",e[41987]="WhiteBalance",e[41988]="DigitalZoomRatio",e[41989]="FocalLengthIn35mmFilm",e[41990]="SceneCaptureType",e[41991]="GainControl",e[41992]="Contrast",e[41993]="Saturation",e[41994]="Sharpness",e[41995]="DeviceSettingDescription",e[41996]="SubjectDistanceRange",e})(),Pr=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],Rr=(()=>{const e=[];return e[1024]="GTModelTypeGeoKey",e[1025]="GTRasterTypeGeoKey",e[1026]="GTCitationGeoKey",e[2048]="GeographicTypeGeoKey",e[2049]="GeogCitationGeoKey",e[2050]="GeogGeodeticDatumGeoKey",e[2051]="GeogPrimeMeridianGeoKey",e[2052]="GeogLinearUnitsGeoKey",e[2053]="GeogLinearUnitSizeGeoKey",e[2054]="GeogAngularUnitsGeoKey",e[2055]="GeogAngularUnitSizeGeoKey",e[2056]="GeogEllipsoidGeoKey",e[2057]="GeogSemiMajorAxisGeoKey",e[2058]="GeogSemiMinorAxisGeoKey",e[2059]="GeogInvFlatteningGeoKey",e[2061]="GeogPrimeMeridianLongGeoKey",e[2060]="GeogAzimuthUnitsGeoKey",e[3072]="ProjectedCSTypeGeoKey",e[3073]="PCSCitationGeoKey",e[3074]="ProjectionGeoKey",e[3075]="ProjCoordTransGeoKey",e[3076]="ProjLinearUnitsGeoKey",e[3077]="ProjLinearUnitSizeGeoKey",e[3078]="ProjStdParallel1GeoKey",e[3079]="ProjStdParallel2GeoKey",e[3080]="ProjNatOriginLongGeoKey",e[3081]="ProjNatOriginLatGeoKey",e[3082]="ProjFalseEastingGeoKey",e[3083]="ProjFalseNorthingGeoKey",e[3084]="ProjFalseOriginLongGeoKey",e[3085]="ProjFalseOriginLatGeoKey",e[3086]="ProjFalseOriginEastingGeoKey",e[3087]="ProjFalseOriginNorthingGeoKey",e[3088]="ProjCenterLongGeoKey",e[3090]="ProjCenterEastingGeoKey",e[3091]="ProjCenterNorthingGeoKey",e[3092]="ProjScaleAtNatOriginGeoKey",e[3093]="ProjScaleAtCenterGeoKey",e[3094]="ProjAzimuthAngleGeoKey",e[3095]="ProjStraightVertPoleLongGeoKey",e[4096]="VerticalCSTypeGeoKey",e[4097]="VerticalCitationGeoKey",e[4098]="VerticalDatumGeoKey",e[4099]="VerticalUnitsGeoKey",e})(),Lr=(e,t)=>{let r=(t||ft)[e];return r===void 0&&(r="unknown"+String(e)),r},tt=new Map;tt.set("EXIFIFD",Er),tt.set("GPSIFD",Pr);const Ae={TIFF_TAGS:ft,ifdTags:tt,GEO_KEYS:Rr,getTagName:Lr},dt=(()=>{const e=new ArrayBuffer(4),t=new Uint8Array(e);return new Uint32Array(e)[0]=1,t[0]===1})(),Bt=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],De=4294967296,Br=new Set([1,5,6,7,8,34712,34887]);function pt(e,t){let r="unknown";return e===3?r=t===64?"f64":"f32":e===1?t===1?r="u1":t===2?r="u2":t===4?r="u4":t<=8?r="u8":t<=16?r="u16":t<=32&&(r="u32"):e===2&&(t<=8?r="s8":t<=16?r="s16":t<=32&&(r="s32")),r}function ze(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f64":t=Float64Array;break;default:t=Float32Array}return t}function Mr(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function Jt(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function be(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function Mt(e,t){var r,i;return(i=(r=e.get(t))==null?void 0:r.values)==null?void 0:i[0]}function V(e,t){var r,i;return(i=(r=e.get(t))==null?void 0:r.values)==null?void 0:i[0]}function qe(e,t,r,i=0,s=Ae.TIFF_TAGS,n=4){const h=n===8,o=h?yt(new DataView(e,r,8),0,t):new DataView(e,r,2).getUint16(0,t),c=4+2*n,u=h?8:2,a=u+o*c;if(r+a>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:a};const g=r+a+4<=e.byteLength?$e(new DataView(e,r+a,n===8?8:4),0,t,n===8):null,f=r+u,d=new Map;let w,m,C,l,p,y=0,v=0;for(let b=0;b<o;b++){m=new DataView(e,f+c*b,c),C=m.getUint16(0,t),p=m.getUint16(2,t),l=Ae.getTagName(C,s);const S=[];n===2?(y=m.getUint16(4,t),v=m.getUint16(6,t)):n===4?(y=m.getUint32(4,t),v=m.getUint32(8,t)):n===8&&(y=$e(m,4,t,!0),v=$e(m,12,t,!0),S.push(m.getUint32(12,t)),S.push(m.getUint32(16,t))),w={id:C,type:p,valueCount:y,valueOffset:v,valueOffsets:S,values:null},Fr(e,t,w,i,!1,n),d.set(l,w)}return{success:!0,ifd:d,nextIFD:g,requiredBufferSize:a}}const Gr=(e,t)=>Yt(e,{inputOffset:t}).pixels[0];function rt(e,t){if(t!==1&&t!==2&&t!==4)return e;const r=new Uint8Array(e),i=8/t,s=new Uint8Array(e.byteLength*i);let n=0;const h=2**t-1;for(let o=0;o<r.length;o++){const c=r[o];for(let u=0;u<i;u++)s[n++]=c<<t*u>>>8-t&h}return s.buffer}function ot(e,t,r){const i=new zt;i.parse(e),i.colorTransform=r===6?-1:0;const s=i.getData(i.width,i.height,t!==1);return new Uint8Array(s.buffer)}function it(e){const t=new Ge(e).getBytes(),r=new ArrayBuffer(t.length),i=new Uint8Array(r);return i.set(t),i}async function nt(e,t,r,i,s){const n=dt===t,h=V(r,"BITSPERSAMPLE"),o=V(r,"SAMPLESPERPIXEL"),c=V(r,"PHOTOMETRICINTERPRETATION"),u=pt(V(r,"SAMPLEFORMAT")??1,h),a=V(r,"COMPRESSION")??1,g=ze(u);let f,d,w;if(a===34887)return await Ht(),Gr(e,i);if(a===1)f=e.slice(i,i+s),d=new Uint8Array(f);else if(a===8||a===32946)d=new Uint8Array(e,i,s),d=it(d),f=d.buffer;else if(a===6)d=new Uint8Array(e,i,s),d=ot(d,o,c),f=d.buffer;else if(a===7){const m=r.get("JPEGTABLES").values,C=m.length-2;d=new Uint8Array(C+s-2);for(let p=0;p<C;p++)d[p]=m[p];const l=new Uint8Array(e,i+2,s-2);for(let p=0;p<l.length;p++)d[C+p]=l[p];d=ot(d,o,c),f=d.buffer}else{if(a!==5)throw new Error("tiff-decode: unsupport compression "+a);d=ht(e,i,s,t),f=d.buffer}if(f=rt(f,h),u==="u8"||u==="s8"||n)w=new g(f);else{f=new ArrayBuffer(d.length);const m=new Uint8Array(f);switch(u){case"u16":case"s16":for(let C=0;C<d.length;C+=2)m[C]=d[C+1],m[C+1]=d[C];break;case"u32":case"s32":case"f32":for(let C=0;C<d.length;C+=4)m[C]=d[C+3],m[C+1]=d[C+2],m[C+2]=d[C+1],m[C+3]=d[C]}w=new g(f)}return w}async function Or(e,t,r){const i=be(r,"TILEOFFSETS");if(i===void 0)return null;const s=be(r,"TILEBYTECOUNTS"),{width:n,height:h,pixelType:o,tileWidth:c,tileHeight:u}=mt([r]),a=gt(r,t),g=V(r,"SAMPLESPERPIXEL")||t.planes,f=n*h,d=V(r,"BITSPERSAMPLE"),w=(V(r,"COMPRESSION")??1)===34887,m=ze(o),C=[];for(let L=0;L<g;L++)C.push(new m(f));let l,p,y,v,b,S,T,k,I,A,x,D,E;const G=Math.ceil(n/c);if(d%8==0){if(w&&a&&g>1){const L=Math.round(i.length/g);for(l=0;l<L;l++){S=Math.floor(l/G)*u,T=l%G*c,k=S*n+T;for(let U=0;U<g;U++){const R=l*g+U;if(s[R]!==0)for(y=await nt(e,t.littleEndian,r,i[R],s[R]),A=0,I=k,D=Math.min(c,n-T),x=Math.min(u,h-S),E=C[U],v=0;v<x;v++)for(I=k+v*n,A=v*c,b=0;b<D;b++,I++,A++)E[I]=y[A]}}}else for(l=0;l<i.length;l++)if(s[l]!==0)for(S=Math.floor(l/G)*u,T=l%G*c,k=S*n+T,y=await nt(e,t.littleEndian,r,i[l],s[l]),A=0,I=k,D=Math.min(c,n-T),x=Math.min(u,h-S),p=0;p<g;p++)if(E=C[p],a||w)for(v=0;v<x;v++)for(I=k+v*n,A=c*u*p+v*c,b=0;b<D;b++,I++,A++)E[I]=y[A];else for(v=0;v<x;v++)for(I=k+v*n,A=v*c*g+p,b=0;b<D;b++,I++,A+=g)E[I]=y[A]}return{width:n,height:h,pixelType:o,pixels:C}}const _r=(e,t,r)=>{const i=dt===t.littleEndian,s=be(r,"STRIPOFFSETS");if(s===void 0)return null;const{width:n,height:h,pixelType:o}=mt([r]),c=V(r,"SAMPLESPERPIXEL")||t.planes,u=V(r,"PHOTOMETRICINTERPRETATION"),a=n*h,g=V(r,"BITSPERSAMPLE"),f=ze(o),d=new f(a*c),w=be(r,"STRIPBYTECOUNTS"),m=V(r,"ROWSPERSTRIP"),C=V(r,"COMPRESSION")??1;let l,p,y,v,b,S,T,k,I,A=m;if(g%8==0)for(l=0;l<s.length;l++){if(b=l*(m*n)*c,A=(l+1)*m>h?h-l*m:m,o==="u8"||o==="s8"||i)C===8||C===32946?(T=new Uint8Array(e,s[l],w[l]),T=it(T),S=T.buffer):C===6?(T=new Uint8Array(e,s[l],w[l]),T=ot(T,c,u),S=T.buffer):C===5?(T=ht(e,s[l],w[l],t.littleEndian),S=T.buffer):(w[l]!==A*n*c*g/8&&console.log("strip byte counts is different than expected"),S=e.slice(s[l],s[l]+w[l])),S=rt(S,g),v=new f(S);else{switch(C===6||C===8||C===32946?(T=new Uint8Array(e,s[l],w[l]),k=it(T),S=k.buffer):(w[l]!==A*n*c*g/8&&console.log("strip byte counts is different than expected"),S=new ArrayBuffer(w[l]),T=new Uint8Array(e,s[l],w[l]),k=new Uint8Array(S)),o){case"u16":case"s16":for(y=0;y<T.length;y+=2)k[y]=T[y+1],k[y+1]=T[y];break;case"u32":case"s32":case"f32":for(y=0;y<T.length;y+=4)k[y]=T[y+3],k[y+1]=T[y+2],k[y+2]=T[y+1],k[y+3]=T[y]}S=rt(S,g),v=new f(S)}d.set(v,b)}const x=[];if(c===1)x.push(d);else for(l=0;l<c;l++){for(I=new f(a),p=0;p<a;p++)I[p]=d[p*c+l];x.push(I)}return{width:n,height:h,pixelType:o,pixels:x}},Ur=(e,t,r)=>{if(!(e&&e.length>0&&t&&r))return null;let i,s,n;const h=e[0].length,o=e.length,c=new Uint8Array(h);for(let u=0;u<o;u++)if(i=e[u],s=t[u],n=r[u],u===0)for(let a=0;a<h;a++)c[a]=i[a]<s||i[a]>n?0:1;else for(let a=0;a<h;a++)c[a]&&(c[a]=i[a]<s||i[a]>n?0:1);return c},Nr=e=>{if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||t.length===0)return null;const r=new Map;let i,s,n,h,o;for(let l=0;l<t.length;l++)i=t[l],s=i.slice(6,i.indexOf(">")),h=i.indexOf("sample="),h>-1&&(o=i.slice(h+8,i.indexOf('"',h+8))),h=i.indexOf("name="),h>-1&&(s=i.slice(h+6,i.indexOf('"',h+6))),s&&(n=i.slice(i.indexOf(">")+1,i.indexOf("</Item>")).trim(),o!=null?r.has(s)?r.get(s)[o]=n:r.set(s,[n]):r.set(s,n)),o=null;const c=r.get("STATISTICS_MINIMUM"),u=r.get("STATISTICS_MAXIMUM"),a=r.get("STATISTICS_MEAN"),g=r.get("STATISTICS_STDDEV");let f=null;if(c&&u){f=[];for(let l=0;l<c.length;l++)f.push({min:parseFloat(c[l]),max:parseFloat(u[l]),avg:a&&parseFloat(a[l]),stddev:g&&parseFloat(g[l])})}const d=r.get("BandName"),w=r.get("WavelengthMin"),m=r.get("WavelengthMax");let C=null;if(d){C=[];for(let l=0;l<d.length;l++)C.push({BandName:d[l],WavelengthMin:w&&parseFloat(w[l]),WavelengthMax:m&&parseFloat(m[l])})}return{statistics:f,bandProperties:C,dataType:r.get("DataType"),rawMetadata:r}};function Fr(e,t,r,i=0,s=!1,n=4){if(r.values)return!0;const h=r.type,o=r.valueCount;let c=r.valueOffset,u=[];const a=Bt[h],g=8*a,f=o*a,d=o*Bt[h]*8;let w,m;const C=n===8?64:32,l=r.valueOffsets;if(d>C&&f>(s?e.byteLength:e?e.byteLength-c+i:0))return r.offlineOffsetSize=[c,f],r.values=null,!1;if(d<=C){if(!t)if(C<=32)c>>>=32-d;else{const p=l!=null&&l.length?l[0]:c>>>0,y=l!=null&&l.length?l[1]:Math.round((c-p)/De);d<=32?(c=p>>>32-d,l[0]=c):(c=p*2**(32-d)+(y>>>32-d),l[0]=p,l[1]=y>>>32-d)}if(o===1&&g===C)u=[c];else if(C===64){const p=l!=null&&l.length?l[0]:c>>>0,y=l!=null&&l.length?l[1]:Math.round((c-p)/De);let v=p,b=32;for(m=1;m<=o;m++){const S=32-g*m%32;if(b<g){const T=v<<S>>>32-b,k=y<<32-b>>>32-b;v=y,u.push(T+k*2**(g-b)),b-=32-(g-b)}else u.push(v<<S>>>32-g),b-=g;b===0&&(b=32,v=y)}}else for(m=1;m<=o;m++){const p=32-g*m;u.push(c<<p>>>32-g)}}else{c-=i,s&&(c=0);for(let p=c;p<c+f;p+=a){switch(h){case 1:case 2:case 7:w=new DataView(e,p,1).getUint8(0);break;case 3:w=new DataView(e,p,2).getUint16(0,t);break;case 4:case 13:w=new DataView(e,p,4).getUint32(0,t);break;case 5:w=new DataView(e,p,4).getUint32(0,t)/new DataView(e,p+4,4).getUint32(0,t);break;case 6:w=new DataView(e,p,1).getInt8(0);break;case 8:w=new DataView(e,p,2).getInt16(0,t);break;case 9:w=new DataView(e,p,4).getInt32(0,t);break;case 10:w=new DataView(e,p,4).getInt32(0,t)/new DataView(e,p+4,4).getInt32(0,t);break;case 11:w=new DataView(e,p,4).getFloat32(0,t);break;case 12:w=new DataView(e,p,8).getFloat64(0,t);break;case 16:case 18:w=yt(new DataView(e,p,8),0,t);break;case 17:w=Vr(new DataView(e,p,8),0,t);break;default:w=null}u.push(w)}}if(h===2){let p="";const y=u;for(u=[],m=0;m<y.length;m++)y[m]===0&&p!==""?(u.push(p),p=""):p+=String.fromCharCode(y[m]);p===""&&u.length!==0||u.push(p)}return r.values=u,!0}function mt(e){const t=e[0],r=V(t,"TILEWIDTH"),i=V(t,"TILELENGTH"),s=V(t,"IMAGEWIDTH"),n=V(t,"IMAGELENGTH"),h=V(t,"BITSPERSAMPLE"),o=V(t,"SAMPLESPERPIXEL"),c=V(t,"SAMPLEFORMAT")??1,u=pt(c,h),a=gt(t),g=Jt(t,"GDAL_NODATA");let f=null;g!=null&&g.length&&(f=g.map(_=>parseFloat(_)),f.some(_=>isNaN(_))&&(f=null));const d=V(t,"COMPRESSION")??1;let w;switch(d){case 1:w="NONE";break;case 2:case 3:case 4:case 32771:w="CCITT";break;case 5:w="LZW";break;case 6:case 7:w="JPEG";break;case 32773:w="PACKBITS";break;case 8:case 32946:w="DEFLATE";break;case 34712:w="JPEG2000";break;case 34887:w="LERC";break;default:w=String(d)}let m=!0,C="";Br.has(d)||(m=!1,C+="unsupported tag compression "+d),c>3&&(m=!1,C+="unsupported tag sampleFormat "+c),h!==1&&h!==2&&h!==4&&h%8!=0&&(m=!1,C+="unsupported tag bitsPerSample "+h);const l=Mt(t,"GEOASCIIPARAMS");let p;if(l){const _=l.split("|").find(W=>W.includes("ESRI PE String = ")),P=_?_.replace("ESRI PE String = ",""):"";p=P.startsWith("COMPD_CS")||P.startsWith("PROJCS")||P.startsWith("GEOGCS")?{wkid:null,wkt:P}:null}const y=be(t,"GEOTIEPOINTS"),v=be(t,"GEOPIXELSCALE"),b=be(t,"GEOTRANSMATRIX"),S=t.has("GEOKEYDIRECTORY")?t.get("GEOKEYDIRECTORY").data:null;let T,k,I=!1,A=!1;if(S){I=V(S,"GTRasterTypeGeoKey")===2;const _=V(S,"GTModelTypeGeoKey");if(_===2){const P=V(S,"GeographicTypeGeoKey");P>=1024&&P<=32766&&(p={wkid:P}),p||P!==32767||(A=!0,p={wkid:4326})}else if(_===1){const P=V(S,"ProjectedCSTypeGeoKey");P>=1024&&P<=32766&&(p={wkid:P})}}if(v&&y&&y.length>=6?(T=[v[0],0,y[3]-y[0]*v[0],0,-Math.abs(v[1]),y[4]-y[1]*v[1]],I&&(T[2]-=.5*T[0]+.5*T[1],T[5]-=.5*T[3]+.5*T[4])):b&&b.length===16&&(T=I?[b[0],b[1],b[3]-.5*b[0],b[4],b[5],b[7]-.5*b[5]]:[b[0],b[1],b[3],b[4],b[5],b[7]]),T){const _=[{x:0,y:n},{x:0,y:0},{x:s,y:n},{x:s,y:0}];let P,W=Number.POSITIVE_INFINITY,F=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY,$=Number.NEGATIVE_INFINITY;for(let J=0;J<_.length;J++)P=Mr(_[J],T),W=P.x>W?W:P.x,N=P.x<N?N:P.x,F=P.y>F?F:P.y,$=P.y<$?$:P.y;k={xmin:W,xmax:N,ymin:F,ymax:$,spatialReference:p}}else k={xmin:-.5,ymin:.5-n,xmax:s-.5,ymax:.5,spatialReference:p};A&&(k.xmax-k.xmin>400||Math.max(Math.abs(k.xmin),Math.abs(k.xmax))>361)&&(p=null,k.spatialReference=null);const x=qt(e);let D,E,G,L,U;if(x.length>0){G=Math.round(Math.log(s/V(x[0],"IMAGEWIDTH"))/Math.LN2);const _=x[x.length-1];L=Math.round(Math.log(s/V(_,"IMAGEWIDTH"))/Math.LN2),D=V(_,"TILEWIDTH"),E=V(_,"TILELENGTH")}D=L!=null&&L>0?D||r:null,E=L!=null&&L>0?E||i:null,r&&(U=[{maxCol:Math.ceil(s/r)-1,maxRow:Math.ceil(n/i)-1,minRow:0,minCol:0}],x.forEach(_=>{U.push({maxCol:Math.ceil(V(_,"IMAGEWIDTH")/V(_,"TILEWIDTH"))-1,maxRow:Math.ceil(V(_,"IMAGELENGTH")/V(_,"TILELENGTH"))-1,minRow:0,minCol:0})}));const R=Mt(e[0],"GDAL_METADATA"),z=Nr(R);return C+=" "+Zt({width:s,height:n,tileWidth:r,tileHeight:i,planes:o,ifds:e}),{width:s,height:n,tileWidth:r,tileHeight:i,planes:o,isBSQ:a,pixelType:u,compression:w,noData:f,hasMaskBand:Xt(e).length===x.length+1,isSupported:m,message:C,extent:k,isPseudoGeographic:A,affine:v?null:T,firstPyramidLevel:G,maximumPyramidLevel:L,pyramidBlockWidth:D,pyramidBlockHeight:E,tileBoundary:U,metadata:z}}function gt(e,t){const r=Jt(e,"PLANARCONFIGURATION");return r?r[0]===2:!!t&&t.isBSQ}function qt(e){return e.filter(t=>V(t,"NEWSUBFILETYPE")===1)}function Xt(e){return e.filter(t=>{const r=(4&(V(t,"NEWSUBFILETYPE")??0))==4,i=V(t,"PHOTOMETRICINTERPRETATION")===4;return r&&i})}function $r(e){const{littleEndian:t,isBigTiff:r,firstIFDPos:i}=jr(e);let s=i;const n=[];do{const h=zr(e,t,s,0,Ae.TIFF_TAGS,r?8:4);if(!h.success)break;n.push(h.ifd),s=h.nextIFD}while(s>0);return{...mt(n),littleEndian:t,isBigTiff:r,ifds:n,pyramidIFDs:qt(n),maskIFDs:Xt(n)}}function yt(e,t,r){const i=e.getUint32(t,r),s=e.getUint32(t+4,r);return r?s*De+i:i*De+s}function Vr(e,t,r){let i=r?e.getInt32(t,r):e.getUint32(t,r),s=r?e.getUint32(t+4,r):e.getInt32(t+4,r);const n=(r?i:s)>=0?1:-1;return r?i*=n:s*=n,n*(r?s*De+i:i*De+s)}function $e(e,t,r,i){return i?yt(e,t,r):e.getUint32(t,r)}function jr(e){const t=new DataView(e,0,16),r=t.getUint16(0,!1);let i=null;if(r===18761)i=!0;else{if(r!==19789)throw new Error("unexpected endianess byte");i=!1}const s=t.getUint16(2,i);if(s!==42&&s!==43)throw new Error("unexpected tiff identifier");let n=4;const h=s===43;if(h){const o=t.getUint16(n,i);if(n+=2,o!==8)throw new Error("unsupported bigtiff version");if(t.getUint16(n,i)!==0)throw new Error("unsupported bigtiff version");n+=2}return{littleEndian:i,isBigTiff:h,firstIFDPos:$e(t,n,i,h)}}function zr(e,t,r,i=0,s=Ae.TIFF_TAGS,n=4){const h=qe(e,t,r,i,s,n);let o;const c=h.ifd;if(c){if(Ae.ifdTags.forEach((u,a)=>{c.has(a)&&(o=c.get(a),o.data=qe(e,t,o.valueOffset-i,i,u).ifd)}),c.has("GEOKEYDIRECTORY")){o=c.get("GEOKEYDIRECTORY");const u=o.values;if(u&&u.length>4){const a=u[0]+"."+u[1]+"."+u[2];o.data=qe(e,t,o.valueOffset+6-i,i,Ae.GEO_KEYS,2).ifd,o.data&&o.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[a]})}}if(c.has("XMP")){o=c.get("XMP");const u=o.values;typeof u[0]=="number"&&o.type===7&&(o.values=[Dr(new Uint8Array(u))])}}return h}function Zt(e){const{width:t,height:r,tileHeight:i,tileWidth:s}=e,n=e.planes,h=s?s*i:t*r,o=V(e.ifds[0],"BITSPERSAMPLE");let c="";return h*n>2**30/(o>8?o/8:1)&&(c=s?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),c}async function Wr(e,t){const{headerInfo:r,ifd:i,offsets:s,sizes:n}=t,h=[];for(let I=0;I<s.length;I++){const A=await nt(e,r.littleEndian,i,s[I],n[I]||e.byteLength);h.push(A)}const o=gt(i,r),c=V(i,"BITSPERSAMPLE"),u=pt(V(i,"SAMPLEFORMAT")??1,c),a=V(i,"SAMPLESPERPIXEL")||r.planes,g=ze(u),f=V(i,"TILEWIDTH"),d=V(i,"TILELENGTH"),w=V(i,"COMPRESSION")??1,m=f*d;let C;const l=[];let p=h[0];const y=w===34887;for(let I=0;I<a;I++){if(C=new g(m),o&&y){if(p=h[I],p.length)for(let A=0;A<m;A++)C[A]=p[A+I]}else if(p.length)if(o||y&&!o)C=p.slice(m*I,m*(I+1));else for(let A=0;A<m;A++)C[A]=p[A*a+I];l.push(C)}const v=r.noData?r.noData[0]:t.noDataValue,b=r.metadata?r.metadata.statistics:null,S=b?b.map(I=>I.min):null,T=b?b.map(I=>I.max):null,k={pixelType:u,width:f,height:d,pixels:l,noDataValue:v};return v!=null?ct(k,v):S&&T&&t.applyMinMaxConstraint&&(k.mask=Ur(l,S,T)),k}async function Hr(e,t={}){const r=t.pyramidLevel||0,i=t.headerInfo||$r(e),{ifds:s,noData:n}=i;if(s.length===0)throw new Error("no valid image file directory");const h=Zt(i);if(h)throw h;let o=null;const c=r===-1?s[s.length-1]:s[r],u=n??t.noDataValue;return o=i.tileWidth?await Or(e,i,c):await _r(e,i,c),o&&(u!=null&&ct(o,u),o)}var Yr=function(e){var t,r,i,s,n,h;function o(c){var u,a,g,f,d,w,m,C,l,p,y,v,b;for(this.data=c,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},d=null;;){switch(u=this.readUInt32(),C=function(){var S,T;for(T=[],S=0;S<4;++S)T.push(String.fromCharCode(this.data[this.pos++]));return T}.call(this).join(""),C){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(u);break;case"fcTL":d&&this.animation.frames.push(d),this.pos+=4,d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},f=this.readUInt16(),g=this.readUInt16()||100,d.delay=1e3*f/g,d.disposeOp=this.data[this.pos++],d.blendOp=this.data[this.pos++],d.data=[];break;case"IDAT":case"fdAT":for(C==="fdAT"&&(this.pos+=4,u-=4),c=(d!=null?d.data:void 0)||this.imgData,y=0;0<=u?y<u:y>u;0<=u?++y:--y)c.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(u),(l=255-this.transparency.indexed.length)>0)for(v=0;0<=l?v<l:v>l;0<=l?++v:--v)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(u)[0];break;case 2:this.transparency.rgb=this.read(u)}break;case"tEXt":w=(p=this.read(u)).indexOf(0),m=String.fromCharCode.apply(String,p.slice(0,w)),this.text[m]=String.fromCharCode.apply(String,p.slice(w+1));break;case"IEND":return d&&this.animation.frames.push(d),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(b=this.colorType)===4||b===6,a=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*a,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=u}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return o.load=function(c,u,a){var g;return typeof u=="function"&&(a=u),(g=new XMLHttpRequest).open("GET",c,!0),g.responseType="arraybuffer",g.onload=function(){var f;return f=new o(new Uint8Array(g.response||g.mozResponseArrayBuffer)),typeof(u!=null?u.getContext:void 0)=="function"&&f.render(u),typeof a=="function"?a(f):void 0},g.send(null)},r=1,i=2,t=0,o.prototype.read=function(c){var u,a;for(a=[],u=0;0<=c?u<c:u>c;0<=c?++u:--u)a.push(this.data[this.pos++]);return a},o.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.decodePixels=function(c){var u,a,g,f,d,w,m,C,l,p,y,v,b,S,T,k,I,A,x,D,E,G,L;if(c==null&&(c=this.imgData),c.length===0)return new Uint8Array(0);for(c=(c=new Ge(c)).getBytes(),k=(v=this.pixelBitlength/8)*this.width,b=new Uint8Array(k*this.height),w=c.length,T=0,S=0,a=0;S<w;){switch(c[S++]){case 0:for(f=x=0;x<k;f=x+=1)b[a++]=c[S++];break;case 1:for(f=D=0;D<k;f=D+=1)u=c[S++],d=f<v?0:b[a-v],b[a++]=(u+d)%256;break;case 2:for(f=E=0;E<k;f=E+=1)u=c[S++],g=(f-f%v)/v,I=T&&b[(T-1)*k+g*v+f%v],b[a++]=(I+u)%256;break;case 3:for(f=G=0;G<k;f=G+=1)u=c[S++],g=(f-f%v)/v,d=f<v?0:b[a-v],I=T&&b[(T-1)*k+g*v+f%v],b[a++]=(u+Math.floor((d+I)/2))%256;break;case 4:for(f=L=0;L<k;f=L+=1)u=c[S++],g=(f-f%v)/v,d=f<v?0:b[a-v],T===0?I=A=0:(I=b[(T-1)*k+g*v+f%v],A=g&&b[(T-1)*k+(g-1)*v+f%v]),m=d+I-A,C=Math.abs(m-d),p=Math.abs(m-I),y=Math.abs(m-A),l=C<=p&&C<=y?d:p<=y?I:A,b[a++]=(u+l)%256;break;default:throw new Error("Invalid filter algorithm: "+c[S-1])}T++}return b},o.prototype.decodePalette=function(){var c,u,a,g,f,d,w,m,C;for(a=this.palette,d=this.transparency.indexed||[],f=new Uint8Array((d.length||0)+a.length),g=0,a.length,c=0,u=w=0,m=a.length;w<m;u=w+=3)f[g++]=a[u],f[g++]=a[u+1],f[g++]=a[u+2],f[g++]=(C=d[c++])!=null?C:255;return f},o.prototype.copyToImageData=function(c,u){var a,g,f,d,w,m,C,l,p,y,v;if(g=this.colors,p=null,a=this.hasAlphaChannel,this.palette.length&&(p=(v=this._decodedPalette)!=null?v:this._decodedPalette=this.decodePalette(),g=4,a=!0),l=(f=c.data||c).length,w=p||u,d=m=0,g===1)for(;d<l;)C=p?4*u[d/4]:m,y=w[C++],f[d++]=y,f[d++]=y,f[d++]=y,f[d++]=a?w[C++]:this.transparency.grayscale&&this.transparency.grayscale===y?0:255,m=C;else for(;d<l;)C=p?4*u[d/4]:m,f[d++]=w[C++],f[d++]=w[C++],f[d++]=w[C++],f[d++]=a?w[C++]:this.transparency.rgb&&this.transparency.rgb[1]===w[C-3]&&this.transparency.rgb[3]===w[C-2]&&this.transparency.rgb[5]===w[C-1]?0:255,m=C},o.prototype.decode=function(){var c;return c=new Uint8Array(this.width*this.height*4),this.copyToImageData(c,this.decodePixels()),c},n=e.document&&e.document.createElement("canvas"),h=n&&n.getContext("2d"),s=function(c){var u;return h.width=c.width,h.height=c.height,h.clearRect(0,0,c.width,c.height),h.putImageData(c,0,0),(u=new Image).src=n.toDataURL(),u},o.prototype.decodeFrames=function(c){var u,a,g,f,d,w,m,C;if(this.animation){for(C=[],a=d=0,w=(m=this.animation.frames).length;d<w;a=++d)u=m[a],g=c.createImageData(u.width,u.height),f=this.decodePixels(new Uint8Array(u.data)),this.copyToImageData(g,f),u.imageData=g,C.push(u.image=s(g));return C}},o.prototype.renderFrame=function(c,u){var a,g,f;return a=(g=this.animation.frames)[u],f=g[u-1],u===0&&c.clearRect(0,0,this.width,this.height),(f!=null?f.disposeOp:void 0)===r?c.clearRect(f.xOffset,f.yOffset,f.width,f.height):(f!=null?f.disposeOp:void 0)===i&&c.putImageData(f.imageData,f.xOffset,f.yOffset),a.blendOp===t&&c.clearRect(a.xOffset,a.yOffset,a.width,a.height),c.drawImage(a.image,a.xOffset,a.yOffset)},o.prototype.animate=function(c){var u,a,g,f,d,w,m=this;return a=0,w=this.animation,f=w.numFrames,g=w.frames,d=w.numPlays,(u=function(){var C,l;if(C=a++%f,l=g[C],m.renderFrame(c,C),f>1&&a/f<d)return m.animation._timeout=setTimeout(u,l.delay)})()},o.prototype.stopAnimation=function(){var c;return clearTimeout((c=this.animation)!=null?c._timeout:void 0)},o.prototype.render=function(c){var u,a;return c._png&&c._png.stopAnimation(),c._png=this,c.width=this.width,c.height=this.height,u=c.getContext("2d"),this.animation?(this.decodeFrames(u),this.animate(u)):(a=u.createImageData(this.width,this.height),this.copyToImageData(a,this.decodePixels()),u.putImageData(a,0,0))},o}(self);const Kr=new Set(["jpg","png","bmp","gif"]);async function Jr(e,t){if(!dt)throw new pe("rasterCoded:decode","lerc decoder is not supported on big endian platform");await Ht();const{offset:r}=t,{width:i,height:s,pixelType:n,statistics:h,depthCount:o,noDataValues:c,bandMasks:u,pixels:a,mask:g}=Yt(e,{inputOffset:r,returnInterleaved:t.returnInterleaved});return new te({width:i,height:s,pixelType:n.toLowerCase(),pixels:a,mask:g,statistics:h,bandMasks:u,depthCount:o,noDataValues:c})}async function qr(e,t){const r=await Hr(e,{...t,noDataValue:null});Fe(r);const i=new te({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return i.updateStatistics(),i}async function Xr(e,t){const r=await Wr(e,t.customOptions),i=new te({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return i.updateStatistics(),i}function Qt(e,t){const r=t.pixelType||"u8",i=te.getPixelArrayConstructor(r),s=r==="u8"?e:new i(e.buffer),n=[],h=t.planes||1;if(h===1)n.push(s);else for(let c=0;c<h;c++){const u=(t.width||1)*(t.height||e.length),a=new i(u);for(let g=0;g<u;g++)a[g]=s[g*h+c];n.push(a)}const o=new te({width:t.width||1,height:t.height||e.length,pixels:n,pixelType:r,statistics:null});return o.updateStatistics(),o}function Zr(e,t){return Qt(new Ge(new Uint8Array(e)).getBytes(),t)}function Qr(e,t){return Qt(ht(e,t.offset,t.eof,!t.isInputBigEndian),t)}function eo(e,t,r){const{pixelTypeCtor:i}=no(t.pixelType),s=(0,Ar.decode)(e,{width:t.width,height:t.height,pixelType:i,format:r}),n=new te({width:t.width,height:t.height,pixels:s.pixels,pixelType:t.pixelType,mask:s.mask,statistics:null});return n.updateStatistics(),n}function to(e,t){const r=br.decode(e,t.hasNoZlibMask??void 0),i=new te({width:r.width,height:r.height,pixels:r.pixels,pixelType:"U8",mask:r.mask,statistics:null});return i.updateStatistics(),i}function ro(e,t){const r=new Uint8Array(e),i=new Yr(r),{width:s,height:n}=t,h=s*n,o=i.decode();let c,u=0,a=0;const g=new Uint8Array(h);for(u=0;u<h;u++)g[u]=o[4*u+3];const f=new te({width:s,height:n,pixels:[],pixelType:"U8",mask:g,statistics:[]});for(u=0;u<3;u++){for(c=new Uint8Array(h),a=0;a<h;a++)c[a]=o[4*a+u];f.addData({pixels:c})}return f.updateStatistics(),f}async function oo(e,t,r,i){const s=new vr,n={applyJpegMask:!1,format:t,...r},h=await s.decode(e,n,i),o=new te(h);return o.updateStatistics(),o}function er(e){if(e==null)throw new pe("rasterCodec:decode","parameter encodeddata is required.");const t=new Uint8Array(e,0,10);let r="";return t[0]===255&&t[1]===216?r="jpg":t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?r="png":t[0]===67&&t[1]===110&&t[2]===116&&t[3]===90&&t[4]===73&&t[5]===109&&t[6]===97&&t[7]===103&&t[8]===101&&t[9]===32?r="lerc":t[0]===76&&t[1]===101&&t[2]===114&&t[3]===99&&t[4]===50&&t[5]===32?r="lerc2":t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42||t[0]===73&&t[1]===73&&t[2]===43&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===43?r="tiff":t[0]===71&&t[1]===73&&t[2]===70?r="gif":t[0]===66&&t[1]===77?r="bmp":String.fromCharCode.apply(null,t).toLowerCase().includes("error")&&(r="error"),r}function io(e){let t=null;switch(e){case"lerc":case"lerc2":t=Jr;break;case"jpg":t=to;break;case"png":t=ro;break;case"bsq":case"bip":t=(r,i)=>eo(r,i,e);break;case"tiff":t=qr;break;case"deflate":t=Zr;break;case"lzw":t=Qr;break;case"error":t=()=>{throw new pe("rasterCodec:decode","input data contains error")};break;default:t=()=>{throw new pe("rasterCodec:decode","unsupported raster format")}}return t}function no(e){let t=null,r=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,t=Uint8Array;break;case"u16":r=r||65535,t=Uint16Array;break;case"u32":r=r||2**32-1,t=Uint32Array;break;case"s8":r=r||-128,t=Int8Array;break;case"s16":r=r||-32768,t=Int16Array;break;case"s32":r=r||0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:r}}function ao(e,t=1){if(!e)return;const{pixels:r,width:i,height:s,mask:n}=e;if(!r||r.length===0)return;const h=r.length,o=i-1,c=s-1,u=[];let a,g,f,d,w,m,C=null;const l=te.getPixelArrayConstructor(e.pixelType);if(t===0){for(a=0;a<h;a++){for(w=r[a],m=new l(o*c),g=0;g<c;g++)for(d=g*i,f=0;f<o;f++)m[g*o+f]=w[d+f];u.push(m)}if(n!=null)for(C=new Uint8Array(o*c),g=0;g<c;g++)for(d=g*i,f=0;f<o;f++)C[g*o+f]=n[d+f]}else{for(a=0;a<h;a++){for(w=r[a],m=new l(o*c),g=0;g<c;g++)for(d=g*i,f=0;f<o;f++)m[g*o+f]=(w[d+f]+w[d+f+1]+w[d+i+f]+w[d+i+f+1])/4;u.push(m)}if(n)for(C=new Uint8Array(o*c),g=0;g<c;g++)for(d=g*i,f=0;f<o;f++)C[g*o+f]=Math.min.apply(null,[n[d+f],n[d+f+1],n[d+i+f],n[d+i+f+1]])}e.width=o,e.height=c,e.mask=C,e.pixels=u}function _o(e){let t=er(e);return t==="lerc2"?t="lerc":t==="error"&&(t=""),t}async function Uo(e,t={},r){if(e==null)throw new pe("rasterCodec:decode","missing encodeddata parameter.");let i=t.format&&t.format.toLowerCase();if(!(i!=="bsq"&&i!=="bip"||t.width!=null&&t.height!=null))throw new pe("rasterCodec:decode","requires width and height in options parameter.");if(i==="tiff"&&t.customOptions)return Xr(e,t);if((!i||i!=="bsq"&&i!=="bip"&&i!=="deflate"&&i!=="lzw")&&(i=er(e)),t.useCanvas&&Kr.has(i))return oo(e,i,t,r);const s=io(i);t.isPoint&&((t={...t}).width!=null&&t.width++,t.height!=null&&t.height++);const n=await s(e,t);return n&&(i!=="jpg"&&t.noDataValue!=null&&n.depthCount===1&&ct(n,t.noDataValue,{customFloatTolerance:t.tolerance}),t.isPoint&&ao(n),n)}var at;function we(e){return e=Number(e),isNaN(e)?void 0:e}let ue=at=class extends Me{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}clone(){return new at({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};B([O({json:{name:"BandName",write:!0}})],ue.prototype,"name",void 0),B([O({json:{name:"WavelengthMin",read:{reader:we},write:!0}})],ue.prototype,"minWavelength",void 0),B([O({json:{name:"WavelengthMax",read:{reader:we},write:!0}})],ue.prototype,"maxWavelength",void 0),B([O({json:{name:"RadianceBias",read:{reader:we},write:!0}})],ue.prototype,"radianceBias",void 0),B([O({json:{name:"RadianceGain",read:{reader:we},write:!0}})],ue.prototype,"radianceGain",void 0),B([O({json:{name:"ReflectanceBias",read:{reader:we},write:!0}})],ue.prototype,"reflectanceBias",void 0),B([O({json:{name:"ReflectanceGain",read:{reader:we},write:!0}})],ue.prototype,"reflectanceGain",void 0),B([O({json:{name:"SolarIrradiance",read:{reader:we},write:!0}})],ue.prototype,"solarIrradiance",void 0),ue=at=B([Be("esri.layers.support.RasterBandInfo")],ue);const Gt=ue;var st;function Re(e){return e=Number(e),isNaN(e)?void 0:e}let ae=st=class extends Me{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(e){return new Date(e)}writeAcquisitionDate(e,t){t.AcquisitionDate=e.getTime()}clone(){return new st({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};B([O({json:{name:"AcquisitionDate",write:!0}})],ae.prototype,"acquisitionDate",void 0),B([dr("acquisitionDate")],ae.prototype,"readAcquisitionDate",null),B([pr("acquisitionDate")],ae.prototype,"writeAcquisitionDate",null),B([O({json:{name:"CloudCover",read:{reader:Re},write:!0}})],ae.prototype,"cloudCover",void 0),B([O({json:{name:"ProductName",write:!0}})],ae.prototype,"productName",void 0),B([O({json:{name:"SensorName",write:!0}})],ae.prototype,"sensorName",void 0),B([O({json:{name:"SensorAzimuth",read:{reader:Re},write:!0}})],ae.prototype,"sensorAzimuth",void 0),B([O({json:{name:"SensorElevation",read:{reader:Re},write:!0}})],ae.prototype,"sensorElevation",void 0),B([O({json:{name:"SunAzimuth",read:{reader:Re},write:!0}})],ae.prototype,"sunAzimuth",void 0),B([O({json:{name:"SunElevation",read:{reader:Re},write:!0}})],ae.prototype,"sunElevation",void 0),ae=st=B([Be("esri.layers.support.RasterSensorInfo")],ae);const so=ae;var lt;let Z=lt=class extends Me{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new lt({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:Q(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:Q(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:Q(this.tileInfo),transposeInfo:Q(this.transposeInfo),blockBoundary:Q(this.blockBoundary)})}};B([O({type:Number,json:{write:!0}})],Z.prototype,"blockWidth",void 0),B([O({type:Number,json:{write:!0}})],Z.prototype,"blockHeight",void 0),B([O({type:String,json:{write:!0}})],Z.prototype,"compression",void 0),B([O({type:mr,json:{write:!0}})],Z.prototype,"origin",void 0),B([O({type:Number,json:{write:!0}})],Z.prototype,"firstPyramidLevel",void 0),B([O({type:Number,json:{write:!0}})],Z.prototype,"maximumPyramidLevel",void 0),B([O({json:{write:!0}})],Z.prototype,"pyramidResolutions",void 0),B([O({type:Number,json:{write:!0}})],Z.prototype,"pyramidScalingFactor",void 0),B([O({type:Number,json:{write:!0}})],Z.prototype,"pyramidBlockWidth",void 0),B([O({type:Number,json:{write:!0}})],Z.prototype,"pyramidBlockHeight",void 0),B([O({type:Boolean,json:{write:!0}})],Z.prototype,"isVirtualTileInfo",void 0),B([O({json:{write:!0}})],Z.prototype,"tileInfo",void 0),B([O()],Z.prototype,"transposeInfo",void 0),B([O()],Z.prototype,"blockBoundary",void 0),Z=lt=B([Be("esri.layers.support.RasterStorageInfo")],Z);const lo=Z;var ut;let Y=ut=class extends Me{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){const e=this.keyProperties.BandProperties;if(!(e!=null&&e.length)){const r=[];for(let i=1;i<=this.bandCount;i++)r.push(new Gt({name:"band_"+i}));return r}const t=e.map(r=>Gt.fromJSON(r));for(let r=0;r<t.length;r++)t[r].name=t[r].name??"band_"+(r+1);return t}get dataType(){var t,r;const e=((r=(t=this.keyProperties)==null?void 0:t.DataType)==null?void 0:r.toLowerCase())??"generic";return e==="stdtime"?"standard-time":e}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(e){e&&this._set("nativeExtent",e)}get nativePixelSize(){if(this.transform==null||!this.transform.affectsPixelSize)return this.pixelSize;const e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}get hasMultidimensionalTranspose(){var e;return!!((e=this.storageInfo)!=null&&e.transposeInfo)}get sensorInfo(){var e;if((e=this.keyProperties)!=null&&e.SensorName)return so.fromJSON(this.keyProperties)}clone(){return new ut({attributeTable:Q(this.attributeTable),bandCount:this.bandCount,colormap:Q(this.colormap),extent:Q(this.extent),nativePixelSize:Q(this.nativePixelSize),format:this.format,height:this.height,width:this.width,histograms:Q(this.histograms),keyProperties:Q(this.keyProperties),multidimensionalInfo:Q(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:Q(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:Q(this.spatialReference),statistics:Q(this.statistics),storageInfo:Q(this.storageInfo),transform:Q(this.transform)})}};B([O({json:{write:!0}})],Y.prototype,"attributeTable",void 0),B([O({json:{write:!0}})],Y.prototype,"bandCount",void 0),B([O({readOnly:!0})],Y.prototype,"bandInfos",null),B([O({json:{write:!0}})],Y.prototype,"colormap",void 0),B([O({type:String,readOnly:!0})],Y.prototype,"dataType",null),B([O({type:Ct,json:{write:!0}})],Y.prototype,"extent",void 0),B([O({type:Ct,json:{write:!0}})],Y.prototype,"nativeExtent",null),B([O({json:{write:!0}})],Y.prototype,"nativePixelSize",null),B([O({json:{write:!0}})],Y.prototype,"format",void 0),B([O({json:{write:!0}})],Y.prototype,"height",void 0),B([O({json:{write:!0}})],Y.prototype,"width",void 0),B([O({json:{write:!0}})],Y.prototype,"hasMultidimensionalTranspose",null),B([O({json:{write:!0}})],Y.prototype,"histograms",void 0),B([O({json:{write:!0}})],Y.prototype,"keyProperties",void 0),B([O({json:{write:!0}})],Y.prototype,"multidimensionalInfo",void 0),B([O({json:{write:!0}})],Y.prototype,"noDataValue",void 0),B([O({json:{write:!0}})],Y.prototype,"pixelSize",void 0),B([O({json:{write:!0}})],Y.prototype,"pixelType",void 0),B([O()],Y.prototype,"isPseudoSpatialReference",void 0),B([O({readOnly:!0})],Y.prototype,"sensorInfo",null),B([O({type:gr,json:{write:!0}})],Y.prototype,"spatialReference",void 0),B([O({json:{write:!0}})],Y.prototype,"statistics",void 0),B([O({type:lo,json:{write:!0}})],Y.prototype,"storageInfo",void 0),B([O({json:{write:!0}})],Y.prototype,"transform",void 0),Y=ut=B([Be("esri.layers.support.RasterInfo")],Y);const uo=Y,ee=1,xe=1/111e3;function tr(e){let{altitude:t,azimuth:r}=e;const{hillshadeType:i,pixelSizePower:s=1,pixelSizeFactor:n=1,scalingType:h,isGCS:o,resolution:c}=e,u=i==="multi-directional"?2*e.zFactor:e.zFactor,{x:a,y:g}=c;let f=u/(8*a),d=u/(8*g);if(o&&u>.001&&(f/=xe,d/=xe),h==="adjusted")if(o){const D=a*xe,E=g*xe;f=(u+D**s*n)/(8*D),d=(u+E**s*n)/(8*E)}else f=(u+a**s*n)/(8*a),d=(u+g**s*n)/(8*g);let w=(90-t)*Math.PI/180,m=Math.cos(w),C=(360-r+90)*Math.PI/180,l=Math.sin(w)*Math.cos(C),p=Math.sin(w)*Math.sin(C);const y=[315,270,225,360,180,0],v=[60,60,60,60,60,90],b=new Float32Array([3,5,3,2,1,4]),S=b.reduce((D,E)=>D+E),T=b.map(D=>D/S),k=i==="multi-directional"?y.length:1,I=new Float32Array(6),A=new Float32Array(6),x=new Float32Array(6);if(i==="multi-directional")for(let D=0;D<k;D++)t=v[D],r=y[D],w=(90-t)*Math.PI/180,m=Math.cos(w),C=(360-r+90)*Math.PI/180,l=Math.sin(w)*Math.cos(C),p=Math.sin(w)*Math.sin(C),I[D]=m,A[D]=l,x[D]=p;else I.fill(m),A.fill(l),x.fill(p);return{resolution:c,factor:[f,d],sinZcosA:l,sinZsinA:p,cosZ:m,sinZcosAs:A,sinZsinAs:x,cosZs:I,weights:T,hillshadeType:["traditional","multi-directional"].indexOf(i)}}function We(e,t){const{width:r,height:i,mask:s}=e,n=new Uint8Array(r*i),h=s!=null;if(h)for(let b=0;b<s.length;b++)s[b]&&(n[b]=1);const o=e.pixels[0],c=new Float32Array(r*i),u=new Float32Array(r*i);let a,g=0;if(t){const{resolution:b}=t,S=b?(b.x+b.y)/2:1;g=200*t.zFactor/(S*S),a=new Float32Array(r*i)}const f=t==null?void 0:t.curvatureType;let d,w,m,C,l,p,y,v;for(let b=ee;b<i-ee;b++){const S=b*r;for(let T=ee;T<r-ee;T++){const k=S+T;if(!h||s[k]!==0){if(h){if(s[k-r-1]+s[k-r]+s[k-r+1]+s[k-1]+s[k+1]+s[k+r-1]+s[k+r]+s[k+r+1]<7){n[k]=0;continue}d=s[k-r-1]?o[k-r-1]:o[k],w=s[k-r]?o[k-r]:o[k],m=s[k-r+1]?o[k-r+1]:o[k],C=s[k-1]?o[k-1]:o[k],l=s[k+1]?o[k+1]:o[k],p=s[k+r-1]?o[k+r-1]:o[k],y=s[k+r]?o[k+r]:o[k],v=s[k+r+1]?o[k+r+1]:o[k]}else d=o[k-r-1],w=o[k-r],m=o[k-r+1],C=o[k-1],l=o[k+1],p=o[k+r-1],y=o[k+r],v=o[k+r+1];if(c[k]=m+l+l+v-(d+C+C+p),u[k]=p+y+y+v-(d+w+w+m),a!=null){const I=o[k],A=.5*(C+l)-I,x=.5*(w+y)-I;if(f==="standard")a[k]=-g*(A+x);else{const D=(-d+m+p-v)/4,E=(-C+l)/2,G=(w-y)/2,L=E*E,U=G*G,R=L+U;R&&(a[k]=f==="profile"?g*(A*L+x*U+D*E*G)/R:-g*(A*U+x*L-D*E*G)/R)}}}}}return{outMask:h?n:null,dzxs:c,dzys:u,curvatures:a}}function He(e,t,r){for(let i=0;i<r;i++)e[i*t]=e[i*t+1],e[(i+1)*t-1]=e[(i+1)*t-2];for(let i=1;i<t-1;i++)e[i]=e[i+t],e[i+(r-1)*t]=e[i+(r-2)*t]}function co(e,t){if(!Te(e))return e;const{factor:r,sinZcosA:i,sinZsinA:s,cosZ:n,sinZcosAs:h,sinZsinAs:o,cosZs:c,weights:u}=tr(t),[a,g]=r,f=t.hillshadeType==="traditional",{width:d,height:w}=e,m=new Uint8Array(d*w),{dzxs:C,dzys:l,outMask:p}=We(e);for(let y=ee;y<w-ee;y++){const v=y*d;for(let b=ee;b<d-ee;b++){const S=v+b;if(!p||p[S]){const T=C[S]*a,k=l[S]*g,I=Math.sqrt(1+T*T+k*k);let A=0;if(f){let x=255*(n+s*k-i*T)/I;x<0&&(x=0),A=x}else{const x=o.length;for(let D=0;D<x;D++){let E=255*(c[D]+o[D]*k-h[D]*T)/I;E<0&&(E=0),A+=E*u[D]}}m[S]=255&A}}}return He(m,d,w),new te({width:d,height:w,pixels:[m],mask:p,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function ho(e,t,r,i){if(!Te(e)||!Te(t))return;const{min:s,max:n}=i,h=e.pixels[0],{pixels:o,mask:c}=t,u=o[0],a=255.00001/(n-s),g=new Uint8ClampedArray(u.length),f=new Uint8ClampedArray(u.length),d=new Uint8ClampedArray(u.length),w=r.length-1;for(let m=0;m<u.length;m++){if(c&&c[m]===0)continue;const C=Math.floor((u[m]-s)*a),[l,p]=r[C<0?0:C>w?w:C],y=h[m],v=y*p,b=v*(1-Math.abs(l%2-1)),S=y-v;switch(Math.floor(l)){case 0:g[m]=v+S,f[m]=b+S,d[m]=S;break;case 1:g[m]=b+S,f[m]=v+S,d[m]=S;break;case 2:g[m]=S,f[m]=v+S,d[m]=b+S;break;case 3:g[m]=S,f[m]=b+S,d[m]=v+S;break;case 4:g[m]=b+S,f[m]=S,d[m]=v+S;break;case 5:case 6:g[m]=v+S,f[m]=S,d[m]=b+S}}e.pixels=[g,f,d],e.updateStatistics()}function No(e,t){if(!Te(e))return e;const r=t.zFactor,i=t.pixelSizePower??1,s=t.pixelSizeFactor??1,n=t.slopeType,h=t.isGCS,{x:o,y:c}=t.resolution;let u=r/(8*o),a=r/(8*c);h&&Math.abs(r-1)<1e-4&&(u/=xe,a/=xe),n==="adjusted"&&(u=(r+o**i*s)/(8*o),a=(r+c**i*s)/(8*c));const{dzxs:g,dzys:f,outMask:d}=We(e),{width:w,height:m}=e,C=new Float32Array(w*m);for(let p=ee;p<m-ee;p++){const y=p*w;for(let v=ee;v<w-ee;v++){const b=y+v;if(!d||d[b]){const S=g[b]*u,T=f[b]*a,k=Math.sqrt(S*S+T*T);C[y+v]=n==="percent-rise"?100*k:57.2957795*Math.atan(k)}}}He(C,w,m);const l=new te({width:w,height:m,pixels:[C],mask:d,pixelType:"f32",validPixelCount:e.validPixelCount});return l.updateStatistics(),l}function Fo(e,t={}){if(!Te(e))return e;const{resolution:r}=t,i=r?1/r.x:1,s=r?1/r.y:1,{dzxs:n,dzys:h,outMask:o}=We(e),{width:c,height:u}=e,a=new Float32Array(c*u);for(let g=ee;g<u-ee;g++){const f=g*c;for(let d=ee;d<c-ee;d++){const w=f+d;if(!o||o[w]){const m=n[w]*i,C=h[w]*s;let l=-1;m===0&&C===0||(l=90-57.29578*Math.atan2(C,-m),l<0&&(l+=360),l===360?l=0:l>360&&(l%=360)),a[f+d]=l}}}return He(a,c,u),new te({width:c,height:u,pixels:[a],mask:o,pixelType:"f32",validPixelCount:e.validPixelCount,statistics:[{minValue:-1,maxValue:360}]})}function $o(e,t){if(!Te(e))return e;const{curvatures:r,outMask:i}=We(e,t),{width:s,height:n}=e;He(r,s,n);const h=new te({width:s,height:n,pixels:[r],mask:i,pixelType:"f32",validPixelCount:e.validPixelCount});return h.updateStatistics(),h}const Vo=["random","ndvi","ndvi2","ndvi3","elevation","gray","hillshade"],rr=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}],or={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"},fo=new Vt({Aspect:"aspect","Black to White":"black-to-white","Blue Bright":"blue-bright","Blue Light to Dark":"blue-light-to-dark","Blue-Green Bright":"blue-green-bright","Blue-Green Light to Dark":"blue-green-light-to-dark","Brown Light to Dark":"brown-light-to-dark","Brown to Blue Green Diverging, Bright":"brown-to-blue-green-diverging-right","Brown to Blue Green Diverging, Dark":"brown-to-blue-green-diverging-dark","Coefficient Bias":"coefficient-bias","Cold to Hot Diverging":"cold-to-hot-diverging","Condition Number":"condition-number","Cyan to Purple":"cyan-to-purple","Cyan-Light to Blue-Dark":"cyan-light-to-blue-dark",Distance:"distance","Elevation #1":"elevation1","Elevation #2":"elevation2",Errors:"errors","Gray Light to Dark":"gray-light-to-dark","Green Bright":"green-bright","Green Light to Dark":"green-light-to-dark","Green to Blue":"green-to-blue","Orange Bright":"orange-bright","Orange Light to Dark":"orange-light-to-dark","Partial Spectrum":"partial-spectrum","Partial Spectrum 1 Diverging":"partial-spectrum-1-diverging","Partial Spectrum 2 Diverging":"partial-spectrum-2-diverging","Pink to YellowGreen Diverging, Bright":"pink-to-yellow-green-diverging-bright","Pink to YellowGreen Diverging, Dark":"pink-to-yellow-green-diverging-dark",Precipitation:"precipitation",Prediction:"prediction","urple Bright":"purple-bright","Purple to Green Diverging, Bright":"purple-to-green-diverging-bright","Purple to Green Diverging, Dark":"purple-to-green-diverging-dark","Purple-Blue Bright":"purple-blue-bright","Purple-Blue Light to Dark":"purple-blue-light-to-dark","Purple-Red Bright":"purple-red-bright","Purple-Red Light to Dark":"purple-red-light-to-dark","Red Bright":"red-bright","Red Light to Dark":"red-light-to-dark","Red to Blue Diverging, Bright":"red-to-blue-diverging-bright","Red to Blue Diverging, Dark":"red-to-blue-diverging-dark","Red to Green":"red-to-green","Red to Green Diverging, Bright":"red-to-green-diverging-bright","Red to Green Diverging, Dark":"red-to-green-diverging-dark",Slope:"slope","Spectrum-Full Bright":"spectrum-full-bright","Spectrum-Full Dark":"spectrum-full-dark","Spectrum-Full Light":"spectrum-full-light",Surface:"surface",Temperature:"temperature","White to Black":"white-to-black","Yellow to Dark Red":"yellow-to-dark-red","Yellow to Green to Dark Blue":"yellow-to-green-to-dark-blue","Yellow to Red":"yellow-to-red","Yellow-Green Bright":"yellow-green-bright","Yellow-Green Light to Dark":"yellow-green-light-to-dark"});function Ne(e,t){if(!e||!t||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]>t[r]+2||e[r]<t[r]-2)return!1;return!0}function po(e,t){if(!e)return;const r=t??rr;let i=null;return e.type==="algorithmic"?r.some(s=>{if(Ne(e.fromColor.toRgb(),s.fromColor)&&Ne(e.toColor.toRgb(),s.toColor))return i=s.id,!0}):e.type==="multipart"&&r.some(s=>{const n=e.colorRamps,h=s.colorRamps;if(n&&h&&n.length===h.length&&!h.some((o,c)=>{if(!Ne(n[c].fromColor.toRgb(),new wt(o.fromColor).toRgb())||!Ne(n[c].toColor.toRgb(),new wt(o.toColor).toRgb()))return!0})){if(i)return!0;i=s.id}}),i}function mo(e){const t=po(e);return t?or[t]:null}function jo(e){var s;const t=fo.toJSON(e),r=(s=Object.entries(or).find(n=>n[1]===t))==null?void 0:s[0],i=rr.find(n=>n.id===r);return i?i.colorRamps?{type:"multipart",colorRamps:i.colorRamps.map(n=>({type:"algorithmic",algorithm:"esriCIELabAlgorithm",fromColor:n.fromColor,toColor:n.toColor}))}:{type:"algorithmic",algorithm:"esriCIELabAlgorithm",fromColor:i.fromColor,toColor:i.toColor}:null}function ir(e){const t=(e=e||{}).numColors||256,r=e.distanceOffset||0,i=e.isCustomInterval!=null?e.isCustomInterval:e.distanceInterval!==null&&e.distanceInterval!==1/(t-1),s=e.distanceInterval||1/(t-1);return{...e,numColors:t,distanceOffset:r,interpolateAlpha:!!e.interpolateAlpha,distanceInterval:s,isCustomInterval:i,weights:e.weights}}function go(e,t,r){const{numColors:i,distanceOffset:s,distanceInterval:n,isCustomInterval:h}=r,o=e.s===0,c=t.s===0;let u=e.h,a=t.h;o&&!c?u=a:c&&!o&&(t={...t,h:u},a=u);let g,f=Math.abs(a-u);const d=360;f<d/2?g=(a-u)*n:(f=d-f,g=u>a?f*n:-f*n);const w=(t.s-e.s)*n,m=(t.v-e.v)*n;let{s:C,v:l}=e,p=u;if(s){const v=s/n;p=(p+v*g+d)%d,C+=v*w,l+=v*m}const y=[];for(let v=0;v<i-1;v++)y.push({h:p,s:C,v:l}),p=(p+g+d)%d,C+=w,l+=m;return y.push(h?{h:p,s:C,v:l}:t),y}function yo(e,t,r){const{numColors:i,distanceOffset:s,distanceInterval:n,isCustomInterval:h}=r;let{l:o,a:c,b:u}=e;const a=(t.l-o)*n,g=(t.a-c)*n,f=(t.b-u)*n,d=[];if(s){const w=s/n;o+=w*a,c+=w*g,u+=w*f}for(let w=0;w<i-1;w++)d.push({l:o,a:c,b:u}),o+=a,c+=g,u+=f;return d.push(h?{l:o,a:c,b:u}:t),d}function Co(e,t,r){const{numColors:i,distanceOffset:s,distanceInterval:n,isCustomInterval:h}=r,o=e.h,c=t.h,u=2*Math.PI;let a;if(o<=c){const p=c-o,y=c-o-u;a=Math.abs(y)<Math.abs(p)?y:p}else{const p=c+u-o,y=c-o;a=Math.abs(y)<Math.abs(p)?y:p}const g=a*n,f=(t.l-e.l)*n,d=(t.c-e.c)*n;let{l:w,c:m,h:C}=e;if(s){const p=s/n;w+=p*f,m+=p*d,C=(C+p*g+u)%u}const l=[];for(let p=0;p<i-1;p++)l.push({l:w,c:m,h:C}),w+=f,m+=d,C=(C+g+u)%u;return l.push(h?{l:w,c:m,h:C}:t),l}function nr(e,t){let{fromColor:r,toColor:i}=e;r.length===3&&(r=r.concat([255])),i.length===3&&(i=i.concat([255]));const s=e.algorithm||"esriCIELabAlgorithm",n=ir(t),{numColors:h,distanceOffset:o,isCustomInterval:c,interpolateAlpha:u}=n;if(h===1&&o===0)return[r];if(h===2&&o===0&&!c)return[r,i];const a={r:r[0],g:r[1],b:r[2]},g={r:i[0],g:i[1],b:i[2]},f=s==="esriCIELabAlgorithm"?yo(St(a),St(g),n):s==="esriHSVAlgorithm"?go(Ve(a),Ve(g),n):Co(kt(a),kt(g),n),d=[],w=r[3]??255,m=((i[3]??255)-w)/(h-1);for(let C=0;C<h;C++){const{r:l,g:p,b:y}=wr(f[C]),v=u?Math.round(w+m*C):255;d.push([l,p,y,v])}return d}function wo(e,t){const{numColors:r,interpolateAlpha:i}=ir(t);let s=t==null?void 0:t.weights;const{colorRamps:n}=e;if(s){const f=s.reduce((d,w)=>d+w);s=s.map(d=>d/f)}else{s=[];for(let f=0;f<n.length;f++)s[f]=1/n.length}const h=[];let o=0,c=0;const u=1/(r-1);let a=!1;for(let f=0;f<n.length;f++){let d=a?0:o*u-c,w=f===n.length-1?r-1-o:(s[f]-d)/u;if(a=Math.ceil(w)===w,w=Math.ceil(w),w===0)continue;d/=s[f];const m=nr(n[f],{numColors:w,interpolateAlpha:i,distanceOffset:d,distanceInterval:u/s[f]});o+=m.length,h.push(...m),c+=s[f]}const g=[...n[n.length-1].toColor];return g.length===3&&g.push(255),h.push(g),h}function vo(e,t){const r="toJSON"in e?e.toJSON():e;return r.type==="multipart"?wo(r,t):nr(r,t)}function Ot(e,t){const r=vo(e,t),i=t==null?void 0:t.interpolateAlpha;return r.forEach((s,n)=>{s.unshift(n),i||s.pop()}),r}function zo(e){const t=mo(e);if(e){if(e.type==="algorithmic")return{..._t(e),Name:t};if(e.colorRamps){const r=e.colorRamps.map(_t);return{type:"MultiPartColorRamp",NumColorRamps:r.length,ArrayOfColorRamp:r,Name:t}}}}function _t(e){if(!e)return;const t=e.toJSON();return{Algorithm:(t==null?void 0:t.Algorithm)||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:Ut(e.fromColor),ToColor:Ut(e.toColor)}}function Ut(e){const t=Ve(e);return{type:"HsvColor",Hue:t.h,Saturation:t.s,Value:t.v,AlphaValue:255}}function Wo(e){const t=e.reverse().map(r=>{const i=r.toString(16);return i.length<2?"0"+i:i});return 4294967295&Number.parseInt(t.join(""),16)}const Ho=new Vt({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),bo={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"},Xe=1,To=[.299,.587,.114];function ar(e,t=256){t=Math.min(t,256);const{size:r,counts:i}=e,s=new Uint8Array(r),n=i.reduce((a,g)=>a+g/t,0);let h=0,o=0,c=0,u=n;for(let a=0;a<r;a++)if(c+=i[a],!(a<r-1&&c+i[a+1]<u)){for(;h<t-1&&u<c;)h++,u+=n;for(let g=o;g<=a;g++)s[g]=h;o=a+1}for(let a=o;a<r;a++)s[a]=t-1;return s}function Nt(e){const{minCutOff:t,maxCutOff:r,gamma:i,pixelType:s,rounding:n}=e,h=e.outMin||0,o=e.outMax||255;if(!["u8","u16","s8","s16"].includes(s))return null;const c=t.length;let u,a,g=0;s==="s8"?g=-127:s==="s16"&&(g=-32767);let f=256;["u16","s16"].includes(s)&&(f=65536);const d=[],w=[],m=o-h;for(u=0;u<c;u++)w[u]=r[u]-t[u],d[u]=w[u]===0?0:m/w[u];let C;const l=[];let p,y,v;if(i&&i.length>=c){const b=sr(c,i);for(u=0;u<c;u++){for(v=[],a=0;a<f;a++)if(w[u]!==0)if(p=a+g,C=(p-t[u])/w[u],y=1,i[u]>1&&(y-=(1/m)**(C*b[u])),p<r[u]&&p>t[u]){const S=y*m*C**(1/i[u])+h;v[a]=n==="floor"?Math.floor(S):n==="round"?Math.round(S):S}else p>=r[u]?v[a]=o:v[a]=h;else v[a]=h;l[u]=v}}else for(u=0;u<c;u++){for(v=[],a=0;a<f;a++)if(p=a+g,p<=t[u])v[a]=h;else if(p>=r[u])v[a]=o;else{const b=(p-t[u])*d[u]+h;v[a]=n==="floor"?Math.floor(b):n==="round"?Math.round(b):b}l[u]=v}if(e.contrastOffset!=null){const b=So(e.contrastOffset,e.brightnessOffset);for(u=0;u<c;u++)for(v=l[u],a=0;a<f;a++)v[a]=b[v[a]]}return{lut:l,offset:g}}function So(e,t){const r=Math.min(Math.max(e,-100),100),i=Math.min(Math.max(t??0,-100),100),s=255,n=128;let h=0,o=0;const c=new Uint8Array(256);for(h=0;h<256;h++)r>0&&r<100?o=(200*h-100*s+2*s*i)/(2*(100-r))+n:r<=0&&r>-100?o=(200*h-100*s+2*s*i)*(100+r)/2e4+n:r===100?(o=200*h-100*s+(s+1)*(100-r)+2*s*i,o=o>0?s:0):r===-100&&(o=n),c[h]=o>s?s:o<0?0:o;return c}function ko(e,t,r){const i=[];for(let s=0;s<t.length;s++){let n=0,h=0,o=0;"min"in t[s]?{min:n,max:h,avg:o}=t[s]:[n,h,o]=t[s];let c=o??0;e!=="u8"&&(c=255*(c-n)/(h-n)),r&&(c*=To[s]),i.push(Io(c))}return i}function Io(e){if(e<=0||e>=255)return Xe;let t=0;e!==150&&(t=e<=150?45*Math.cos(.01047*e):17*Math.sin(.021*e));const r=255,i=e+t,s=Math.log(e/r),n=Math.log(i/r);if(n===0)return Xe;const h=s/n;return isNaN(h)?Xe:Math.min(9.9,Math.max(.01,h))}function xo(e,t,r,i){let s=1/0,n=-1/0,h=0,o=0;const c=e.length;for(let l=0;l<c;l++){const p=e[l];t&&!t[l]||(s=p<s?p:s,n=p>n?p:n,h+=p,o++)}if(o===0)return{statistics:{min:0,max:0,avg:0,stddev:0},histogram:null};const u=h/o;let a=0;for(let l=0;l<c;l++)t&&!t[l]||(a+=(e[l]-u)**2);const g=t?t.filter(l=>l).length:c,f={min:s,max:n,avg:u,stddev:g<=1?0:Math.sqrt(a/(g-1))};if(!i)return{statistics:f,histogram:null};if(["u8","s8","u4","u2","u1"].includes(r)){const l=n-s+1,p=new Uint32Array(l);for(let y=0;y<c;y++)t&&!t[y]||p[e[y]-s]++;return{statistics:f,histogram:{min:s-.5,max:n+.5,size:l,counts:p}}}const d=256,w=new Uint32Array(d),m=(n-s)/d;if(m===0)return{statistics:f,histogram:{min:s,max:n,size:1,counts:new Uint32Array(1).fill(o)}};const C=new Uint32Array(d+1);for(let l=0;l<c;l++)t&&!t[l]||C[Math.floor((e[l]-s)/m)]++;for(let l=0;l<d-1;l++)w[l]=C[l];return w[d-1]=C[d-1]+C[d],{statistics:f,histogram:{min:s,max:n,size:d,counts:w}}}function Yo(e){const{pixels:t,mask:r,pixelType:i}=e,s=t.map(n=>xo(n,r,i,!0));return{statistics:s.map(({statistics:n})=>n),histograms:s.map(({histogram:n})=>n)}}function Ao(e){var k;if(e==null||!((k=e.pixels)!=null&&k.length))return null;const{pixels:t,mask:r,pixelType:i}=e,s=e.width*e.height,n=t.length;let h,o,c,u,a;const g=[],f=[];let d,w,m,C,l,p,y,v,b,S;const T=256;for(u=0;u<n;u++){if(d=new Uint32Array(T),m=t[u],i==="u8")if(h=-.5,o=255.5,r)for(a=0;a<s;a++)r[a]&&d[m[a]]++;else for(a=0;a<s;a++)d[m[a]]++;else{let I=!1;e.statistics||(e.updateStatistics(),I=!0);const A=e.statistics;if(h=A[u].minValue,o=A[u].maxValue,c=(o-h)/T,c===0){!A||e.validPixelCount||I||e.updateStatistics();const x=(e.validPixelCount||e.width*e.height)/T;for(let D=0;D<T;D++)d[D]=Math.round(x*(D+1))-Math.round(x*D)}else{for(w=new Uint32Array(T+1),a=0;a<s;a++)r&&!r[a]||w[Math.floor((m[a]-h)/c)]++;for(a=0;a<T-1;a++)d[a]=w[a];d[T-1]=w[T-1]+w[T]}}for(g.push({min:h,max:o,size:T,counts:d}),C=0,l=0,v=0,a=0;a<T;a++)C+=d[a],l+=a*d[a];for(b=l/C,a=0;a<T;a++)v+=d[a]*(a-b)**2;S=Math.sqrt(v/(C-1)),c=(o-h)/T,p=(b+.5)*c+h,y=S*c,f.push({min:h,max:o,avg:p,stddev:y})}return{statistics:f,histograms:g}}function Ko(e){const t=[];for(let r=0;r<e.length;r++){const{min:i,max:s,size:n,counts:h}=e[r];let o=0,c=0;for(let w=0;w<n;w++)o+=h[w],c+=w*h[w];const u=c/o;let a=0;for(let w=0;w<n;w++)a+=h[w]*(w-u)**2;const g=(s-i)/n,f=(u+.5)*g+i,d=Math.sqrt(a/(o-1))*g;t.push({min:i,max:s,avg:f,stddev:d})}return t}function Le(e,t){var A;const{pixelBlock:r,bandIds:i,returnHistogramLut:s,rasterInfo:n}=t;let h=null,o=null,c=e.stretchType;if(typeof c=="number"&&(c=bo[c]),e.dra)if(c==="minMax"&&r!=null&&r.statistics)h=r.statistics.map(x=>[x.minValue,x.maxValue,0,0]);else{const x=Ao(r);h=x!=null?x.statistics:null,o=x!=null?x.histograms:null}else h=((A=e.statistics)==null?void 0:A.length)>0?e.statistics:n.statistics,o="histograms"in e?e.histograms:void 0,o||(o=n.histograms);c!=="percentClip"&&c!=="histogramEqualization"||o!=null&&o.length||(c="minMax");const u=(h==null?void 0:h.length)||(o==null?void 0:o.length)||n.bandCount,a=[],g=[];let f,d,w,m,C,l,p,y,v;h&&!Array.isArray(h[0])&&(h=h.map(x=>[x.min,x.max,x.avg,x.stddev]));const[b,S]=yr(n.pixelType);if(!(h!=null&&h.length)){for(h=[],y=0;y<u;y++)h.push([b,S,1,1]);c==="standardDeviation"&&(c="minMax")}switch(c){case"none":for(y=0;y<u;y++)a[y]=b,g[y]=S;break;case"minMax":for(y=0;y<u;y++){const x=h[y];a[y]=x[0],g[y]=x[1]}break;case"standardDeviation":for(y=0;y<u;y++){const x=h[y];a[y]=x[2]-e.numberOfStandardDeviations*x[3],g[y]=x[2]+e.numberOfStandardDeviations*x[3],a[y]<x[0]&&(a[y]=x[0]),g[y]>x[1]&&(g[y]=x[1])}break;case"histogramEqualization":for(Fe(o),y=0;y<u;y++)a[y]=o[y].min,g[y]=o[y].max;break;case"percentClip":for(Fe(o),y=0;y<o.length;y++){for(f=o[y],C=new Uint32Array(f.size),m=[...f.counts],m.length>=20&&(m[0]=m[1]=m[2]=m[m.length-1]=m[m.length-2]=0),w=0,d=(f.max-f.min)/f.size,p=f.min===-.5&&d===1?.5:0,v=0;v<f.size;v++)w+=m[v],C[v]=w;for(l=(e.minPercent||0)*w/100,a[y]=f.min+p,v=0;v<f.size;v++)if(C[v]>l){a[y]=f.min+d*(v+p);break}for(l=(1-(e.maxPercent||0)/100)*w,g[y]=f.max+p,v=f.size-2;v>=0;v--)if(C[v]<l){g[y]=f.min+d*(v+2-p);break}if(g[y]<a[y]){const x=a[y];a[y]=g[y],g[y]=x}}break;default:for(y=0;y<u;y++){const x=h[y];a[y]=x[0],g[y]=x[1]}}let T,k,I;return c==="histogramEqualization"?(Fe(o),k=o[0].size||256,T=0,s&&(I=o.map(x=>ar(x)))):(k=e.max||255,T=e.min||0),Do({minCutOff:a,maxCutOff:g,outMax:k,outMin:T,histogramLut:I},i)}function Do(e,t){if(t==null||t.length===0)return e;const r=Math.max.apply(null,t),{minCutOff:i,maxCutOff:s,outMin:n,outMax:h,histogramLut:o}=e;return i.length===t.length||i.length<=r?e:{minCutOff:t.map(c=>i[c]),maxCutOff:t.map(c=>s[c]),histogramLut:o?t.map(c=>o[c]):null,outMin:n,outMax:h}}function sr(e,t){const r=new Float32Array(e);for(let i=0;i<e;i++)t[i]>1?t[i]>2?r[i]=6.5+(t[i]-2)**2.5:r[i]=6.5+100*(2-t[i])**4:r[i]=1;return r}function Ze(e,t){var x;if(e==null||!((x=e.pixels)!=null&&x.length))return e;const{mask:r,width:i,height:s,pixels:n}=e,{minCutOff:h,maxCutOff:o,gamma:c}=t,u=t.outMin||0,a=t.outMax||255,g=i*s,f=t.outputPixelType||"u8",d=e.pixels.map(()=>te.createEmptyBand(f,g)),w=d.length;let m,C,l,p,y;const v=a-u,b=[],S=[];for(m=0;m<w;m++)S[m]=o[m]-h[m],b[m]=S[m]===0?0:v/S[m];const T=f.startsWith("u")||f.startsWith("s"),k=c&&c.length>=w,I=!!t.isRenderer;if(k){const D=sr(w,c);for(C=0;C<g;C++)if(r==null||r[C])for(m=0;m<w;m++)if(S[m]!==0)if(l=n[m][C],y=(l-h[m])/S[m],p=1,c[m]>1&&(p-=(1/v)**(y*D[m])),l<o[m]&&l>h[m]){const E=p*v*y**(1/c[m])+u;d[m][C]=I?Math.floor(E):T?Math.round(E):E}else l>=o[m]?d[m][C]=a:d[m][C]=u;else d[m][C]=u}else for(C=0;C<g;C++)if(r==null||r[C])for(m=0;m<w;m++)if(l=n[m][C],l<o[m]&&l>h[m]){const D=(l-h[m])*b[m]+u;d[m][C]=I?Math.floor(D):T?Math.round(D):D}else l>=o[m]?d[m][C]=a:d[m][C]=u;const A=new te({width:i,height:s,mask:r,pixels:d,pixelType:f});return A.updateStatistics(),A}function Eo(e,t){const{attributeTable:r,bandCount:i}=e;return!(r==null||i>1||t&&r.fields.find(s=>s.name.toLowerCase()===t.toLowerCase())==null)}function Po(e){const{bandCount:t,dataType:r,pixelType:i}=e;return r==="elevation"||r==="generic"&&t===1&&(i==="s16"||i==="f32"||i==="f64")}function Ro(e){const{bandCount:t,colormap:r}=e;return r!=null&&r.length>0&&t===1}let ve=class extends Me{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case"uniqueValue":t=this._updateUVRenderer(e);break;case"rasterColormap":t=this._updateColormapRenderer(e);break;case"rasterStretch":t=this._updateStretchRenderer(e);break;case"classBreaks":t=this._updateClassBreaksRenderer(e);break;case"rasterShadedRelief":t=this._updateShadedReliefRenderer(e);break;case"vectorField":t=this._updateVectorFieldRenderer();break;case"flowRenderer":t=this._updateFlowRenderer()}return t}symbolize(e){let t=e&&e.pixelBlock;if(!Ft(t))return t;if(e.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(t,e.simpleStretchParams);try{let r;switch(t.pixels.length>3&&(t=bt(t,[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolizeColormap(t);break;case"classBreaks":r=this._symbolizeClassBreaks(t);break;case"rasterStretch":r=this._symbolizeStretch(t,e.bandIds);break;case"rasterShadedRelief":{const i=e.extent,s=i.spatialReference.isGeographic,n={x:(i.xmax-i.xmin)/t.width,y:(i.ymax-i.ymin)/t.height};r=this._symbolizeShadedRelief(t,{isGCS:s,resolution:n});break}}return r}catch(r){return vt.getLogger(this.declaredClass).error("symbolize",r.message),t}}simpleStretch(e,t){if(!Ft(e))return e;try{return e.pixels.length>3&&(e=bt(e,[0,1,2])),Ze(e,{...t,isRenderer:!0})}catch(r){return vt.getLogger(this.declaredClass).error("symbolize",r.message),e}}generateWebGLParameters(e){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){const{indexedColormap:h,offset:o}=this.lookup.colormapLut||{};return{colormap:h,colormapOffset:o,type:"lut"}}const{pixelBlock:t,isGCS:r,resolution:i,bandIds:s}=e,{rendererJSON:n}=this;return n.type==="rasterStretch"?this._generateStretchWebGLParams(t,n,s):n.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(n,r,i??void 0):n.type==="vectorField"?this._generateVectorFieldWebGLParams(n):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(e){return this._isLUTChanged()&&!this.bind().success?e:Ye(e,this.lookup.colormapLut)}_symbolizeClassBreaks(e){const{canUseIndexedLUT:t}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?e:t?Ye(e,this.lookup.colormapLut):Cr(e,this.lookup.remapLut??[])}_symbolizeStretch(e,t){var g,f;const{rasterInfo:r}=this,{pixelType:i,bandCount:s}=r,n=this.rendererJSON,h=["u8","u16","s8","s16"].includes(i);let o,c;const{dra:u}=n,{gamma:a}=this.lookup;if(n.stretchType==="histogramEqualization"){const d=u?null:(g=this.lookup)==null?void 0:g.histogramLut,w=Le(n,{rasterInfo:r,pixelBlock:e,bandIds:t,returnHistogramLut:!d}),m=Ze(e,{...w,gamma:a,isRenderer:!0});c=Tt(m,{lut:u?w.histogramLut:d,offset:0})}else if(h){if(u){const d=Le(n,{rasterInfo:r,pixelBlock:e,bandIds:t});o=Nt({pixelType:i,...d,gamma:a,rounding:"floor"})}else if(this._isLUTChanged()){if(!this.bind().success)return e;o=this.lookup?this.lookup.stretchLut:null}else o=this.lookup?this.lookup.stretchLut:null;if(!o)return e;s>1&&t!=null&&t.length===(e==null?void 0:e.pixels.length)&&(o==null?void 0:o.lut.length)===s&&(o={lut:t.map(d=>o.lut[d]),offset:o.offset}),c=Tt(e,o)}else{const d=Le(n,{rasterInfo:r,pixelBlock:e,bandIds:t});c=Ze(e,{...d,gamma:a,isRenderer:!0})}if(n.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;c=Ye(c,(f=this.lookup)==null?void 0:f.colormapLut)}return c}_symbolizeShadedRelief(e,t){var o;const r=this.rendererJSON,i={...r,...t},s=co(e,i);if(!r.colorRamp)return s;let n;if(this._isLUTChanged(!0)){if(!this.bind().success)return s;n=this.lookup?this.lookup.hsvMap:null}else n=this.lookup?this.lookup.hsvMap:null;if(!n)return s;const h=((o=this.rasterInfo.statistics)==null?void 0:o[0])??{min:0,max:8e3};return ho(s,e,n,h),s}_isVectorFieldData(){const{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t==="vector-magdir"||t==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){var u;const{bandCount:t,attributeTable:r,pixelType:i}=this.rasterInfo,s=e.field1;if(!s)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const n=e.defaultSymbol,h=t===1&&["u8","s8"].includes(i);if(!Eo(this.rasterInfo,s)&&!h)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};const o=[];if(r!=null){const a=r.fields.find(g=>g.name.toLowerCase()==="value");if(!a)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};r.features.forEach(g=>{var w,m;const f=(w=e.uniqueValueInfos)==null?void 0:w.find(C=>String(C.value)===String(g.attributes[s])),d=(m=f==null?void 0:f.symbol)==null?void 0:m.color;d?o.push([g.attributes[a.name]].concat(d)):n&&o.push([g.attributes[a.name]].concat(n.color))})}else{if(s.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not availalbe.'};(u=e.uniqueValueInfos)==null||u.forEach(a=>{var f;const g=(f=a==null?void 0:a.symbol)==null?void 0:f.color;g?o.push([parseInt(""+a.value,10)].concat(g)):n&&o.push([parseInt(""+a.value,10)].concat(n==null?void 0:n.color))})}if(o.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};const c=Pe({colormap:o});return this.lookup={rendererJSON:e,colormapLut:c},this.canRenderInWebGL=!0,{success:!0}}_updateColormapRenderer(e){if(!Ro(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};const t=e.colormapInfos.map(i=>[i.value].concat(i.color)).sort((i,s)=>i[0]-s[0]);if(!t||t.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};const r=Pe({colormap:t});return this.lookup={rendererJSON:e,colormapLut:r},this.canRenderInWebGL=!0,{success:!0}}_updateShadedReliefRenderer(e){if(!Po(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(e.colorRamp){const t=Ot(e.colorRamp,{interpolateAlpha:!0}),r=Pe({colormap:t}),i=[],s=r.indexedColormap;for(let n=0;n<s.length;n+=4){const h=Ve({r:s[n],g:s[n+1],b:s[n+2]});i.push([h.h/60,h.s/100,255*h.v/100])}this.lookup={rendererJSON:e,colormapLut:r,hsvMap:i}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(e){const{attributeTable:t,pixelType:r}=this.rasterInfo,i=t!=null?t.fields.find(h=>h.name.toLowerCase()==="value"):null,s=t!=null?t.fields.find(h=>h.name.toLowerCase()===e.field.toLowerCase()):null,n=i!=null&&s!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(r)||n,tableValueField:i,tableBreakField:s}}_updateClassBreaksRenderer(e){const{attributeTable:t}=this.rasterInfo,{canUseIndexedLUT:r,tableValueField:i,tableBreakField:s}=this._analyzeClassBreaks(e),n=e.classBreakInfos;if(!(n!=null&&n.length))return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};const h=n.sort((g,f)=>g.classMaxValue-f.classMaxValue),o=h[h.length-1];let c=e.minValue;if(!r){const g=[];for(let f=0;f<h.length;f++)g.push({value:h[f].classMinValue??c,mappedColor:h[f].symbol.color}),c=h[f].classMaxValue;return g.push({value:o.classMaxValue,mappedColor:o.symbol.color}),this.lookup={rendererJSON:e,remapLut:g},this.canRenderInWebGL=!1,{success:!0}}const u=[];if(t!=null&&i!=null&&s!==null&&i!==s){const g=i.name,f=s.name,d=h[h.length-1],{classMaxValue:w}=d;c=e.minValue;for(const m of t.features){const C=m.attributes[g],l=m.attributes[f],p=l===w?d:l<c?null:h.find(({classMaxValue:y})=>y>l);p&&u.push([C].concat(p.symbol.color))}}else{c=Math.floor(e.minValue);for(let g=0;g<h.length;g++){const f=h[g];for(let d=c;d<f.classMaxValue;d++)u.push([d].concat(f.symbol.color));c=Math.ceil(f.classMaxValue)}o.classMaxValue===c&&u.push([o.classMaxValue].concat(o.symbol.color))}const a=Pe({colormap:u,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:a},this.canRenderInWebGL=!0,{success:!0}}_isHistogramRequired(e){return e==="percentClip"||e==="histogramEqualization"}_isValidRasterStatistics(e){return e!=null&&e.length>0&&e[0].min!=null&&e[0].max!=null}_updateStretchRenderer(e){var a,g;let{stretchType:t,dra:r}=e;if(!(t==="none"||(a=e.statistics)!=null&&a.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||r))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};const i=e.histograms||this.rasterInfo.histograms;!this._isHistogramRequired(e.stretchType)||i!=null&&i.length||r||(t="minMax");const{computeGamma:s,useGamma:n,colorRamp:h}=e;let{gamma:o}=e;if(n&&s&&!(o!=null&&o.length)){const f=(g=e.statistics)!=null&&g.length?e.statistics:this.rasterInfo.statistics;o=ko(this.rasterInfo.pixelType,f)}const c=this.rasterInfo.pixelType,u=!r&&["u8","u16","s8","s16"].includes(c);if(t==="histogramEqualization"){const f=i.map(d=>ar(d));this.lookup={rendererJSON:e,histogramLut:f}}else if(u){const f=Le(e,{rasterInfo:this.rasterInfo}),d=Nt({pixelType:c,...f,gamma:n?o:null,rounding:"floor"});this.lookup={rendererJSON:e,stretchLut:d}}if(h){const f=Ot(h,{interpolateAlpha:!0});this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=Pe({colormap:f}),this.lookup.rendererJSON=e}return this.lookup.gamma=n&&(o!=null&&o.length)?o:null,this.canRenderInWebGL=!0,{success:!0}}_generateStretchWebGLParams(e,t,r){let i=null,s=null;const n=this.lookup&&this.lookup.colormapLut;t.colorRamp&&n&&(i=n.indexedColormap,s=n.offset),t.stretchType==="histogramEqualization"&&(t={...t,stretchType:"minMax"});const{gamma:h}=this.lookup,o=!!(t.useGamma&&h&&h.some(y=>y!==1)),{minCutOff:c,maxCutOff:u,outMin:a,outMax:g}=Le(t,{rasterInfo:this.rasterInfo,pixelBlock:e,bandIds:r});let f=0;e!=null&&(f=e.getPlaneCount(),f===2&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const{bandCount:d}=this.rasterInfo,w=Math.min(3,(r==null?void 0:r.length)||f||d,d),m=new Float32Array(w),C=i||o?1:255;let l;for(l=0;l<c.length;l++)m[l]=u[l]===c[l]?0:(g-a)/(u[l]-c[l])/C;const p=new Float32Array(w);if(o&&h)for(l=0;l<w;l++)h[l]>1?h[l]>2?p[l]=6.5+(h[l]-2)**2.5:p[l]=6.5+100*(2-h[l])**4:p[l]=1;return{bandCount:w,outMin:a/C,outMax:g/C,minCutOff:c,maxCutOff:u,factor:m,useGamma:o,gamma:o?h:[1,1,1],gammaCorrection:o?p:[1,1,1],colormap:i,colormapOffset:s,stretchType:t.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(e,t=!1,r={x:0,y:0}){var u;let i=null,s=null;const n=this.lookup&&this.lookup.colormapLut;e.colorRamp&&n&&(i=n.indexedColormap,s=n.offset);const h={...e,isGCS:t,resolution:r},o=tr(h),c=(u=this.rasterInfo.statistics)==null?void 0:u[0];return{...o,minValue:(c==null?void 0:c.min)??0,maxValue:(c==null?void 0:c.max)??8e3,hillshadeType:e.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:i,colormapOffset:s}}_generateVectorFieldWebGLParams(e){var l,p,y;const{style:t,inputUnit:r,outputUnit:i,visualVariables:s,symbolTileSize:n,flowRepresentation:h}=e;let o;const c=((l=this.rasterInfo.statistics)==null?void 0:l[0].min)??0,u=((p=this.rasterInfo.statistics)==null?void 0:p[0].max)??50,a=(s==null?void 0:s.find(v=>v.type==="sizeInfo"))??{type:"sizeInfo",field:"Magnitude",maxDataValue:u,maxSize:.8*n,minDataValue:c,minSize:.2*n},g=a.minDataValue??c,f=a.maxDataValue??u,d=a.maxSize!=null&&a.minSize!=null?[a.minSize/n,a.maxSize/n]:[.2,.8];if(t==="wind_speed"){const v=(d[0]+d[1])/2;d[0]=d[1]=v}const w=g!=null&&f!=null?[g,f]:null;if(t==="classified_arrow")if(g!=null&&f!=null&&a!=null){o=[];const v=(a.maxDataValue-a.minDataValue)/5;for(let b=0;b<6;b++)o.push(a.minDataValue+v*b)}else o=[0,1e-6,3.5,7,10.5,14];const m=h==="flow_to"==(t==="ocean_current_kn"||t==="ocean_current_m")?0:Math.PI,C=s==null?void 0:s.find(v=>v.type==="rotationInfo");return{breakValues:o,dataRange:w,inputUnit:r,outputUnit:i,symbolTileSize:n,symbolPercentRange:d,style:t||"single_arrow",rotation:m,rotationType:(y=this.rasterInfo.storageInfo)!=null&&y.tileInfo&&this.rasterInfo.dataType==="vector-uv"?"geographic":(C==null?void 0:C.rotationType)||e.rotationType,type:"vectorField"}}};function Ft(e){return Te(e)&&e.validPixelCount!==0}B([O({json:{write:!0}})],ve.prototype,"rendererJSON",void 0),B([O({type:uo,json:{write:!0}})],ve.prototype,"rasterInfo",void 0),B([O({json:{write:!0}})],ve.prototype,"lookup",void 0),B([O()],ve.prototype,"canRenderInWebGL",void 0),ve=B([Be("esri.renderers.support.RasterSymbolizer")],ve);const Jo=ve;export{zr as B,mo as C,gt as D,Fr as L,Ze as M,qt as N,_o as P,mt as R,Xt as U,Jo as V,Ot as _,Fo as a,fo as b,Yo as c,jo as d,No as e,Nt as f,sr as g,Ao as h,Ho as i,Uo as j,vo as k,lo as l,uo as m,Vo as n,bo as o,Le as p,rr as q,Dr as r,xe as s,Ko as t,$o as u,zo as v,dt as w,jr as x,Wo as y,Ae as z};
