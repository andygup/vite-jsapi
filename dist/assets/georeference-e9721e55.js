import{gv as gt,gG as ft,gH as pt,gI as yt,gJ as ht,br as mt,fV as tt,gF as $t,af as h,ag as A,aj as At,bD as Ft,e as b,by as Pt,gK as Tt,gL as rt,gM as Y,gN as C,gO as wt,gP as I,gQ as Mt,O as vt,gR as xt,gS as dt,gT as N,N as Rt,gU as q,fP as D,fO as W,gV as bt,gB as Ct,gW as Ot,gX as _t,gY as zt,gZ as O,g_ as nt,g$ as Et,R as Nt,fu as jt,dY as Lt}from"./index-989909ce.js";import{e as et}from"./mat3f64-221ce671.js";import{e as F,o as Bt}from"./mat4f64-1413b4a7.js";import{c as M}from"./spatialReferenceEllipsoidUtils-dbdaf591.js";import{v as L,y as Vt,x as Gt}from"./quat-6714c1ef.js";import{e as S}from"./quatf64-3363c48e.js";import{r as w,n as P,s as ot}from"./vec32-c2909e9e.js";import{i as m,T as $}from"./BufferView-d0acf3a4.js";function y(t=St){return[t[0],t[1],t[2],t[3]]}function j(t,r,n=y()){return gt(n,t),n[3]=r,n}function H(t,r,n=y()){return L(v,t,B(t)),L(k,r,B(r)),Vt(v,k,v),It(n,ht(Gt(n,v)))}function Fr(t,r,n,e=y()){return j(ft,t,x),j(pt,r,J),j(yt,n,K),H(x,J,x),H(x,K,e),e}function Pr(t){return t}function B(t){return mt(t[3])}function It(t,r){return t[3]=r,t}const St=[0,0,1,0],v=S(),k=S();y();const x=y(),J=y(),K=y();function Q(t,r=!1){return t<=tt?r?new Array(t).fill(0):new Array(t):new Float64Array(t)}function Ut(t){return($t(t)?t.length:t.byteLength/8)<=tt?Array.from(t):new Float64Array(t)}function Tr(t,r,n){return Array.isArray(t)?t.slice(r,r+n):t.subarray(r,r+n)}var V;let f=V=class extends Ft{constructor(t){super(t),this.origin=b(),this.translation=b(),this.rotation=y(),this.scale=Pt(1,1,1),this.geographic=!0}get localMatrix(){const t=F();return L(X,this.rotation,B(this.rotation)),Tt(t,X,this.translation,this.scale),t}get localMatrixInverse(){return rt(F(),this.localMatrix)}applyLocal(t,r){return Y(r,t,this.localMatrix)}applyLocalInverse(t,r){return Y(r,t,this.localMatrixInverse)}project(t,r){if(this.geographic){const a=M(r),i=F();C(r,this.origin,i,a),wt(i,i,this.localMatrix);const l=Q(t.length);return w(l,t,i),I(l,a,0,l,r,0,l.length/3),l}const{localMatrix:n,origin:e}=this,o=Mt(n,Bt)?Ut(t):w(Q(t.length),t,n);for(let a=0;a<o.length;a+=3)o[a]+=e[0],o[a+1]+=e[1],o[a+2]+=e[2];return o}getOriginPoint(t){const[r,n,e]=this.origin;return new vt({x:r,y:n,z:e,spatialReference:t})}equals(t){return t!=null&&this.geographic===t.geographic&&xt(this.origin,t.origin)&&dt(this.localMatrix,t.localMatrix)}clone(){const t={origin:N(this.origin),translation:N(this.translation),rotation:y(this.rotation),scale:N(this.scale),geographic:this.geographic};return new V(t)}};h([A({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"origin",void 0),h([A({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"translation",void 0),h([A({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"rotation",void 0),h([A({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"scale",void 0),h([A({type:Boolean,nonNullable:!0,json:{write:!0}})],f.prototype,"geographic",void 0),h([A()],f.prototype,"localMatrix",null),h([A()],f.prototype,"localMatrixInverse",null),f=V=h([At("esri.geometry.support.MeshTransform")],f);const X=S(),Yt=f;function at(t,r){return t.isGeographic||t.isWebMercator&&((r==null?void 0:r.geographic)??!0)}const _=Rt.getLogger("esri.geometry.support.meshUtils.normalProjection");function qt(t,r,n,e,o){return E(e)?(z(p.TO_PCPF,m.fromTypedArray(t),$.fromTypedArray(r),$.fromTypedArray(n),e,m.fromTypedArray(o)),o):(_.error("Cannot convert spatial reference to PCPF"),o)}function Dt(t,r,n,e,o){return E(e)?(z(p.FROM_PCPF,m.fromTypedArray(t),$.fromTypedArray(r),$.fromTypedArray(n),e,m.fromTypedArray(o)),o):(_.error("Cannot convert to spatial reference from PCPF"),o)}function Wt(t,r,n){return I(t,r,0,n,M(r),0,t.length/3),n}function Ht(t,r,n){return I(t,M(n),0,r,n,0,t.length/3),r}function kt(t,r,n){return O(c,n),P(r,t,c),nt(c)||ot(r,r),r}function Jt(t,r,n){if(O(c,n),P(r,t,c,4),nt(c)||ot(r,r,4),t!==r)for(let e=3;e<t.length;e+=4)r[e]=t[e];return r}function Kt(t,r,n,e,o){if(!E(e))return _.error("Cannot convert spatial reference to PCPF"),o;z(p.TO_PCPF,m.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),$.fromTypedArray(r),$.fromTypedArray(n),e,m.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function Qt(t,r,n,e,o){if(!E(e))return _.error("Cannot convert to spatial reference from PCPF"),o;z(p.FROM_PCPF,m.fromTypedArray(t,16),$.fromTypedArray(r),$.fromTypedArray(n),e,m.fromTypedArray(o,16));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function z(t,r,n,e,o,a){if(!r)return;const i=n.count,l=M(o);if(it(o))for(let u=0;u<i;u++)e.getVec(u,d),r.getVec(u,g),C(l,d,R,l),q(c,R),t===p.FROM_PCPF&&D(c,c),W(g,g,c),a.setVec(u,g);else for(let u=0;u<i;u++){e.getVec(u,d),r.getVec(u,g),C(l,d,R,l),q(c,R);const T=bt(n.get(u,1));let s=Math.cos(T);t===p.TO_PCPF&&(s=1/s),c[0]*=s,c[1]*=s,c[2]*=s,c[3]*=s,c[4]*=s,c[5]*=s,t===p.FROM_PCPF&&D(c,c),W(g,g,c),Ct(g,g),a.setVec(u,g)}return a}function E(t){return it(t)||Xt(t)}function it(t){return t.isWGS84||Ot(t)||_t(t)||zt(t)}function Xt(t){return t.isWebMercator}var p;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(p||(p={}));const d=b(),g=b(),R=F(),c=et();function st(t,r,n){return at(r.spatialReference,n)?rr(t,r,n):tr(t,r,n)}function Zt(t,r,n){const{position:e,normal:o,tangent:a}=t;if(r==null)return{position:e,normal:o,tangent:a};const i=r.localMatrix;return st({position:w(new Float64Array(e.length),e,i),normal:o!=null?kt(o,new Float32Array(o.length),i):null,tangent:a!=null?Jt(a,new Float32Array(a.length),i):null},r.getOriginPoint(n),{geographic:r.geographic})}function wr(t,r,n){if(n!=null&&n.useTransform){const{position:e,normal:o,tangent:a}=t;return{vertexAttributes:{position:e,normal:o,tangent:a},transform:new Yt({origin:[r.x,r.y,r.z??0],geographic:!0})}}return{vertexAttributes:st(t,r,n),transform:null}}function Z(t,r,n){return at(r.spatialReference,n)?ar(t,r,n):lt(t,r,n)}function Mr(t,r,n,e){if(r==null)return Z(t,n,e);const o=Zt(t,r,n.spatialReference);return n.equals(r.getOriginPoint(n.spatialReference))?lt(o,n,e):Z(o,n,e)}function tr(t,r,n){const e=new Float64Array(t.position.length),o=t.position,a=r.x,i=r.y,l=r.z||0,{horizontal:u,vertical:T}=U(n?n.unit:null,r.spatialReference);for(let s=0;s<o.length;s+=3)e[s]=o[s]*u+a,e[s+1]=o[s+1]*u+i,e[s+2]=o[s+2]*T+l;return{position:e,normal:t.normal,tangent:t.tangent}}function rr(t,r,n){const e=r.spatialReference,o=ct(r,n,G),a=new Float64Array(t.position.length),i=nr(t.position,o,e,a),l=O(ut,o);return{position:i,normal:er(i,a,t.normal,l,e),tangent:or(i,a,t.tangent,l,e)}}function nr(t,r,n,e){w(e,t,r);const o=new Float64Array(t.length);return Ht(e,o,n)}function er(t,r,n,e,o){if(n==null)return null;const a=new Float32Array(n.length);return P(a,n,e),Dt(a,t,r,o,a),a}function or(t,r,n,e,o){if(n==null)return null;const a=new Float32Array(n.length);P(a,n,e,4);for(let i=3;i<a.length;i+=4)a[i]=n[i];return Qt(a,t,r,o,a),a}function lt(t,r,n){const e=new Float64Array(t.position.length),o=t.position,a=r.x,i=r.y,l=r.z||0,{horizontal:u,vertical:T}=U(n?n.unit:null,r.spatialReference);for(let s=0;s<o.length;s+=3)e[s]=(o[s]-a)/u,e[s+1]=(o[s+1]-i)/u,e[s+2]=(o[s+2]-l)/T;return{position:e,normal:t.normal,tangent:t.tangent}}function ar(t,r,n){const e=r.spatialReference;ct(r,n,G);const o=rt(cr,G),a=new Float64Array(t.position.length),i=ir(t.position,e,o,a),l=O(ut,o);return{position:i,normal:sr(t.normal,t.position,a,e,l),tangent:lr(t.tangent,t.position,a,e,l)}}function ct(t,r,n){C(t.spatialReference,[t.x,t.y,t.z||0],n,M(t.spatialReference));const{horizontal:e,vertical:o}=U(r?r.unit:null,t.spatialReference);return Et(n,n,[e,e,o]),n}function ir(t,r,n,e){const o=Wt(t,r,e),a=new Float64Array(o.length);return w(a,o,n),a}function sr(t,r,n,e,o){if(t==null)return null;const a=qt(t,r,n,e,new Float32Array(t.length));return P(a,a,o),a}function lr(t,r,n,e,o){if(t==null)return null;const a=Kt(t,r,n,e,new Float32Array(t.length));return P(a,a,o,4),a}function U(t,r){if(t==null)return ur;const n=r.isGeographic?1:Nt(r),e=r.isGeographic?1:jt(r),o=Lt(1,t,"meters");return{horizontal:o*n,vertical:o*e}}const G=F(),cr=F(),ut=et(),ur={horizontal:1,vertical:1};export{Ht as E,Yt as L,Kt as R,j as U,qt as _,Tr as a,Qt as b,y as c,Pr as d,Ut as e,Mr as f,H as g,Wt as h,Dt as j,Z as k,Fr as l,at as r,Q as t,Zt as v,B as w,wr as x,st as z};
