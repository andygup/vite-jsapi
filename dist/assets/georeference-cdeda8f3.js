import{g3 as it,ge as N,gf as st,gg as lt,gh as ct,aD as ut,gi as V,eB as J,gd as gt,ab as y,ac as A,ad as ft,aS as pt,e as C,aK as yt,gj as ht,gk as Q,gl as $,gm as G,gn as R,go as mt,gp as S,gq as At,gr as $t,K as Ft,gs as Pt,gt as Tt,gu as E,J as wt,gv as I,el as D,ek as U,gw as dt,g9 as vt,gx as Mt,gy as xt,gz as Ct,b7 as X,gA as b,gB as Z,gC as Rt,Q as bt,gD as Ot,gE as _t}from"./index-9f03d686.js";import{c as d}from"./spatialReferenceEllipsoidUtils-c4e438b2.js";import{r as T,n as F,s as tt}from"./vec32-59ce53ff.js";import{i as h,T as m}from"./BufferView-595f5888.js";function w(t=Et){return[t[0],t[1],t[2],t[3]]}function sr(t,r,n=w()){return it(n,t),n[3]=r,n}function lr(t,r,n=w()){return N(v,t,j(t)),N(K,r,j(r)),st(v,K,v),zt(n,lt(ct(n,v)))}function cr(t){return t}function j(t){return ut(t[3])}function zt(t,r){return t[3]=r,t}const Et=[0,0,1,0],v=V(),K=V();w();function W(t,r=!1){return t<=J?r?new Array(t).fill(0):new Array(t):new Float64Array(t)}function Nt(t){return(gt(t)?t.length:t.byteLength/8)<=J?Array.from(t):new Float64Array(t)}function ur(t,r,n){return Array.isArray(t)?t.slice(r,r+n):t.subarray(r,r+n)}var B;let f=B=class extends pt{constructor(t){super(t),this.origin=C(),this.translation=C(),this.rotation=w(),this.scale=yt(1,1,1),this.geographic=!0}get localMatrix(){const t=$();return N(Y,this.rotation,j(this.rotation)),ht(t,Y,this.translation,this.scale),t}get localMatrixInverse(){return Q($(),this.localMatrix)}applyLocal(t,r){return G(r,t,this.localMatrix)}applyLocalInverse(t,r){return G(r,t,this.localMatrixInverse)}project(t,r){if(this.geographic){const a=d(r),i=$();R(r,this.origin,i,a),mt(i,i,this.localMatrix);const l=W(t.length);return T(l,t,i),S(l,a,0,l,r,0,l.length/3),l}const{localMatrix:n,origin:e}=this,o=At(n,$t)?Nt(t):T(W(t.length),t,n);for(let a=0;a<o.length;a+=3)o[a]+=e[0],o[a+1]+=e[1],o[a+2]+=e[2];return o}getOriginPoint(t){const[r,n,e]=this.origin;return new Ft({x:r,y:n,z:e,spatialReference:t})}equals(t){return t!=null&&this.geographic===t.geographic&&Pt(this.origin,t.origin)&&Tt(this.localMatrix,t.localMatrix)}clone(){const t={origin:E(this.origin),translation:E(this.translation),rotation:w(this.rotation),scale:E(this.scale),geographic:this.geographic};return new B(t)}};y([A({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"origin",void 0),y([A({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"translation",void 0),y([A({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"rotation",void 0),y([A({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"scale",void 0),y([A({type:Boolean,nonNullable:!0,json:{write:!0}})],f.prototype,"geographic",void 0),y([A()],f.prototype,"localMatrix",null),y([A()],f.prototype,"localMatrixInverse",null),f=B=y([ft("esri.geometry.support.MeshTransform")],f);const Y=V(),jt=f;function k(t,r){return t.isGeographic||t.isWebMercator&&((r==null?void 0:r.geographic)??!0)}const O=wt.getLogger("esri.geometry.support.meshUtils.normalProjection");function Bt(t,r,n,e,o){return z(e)?(_(p.TO_PCPF,h.fromTypedArray(t),m.fromTypedArray(r),m.fromTypedArray(n),e,h.fromTypedArray(o)),o):(O.error("Cannot convert spatial reference to PCPF"),o)}function Lt(t,r,n,e,o){return z(e)?(_(p.FROM_PCPF,h.fromTypedArray(t),m.fromTypedArray(r),m.fromTypedArray(n),e,h.fromTypedArray(o)),o):(O.error("Cannot convert to spatial reference from PCPF"),o)}function Vt(t,r,n){return S(t,r,0,n,d(r),0,t.length/3),n}function St(t,r,n){return S(t,d(n),0,r,n,0,t.length/3),r}function kt(t,r,n){return b(c,n),F(r,t,c),Z(c)||tt(r,r),r}function qt(t,r,n){if(b(c,n),F(r,t,c,4),Z(c)||tt(r,r,4),t!==r)for(let e=3;e<t.length;e+=4)r[e]=t[e];return r}function Gt(t,r,n,e,o){if(!z(e))return O.error("Cannot convert spatial reference to PCPF"),o;_(p.TO_PCPF,h.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),m.fromTypedArray(r),m.fromTypedArray(n),e,h.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function It(t,r,n,e,o){if(!z(e))return O.error("Cannot convert to spatial reference from PCPF"),o;_(p.FROM_PCPF,h.fromTypedArray(t,16),m.fromTypedArray(r),m.fromTypedArray(n),e,h.fromTypedArray(o,16));for(let a=3;a<t.length;a+=4)o[a]=t[a];return o}function _(t,r,n,e,o,a){if(!r)return;const i=n.count,l=d(o);if(rt(o))for(let u=0;u<i;u++)e.getVec(u,M),r.getVec(u,g),R(l,M,x,l),I(c,x),t===p.FROM_PCPF&&D(c,c),U(g,g,c),a.setVec(u,g);else for(let u=0;u<i;u++){e.getVec(u,M),r.getVec(u,g),R(l,M,x,l),I(c,x);const P=dt(n.get(u,1));let s=Math.cos(P);t===p.TO_PCPF&&(s=1/s),c[0]*=s,c[1]*=s,c[2]*=s,c[3]*=s,c[4]*=s,c[5]*=s,t===p.FROM_PCPF&&D(c,c),U(g,g,c),vt(g,g),a.setVec(u,g)}return a}function z(t){return rt(t)||Dt(t)}function rt(t){return t.isWGS84||Mt(t)||xt(t)||Ct(t)}function Dt(t){return t.isWebMercator}var p;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(p||(p={}));const M=C(),g=C(),x=$(),c=X();function nt(t,r,n){return k(r.spatialReference,n)?Wt(t,r,n):Kt(t,r,n)}function Ut(t,r,n){const{position:e,normal:o,tangent:a}=t;if(r==null)return{position:e,normal:o,tangent:a};const i=r.localMatrix;return nt({position:T(new Float64Array(e.length),e,i),normal:o!=null?kt(o,new Float32Array(o.length),i):null,tangent:a!=null?qt(a,new Float32Array(a.length),i):null},r.getOriginPoint(n),{geographic:r.geographic})}function gr(t,r,n){if(n!=null&&n.useTransform){const{position:e,normal:o,tangent:a}=t;return{vertexAttributes:{position:e,normal:o,tangent:a},transform:new jt({origin:[r.x,r.y,r.z??0],geographic:k(r.spatialReference,n)})}}return{vertexAttributes:nt(t,r,n),transform:null}}function H(t,r,n){return k(r.spatialReference,n)?Qt(t,r,n):et(t,r,n)}function fr(t,r,n,e){if(r==null)return H(t,n,e);const o=Ut(t,r,n.spatialReference);return n.equals(r.getOriginPoint(n.spatialReference))?et(o,n,e):H(o,n,e)}function Kt(t,r,n){const e=new Float64Array(t.position.length),o=t.position,a=r.x,i=r.y,l=r.z||0,{horizontal:u,vertical:P}=q(n?n.unit:null,r.spatialReference);for(let s=0;s<o.length;s+=3)e[s]=o[s]*u+a,e[s+1]=o[s+1]*u+i,e[s+2]=o[s+2]*P+l;return{position:e,normal:t.normal,tangent:t.tangent}}function Wt(t,r,n){const e=r.spatialReference,o=ot(r,n,L),a=new Float64Array(t.position.length),i=Yt(t.position,o,e,a),l=b(at,o);return{position:i,normal:Ht(i,a,t.normal,l,e),tangent:Jt(i,a,t.tangent,l,e)}}function Yt(t,r,n,e){T(e,t,r);const o=new Float64Array(t.length);return St(e,o,n)}function Ht(t,r,n,e,o){if(n==null)return null;const a=new Float32Array(n.length);return F(a,n,e),Lt(a,t,r,o,a),a}function Jt(t,r,n,e,o){if(n==null)return null;const a=new Float32Array(n.length);F(a,n,e,4);for(let i=3;i<a.length;i+=4)a[i]=n[i];return It(a,t,r,o,a),a}function et(t,r,n){const e=new Float64Array(t.position.length),o=t.position,a=r.x,i=r.y,l=r.z||0,{horizontal:u,vertical:P}=q(n?n.unit:null,r.spatialReference);for(let s=0;s<o.length;s+=3)e[s]=(o[s]-a)/u,e[s+1]=(o[s+1]-i)/u,e[s+2]=(o[s+2]-l)/P;return{position:e,normal:t.normal,tangent:t.tangent}}function Qt(t,r,n){const e=r.spatialReference;ot(r,n,L);const o=Q(rr,L),a=new Float64Array(t.position.length),i=Xt(t.position,e,o,a),l=b(at,o);return{position:i,normal:Zt(t.normal,t.position,a,e,l),tangent:tr(t.tangent,t.position,a,e,l)}}function ot(t,r,n){R(t.spatialReference,[t.x,t.y,t.z||0],n,d(t.spatialReference));const{horizontal:e,vertical:o}=q(r?r.unit:null,t.spatialReference);return Rt(n,n,[e,e,o]),n}function Xt(t,r,n,e){const o=Vt(t,r,e),a=new Float64Array(o.length);return T(a,o,n),a}function Zt(t,r,n,e,o){if(t==null)return null;const a=Bt(t,r,n,e,new Float32Array(t.length));return F(a,a,o),a}function tr(t,r,n,e,o){if(t==null)return null;const a=Gt(t,r,n,e,new Float32Array(t.length));return F(a,a,o,4),a}function q(t,r){if(t==null)return nr;const n=r.isGeographic?1:bt(r),e=r.isGeographic?1:Ot(r),o=_t(1,t,"meters");return{horizontal:o*n,vertical:o*e}}const L=$(),rr=$(),at=X(),nr={horizontal:1,vertical:1};export{St as E,jt as L,Gt as R,Bt as _,ur as a,It as b,w as c,lr as d,Nt as e,j as f,cr as g,Vt as h,sr as i,Lt as j,H as k,fr as l,k as r,W as t,Ut as v,gr as x,nt as z};
