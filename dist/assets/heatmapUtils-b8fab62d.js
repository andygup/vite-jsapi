import{dh as j,u as x,em as v,G as b}from"./index-6eb28d6b.js";import{n as D}from"./vec4f64-aa64c7e9.js";const p=2.4;function R(t){return j(t*p)}function S(t){return x(t)/p}function E(t,o,n,e){let{color:f,ratio:a}=o,{color:c,ratio:r}=n;r===a&&(r===1?a-=1e-6:r+=1e-6);const i=b((e-a)/(r-a),0,1);v(t,f.toArray(),c.toArray(),i)}function V(t){const n=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:r})=>r>=0&&r<=1).sort((r,i)=>r.ratio-i.ratio).map(({color:r,ratio:i})=>({color:r,ratio:Math.max(i,.001)})),t.length<1)return n;let e=t[0],f=t[0],a=1;const c=D();for(let r=0;r<512;r++){const i=(r+.5)/512;for(;i>f.ratio&&a<t.length;)e=f,f=t[a++];E(c,e,f,i),n.set(c,4*r)}return n}function Y(t,o,n,e){const{radius:f,fieldOffset:a,field:c}=o,r=Math.round(x(f)),i=new Float64Array(n*e);let s,l=Number.NEGATIVE_INFINITY;const g=T(c,a),A=new Set;for(const w of t){const h=w.getCursor();for(;h.next();){const M=h.getObjectId();if(A.has(M))continue;A.add(M);const u=h.readLegacyPointGeometry(),y=128;if(u.x<-y||u.x>=n+y||u.y<-y||u.y>e+y)continue;const I=+g(h),U=Math.max(0,Math.round(u.x)-r),N=Math.max(0,Math.round(u.y)-r),C=Math.min(e,Math.round(u.y)+r),F=Math.min(n,Math.round(u.x)+r);for(let d=N;d<C;d++)for(let m=U;m<F;m++){const G=d*n+m,$=P(u.x-m,u.y-d,r);s=i[G]+=$*I,s>l&&(l=s)}}}return{matrix:i.buffer,max:l}}function _(t,o,n,e,f,a){t.canvas.width=t.canvas.height=o,t.clearRect(0,0,o,o);const c=t.getImageData(0,0,o,o);n&&e&&c.data.set(new Uint8ClampedArray(O(o,n,e,f,a))),t.putImageData(c,0,0)}function O(t,o,n,e,f){const a=new Uint32Array(t*t),c="buffer"in o?o:new Float64Array(o),r="buffer"in n?new Uint32Array(n.buffer):new Uint32Array(new Uint8Array(n).buffer),i=r.length/(f-e);for(let s=0;s<c.length;s++){const l=c[s],g=Math.floor((l-e)*i);a[s]=r[b(g,0,r.length-1)]}return a.buffer}function P(t,o,n){const e=Math.sqrt(t**2+o**2)/n;return e>1?0:3/(Math.PI*n**2)*(1-e**2)**2}function k(t,o){return typeof t=="function"?t:t?typeof o=="string"?n=>-1*+n[t]:n=>+n[t]+o:()=>1}function T(t,o){return t!=null?typeof o=="string"?n=>-1*+n.readAttribute(t):n=>+n.readAttribute(t)+o:n=>1}export{p as a,S as c,R as i,_ as l,P as m,Y as s,V as u,k as y};
