import{L as cn,E as k,cp as ln,cd as un,cm as fn,cq as dn,X as an,dE as mn,dF as gn,d8 as yn}from"./index-a9c4c008.js";import{O as x,a as b}from"./OptimizedGeometry-af84d2ad.js";import{O as pn}from"./OptimizedFeatureSet-5c82fe5a.js";function v(n,e){return n?e?4:3:e?3:2}const C=cn.getLogger("esri.layers.graphics.featureConversionUtils"),Q={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},vn=(n,e,t,r,s,o)=>{n[t]=s,n[t+1]=o},$=(n,e,t,r,s,o)=>{n[t]=s,n[t+1]=o,n[t+2]=e[r+2]},Fn=(n,e,t,r,s,o)=>{n[t]=s,n[t+1]=o,n[t+2]=e[r+3]},Pn=(n,e,t,r,s,o)=>{n[t]=s,n[t+1]=o,n[t+2]=e[r+2],n[t+3]=e[r+3]};function S(n,e,t,r){if(n){if(t)return e&&r?Pn:$;if(e&&r)return Fn}else if(e&&r)return $;return vn}function O({scale:n,translate:e},t){return Math.round((t-e[0])/n[0])}function Y({scale:n,translate:e},t){return Math.round((e[1]-t)/n[1])}function N({scale:n,translate:e},t,r){return t*n[r]+e[r]}function Sn(n,e,t){return n?e?t?V(n):X(n):t?E(n):q(n):null}function q(n){const e=n.coords;return{x:e[0],y:e[1]}}function B(n,e){return n.coords[0]=e.x,n.coords[1]=e.y,n}function X(n){const e=n.coords;return{x:e[0],y:e[1],z:e[2]}}function Gn(n,e){return n.coords[0]=e.x,n.coords[1]=e.y,n.coords[2]=e.z,n}function E(n){const e=n.coords;return{x:e[0],y:e[1],m:e[2]}}function wn(n,e){return n.coords[0]=e.x,n.coords[1]=e.y,n.coords[2]=e.m,n}function V(n){const e=n.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function hn(n,e){return n.coords[0]=e.x,n.coords[1]=e.y,n.coords[2]=e.z,n.coords[3]=e.m,n}function Tn(n,e,t,r){let s=q;t&&r?s=V:t?s=X:r&&(s=E);for(const o of e){const{geometry:c,attributes:i}=o,l=c!=null?s(c):null;n.push({attributes:i,geometry:l})}return n}function U(n,e){return n&&e?hn:n?Gn:e?wn:B}function J(n,e,t,r,s){const o=U(t,r);for(const{geometry:c,attributes:i}of e){const l=c!=null?o(new x,c):null;n.push(new b(l,i,null,s?i[s]:void 0))}return n}function Xn(n,e,t=U(e.z!=null,e.m!=null)){return t(n,e)}function xn(n,e,t,r){for(const{geometry:s,attributes:o}of e)n.push({attributes:o,geometry:s!=null?H(s,t,r):null});return n}function H(n,e,t){if(n==null)return null;const r=v(e,t),s=[];for(let o=0;o<n.coords.length;o+=r){const c=[];for(let i=0;i<r;i++)c.push(n.coords[o+i]);s.push(c)}return e?t?{points:s,hasZ:e,hasM:t}:{points:s,hasZ:e}:t?{points:s,hasM:t}:{points:s}}function K(n,e,t,r,s){const o=v(t,r);for(const{geometry:c,attributes:i}of e){const l=c!=null?W(new x,c,o):null;n.push(new b(l,i,null,s?i[s]:void 0))}return n}function W(n,e,t=v(e.hasZ,e.hasM)){n.lengths[0]=e.points.length;const r=n.coords;let s=0;for(const o of e.points)for(let c=0;c<t;c++)r[s++]=o[c];return n}function zn(n,e,t,r){for(const{geometry:s,attributes:o}of e)n.push({attributes:o,geometry:s!=null?M(s,t,r):null});return n}function M(n,e,t){if(!n)return null;const r=v(e,t),{coords:s,lengths:o}=n,c=[];let i=0;for(const l of o){const u=[];for(let f=0;f<l;f++){const d=[];for(let a=0;a<r;a++)d.push(s[i++]);u.push(d)}c.push(u)}return e?t?{paths:c,hasZ:e,hasM:t}:{paths:c,hasZ:e}:t?{paths:c,hasM:t}:{paths:c}}function Z(n,e,t,r,s){const o=v(t,r);for(const{geometry:c,attributes:i}of e){const l=c!=null?nn(new x,c,o):null;n.push(new b(l,i,null,s?i[s]:void 0))}return n}function nn(n,e,t=v(e.hasZ,e.hasM)){const{lengths:r,coords:s}=n;let o=0;for(const c of e.paths){for(const i of c)for(let l=0;l<t;l++)s[o++]=i[l];r.push(c.length)}return n}function bn(n,e,t,r){for(const{geometry:s,attributes:o,centroid:c}of e){const i=s!=null?en(s,t,r):null;if(c!=null){const l=q(c);n.push({attributes:o,centroid:l,geometry:i})}else n.push({attributes:o,geometry:i})}return n}function en(n,e,t){if(!n)return null;const r=v(e,t),{coords:s,lengths:o}=n,c=[];let i=0;for(const l of o){const u=[];for(let f=0;f<l;f++){const d=[];for(let a=0;a<r;a++)d.push(s[i++]);u.push(d)}c.push(u)}return e?t?{rings:c,hasZ:e,hasM:t}:{rings:c,hasZ:e}:t?{rings:c,hasM:t}:{rings:c}}function tn(n,e,t,r,s){for(const{geometry:o,centroid:c,attributes:i}of e){const l=o!=null?rn(new x,o,t,r):null,u=s?i[s]:void 0;c!=null?n.push(new b(l,i,B(new x,c),u)):n.push(new b(l,i,null,u))}return n}function rn(n,e,t=e.hasZ,r=e.hasM){return kn(n,e.rings,t,r)}function kn(n,e,t,r){const s=v(t,r),{lengths:o,coords:c}=n;let i=0;T(n);for(const l of e){for(const u of l)for(let f=0;f<s;f++)c[i++]=u[f];o.push(l.length)}return n}const z=[],I=[];function En(n,e,t,r,s){z[0]=n;const[o]=on(I,z,e,t,r,s);return h(z),h(I),o}function on(n,e,t,r,s,o){if(h(n),!t){for(const c of e){const i=o?c.attributes[o]:void 0;n.push(new b(null,c.attributes,null,i))}return n}switch(t){case"esriGeometryPoint":return J(n,e,r,s,o);case"esriGeometryMultipoint":return K(n,e,r,s,o);case"esriGeometryPolyline":return Z(n,e,r,s,o);case"esriGeometryPolygon":return tn(n,e,r,s,o);default:C.error("convertToFeatureSet:unknown-geometry",new k(`Unable to parse unknown geometry type '${t}'`)),h(n)}return n}function Vn(n,e,t,r,s,o){const c=n.length;switch(t){case"esriGeometryPoint":J(n,e,r,s,o);break;case"esriGeometryMultipoint":K(n,e,r,s,o);break;case"esriGeometryPolyline":Z(n,e,r,s,o);break;case"esriGeometryPolygon":tn(n,e,r,s,o);break;default:C.error("convertToFeatureSet:unknown-geometry",new k(`Unable to parse unknown geometry type '${t}'`))}for(let i=0;i<e.length;i++)n[i+c].geometryType=t,n[i+c].insertAfter=e[i].insertAfter,n[i+c].groupId=e[i].groupId;return n}function Un(n,e,t,r){I[0]=n,sn(z,I,e,t,r);const s=z[0];return h(z),h(I),s}function _n(n,e,t){if(n==null)return null;const r=new x;if("hasZ"in n&&e==null&&(e=n.hasZ),"hasM"in n&&t==null&&(t=n.hasM),ln(n))return U(e??n.z!=null,t??n.m!=null)(r,n);if(un(n))return rn(r,n,e,t);if(fn(n))return nn(r,n,v(e,t));if(dn(n))return W(r,n,v(e,t));C.error("convertFromGeometry:unknown-geometry",new k(`Unable to parse unknown geometry type '${n}'`))}function Cn(n,e,t,r){const s=n&&("coords"in n?n:n.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let o=q;return t&&r?o=V:t?o=X:r&&(o=E),o(s)}case"esriGeometryMultipoint":return H(s,t,r);case"esriGeometryPolyline":return M(s,t,r);case"esriGeometryPolygon":return en(s,t,r);default:return C.error("convertToGeometry:unknown-geometry",new k(`Unable to parse unknown geometry type '${e}'`)),null}}function In(n,e){for(const t of e)n.push({attributes:t.attributes});return n}function sn(n,e,t,r,s){if(h(n),t==null)return In(n,e);switch(t){case"esriGeometryPoint":return Tn(n,e,r,s);case"esriGeometryMultipoint":return xn(n,e,r,s);case"esriGeometryPolyline":return zn(n,e,r,s);case"esriGeometryPolygon":return bn(n,e,r,s);default:C.error("convertToFeatureSet:unknown-geometry",new k(`Unable to parse unknown geometry type '${t}'`))}return n}function Rn(n){const{objectIdFieldName:e,spatialReference:t,transform:r,fields:s,hasM:o,hasZ:c,features:i,geometryType:l,exceededTransferLimit:u,uniqueIdField:f,queryGeometry:d,queryGeometryType:a}=n,y=sn([],i,l,c,o),m=Cn(d,a,!1,!1),g={features:y,fields:s,geometryType:l,objectIdFieldName:e,spatialReference:t,uniqueIdField:f,queryGeometry:m};return r&&(g.transform=r),u&&(g.exceededTransferLimit=u),o&&(g.hasM=o),c&&(g.hasZ=c),g}function $n(n,e){const t=new pn,{hasM:r,hasZ:s,features:o,objectIdFieldName:c,spatialReference:i,geometryType:l,exceededTransferLimit:u,transform:f,fields:d}=n;return d&&(t.fields=d),t.geometryType=l??null,t.objectIdFieldName=c??e??null,t.spatialReference=i??null,t.objectIdFieldName?(o&&on(t.features,o,l,s,r,t.objectIdFieldName),u&&(t.exceededTransferLimit=u),r&&(t.hasM=r),s&&(t.hasZ=s),f&&(t.transform=f),t):(C.error(new k("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),t)}function jn(n){const{transform:e,features:t,hasM:r,hasZ:s}=n;if(!e)return n;for(const o of t)o.geometry!=null&&D(o.geometry,o.geometry,r,s,e),o.centroid!=null&&D(o.centroid,o.centroid,r,s,e);return n.transform=null,n}function Dn(n,e){const{geometryType:t,features:r,hasM:s,hasZ:o}=e;if(!n)return e;for(let c=0;c<r.length;c++){const i=r[c],l=i.weakClone();l.geometry=new x,j(l.geometry,i.geometry,s,o,t,n),i.centroid&&(l.centroid=new x,j(l.centroid,i.centroid,s,o,"esriGeometryPoint",n)),r[c]=l}return e.transform=n,e}function j(n,e,t,r,s,o,c=t,i=r){if(T(n),e==null||!e.coords.length)return null;const l=Q[s],{coords:u,lengths:f}=e,d=v(t,r),a=v(t&&c,r&&i),y=S(t,r,c,i);if(!f.length)return y(n.coords,u,0,0,O(o,u[0]),Y(o,u[1])),T(n,d,0),n;let m,g,P,G,F=0,p=0,w=p;for(const _ of f){if(_<l)continue;let L=0;p=w,P=m=O(o,u[F]),G=g=Y(o,u[F+1]),y(n.coords,u,p,F,P,G),L++,F+=d,p+=a;for(let R=1;R<_;R++,F+=d)P=O(o,u[F]),G=Y(o,u[F+1]),(P!==m||G!==g)&&(y(n.coords,u,p,F,P-m,G-g),p+=a,L++,m=P,g=G);L>=l&&(n.lengths.push(L),w=p)}return h(n.coords,w),n.coords.length?n:null}function Qn(n,e,t,r,s,o,c=t,i=r){if(T(n),!e||!e.coords.length)return null;const l=Q[s],{coords:u,lengths:f}=e,d=v(t,r),a=v(t&&c,r&&i),y=S(t,r,c,i);if(!f.length)return y(n.coords,u,0,0,u[0],u[1]),T(n,d,0),n;let m=0;const g=o*o;for(const P of f){if(P<l){m+=P*d;continue}const G=n.coords.length/a,F=m,p=m+(P-1)*d;y(n.coords,u,n.coords.length,F,u[F],u[F+1]),A(n.coords,u,d,g,y,F,p),y(n.coords,u,n.coords.length,p,u[p],u[p+1]);const w=n.coords.length/a-G;w>=l?n.lengths.push(w):h(n.coords,G*a),m+=P*d}return n.coords.length?n:null}function Ln(n,e,t,r){const s=n[e],o=n[e+1],c=n[t],i=n[t+1],l=n[r],u=n[r+1];let f=c,d=i,a=l-f,y=u-d;if(a!==0||y!==0){const m=a*a+y*y,g=((s-f)*a+(o-d)*y)/m;g>1?(f=l,d=u):g>0&&(f+=a*g,d+=y*g)}return a=s-f,y=o-d,a*a+y*y}function A(n,e,t,r,s,o,c){let i=r,l=0,u;for(let f=o+t;f<c;f+=t)u=Ln(e,f,o,c),u>i&&(l=f,i=u);i>r&&(l-o>t&&A(n,e,t,r,s,o,l),s(n,e,n.length,l,e[l],e[l+1]),c-l>t&&A(n,e,t,r,s,l,c))}function Bn(n,e,t,r){if(e==null||!e.coords||!e.coords.length)return null;const s=v(t,r);let o=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const u=e.coords;for(let f=0;f<u.length;f+=s){const d=u[f],a=u[f+1];o=Math.min(o,d),i=Math.max(i,d),c=Math.min(c,a),l=Math.max(l,a)}}return mn(n)?gn(n,o,c,i,l):yn(o,c,i,l,n),n}function D(n,e,t,r,s){const{coords:o,lengths:c}=e,i=v(t,r);if(!o.length)return n!==e&&T(n),n;an(s);const{originPosition:l,scale:u,translate:f}=s,d=On;d.originPosition=l;const a=d.scale;a[0]=u[0]??1,a[1]=-(u[1]??1),a[2]=u[2]??1,a[3]=u[3]??1;const y=d.translate;if(y[0]=f[0]??0,y[1]=f[1]??0,y[2]=f[2]??0,y[3]=f[3]??0,!c.length){for(let g=0;g<i;++g)n.coords[g]=N(d,o[g],g);return n!==e&&T(n,i,0),n}let m=0;for(let g=0;g<c.length;g++){const P=c[g];n.lengths[g]=P;for(let p=0;p<i;++p)n.coords[m+p]=N(d,o[m+p],p);let G=n.coords[m],F=n.coords[m+1];m+=i;for(let p=1;p<P;p++,m+=i){G+=o[m]*a[0],F+=o[m+1]*a[1],n.coords[m]=G,n.coords[m+1]=F;for(let w=2;w<i;++w)n.coords[m+w]=N(d,o[m+w],w)}}return n!==e&&T(n,o.length,c.length),n}function Jn(n,e,t,r,s,o){if(T(n),n.lengths.push(...e.lengths),t===s&&r===o)for(let c=0;c<e.coords.length;c++)n.coords.push(e.coords[c]);else{const c=v(t,r),i=S(t,r,s,o),l=e.coords;for(let u=0;u<l.length;u+=c)i(n.coords,l,n.coords.length,u,l[u],l[u+1])}return n}function qn(n,e,t,r){let s=0,o=n[r*e],c=n[r*(e+1)];for(let i=1;i<t;i++){const l=o+n[r*(e+i)],u=c+n[r*(e+i)+1],f=(l-o)*(u+c);o=l,c=u,s+=f}return .5*s}function Hn(n,e){const{coords:t,lengths:r}=n;let s=0,o=0;for(let c=0;c<r.length;c++){const i=r[c];o+=qn(t,s,i,e),s+=i}return Math.abs(o)}function Kn(n,e){if(n==null)return null;const t=n.clone(),r=n.coords,s=n.lengths;let o=0;for(let c=0;c<s.length;c++){const i=s[c];let l=r[e*o],u=r[e*o+1];for(let f=1;f<i;f++){const d=r[e*(o+f)],a=r[e*(o+f)+1],y=l+d,m=u+a;t.coords[e*(o+f)]=y,t.coords[e*(o+f)+1]=m,l=y,u=m}o+=i}return t}function T(n,e=0,t=0){h(n.lengths,t),h(n.coords,e)}function h(n,e=0){n.length!==e&&(n.length=e)}const On={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};export{Rn as A,nn as a,M as b,Vn as c,Kn as d,_n as e,Cn as f,Qn as g,on as h,$n as i,Un as j,Hn as k,kn as l,rn as m,Bn as n,Sn as o,en as p,j as q,Jn as r,H as s,jn as t,D as u,En as v,Dn as w,O as x,Y as y,Xn as z};
