import{t as R}from"./typedArrayUtil-2bcf3cee.js";import{s as $,a as w}from"./Error-bd05b442.js";import"./mathUtils-daf59e84.js";import{G as y,H as S}from"./enums-8bf08d0c.js";import{E as i,S as I,L as g}from"./enums-4ca4641f.js";import{e as F}from"./ensureType-fa162cfc.js";import{F as O,G as m,C as f}from"./enums-64ab819c.js";import"./Texture-6f3336a0.js";import{t as b}from"./VertexElementDescriptor-2925c6af.js";const z=new Float32Array(1);new Uint32Array(z.buffer);function At(t){return[255&t,(65280&t)>>>8,(16711680&t)>>>16,(4278190080&t)>>>24]}function Lt(t,e){return 65535&t|e<<16}function M(t,e,r,n){return 255&t|(255&e)<<8|(255&r)<<16|n<<24}function Nt(t,e=0,r=!1){const n=t[e+3];return t[e+0]*=n,t[e+1]*=n,t[e+2]*=n,r||(t[e+3]*=255),t}function Dt(t){if(!t)return 0;const{r:e,g:r,b:n,a:s}=t;return M(e*s,r*s,n*s,255*s)}function Mt(t){if(!t)return 0;const[e,r,n,s]=t;return M(e*(s/255),r*(s/255),n*(s/255),s)}function Ut(t,e,r=0){if(R(e))return t[r+0]=0,t[r+1]=0,t[r+2]=0,void(t[r+3]=0);const{r:n,g:s,b:a,a:c}=e;t[r+0]=n*c/255,t[r+1]=s*c/255,t[r+2]=a*c/255,t[r+3]=c}class L{constructor(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}acquire(e,r,n,s,a,c,T,u,h){this.color=e,this.haloColor=r,this.haloSize=n,this.size=s,this.angle=a,this.offsetX=c,this.offsetY=T,this.hAnchor=u,this.vAnchor=h}release(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}}L.pool=new F(L);const d=$.getLogger("esri.views.2d.engine.webgl.Utils"),o="geometry",x=[{name:o,strideInBytes:36}],G=[{name:o,strideInBytes:12}],P=[{name:o,strideInBytes:36}],Y=[{name:o,strideInBytes:24}],k=[{name:o,strideInBytes:12}],H=[{name:o,strideInBytes:40}],V=[{name:o,strideInBytes:36}],X=[{name:o,strideInBytes:36}];function l(t){const e={};for(const r of t)e[r.name]=r.strideInBytes;return e}const q=l(x),K=l(G),W=l(P),j=l(Y),J=l(k),Q=l(H),Z=l(V),tt=l(X);function Ct(t,e){switch(t){case i.MARKER:return e===I.HEATMAP?K:q;case i.FILL:switch(e){case I.DOT_DENSITY:return J;case I.SIMPLE:case I.OUTLINE_FILL_SIMPLE:return j;default:return W}case i.LINE:return Q;case i.TEXT:return Z;case i.LABEL:return tt}}const et=[o],rt=[o],nt=[o],st=[o],at=[o];function it(t){switch(t){case i.MARKER:return et;case i.FILL:return rt;case i.LINE:return nt;case i.TEXT:return st;case i.LABEL:return at}}function ot(t){switch(t%4){case 0:case 2:return 4;case 1:case 3:return 1}}function vt(t,e){switch(e%4){case 0:case 2:return new Uint32Array(Math.floor(t*e/4));case 1:case 3:return new Uint8Array(t*e)}}function _t(t,e){switch(e%4){case 0:case 2:return new Uint32Array(t);case 1:case 3:return new Uint8Array(t)}}function Bt(t){return t!=null}function Rt(t){return typeof t=="number"}function $t(t){switch(t){case"butt":return y.BUTT;case"round":return y.ROUND;case"square":return y.SQUARE;default:return d.error(new w("mapview-invalid-type",`Cap type ${t} is not a valid option. Defaulting to round`)),y.ROUND}}function Ft(t){switch(t){case"miter":return S.MITER;case"bevel":return S.BEVEL;case"round":return S.ROUND;default:return d.error(new w("mapview-invalid-type",`Join type ${t} is not a valid option. Defaulting to round`)),S.ROUND}}function Ot(t){switch(t){case"opacity":return g.OPACITY;case"color":return g.COLOR;case"rotation":return g.ROTATION;case"size":return g.SIZE;default:return d.error(`Cannot interpret unknown vv: ${t}`),null}}function bt(t,e,r,n,s,a,c){for(const u in a){const h=a[u].stride,E=ot(h),U=a[u].data,C=r[u].data,v=h*s.vertexCount/E,_=h*t/E,B=h*s.vertexFrom/E;for(let p=0;p<v;++p)C[p+_]=U[p+B]}const T=s.indexCount;for(let u=0;u<T;++u)n[u+e]=c[u+s.indexFrom]-s.vertexFrom+t}const zt={[o]:O.STATIC_DRAW};function xt(t,e){const r=[];for(let n=0;n<5;++n){const s=it(n),a={};for(const c of s)a[c]={data:e(n,c)};r.push({data:t(n),buffers:a})}return r}function ct(t){switch(t){case f.BYTE:case f.UNSIGNED_BYTE:return 1;case f.SHORT:case f.UNSIGNED_SHORT:return 2;case f.FLOAT:case f.INT:case f.UNSIGNED_INT:return 4}}function Gt(t){switch(t){case m.UNSIGNED_BYTE:return 1;case m.UNSIGNED_SHORT_4_4_4_4:return 2;case m.FLOAT:return 4;default:return void d.error(new w("webgl-utils",`Unable to handle type ${t}`))}}function Pt(t){switch(t){case m.UNSIGNED_BYTE:return Uint8Array;case m.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case m.FLOAT:return Float32Array;default:return void d.error(new w("webgl-utils",`Unable to handle type ${t}`))}}function ut(t){const e={};for(const r in t){const n=t[r];let s=0;e[r]=n.map(a=>{const c=new b(a.name,a.count,a.type,s,0,a.normalized||!1);return s+=a.count*ct(a.type),c}),e[r].forEach(a=>a.stride=s)}return e}const lt=t=>{const e=new Map;for(const r in t)for(const n of t[r])e.set(n.name,n.location);return e},ft=t=>{const e={};for(const r in t){const n=t[r];e[r]=n.length?n[0].stride:0}return e},A=new Map,Yt=(t,e)=>{if(!A.has(t)){const r=ut(e),n={strides:ft(r),bufferLayouts:r,attributes:lt(e)};A.set(t,n)}return A.get(t)};function kt(t){t(i.FILL),t(i.LINE),t(i.MARKER),t(i.TEXT),t(i.LABEL)}const Ht=t=>"path"in t&&ht(t.path),Vt=t=>"url"in t&&t.url||"imageData"in t&&t.imageData,Xt=t=>"imageData"in t&&t.imageData&&"contentType"in t&&t.contentType?`data:${t.contentType};base64,${t.imageData}`:"url"in t?t.url:null,N=t=>t.startsWith("data:image/gif"),qt=t=>"url"in t&&t.url&&(t.url.includes(".gif")||N(t.url))||"contentType"in t&&t.contentType==="image/gif"||"imageData"in t&&N(t.imageData),D=t=>t.startsWith("data:image/png"),Kt=t=>"url"in t&&t.url&&(t.url.includes(".png")||D(t.url))||"contentType"in t&&t.contentType==="image/png"||"imageData"in t&&D(t.imageData),Wt=t=>t.type&&t.type.toLowerCase().includes("3d");function jt(t){switch(t.type){case"line":{const e=t;return e.cim.type==="CIMSolidStroke"&&!e.dashTemplate}case"fill":return t.cim.type==="CIMSolidFill";case"esriSFS":return t.style==="esriSFSSolid"||t.style==="esriSFSNull";case"esriSLS":return t.style==="esriSLSSolid"||t.style==="esriSLSNull";default:return!1}}const Jt=t=>t.includes("data:image/svg+xml");function Qt(t){switch("cim"in t?t.cim.type:t.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":return!1;case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":return mt(t);default:return!0}}function Zt(t){const e="maxVVSize"in t&&t.maxVVSize,r="width"in t&&t.width||"size"in t&&t.size||0;return e||r}function te(t){const e=[];for(let r=0;r<t.length;r++)e.push(t.charCodeAt(r));return e}const ht=t=>!!t&&(t=t.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(t)&&/[\dz]$/i.test(t)&&t.length>4)),mt=t=>{var e,r;return t.type==="fill"&&((r=(e=t==null?void 0:t.cim)==null?void 0:e.markerPlacement)==null?void 0:r.type)==="CIMMarkerPlacementInsidePolygon"};export{Kt as A,mt as B,Jt as D,Xt as E,Ct as G,Ht as I,Bt as J,vt as K,jt as M,Wt as N,Rt as Q,Vt as T,Zt as U,_t as W,ot as X,Qt as _,bt as a,Ut as b,Lt as c,Mt as d,$t as e,Dt as f,Yt as g,kt as h,xt as i,At as j,Nt as k,Gt as l,Pt as m,Ot as r,zt as s,Ft as t,te as v,qt as w,M as x};
