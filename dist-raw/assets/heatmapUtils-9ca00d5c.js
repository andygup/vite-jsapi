import{d9 as P,p as g,D as A}from"./index-30d9bb6f.js";import{l as T}from"./vec4-3dd523e8.js";import{c as U}from"./vec4f64-efdcb593.js";const M=2.4;function V(t){return P(t*M)}function j(t){return g(t)/M}function _(t,r,a,e){let{color:u,ratio:o}=r,{color:c,ratio:n}=a;n===o&&(n===1?o-=1e-6:n+=1e-6);const s=A((e-o)/(n-o),0,1);T(t,u.toArray(),c.toArray(),s)}function B(t){const a=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:n})=>n>=0&&n<=1).sort((n,s)=>n.ratio-s.ratio).map(({color:n,ratio:s})=>({color:n,ratio:Math.max(s,.001)})),t.length<1)return a;let e=t[0],u=t[0],o=1;const c=U();for(let n=0;n<512;n++){const s=(n+.5)/512;for(;s>u.ratio&&o<t.length;)e=u,u=t[o++];_(c,e,u,s),a.set(c,n*4)}return a}function O(t,r,a,e){const{radius:u,fieldOffset:o,field:c}=r,n=Math.round(g(u)),s=new Float64Array(a*e);let f=Number.NEGATIVE_INFINITY,l;const x=k(c,o),I=new Set;for(const b of t){const m=b.getCursor();for(;m.next();){const h=m.getObjectId();if(I.has(h))continue;I.add(h);const i=m.readLegacyPointGeometry(),y=128;if(i.x<-y||i.x>=a+y||i.y<-y||i.y>e+y)continue;const R=+x(m),w=Math.max(0,Math.round(i.x)-n),D=Math.max(0,Math.round(i.y)-n),v=Math.min(e,Math.round(i.y)+n),C=Math.min(a,Math.round(i.x)+n);for(let d=D;d<v;d++)for(let p=w;p<C;p++){const F=d*a+p,N=G(i.x-p,i.y-d,n);l=s[F]+=N*R,l>f&&(f=l)}}}return{matrix:s.buffer,max:f}}function Y(t,r,a,e,u,o){t.canvas.width=t.canvas.height=r,t.clearRect(0,0,r,r);const c=t.getImageData(0,0,r,r);a&&e&&c.data.set(new Uint8ClampedArray(E(r,a,e,u,o))),t.putImageData(c,0,0)}function E(t,r,a,e,u){const o=new Uint32Array(t*t),c="buffer"in r?r:new Float64Array(r),n="buffer"in a?new Uint32Array(a.buffer):new Uint32Array(new Uint8Array(a).buffer),s=n.length/(u-e);for(let f=0;f<c.length;f++){const l=c[f],x=Math.floor((l-e)*s);o[f]=n[A(x,0,n.length-1)]}return o.buffer}function G(t,r,a){const e=Math.sqrt(t**2+r**2)/a;return e>1?0:3/(Math.PI*a**2)*(1-e**2)**2}function q(t,r){return typeof t=="function"?t:t?typeof r=="string"?a=>+a[t]*-1:a=>+a[t]+r:()=>1}function k(t,r){return t!=null?typeof r=="string"?a=>+a.readAttribute(t)*-1:a=>+a.readAttribute(t)+r:a=>1}export{M,V as a,O as b,q as c,Y as d,G as e,B as g,j as k};
