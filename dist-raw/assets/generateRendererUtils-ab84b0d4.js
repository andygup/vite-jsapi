import{cG as z,ae as b,eg as D,af as y,ai as B,bD as I,L as N}from"./index-ffb342b4.js";const j=new z({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),C=new z({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let g=class extends I{constructor(i){super(i),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(i){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",i)}set definedInterval(i){this.classificationMethod==="defined-interval"&&this._set("definedInterval",i)}};b([D({classBreaksDef:"class-breaks-definition"})],g.prototype,"type",void 0);b([y({json:{write:!0}})],g.prototype,"breakCount",void 0);b([y({json:{write:!0}})],g.prototype,"classificationField",void 0);b([y({type:String,json:{read:j.read,write:j.write}})],g.prototype,"classificationMethod",void 0);b([y({json:{write:!0}})],g.prototype,"normalizationField",void 0);b([y({json:{read:C.read,write:C.write}})],g.prototype,"normalizationType",void 0);b([y({value:null,json:{write:!0}})],g.prototype,"standardDeviationInterval",null);b([y({value:null,json:{write:!0}})],g.prototype,"definedInterval",null);g=b([B("esri.rest.support.ClassBreaksDefinition")],g);const R=g,O=N.getLogger("esri.rest.support.generateRendererUtils");function w(n,i){return Number(n.toFixed(i))}function q(n){const{normalizationTotal:i}=n;return{classBreaks:_(n),normalizationTotal:i}}function _(n){const i=n.definition,{classificationMethod:a,normalizationType:s,definedInterval:f}=i,u=i.breakCount??1,c=[];let t=n.values;if(t.length===0)return[];t=t.sort((o,h)=>o-h);const d=t[0],p=t[t.length-1];if(a==="equal-interval")if(t.length>=u){const o=(p-d)/u;let h=d;for(let l=1;l<u;l++){const e=w(d+l*o,6);c.push({minValue:h,maxValue:e,label:v(h,e,s)}),h=e}c.push({minValue:h,maxValue:p,label:v(h,p,s)})}else t.forEach(o=>{c.push({minValue:o,maxValue:o,label:v(o,o,s)})});else if(a==="natural-breaks"){const o=E(t),h=n.valueFrequency||o.valueFrequency,l=F(o.uniqueValues,h,u);let e=d;for(let r=1;r<u;r++)if(o.uniqueValues.length>r){const m=w(o.uniqueValues[l[r]],6);c.push({minValue:e,maxValue:m,label:v(e,m,s)}),e=m}c.push({minValue:e,maxValue:p,label:v(e,p,s)})}else if(a==="quantile")if(t.length>=u&&d!==p){let o=d,h=Math.ceil(t.length/u),l=0;for(let e=1;e<u;e++){let r=h+l-1;r>t.length&&(r=t.length-1),r<0&&(r=0),c.push({minValue:o,maxValue:t[r],label:v(o,t[r],s)}),o=t[r],l+=h,h=Math.ceil((t.length-l)/(u-e))}c.push({minValue:o,maxValue:p,label:v(o,p,s)})}else{let o=-1;for(let h=0;h<t.length;h++){const l=t[h];l!==o&&(o=l,c.push({minValue:o,maxValue:l,label:v(o,l,s)}),o=l)}}else if(a==="standard-deviation"){const o=G(t),h=J(t,o);if(h===0)c.push({minValue:t[0],maxValue:t[0],label:v(t[0],t[0],s)});else{const e=U(d,p,u,o,h)*h;let r=0,m=d;for(let M=u;M>=1;M--){const S=w(o-(M-.5)*e,6);c.push({minValue:m,maxValue:S,label:v(m,S,s)}),m=S,r++}let V=w(o+.5*e,6);c.push({minValue:m,maxValue:V,label:v(m,V,s)}),m=V,r++;for(let M=1;M<=u;M++)r===u*2?V=p:V=w(o+(M+.5)*e,6),c.push({minValue:m,maxValue:V,label:v(m,V,s)}),m=V,r++}}else if(a==="defined-interval"){if(!f)return c;const o=t[0],h=t[t.length-1],l=Math.ceil((h-o)/f);let e=o;for(let r=1;r<l;r++){const m=w(o+r*f,6);c.push({minValue:e,maxValue:m,label:v(e,m,s)}),e=m}c.push({minValue:e,maxValue:h,label:v(e,h,s)})}return c}function v(n,i,a){let s=null;return n===i?a&&a==="percent-of-total"?s=n+"%":s=n.toString():a&&a==="percent-of-total"?s=n+"% - "+i+"%":s=n+" - "+i,s}function E(n){const i=[],a=[];let s=Number.MIN_VALUE,f=1,u=-1;for(let c=0;c<n.length;c++){const t=n[c];t===s?(f++,a[u]=f):t!==null&&(i.push(t),s=t,f=1,a.push(f),u++)}return{uniqueValues:i,valueFrequency:a}}function F(n,i,a){const s=n.length,f=[];a>s&&(a=s);for(let c=0;c<a;c++)f.push(Math.round(c*s/a-1));f.push(s-1);let u=k(f,n,i,a);return T(u.mean,u.sdcm,f,n,i,a)&&(u=k(f,n,i,a)),f}function k(n,i,a,s){let f=[],u=[],c=[],t=0;const d=[],p=[];for(let e=0;e<s;e++){const r=x(e,n,i,a);d.push(r.sbMean),p.push(r.sbSdcm),t+=p[e]}let o=t,h=!0,l;for(;h||t<o;){h=!1,f=[];for(let e=0;e<s;e++)f.push(n[e]);for(let e=0;e<s;e++)for(let r=n[e]+1;r<=n[e+1];r++){if(l=i[r],e>0&&r!==n[e+1]&&Math.abs(l-d[e])>Math.abs(l-d[e-1])){n[e]=r;continue}if(e<s-1&&n[e]!==r-1&&Math.abs(l-d[e])>Math.abs(l-d[e+1])){n[e+1]=r-1;break}}o=t,t=0,u=[],c=[];for(let e=0;e<s;e++){u.push(d[e]),c.push(p[e]);const r=x(e,n,i,a);d[e]=r.sbMean,p[e]=r.sbSdcm,t+=p[e]}}if(t>o){for(let e=0;e<s;e++)n[e]=f[e],d[e]=u[e],p[e]=c[e];t=o}return{mean:d,sdcm:p}}function T(n,i,a,s,f,u){let c=0,t=0,d=0,p=0,o=!0;for(let h=0;h<2&&o;h++){h===0&&(o=!1);for(let l=0;l<u-1;l++)for(;a[l+1]+1!==a[l+2];){a[l+1]=a[l+1]+1;const e=x(l,a,s,f);d=e.sbMean,c=e.sbSdcm;const r=x(l+1,a,s,f);if(p=r.sbMean,t=r.sbSdcm,c+t<i[l]+i[l+1])i[l]=c,i[l+1]=t,n[l]=d,n[l+1]=p,o=!0;else{a[l+1]=a[l+1]-1;break}}for(let l=u-1;l>0;l--)for(;a[l]!==a[l-1]+1;){a[l]=a[l]-1;const e=x(l-1,a,s,f);d=e.sbMean,c=e.sbSdcm;const r=x(l,a,s,f);if(p=r.sbMean,t=r.sbSdcm,c+t<i[l-1]+i[l])i[l-1]=c,i[l]=t,n[l-1]=d,n[l]=p,o=!0;else{a[l]=a[l]+1;break}}}return o}function U(n,i,a,s,f){let t=Math.max(s-n,i-s)/f/a;return t>=1?t=1:t>=.5?t=.5:t=.25,t}function G(n){let i=0;for(let a=0;a<n.length;a++)i+=n[a];return i/=n.length,i}function J(n,i){let a=0;for(let f=0;f<n.length;f++){const u=n[f];a+=(u-i)*(u-i)}return a/=n.length,Math.sqrt(a)}function x(n,i,a,s){let f=0,u=0;for(let d=i[n]+1;d<=i[n+1];d++){const p=s[d];f+=a[d]*p,u+=p}u<=0&&O.warn("Exception in Natural Breaks calculation");const c=f/u;let t=0;for(let d=i[n]+1;d<=i[n+1];d++)t+=s[d]*(a[d]-c)**2;return{sbMean:c,sbSdcm:t}}export{R as C,q as c};
