import{c as Ue,g as Oe}from"./_commonjsHelpers-725317a4.js";import{r as k,V as Ve}from"./WGLContainer-4ea3d7ba.js";import{bS as Gt,m as it,aT as Ge,r as $t,bT as $e,bU as qe,E as W,M as O,L as Se,bV as Ze,t as He,i as Jt,bW as Xe,bN as mt,p as et,bX as Ye,d as te,aP as We,D as U,au as Qe,w as je,ae as M,af as P,ai as at,aj as rt,bY as ee,bO as Ke,b as Te,s as Je,bZ as ti,b_ as Ie,b$ as zt,K as At,aQ as De,c0 as Dt,c1 as ei,by as ii,c2 as si,c3 as ni,c4 as ai,bL as ft,c5 as ri,c6 as qt,c7 as oi,c8 as hi,y as _t,c9 as ie}from"./index-468a9268.js";import{s as li,C as yt,g as se,R as ne,b as ci,r as ui,a as di,c as mi,d as fi,e as pi}from"./ExpandedCIM-3d5be9a7.js";import{r as gi,a as _i}from"./rasterizingUtils-7c7a245d.js";import{S as C,h as kt,i as ae,j as re,P as yi,F as vi,E as wi}from"./definitions-3f56d206.js";import{i as bi,M as vt,d as xi,e as Mi,f as oe,g as Si,h as Ti,s as wt,j as he,k as le,l as Ii,m as Di,n as Pi,W as zi}from"./color-9ac858bf.js";import{R}from"./Rect-df8ea165.js";import{d as Pe,T as ce,B as J,a as Ai}from"./enums-08489827.js";import{a as Xt,T as Yt}from"./TextureDescriptor-8d60c85d.js";import{P as ue}from"./pbf-77fea3f9.js";import{p as Fi}from"./floatRGBA-7208c0c2.js";import{l as de}from"./GeometryUtils-0ab64fac.js";import{i as Ei}from"./imageutils-de0c2f75.js";import{A as Z}from"./enums-eb6e4255.js";import{o as Ci}from"./Matcher-7d012cab.js";import{C as Ri}from"./CircularArray-7e036143.js";import{c as ki}from"./DisjointTimerQuery-0b864cc8.js";import{t as Bi}from"./throttle-9d01e8e8.js";import{S as Li}from"./ComputedAttributeStorage-7f1f2893.js";import{m as Ni}from"./lengthUtils-edd0ce65.js";import{T as X}from"./sizeVariableUtils-2914222a.js";import{c as Ui}from"./ProgramTemplate-91d2aab2.js";var Zt={},Oi={get exports(){return Zt},set exports(o){Zt=o}};(function(o,t){(function(i,s){o.exports=s()})(Ue,function(){return function(e){var i={};function s(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,s),a.loaded=!0,a.exports}return s.m=e,s.c=i,s.p="",s(0)}([function(e,i,s){Object.defineProperty(i,"__esModule",{value:!0}),i.isNotPNG=u,i.isNotAPNG=f,i.default=d;var n=s(1),a=l(n),r=s(2);function l(y){return y&&y.__esModule?y:{default:y}}var h=new Error("Not a PNG"),c=new Error("Not an animated PNG");function u(y){return y===h}function f(y){return y===c}var m=new Uint8Array([137,80,78,71,13,10,26,10]);function d(y){var v=new Uint8Array(y);if(Array.prototype.some.call(m,function(B,E){return B!==v[E]}))return h;var S=!1;if(p(v,function(B){return!(S=B==="acTL")}),!S)return c;var b=[],A=[],F=null,x=null,Kt=0,q=new r.APNG;if(p(v,function(B,E,I,ot){var L=new DataView(E.buffer);switch(B){case"IHDR":F=E.subarray(I+8,I+8+ot),q.width=L.getUint32(I+8),q.height=L.getUint32(I+12);break;case"acTL":q.numPlays=L.getUint32(I+8+4);break;case"fcTL":x&&(q.frames.push(x),Kt++),x=new r.Frame,x.width=L.getUint32(I+8+4),x.height=L.getUint32(I+8+8),x.left=L.getUint32(I+8+12),x.top=L.getUint32(I+8+16);var Ne=L.getUint16(I+8+20),Rt=L.getUint16(I+8+22);Rt===0&&(Rt=100),x.delay=1e3*Ne/Rt,x.delay<=10&&(x.delay=100),q.playTime+=x.delay,x.disposeOp=L.getUint8(I+8+24),x.blendOp=L.getUint8(I+8+25),x.dataParts=[],Kt===0&&x.disposeOp===2&&(x.disposeOp=1);break;case"fdAT":x&&x.dataParts.push(E.subarray(I+8+4,I+8+ot));break;case"IDAT":x&&x.dataParts.push(E.subarray(I+8,I+8+ot));break;case"IEND":A.push(w(E,I,12+ot));break;default:b.push(w(E,I,12+ot))}}),x&&q.frames.push(x),q.frames.length==0)return c;var Be=new Blob(b),Le=new Blob(A);return q.frames.forEach(function(B){var E=[];E.push(m),F.set(T(B.width),0),F.set(T(B.height),4),E.push(z("IHDR",F)),E.push(Be),B.dataParts.forEach(function(I){return E.push(z("IDAT",I))}),E.push(Le),B.imageData=new Blob(E,{type:"image/png"}),delete B.dataParts,E=null}),q}function p(y,v){var S=new DataView(y.buffer),b=8,A=void 0,F=void 0,x=void 0;do F=S.getUint32(b),A=g(y,b+4,4),x=v(A,y,b,F),b+=12+F;while(x!==!1&&A!="IEND"&&b<y.length)}function g(y,v,S){var b=Array.prototype.slice.call(y.subarray(v,v+S));return String.fromCharCode.apply(String,b)}function _(y){for(var v=new Uint8Array(y.length),S=0;S<y.length;S++)v[S]=y.charCodeAt(S);return v}function w(y,v,S){var b=new Uint8Array(S);return b.set(y.subarray(v,v+S)),b}var z=function(v,S){var b=v.length+S.length,A=new Uint8Array(b+8),F=new DataView(A.buffer);F.setUint32(0,S.length),A.set(_(v),4),A.set(S,8);var x=(0,a.default)(A,4,b);return F.setUint32(b+4,x),A},T=function(v){return new Uint8Array([v>>>24&255,v>>>16&255,v>>>8&255,v&255])}},function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(l){for(var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.length-h,u=-1,f=h,m=h+c;f<m;f++)u=u>>>8^s[(u^l[f])&255];return u^-1};for(var s=new Uint32Array(256),n=0;n<256;n++){for(var a=n,r=0;r<8;r++)a=a&1?3988292384^a>>>1:a>>>1;s[n]=a}},function(e,i,s){Object.defineProperty(i,"__esModule",{value:!0}),i.Frame=i.APNG=void 0;var n=function(){function c(u,f){for(var m=0;m<f.length;m++){var d=f[m];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(u,d.key,d)}}return function(u,f,m){return f&&c(u.prototype,f),m&&c(u,m),u}}(),a=s(3),r=l(a);function l(c){return c&&c.__esModule?c:{default:c}}function h(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")}i.APNG=function(){function c(){h(this,c),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[]}return n(c,[{key:"createImages",value:function(){return Promise.all(this.frames.map(function(f){return f.createImage()}))}},{key:"getPlayer",value:function(f){var m=this,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return this.createImages().then(function(){return new r.default(m,f,d)})}}]),c}(),i.Frame=function(){function c(){h(this,c),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.imageData=null,this.imageElement=null}return n(c,[{key:"createImage",value:function(){var f=this;return this.imageElement?Promise.resolve():new Promise(function(m,d){var p=URL.createObjectURL(f.imageData);f.imageElement=document.createElement("img"),f.imageElement.onload=function(){URL.revokeObjectURL(p),m()},f.imageElement.onerror=function(){URL.revokeObjectURL(p),f.imageElement=null,d(new Error("Image creation error"))},f.imageElement.src=p})}}]),c}()},function(e,i,s){Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function m(d,p){for(var g=0;g<p.length;g++){var _=p[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(d,_.key,_)}}return function(d,p,g){return p&&m(d.prototype,p),g&&m(d,g),d}}(),a=s(4),r=l(a);function l(m){return m&&m.__esModule?m:{default:m}}function h(m,d){if(!(m instanceof d))throw new TypeError("Cannot call a class as a function")}function c(m,d){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d&&(typeof d=="object"||typeof d=="function")?d:m}function u(m,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);m.prototype=Object.create(d&&d.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(m,d):m.__proto__=d)}var f=function(m){u(d,m);function d(p,g,_){h(this,d);var w=c(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));return w.playbackRate=1,w._currentFrameNumber=0,w._ended=!1,w._paused=!0,w._numPlays=0,w._apng=p,w.context=g,w.stop(),_&&w.play(),w}return n(d,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,this._apng.numPlays!==0&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this._prevFrame&&this._prevFrame.disposeOp==1?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&this._prevFrame.disposeOp==2&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var g=this.currentFrame;this._prevFrame=g,this._prevFrameData=null,g.disposeOp==2&&(this._prevFrameData=this.context.getImageData(g.left,g.top,g.width,g.height)),g.blendOp==0&&this.context.clearRect(g.left,g.top,g.width,g.height),this.context.drawImage(g.imageElement,g.left,g.top),this.emit("frame",this._currentFrameNumber),this._ended&&this.emit("end")}},{key:"play",value:function(){var g=this;this.emit("play"),this._ended&&this.stop(),this._paused=!1;var _=performance.now()+this.currentFrame.delay/this.playbackRate,w=function z(T){if(!(g._ended||g._paused)){if(T>=_){for(;T-_>=g._apng.playTime/g.playbackRate;)_+=g._apng.playTime/g.playbackRate,g._numPlays++;do g.renderNextFrame(),_+=g.currentFrame.delay/g.playbackRate;while(!g._ended&&T>_)}requestAnimationFrame(z)}};requestAnimationFrame(w)}},{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop"),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]),d}(r.default);i.default=f},function(e,i){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(h){if(!a(h)||h<0||isNaN(h))throw TypeError("n must be a positive number");return this._maxListeners=h,this},s.prototype.emit=function(h){var c,u,f,m,d,p;if(this._events||(this._events={}),h==="error"&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(c=arguments[1],c instanceof Error)throw c;var g=new Error('Uncaught, unspecified "error" event. ('+c+")");throw g.context=c,g}if(u=this._events[h],l(u))return!1;if(n(u))switch(arguments.length){case 1:u.call(this);break;case 2:u.call(this,arguments[1]);break;case 3:u.call(this,arguments[1],arguments[2]);break;default:m=Array.prototype.slice.call(arguments,1),u.apply(this,m)}else if(r(u))for(m=Array.prototype.slice.call(arguments,1),p=u.slice(),f=p.length,d=0;d<f;d++)p[d].apply(this,m);return!0},s.prototype.addListener=function(h,c){var u;if(!n(c))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",h,n(c.listener)?c.listener:c),this._events[h]?r(this._events[h])?this._events[h].push(c):this._events[h]=[this._events[h],c]:this._events[h]=c,r(this._events[h])&&!this._events[h].warned&&(l(this._maxListeners)?u=s.defaultMaxListeners:u=this._maxListeners,u&&u>0&&this._events[h].length>u&&(this._events[h].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[h].length),typeof console.trace=="function"&&console.trace())),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(h,c){if(!n(c))throw TypeError("listener must be a function");var u=!1;function f(){this.removeListener(h,f),u||(u=!0,c.apply(this,arguments))}return f.listener=c,this.on(h,f),this},s.prototype.removeListener=function(h,c){var u,f,m,d;if(!n(c))throw TypeError("listener must be a function");if(!this._events||!this._events[h])return this;if(u=this._events[h],m=u.length,f=-1,u===c||n(u.listener)&&u.listener===c)delete this._events[h],this._events.removeListener&&this.emit("removeListener",h,c);else if(r(u)){for(d=m;d-- >0;)if(u[d]===c||u[d].listener&&u[d].listener===c){f=d;break}if(f<0)return this;u.length===1?(u.length=0,delete this._events[h]):u.splice(f,1),this._events.removeListener&&this.emit("removeListener",h,c)}return this},s.prototype.removeAllListeners=function(h){var c,u;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[h]&&delete this._events[h],this;if(arguments.length===0){for(c in this._events)c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events={},this}if(u=this._events[h],n(u))this.removeListener(h,u);else if(u)for(;u.length;)this.removeListener(h,u[u.length-1]);return delete this._events[h],this},s.prototype.listeners=function(h){var c;return!this._events||!this._events[h]?c=[]:n(this._events[h])?c=[this._events[h]]:c=this._events[h].slice(),c},s.prototype.listenerCount=function(h){if(this._events){var c=this._events[h];if(n(c))return 1;if(c)return c.length}return 0},s.listenerCount=function(h,c){return h.listenerCount(c)};function n(h){return typeof h=="function"}function a(h){return typeof h=="number"}function r(h){return typeof h=="object"&&h!==null}function l(h){return h===void 0}}])})})(Oi);const An=Oe(Zt);var j={},ze={},H={};Object.defineProperty(H,"__esModule",{value:!0});H.loop=H.conditional=H.parse=void 0;var Vi=function o(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:i;if(Array.isArray(e))e.forEach(function(a){return o(t,a,i,s)});else if(typeof e=="function")e(t,i,s,o);else{var n=Object.keys(e)[0];Array.isArray(e[n])?(s[n]={},o(t,e[n],i,s[n])):s[n]=e[n](t,i,s,o)}return i};H.parse=Vi;var Gi=function(t,e){return function(i,s,n,a){e(i,s,n)&&a(i,t,s,n)}};H.conditional=Gi;var $i=function(t,e){return function(i,s,n,a){for(var r=[],l=i.pos;e(i,s,n);){var h={};if(a(i,t,s,h),i.pos===l)break;l=i.pos,r.push(h)}return r}};H.loop=$i;var D={};Object.defineProperty(D,"__esModule",{value:!0});D.readBits=D.readArray=D.readUnsigned=D.readString=D.peekBytes=D.readBytes=D.peekByte=D.readByte=D.buildStream=void 0;var qi=function(t){return{data:t,pos:0}};D.buildStream=qi;var Ae=function(){return function(t){return t.data[t.pos++]}};D.readByte=Ae;var Zi=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(e){return e.data[e.pos+t]}};D.peekByte=Zi;var Ft=function(t){return function(e){return e.data.subarray(e.pos,e.pos+=t)}};D.readBytes=Ft;var Hi=function(t){return function(e){return e.data.subarray(e.pos,e.pos+t)}};D.peekBytes=Hi;var Xi=function(t){return function(e){return Array.from(Ft(t)(e)).map(function(i){return String.fromCharCode(i)}).join("")}};D.readString=Xi;var Yi=function(t){return function(e){var i=Ft(2)(e);return t?(i[1]<<8)+i[0]:(i[0]<<8)+i[1]}};D.readUnsigned=Yi;var Wi=function(t,e){return function(i,s,n){for(var a=typeof e=="function"?e(i,s,n):e,r=Ft(t),l=new Array(a),h=0;h<a;h++)l[h]=r(i);return l}};D.readArray=Wi;var Qi=function(t,e,i){for(var s=0,n=0;n<i;n++)s+=t[e+n]&&Math.pow(2,i-n-1);return s},ji=function(t){return function(e){for(var i=Ae()(e),s=new Array(8),n=0;n<8;n++)s[7-n]=!!(i&1<<n);return Object.keys(t).reduce(function(a,r){var l=t[r];return l.length?a[r]=Qi(s,l.index,l.length):a[r]=s[l.index],a},{})}};D.readBits=ji;(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var t=H,e=D,i={blocks:function(f){for(var m=0,d=[],p=f.data.length,g=0,_=(0,e.readByte)()(f);_!==m&&_;_=(0,e.readByte)()(f)){if(f.pos+_>=p){var w=p-f.pos;d.push((0,e.readBytes)(w)(f)),g+=w;break}d.push((0,e.readBytes)(_)(f)),g+=_}for(var z=new Uint8Array(g),T=0,y=0;y<d.length;y++)z.set(d[y],T),T+=d[y].length;return z}},s=(0,t.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(u){var f=(0,e.peekBytes)(2)(u);return f[0]===33&&f[1]===249}),n=(0,t.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,t.conditional)({lct:(0,e.readArray)(3,function(u,f,m){return Math.pow(2,m.descriptor.lct.size+1)})},function(u,f,m){return m.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},i]}]},function(u){return(0,e.peekByte)()(u)===44}),a=(0,t.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(f,m,d){return(0,e.readBytes)(d.text.blockSize)(f)}},i]},function(u){var f=(0,e.peekBytes)(2)(u);return f[0]===33&&f[1]===1}),r=(0,t.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(f,m,d){return(0,e.readString)(d.blockSize)(f)}},i]},function(u){var f=(0,e.peekBytes)(2)(u);return f[0]===33&&f[1]===255}),l=(0,t.conditional)({comment:[{codes:(0,e.readBytes)(2)},i]},function(u){var f=(0,e.peekBytes)(2)(u);return f[0]===33&&f[1]===254}),h=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,t.conditional)({gct:(0,e.readArray)(3,function(u,f){return Math.pow(2,f.lsd.gct.size+1)})},function(u,f){return f.lsd.gct.exists}),{frames:(0,t.loop)([s,r,l,n,a],function(u){var f=(0,e.peekByte)()(u);return f===33||f===44})}],c=h;o.default=c})(ze);var Et={};Object.defineProperty(Et,"__esModule",{value:!0});Et.deinterlace=void 0;var Ki=function(t,e){for(var i=new Array(t.length),s=t.length/e,n=function(f,m){var d=t.slice(m*e,(m+1)*e);i.splice.apply(i,[f*e,e].concat(d))},a=[0,4,2,1],r=[8,8,4,2],l=0,h=0;h<4;h++)for(var c=a[h];c<s;c+=r[h])n(c,l),l++;return i};Et.deinterlace=Ki;var Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.lzw=void 0;var Ji=function(t,e,i){var s=4096,n=-1,a=i,r,l,h,c,u,f,m,v,d,p,y,g,S,b,F,A,_=new Array(i),w=new Array(s),z=new Array(s),T=new Array(s+1);for(g=t,l=1<<g,u=l+1,r=l+2,m=n,c=g+1,h=(1<<c)-1,d=0;d<l;d++)w[d]=0,z[d]=d;var y,v,S,b,A,F;for(y=v=S=b=A=F=0,p=0;p<a;){if(b===0){if(v<c){y+=e[F]<<v,v+=8,F++;continue}if(d=y&h,y>>=c,v-=c,d>r||d==u)break;if(d==l){c=g+1,h=(1<<c)-1,r=l+2,m=n;continue}if(m==n){T[b++]=z[d],m=d,S=d;continue}for(f=d,d==r&&(T[b++]=S,d=m);d>l;)T[b++]=z[d],d=w[d];S=z[d]&255,T[b++]=S,r<s&&(w[r]=m,z[r]=S,r++,!(r&h)&&r<s&&(c++,h+=r)),m=f}b--,_[A++]=T[b],p++}for(p=A;p<a;p++)_[p]=0;return _};Ct.lzw=Ji;Object.defineProperty(j,"__esModule",{value:!0});var ts=j.decompressFrames=j.decompressFrame=hs=j.parseGIF=void 0,es=rs(ze),is=H,ss=D,ns=Et,as=Ct;function rs(o){return o&&o.__esModule?o:{default:o}}var os=function(t){var e=new Uint8Array(t);return(0,is.parse)((0,ss.buildStream)(e),es.default)},hs=j.parseGIF=os,ls=function(t){for(var e=t.pixels.length,i=new Uint8ClampedArray(e*4),s=0;s<e;s++){var n=s*4,a=t.pixels[s],r=t.colorTable[a]||[0,0,0];i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=a!==t.transparentIndex?255:0}return i},Fe=function(t,e,i){if(!t.image){console.warn("gif frame does not have associated image.");return}var s=t.image,n=s.descriptor.width*s.descriptor.height,a=(0,as.lzw)(s.data.minCodeSize,s.data.blocks,n);s.descriptor.lct.interlaced&&(a=(0,ns.deinterlace)(a,s.descriptor.width));var r={pixels:a,dims:{top:t.image.descriptor.top,left:t.image.descriptor.left,width:t.image.descriptor.width,height:t.image.descriptor.height}};return s.descriptor.lct&&s.descriptor.lct.exists?r.colorTable=s.lct:r.colorTable=e,t.gce&&(r.delay=(t.gce.delay||10)*10,r.disposalType=t.gce.extras.disposal,t.gce.extras.transparentColorGiven&&(r.transparentIndex=t.gce.transparentColorIndex)),i&&(r.patch=ls(r)),r};j.decompressFrame=Fe;var cs=function(t,e){return t.frames.filter(function(i){return i.image}).map(function(i){return Fe(i,t.gct,e)})};ts=j.decompressFrames=cs;const Fn={shaders:{vertexShader:k("bitBlit/bitBlit.vert"),fragmentShader:k("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])},us=512;class ds{constructor(t){this._resourceManager=t,this._rasterizationCanvas=null}dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(t,e,i){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),t.type==="simple-fill"||t.type==="esriSFS"){const[m,d,p]=gi(this._rasterizationCanvas,t.style,e);return{size:[d,p],image:new Uint32Array(m.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:Gt(Math.ceil(e))}}if(t.type==="simple-line"||t.type==="esriSLS"||t.type==="line"&&t.dashTemplate){let m,d;if(t.type==="simple-line"||t.type==="esriSLS")switch(m=li(t.style,t.cap),t.cap){case"butt":d="Butt";break;case"square":d="Square";break;default:d="Round";break}else m=t.dashTemplate,d=t.cim.capStyle;const[p,g,_]=_i(m,d);return{size:[g,_],image:new Uint32Array(p.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let s,n=null,a=null,r=1;if(t.type==="simple-marker"||t.type==="esriSMS"||t.type==="line-marker"?(s=yt.fromSimpleMarker(t),a=se(s)):t.cim&&t.cim.type==="CIMHatchFill"?(s=yt.fromCIMHatchFill(t.cim,e),n=new ne(s.frame.xmin,-s.frame.ymax,s.frame.xmax-s.frame.xmin,s.frame.ymax-s.frame.ymin),r=e):t.cim.markerPlacement&&t.cim.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"?(s=yt.fromCIMInsidePolygon(t.cim),n=new ne(s.frame.xmin,-s.frame.ymax,s.frame.xmax-s.frame.xmin,s.frame.ymax-s.frame.ymin)):(s=t.cim,t.avoidSDFRasterization||(a=se(s))),a&&!i){const[m,d,p]=ci(a);return m?{size:[d,p],image:new Uint32Array(m.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:r}:null}const[l,h,c,u,f]=yt.rasterize(this._rasterizationCanvas,s,n,this._resourceManager,!i);return l?{size:[h,c],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:u,anchorY:f}:null}rasterizeImageResource(t,e,i,s){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=t,this._rasterizationCanvas.height=e;const n=this._rasterizationCanvas.getContext("2d");i instanceof ImageData?n.putImageData(i,0,0):(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`),n.drawImage(i,0,0,t,e));const a=n.getImageData(0,0,t,e),r=new Uint8Array(a.data);if(s){for(const m of s)if(m&&m.oldColor&&m.oldColor.length===4&&m.newColor&&m.newColor.length===4){const[d,p,g,_]=m.oldColor,[w,z,T,y]=m.newColor;if(d===w&&p===z&&g===T&&_===y)continue;for(let v=0;v<r.length;v+=4)d===r[v]&&p===r[v+1]&&g===r[v+2]&&_===r[v+3]&&(r[v]=w,r[v+1]=z,r[v+2]=T,r[v+3]=y)}}let l;for(let m=0;m<r.length;m+=4)l=r[m+3]/255,r[m]=r[m]*l,r[m+1]=r[m+1]*l,r[m+2]=r[m+2]*l;let h=r,c=t,u=e;const f=us;if(c>=f||u>=f){const m=c/u;m>1?(c=f,u=Math.round(f/m)):(u=f,c=Math.round(f*m)),h=new Uint8Array(4*c*u);const d=new Uint8ClampedArray(h.buffer);ui(r,t,e,d,c,u,!1)}return{size:[c,u],image:new Uint32Array(h.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}class Pt{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new R(0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new R;let i=null,s=-1;for(let n=0;n<this._free.length;++n){const a=this._free[n];t<=a.width&&e<=a.height&&(i===null||a.y<=i.y&&a.x<=i.x)&&(i=a,s=n)}return i===null?new R:(this._free.splice(s,1),i.width<i.height?(i.width>t&&this._free.push(new R(i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new R(i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new R(i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new R(i.x,i.y+e,t,i.height-e))),new R(i.x,i.y,t,e))}release(t){for(let e=0;e<this._free.length;++e){const i=this._free[e];if(i.y===t.y&&i.height===t.height&&i.x+i.width===t.x)i.width+=t.width;else if(i.x===t.x&&i.width===t.width&&i.y+i.height===t.y)i.height+=t.height;else if(t.y===i.y&&t.height===i.height&&t.x+t.width===i.x)i.x=t.x,i.width+=t.width;else if(t.x===i.x&&t.width===i.width&&t.y+t.height===i.y)i.y=t.y,i.height+=t.height;else continue;this._free.splice(e,1),this.release(t)}this._free.push(t)}}const ms=256,fs=o=>Math.floor(o/256);function ps(o){const t=new Set;for(const e of o)t.add(fs(e));return t}function gs(o,t,e){return o.has(t)||o.set(t,e().then(()=>{o.delete(t)}).catch(i=>{o.delete(t),Ge(i)})),o.get(t)}const _s=o=>({rect:new R(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:o,sdf:!0});class ys{constructor(t,e,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this._preloadCache={},this.width=t,this.height=e,this._glyphSource=i,this._binPack=new Pt(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyph(){const t=[117,149,181,207,207,181,149,117],e=[];for(let s=0;s<t.length;s++){const n=t[s];for(let a=0;a<11;a++)e.push(n)}const i={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)};this._recordGlyph(i)}async getGlyphItems(t,e,i){const s=this._getGlyphCache(t);return await this._fetchRanges(t,e,i),e.map(n=>this._getMosaicItem(s,t,n))}bind(t,e,i,s){const n=this._getTexture(t,i);n.setSamplingMode(e),this._dirties[i]&&(n.setData(this._glyphData[i]),this._dirties[i]=!1),t.bindTexture(n,s)}preloadASCIIGlyphCache(t){const e=this._preloadCache[t];if(e!=null)return e;const i=this._glyphSource.preloadASCIIRange(t).then(()=>{const s=this._getGlyphCache(t);for(let n=0;n<256;n++)this._getMosaicItem(s,t,n)});return this._preloadCache[t]=i,i}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_getTexture(t,e){if(!this._textures[e]){const i=new Xt;i.pixelFormat=Pe.ALPHA,i.width=this.width,i.height=this.height,this._textures[e]=new Yt(t,i,new Uint8Array(this.width*this.height))}return this._textures[e]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(t,e,i){const s=ps(e),n=[];s.forEach(a=>{n.push(this._fetchRange(t,a,i))}),await Promise.all(n)}async _fetchRange(t,e,i){if(e>ms)return;const s=t+e;return gs(this._rangePromises,s,()=>this._glyphSource.getRange(t,e,i))}_getMosaicItem(t,e,i){if(!t[i]){const s=this._glyphSource.getGlyph(e,i);if(!s||!s.metrics)return _s(i);const n=this._recordGlyph(s),a=this._currentPage,r=s.metrics;t[i]={rect:n,page:a,metrics:r,code:i,sdf:!0},this._invalidate()}return t[i]}_recordGlyph(t){const e=t.metrics;let i;if(e.width===0)i=new R(0,0,0,0);else{const n=e.width+6,a=e.height+3*2;i=this._binPack.allocate(n,a),i.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new Pt(this.width-4,this.height-4),i=this._binPack.allocate(n,a));const r=this._glyphData[this._currentPage],l=t.bitmap;let h,c;if(l)for(let u=0;u<a;u++){h=n*u,c=this.width*(i.y+u)+i.x;for(let f=0;f<n;f++)r[c+f]=l[h+f]}it("esri-glyph-debug")&&this._showDebugPage(r)}return i}_showDebugPage(t){const e=document.createElement("canvas"),i=e.getContext("2d"),s=new ImageData(this.width,this.height),n=s.data;e.width=this.width,e.height=this.height,e.style.border="1px solid black";for(let a=0;a<t.length;++a)n[a*4]=t[a],n[a*4+1]=0,n[a*4+2]=0,n[a*4+3]=255;i.putImageData(s,0,0),document.body.appendChild(e)}}class me{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const i=e.getMessage();let s,n,a,r,l,h,c;for(;i.next();)switch(i.tag()){case 1:s=i.getUInt32();break;case 2:n=i.getBytes();break;case 3:a=i.getUInt32();break;case 4:r=i.getUInt32();break;case 5:l=i.getSInt32();break;case 6:h=i.getSInt32();break;case 7:c=i.getUInt32();break;default:i.skip();break}i.release(),s&&(this._metrics[s]={width:a,height:r,left:l,top:h,advance:c},this._bitmaps[s]=n);break}default:e.skip();break}e.release();break}default:t.skip();break}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class vs{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}class ws{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,e,i){const s=this._getFontStack(t);if(s.getRange(e))return Promise.resolve();const a=e*256,r=a+255,l=this._baseURL.replace("{fontstack}",t).replace("{range}",a+"-"+r);return $t(l,{responseType:"array-buffer",...i}).then(h=>{s.addRange(e,new me(new ue(new Uint8Array(h.data),new DataView(h.data))))})}async preloadASCIIRange(t){const e=this._getFontStack(t),i=0,s=255,n=this._baseURL.replace("{fontstack}",t).replace("{range}",i+"-"+s),a=await $t(n,{responseType:"array-buffer"}),r=new me(new ue(new Uint8Array(a.data),new DataView(a.data)));for(let l=i;l<=s;l++)e.getRange(l)||e.addRange(l,r)}getGlyph(t,e){const i=this._getFontStack(t);if(!i)return;const s=Math.floor(e/256);if(s>256)return;const n=i.getRange(s);if(n)return{metrics:n.getMetrics(e),bitmap:n.getBitmap(e)}}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new vs),e}}const ht=1e20;class bs{constructor(t){this._svg=null,this.size=t;const e=document.createElement("canvas");e.width=e.height=t,this._context=e.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(t,e,i=31){this._initSVG();const s=this.createSVGString(t);return new Promise((n,a)=>{const r=new Image;r.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(s),r.onload=()=>{r.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(r,0,0,this.size,this.size);const h=this._context.getImageData(0,0,this.size,this.size),c=new Uint8Array(this.size*this.size*4);for(let u=0;u<this.size*this.size;u++){const f=h.data[u*4+3]/255;this._gridOuter[u]=f===1?0:f===0?ht:Math.max(0,.5-f)**2,this._gridInner[u]=f===1?ht:f===0?0:Math.max(0,f-.5)**2}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let u=0;u<this.size*this.size;u++){const m=.5-(this._gridOuter[u]-this._gridInner[u])/(i*2);Fi(m,c,4*u)}n(c)};const l=e&&e.signal;l&&$e(l,()=>a(qe()))})}_initSVG(){if(!this._svg){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t}return this._svg}createSVGString(t){const e=this._initSVG(),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",t),e.appendChild(i);const s=i.getBBox(),n=s.width/s.height,a=this.size/2;let r,l,h,c;if(n>1){l=r=a/s.width;const d=a*(1/n);h=this.size/4,c=a-d/2}else{r=l=a/s.height;const d=a*n;h=a-d/2,c=this.size/4}const u=-s.x*r+h,f=-s.y*l+c;i.setAttribute("style",`transform: matrix(${r}, 0, 0, ${l}, ${u}, ${f})`);const m=`<svg style="fill:red;" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${e.innerHTML}</svg>`;return e.removeChild(i),m}_edt(t,e,i){const s=this._f,n=this._d,a=this._v,r=this._z;for(let l=0;l<e;l++){for(let h=0;h<i;h++)s[h]=t[h*e+l];this._edt1d(s,n,a,r,i);for(let h=0;h<i;h++)t[h*e+l]=n[h]}for(let l=0;l<i;l++){for(let h=0;h<e;h++)s[h]=t[l*e+h];this._edt1d(s,n,a,r,e);for(let h=0;h<e;h++)t[l*e+h]=Math.sqrt(n[h])}}_edt1d(t,e,i,s,n){i[0]=0,s[0]=-ht,s[1]=+ht;for(let a=1,r=0;a<n;a++){let l=(t[a]+a*a-(t[i[r]]+i[r]*i[r]))/(2*a-2*i[r]);for(;l<=s[r];)r--,l=(t[a]+a*a-(t[i[r]]+i[r]*i[r]))/(2*a-2*i[r]);r++,i[r]=a,s[r]=l,s[r+1]=+ht}for(let a=0,r=0;a<n;a++){for(;s[r+1]<a;)r++;e[a]=(a-i[r])*(a-i[r])+t[i[r]]}}}function Q(o){return o&&o.type==="static"}class Wt{constructor(t,e,i=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(t<=0||e<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=e,i>0&&(this._maxItemSize=i),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new Pt(this._pageWidth,this._pageHeight);const s=Math.floor(this._pageWidth),n=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(s*n)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,e,i,s,n,a,r=1){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let l,h,c;if(Q(i))[l,h,c]=this._allocateImage(e[0],e[1]);else{l=new R(0,0,e[0],e[1]),h=this._mosaicPages.length;const f=void 0;this._mosaicPages.push({mosaicsData:i,size:[e[0]+2*C,e[1]+2*C],dirty:!0,texture:f})}if(l.width<=0||l.height<=0)return null;const u={rect:l,width:e[0],height:e[1],sdf:n,simplePattern:a,pixelRatio:r,page:h};return this._mosaicRects.set(t,u),Q(i)&&(it("esri-mosaic-debug")&&this._showDebugSprite(e,i.data),this._copy({rect:l,spriteSize:e,spriteData:i.data,page:h,pageSize:c,repeat:s,sdf:n})),u}hasItemsToProcess(){return this._spriteCopyQueue.length!==0}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getSpriteItems(t){const e={};for(const i of t)e[i]=this.getSpriteItem(i);return e}getMosaicItemPosition(t){const e=this.getSpriteItem(t),i=e&&e.rect;if(!i)return null;i.width=e.width,i.height=e.height;const s=e.width,n=e.height,a=C,r=this._mosaicPages[e.page].size;return{size:[e.width,e.height],tl:[(i.x+a)/r[0],(i.y+a)/r[1]],br:[(i.x+a+s)/r[0],(i.y+a+n)/r[1]],page:e.page}}bind(t,e,i=0,s=0){const n=this._mosaicPages[i],a=n.mosaicsData;let r=n.texture;r||(r=Ms(t,n.size),n.texture=r),r.setSamplingMode(e),Q(a)?(t.bindTexture(r,s),n.dirty&&(r.setData(new Uint8Array(a.data.buffer)),r.generateMipmap(),it("esri-mosaic-debug")&&this._showDebugPage(i))):(a.data.bindFrame(t,r,s),r.generateMipmap()),n.dirty=!1}dispose(){this._binPack=null;for(const t of this._mosaicPages){const e=t.texture;e&&e.dispose();const i=t.mosaicsData;Q(i)||i.data.destroy()}this._mosaicPages=null,this._mosaicRects.clear()}static _copyBits(t,e,i,s,n,a,r,l,h,c,u){let f=s*e+i,m=l*a+r;if(u){m-=a;for(let d=-1;d<=c;d++,f=((d+c)%c+s)*e+i,m+=a)for(let p=-1;p<=h;p++)n[m+p]=t[f+(p+h)%h]}else for(let d=0;d<c;d++){for(let p=0;p<h;p++)n[m+p]=t[f+p];f+=e,m+=a}}_copy(t){if(t.page>=this._mosaicPages.length)return;const e=this._mosaicPages[t.page],i=e.mosaicsData;if(!Q(e.mosaicsData))throw new W("mapview-invalid-resource","unsuitable data type!");const s=t.spriteData,n=i.data;(!n||!s)&&console.error("Source or target images are uninitialized!"),Wt._copyBits(s,t.spriteSize[0],0,0,n,t.pageSize[0],t.rect.x+C,t.rect.y+C,t.spriteSize[0],t.spriteSize[1],t.repeat),e.dirty=!0}_allocateImage(t,e){t+=2*C,e+=2*C;const i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){const n=2**Math.ceil(de(t)),a=2**Math.ceil(de(e)),r=new R(0,0,t,e);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(n*a)},size:[n,a],dirty:!0,texture:void 0}),[r,this._mosaicPages.length-1,[n,a]]}const s=this._binPack.allocate(t,e);if(s.width<=0){const n=this._mosaicPages[this._currentPage];return!n.dirty&&Q(n.mosaicsData)&&(n.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new Pt(this._pageWidth,this._pageHeight),this._allocateImage(t,e)}return[s,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([t,e],i){const s=document.createElement("canvas");s.width=t,s.height=e,s.setAttribute("style",`position: absolute; top: ${4+204*xs++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const n=s.getContext("2d"),a=new ImageData(t,e);a.data.set(new Uint8Array(i.buffer)),n.putImageData(a,0,0),document.body.appendChild(s)}_showDebugPage(t){const e=this._mosaicPages[t],{size:[i,s],mosaicsData:n}=e;if(!Q(n)){console.error("Could not show sprite mosaic debug for non-static resource");return}const a=`mosaicDebugPage${t}`,r=document.getElementById(a)??document.createElement("canvas");r.id=a,r.width=i,r.height=s,r.setAttribute("style",`position: absolute; top: ${4+204*t}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);const l=r.getContext("2d"),h=new ImageData(i,s);h.data.set(new Uint8Array(n.data.buffer)),l.putImageData(h,0,0),document.body.appendChild(r)}}let xs=0;function Ms(o,t){const e=new Xt;return e.width=t[0],e.height=t[1],new Yt(o,e,null)}function Ee(o){return O(o.frameDurations.reduce((t,e)=>t+e,0))}function Ss(o){const{width:t,height:e}=o;return{frameDurations:o.frameDurations.reverse(),getFrame:n=>{const a=o.frameDurations.length-1-n;return o.getFrame(a)},width:t,height:e}}function Ts(o,t){const{width:e,height:i,getFrame:s}=o,n=Ee(o),a=t/n;return{frameDurations:o.frameDurations.map(l=>O(l*a)),getFrame:s,width:e,height:i}}function Is(o,t){const{width:e,height:i,getFrame:s}=o,n=o.frameDurations.slice(),a=n.shift();return n.unshift(O(a+t)),{frameDurations:n,getFrame:s,width:e,height:i}}function fe(o,t){const{width:e,height:i,getFrame:s}=o,n=o.frameDurations.slice(),a=n.pop();return n.push(O(a+t)),{frameDurations:n,getFrame:s,width:e,height:i}}class Ds{constructor(t,e,i,s){this._animation=t,this._repeatType=i,this._onFrameData=s,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let n=0;for(;e>n;)n+=this.timeToFrame,this.nextFrame();const a=this._animation.getFrame(this._currentFrame);this._onFrameData(a)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case Z.None:this._currentFrame-=this._direction;break;case Z.Loop:this._currentFrame=0;break;case Z.Oscillate:this._currentFrame-=this._direction,this._direction=-1;break}}else if(this._currentFrame===-1)switch(this._repeatType){case Z.None:this._currentFrame-=this._direction;break;case Z.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case Z.Oscillate:this._currentFrame-=this._direction,this._direction=1;break}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function Ps(o,t,e,i){let{repeatType:s}=t;if(s==null&&(s=Z.Loop),t.reverseAnimation===!0&&(o=Ss(o)),t.duration!=null&&(o=Ts(o,O(t.duration*1e3))),t.repeatDelay!=null){const a=1e3*t.repeatDelay;s===Z.Loop?o=fe(o,O(a)):s===Z.Oscillate&&(o=Is(fe(o,O(a/2)),O(a/2)))}let n;if(t.startTimeOffset!=null)n=O(t.startTimeOffset*1e3);else if(t.randomizeStartTime!=null){const a=di(e),r=82749913,l=t.randomizeStartSeed!=null?t.randomizeStartSeed:r,h=mi(a,l);n=O(h*Ee(o))}else n=O(0);return new Ds(o,n,s,i)}function zs(o,t,e,i){const s=t.playAnimation!=null?t.playAnimation:!0,n=Ps(o,t,e,i);let a=n.timeToFrame,r;function l(){r=s?setTimeout(()=>{n.nextFrame(),a=n.timeToFrame,l()},a):void 0}return l(),{remove:()=>{s&&clearTimeout(r)}}}const Ht=document.createElement("canvas"),bt=Ht.getContext("2d");function As(o,t,e){Ht.width=t,Ht.height=e;const i=[],s=o.frameDurations.length;for(let n=0;n<s;n++){const a=o.getFrame(n);bt.clearRect(0,0,t,e),a instanceof ImageData?bt.drawImage(Ei(a),0,0,t,e):bt.drawImage(a,0,0,t,e),i.push(bt.getImageData(0,0,t,e))}return{width:t,height:e,frameDurations:o.frameDurations,getFrame:n=>i[n]}}class Fs{constructor(t,e,i,s){this._animation=t,this._frameData=null;const n=a=>{this._frameData=a,e.requestRender()};this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=zs(this._animation,i,s,n)}destroy(){this._playHandle.remove()}bindFrame(t,e,i){t.bindTexture(e,i),this._frameData!=null&&(e.updateData(0,C,C,this._frameData.width,this._frameData.height,this._frameData),this._frameData=null)}}function Es(o){switch(o.type){case"esriSMS":return`${o.style}.${o.path}`;case"esriSLS":return`${o.style}.${o.cap}`;case"esriSFS":return`${o.style}`;case"esriPFS":case"esriPMS":return o.imageData?`${o.imageData}${o.width}${o.height}`:`${o.url}${o.width}${o.height}`;default:return"mosaicHash"in o?o.mosaicHash:JSON.stringify(o)}}const pe=Ye(),ge="arial-unicode-ms-regular",Ce=Se.getLogger("esri.views.2d.engine.webgl.TextureManager");function _e(o,t){const e=Math.round(et(t)*window.devicePixelRatio),i=e>=128?2:4;return Math.min(o,e*i)}const Bt=(o,t,e)=>Ce.error(new W(o,t,e));class Qt{static fromMosaic(t,e){return new Qt(t,e.page,e.sdf)}constructor(t,e,i){this.mosaicType=t,this.page=e,this.sdf=i}}class En{constructor(t,e,i){this._requestRender=t,this.resourceManager=e,this._allowNonPowerOfTwo=i,this._invalidFontsMap=new Map,this._sdfConverter=new bs(kt),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new Ze({concurrency:10,process:async(s,n)=>{He(n);try{return await $t(s,{responseType:"image",signal:n})}catch(a){throw Jt(a)?a:new W("mapview-invalid-resource",`Could not fetch requested resource at ${s}`,a)}}}),this._spriteMosaic=new Wt(2048,2048,500),this._glyphSource=new ws(`${Xe.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new ys(1024,1024,this._glyphSource),this._rasterizer=new ds(e)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}async rasterizeItem(t,e,i,s){if(t==null)return Bt("mapview-null-resource","Unable to rasterize null resource"),null;switch(t.type){case"text":case"esriTS":{const n=await this._rasterizeText(t,i,s);return n.forEach(a=>this._setTextureBinding(vt.GLYPH,a)),{glyphMosaicItems:n}}case"esriSMS":case"esriPMS":case"esriSFS":case"esriPFS":case"esriSLS":default:{if(bi(t))return Bt("mapview-invalid-type",`MapView does not support symbol type: ${t.type}`,t),null;const n=await this._rasterizeSpriteSymbol(t,e,s);return Ci(n)&&n&&this._setTextureBinding(vt.SPRITE,n),{spriteMosaicItem:n}}}}bindTextures(t,e,i,s=!1){if(i.textureBinding===0)return;const n=this._bindingInfos[i.textureBinding-1],a=n.page,r=s?ce.LINEAR_MIPMAP_LINEAR:ce.LINEAR;switch(n.mosaicType){case vt.SPRITE:{const l=this.sprites.getWidth(a),h=this.sprites.getHeight(a),c=mt(pe,l,h);this._spriteMosaic.bind(t,r,a,re),e.setUniform1i("u_texture",re),e.setUniform2fv("u_mosaicSize",c);return}case vt.GLYPH:{const l=this.glyphs.width,h=this.glyphs.height,c=mt(pe,l,h);this._glyphMosaic.bind(t,r,a,ae),e.setUniform1i("u_texture",ae),e.setUniform2fv("u_mosaicSize",c);return}default:Ce.error("mapview-texture-manager",`Cannot handle unknown type ${n.mosaicType}`)}}_hashMosaic(t,e){return 1|t<<1|(e.sdf?1:0)<<2|e.page<<3}_setTextureBinding(t,e){const i=this._hashMosaic(t,e);if(!this._hashToBindingIndex.has(i)){const s=Qt.fromMosaic(t,e),n=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,n),this._bindingInfos.push(s)}e.textureBinding=this._hashToBindingIndex.get(i)}async _rasterizeText(t,e,i){let s,n;if("cim"in t){const l=t;s=l.fontName,n=l.text}else{const l=t;s=fi(l.font),n=l.text}const a=this._invalidFontsMap.has(s),r=e||xi(pi(n)[0]);try{const l=a?ge:s;return it("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(l),await this._glyphMosaic.getGlyphItems(l,r,i)}catch{return Bt("mapview-invalid-resource",`Couldn't find font ${s}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(s,!0),this._glyphMosaic.getGlyphItems(ge,r,i)}}async _rasterizeSpriteSymbol(t,e,i){if(Mi(t))return;const s=Es(t);if(this._spriteMosaic.has(s))return this._spriteMosaic.getSpriteItem(s);if(oe(t)||Si(t)&&!Ti(t))return this._handleAsyncResource(s,t,i);const n=yi,a=this._rasterizer.rasterizeJSONResource(t,n);if(a){const{size:r,image:l,sdf:h,simplePattern:c,rasterizationScale:u}=a;return this._addItemToMosaic(s,r,{type:"static",data:l},wt(t),h,c,u)}return new W("TextureManager","unrecognized or null rasterized image")}async _handleAsyncResource(t,e,i){if(this._ongoingRasterizations.has(t))return this._ongoingRasterizations.get(t);let s;oe(e)?s=this._handleSVG(e,t,i):s=this._handleImage(e,t,i),this._ongoingRasterizations.set(t,s);try{await s,this._ongoingRasterizations.delete(t)}catch{this._ongoingRasterizations.delete(t)}return s}async _handleSVG(t,e,i){const s=[kt,kt],n=await this._sdfConverter.draw(t.path,i);return this._addItemToMosaic(e,s,{type:"static",data:new Uint32Array(n.buffer)},!1,!0,!0)}async _handleGIFOrPNG(t,e,i){const s=he(t);await this.resourceManager.fetchResource(s,i);let n=this.resourceManager.getResource(s);if(n==null)return new W("mapview-invalid-resource",`Could not fetch requested resource at ${s}.`);let a=n.width,r=n.height;if(n instanceof HTMLImageElement){t.type==="esriPMS"&&(a=Math.round(_e(n.width,le(t))),r=Math.round(n.height*(a/n.width)));const u="cim"in t?t.cim.colorSubstitutions:void 0,{size:f,sdf:m,image:d}=this._rasterizer.rasterizeImageResource(a,r,n,u);return this._addItemToMosaic(e,f,{type:"static",data:d},wt(t),m,!1)}this._allowNonPowerOfTwo||(a=Gt(n.width+2*C)-2*C,r=Gt(n.height+2*C)-2*C),(a!==n.width||r!==n.height)&&(n=As(n,a,r));const l=t.animatedSymbolProperties||{},h=t.objectId,c=new Fs(n,this._requestRender,l,h);return this._addItemToMosaic(e,[c.width,c.height],{type:"animated",data:c},wt(t),!1,!1)}async _handleImage(t,e,i){if(Ii(t)||Di(t))return this._handleGIFOrPNG(t,e,i);const s=he(t);try{let n;const a=this.resourceManager.getResource(s);if(a!=null&&a instanceof HTMLImageElement)n=a;else{const{data:m}=await this._imageRequestQueue.push(s,{...i});n=m}if(Pi(s)){if("width"in t&&"height"in t)n.width=et(t.width),n.height=et(t.height);else if("cim"in t){const m=t.cim;n.width=et(m.width??m.scaleX*m.size),n.height=et(m.size)}}if(!n.width||!n.height)return null;let r=n.width,l=n.height;t.type==="esriPMS"&&(r=Math.round(_e(n.width,le(t))),l=Math.round(n.height*(r/n.width)));const h="cim"in t?t.cim.colorSubstitutions:void 0,{size:c,sdf:u,image:f}=this._rasterizer.rasterizeImageResource(r,l,n,h);return this._addItemToMosaic(e,c,{type:"static",data:f},wt(t),u,!1)}catch(n){if(!Jt(n))return new W("mapview-invalid-resource",`Could not fetch requested resource at ${s}. ${n.message}`)}}_addItemToMosaic(t,e,i,s,n,a,r){return this._spriteMosaic.addSpriteItem(t,e,i,s,n,a,r)}}const Cn={shaders:{vertexShader:k("stencil/stencil.vert"),fragmentShader:k("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])},Cs=o=>o.replace("-","_").toUpperCase(),ye=o=>`#define ${Cs(o)}
`;function ve(o){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:ye(o)+k("blend/blend.vert"),fragmentShader:ye(o)+k("blend/blend.frag")}}}const we=Se.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class Rn{constructor(){this._size=[0,0]}dispose(t){this._backBufferTexture=te(this._backBufferTexture),this._quad=te(this._quad)}draw(t,e,i,s,n){const{context:a,drawPhase:r}=t;if(this._setupShader(a),s&&s!=="normal"&&r!==zi.LABEL){this._drawBlended(t,e,i,s,n);return}const l=ve("normal"),h=a.programCache.acquire(l.shaders.vertexShader,l.shaders.fragmentShader,l.attributes);if(!h){we.error(new W("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'));return}a.useProgram(h),e.setSamplingMode(i),a.bindTexture(e,0),h.setUniform1i("u_layerTexture",0),h.setUniform1f("u_opacity",n),a.setBlendingEnabled(!0),a.setBlendFunction(J.ONE,J.ONE_MINUS_SRC_ALPHA);const c=this._quad;c.draw(),c.unbind(),h.dispose()}_drawBlended(t,e,i,s,n){const{context:a,state:r,pixelRatio:l,inFadeTransition:h}=t,{size:c}=r,u=a.getBoundFramebufferObject();let f,m;if(u!=null){const w=u.descriptor;f=w.width,m=w.height}else f=Math.round(l*c[0]),m=Math.round(l*c[1]);this._createOrResizeTexture(t,f,m);const d=this._backBufferTexture;u.copyToTexture(0,0,f,m,0,0,d),a.setStencilTestEnabled(!1),a.setStencilWriteMask(0),a.setBlendingEnabled(!0),a.setDepthTestEnabled(!1),a.setDepthWriteEnabled(!1);const p=ve(s),g=a.programCache.acquire(p.shaders.vertexShader,p.shaders.fragmentShader,p.attributes);if(!g){we.error(new W("mapview-BlendEffect",`Error creating shader program for blend mode ${s}`));return}a.useProgram(g),d.setSamplingMode(i),a.bindTexture(d,0),g.setUniform1i("u_backbufferTexture",0),e.setSamplingMode(i),a.bindTexture(e,1),g.setUniform1i("u_layerTexture",1),g.setUniform1f("u_opacity",n),g.setUniform1f("u_inFadeOpacity",h?1:0),a.setBlendFunction(J.ONE,J.ZERO);const _=this._quad;_.draw(),_.unbind(),g.dispose(),a.setBlendFunction(J.ONE,J.ONE_MINUS_SRC_ALPHA)}_setupShader(t){this._quad||(this._quad=new Ve(t,[-1,-1,1,-1,-1,1,1,1]))}_createOrResizeTexture(t,e,i){const{context:s}=t;if(!(this._backBufferTexture!==null&&e===this._size[0]&&i===this._size[1])){if(this._backBufferTexture)this._backBufferTexture.resize(e,i);else{const n=new Xt;n.internalFormat=Pe.RGBA,n.wrapMode=Ai.CLAMP_TO_EDGE,n.width=e,n.height=i,this._backBufferTexture=new Yt(s,n)}this._size[0]=e,this._size[1]=i}}}const kn={shaders:{vertexShader:k("highlight/textured.vert"),fragmentShader:k("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},Bn={shaders:{vertexShader:k("highlight/textured.vert"),fragmentShader:k("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},N=it("esri-2d-profiler");class Ln{constructor(t,e){if(this._events=new We,this._entries=new Map,this._timings=new Ri(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!N)return;this._ext=ki(t.gl,{}),this._debugOutput=e;const i=t.gl;if(!this.enableCommandLogging)return;let s;for(s in i)if(typeof i[s]=="function"){const n=i[s],a=s.includes("draw");i[s]=(...r)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:s,args:r,isDrawCommand:a}),this._currentSummary&&(this._currentSummary.commands++,a&&this._currentSummary.drawCommands++),n.apply(i,r))}}get enableCommandLogging(){return!(typeof N=="object"&&N.disableCommands)}recordContainerStart(t){N&&(this._currentContainer=t)}recordContainerEnd(){N&&(this._currentContainer=null)}recordPassStart(t){N&&(this._currentPass=t,this._initSummary())}recordPassEnd(){N&&(this._currentPass=null,this._emitSummary())}recordBrushStart(t){N&&(this._currentBrush=t)}recordBrushEnd(){N&&(this._currentBrush=null)}recordStart(t){if(N&&this._ext!=null){if(this._entries.has(t)){const i=this._entries.get(t),s=this._ext.resultAvailable(i.query),n=this._ext.disjoint();if(s&&!n){const r=this._ext.getResult(i.query)/1e6;let l=0;if(this._timings.enqueue(r)!=null){const u=this._timings.entries,f=u.length;let m=0;for(const d of u)m+=d;l=m/f}const h=r.toFixed(2),c=l?l.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${t}, ${h} ms (${c} last 10 avg)
${i.commandsLen} Commands (${i.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(i.summaries),console.log("Commands: ",i.commands),console.groupEnd()):console.log(`Frame report for ${t}, ${h} ms (${c} last 10 avg)`),this._debugOutput.innerHTML=`${h} (${c})`}for(const a of i.handles)a.remove();this._ext.deleteQuery(i.query),this._entries.delete(t)}const e={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",i=>{e.commandsLen++,e.commands.push(i),i.isDrawCommand&&e.drawCommands++})),e.handles.push(this._events.on("summary",i=>{e.summaries.push(i)}))),this._ext.beginTimeElapsed(e.query),this._entries.set(t,e)}}recordEnd(t){N&&this._ext!=null&&this._entries.has(t)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){!this.enableCommandLogging||!this._currentSummary||this._events.emit("summary",this._currentSummary)}}const xt=2,G=1,ct=0,ut=1,dt=2;class Rs{constructor(t,e,i){this._debugMap=new Map,this._width=t*i,this._height=e*i,this._pixelRatio=i;const s=Math.ceil(this._width/G),n=Math.ceil(this._height/G);this._cols=s,this._rows=n,this._cells=Li.create(s*n)}insertMetrics(t){const e=this._hasCollision(t);return e===ct&&this._markMetrics(t),e}getCellId(t,e){return t+e*this._cols}has(t){return this._cells.has(t)}hasRange(t,e){return this._cells.hasRange(t,e)}set(t){this._cells.set(t)}setRange(t,e){this._cells.setRange(t,e)}_collide(t,e,i,s){const n=t-i/2,a=e-s/2,r=n+i,l=a+s;if(r<0||l<0||n>this._width||a>this._height)return ut;const h=U(Math.floor(n/G),0,this._cols),c=U(Math.floor(a/G),0,this._rows),u=U(Math.ceil(r/G),0,this._cols),f=U(Math.ceil(l/G),0,this._rows);for(let m=c;m<=f;m++)for(let d=h;d<=u;d++){const p=this.getCellId(d,m);if(this.has(p))return dt}return ct}_mark(t,e,i,s,n){const a=t-i/2,r=e-s/2,l=a+i,h=r+s,c=U(Math.floor(a/G),0,this._cols),u=U(Math.floor(r/G),0,this._rows),f=U(Math.ceil(l/G),0,this._cols),m=U(Math.ceil(h/G),0,this._rows);for(let d=u;d<=m;d++)for(let p=c;p<=f;p++){const g=this.getCellId(p,d);this._debugMap.set(g,n),this.set(g)}return!1}_hasCollision(t){const e=t.id;let i=0,s=0;t.save();do{const n=t.boundsCount;i+=n;for(let a=0;a<n;a++){const r=t.boundsComputedAnchorX(a),l=t.boundsComputedAnchorY(a),h=(t.boundsWidth(a)+xt)*this._pixelRatio,c=(t.boundsHeight(a)+xt)*this._pixelRatio;switch(this._collide(r,l,h,c)){case dt:return dt;case ut:s++;break}}}while(t.peekId()===e&&t.next());return t.restore(),i===s?ut:ct}_markMetrics(t){const e=t.id;t.save();do{const i=t.boundsCount;for(let s=0;s<i;s++){const n=t.boundsComputedAnchorX(s),a=t.boundsComputedAnchorY(s),r=(t.boundsWidth(s)+xt)*this._pixelRatio,l=(t.boundsHeight(s)+xt)*this._pixelRatio;this._mark(n,a,r,l,t.id)}}while(t.peekId()===e&&t.next());t.restore()}}const ks=Math.PI;function Re(o,t){switch(t.transformationType){case X.Additive:return Bs(o,t);case X.Constant:return Ls(t,o);case X.ClampedLinear:return Ns(o,t);case X.Proportional:return Us(o,t);case X.Stops:return Os(o,t);case X.RealWorldSize:return Vs(o,t);case X.Identity:return o;case X.Unknown:return null}}function V(o,t){return typeof o=="number"?o:Re(t,o)}function Bs(o,t){const e=V(t.minSize,o);return o+(e||t.minDataValue)}function Ls(o,t){const e=o.stops;let i=e&&e.length&&e[0].size;return i==null&&(i=o.minSize),V(i,t)}function Ns(o,t){const e=t.minDataValue,i=t.maxDataValue,s=(o-e)/(i-e),n=V(t.minSize,o),a=V(t.maxSize,o);return o<=e?n:o>=i?a:n+s*(a-n)}function Us(o,t){const e=o/t.minDataValue,i=V(t.minSize,o),s=V(t.maxSize,o);let n=null;return n=e*i,U(n,i,s)}function Os(o,t){const[e,i,s]=Gs(o,t.cache.ipData);if(e===i)return V(t.stops[e].size,o);{const n=V(t.stops[e].size,o),a=V(t.stops[i].size,o);return n+(a-n)*s}}function Vs(o,t){const e=Ni[t.valueUnit],i=V(t.minSize,o),s=V(t.maxSize,o),{valueRepresentation:n}=t;let a=null;return n==="area"?a=2*Math.sqrt(o/ks)/e:n==="radius"||n==="distance"?a=2*o/e:a=o/e,U(a,i,s)}function Gs(o,t){if(!t)return;let e=0,i=t.length-1;return t.some((s,n)=>o<s?(i=n,!0):(e=n,!1)),[e,i,(o-t[e])/(t[i]-t[e])]}const Lt=254,Mt=255,lt=0;function tt(o,t){const e=[];o.forEachTile(i=>e.push(i)),e.sort((i,s)=>i.instanceId-s.instanceId),e.forEach(i=>{i.labelMetrics!=null&&i.isReady&&t(i,i.labelMetrics.getCursor())})}function $s(o){return o.layer&&(o.layer.type==="feature"||o.layer.type==="csv"||o.layer.type==="geojson"||o.layer.type==="ogc-feature"||o.layer.type==="stream"||o.layer.type==="subtype-group"||o.layer.type==="wfs")}function qs(o){return t=>et(Re(t,o))}function Zs(o){const t=o!=null&&"visualVariables"in o&&o.visualVariables;if(!t)return null;for(const e of t)if(e.type==="size")return qs(e);return null}function Hs(o){for(const t of o){const e="featureReduction"in t&&t.featureReduction&&"labelingInfo"in t.featureReduction?t.featureReduction:void 0,i=t.labelingInfo||[],s=(e==null?void 0:e.labelingInfo)||[],n=[...i,...s];if(!t.labelsVisible||!n.length)continue;if(n.some(r=>r.deconflictionStrategy==="none"))return!0}return!1}function Xs(o,t){var l;if(!$s(t))return;const e=t.layer.type==="subtype-group"?t.layer.sublayers.items:[t.layer],i=t.layer.geometryType,s=!Hs(e),n={};if(t.layer.type!=="subtype-group"){if(((l=t.tileRenderer)==null?void 0:l.type)==="heatmap")return;const h=Zs(t.layer.renderer);n[0]=h}const a=t.tileRenderer;if(a==null)return;const r=t.layer.visible&&!t.suspended;o.push({tileRenderer:a,vvEvaluators:n,deconflictionEnabled:s,geometryType:i,visible:r})}class Ys{run(t,e,i){const s=[];for(let n=t.length-1;n>=0;n--){const a=t[n];Xs(s,a)}this._transformMetrics(s),this._runCollision(s,e,i)}_runCollision(t,e,i){const[s,n]=e.state.size,a=new Rs(s,n,e.pixelRatio);for(const{tileRenderer:r,deconflictionEnabled:l,visible:h}of t){const c=r.featuresView.attributeView;if(!l){tt(r,(u,f)=>{for(;f.nextId();)c.setLabelMinZoom(f.id,lt),h&&a.insertMetrics(f)});continue}if(!h){tt(r,(u,f)=>{for(;f.nextId();)c.setLabelMinZoom(f.id,Mt)});continue}this._prepare(r),this._collideVisible(a,r,i),this._collideInvisible(a,r)}}_isFiltered(t,e,i){const s=e.getFilterFlags(t),n=!i.hasFilter||!!(s&vi),a=i.featureEffect==null||i.featureEffect.excludedLabelsVisible||!!(s&wi);return!(n&&a)}_prepare(t){const e=t.featuresView.attributeView,i=new Set;tt(t,(s,n)=>{for(;n.nextId();){if(i.has(n.id))continue;if(i.add(n.id),this._isFiltered(n.id,e,t.layerView)){e.setLabelMinZoom(n.id,Lt);continue}e.getLabelMinZoom(n.id)!==lt?e.setLabelMinZoom(n.id,Mt):e.setLabelMinZoom(n.id,lt)}})}_collideVisible(t,e,i){const s=e.featuresView.attributeView,n=new Set;tt(e,(a,r)=>{for(;r.nextId();)if(!n.has(r.id)){if(a.key.level!==i){s.setLabelMinZoom(r.id,Lt);continue}if(s.getLabelMinZoom(r.id)===0)switch(t.insertMetrics(r)){case ut:break;case dt:s.setLabelMinZoom(r.id,Lt),n.add(r.id);break;case ct:s.setLabelMinZoom(r.id,lt),n.add(r.id);break}}})}_collideInvisible(t,e){const i=e.featuresView.attributeView,s=new Set;tt(e,(n,a)=>{for(;a.nextId();)if(!s.has(a.id)&&i.getLabelMinZoom(a.id)===Mt)switch(t.insertMetrics(a)){case ut:break;case dt:i.setLabelMinZoom(a.id,Mt),s.add(a.id);break;case ct:i.setLabelMinZoom(a.id,lt),s.add(a.id);break}})}_transformMetrics(t){for(const{tileRenderer:e,geometryType:i,vvEvaluators:s}of t)tt(e,(n,a)=>{const r=e.featuresView.attributeView,l=n.transforms.labelMat2d;l[4]=Math.round(l[4]),l[5]=Math.round(l[5]);const h=i==="polyline";for(;a.next();){const c=a.boundsCount,u=a.anchorX,f=a.anchorY;let m=a.size;const d=s[0];if(d!=null){const _=r.getVVSize(a.id),w=d(_);m=isNaN(w)||w==null||w===1/0?m:w}const p=a.directionX*(m/2),g=a.directionY*(m/2);for(let _=0;_<c;_++){let w=u,z=a.anchorY;if(h){let T=w+a.boundsX(_)+p,y=z+a.boundsY(_)+g;T=l[0]*T+l[2]*y+l[4],y=l[1]*T+l[3]*y+l[5],a.setBoundsComputedAnchorX(_,Math.floor(T)),a.setBoundsComputedAnchorY(_,Math.floor(y))}else{w=l[0]*u+l[2]*f+l[4],z=l[1]*u+l[3]*f+l[5];const T=w+a.boundsX(_)+p,y=z+a.boundsY(_)+g;a.setBoundsComputedAnchorX(_,T),a.setBoundsComputedAnchorY(_,y)}}}})}}const Ws=32;let K=class extends Qe(rt){constructor(t){super(t),this._applyVisibilityPassThrottled=Bi(this._applyVisibilityPass,Ws,this),this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}initialize(){this.collisionEngine=new Ys}destroy(){this.collisionEngine=null,this._applyVisibilityPassThrottled=je(this._applyVisibilityPassThrottled)}get updating(){return it("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:
-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(t){this._applyVisibilityPassThrottled(t)}viewChange(){this.requestUpdate()}requestUpdate(){var t;this.updateRequested||(this.updateRequested=!0,(t=this.view)==null||t.requestUpdate())}processUpdate(t){this._set("updateParameters",t),this.updateRequested&&(this.updateRequested=!1,this.update(t))}_applyVisibilityPass(t){const e=this.view;if(e)try{const i=e.featuresTilingScheme.getClosestInfoForScale(t.state.scale).level;this.collisionEngine.run(e.allLayerViews.items,t,i)}catch{}}};M([P()],K.prototype,"updateRequested",void 0);M([P({readOnly:!0})],K.prototype,"updateParameters",void 0);M([P()],K.prototype,"updating",null);M([P()],K.prototype,"view",void 0);K=M([at("esri.views.2d.layers.labels.LabelManager")],K);const Un=K,St="esri-zoom-box",Tt={container:`${St}__container`,overlay:`${St}__overlay`,background:`${St}__overlay-background`,box:`${St}__outline`},Nt={zoom:"Shift",counter:"Ctrl"};let pt=class extends rt{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._handles=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this._handles&&this._handles.forEach(e=>{e.remove()}),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[Nt.zoom],e=>this._handleDrag(e,1),ee.INTERNAL),t.on("drag",[Nt.zoom,Nt.counter],e=>this._handleDrag(e,-1),ee.INTERNAL))}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,i,s){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=s,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,i,s,n){const a=this.view,r=a.toMap(Ke(t+i*.5,e+s*.5));let l=Math.max(i/a.width,s/a.height);n===-1&&(l=1/l),this._destroyOverlay(),this.navigation.end(),a.goTo({center:r,scale:a.scale*l})}_updateBox(t,e,i,s){const n=this._boxShape;n.setAttributeNS(null,"x",""+t),n.setAttributeNS(null,"y",""+e),n.setAttributeNS(null,"width",""+i),n.setAttributeNS(null,"height",""+s),n.setAttributeNS(null,"class",Tt.box)}_updateBackground(t,e,i,s){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,s,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=Tt.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",Tt.background);const s=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttributeNS(null,"class",Tt.overlay),n.appendChild(i),n.appendChild(s),this._container.appendChild(n),this._backgroundShape=i,this._boxShape=s,this._overlay=n}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,i,s,n,a){const r=e,l=t,h=t+i,c=e+s;return"M 0 0 L "+n+" 0 L "+n+" "+a+" L 0 "+a+" ZM "+l+" "+r+" L "+l+" "+c+" L "+h+" "+c+" L "+h+" "+r+" Z"}_handleDrag(t,e){const i=t.x,s=t.y,n=t.origin.x,a=t.origin.y;let r,l,h,c;switch(i>n?(r=n,h=i-n):(r=i,h=n-i),s>a?(l=a,c=s-a):(l=s,c=a-s),t.action){case"start":this._start();break;case"update":this._update(r,l,h,c);break;case"end":this._end(r,l,h,c,e);break}t.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:t,y:e,width:i,height:s}=this._box;this._updateBox(t,e,i,s),this._updateBackground(t,e,i,s),this._rafId=requestAnimationFrame(this._redraw)}};M([P()],pt.prototype,"navigation",void 0);M([P()],pt.prototype,"view",null);pt=M([at("esri.views.2d.navigation.ZoomBox")],pt);const Qs=pt;class Y{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const e=this.computeDelta(t);this._updateDelta(e)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return this.lastValue===void 0?NaN:t-this.lastValue}_updateDelta(t){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}class jt{constructor(t,e,i){this._initialVelocity=t,this._stopVelocity=e,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,e){const i=this.value(t);return this.value(t+e)-i}valueFromInitialVelocity(t,e){e=Math.min(e,this.duration);const i=1-this.friction;return t*(i**e-1)/Math.log(i)}}class js extends jt{constructor(t,e,i,s,n){super(t,e,i),this._sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class Ks{constructor(t=300,e=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this.enabled=!0,this._time=new Y(.6),this._screen=[new Y(.4),new Y(.4)],this._scene=[new Y(.6),new Y(.6),new Y(.6)],this._tmpDirection=Te()}add(t,e,i){this.enabled&&(this._time.hasLastValue()&&this._time.computeDelta(i)<.015||(this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(e[0]),this._scene[1].update(e[1]),this._scene[2].update(e[2]),this._time.update(i)))}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,e=this._screen[1].filteredDelta,i=t==null||e==null?0:Math.sqrt(t*t+e*e),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,e,i){Je(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=ti(this._tmpDirection);s>0&&Ie(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta,a=n==null?0:s/n;return new js(t,e,i,a,this._tmpDirection)}}let st=class extends rt{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new Ks(500,6,.92),this.momentum=null,this.tmpMomentum=Te(),this.momentumFinished=!1,this.viewpoint=new zt({targetGeometry:new At,scale:0,rotation:0}),this._previousDrag=null,De(()=>this.momentumFinished,()=>this.navigation.stop())}begin(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this._previousDrag=e}update(t,e){this.addToEstimator(e);let i=e.center.x,s=e.center.y;const n=this._previousDrag;i=n?n.center.x-i:-i,s=n?s-n.center.y:s,t.viewpoint=Dt(this.viewpoint,t.viewpoint,[i||0,s||0]),this._previousDrag=e}end(t,e){this.addToEstimator(e);const i=t.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}addToEstimator(t){const e=t.center.x,i=t.center.y,s=ei(-e,i),n=ii(-e,i,0);this.momentumEstimator.add(s,n,t.timestamp*.001)}onAnimationUpdate(t){var e;(e=this.navigation.animationManager)==null||e.animateContinous(t.viewpoint,(i,s)=>{const{momentum:n,animationTime:a,tmpMomentum:r}=this,l=this.momentumFinished=!n||n.isFinished(a),h=s*.001;if(!l){const c=n.valueDelta(a,h);Ie(r,n.direction,c),Dt(i,i,r),t.constraints.constrainByGeometry(i)}this.animationTime+=h})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};M([P()],st.prototype,"momentumFinished",void 0);M([P()],st.prototype,"viewpoint",void 0);M([P()],st.prototype,"navigation",void 0);st=M([at("esri.views.2d.navigation.actions.Pan")],st);const Js=st;class ke{constructor(t=2.5,e=.01,i=.95,s=12){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new Y(.8),this.time=new Y(.3)}add(t,e){if(!(!this.enabled||e==null)){if(this.time.hasLastValue()){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta()){const s=this.value.computeDelta(t);this.value.filteredDelta*s<0&&this.value.reset()}}this.time.update(e),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=U(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,e,i){return new jt(t,e,i)}}class tn extends ke{constructor(t=3,e=.01,i=.95,s=12){super(t,e,i,s)}add(t,e){const i=this.value.lastValue;if(i!=null){let s=t-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=i+s}super.add(t,e)}}class en extends jt{constructor(t,e,i){super(t,e,i)}value(t){const e=super.value(t);return Math.exp(e)}valueDelta(t,e){const i=super.value(t),n=super.value(t+e)-i;return Math.exp(n)}}class sn extends ke{constructor(t=2.5,e=.01,i=.95,s=12){super(t,e,i,s)}add(t,e){super.add(Math.log(t),e)}createMomentum(t,e,i){return new en(t,e,i)}}let nt=class extends rt{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new tn(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new sn,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new zt({targetGeometry:new At,scale:0,rotation:0}),this.addHandles(De(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)}update(t,e){this._updateTimestamp===null&&(this._updateTimestamp=e.timestamp);const i=e.angle,s=e.radius,n=e.center,a=Math.abs((i-this._startAngle)*180/Math.PI),r=Math.abs(s-this._startRadius),l=this._startRadius/s;if(this._previousRadius&&this._previousCenter){const h=s/this._previousRadius;let c=(i-this._previousAngle)*180/Math.PI;this._rotationDirection=c>=0?1:-1,this._zoomDirection=h>=1?1:-1,t.constraints.rotationEnabled?(this._zoomOnly===null&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=r-a>0),this._zoomOnly===null||this._zoomOnly?c=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):c=0,this.addToZoomEstimator(e,l),this.navigation.setViewpoint([n.x,n.y],1/h,c,[this._previousCenter.x-n.x,n.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=s,this._previousCenter=n}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,e){this._rotationMomentumEstimator.add(t,e*.001)}addToZoomEstimator(t,e){this._zoomMomentumEstimator.add(e,t.timestamp*.001)}canZoomIn(t){const e=t.scale,i=t.constraints.effectiveMaxScale;return i===0||e>i}canZoomOut(t){const e=t.scale,i=t.constraints.effectiveMinScale;return i===0||e<i}onAnimationUpdate(t){var e;(e=this.navigation.animationManager)==null||e.animateContinous(t.viewpoint,(i,s)=>{const n=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,a=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),r=n||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),l=s*.001;if(this._momentumFinished=a&&r,!this._momentumFinished){const h=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,l))*this._rotationDirection*180/Math.PI:0;let c=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,l)):1;const u=ft(),f=ft();if(this._previousCenter){mt(u,this._previousCenter.x,this._previousCenter.y),si(f,t.size,t.padding),ni(u,u,f);const{constraints:m,scale:d}=t,p=d*c;c<1&&!m.canZoomInTo(p)?(c=d/m.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):c>1&&!m.canZoomOutTo(p)&&(c=d/m.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),ai(i,t.viewpoint,c,h,u,t.size),t.constraints.constrainByGeometry(i)}}this._animationTime+=l})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};M([P()],nt.prototype,"_momentumFinished",void 0);M([P()],nt.prototype,"viewpoint",void 0);M([P()],nt.prototype,"navigation",void 0);nt=M([at("esri.views.2d.navigation.actions.Pinch")],nt);const nn=nt,Ut=ft(),be=ft();let gt=class extends rt{constructor(t){super(t),this._previousCenter=ft(),this.viewpoint=new zt({targetGeometry:new At,scale:0,rotation:0})}begin(t,e){this.navigation.begin(),mt(this._previousCenter,e.center.x,e.center.y)}update(t,e){const{state:{size:i,padding:s}}=t;mt(Ut,e.center.x,e.center.y),ri(be,i,s),t.viewpoint=qt(this.viewpoint,t.state.paddedViewState.viewpoint,oi(be,this._previousCenter,Ut)),hi(this._previousCenter,Ut)}end(){this.navigation.end()}};M([P()],gt.prototype,"viewpoint",void 0);M([P()],gt.prototype,"navigation",void 0);gt=M([at("esri.views.2d.actions.Rotate")],gt);const an=gt,It=10,xe=1,Ot=new zt({targetGeometry:new At}),Vt=[0,0],Me=250;let $=class extends rt{constructor(t){super(t),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new Js({navigation:this}),this.rotate=new an({navigation:this}),this.pinch=new nn({navigation:this}),this.zoomBox=new Qs({view:this.view,navigation:this})}destroy(){this.pan=_t(this.pan),this.rotate=_t(this.rotate),this.pinch=_t(this.pinch),this.zoomBox=_t(this.zoomBox),this.animationManager=null}begin(){this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(Me)}async zoom(t,e=this._getDefaultAnchor()){if(this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(e):this.zoomOut(e);this.setViewpoint(e,t,0,[0,0])}async zoomIn(t){const e=this.view,i=e.constraints.snapToNextScale(e.scale);return this._zoomToScale(i,t)}async zoomOut(t){const e=this.view,i=e.constraints.snapToPreviousScale(e.scale);return this._zoomToScale(i,t)}setViewpoint(t,e,i,s){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,e,i,s),this.end()}setViewpointImmediate(t,e=0,i=[0,0],s=this._getDefaultAnchor()){this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,s,t,e,i)}continousRotateClockwise(){var e;const t=this.get("view.viewpoint");(e=this.animationManager)==null||e.animateContinous(t,i=>{qt(i,i,-xe)})}continousRotateCounterclockwise(){var e;const t=this.get("view.viewpoint");(e=this.animationManager)==null||e.animateContinous(t,i=>{qt(i,i,xe)})}resetRotation(){this.view.rotation=0}continousPanLeft(){this._continuousPan([-It,0])}continousPanRight(){this._continuousPan([It,0])}continousPanUp(){this._continuousPan([0,It])}continousPanDown(){this._continuousPan([0,-It])}stop(){var t;this.pan.stopMomentumNavigation(),(t=this.animationManager)==null||t.stop(),this.end(),this._endTimer!==null&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(t){var i;const e=this.view.viewpoint;(i=this.animationManager)==null||i.animateContinous(e,s=>{Dt(s,s,t),this.view.constraints.constrainByGeometry(s)})}_startTimer(t){return this._endTimer!==null?this._endTimer:(this._endTimer=setTimeout(()=>{this._endTimer=null;const e=performance.now()-(this._lastEventTimestamp??0);e<Me?this._endTimer=this._startTimer(e):this._set("interacting",!1)},t),this._endTimer)}_getDefaultAnchor(){const{size:t,padding:{left:e,right:i,top:s,bottom:n}}=this.view;return Vt[0]=(t[0]-i+e)*.5,Vt[1]=(t[1]-n+s)*.5,Vt}async _zoomToScale(t,e=this._getDefaultAnchor()){const{view:i}=this,{constraints:s,scale:n,viewpoint:a,size:r,padding:l}=i,h=s.canZoomInTo(t),c=s.canZoomOutTo(t);if(!(t<n&&!h||t>n&&!c))return ie(Ot,a,t/n,0,e,r,l),s.constrainByGeometry(Ot),i.goTo(Ot,{animate:!0})}_scaleRotateTranslateViewpoint(t,e,i,s,n){const{view:a}=this,{size:r,padding:l,constraints:h,scale:c,viewpoint:u}=a,f=c*i,m=h.canZoomInTo(f),d=h.canZoomOutTo(f);return(i<1&&!m||i>1&&!d)&&(i=1),Dt(u,u,n),ie(t,u,i,s,e,r,l),h.constrainByGeometry(t)}};M([P()],$.prototype,"animationManager",void 0);M([P({type:Boolean,readOnly:!0})],$.prototype,"interacting",void 0);M([P()],$.prototype,"pan",void 0);M([P()],$.prototype,"pinch",void 0);M([P()],$.prototype,"rotate",void 0);M([P()],$.prototype,"view",void 0);M([P()],$.prototype,"zoomBox",void 0);$=M([at("esri.views.2d.navigation.MapViewNavigation")],$);const Zn=$,rn={shaders:{vertexShader:k("magnifier/magnifier.vert"),fragmentShader:k("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function Hn(o){return Ui(o,rn)}export{Rn as B,Un as L,Zn as M,Ln as P,En as T,hs as a,Fn as b,Bn as c,ts as d,Hn as e,kn as h,rn as m,An as p,Cn as s};
