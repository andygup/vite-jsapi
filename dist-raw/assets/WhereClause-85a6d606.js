import{g0 as bl,d$ as Fl,m as br}from"./index-30d9bb6f.js";import{d as Dr}from"./executionError-e2eca390.js";import{c as Pl}from"./_commonjsHelpers-725317a4.js";function Ll(u,n){const l=Or[u.toLowerCase()];if(l==null)throw new Error("Function Not Recognised");if(n.length<l.minParams||n.length>l.maxParams)throw new Error(`Invalid Parameter count for call to ${u.toUpperCase()}`);return l.evaluate(n)}function Rl(u,n){const l=Or[u.toLowerCase()];return l!=null&&n>=l.minParams&&n<=l.maxParams}const Or={min:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.min.apply(Math,u[0])},max:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.max.apply(Math,u[0])},avg:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Wr(u[0])},sum:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Ml(u[0])},stddev:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.sqrt(Fr(u[0]))},count:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:u[0].length},var:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Fr(u[0])}};function Wr(u){let n=0;for(let l=0;l<u.length;l++)n+=u[l];return n/u.length}function Ml(u){let n=0;for(let l=0;l<u.length;l++)n+=u[l];return n}function Fr(u){const n=Wr(u),l=u.length;let p=0;for(const g of u)p+=(g-n)**2;return l>1?p/(l-1):0}var C;(function(u){u.InvalidFunctionParameters="InvalidFunctionParameters",u.UnsupportedSqlFunction="UnsupportedSqlFunction",u.UnsupportedOperator="UnsupportedOperator",u.UnsupportedSyntax="UnsupportedSyntax",u.UnsupportedIsRhs="UnsupportedIsRhs",u.UnsupportedIsLhs="UnsupportedIsLhs",u.InvalidDataType="InvalidDataType",u.CannotCastValue="CannotCastValue",u.MissingStatisticParameters="MissingStatisticParameters"})(C||(C={}));const Dl={[C.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[C.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[C.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[C.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[C.UnsupportedOperator]:"Unsupported operator - {operator}",[C.UnsupportedSyntax]:"Unsupported syntax - {node}",[C.UnsupportedSqlFunction]:"Sql function not found = {function}",[C.InvalidDataType]:"Invalid sql data type",[C.CannotCastValue]:"Cannot cast value to the required data type"};class W extends Error{constructor(n,l){super(Dr(Dl[n],l)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,W)}}var L;(function(u){u.NeverReach="NeverReach",u.NotImplemented="NotImplemented",u.Cancelled="Cancelled",u.InvalidStatResponse="InvalidStatResponse",u.InvalidRequest="InvalidRequest",u.RequestFailed="RequestFailed",u.MissingFeatures="MissingFeatures",u.AggregationFieldNotFound="AggregationFieldNotFound",u.DataElementsNotFound="DataElementsNotFound"})(L||(L={}));const Ol={[L.Cancelled]:"Cancelled",[L.InvalidStatResponse]:"Invalid statistics response from service",[L.InvalidRequest]:"Invalid request",[L.RequestFailed]:"Request failed - {reason}",[L.MissingFeatures]:"Missing features",[L.AggregationFieldNotFound]:"Aggregation field not found",[L.DataElementsNotFound]:"Data elements not found on service",[L.NeverReach]:"Encountered unreachable logic",[L.NotImplemented]:"Not implemented"};class Kr extends Error{constructor(n,l){super(Dr(Ol[n],l)),this.declaredRootClass="esri.arcade.featureset.support.featureseterror",Error.captureStackTrace&&Error.captureStackTrace(this,Kr)}}class S{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(n){if(n.precision!==null||n.secondary!==null)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static _parseSecondsComponent(n,l){if(l.includes(".")){const p=l.split(".");n.second=parseFloat(p[0]),n.millis=parseInt(p[1],10)}else n.second=parseFloat(l)}static createFromMilliseconds(n){const l=new S;return l.second=n/1e3,l}static createFromValueAndQualifer(n,l,p){let g=null;const f=new S;if(f.op=p==="-"?"-":"+",l.type==="interval-period"){S._fixDefaults(l);const $=new RegExp("^[0-9]{1,}$");if(l.period==="year"||l.period==="month")throw new Error("Year-Month Intervals not supported");if(l.period==="second")if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(n))S._parseSecondsComponent(f,n);else throw new Error("Illegal Interval");else if($.test(n))f[l.period]=parseFloat(n);else throw new Error("Illegal Interval")}else{if(S._fixDefaults(l.start),S._fixDefaults(l.end),l.start.period==="year"||l.start.period==="month")throw new Error("Year-Month Intervals not supported");if(l.end.period==="year"||l.end.period==="month")throw new Error("Year-Month Intervals not supported");switch(l.start.period){case"day":switch(l.end.period){case"hour":if(g=new RegExp("^[0-9]{1,} [0-9]{1,}$"),g.test(n))f[l.start.period]=parseFloat(n.split(" ")[0]),f[l.end.period]=parseFloat(n.split(" ")[1]);else throw new Error("Illegal Interval");break;case"minute":if(g=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),g.test(n)){f[l.start.period]=parseFloat(n.split(" ")[0]);const $=n.split(" ")[1].split(":");f.hour=parseFloat($[0]),f.minute=parseFloat($[1])}else throw new Error("Illegal Interval");break;case"second":if(g=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),g.test(n)){f[l.start.period]=parseFloat(n.split(" ")[0]);const $=n.split(" ")[1].split(":");f.hour=parseFloat($[0]),f.minute=parseFloat($[1]),S._parseSecondsComponent(f,$[2])}else throw new Error("Illegal Interval");break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(l.end.period){case"minute":if(g=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),g.test(n))f.hour=parseFloat(n.split(":")[0]),f.minute=parseFloat(n.split(":")[1]);else throw new Error("Illegal Interval");break;case"second":if(g=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),g.test(n)){const $=n.split(":");f.hour=parseFloat($[0]),f.minute=parseFloat($[1]),S._parseSecondsComponent(f,$[2])}else throw new Error("Illegal Interval");break;default:throw new Error("Invalid Interval.")}break;case"minute":switch(l.end.period){case"second":if(g=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),g.test(n)){const $=n.split(":");f.minute=parseFloat($[0]),S._parseSecondsComponent(f,$[1])}else throw new Error("Illegal Interval");break;default:throw new Error("Invalid Interval.")}break;default:throw new Error("Invalid Interval.")}}return f}valueInMilliseconds(){return(this.op==="-"?-1:1)*(this.millis+this.second*1e3+this.minute*60*1e3+this.hour*60*60*1e3+this.day*24*60*60*1e3+this.month*(365/12)*24*60*60*1e3+this.year*365*24*60*60*1e3)}}function Le(u,n){const l=Ur[u.toLowerCase()];if(l==null)throw new Error("Function Not Recognised");if(n.length<l.minParams||n.length>l.maxParams)throw new Error(`Invalid Parameter count for call to ${u.toUpperCase()}`);return l.evaluate(n)}function Wl(u,n){const l=Ur[u.toLowerCase()];return l!=null&&n>=l.minParams&&n<=l.maxParams}function Kl(u){return typeof u=="string"||u instanceof String}function Ul(u){return u instanceof Date}function Pr(u){const n=new Date(u.getTime());return n.setHours(0,0,0,0),n}function Lr(u,n){if(Ul(u))return n?Pr(u):u;if(Kl(u)){const l=Fl.fromSQL(u);if(l.isValid)return n?Pr(l.toJSDate()):l.toJSDate()}throw new W(C.CannotCastValue)}const Ur={extract:{minParams:2,maxParams:2,evaluate:([u,n])=>{if(n==null)return null;if(n instanceof Date)switch(u.toUpperCase()){case"SECOND":return n.getSeconds();case"MINUTE":return n.getMinutes();case"HOUR":return n.getHours();case"DAY":return n.getDate();case"MONTH":return n.getMonth()+1;case"YEAR":return n.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:u=>{if(u.length===2){const[n,l]=u;return n==null||l==null?null:n.toString().substring(l-1)}if(u.length===3){const[n,l,p]=u;return n==null||l==null||p==null?null:p<=0?"":n.toString().substring(l-1,l+p-1)}}},position:{minParams:2,maxParams:2,evaluate:([u,n])=>u==null||n==null?null:n.indexOf(u)+1},trim:{minParams:2,maxParams:3,evaluate:u=>{const n=u.length===3,l=n?u[1]:" ",p=n?u[2]:u[1];if(l==null||p==null)return null;const g=`(${bl(l)})`;switch(u[0]){case"BOTH":return p.replace(new RegExp(`^${g}*|${g}*$`,"g"),"");case"LEADING":return p.replace(new RegExp(`^${g}*`,"g"),"");case"TRAILING":return p.replace(new RegExp(`${g}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.abs(u[0])},ceiling:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.ceil(u[0])},floor:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.floor(u[0])},log:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.log(u[0])},log10:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.log(u[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.sin(u[0])},cos:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.cos(u[0])},tan:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.tan(u[0])},asin:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.asin(u[0])},acos:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.acos(u[0])},atan:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.atan(u[0])},sign:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:u[0]>0?1:u[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:u=>u[0]==null||u[1]==null?null:u[0]**u[1]},mod:{minParams:2,maxParams:2,evaluate:u=>u[0]==null||u[1]==null?null:u[0]%u[1]},round:{minParams:1,maxParams:2,evaluate:u=>{const n=u[0],l=u.length===2?10**u[1]:1;return n==null?null:Math.round(n*l)/l}},truncate:{minParams:1,maxParams:2,evaluate:u=>u[0]==null?null:u.length===1?parseInt(u[0].toFixed(0),10):parseFloat(u[0].toFixed(u[1]))},char_length:{minParams:1,maxParams:1,evaluate:u=>typeof u[0]=="string"||u[0]instanceof String?u[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:u=>{let n="";for(let l=0;l<u.length;l++){if(u[l]==null)return null;n+=u[l].toString()}return n}},lower:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:u[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:u[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:u=>{for(const n of u)if(n!==null)return n;return null}},cosh:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.cosh(u[0])},sinh:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.sinh(u[0])},tanh:{minParams:1,maxParams:1,evaluate:u=>u[0]==null?null:Math.tanh(u[0])},nullif:{minParams:2,maxParams:2,evaluate:u=>{const n=u[0],l=u[1];return(n instanceof Date?n.valueOf():n)===(l instanceof Date?l.valueOf():l)?null:n}},cast:{minParams:2,maxParams:2,evaluate:u=>{const n=u[0],l=u[1];if(n===null)return null;switch(l.type){case"integer":{const p=parseInt(n,10);if(isNaN(p))throw new W(C.CannotCastValue);return p}case"smallint":{const p=parseInt(n,10);if(isNaN(p))throw new W(C.CannotCastValue);if(p>32767||p<-32767)throw new W(C.CannotCastValue);return p}case"float":case"real":{const p=parseFloat(n);if(isNaN(p))throw new W(C.CannotCastValue);return p}case"date":return Lr(n,!0);case"timestamp":return Lr(n,!1);case"varchar":{const p=n.toString();if(p.length>l.size)throw new W(C.CannotCastValue);return p}default:throw new W(C.InvalidDataType)}}}};var Ce={},Jl={get exports(){return Ce},set exports(u){Ce=u}};(function(u){(function(n,l){u.exports&&(u.exports=l())})(Pl,function(){function n(f,$){function r(){this.constructor=f}r.prototype=$.prototype,f.prototype=new r}function l(f,$,r,T){var _=Error.call(this,f);return Object.setPrototypeOf&&Object.setPrototypeOf(_,l.prototype),_.expected=$,_.found=r,_.location=T,_.name="SyntaxError",_}n(l,Error);function p(f,$,r){return r=r||" ",f.length>$?f:($-=f.length,r+=r.repeat($),f+r.slice(0,$))}l.prototype.format=function(f){var $="Error: "+this.message;if(this.location){var r=null,T;for(T=0;T<f.length;T++)if(f[T].source===this.location.source){r=f[T].text.split(/\r\n|\n|\r/g);break}var _=this.location.start,F=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(_):_,U=this.location.source+":"+F.line+":"+F.column;if(r){var M=this.location.end,J=p("",F.line.toString().length," "),E=r[_.line-1],x=_.line===M.line?M.column:E.length+1,P=x-_.column||1;$+=`
 --> `+U+`
`+J+` |
`+F.line+" | "+E+`
`+J+" | "+p("",_.column-1," ")+p("",P,"^")}else $+=`
 at `+U}return $},l.buildMessage=function(f,$){var r={literal:function(E){return'"'+_(E.text)+'"'},class:function(E){var x=E.parts.map(function(P){return Array.isArray(P)?F(P[0])+"-"+F(P[1]):F(P)});return"["+(E.inverted?"^":"")+x.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(E){return E.description}};function T(E){return E.charCodeAt(0).toString(16).toUpperCase()}function _(E){return E.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(x){return"\\x0"+T(x)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(x){return"\\x"+T(x)})}function F(E){return E.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(x){return"\\x0"+T(x)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(x){return"\\x"+T(x)})}function U(E){return r[E.type](E)}function M(E){var x=E.map(U),P,G;if(x.sort(),x.length>0){for(P=1,G=1;P<x.length;P++)x[P-1]!==x[P]&&(x[G]=x[P],G++);x.length=G}switch(x.length){case 1:return x[0];case 2:return x[0]+" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}function J(E){return E?'"'+_(E)+'"':"end of input"}return"Expected "+M(f)+" but "+J($)+" found."};function g(f,$){$=$!==void 0?$:{};var r={},T=$.grammarSource,_={start:qe},F=qe,U="!",M="=",J=">=",E=">",x="<=",P="<>",G="<",Me="!=",ve="+",ge="-",De="||",jr="*",Yr="/",Zr="@",Oe="'",We="N'",X="''",qr=".",Qr="null",Xr="true",es="false",rs="in",ss="is",ts="like",as="escape",ns="not",is="and",ls="or",us="between",fs="from",os="for",cs="substring",ps="extract",vs="trim",gs="position",hs="timestamp",ms="date",$s="leading",ds="trailing",ys="both",ws="cast",Ns="as",_s="integer",Ts="smallint",xs="float",Es="real",Is="varchar",Ss="to",Cs="interval",As="year",bs="month",Fs="day",Ps="hour",Ls="minute",Rs="second",Ms="case",Ds="end",Os="when",Ws="then",Ks="else",Us=",",Js="(",Vs=")",Ke="`",Hs=/^[A-Za-z_\x80-\uFFFF]/,ks=/^[A-Za-z0-9_]/,Bs=/^[A-Za-z0-9_.\x80-\uFFFF]/,Ue=/^[^']/,zs=/^[0-9]/,Gs=/^[eE]/,js=/^[+\-]/,Ys=/^[ \t\n\r]/,Je=/^[^`]/,Zs=d("!",!1),Ve=d("=",!1),qs=d(">=",!1),Qs=d(">",!1),Xs=d("<=",!1),et=d("<>",!1),rt=d("<",!1),st=d("!=",!1),he=d("+",!1),me=d("-",!1),tt=d("||",!1),at=d("*",!1),nt=d("/",!1),it=D([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),lt=D([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),ut=D([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),ft=d("@",!1),He=d("'",!1),ot=d("N'",!1),ke=d("''",!1),Be=D(["'"],!0,!1),ct=d(".",!1),pt=D([["0","9"]],!1,!1),vt=D(["e","E"],!1,!1),gt=D(["+","-"],!1,!1),ht=d("NULL",!0),mt=d("TRUE",!0),$t=d("FALSE",!0),dt=d("IN",!0),yt=d("IS",!0),wt=d("LIKE",!0),Nt=d("ESCAPE",!0),_t=d("NOT",!0),Tt=d("AND",!0),xt=d("OR",!0),Et=d("BETWEEN",!0),It=d("FROM",!0),St=d("FOR",!0),Ct=d("SUBSTRING",!0),At=d("EXTRACT",!0),bt=d("TRIM",!0),Ft=d("POSITION",!0),Pt=d("TIMESTAMP",!0),Lt=d("DATE",!0),Rt=d("LEADING",!0),Mt=d("TRAILING",!0),Dt=d("BOTH",!0),Ot=d("CAST",!0),Wt=d("AS",!0),Kt=d("INTEGER",!0),Ut=d("SMALLINT",!0),Jt=d("FLOAT",!0),Vt=d("REAL",!0),Ht=d("VARCHAR",!0),kt=d("TO",!0),Bt=d("INTERVAL",!0),zt=d("YEAR",!0),Gt=d("MONTH",!0),jt=d("DAY",!0),Yt=d("HOUR",!0),Zt=d("MINUTE",!0),qt=d("SECOND",!0),Qt=d("CASE",!0),Xt=d("END",!0),ea=d("WHEN",!0),ra=d("THEN",!0),sa=d("ELSE",!0),ta=d(",",!1),aa=d("(",!1),na=d(")",!1),ia=D([" ","	",`
`,"\r"],!1,!1),ze=d("`",!1),Ge=D(["`"],!0,!1),la=function(e){return e},ua=function(e,t){var a={type:"expression-list"},i=Al(e,t);return a.value=i,a},fa=function(e,t){return q(e,t)},oa=function(e,t){return q(e,t)},ca=function(e){return Sl("NOT",e)},pa=function(e,t){if(t==""||t==null||t==null)return e;var a=null;return t.type=="arithmetic"?a=q(e,t.tail):a=Sr(t.op,e,t.right,t.escape),a},va=function(e){return{type:"arithmetic",tail:e}},ga=function(e,t){return{op:e+"NOT",right:t}},ha=function(e,t){return{op:e,right:t}},ma=function(e,t,a){return{op:"NOT"+e,right:{type:"expression-list",value:[t,a]}}},$a=function(e,t,a){return{op:e,right:{type:"expression-list",value:[t,a]}}},da=function(e){return e[0]+" "+e[2]},ya=function(e){return e[0]+" "+e[2]},wa=function(e,t,a){return{op:e,right:t,escape:a.value}},Na=function(e,t){return{op:e,right:t,escape:""}},_a=function(e,t){return{op:e,right:t}},Ta=function(e){return{op:e,right:{type:"expression-list",value:[]}}},xa=function(e,t){return{op:e,right:t}},Ea=function(e,t){return q(e,t)},Ia=function(e,t){return q(e,t)},Sa=function(e){return e.paren=!0,e},Ca=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:e}},Aa=function(e){return e},ba=function(e,t){return e+t.join("")},Fa=function(e,t){return e+t.join("")},Pa=function(e){var t={type:"parameter",value:e[1]};return t},La=function(e,t){return{type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:e},t]}}},Ra=function(e,t,a){return{type:"function",name:"substring",args:{type:"expression-list",value:a?[e,t,a[2]]:[e,t]}}},Ma=function(e,t){return{type:"function",name:"cast",args:{type:"expression-list",value:[e,t]}}},Da=function(){return{type:"data-type",value:{type:"integer"}}},Oa=function(){return{type:"data-type",value:{type:"smallint"}}},Wa=function(){return{type:"data-type",value:{type:"float"}}},Ka=function(){return{type:"data-type",value:{type:"real"}}},Ua=function(){return{type:"data-type",value:{type:"date"}}},Ja=function(){return{type:"data-type",value:{type:"timestamp"}}},Va=function(e){return{type:"data-type",value:{type:"varchar",size:parseInt(e)}}},Ha=function(e,t,a){var i={type:"string",value:e??"BOTH"};return{type:"function",name:"trim",args:{type:"expression-list",value:[i,t,a]}}},ka=function(e,t){var a={type:"string",value:e??"BOTH"};return{type:"function",name:"trim",args:{type:"expression-list",value:[a,t]}}},Ba=function(e,t){return{type:"function",name:"position",args:{type:"expression-list",value:[e,t]}}},za=function(e,t){return{type:"function",name:e,args:t||{type:"expression-list",value:[]}}},Ga=function(e){return{type:"timestamp",value:e.value}},ja=function(e,t,a){return{type:"interval",value:t,qualifier:a,op:e}},Ya=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}},Za=function(e,t){return{type:"interval-qualifier",start:e,end:t}},qa=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}},Qa=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},Xa=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},en=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},rn=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},sn=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},tn=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}},an=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},nn=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},ln=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},un=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},fn=function(){return{type:"string",value:"day"}},on=function(){return{type:"string",value:"hour"}},cn=function(){return{type:"string",value:"minute"}},pn=function(){return{type:"string",value:"month"}},vn=function(){return{type:"string",value:"year"}},gn=function(e){return parseFloat(e)},hn=function(e){return parseFloat(e)},mn=function(e){return{type:"date",value:e.value}},$n=function(){return{type:"null",value:null}},dn=function(){return{type:"boolean",value:!0}},yn=function(){return{type:"boolean",value:!1}},je=function(){return"'"},wn=function(e){return{type:"string",value:e.join("")}},Nn=function(e,t){return{type:"case-expression",format:"simple",operand:e,clauses:t,else:null}},_n=function(e,t,a){return{type:"case-expression",format:"simple",operand:e,clauses:t,else:a.value}},Tn=function(e){return{type:"case-expression",format:"searched",clauses:e,else:null}},xn=function(e,t){return{type:"case-expression",format:"searched",clauses:e,else:t.value}},En=function(e,t){return{type:"when-clause",operand:e,value:t}},In=function(e,t){return{type:"when-clause",operand:e,value:t}},Sn=function(e){return{type:"else-clause",value:e}},Cn=function(e){return{type:"number",value:e}},An=function(e,t,a){return parseFloat(e+t+a)},bn=function(e,t){return parseFloat(e+t)},Fn=function(e,t){return parseFloat(e+t)},Pn=function(e){return parseFloat(e)},Ln=function(e,t){return e[0]+t},Rn=function(e){return"."+(e??"")},Mn=function(e,t){return e+t},Dn=function(e){return e.join("")},On=function(e,t){return"e"+(t===null?"":t)},Wn=function(){return"IN"},Kn=function(){return"IS"},Un=function(){return"LIKE"},Jn=function(){return"ESCAPE"},Vn=function(){return"NOT"},Hn=function(){return"AND"},kn=function(){return"OR"},Bn=function(){return"BETWEEN"},zn=function(){return"FROM"},Gn=function(){return"FOR"},jn=function(){return"SUBSTRING"},Yn=function(){return"EXTRACT"},Zn=function(){return"TRIM"},qn=function(){return"POSITION"},Qn=function(){return"TIMESTAMP"},Xn=function(){return"DATE"},ei=function(){return"LEADING"},ri=function(){return"TRAILING"},si=function(){return"BOTH"},ti=function(){return"CAST"},ai=function(){return"AS"},ni=function(){return"INTEGER"},ii=function(){return"SMALLINT"},li=function(){return"FLOAT"},ui=function(){return"REAL"},fi=function(){return"VARCHAR"},oi=function(){return"TO"},ci=function(){return"INTERVAL"},pi=function(){return"YEAR"},vi=function(){return"MONTH"},gi=function(){return"DAY"},hi=function(){return"HOUR"},mi=function(){return"MINUTE"},$i=function(){return"SECOND"},di=function(){return"CASE"},yi=function(){return"END"},wi=function(){return"WHEN"},Ni=function(){return"THEN"},_i=function(){return"ELSE"},Ti=function(e){return e},xi=function(e){return e.join("")},s=0,ee=[{line:1,column:1}],R=0,$e=[],o=0,re;if("startRule"in $){if(!($.startRule in _))throw new Error(`Can't start parsing from rule "`+$.startRule+'".');F=_[$.startRule]}function d(e,t){return{type:"literal",text:e,ignoreCase:t}}function D(e,t,a){return{type:"class",parts:e,inverted:t,ignoreCase:a}}function Ei(){return{type:"end"}}function Ye(e){var t=ee[e],a;if(t)return t;for(a=e-1;!ee[a];)a--;for(t=ee[a],t={line:t.line,column:t.column};a<e;)f.charCodeAt(a)===10?(t.line++,t.column=1):t.column++,a++;return ee[e]=t,t}function Ze(e,t,a){var i=Ye(e),c=Ye(t),h={source:T,start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:c.line,column:c.column}};return a&&T&&typeof T.offset=="function"&&(h.start=T.offset(h.start),h.end=T.offset(h.end)),h}function m(e){s<R||(s>R&&(R=s,$e=[]),$e.push(e))}function Ii(e,t,a){return new l(l.buildMessage(e,t),e,t,a)}function qe(){var e,t;return e=s,v(),t=I(),t!==r?(v(),e=la(t)):(s=e,e=r),e}function Qe(){var e,t,a,i,c,h,y,w;if(e=s,t=I(),t!==r){for(a=[],i=s,c=v(),h=ce(),h!==r?(y=v(),w=I(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);i!==r;)a.push(i),i=s,c=v(),h=ce(),h!==r?(y=v(),w=I(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);e=ua(t,a)}else s=e,e=r;return e}function I(){var e,t,a,i,c,h,y,w;if(e=s,t=de(),t!==r){for(a=[],i=s,c=v(),h=vr(),h!==r?(y=v(),w=de(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);i!==r;)a.push(i),i=s,c=v(),h=vr(),h!==r?(y=v(),w=de(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);e=fa(t,a)}else s=e,e=r;return e}function de(){var e,t,a,i,c,h,y,w;if(e=s,t=se(),t!==r){for(a=[],i=s,c=v(),h=ue(),h!==r?(y=v(),w=se(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);i!==r;)a.push(i),i=s,c=v(),h=ue(),h!==r?(y=v(),w=se(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);e=oa(t,a)}else s=e,e=r;return e}function se(){var e,t,a,i,c;return e=s,t=Z(),t===r&&(t=s,f.charCodeAt(s)===33?(a=U,s++):(a=r,o===0&&m(Zs)),a!==r?(i=s,o++,f.charCodeAt(s)===61?(c=M,s++):(c=r,o===0&&m(Ve)),o--,c===r?i=void 0:(s=i,i=r),i!==r?(a=[a,i],t=a):(s=t,t=r)):(s=t,t=r)),t!==r?(a=v(),i=se(),i!==r?e=ca(i):(s=e,e=r)):(s=e,e=r),e===r&&(e=Si()),e}function Si(){var e,t,a;return e=s,t=O(),t!==r?(v(),a=Ci(),a===r&&(a=null),e=pa(t,a)):(s=e,e=r),e}function Ci(){var e;return e=Ai(),e===r&&(e=Li(),e===r&&(e=Fi(),e===r&&(e=bi(),e===r&&(e=Pi())))),e}function Ai(){var e,t,a,i,c,h,y;if(e=s,t=[],a=s,i=v(),c=Xe(),c!==r?(h=v(),y=O(),y!==r?(i=[i,c,h,y],a=i):(s=a,a=r)):(s=a,a=r),a!==r)for(;a!==r;)t.push(a),a=s,i=v(),c=Xe(),c!==r?(h=v(),y=O(),y!==r?(i=[i,c,h,y],a=i):(s=a,a=r)):(s=a,a=r);else t=r;return t!==r&&(t=va(t)),e=t,e}function Xe(){var e;return f.substr(s,2)===J?(e=J,s+=2):(e=r,o===0&&m(qs)),e===r&&(f.charCodeAt(s)===62?(e=E,s++):(e=r,o===0&&m(Qs)),e===r&&(f.substr(s,2)===x?(e=x,s+=2):(e=r,o===0&&m(Xs)),e===r&&(f.substr(s,2)===P?(e=P,s+=2):(e=r,o===0&&m(et)),e===r&&(f.charCodeAt(s)===60?(e=G,s++):(e=r,o===0&&m(rt)),e===r&&(f.charCodeAt(s)===61?(e=M,s++):(e=r,o===0&&m(Ve)),e===r&&(f.substr(s,2)===Me?(e=Me,s+=2):(e=r,o===0&&m(st)))))))),e}function bi(){var e,t,a,i;return e=s,t=cr(),t!==r?(v(),a=Z(),a!==r?(v(),i=O(),i!==r?e=ga(t,i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=cr(),t!==r?(v(),a=O(),a!==r?e=ha(t,a):(s=e,e=r)):(s=e,e=r)),e}function Fi(){var e,t,a,i,c,h;return e=s,t=Z(),t!==r?(v(),a=gr(),a!==r?(v(),i=O(),i!==r?(v(),c=ue(),c!==r?(v(),h=O(),h!==r?e=ma(a,i,h):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=gr(),t!==r?(v(),a=O(),a!==r?(v(),i=ue(),i!==r?(v(),c=O(),c!==r?e=$a(t,a,c):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)),e}function er(){var e,t,a,i,c;return e=s,t=s,a=Z(),a!==r?(i=v(),c=pr(),c!==r?(a=[a,i,c],t=a):(s=t,t=r)):(s=t,t=r),t!==r&&(t=da(t)),e=t,e===r&&(e=pr()),e}function ye(){var e,t,a,i,c;return e=s,t=s,a=Z(),a!==r?(i=v(),c=Ee(),c!==r?(a=[a,i,c],t=a):(s=t,t=r)):(s=t,t=r),t!==r&&(t=ya(t)),e=t,e===r&&(e=Ee()),e}function Pi(){var e,t,a,i,c;return e=s,t=er(),t!==r?(v(),a=j(),a!==r?(v(),i=fl(),i!==r?(v(),c=xe(),c!==r?e=wa(t,a,c):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=er(),t!==r?(v(),a=j(),a!==r?e=Na(t,a):(s=e,e=r)):(s=e,e=r)),e}function Li(){var e,t,a,i,c;return e=s,t=ye(),t!==r?(v(),a=A(),a!==r?(v(),i=Qe(),i!==r?(v(),c=b(),c!==r?e=_a(t,i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=ye(),t!==r?(v(),a=A(),a!==r?(v(),i=b(),i!==r?e=Ta(t):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=ye(),t!==r?(v(),a=Te(),a!==r?e=xa(t,a):(s=e,e=r)):(s=e,e=r))),e}function O(){var e,t,a,i,c,h,y,w;if(e=s,t=we(),t!==r){for(a=[],i=s,c=v(),h=rr(),h!==r?(y=v(),w=we(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);i!==r;)a.push(i),i=s,c=v(),h=rr(),h!==r?(y=v(),w=we(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);e=Ea(t,a)}else s=e,e=r;return e}function rr(){var e;return f.charCodeAt(s)===43?(e=ve,s++):(e=r,o===0&&m(he)),e===r&&(f.charCodeAt(s)===45?(e=ge,s++):(e=r,o===0&&m(me)),e===r&&(f.substr(s,2)===De?(e=De,s+=2):(e=r,o===0&&m(tt)))),e}function we(){var e,t,a,i,c,h,y,w;if(e=s,t=Ne(),t!==r){for(a=[],i=s,c=v(),h=sr(),h!==r?(y=v(),w=Ne(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);i!==r;)a.push(i),i=s,c=v(),h=sr(),h!==r?(y=v(),w=Ne(),w!==r?(c=[c,h,y,w],i=c):(s=i,i=r)):(s=i,i=r);e=Ia(t,a)}else s=e,e=r;return e}function sr(){var e;return f.charCodeAt(s)===42?(e=jr,s++):(e=r,o===0&&m(at)),e===r&&(f.charCodeAt(s)===47?(e=Yr,s++):(e=r,o===0&&m(nt))),e}function Ne(){var e,t,a,i;return e=Bi(),e===r&&(e=Oi(),e===r&&(e=Wi(),e===r&&(e=Ji(),e===r&&(e=Vi(),e===r&&(e=Ki(),e===r&&(e=Hi(),e===r&&(e=el(),e===r&&(e=Ri(),e===r&&(e=Te(),e===r&&(e=s,t=A(),t!==r?(v(),a=I(),a!==r?(v(),i=b(),i!==r?e=Sa(a):(s=e,e=r)):(s=e,e=r)):(s=e,e=r))))))))))),e}function Ri(){var e,t;return e=s,t=Mi(),t!==r&&(t=Ca(t)),e=t,e}function Mi(){var e,t;return e=s,t=Di(),t!==r&&(t=Aa(t)),e=t,e}function Di(){var e,t,a,i;if(e=s,t=_e(),t!==r){for(a=[],i=ar();i!==r;)a.push(i),i=ar();e=ba(t,a)}else s=e,e=r;return e}function tr(){var e,t,a,i;if(e=s,t=_e(),t!==r){for(a=[],i=N();i!==r;)a.push(i),i=N();e=Fa(t,a)}else s=e,e=r;return e}function _e(){var e;return Hs.test(f.charAt(s))?(e=f.charAt(s),s++):(e=r,o===0&&m(it)),e}function N(){var e;return ks.test(f.charAt(s))?(e=f.charAt(s),s++):(e=r,o===0&&m(lt)),e}function ar(){var e;return Bs.test(f.charAt(s))?(e=f.charAt(s),s++):(e=r,o===0&&m(ut)),e}function Te(){var e,t,a,i;return e=s,t=s,f.charCodeAt(s)===64?(a=Zr,s++):(a=r,o===0&&m(ft)),a!==r?(i=tr(),i!==r?(a=[a,i],t=a):(s=t,t=r)):(s=t,t=r),t!==r&&(t=Pa(t)),e=t,e}function Oi(){var e,t,a,i,c,h,y;return e=s,t=pl(),t!==r?(v(),a=A(),a!==r?(v(),i=ki(),i!==r?(v(),c=Ie(),c!==r?(v(),h=I(),h!==r?(v(),y=b(),y!==r?e=La(i,h):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e}function Wi(){var e,t,a,i,c,h,y,w,Cr,Se,Ar;return e=s,t=cl(),t!==r?(v(),a=A(),a!==r?(v(),i=I(),i!==r?(v(),c=Ie(),c!==r?(v(),h=I(),h!==r?(v(),y=s,w=ol(),w!==r?(Cr=v(),Se=I(),Se!==r?(Ar=v(),w=[w,Cr,Se,Ar],y=w):(s=y,y=r)):(s=y,y=r),y===r&&(y=null),w=b(),w!==r?e=Ra(i,h,y):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e}function Ki(){var e,t,a,i,c,h,y;return e=s,t=$l(),t!==r?(v(),a=A(),a!==r?(v(),i=I(),i!==r?(v(),c=dl(),c!==r?(v(),h=Ui(),h!==r?(v(),y=b(),y!==r?e=Ma(i,h):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e}function Ui(){var e,t,a,i,c;return e=s,t=yl(),t!==r&&(t=Da()),e=t,e===r&&(e=s,t=wl(),t!==r&&(t=Oa()),e=t,e===r&&(e=s,t=Nl(),t!==r&&(t=Wa()),e=t,e===r&&(e=s,t=_l(),t!==r&&(t=Ka()),e=t,e===r&&(e=s,t=$r(),t!==r&&(t=Ua()),e=t,e===r&&(e=s,t=mr(),t!==r&&(t=Ja()),e=t,e===r&&(e=s,t=Tl(),t!==r?(v(),a=A(),a!==r?(v(),i=V(),i!==r?(v(),c=b(),c!==r?e=Va(i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r))))))),e}function Ji(){var e,t,a,i,c,h,y,w;return e=s,t=hr(),t!==r?(v(),a=A(),a!==r?(v(),i=nr(),i===r&&(i=null),v(),c=I(),c!==r?(v(),h=Ie(),h!==r?(v(),y=I(),y!==r?(v(),w=b(),w!==r?e=Ha(i,c,y):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=hr(),t!==r?(v(),a=A(),a!==r?(v(),i=nr(),i===r&&(i=null),v(),c=I(),c!==r?(v(),h=b(),h!==r?e=ka(i,c):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)),e}function nr(){var e;return e=gl(),e===r&&(e=hl(),e===r&&(e=ml())),e}function Vi(){var e,t,a,i,c,h,y;return e=s,t=vl(),t!==r?(v(),a=A(),a!==r?(v(),i=I(),i!==r?(v(),c=Ee(),c!==r?(v(),h=I(),h!==r?(v(),y=b(),y!==r?e=Ba(i,h):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e}function Hi(){var e,t,a,i,c;return e=s,t=Il(),t!==r?(v(),a=A(),a!==r?(v(),i=Qe(),i===r&&(i=null),v(),c=b(),c!==r?e=za(t,i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e}function ki(){var e;return e=yr(),e===r&&(e=wr(),e===r&&(e=Nr(),e===r&&(e=_r(),e===r&&(e=Tr(),e===r&&(e=H()))))),e}function Bi(){var e;return e=xe(),e===r&&(e=tl(),e===r&&(e=Xi(),e===r&&(e=Qi(),e===r&&(e=qi(),e===r&&(e=zi(),e===r&&(e=Gi())))))),e}function zi(){var e,t,a;return e=s,t=mr(),t!==r?(v(),a=j(),a!==r?e=Ga(a):(s=e,e=r)):(s=e,e=r),e}function Gi(){var e,t,a,i,c;return e=s,t=dr(),t!==r?(v(),f.charCodeAt(s)===45?(a=ge,s++):(a=r,o===0&&m(me)),a===r&&(f.charCodeAt(s)===43?(a=ve,s++):(a=r,o===0&&m(he))),a!==r?(v(),i=j(),i!==r?(v(),c=ir(),c!==r?e=ja(a,i,c):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=dr(),t!==r?(v(),a=j(),a!==r?(v(),i=ir(),i!==r?e=Ya(a,i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)),e}function ir(){var e,t,a,i;return e=s,t=ji(),t!==r?(v(),a=xl(),a!==r?(v(),i=Yi(),i!==r?e=Za(t,i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=Zi()),e}function ji(){var e,t,a,i,c;return e=s,t=Y(),t!==r?(v(),a=A(),a!==r?(v(),i=ae(),i!==r?(v(),c=b(),c!==r?e=qa(t,i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=Y(),t!==r&&(t=Qa(t)),e=t),e}function Yi(){var e,t,a,i,c,h,y;return e=s,t=Y(),t!==r&&(t=Xa(t)),e=t,e===r&&(e=s,t=H(),t!==r?(v(),a=A(),a!==r?(v(),i=ae(),i!==r?(v(),c=ce(),c!==r?(v(),h=te(),h!==r?(v(),y=b(),y!==r?e=en(i,h):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=H(),t!==r?(v(),a=A(),a!==r?(v(),i=ae(),i!==r?(v(),c=b(),c!==r?e=rn(i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=H(),t!==r&&(t=sn()),e=t))),e}function Zi(){var e,t,a,i,c,h,y;return e=s,t=Y(),t!==r?(v(),a=A(),a!==r?(v(),i=te(),i!==r?(v(),c=b(),c!==r?e=tn(t,i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=Y(),t!==r&&(t=an(t)),e=t,e===r&&(e=s,t=H(),t!==r?(v(),a=A(),a!==r?(v(),i=ae(),i!==r?(v(),c=ce(),c!==r?(v(),h=te(),h!==r?(v(),y=b(),y!==r?e=nn(i,h):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=H(),t!==r?(v(),a=A(),a!==r?(v(),i=te(),i!==r?(v(),c=b(),c!==r?e=ln(i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=H(),t!==r&&(t=un()),e=t)))),e}function Y(){var e,t;return e=s,t=Nr(),t!==r&&(t=fn()),e=t,e===r&&(e=s,t=_r(),t!==r&&(t=on()),e=t,e===r&&(e=s,t=Tr(),t!==r&&(t=cn()),e=t,e===r&&(e=s,t=wr(),t!==r&&(t=pn()),e=t,e===r&&(e=s,t=yr(),t!==r&&(t=vn()),e=t)))),e}function te(){var e,t;return e=s,t=V(),t!==r&&(t=gn(t)),e=t,e}function ae(){var e,t;return e=s,t=V(),t!==r&&(t=hn(t)),e=t,e}function qi(){var e,t,a;return e=s,t=$r(),t!==r?(v(),a=j(),a!==r?e=mn(a):(s=e,e=r)):(s=e,e=r),e}function Qi(){var e,t;return e=s,t=il(),t!==r&&(t=$n()),e=t,e}function Xi(){var e,t;return e=s,t=ll(),t!==r&&(t=dn()),e=t,e===r&&(e=s,t=ul(),t!==r&&(t=yn()),e=t),e}function j(){var e;return e=xe(),e===r&&(e=Te()),e}function xe(){var e,t,a,i,c;if(e=s,f.charCodeAt(s)===39?(t=Oe,s++):(t=r,o===0&&m(He)),t===r&&(f.substr(s,2)===We?(t=We,s+=2):(t=r,o===0&&m(ot))),t!==r){for(a=[],i=s,f.substr(s,2)===X?(c=X,s+=2):(c=r,o===0&&m(ke)),c!==r&&(c=je()),i=c,i===r&&(Ue.test(f.charAt(s))?(i=f.charAt(s),s++):(i=r,o===0&&m(Be)));i!==r;)a.push(i),i=s,f.substr(s,2)===X?(c=X,s+=2):(c=r,o===0&&m(ke)),c!==r&&(c=je()),i=c,i===r&&(Ue.test(f.charAt(s))?(i=f.charAt(s),s++):(i=r,o===0&&m(Be)));f.charCodeAt(s)===39?(i=Oe,s++):(i=r,o===0&&m(He)),i!==r?e=wn(a):(s=e,e=r)}else s=e,e=r;return e}function el(){var e;return e=rl(),e===r&&(e=sl()),e}function rl(){var e,t,a,i,c,h,y;if(e=s,t=fe(),t!==r)if(v(),a=I(),a!==r){for(v(),i=[],c=ie();c!==r;)i.push(c),c=ie();c=v(),h=oe(),h!==r?e=Nn(a,i):(s=e,e=r)}else s=e,e=r;else s=e,e=r;if(e===r)if(e=s,t=fe(),t!==r)if(v(),a=I(),a!==r){for(v(),i=[],c=ie();c!==r;)i.push(c),c=ie();c=v(),h=lr(),h!==r?(v(),y=oe(),y!==r?e=_n(a,i,h):(s=e,e=r)):(s=e,e=r)}else s=e,e=r;else s=e,e=r;return e}function sl(){var e,t,a,i,c,h;if(e=s,t=fe(),t!==r){for(v(),a=[],i=ne();i!==r;)a.push(i),i=ne();i=v(),c=oe(),c!==r?e=Tn(a):(s=e,e=r)}else s=e,e=r;if(e===r)if(e=s,t=fe(),t!==r){for(v(),a=[],i=ne();i!==r;)a.push(i),i=ne();i=v(),c=lr(),c!==r?(v(),h=oe(),h!==r?e=xn(a,c):(s=e,e=r)):(s=e,e=r)}else s=e,e=r;return e}function ne(){var e,t,a,i,c;return e=s,t=xr(),t!==r?(v(),a=I(),a!==r?(v(),i=Er(),i!==r?(v(),c=I(),c!==r?e=En(a,c):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e}function ie(){var e,t,a,i,c;return e=s,t=xr(),t!==r?(v(),a=I(),a!==r?(v(),i=Er(),i!==r?(v(),c=I(),c!==r?e=In(a,c):(s=e,e=r)):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e}function lr(){var e,t,a;return e=s,t=El(),t!==r?(v(),a=I(),a!==r?e=Sn(a):(s=e,e=r)):(s=e,e=r),e}function tl(){var e,t,a,i;return e=s,t=al(),t!==r?(a=s,o++,i=_e(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Cn(t):(s=e,e=r)):(s=e,e=r),e}function al(){var e,t,a,i;return e=s,t=le(),t!==r?(a=ur(),a!==r?(i=fr(),i!==r?e=An(t,a,i):(s=e,e=r)):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=le(),t!==r?(a=ur(),a!==r?e=bn(t,a):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=le(),t!==r?(a=fr(),a!==r?e=Fn(t,a):(s=e,e=r)):(s=e,e=r),e===r&&(e=s,t=le(),t!==r&&(t=Pn(t)),e=t))),e}function le(){var e,t,a;return e=V(),e===r&&(e=s,f.charCodeAt(s)===45?(t=ge,s++):(t=r,o===0&&m(me)),t===r&&(f.charCodeAt(s)===43?(t=ve,s++):(t=r,o===0&&m(he))),t!==r?(a=V(),a!==r?e=Ln(t,a):(s=e,e=r)):(s=e,e=r)),e}function ur(){var e,t,a;return e=s,f.charCodeAt(s)===46?(t=qr,s++):(t=r,o===0&&m(ct)),t!==r?(a=V(),a===r&&(a=null),e=Rn(a)):(s=e,e=r),e}function fr(){var e,t,a;return e=s,t=nl(),t!==r?(a=V(),a!==r?e=Mn(t,a):(s=e,e=r)):(s=e,e=r),e}function V(){var e,t,a;if(e=s,t=[],a=or(),a!==r)for(;a!==r;)t.push(a),a=or();else t=r;return t!==r&&(t=Dn(t)),e=t,e}function or(){var e;return zs.test(f.charAt(s))?(e=f.charAt(s),s++):(e=r,o===0&&m(pt)),e}function nl(){var e,t,a;return e=s,Gs.test(f.charAt(s))?(t=f.charAt(s),s++):(t=r,o===0&&m(vt)),t!==r?(js.test(f.charAt(s))?(a=f.charAt(s),s++):(a=r,o===0&&m(gt)),a===r&&(a=null),e=On(t,a)):(s=e,e=r),e}function il(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===Qr?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(ht)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?(t=[t,a],e=t):(s=e,e=r)):(s=e,e=r),e}function ll(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===Xr?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(mt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?(t=[t,a],e=t):(s=e,e=r)):(s=e,e=r),e}function ul(){var e,t,a,i;return e=s,f.substr(s,5).toLowerCase()===es?(t=f.substr(s,5),s+=5):(t=r,o===0&&m($t)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?(t=[t,a],e=t):(s=e,e=r)):(s=e,e=r),e}function Ee(){var e,t,a,i;return e=s,f.substr(s,2).toLowerCase()===rs?(t=f.substr(s,2),s+=2):(t=r,o===0&&m(dt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Wn():(s=e,e=r)):(s=e,e=r),e}function cr(){var e,t,a,i;return e=s,f.substr(s,2).toLowerCase()===ss?(t=f.substr(s,2),s+=2):(t=r,o===0&&m(yt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Kn():(s=e,e=r)):(s=e,e=r),e}function pr(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===ts?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(wt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Un():(s=e,e=r)):(s=e,e=r),e}function fl(){var e,t,a,i;return e=s,f.substr(s,6).toLowerCase()===as?(t=f.substr(s,6),s+=6):(t=r,o===0&&m(Nt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Jn():(s=e,e=r)):(s=e,e=r),e}function Z(){var e,t,a,i;return e=s,f.substr(s,3).toLowerCase()===ns?(t=f.substr(s,3),s+=3):(t=r,o===0&&m(_t)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Vn():(s=e,e=r)):(s=e,e=r),e}function ue(){var e,t,a,i;return e=s,f.substr(s,3).toLowerCase()===is?(t=f.substr(s,3),s+=3):(t=r,o===0&&m(Tt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Hn():(s=e,e=r)):(s=e,e=r),e}function vr(){var e,t,a,i;return e=s,f.substr(s,2).toLowerCase()===ls?(t=f.substr(s,2),s+=2):(t=r,o===0&&m(xt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=kn():(s=e,e=r)):(s=e,e=r),e}function gr(){var e,t,a,i;return e=s,f.substr(s,7).toLowerCase()===us?(t=f.substr(s,7),s+=7):(t=r,o===0&&m(Et)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Bn():(s=e,e=r)):(s=e,e=r),e}function Ie(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===fs?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(It)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=zn():(s=e,e=r)):(s=e,e=r),e}function ol(){var e,t,a,i;return e=s,f.substr(s,3).toLowerCase()===os?(t=f.substr(s,3),s+=3):(t=r,o===0&&m(St)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Gn():(s=e,e=r)):(s=e,e=r),e}function cl(){var e,t,a,i;return e=s,f.substr(s,9).toLowerCase()===cs?(t=f.substr(s,9),s+=9):(t=r,o===0&&m(Ct)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=jn():(s=e,e=r)):(s=e,e=r),e}function pl(){var e,t,a,i;return e=s,f.substr(s,7).toLowerCase()===ps?(t=f.substr(s,7),s+=7):(t=r,o===0&&m(At)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Yn():(s=e,e=r)):(s=e,e=r),e}function hr(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===vs?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(bt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Zn():(s=e,e=r)):(s=e,e=r),e}function vl(){var e,t,a,i;return e=s,f.substr(s,8).toLowerCase()===gs?(t=f.substr(s,8),s+=8):(t=r,o===0&&m(Ft)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=qn():(s=e,e=r)):(s=e,e=r),e}function mr(){var e,t,a,i;return e=s,f.substr(s,9).toLowerCase()===hs?(t=f.substr(s,9),s+=9):(t=r,o===0&&m(Pt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Qn():(s=e,e=r)):(s=e,e=r),e}function $r(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===ms?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(Lt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Xn():(s=e,e=r)):(s=e,e=r),e}function gl(){var e,t,a,i;return e=s,f.substr(s,7).toLowerCase()===$s?(t=f.substr(s,7),s+=7):(t=r,o===0&&m(Rt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=ei():(s=e,e=r)):(s=e,e=r),e}function hl(){var e,t,a,i;return e=s,f.substr(s,8).toLowerCase()===ds?(t=f.substr(s,8),s+=8):(t=r,o===0&&m(Mt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=ri():(s=e,e=r)):(s=e,e=r),e}function ml(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===ys?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(Dt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=si():(s=e,e=r)):(s=e,e=r),e}function $l(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===ws?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(Ot)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=ti():(s=e,e=r)):(s=e,e=r),e}function dl(){var e,t,a,i;return e=s,f.substr(s,2).toLowerCase()===Ns?(t=f.substr(s,2),s+=2):(t=r,o===0&&m(Wt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=ai():(s=e,e=r)):(s=e,e=r),e}function yl(){var e,t,a,i;return e=s,f.substr(s,7).toLowerCase()===_s?(t=f.substr(s,7),s+=7):(t=r,o===0&&m(Kt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=ni():(s=e,e=r)):(s=e,e=r),e}function wl(){var e,t,a,i;return e=s,f.substr(s,8).toLowerCase()===Ts?(t=f.substr(s,8),s+=8):(t=r,o===0&&m(Ut)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=ii():(s=e,e=r)):(s=e,e=r),e}function Nl(){var e,t,a,i;return e=s,f.substr(s,5).toLowerCase()===xs?(t=f.substr(s,5),s+=5):(t=r,o===0&&m(Jt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=li():(s=e,e=r)):(s=e,e=r),e}function _l(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===Es?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(Vt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=ui():(s=e,e=r)):(s=e,e=r),e}function Tl(){var e,t,a,i;return e=s,f.substr(s,7).toLowerCase()===Is?(t=f.substr(s,7),s+=7):(t=r,o===0&&m(Ht)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=fi():(s=e,e=r)):(s=e,e=r),e}function xl(){var e,t,a,i;return e=s,f.substr(s,2).toLowerCase()===Ss?(t=f.substr(s,2),s+=2):(t=r,o===0&&m(kt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=oi():(s=e,e=r)):(s=e,e=r),e}function dr(){var e,t,a,i;return e=s,f.substr(s,8).toLowerCase()===Cs?(t=f.substr(s,8),s+=8):(t=r,o===0&&m(Bt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=ci():(s=e,e=r)):(s=e,e=r),e}function yr(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===As?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(zt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=pi():(s=e,e=r)):(s=e,e=r),e}function wr(){var e,t,a,i;return e=s,f.substr(s,5).toLowerCase()===bs?(t=f.substr(s,5),s+=5):(t=r,o===0&&m(Gt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=vi():(s=e,e=r)):(s=e,e=r),e}function Nr(){var e,t,a,i;return e=s,f.substr(s,3).toLowerCase()===Fs?(t=f.substr(s,3),s+=3):(t=r,o===0&&m(jt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=gi():(s=e,e=r)):(s=e,e=r),e}function _r(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===Ps?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(Yt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=hi():(s=e,e=r)):(s=e,e=r),e}function Tr(){var e,t,a,i;return e=s,f.substr(s,6).toLowerCase()===Ls?(t=f.substr(s,6),s+=6):(t=r,o===0&&m(Zt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=mi():(s=e,e=r)):(s=e,e=r),e}function H(){var e,t,a,i;return e=s,f.substr(s,6).toLowerCase()===Rs?(t=f.substr(s,6),s+=6):(t=r,o===0&&m(qt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=$i():(s=e,e=r)):(s=e,e=r),e}function fe(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===Ms?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(Qt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=di():(s=e,e=r)):(s=e,e=r),e}function oe(){var e,t,a,i;return e=s,f.substr(s,3).toLowerCase()===Ds?(t=f.substr(s,3),s+=3):(t=r,o===0&&m(Xt)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=yi():(s=e,e=r)):(s=e,e=r),e}function xr(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===Os?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(ea)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=wi():(s=e,e=r)):(s=e,e=r),e}function Er(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===Ws?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(ra)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=Ni():(s=e,e=r)):(s=e,e=r),e}function El(){var e,t,a,i;return e=s,f.substr(s,4).toLowerCase()===Ks?(t=f.substr(s,4),s+=4):(t=r,o===0&&m(sa)),t!==r?(a=s,o++,i=N(),o--,i===r?a=void 0:(s=a,a=r),a!==r?e=_i():(s=e,e=r)):(s=e,e=r),e}function ce(){var e;return f.charCodeAt(s)===44?(e=Us,s++):(e=r,o===0&&m(ta)),e}function A(){var e;return f.charCodeAt(s)===40?(e=Js,s++):(e=r,o===0&&m(aa)),e}function b(){var e;return f.charCodeAt(s)===41?(e=Vs,s++):(e=r,o===0&&m(na)),e}function v(){var e,t;for(e=[],t=Ir();t!==r;)e.push(t),t=Ir();return e}function Ir(){var e;return Ys.test(f.charAt(s))?(e=f.charAt(s),s++):(e=r,o===0&&m(ia)),e}function Il(){var e,t,a,i;if(e=s,t=tr(),t!==r&&(t=Ti(t)),e=t,e===r)if(e=s,f.charCodeAt(s)===96?(t=Ke,s++):(t=r,o===0&&m(ze)),t!==r){if(a=[],Je.test(f.charAt(s))?(i=f.charAt(s),s++):(i=r,o===0&&m(Ge)),i!==r)for(;i!==r;)a.push(i),Je.test(f.charAt(s))?(i=f.charAt(s),s++):(i=r,o===0&&m(Ge));else a=r;a!==r?(f.charCodeAt(s)===96?(i=Ke,s++):(i=r,o===0&&m(ze)),i!==r?e=xi(a):(s=e,e=r)):(s=e,e=r)}else s=e,e=r;return e}function Sl(e,t){return{type:"unary-expression",operator:e,expr:t}}function Sr(e,t,a,i){var c={type:"binary-expression",operator:e,left:t,right:a};return i!==void 0&&(c.escape=i),c}function Cl(e,t){for(var a=[e],i=0;i<t.length;i++)a.push(t[i][3]);return a}function Al(e,t,a){var i=Cl(e,t);return i}function q(e,t){for(var a=e,i=0;i<t.length;i++)a=Sr(t[i][1],a,t[i][3]);return a}if(re=F(),re!==r&&s===f.length)return re;throw re!==r&&s<f.length&&m(Ei()),Ii($e,R<f.length?f.charAt(R):null,R<f.length?Ze(R,R+1):Ze(R,R))}return{SyntaxError:l,parse:g}})})(Jl);class Vl{static parse(n){return Ce.parse(n)}}const Jr=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,Hl=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,kl=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,Bl=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,zl=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,Gl=new Set(["current_timestamp","current_date","current_time"]);function k(u,n){return u=u+"",u.length>=n?u:new Array(n-u.length+1).join("0")+u}function Q(u,n,l="0",p="0",g="0",f="0",$="",r="0",T="0"){if($==="+"||$==="-"){const _=`${k(parseInt(u,10),4)}-${k(parseInt(n,10),2)}-${k(parseInt(l,10),2)}`;let F="";parseFloat(f)<10&&(F="0");const U=`${k(parseInt(p,10),2)}:${k(parseInt(g,10),2)}:${F+parseFloat(f).toString()}`,M=`${$}${k(parseInt(r,10),2)}:${k(parseInt(T,10),2)}`;return new Date(_+"T"+U+M)}return new Date(parseInt(u,10),parseInt(n,10)-1,parseInt(l,10),parseInt(p,10),parseInt(g,10),parseFloat(f))}class jl{static makeBool(n){return Vr(n)}static featureValue(n,l,p,g){return Gr(n,l,p,g)}static equalsNull(n){return n===null}static applyLike(n,l,p){return Pe(n,l,p)}static ensureArray(n){return be(n)}static applyIn(n,l){return Fe(n,l)}static currentDate(){const n=new Date;return n.setHours(0,0,0,0),n}static makeSqlInterval(n,l,p){return S.createFromValueAndQualifer(n,l,p)}static convertInterval(n){return n instanceof S?n.valueInMilliseconds():n}static currentTimestamp(){return new Date}static compare(n,l,p){return Br(n,l,p)}static calculate(n,l,p){return zr(n,l,p)}static makeComparable(n){return K(n)}static evaluateFunction(n,l){return Le(n,l)}static lookup(n,l){const p=l[n];return p===void 0?null:p}static between(n,l){return n==null||l[0]==null||l[1]==null?null:n>=l[0]&&n<=l[1]}static notbetween(n,l){return n==null||l[0]==null||l[1]==null?null:n<l[0]||n>l[1]}static ternaryNot(n){return pe(n)}static ternaryAnd(n,l){return Hr(n,l)}static ternaryOr(n,l){return kr(n,l)}}class Re{constructor(n,l){this.fieldsIndex=l,this._datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=Vl.parse(n);const{isStandardized:p,isAggregate:g,referencedFieldNames:f}=this._extractExpressionInfo(l);this._referencedFieldNames=f,this.isStandardized=p,this.isAggregate=g}static create(n,l){return new Re(n,l)}get fieldNames(){return this._referencedFieldNames}testSet(n,l=B){const p={};for(const g of this.fieldNames)p[g]=n.map(f=>l.getAttribute(f,g));return!!this._evaluateNode(this.parseTree,{attributes:p},B)}calculateValue(n,l=B){const p=this._evaluateNode(this.parseTree,n,l);return p instanceof S?p.valueInMilliseconds()/(1e3*60*60*24):p}calculateValueCompiled(n,l=B){return this.parseTree._compiledVersion!=null?this.parseTree._compiledVersion(n,this.parameters,l,this._datefields):br("esri-csp-restrictions")?this.calculateValue(n,l):(this._compileMe(),this.parseTree._compiledVersion(n,this.parameters,l,this._datefields))}testFeature(n,l=B){return!!this._evaluateNode(this.parseTree,n,l)}testFeatureCompiled(n,l=B){return this.parseTree._compiledVersion!=null?!!this.parseTree._compiledVersion(n,this.parameters,l,this._datefields):br("esri-csp-restrictions")?this.testFeature(n,l):(this._compileMe(),!!this.parseTree._compiledVersion(n,this.parameters,l,this._datefields))}get hasDateFunctions(){return this._hasDateFunctions!=null?this._hasDateFunctions:(this._hasDateFunctions=!1,this._visitAll(this.parseTree,n=>{n.type==="current-time"?this._hasDateFunctions=!0:n.type==="function"&&(this._hasDateFunctions=this._hasDateFunctions||Gl.has(n.name.toLowerCase()))}),this._hasDateFunctions)}getFunctions(){const n=new Set;return this._visitAll(this.parseTree,l=>{l.type==="function"&&n.add(l.name.toLowerCase())}),Array.from(n)}getExpressions(){const n=new Map;return this._visitAll(this.parseTree,l=>{if(l.type==="function"){const p=l.name.toLowerCase(),g=l.args.value[0];if(g.type==="column-reference"){const f=g.column,$=`${p}-${f}`;n.has($)||n.set($,{aggregateType:p,field:f})}}}),[...n.values()]}getVariables(){const n=new Set;return this._visitAll(this.parseTree,l=>{l.type==="parameter"&&n.add(l.value.toLowerCase())}),Array.from(n)}_compileMe(){const n="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",n).bind(jl)}_extractExpressionInfo(n){const l=[],p=new Set;let g=!0,f=!0;return this._visitAll(this.parseTree,$=>{switch($.type){case"column-reference":{const r=n==null?void 0:n.get($.column);let T,_;r?T=_=r.name??"":(_=$.column,T=_.toLowerCase()),r&&r.name&&(r.type==="date"||r.type==="esriFieldTypeDate")&&(this._datefields[r.name]=1),p.has(T)||(p.add(T),l.push(_)),$.column=_;break}case"function":{const{name:r,args:T}=$,_=T.value.length;g&&(g=Wl(r,_)),f&&(f=Rl(r,_));break}}}),{referencedFieldNames:Array.from(l),isStandardized:g,isAggregate:f}}_visitAll(n,l){if(n!=null)switch(l(n),n.type){case"when-clause":this._visitAll(n.operand,l),this._visitAll(n.value,l);break;case"case-expression":for(const p of n.clauses)this._visitAll(p,l);n.format==="simple"&&this._visitAll(n.operand,l),n.else!==null&&this._visitAll(n.else,l);break;case"expression-list":for(const p of n.value)this._visitAll(p,l);break;case"unary-expression":this._visitAll(n.expr,l);break;case"binary-expression":this._visitAll(n.left,l),this._visitAll(n.right,l);break;case"function":this._visitAll(n.args,l);break}}evaluateNodeToJavaScript(n){switch(n.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(n.value)+", "+JSON.stringify(n.qualifier)+","+JSON.stringify(n.op)+")";case"case-expression":{let l="";if(n.format==="simple"){const p="this.makeComparable("+this.evaluateNodeToJavaScript(n.operand)+")";l="( ";for(let g=0;g<n.clauses.length;g++)l+=" ("+p+" === this.makeComparable("+this.evaluateNodeToJavaScript(n.clauses[g].operand)+")) ? ("+this.evaluateNodeToJavaScript(n.clauses[g].value)+") : ";n.else!==null?l+=this.evaluateNodeToJavaScript(n.else):l+="null",l+=" )"}else{l="( ";for(let p=0;p<n.clauses.length;p++)l+=" this.makeBool("+this.evaluateNodeToJavaScript(n.clauses[p].operand)+")===true ? ("+this.evaluateNodeToJavaScript(n.clauses[p].value)+") : ";n.else!==null?l+=this.evaluateNodeToJavaScript(n.else):l+="null",l+=" )"}return l}case"parameter":return"this.lookup("+JSON.stringify(n.value.toLowerCase())+",lookups)";case"expression-list":{let l="[";for(const p of n.value)l!=="["&&(l+=","),l+=this.evaluateNodeToJavaScript(p);return l+="]",l}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(n.expr)+")";case"binary-expression":switch(n.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(n.left)+","+this.evaluateNodeToJavaScript(n.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(n.left)+","+this.evaluateNodeToJavaScript(n.right)+" )";case"IS":if(n.right.type!=="null")throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(n.left)+")";case"ISNOT":if(n.right.type!=="null")throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(n.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(n.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(n.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(n.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(n.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(n.left)+","+this.evaluateNodeToJavaScript(n.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(n.left)+","+this.evaluateNodeToJavaScript(n.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(n.left)+","+this.evaluateNodeToJavaScript(n.right)+","+JSON.stringify(n.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(n.left)+","+this.evaluateNodeToJavaScript(n.right)+","+JSON.stringify(n.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(n.operator)+","+this.evaluateNodeToJavaScript(n.left)+","+this.evaluateNodeToJavaScript(n.right)+")";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(n.operator)+","+this.evaluateNodeToJavaScript(n.left)+","+this.evaluateNodeToJavaScript(n.right)+")"}throw new Error("Not Supported Operator "+n.operator);case"null":case"boolean":case"string":case"number":return JSON.stringify(n.value);case"date":return"(new Date("+Rr(n.value).getTime().toString()+"))";case"timestamp":return"(new Date("+Ae(n.value).getTime().toString()+"))";case"current-time":return n.mode==="date"?"this.currentDate()":"this.currentTimestamp()";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(n.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(n.name)+","+this.evaluateNodeToJavaScript(n.args)+")"}throw new Error("Unsupported sql syntax "+n.type)}_evaluateNode(n,l,p){switch(n.type){case"interval":{const g=this._evaluateNode(n.value,l,p);return S.createFromValueAndQualifer(g,n.qualifier,n.op)}case"case-expression":if(n.format==="simple"){const g=K(this._evaluateNode(n.operand,l,p));for(let f=0;f<n.clauses.length;f++)if(g===K(this._evaluateNode(n.clauses[f].operand,l,p)))return this._evaluateNode(n.clauses[f].value,l,p);if(n.else!==null)return this._evaluateNode(n.else,l,p)}else{for(let g=0;g<n.clauses.length;g++)if(Vr(this._evaluateNode(n.clauses[g].operand,l,p)))return this._evaluateNode(n.clauses[g].value,l,p);if(n.else!==null)return this._evaluateNode(n.else,l,p)}return null;case"parameter":return this.parameters[n.value.toLowerCase()];case"expression-list":{const g=[];for(const f of n.value)g.push(this._evaluateNode(f,l,p));return g}case"unary-expression":return pe(this._evaluateNode(n.expr,l,p));case"binary-expression":switch(n.operator){case"AND":return Hr(this._evaluateNode(n.left,l,p),this._evaluateNode(n.right,l,p));case"OR":return kr(this._evaluateNode(n.left,l,p),this._evaluateNode(n.right,l,p));case"IS":if(n.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(n.left,l,p)===null;case"ISNOT":if(n.right.type!=="null")throw new Error("Unsupported RHS for IS");return this._evaluateNode(n.left,l,p)!==null;case"IN":{const g=be(this._evaluateNode(n.right,l,p));return Fe(this._evaluateNode(n.left,l,p),g)}case"NOT IN":{const g=be(this._evaluateNode(n.right,l,p));return pe(Fe(this._evaluateNode(n.left,l,p),g))}case"BETWEEN":{const g=this._evaluateNode(n.left,l,p),f=this._evaluateNode(n.right,l,p);return g==null||f[0]==null||f[1]==null?null:g>=K(f[0])&&g<=K(f[1])}case"NOTBETWEEN":{const g=this._evaluateNode(n.left,l,p),f=this._evaluateNode(n.right,l,p);return g==null||f[0]==null||f[1]==null?null:g<K(f[0])||g>K(f[1])}case"LIKE":return Pe(this._evaluateNode(n.left,l,p),this._evaluateNode(n.right,l,p),n.escape);case"NOT LIKE":return pe(Pe(this._evaluateNode(n.left,l,p),this._evaluateNode(n.right,l,p),n.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return Br(n.operator,this._evaluateNode(n.left,l,p),this._evaluateNode(n.right,l,p));case"-":case"+":case"*":case"/":case"||":return zr(n.operator,this._evaluateNode(n.left,l,p),this._evaluateNode(n.right,l,p))}case"null":case"boolean":case"string":case"number":return n.value;case"date":return Rr(n.value);case"timestamp":return Ae(n.value);case"current-time":{const g=new Date;return n.mode==="date"&&g.setHours(0,0,0,0),g}case"column-reference":return Gr(l,n.column,this._datefields,p);case"data-type":return n.value;case"function":{const g=this._evaluateNode(n.args,l,p);return this.isAggregate?Ll(n.name,g):Le(n.name,g)}}throw new Error("Unsupported sql syntax "+n.type)}}function Ae(u){let n=Hl.exec(u);if(n!==null){const[,l,p,g,f,$,r]=n;return Q(l,p,g,f,$,r)}if(n=kl.exec(u),n!==null){const[,l,p,g,f,$,r,T,_,F]=n;return Q(l,p,g,f,$,r,T,_,F)}if(n=Bl.exec(u),n!==null){const[,l,p,g,f,$,r,T,_]=n;return Q(l,p,g,f,$,"0",r,T,_)}if(n=zl.exec(u),n!==null){const[,l,p,g,f,$]=n;return Q(l,p,g,f,$)}if(n=Jr.exec(u),n!==null){const[,l,p,g]=n;return Q(l,p,g)}throw new Error("SQL Invalid Timestamp")}function Rr(u){const n=Jr.exec(u);if(n===null)try{return Ae(u)}catch{throw new Error("SQL Invalid Date")}const[,l,p,g]=n;return new Date(parseInt(l,10),parseInt(p,10)-1,parseInt(g,10))}function Vr(u){return u===!0}function be(u){return Array.isArray(u)?u:[u]}function pe(u){return u!==null?u!==!0:null}function Hr(u,n){return u!=null&&n!=null?u===!0&&n===!0:u===!1||n===!1?!1:null}function kr(u,n){return u!=null&&n!=null?u===!0||n===!0:u===!0||n===!0?!0:null}function Fe(u,n){if(u==null)return null;let l=!1;for(const p of n)if(p==null)l=null;else if(u===p){l=!0;break}return l}const Mr="-[]/{}()*+?.\\^$|";var z;(function(u){u[u.Normal=0]="Normal",u[u.Escaped=1]="Escaped"})(z||(z={}));function Yl(u,n){const l=n;let p="",g=z.Normal;for(let f=0;f<u.length;f++){const $=u.charAt(f);switch(g){case z.Normal:$===l?g=z.Escaped:Mr.includes($)?p+="\\"+$:$==="%"?p+=".*":$==="_"?p+=".":p+=$;break;case z.Escaped:Mr.includes($)?p+="\\"+$:p+=$,g=z.Normal;break}}return new RegExp("^"+p+"$","m")}function Pe(u,n,l){return u==null?null:Yl(n,l).test(u)}function K(u){return u instanceof Date?u.valueOf():u}function Br(u,n,l){if(n==null||l==null)return null;const p=K(n),g=K(l);switch(u){case"<>":return p!==g;case"=":return p===g;case">":return p>g;case"<":return p<g;case">=":return p>=g;case"<=":return p<=g}}function zr(u,n,l){if(u==="||")return Le("concat",[n,l]);if(n instanceof S)if(l instanceof Date)switch(u){case"+":return new Date(n.valueInMilliseconds()+l.getTime());case"-":return n.valueInMilliseconds()-l.getTime();case"*":return n.valueInMilliseconds()*l.getTime();case"/":return n.valueInMilliseconds()/l.getTime()}else if(l instanceof S)switch(u){case"+":return S.createFromMilliseconds(n.valueInMilliseconds()+l.valueInMilliseconds());case"-":return S.createFromMilliseconds(n.valueInMilliseconds()-l.valueInMilliseconds());case"*":return n.valueInMilliseconds()*l.valueInMilliseconds();case"/":return n.valueInMilliseconds()/l.valueInMilliseconds()}else n=n.valueInMilliseconds();else if(l instanceof S)if(n instanceof Date)switch(u){case"+":return new Date(l.valueInMilliseconds()+n.getTime());case"-":return new Date(n.getTime()-l.valueInMilliseconds());case"*":return n.getTime()*l.valueInMilliseconds();case"/":return n.getTime()/l.valueInMilliseconds()}else l=l.valueInMilliseconds();else if(n instanceof Date&&typeof l=="number")switch(l=l*24*60*60*1e3,n=n.getTime(),u){case"+":return new Date(n+l);case"-":return new Date(n-l);case"*":return new Date(n*l);case"/":return new Date(n/l)}else if(l instanceof Date&&typeof n=="number")switch(n=n*24*60*60*1e3,l=l.getTime(),u){case"+":return new Date(n+l);case"-":return new Date(n-l);case"*":return new Date(n*l);case"/":return new Date(n/l)}switch(u){case"+":return n+l;case"-":return n-l;case"*":return n*l;case"/":return n/l}}function Zl(u){return u&&typeof u.attributes=="object"}function Gr(u,n,l,p){const g=p.getAttribute(u,n);return g!=null&&l[n]===1?new Date(g):g}const B={getAttribute(u,n){return(Zl(u)?u.attributes:u)[n]}},eu=Object.freeze(Object.defineProperty({__proto__:null,WhereClause:Re,defaultAttributeAdapter:B},Symbol.toStringTag,{value:"Module"}));export{Kr as F,W as S,Re as W,L as a,C as b,eu as c};
