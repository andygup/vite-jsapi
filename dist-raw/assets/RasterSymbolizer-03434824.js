import{E as ye,dw as sr,bU as ar,_ as lr,ak as cr,X as Ye,ae as M,af as O,ai as Ue,bD as Oe,bF as ur,bG as fr,K as dr,cE as re,bf as Ot,bt as hr,cG as Nt,ax as wt,L as Tt}from"./index-0cbe37a0.js";import{n as dt,P as se,o as Se,p as pr,e as St,q as et,r as mr,t as At,u as Ge}from"./dataUtils-14b76ae0.js";import{c as Ke,b as It,t as kt,a as gr}from"./colorUtils-6f72410e.js";var Ae={},xr={get exports(){return Ae},set exports(t){Ae=t}};(function(t){(function(e){{var r=e();r!==void 0&&(t.exports=r)}})(function(){var e=function(){function o(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return o.prototype={ensureBuffer:function(a){var u=this.buffer,i=u?u.byteLength:0;if(a<i)return u;for(var n=512;n<a;)n<<=1;for(var l=new Uint8Array(n),c=0;c<i;++c)l[c]=u[c];return this.buffer=l},getByte:function(){for(var a=this.pos;this.bufferLength<=a;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(a){var u=this.pos;if(a){this.ensureBuffer(u+a);for(var i=u+a;!this.eof&&this.bufferLength<i;)this.readBlock();var n=this.bufferLength;i>n&&(i=n)}else{for(;!this.eof;)this.readBlock();var i=this.bufferLength}return this.pos=i,this.buffer.subarray(u,i)},lookChar:function(){for(var a=this.pos;this.bufferLength<=a;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var a=this.pos;this.bufferLength<=a;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(a,u,i){for(var n=a+u;this.bufferLength<=n&&!this.eof;)this.readBlock();return new Stream(this.buffer,a,u,i)},skip:function(a){a||(a=1),this.pos+=a},reset:function(){this.pos=0}},o}(),r=function(){if(!self||!self.Uint32Array)return null;var o=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),a=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),u=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],i=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function n(c){throw new Error(c)}function l(c){var h=0,f=c[h++],d=c[h++];(f==-1||d==-1)&&n("Invalid header in flate stream"),(f&15)!=8&&n("Unknown compression method in flate stream"),((f<<8)+d)%31!=0&&n("Bad FCHECK in flate stream"),d&32&&n("FDICT bit set in flate stream"),this.bytes=c,this.bytesPos=h,this.codeSize=0,this.codeBuf=0,e.call(this)}return l.prototype=Object.create(e.prototype),l.prototype.getBits=function(c){for(var h=this.codeSize,f=this.codeBuf,d=this.bytes,p=this.bytesPos,m;h<c;)typeof(m=d[p++])>"u"&&n("Bad encoding in flate stream"),f|=m<<h,h+=8;return m=f&(1<<c)-1,this.codeBuf=f>>c,this.codeSize=h-=c,this.bytesPos=p,m},l.prototype.getCode=function(c){for(var h=c[0],f=c[1],d=this.codeSize,p=this.codeBuf,m=this.bytes,b=this.bytesPos;d<f;){var y;typeof(y=m[b++])>"u"&&n("Bad encoding in flate stream"),p|=y<<d,d+=8}var g=h[p&(1<<f)-1],C=g>>16,T=g&65535;return(d==0||d<C||C==0)&&n("Bad encoding in flate stream"),this.codeBuf=p>>C,this.codeSize=d-C,this.bytesPos=b,T},l.prototype.generateHuffmanTable=function(c){for(var h=c.length,f=0,d=0;d<h;++d)c[d]>f&&(f=c[d]);for(var p=1<<f,m=new Uint32Array(p),b=1,y=0,g=2;b<=f;++b,y<<=1,g<<=1)for(var C=0;C<h;++C)if(c[C]==b){for(var T=0,x=y,d=0;d<b;++d)T=T<<1|x&1,x>>=1;for(var d=T;d<p;d+=g)m[d]=b<<16|C;++y}return[m,f]},l.prototype.readBlock=function(){function c(Y,q,U,B,z){for(var fe=Y.getBits(U)+B;fe-- >0;)q[I++]=z}var h=this.getBits(3);if(h&1&&(this.eof=!0),h>>=1,h==0){var f=this.bytes,d=this.bytesPos,p;typeof(p=f[d++])>"u"&&n("Bad block header in flate stream");var m=p;typeof(p=f[d++])>"u"&&n("Bad block header in flate stream"),m|=p<<8,typeof(p=f[d++])>"u"&&n("Bad block header in flate stream");var b=p;typeof(p=f[d++])>"u"&&n("Bad block header in flate stream"),b|=p<<8,b!=(~m&65535)&&n("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var y=this.bufferLength,D=this.ensureBuffer(y+m),g=y+m;this.bufferLength=g;for(var C=y;C<g;++C){if(typeof(p=f[d++])>"u"){this.eof=!0;break}D[C]=p}this.bytesPos=d;return}var T,x;if(h==1)T=u,x=i;else if(h==2){for(var S=this.getBits(5)+257,A=this.getBits(5)+1,w=this.getBits(4)+4,v=Array(o.length),I=0;I<w;)v[o[I++]]=this.getBits(3);for(var k=this.generateHuffmanTable(v),R=0,I=0,P=S+A,L=new Array(P);I<P;){var _=this.getCode(k);_==16?c(this,L,2,3,R):_==17?c(this,L,3,3,R=0):_==18?c(this,L,7,11,R=0):L[I++]=R=_}T=this.generateHuffmanTable(L.slice(0,S)),x=this.generateHuffmanTable(L.slice(S,P))}else n("Unknown block type in flate stream");for(var D=this.buffer,N=D?D.length:0,F=this.bufferLength;;){var G=this.getCode(T);if(G<256){F+1>=N&&(D=this.ensureBuffer(F+1),N=D.length),D[F++]=G;continue}if(G==256){this.bufferLength=F;return}G-=257,G=s[G];var W=G>>16;W>0&&(W=this.getBits(W));var R=(G&65535)+W;G=this.getCode(x),G=a[G],W=G>>16,W>0&&(W=this.getBits(W));var E=(G&65535)+W;F+R>=N&&(D=this.ensureBuffer(F+R),N=D.length);for(var j=0;j<R;++j,++F)D[F]=D[F-E]}},l}();return r})})(xr);class ht{constructor(e){this._canvas=null,this._ctx=null,e&&(this._canvas=e.canvas,this._ctx=e.ctx||e.canvas&&e.canvas.getContext("2d"))}decode(e,r,o){if(!e||e.byteLength<10)throw new ye("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:s=0,height:a=0,format:u}=r;const{applyJpegMask:i}=r;if(i&&!(s&&a))throw new ye("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((l,c)=>{let h=null;u==="jpg"&&i&&(h=ht._getMask(e,{width:s,height:a}));const f=new Blob([new Uint8Array(e)],{type:"image/"+u=="jpg"?"jpeg":u}),d=URL.createObjectURL(f),p=new Image;let m;p.src=d,p.onload=()=>{if(URL.revokeObjectURL(d),sr(o)){c(ar());return}s=p.width,a=p.height,this._canvas&&this._ctx?((this._canvas.width!==s||this._canvas.height!==a)&&(this._canvas.width=s,this._canvas.height=a),this._ctx.clearRect(0,0,s,a)):(this._canvas=document.createElement("canvas"),this._canvas.width=s,this._canvas.height=a,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(p,0,0);const b=this._ctx.getImageData(0,0,s,a);m=b.data;let y;if(r.renderOnCanvas){if(h)for(y=0;y<h.length;y++)h[y]?m[y*4+3]=255:m[y*4+3]=0;this._ctx.putImageData(b,0,0),l(null);return}const g=s*a,C=new Uint8Array(g),T=new Uint8Array(g),x=new Uint8Array(g);if(h)for(y=0;y<g;y++)C[y]=m[y*4],T[y]=m[y*4+1],x[y]=m[y*4+2];else for(h=new Uint8Array(g),y=0;y<g;y++)C[y]=m[y*4],T[y]=m[y*4+1],x[y]=m[y*4+2],h[y]=m[y*4+3];l({width:s,height:a,pixels:[C,T,x],mask:h,pixelType:"u8"})},p.onerror=()=>{URL.revokeObjectURL(d),c("cannot load image")}})}static _getMask(e,r){let o=null;try{const s=new Uint8Array(e),a=Math.ceil(s.length/2);let u=0;const i=s.length-2;for(u=a;u<i&&!(s[u]===255&&s[u+1]===217);u++);if(u+=2,u<s.length-1){const l=new Ae(s.subarray(u)).getBytes();o=new Uint8Array(r.width*r.height);let c=0;for(let h=0;h<l.length;h++)for(let f=7;f>=0;f--)o[c++]=l[h]>>f&1}}catch{}return o}}var qe={},yr={get exports(){return qe},set exports(t){qe=t}};(function(t){(function(e){{var r=e();r!==void 0&&(t.exports=r)}})(function(){var e=function(){function s(a){this.message="JPEG error: "+a}return s.prototype=new Error,s.prototype.name="JpegError",s.constructor=s,s}(),r=function(){if(!self||!self.Uint8ClampedArray)return null;var s=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),a=4017,u=799,i=3406,n=2276,l=1567,c=3784,h=5793,f=2896;function d(){this.decodeTransform=null,this.colorTransform=-1}function p(T,x){for(var S=0,A=[],w,v,k=16;k>0&&!T[k-1];)k--;A.push({children:[],index:0});var R=A[0],I;for(w=0;w<k;w++){for(v=0;v<T[w];v++){for(R=A.pop(),R.children[R.index]=x[S];R.index>0;)R=A.pop();for(R.index++,A.push(R);A.length<=w;)A.push(I={children:[],index:0}),R.children[R.index]=I.children,R=I;S++}w+1<k&&(A.push(I={children:[],index:0}),R.children[R.index]=I.children,R=I)}return A[0].children}function m(T,x,S){return 64*((T.blocksPerLine+1)*x+S)}function b(T,x,S,A,w,v,k,R,I){var P=S.mcusPerLine,L=S.progressive,_=x,D=0,N=0;function F(){if(N>0)return N--,D>>N&1;if(D=T[x++],D===255){var V=T[x++];if(V)throw new e("unexpected marker "+(D<<8|V).toString(16))}return N=7,D>>>7}function G(V){for(var K=V;;){if(K=K[F()],typeof K=="number")return K;if(typeof K!="object")throw new e("invalid huffman sequence")}}function W(V){for(var K=0;V>0;)K=K<<1|F(),V--;return K}function E(V){if(V===1)return F()===1?1:-1;var K=W(V);return K>=1<<V-1?K:K+(-1<<V)+1}function j(V,K){var Q=G(V.huffmanTableDC),X=Q===0?0:E(Q);V.blockData[K]=V.pred+=X;for(var J=1;J<64;){var ee=G(V.huffmanTableAC),te=ee&15,ne=ee>>4;if(te===0){if(ne<15)break;J+=16;continue}J+=ne;var Me=s[J];V.blockData[K+Me]=E(te),J++}}function Y(V,K){var Q=G(V.huffmanTableDC),X=Q===0?0:E(Q)<<I;V.blockData[K]=V.pred+=X}function q(V,K){V.blockData[K]|=F()<<I}var U=0;function B(V,K){if(U>0){U--;return}for(var Q=v,X=k;Q<=X;){var J=G(V.huffmanTableAC),ee=J&15,te=J>>4;if(ee===0){if(te<15){U=W(te)+(1<<te)-1;break}Q+=16;continue}Q+=te;var ne=s[Q];V.blockData[K+ne]=E(ee)*(1<<I),Q++}}var z=0,fe;function Ce(V,K){for(var Q=v,X=k,J=0,ee,te;Q<=X;){var ne=s[Q];switch(z){case 0:if(te=G(V.huffmanTableAC),ee=te&15,J=te>>4,ee===0)J<15?(U=W(J)+(1<<J),z=4):(J=16,z=1);else{if(ee!==1)throw new e("invalid ACn encoding");fe=E(ee),z=J?2:3}continue;case 1:case 2:V.blockData[K+ne]?V.blockData[K+ne]+=F()<<I:(J--,J===0&&(z=z===2?3:0));break;case 3:V.blockData[K+ne]?V.blockData[K+ne]+=F()<<I:(V.blockData[K+ne]=fe<<I,z=0);break;case 4:V.blockData[K+ne]&&(V.blockData[K+ne]+=F()<<I);break}Q++}z===4&&(U--,U===0&&(z=0))}function ve(V,K,Q,X,J){var ee=Q/P|0,te=Q%P,ne=ee*V.v+X,Me=te*V.h+J,Qe=m(V,ne,Me);K(V,Qe)}function Le(V,K,Q){var X=Q/V.blocksPerLine|0,J=Q%V.blocksPerLine,ee=m(V,X,J);K(V,ee)}var he=A.length,pe,de,be,we,ce,me;L?v===0?me=R===0?Y:q:me=R===0?B:Ce:me=j;var ge=0,ae,Z;he===1?Z=A[0].blocksPerLine*A[0].blocksPerColumn:Z=P*S.mcusPerColumn;for(var Ve,Fe;ge<Z;){var ze=w?Math.min(Z-ge,w):Z;for(de=0;de<he;de++)A[de].pred=0;if(U=0,he===1)for(pe=A[0],ce=0;ce<ze;ce++)Le(pe,me,ge),ge++;else for(ce=0;ce<ze;ce++){for(de=0;de<he;de++)for(pe=A[de],Ve=pe.h,Fe=pe.v,be=0;be<Fe;be++)for(we=0;we<Ve;we++)ve(pe,me,ge,be,we);ge++}N=0,ae=C(T,x),ae&&ae.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+ae.invalid),x=ae.offset);var Re=ae&&ae.marker;if(!Re||Re<=65280)throw new e("marker was not found");if(Re>=65488&&Re<=65495)x+=2;else break}return ae=C(T,x),ae&&ae.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+ae.invalid),x=ae.offset),x-_}function y(T,x,S){var A=T.quantizationTable,w=T.blockData,v,k,R,I,P,L,_,D,N,F,G,W,E,j,Y,q,U;if(!A)throw new e("missing required Quantization Table.");for(var B=0;B<64;B+=8){if(N=w[x+B],F=w[x+B+1],G=w[x+B+2],W=w[x+B+3],E=w[x+B+4],j=w[x+B+5],Y=w[x+B+6],q=w[x+B+7],N*=A[B],!(F|G|W|E|j|Y|q)){U=h*N+512>>10,S[B]=U,S[B+1]=U,S[B+2]=U,S[B+3]=U,S[B+4]=U,S[B+5]=U,S[B+6]=U,S[B+7]=U;continue}F*=A[B+1],G*=A[B+2],W*=A[B+3],E*=A[B+4],j*=A[B+5],Y*=A[B+6],q*=A[B+7],v=h*N+128>>8,k=h*E+128>>8,R=G,I=Y,P=f*(F-q)+128>>8,D=f*(F+q)+128>>8,L=W<<4,_=j<<4,v=v+k+1>>1,k=v-k,U=R*c+I*l+128>>8,R=R*l-I*c+128>>8,I=U,P=P+_+1>>1,_=P-_,D=D+L+1>>1,L=D-L,v=v+I+1>>1,I=v-I,k=k+R+1>>1,R=k-R,U=P*n+D*i+2048>>12,P=P*i-D*n+2048>>12,D=U,U=L*u+_*a+2048>>12,L=L*a-_*u+2048>>12,_=U,S[B]=v+D,S[B+7]=v-D,S[B+1]=k+_,S[B+6]=k-_,S[B+2]=R+L,S[B+5]=R-L,S[B+3]=I+P,S[B+4]=I-P}for(var z=0;z<8;++z){if(N=S[z],F=S[z+8],G=S[z+16],W=S[z+24],E=S[z+32],j=S[z+40],Y=S[z+48],q=S[z+56],!(F|G|W|E|j|Y|q)){U=h*N+8192>>14,U=U<-2040?0:U>=2024?255:U+2056>>4,w[x+z]=U,w[x+z+8]=U,w[x+z+16]=U,w[x+z+24]=U,w[x+z+32]=U,w[x+z+40]=U,w[x+z+48]=U,w[x+z+56]=U;continue}v=h*N+2048>>12,k=h*E+2048>>12,R=G,I=Y,P=f*(F-q)+2048>>12,D=f*(F+q)+2048>>12,L=W,_=j,v=(v+k+1>>1)+4112,k=v-k,U=R*c+I*l+2048>>12,R=R*l-I*c+2048>>12,I=U,P=P+_+1>>1,_=P-_,D=D+L+1>>1,L=D-L,v=v+I+1>>1,I=v-I,k=k+R+1>>1,R=k-R,U=P*n+D*i+2048>>12,P=P*i-D*n+2048>>12,D=U,U=L*u+_*a+2048>>12,L=L*a-_*u+2048>>12,_=U,N=v+D,q=v-D,F=k+_,Y=k-_,G=R+L,j=R-L,W=I+P,E=I-P,N=N<16?0:N>=4080?255:N>>4,F=F<16?0:F>=4080?255:F>>4,G=G<16?0:G>=4080?255:G>>4,W=W<16?0:W>=4080?255:W>>4,E=E<16?0:E>=4080?255:E>>4,j=j<16?0:j>=4080?255:j>>4,Y=Y<16?0:Y>=4080?255:Y>>4,q=q<16?0:q>=4080?255:q>>4,w[x+z]=N,w[x+z+8]=F,w[x+z+16]=G,w[x+z+24]=W,w[x+z+32]=E,w[x+z+40]=j,w[x+z+48]=Y,w[x+z+56]=q}}function g(T,x){for(var S=x.blocksPerLine,A=x.blocksPerColumn,w=new Int16Array(64),v=0;v<A;v++)for(var k=0;k<S;k++){var R=m(x,v,k);y(x,R,w)}return x.blockData}function C(T,x,S){function A(I){return T[I]<<8|T[I+1]}var w=T.length-1,v=S<x?S:x;if(x>=w)return null;var k=A(x);if(k>=65472&&k<=65534)return{invalid:null,marker:k,offset:x};for(var R=A(v);!(R>=65472&&R<=65534);){if(++v>=w)return null;R=A(v)}return{invalid:k.toString(16),marker:R,offset:v}}return d.prototype={parse:function(x){function S(){var X=x[v]<<8|x[v+1];return v+=2,X}function A(){var X=S(),J=v+X-2,ee=C(x,J,v);ee&&ee.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+ee.invalid),J=ee.offset);var te=x.subarray(v,J);return v+=te.length,te}function w(X){for(var J=Math.ceil(X.samplesPerLine/8/X.maxH),ee=Math.ceil(X.scanLines/8/X.maxV),te=0;te<X.components.length;te++){Z=X.components[te];var ne=Math.ceil(Math.ceil(X.samplesPerLine/8)*Z.h/X.maxH),Me=Math.ceil(Math.ceil(X.scanLines/8)*Z.v/X.maxV),Qe=J*Z.h,nr=ee*Z.v,ir=64*nr*(Qe+1);Z.blockData=new Int16Array(ir),Z.blocksPerLine=ne,Z.blocksPerColumn=Me}X.mcusPerLine=J,X.mcusPerColumn=ee}var v=0,k=null,R=null,I,P,L=[],_=[],D=[],N=S();if(N!==65496)throw new e("SOI not found");for(N=S();N!==65497;){var F,G,W;switch(N){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var E=A();N===65504&&E[0]===74&&E[1]===70&&E[2]===73&&E[3]===70&&E[4]===0&&(k={version:{major:E[5],minor:E[6]},densityUnits:E[7],xDensity:E[8]<<8|E[9],yDensity:E[10]<<8|E[11],thumbWidth:E[12],thumbHeight:E[13],thumbData:E.subarray(14,14+3*E[12]*E[13])}),N===65518&&E[0]===65&&E[1]===100&&E[2]===111&&E[3]===98&&E[4]===101&&(R={version:E[5]<<8|E[6],flags0:E[7]<<8|E[8],flags1:E[9]<<8|E[10],transformCode:E[11]});break;case 65499:for(var j=S(),Y=j+v-2,q;v<Y;){var U=x[v++],B=new Uint16Array(64);if(U>>4)if(U>>4===1)for(G=0;G<64;G++)q=s[G],B[q]=S();else throw new e("DQT - invalid table spec");else for(G=0;G<64;G++)q=s[G],B[q]=x[v++];L[U&15]=B}break;case 65472:case 65473:case 65474:if(I)throw new e("Only single frame JPEGs supported");S(),I={},I.extended=N===65473,I.progressive=N===65474,I.precision=x[v++],I.scanLines=S(),I.samplesPerLine=S(),I.components=[],I.componentIds={};var z=x[v++],fe,Ce=0,ve=0;for(F=0;F<z;F++){fe=x[v];var Le=x[v+1]>>4,he=x[v+1]&15;Ce<Le&&(Ce=Le),ve<he&&(ve=he);var pe=x[v+2];W=I.components.push({h:Le,v:he,quantizationId:pe,quantizationTable:null}),I.componentIds[fe]=W-1,v+=3}I.maxH=Ce,I.maxV=ve,w(I);break;case 65476:var de=S();for(F=2;F<de;){var be=x[v++],we=new Uint8Array(16),ce=0;for(G=0;G<16;G++,v++)ce+=we[G]=x[v];var me=new Uint8Array(ce);for(G=0;G<ce;G++,v++)me[G]=x[v];F+=17+ce,(be>>4?_:D)[be&15]=p(we,me)}break;case 65501:S(),P=S();break;case 65498:S();var ge=x[v++],ae=[],Z;for(F=0;F<ge;F++){var Ve=I.componentIds[x[v++]];Z=I.components[Ve];var Fe=x[v++];Z.huffmanTableDC=D[Fe>>4],Z.huffmanTableAC=_[Fe&15],ae.push(Z)}var ze=x[v++],Re=x[v++],V=x[v++],K=b(x,v,I,ae,P,ze,Re,V>>4,V&15);v+=K;break;case 65535:x[v]!==255&&v--;break;default:if(x[v-3]===255&&x[v-2]>=192&&x[v-2]<=254){v-=3;break}throw new e("unknown marker "+N.toString(16))}N=S()}for(this.width=I.samplesPerLine,this.height=I.scanLines,this.jfif=k,this.eof=v,this.adobe=R,this.components=[],F=0;F<I.components.length;F++){Z=I.components[F];var Q=L[Z.quantizationId];Q&&(Z.quantizationTable=Q),this.components.push({output:g(I,Z),scaleX:Z.h/I.maxH,scaleY:Z.v/I.maxV,blocksPerLine:Z.blocksPerLine,blocksPerColumn:Z.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(x,S){var A=this.width/x,w=this.height/S,v,k,R,I,P,L,_,D,N,F,G=0,W,E=this.components.length,j=x*S*E,Y=new Uint8ClampedArray(j),q=new Uint32Array(x),U=4294967288;for(_=0;_<E;_++){for(v=this.components[_],k=v.scaleX*A,R=v.scaleY*w,G=_,W=v.output,I=v.blocksPerLine+1<<3,P=0;P<x;P++)D=0|P*k,q[P]=(D&U)<<3|D&7;for(L=0;L<S;L++)for(D=0|L*R,F=I*(D&U)|(D&7)<<3,P=0;P<x;P++)Y[G]=W[F+q[P]],G+=E}var B=this.decodeTransform;if(B)for(_=0;_<j;)for(D=0,N=0;D<E;D++,_++,N+=2)Y[_]=(Y[_]*B[N]>>8)+B[N+1];return Y},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(x){for(var S,A,w,v=0,k=x.length;v<k;v+=3)S=x[v],A=x[v+1],w=x[v+2],x[v]=S-179.456+1.402*w,x[v+1]=S+135.459-.344*A-.714*w,x[v+2]=S-226.816+1.772*A;return x},_convertYcckToRgb:function(x){for(var S,A,w,v,k=0,R=0,I=x.length;R<I;R+=4)S=x[R],A=x[R+1],w=x[R+2],v=x[R+3],x[k++]=-122.67195406894+A*(-660635669420364e-19*A+.000437130475926232*w-54080610064599e-18*S+.00048449797120281*v-.154362151871126)+w*(-.000957964378445773*w+.000817076911346625*S-.00477271405408747*v+1.53380253221734)+S*(.000961250184130688*S-.00266257332283933*v+.48357088451265)+v*(-.000336197177618394*v+.484791561490776),x[k++]=107.268039397724+A*(219927104525741e-19*A-.000640992018297945*w+.000659397001245577*S+.000426105652938837*v-.176491792462875)+w*(-.000778269941513683*w+.00130872261408275*S+.000770482631801132*v-.151051492775562)+S*(.00126935368114843*S-.00265090189010898*v+.25802910206845)+v*(-.000318913117588328*v-.213742400323665),x[k++]=-20.810012546947+A*(-.000570115196973677*A-263409051004589e-19*w+.0020741088115012*S-.00288260236853442*v+.814272968359295)+w*(-153496057440975e-19*w-.000132689043961446*S+.000560833691242812*v-.195152027534049)+S*(.00174418132927582*S-.00255243321439347*v+.116935020465145)+v*(-.000343531996510555*v+.24165260232407);return x},_convertYcckToCmyk:function(x){for(var S,A,w,v=0,k=x.length;v<k;v+=4)S=x[v],A=x[v+1],w=x[v+2],x[v]=434.456-S-1.402*w,x[v+1]=119.541-S+.344*A+.714*w,x[v+2]=481.816-S-1.772*A;return x},_convertCmykToRgb:function(x){for(var S,A,w,v,k=0,R=1/255,I=0,P=x.length;I<P;I+=4)S=x[I]*R,A=x[I+1]*R,w=x[I+2]*R,v=x[I+3]*R,x[k++]=255+S*(-4.387332384609988*S+54.48615194189176*A+18.82290502165302*w+212.25662451639585*v-285.2331026137004)+A*(1.7149763477362134*A-5.6096736904047315*w-17.873870861415444*v-5.497006427196366)+w*(-2.5217340131683033*w-21.248923337353073*v+17.5119270841813)-v*(21.86122147463605*v+189.48180835922747),x[k++]=255+S*(8.841041422036149*S+60.118027045597366*A+6.871425592049007*w+31.159100130055922*v-79.2970844816548)+A*(-15.310361306967817*A+17.575251261109482*w+131.35250912493976*v-190.9453302588951)+w*(4.444339102852739*w+9.8632861493405*v-24.86741582555878)-v*(20.737325471181034*v+187.80453709719578),x[k++]=255+S*(.8842522430003296*S+8.078677503112928*A+30.89978309703729*w-.23883238689178934*v-14.183576799673286)+A*(10.49593273432072*A+63.02378494754052*w+50.606957656360734*v-112.23884253719248)+w*(.03296041114873217*w+115.60384449646641*v-193.58209356861505)-v*(22.33816807309886*v+180.12613974708367);return x},getData:function(x,S,A){if(this.numComponents>4)throw new e("Unsupported color mode");var w=this._getLinearizedBlockData(x,S);if(this.numComponents===1&&A){for(var v=w.length,k=new Uint8ClampedArray(v*3),R=0,I=0;I<v;I++){var P=w[I];k[R++]=P,k[R++]=P,k[R++]=P}return k}else{if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(w);if(this.numComponents===4){if(this._isColorConversionNeeded())return A?this._convertYcckToRgb(w):this._convertYcckToCmyk(w);if(A)return this._convertCmykToRgb(w)}}return w}},d}();return r})})(yr);class Cr{static decode(e,r=!1){const o=new Uint8Array(e),s=new qe;s.parse(o);const{width:a,height:u,numComponents:i,eof:n}=s,l=s.getData(a,u,!0),c=a*u;let h=null,f=0,d=0,p=0;if(!r&&n<o.length-1)try{const y=new Ae(o.subarray(n)).getBytes();h=new Uint8Array(c);let g=0;for(f=0;f<y.length;f++)for(p=7;p>=0;p--)h[g++]=y[f]>>p&1}catch{}let m;if(i===1&&l.length===a*u){const b=new Uint8Array(l.buffer);m=[b,b,b]}else{for(m=[],f=0;f<3;f++)m.push(new Uint8Array(c));for(p=0,d=0;d<c;d++)for(f=0;f<3;f++)m[f][d]=l[p++]}return{width:a,height:u,pixels:m,mask:h}}}const Vt=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let je=null;function zt(){return je||(je=lr(()=>import("./lerc-wasm-6c50f70a.js"),[]).then(t=>t.l).then(({default:t})=>t({locateFile:e=>cr(`esri/layers/support/rasterFormats/${e}`)})).then(t=>{br(t)}),je)}const Xe={getBlobInfo:null,decode:null};function vr(t){return(t>>3<<3)+16}function xe(t,e,r){r.set(t.slice(e,e+r.length))}function br(t){const{_malloc:e,_free:r,_lerc_getBlobInfo:o,_lerc_getDataRanges:s,_lerc_decode_4D:a,asm:u}=t;let i;const n=Object.values(u).find(c=>c&&"buffer"in c&&c.buffer===t.HEAPU8.buffer),l=c=>{const h=c.map(m=>vr(m)),f=h.reduce((m,b)=>m+b),d=e(f);i=new Uint8Array(n.buffer);let p=h[0];h[0]=d;for(let m=1;m<h.length;m++){const b=h[m];h[m]=h[m-1]+p,p=b}return h};Xe.getBlobInfo=c=>{const d=new Uint8Array(48),p=new Uint8Array(3*8),[m,b,y]=l([c.length,d.length,p.length]);i.set(c,m),i.set(d,b),i.set(p,y);let g=o(m,c.length,b,y,12,3);if(g)throw r(m),new Error(`lerc-getBlobInfo: error code is ${g}`);i=new Uint8Array(n.buffer),xe(i,b,d),xe(i,y,p);const C=new Uint32Array(d.buffer),T=new Float64Array(p.buffer),[x,S,,A,w,v,k,R,I,P,L]=C,_={version:x,depthCount:P,width:A,height:w,validPixelCount:k,bandCount:v,blobSize:R,maskCount:I,dataType:S,minValue:T[0],maxValue:T[1],maxZerror:T[2],statistics:[],bandCountWithNoData:L};if(L)return _;if(P===1&&v===1)return r(m),_.statistics.push({minValue:T[0],maxValue:T[1]}),_;const D=P*v*8,N=new Uint8Array(D),F=new Uint8Array(D);let G=m,W=0,E=0,j=!1;if(i.byteLength<m+D*2?(r(m),j=!0,[G,W,E]=l([c.length,D,D]),i.set(c,G)):[W,E]=l([D,D]),i.set(N,W),i.set(F,E),g=s(G,c.length,P,v,W,E),g)throw r(G),j||r(W),new Error(`lerc-getDataRanges: error code is ${g}`);i=new Uint8Array(n.buffer),xe(i,W,N),xe(i,E,F);const Y=new Float64Array(N.buffer),q=new Float64Array(F.buffer),U=_.statistics;for(let B=0;B<v;B++)if(P>1){const z=Y.slice(B*P,(B+1)*P),fe=q.slice(B*P,(B+1)*P),Ce=Math.min.apply(null,z),ve=Math.max.apply(null,fe);U.push({minValue:Ce,maxValue:ve,depthStats:{minValues:z,maxValues:fe}})}else U.push({minValue:Y[B],maxValue:q[B]});return r(G),j||r(W),_},Xe.decode=(c,h)=>{const{maskCount:f,depthCount:d,bandCount:p,width:m,height:b,dataType:y,bandCountWithNoData:g}=h,C=Vt[y],T=m*b,x=new Uint8Array(T*p),S=T*d*p*C.size,A=new Uint8Array(S),w=new Uint8Array(p),v=new Uint8Array(p*8),[k,R,I,P,L]=l([c.length,x.length,A.length,w.length,v.length]);i.set(c,k),i.set(x,R),i.set(A,I),i.set(w,P),i.set(v,L);const _=a(k,c.length,f,R,d,m,b,p,y,I,P,L);if(_)throw r(k),new Error(`lerc-decode: error code is ${_}`);i=new Uint8Array(n.buffer),xe(i,I,A),xe(i,R,x);let D=null;if(g){xe(i,P,w),xe(i,L,v),D=[];const N=new Float64Array(v.buffer);for(let F=0;F<w.length;F++)D.push(w[F]?N[F]:null)}return r(k),{data:A,maskData:x,noDataValues:D}}}function wr(t,e,r,o,s){if(r<2)return t;const a=new o(e*r);if(s)for(let u=0,i=0;u<e;u++)for(let n=0,l=u;n<r;n++,l+=e)a[l]=t[i++];else for(let u=0,i=0;u<e;u++)for(let n=0,l=u;n<r;n++,l+=e)a[i++]=t[l];return a}function jt(t,e={}){const r=e.inputOffset??0,o=t instanceof Uint8Array?t.subarray(r):new Uint8Array(t,r),s=Xe.getBlobInfo(o),{data:a,maskData:u,noDataValues:i}=Xe.decode(o,s),{width:n,height:l,bandCount:c,depthCount:h,dataType:f,maskCount:d,statistics:p}=s,m=Vt[f],b=new m.ctor(a.buffer),y=[],g=[],C=n*l,T=C*h;for(let k=0;k<c;k++){const R=b.subarray(k*T,(k+1)*T);if(e.returnInterleaved)y.push(R);else{const I=wr(R,C,h,m.ctor,!0);y.push(I)}g.push(u.subarray(k*T,(k+1)*T))}const x=d===0?null:d===1?g[0]:new Uint8Array(C);if(d>1){x.set(g[0]);for(let k=1;k<g.length;k++){const R=g[k];for(let I=0;I<C;I++)x[I]=x[I]&R[I]}}const{noDataValue:S}=e,A=S!=null&&m.range[0]<=S&&m.range[1]>=S;if(d>0&&A)for(let k=0;k<c;k++){const R=y[k],I=g[k]||x;for(let P=0;P<C;P++)I[P]===0&&(R[P]=S)}const w=d===c&&c>1?g:null,{pixelType:v}=m;return{width:n,height:l,bandCount:c,pixelType:v,depthCount:h,statistics:p,pixels:y,mask:x,bandMasks:w,noDataValues:i}}function Tr(t,e,r,o=!0){if(!(e%4===0&&r%4===0)){const s=new ArrayBuffer(Math.ceil(r/4)*4),a=new Uint8Array(s),u=new Uint8Array(t,e,r);if(!o)a.set(u);else for(let i=0;i<a.length;i+=4)a[i]=u[i+3],a[i+1]=u[i+2],a[i+2]=u[i+1],a[i+3]=u[i];return new Uint32Array(a.buffer)}if(o){const s=new Uint8Array(t,e,r),a=new Uint8Array(s.length);for(let u=0;u<a.length;u+=4)a[u]=s[u+3],a[u+1]=s[u+2],a[u+2]=s[u+1],a[u+3]=s[u];return new Uint32Array(a.buffer)}return new Uint32Array(t,e,r/4)}function Rt(){const t=[];for(let e=0;e<=257;e++)t[e]=[e];return t}function Pt(t,e){for(let r=0;r<e.length;r++)t.push(e[r])}const _e=new Set;_e.add(511);_e.add(1023);_e.add(2047);_e.add(4095);_e.add(8191);function pt(t,e,r,o=!0){const s=Tr(t,e,r,o);let a=9,u=Rt(),i=32,n=u.length,l=[],c=1,h=s[0],f=0;const d=s.length,p=(d*4-r)*8,m=[];for(;h!=null;){if(i>=a)i-=a,f=h>>>32-a,h=h<<a;else{f=h>>>32-i,h=s[c++];const y=a-i;i=32-y,f=(f<<y)+(h>>>i),h=h<<y}if(f===257)break;if(f===256){a=9,u=Rt(),n=u.length,l=[];continue}const b=u[f];if(b==null){if(f>u.length)throw new Error("data integrity issue: code does not exist on code page");l.push(l[0]),u[n++]=l.slice(),Pt(m,l)}else Pt(m,b),l.push(b[0]),l.length>1&&(u[n++]=l.slice()),l=b.slice();if(_e.has(n)&&a++,i===0&&(h=s[c++],i=32),c>d||c===d&&i<=p)break}return new Uint8Array(m)}const Et=(t,e)=>{const r=e.width*e.height,o=e.pixelType;return Math.floor(t.byteLength/(r*Wt(o)))},Wt=t=>{let e=1;switch(t){case Uint8Array:case Int8Array:e=1;break;case Uint16Array:case Int16Array:e=2;break;case Uint32Array:case Int32Array:case Float32Array:e=4;break;case Float64Array:e=8;break}return e},Sr=(t,e)=>{if(t.byteLength*8<e)return null;const r=new Uint8Array(t,0,Math.ceil(e/8)),o=new Uint8Array(e);let s=0,a=0,u=0,i=0;for(u=0;u<r.length-1;u++)for(a=r[u],i=7;i>=0;i--)o[s++]=a>>i&1;for(i=7;s<e-1;)a=r[r.length-1],o[s++]=a>>i&1,i--;return o};class Ar{static decode(e,r){const o=r.pixelType,s=[],a=r.width*r.height,u=Et(e,r),{bandIds:i,format:n}=r,l=i&&i.length||Et(e,r),c=e.byteLength-e.byteLength%(a*Wt(o)),h=new o(e,0,a*u);let f,d,p,m,b=null;if(n==="bip")for(f=0;f<l;f++){for(p=new o(a),m=i?i[f]:f,d=0;d<a;d++)p[d]=h[d*u+m];s.push(p)}else if(n==="bsq")for(f=0;f<l;f++)m=i?i[f]:f,s.push(h.subarray(m*a,(m+1)*a));return c<e.byteLength-1&&(b=Sr(e.slice(c),a)),{pixels:s,mask:b}}}function Ir(t,e){let r=0,o="",s=0,a=0;const u=t.length;for(;r<u;)a=t[r++],s=a>>4,s<8?s=1:s===15?(s=4,a=(a&7)<<18|(t[r++]&63)<<12|(t[r++]&63)<<6|t[r++]&63):s===14?(s=3,a=(a&15)<<12|(t[r++]&63)<<6|t[r++]&63):(s=2,a=(a&31)<<6|t[r++]&63),(a!==0||e)&&(o+=String.fromCharCode(a));return o}const mt=(()=>{const t=[];return t[254]="NEWSUBFILETYPE",t[255]="SUBFILETYPE",t[256]="IMAGEWIDTH",t[257]="IMAGELENGTH",t[258]="BITSPERSAMPLE",t[259]="COMPRESSION",t[262]="PHOTOMETRICINTERPRETATION",t[263]="THRESHHOLDING",t[264]="CELLWIDTH",t[265]="CELLLENGTH",t[266]="FILLORDER",t[269]="DOCUMENTNAME",t[270]="IMAGEDESCRIPTION",t[271]="MAKE",t[272]="MODEL",t[273]="STRIPOFFSETS",t[274]="ORIENTATION",t[277]="SAMPLESPERPIXEL",t[278]="ROWSPERSTRIP",t[279]="STRIPBYTECOUNTS",t[280]="MINSAMPLEVALUE",t[281]="MAXSAMPLEVALUE",t[282]="XRESOLUTION",t[283]="YRESOLUTION",t[284]="PLANARCONFIGURATION",t[285]="PAGENAME",t[286]="XPOSITION",t[287]="YPOSITION",t[288]="FREEOFFSETS",t[289]="FREEBYTECOUNTS",t[290]="GRAYRESPONSEUNIT",t[291]="GRAYRESPONSECURVE",t[292]="T4OPTIONS",t[293]="T6OPTIONS",t[296]="RESOLUTIONUNIT",t[297]="PAGENUMBER",t[300]="COLORRESPONSEUNIT",t[301]="TRANSFERFUNCTION",t[305]="SOFTWARE",t[306]="DATETIME",t[315]="ARTIST",t[316]="HOSTCOMPUTER",t[317]="PREDICTOR",t[318]="WHITEPOINT",t[319]="PRIMARYCHROMATICITIES",t[320]="COLORMAP",t[321]="HALFTONEHINTS",t[322]="TILEWIDTH",t[323]="TILELENGTH",t[324]="TILEOFFSETS",t[325]="TILEBYTECOUNTS",t[326]="BADFAXLINES",t[327]="CLEANFAXDATA",t[328]="CONSECUTIVEBADFAXLINES",t[330]="SUBIFD",t[332]="INKSET",t[333]="INKNAMES",t[334]="NUMBEROFINKS",t[336]="DOTRANGE",t[337]="TARGETPRINTER",t[338]="EXTRASAMPLES",t[339]="SAMPLEFORMAT",t[340]="SMINSAMPLEVALUE",t[341]="SMAXSAMPLEVALUE",t[342]="TRANSFERRANGE",t[347]="JPEGTABLES",t[512]="JPEGPROC",t[513]="JPEGIFOFFSET",t[514]="JPEGIFBYTECOUNT",t[515]="JPEGRESTARTINTERVAL",t[517]="JPEGLOSSLESSPREDICTORS",t[518]="JPEGPOINTTRANSFORM",t[519]="JPEGQTABLES",t[520]="JPEGDCTABLES",t[521]="JPEGACTABLES",t[529]="YCBCRCOEFFICIENTS",t[530]="YCBCRSUBSAMPLING",t[531]="YCBCRPOSITIONING",t[532]="REFERENCEBLACKWHITE",t[700]="XMP",t[33550]="GEOPIXELSCALE",t[33922]="GEOTIEPOINTS",t[33432]="COPYRIGHT",t[42112]="GDAL_METADATA",t[42113]="GDAL_NODATA",t[50844]="RPCCOEFFICIENT",t[34264]="GEOTRANSMATRIX",t[34735]="GEOKEYDIRECTORY",t[34736]="GEODOUBLEPARAMS",t[34737]="GEOASCIIPARAMS",t[34665]="EXIFIFD",t[34853]="GPSIFD",t[40965]="INTEROPERABILITYIFD",t})(),kr=(()=>{const t=mt.slice();return t[36864]="ExifVersion",t[40960]="FlashpixVersion",t[40961]="ColorSpace",t[42240]="Gamma",t[37121]="ComponentsConfiguration",t[37122]="CompressedBitsPerPixel",t[40962]="PixelXDimension",t[40963]="PixelYDimension",t[37500]="MakerNote",t[37510]="UserComment",t[40964]="RelatedSoundFile",t[36867]="DateTimeOriginal",t[36868]="DateTimeDigitized",t[36880]="OffsetTime",t[36881]="OffsetTimeOriginal",t[36882]="OffsetTimeDigitized",t[37520]="SubSecTime",t[37521]="SubSecTimeOriginal",t[37522]="SubSecTimeDigitized",t[37888]="Temperature",t[37889]="Humidity",t[37890]="Pressure",t[37891]="WaterDepth",t[37892]="Acceleration",t[37893]="CameraElevationAngle",t[42016]="ImageUniqueID",t[42032]="CameraOwnerName",t[42033]="BodySerialNumber",t[42034]="LensSpecification",t[42035]="LensMake",t[42036]="LensModel",t[42037]="LensSerialNumber",t[33434]="ExposureTime",t[33437]="FNumber",t[34850]="ExposureProgram",t[34852]="SpectralSensitivity",t[34855]="PhotographicSensitivity",t[34856]="OECF",t[34864]="SensitivityType",t[34865]="StandardOutputSensitivity",t[34866]="RecommendedExposureIndex",t[34867]="ISOSpeed",t[34868]="ISOSpeedLatitudeyyy",t[34869]="ISOSpeedLatitudezzz",t[37377]="ShutterSpeedValue",t[37378]="ApertureValue",t[37379]="BrightnessValue",t[37380]="ExposureBiasValue",t[37381]="MaxApertureValue",t[37382]="SubjectDistance",t[37383]="MeteringMode",t[37384]="LightSource",t[37385]="Flash",t[37386]="FocalLength",t[37396]="SubjectArea",t[41483]="FlashEnergy",t[41484]="SpatialFrequencyResponse",t[41486]="FocalPlaneXResolution",t[41487]="FocalPlaneYResolution",t[41488]="FocalPlaneResolutionUnit",t[41492]="SubjectLocation",t[41493]="ExposureIndex",t[41495]="SensingMethod",t[41728]="FileSource",t[41729]="SceneType",t[41730]="CFAPattern",t[41985]="CustomRendered",t[41986]="ExposureMode",t[41987]="WhiteBalance",t[41988]="DigitalZoomRatio",t[41989]="FocalLengthIn35mmFilm",t[41990]="SceneCaptureType",t[41991]="GainControl",t[41992]="Contrast",t[41993]="Saturation",t[41994]="Sharpness",t[41995]="DeviceSettingDescription",t[41996]="SubjectDistanceRange",t})(),Rr=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],Pr=(()=>{const t=[];return t[1024]="GTModelTypeGeoKey",t[1025]="GTRasterTypeGeoKey",t[1026]="GTCitationGeoKey",t[2048]="GeographicTypeGeoKey",t[2049]="GeogCitationGeoKey",t[2050]="GeogGeodeticDatumGeoKey",t[2051]="GeogPrimeMeridianGeoKey",t[2052]="GeogLinearUnitsGeoKey",t[2053]="GeogLinearUnitSizeGeoKey",t[2054]="GeogAngularUnitsGeoKey",t[2055]="GeogAngularUnitSizeGeoKey",t[2056]="GeogEllipsoidGeoKey",t[2057]="GeogSemiMajorAxisGeoKey",t[2058]="GeogSemiMinorAxisGeoKey",t[2059]="GeogInvFlatteningGeoKey",t[2061]="GeogPrimeMeridianLongGeoKey",t[2060]="GeogAzimuthUnitsGeoKey",t[3072]="ProjectedCSTypeGeoKey",t[3073]="PCSCitationGeoKey",t[3074]="ProjectionGeoKey",t[3075]="ProjCoordTransGeoKey",t[3076]="ProjLinearUnitsGeoKey",t[3077]="ProjLinearUnitSizeGeoKey",t[3078]="ProjStdParallel1GeoKey",t[3079]="ProjStdParallel2GeoKey",t[3080]="ProjNatOriginLongGeoKey",t[3081]="ProjNatOriginLatGeoKey",t[3082]="ProjFalseEastingGeoKey",t[3083]="ProjFalseNorthingGeoKey",t[3084]="ProjFalseOriginLongGeoKey",t[3085]="ProjFalseOriginLatGeoKey",t[3086]="ProjFalseOriginEastingGeoKey",t[3087]="ProjFalseOriginNorthingGeoKey",t[3088]="ProjCenterLongGeoKey",t[3090]="ProjCenterEastingGeoKey",t[3091]="ProjCenterNorthingGeoKey",t[3092]="ProjScaleAtNatOriginGeoKey",t[3093]="ProjScaleAtCenterGeoKey",t[3094]="ProjAzimuthAngleGeoKey",t[3095]="ProjStraightVertPoleLongGeoKey",t[4096]="VerticalCSTypeGeoKey",t[4097]="VerticalCitationGeoKey",t[4098]="VerticalDatumGeoKey",t[4099]="VerticalUnitsGeoKey",t})(),Er=(t,e)=>{let r=(e||mt)[t];return r===void 0&&(r="unknown"+String(t)),r},gt=new Map;gt.set("EXIFIFD",kr);gt.set("GPSIFD",Rr);const Ee={TIFF_TAGS:mt,ifdTags:gt,GEO_KEYS:Pr,getTagName:Er},xt=(()=>{const t=new ArrayBuffer(4),e=new Uint8Array(t),r=new Uint32Array(t);return r[0]=1,e[0]===1})(),Dt=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],De=4294967296,Dr=new Set([1,5,6,7,8,34712,34887]);function yt(t,e){let r="unknown";return t===3?r=e===64?"f64":"f32":t===1?e===1?r="u1":e===2?r="u2":e===4?r="u4":e<=8?r="u8":e<=16?r="u16":e<=32&&(r="u32"):t===2&&(e<=8?r="s8":e<=16?r="s16":e<=32&&(r="s32")),r}function Je(t){const e=t?t.toLowerCase():"f32";let r=null;switch(e){case"u1":case"u2":case"u4":case"u8":r=Uint8Array;break;case"u16":r=Uint16Array;break;case"u32":r=Uint32Array;break;case"s8":r=Int8Array;break;case"s16":r=Int16Array;break;case"s32":r=Int32Array;break;case"f64":r=Float64Array;break;default:r=Float32Array}return r}function _r(t,e){return{x:e[0]*t.x+e[1]*t.y+e[2],y:e[3]*t.x+e[4]*t.y+e[5]}}function Yt(t,e){var r;return(r=t.get(e))==null?void 0:r.values}function Te(t,e){var r;return(r=t.get(e))==null?void 0:r.values}function _t(t,e){var r,o;return(o=(r=t.get(e))==null?void 0:r.values)==null?void 0:o[0]}function H(t,e){var r,o;return(o=(r=t.get(e))==null?void 0:r.values)==null?void 0:o[0]}function tt(t,e,r,o=0,s=Ee.TIFF_TAGS,a=4){const u=a===8,i=u?bt(new DataView(t,r,8),0,e):new DataView(t,r,2).getUint16(0,e),n=4+a*2,l=u?8:2,c=l+i*n;if(r+c>t.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:c};const h=r+c+4<=t.byteLength?He(new DataView(t,r+c,a===8?8:4),0,e,a===8):null,f=r+l,d=new Map;let p,m,b,y,g,C=0,T=0;for(let x=0;x<i;x++){m=new DataView(t,f+n*x,n),b=m.getUint16(0,e),g=m.getUint16(2,e),y=Ee.getTagName(b,s);const S=[];a===2?(C=m.getUint16(4,e),T=m.getUint16(6,e)):a===4?(C=m.getUint32(4,e),T=m.getUint32(8,e)):a===8&&(C=He(m,4,e,!0),T=He(m,12,e,!0),S.push(m.getUint32(12,e)),S.push(m.getUint32(16,e))),p={id:b,type:g,valueCount:C,valueOffset:T,valueOffsets:S,values:null},Ur(t,e,p,o,!1,a),d.set(y,p)}return{success:!0,ifd:d,nextIFD:h,requiredBufferSize:c}}const Lr=(t,e)=>jt(t,{inputOffset:e}).pixels[0];function nt(t,e){if(!(e===1||e===2||e===4))return t;const r=new Uint8Array(t),o=8/e,s=new Uint8Array(t.byteLength*o);let a=0;const u=2**e-1;for(let i=0;i<r.length;i++){const n=r[i];for(let l=0;l<o;l++)s[a++]=n<<e*l>>>8-e&u}return s.buffer}function it(t,e,r){const o=new qe;o.parse(t),o.colorTransform=r===6?-1:0;const s=o.getData(o.width,o.height,e!==1);return new Uint8Array(s.buffer)}function st(t){const r=new Ae(t).getBytes(),o=new ArrayBuffer(r.length),s=new Uint8Array(o);return s.set(r),s}async function at(t,e,r,o,s){const a=xt===e,u=H(r,"BITSPERSAMPLE"),i=H(r,"SAMPLESPERPIXEL"),n=H(r,"PHOTOMETRICINTERPRETATION"),l=H(r,"SAMPLEFORMAT")??1,c=yt(l,u),h=H(r,"COMPRESSION")??1,f=Je(c);let d;if(h===34887)return await zt(),Lr(t,o);let p;if(h===1)d=t.slice(o,o+s),p=new Uint8Array(d);else if(h===8||h===32946)p=new Uint8Array(t,o,s),p=st(p),d=p.buffer;else if(h===6)p=new Uint8Array(t,o,s),p=it(p,i,n),d=p.buffer;else if(h===7){const b=r.get("JPEGTABLES").values,y=b.length-2;p=new Uint8Array(y+s-2);for(let C=0;C<y;C++)p[C]=b[C];const g=new Uint8Array(t,o+2,s-2);for(let C=0;C<g.length;C++)p[y+C]=g[C];p=it(p,i,n),d=p.buffer}else if(h===5)p=pt(t,o,s,e),d=p.buffer;else throw new Error("tiff-decode: unsupport compression "+h);d=nt(d,u);let m;if(c==="u8"||c==="s8"||a)m=new f(d);else{d=new ArrayBuffer(p.length);const b=new Uint8Array(d);switch(c){case"u16":case"s16":for(let y=0;y<p.length;y+=2)b[y]=p[y+1],b[y+1]=p[y];break;case"u32":case"s32":case"f32":for(let y=0;y<p.length;y+=4)b[y]=p[y+3],b[y+1]=p[y+2],b[y+2]=p[y+1],b[y+3]=p[y];break}m=new f(d)}return m}async function Fr(t,e,r){const o=Te(r,"TILEOFFSETS");if(o===void 0)return null;const s=Te(r,"TILEBYTECOUNTS"),{width:a,height:u,pixelType:i,tileWidth:n,tileHeight:l}=Ct([r]),c=vt(r,e),h=H(r,"SAMPLESPERPIXEL")||e.planes,f=a*u,d=H(r,"BITSPERSAMPLE"),m=(H(r,"COMPRESSION")??1)===34887,b=Je(i),y=[];for(let D=0;D<h;D++)y.push(new b(f));let g,C,T,x,S,A,w,v,k,R,I,P,L;const _=Math.ceil(a/n);if(d%8===0){if(m&&c&&h>1){const D=Math.round(o.length/h);for(g=0;g<D;g++){A=Math.floor(g/_)*l,w=g%_*n,v=A*a+w;for(let N=0;N<h;N++){const F=g*h+N;if(s[F]!==0)for(T=await at(t,e.littleEndian,r,o[F],s[F]),R=0,k=v,P=Math.min(n,a-w),I=Math.min(l,u-A),L=y[N],x=0;x<I;x++)for(k=v+x*a,R=x*n,S=0;S<P;S++,k++,R++)L[k]=T[R]}}}else for(g=0;g<o.length;g++)if(s[g]!==0)for(A=Math.floor(g/_)*l,w=g%_*n,v=A*a+w,T=await at(t,e.littleEndian,r,o[g],s[g]),R=0,k=v,P=Math.min(n,a-w),I=Math.min(l,u-A),C=0;C<h;C++)if(L=y[C],c||m)for(x=0;x<I;x++)for(k=v+x*a,R=n*l*C+x*n,S=0;S<P;S++,k++,R++)L[k]=T[R];else for(x=0;x<I;x++)for(k=v+x*a,R=x*n*h+C,S=0;S<P;S++,k++,R+=h)L[k]=T[R]}return{width:a,height:u,pixelType:i,pixels:y}}const Mr=(t,e,r)=>{const o=xt===e.littleEndian,s=Te(r,"STRIPOFFSETS");if(s===void 0)return null;const{width:a,height:u,pixelType:i}=Ct([r]),n=H(r,"SAMPLESPERPIXEL")||e.planes,l=H(r,"PHOTOMETRICINTERPRETATION"),c=a*u,h=H(r,"BITSPERSAMPLE"),f=Je(i),d=new f(c*n),p=Te(r,"STRIPBYTECOUNTS"),m=H(r,"ROWSPERSTRIP"),b=H(r,"COMPRESSION")??1;let y,g,C,T,x,S,A,w,v,k=m;if(h%8===0)for(y=0;y<s.length;y++){if(x=y*(m*a)*n,(y+1)*m>u?k=u-y*m:k=m,i==="u8"||i==="s8"||o)b===8||b===32946?(A=new Uint8Array(t,s[y],p[y]),A=st(A),S=A.buffer):b===6?(A=new Uint8Array(t,s[y],p[y]),A=it(A,n,l),S=A.buffer):b===5?(A=pt(t,s[y],p[y],e.littleEndian),S=A.buffer):(p[y]!==k*a*n*h/8&&console.log("strip byte counts is different than expected"),S=t.slice(s[y],s[y]+p[y])),S=nt(S,h),T=new f(S);else{switch(b===6||b===8||b===32946?(A=new Uint8Array(t,s[y],p[y]),w=st(A),S=w.buffer):(p[y]!==k*a*n*h/8&&console.log("strip byte counts is different than expected"),S=new ArrayBuffer(p[y]),A=new Uint8Array(t,s[y],p[y]),w=new Uint8Array(S)),i){case"u16":case"s16":for(C=0;C<A.length;C+=2)w[C]=A[C+1],w[C+1]=A[C];break;case"u32":case"s32":case"f32":for(C=0;C<A.length;C+=4)w[C]=A[C+3],w[C+1]=A[C+2],w[C+2]=A[C+1],w[C+3]=A[C];break}S=nt(S,h),T=new f(S)}d.set(T,x)}const R=[];if(n===1)R.push(d);else for(y=0;y<n;y++){for(v=new f(c),g=0;g<c;g++)v[g]=d[g*n+y];R.push(v)}return{width:a,height:u,pixelType:i,pixels:R}},Gr=(t,e,r)=>{if(!(t&&t.length>0&&e&&r))return null;let o,s,a;const u=t[0].length,i=t.length,n=new Uint8Array(u);for(let l=0;l<i;l++)if(o=t[l],s=e[l],a=r[l],l===0)for(let c=0;c<u;c++)n[c]=o[c]<s||o[c]>a?0:1;else for(let c=0;c<u;c++)n[c]&&(n[c]=o[c]<s||o[c]>a?0:1);return n},Br=t=>{if(!t)return null;const e=t.match(/<Item(.*?)Item>/gi);if(!e||e.length===0)return null;const r=new Map;let o,s,a,u,i;for(let g=0;g<e.length;g++)o=e[g],s=o.slice(6,o.indexOf(">")),u=o.indexOf("sample="),u>-1&&(i=o.slice(u+8,o.indexOf('"',u+8))),u=o.indexOf("name="),u>-1&&(s=o.slice(u+6,o.indexOf('"',u+6))),s&&(a=o.slice(o.indexOf(">")+1,o.indexOf("</Item>")).trim(),i!=null?r.has(s)?r.get(s)[i]=a:r.set(s,[a]):r.set(s,a)),i=null;const n=r.get("STATISTICS_MINIMUM"),l=r.get("STATISTICS_MAXIMUM"),c=r.get("STATISTICS_MEAN"),h=r.get("STATISTICS_STDDEV");let f=null;if(n&&l){f=[];for(let g=0;g<n.length;g++)f.push({min:parseFloat(n[g]),max:parseFloat(l[g]),avg:c&&parseFloat(c[g]),stddev:h&&parseFloat(h[g])})}const d=r.get("BandName"),p=r.get("WavelengthMin"),m=r.get("WavelengthMax");let b=null;if(d){b=[];for(let g=0;g<d.length;g++)b.push({BandName:d[g],WavelengthMin:p&&parseFloat(p[g]),WavelengthMax:m&&parseFloat(m[g])})}const y=r.get("DataType");return{statistics:f,bandProperties:b,dataType:y,rawMetadata:r}};function Ur(t,e,r,o=0,s=!1,a=4){if(r.values)return!0;const u=r.type,i=r.valueCount;let n=r.valueOffset,l=[];const c=Dt[u],h=c*8,f=i*c,d=i*Dt[u]*8;let p,m;const b=a===8?64:32,y=r.valueOffsets;if(d>b){const g=s?t.byteLength:t?t.byteLength-n+o:0;if(f>g)return r.offlineOffsetSize=[n,f],r.values=null,!1}if(d<=b){if(!e)if(b<=32)n=n>>>32-d;else{const g=y!=null&&y.length?y[0]:n>>>0,C=y!=null&&y.length?y[1]:Math.round((n-g)/De);d<=32?(n=g>>>32-d,y[0]=n):(n=g*2**(32-d)+(C>>>32-d),y[0]=g,y[1]=C>>>32-d)}if(i===1&&h===b)l=[n];else if(b===64){const g=y!=null&&y.length?y[0]:n>>>0,C=y!=null&&y.length?y[1]:Math.round((n-g)/De);let T=g,x=32;for(m=1;m<=i;m++){const S=32-h*m%32;if(x<h){const A=T<<S>>>32-x,w=C<<32-x>>>32-x;T=C,l.push(A+w*2**(h-x)),x-=32-(h-x)}else l.push(T<<S>>>32-h),x-=h;x===0&&(x=32,T=C)}}else for(m=1;m<=i;m++){const g=32-h*m;l.push(n<<g>>>32-h)}}else{n-=o,s&&(n=0);for(let g=n;g<n+f;g+=c){switch(u){case 1:p=new DataView(t,g,1).getUint8(0);break;case 2:p=new DataView(t,g,1).getUint8(0);break;case 3:p=new DataView(t,g,2).getUint16(0,e);break;case 4:case 13:p=new DataView(t,g,4).getUint32(0,e);break;case 5:p=new DataView(t,g,4).getUint32(0,e)/new DataView(t,g+4,4).getUint32(0,e);break;case 6:p=new DataView(t,g,1).getInt8(0);break;case 7:p=new DataView(t,g,1).getUint8(0);break;case 8:p=new DataView(t,g,2).getInt16(0,e);break;case 9:p=new DataView(t,g,4).getInt32(0,e);break;case 10:p=new DataView(t,g,4).getInt32(0,e)/new DataView(t,g+4,4).getInt32(0,e);break;case 11:p=new DataView(t,g,4).getFloat32(0,e);break;case 12:p=new DataView(t,g,8).getFloat64(0,e);break;case 16:case 18:p=bt(new DataView(t,g,8),0,e);break;case 17:p=Nr(new DataView(t,g,8),0,e);break;default:p=null}l.push(p)}}if(u===2){let g="";const C=l;for(l=[],m=0;m<C.length;m++)C[m]===0&&g!==""?(l.push(g),g=""):g+=String.fromCharCode(C[m]);(g!==""||l.length===0)&&l.push(g)}return r.values=l,!0}function Ct(t){const e=t[0],r=H(e,"TILEWIDTH"),o=H(e,"TILELENGTH"),s=H(e,"IMAGEWIDTH"),a=H(e,"IMAGELENGTH"),u=H(e,"BITSPERSAMPLE"),i=H(e,"SAMPLESPERPIXEL"),n=H(e,"SAMPLEFORMAT")??1,l=yt(n,u),c=vt(e),h=Yt(e,"GDAL_NODATA");let f=null;h!=null&&h.length&&(f=h.map(E=>parseFloat(E)),f.some(E=>isNaN(E))&&(f=null));const d=H(e,"COMPRESSION")??1;let p;switch(d){case 1:p="NONE";break;case 2:case 3:case 4:case 32771:p="CCITT";break;case 5:p="LZW";break;case 6:case 7:p="JPEG";break;case 32773:p="PACKBITS";break;case 8:case 32946:p="DEFLATE";break;case 34712:p="JPEG2000";break;case 34887:p="LERC";break;default:p=String(d);break}let m=!0,b="";Dr.has(d)||(m=!1,b+="unsupported tag compression "+d),n>3&&(m=!1,b+="unsupported tag sampleFormat "+n),u===1||u===2||u===4||u%8===0||(m=!1,b+="unsupported tag bitsPerSample "+u);const y=_t(e,"GEOASCIIPARAMS");let g;if(y){const E=y.split("|").find(Y=>Y.includes("ESRI PE String = ")),j=E?E.replace("ESRI PE String = ",""):"";g=j.startsWith("COMPD_CS")||j.startsWith("PROJCS")||j.startsWith("GEOGCS")?{wkid:null,wkt:j}:null}const C=Te(e,"GEOTIEPOINTS"),T=Te(e,"GEOPIXELSCALE"),x=Te(e,"GEOTRANSMATRIX"),S=e.has("GEOKEYDIRECTORY")?e.get("GEOKEYDIRECTORY").data:null;let A=!1,w=!1;if(S){A=H(S,"GTRasterTypeGeoKey")===2;const j=H(S,"GTModelTypeGeoKey");if(j===2){const Y=H(S,"GeographicTypeGeoKey");Y>=1024&&Y<=32766&&(g={wkid:Y}),!g&&Y===32767&&(w=!0,g={wkid:4326})}else if(j===1){const Y=H(S,"ProjectedCSTypeGeoKey");Y>=1024&&Y<=32766&&(g={wkid:Y})}}let v,k;if(T&&C&&C.length>=6?(v=[T[0],0,C[3]-C[0]*T[0],0,-Math.abs(T[1]),C[4]-C[1]*T[1]],A&&(v[2]-=v[0]*.5+v[1]*.5,v[5]-=v[3]*.5+v[4]*.5)):x&&x.length===16&&(A?v=[x[0],x[1],x[3]-x[0]*.5,x[4],x[5],x[7]-x[5]*.5]:v=[x[0],x[1],x[3],x[4],x[5],x[7]]),v){const E=[{x:0,y:a},{x:0,y:0},{x:s,y:a},{x:s,y:0}];let j,Y=Number.POSITIVE_INFINITY,q=Number.POSITIVE_INFINITY,U=Number.NEGATIVE_INFINITY,B=Number.NEGATIVE_INFINITY;for(let z=0;z<E.length;z++)j=_r(E[z],v),Y=j.x>Y?Y:j.x,U=j.x<U?U:j.x,q=j.y>q?q:j.y,B=j.y<B?B:j.y;k={xmin:Y,xmax:U,ymin:q,ymax:B,spatialReference:g}}else k={xmin:-.5,ymin:.5-a,xmax:s-.5,ymax:.5,spatialReference:g};w&&(k.xmax-k.xmin>400||Math.max(Math.abs(k.xmin),Math.abs(k.xmax))>361)&&(g=null,k.spatialReference=null);const R=Ht(t);let I,P,L,_;if(R.length>0){L=Math.round(Math.log(s/H(R[0],"IMAGEWIDTH"))/Math.LN2);const E=R[R.length-1];_=Math.round(Math.log(s/H(E,"IMAGEWIDTH"))/Math.LN2),I=H(E,"TILEWIDTH"),P=H(E,"TILELENGTH")}I=_!=null&&_>0?I||r:null,P=_!=null&&_>0?P||o:null;let D;r&&(D=[{maxCol:Math.ceil(s/r)-1,maxRow:Math.ceil(a/o)-1,minRow:0,minCol:0}],R.forEach(E=>{D.push({maxCol:Math.ceil(H(E,"IMAGEWIDTH")/H(E,"TILEWIDTH"))-1,maxRow:Math.ceil(H(E,"IMAGELENGTH")/H(E,"TILELENGTH"))-1,minRow:0,minCol:0})}));const N=_t(t[0],"GDAL_METADATA"),F=Br(N);b+=" "+qt({width:s,height:a,tileWidth:r,tileHeight:o,planes:i,ifds:t});const W=Kt(t).length===R.length+1;return{width:s,height:a,tileWidth:r,tileHeight:o,planes:i,isBSQ:c,pixelType:l,compression:p,noData:f,hasMaskBand:W,isSupported:m,message:b,extent:k,isPseudoGeographic:w,affine:T?null:v,firstPyramidLevel:L,maximumPyramidLevel:_,pyramidBlockWidth:I,pyramidBlockHeight:P,tileBoundary:D,metadata:F}}function vt(t,e){const r=Yt(t,"PLANARCONFIGURATION");return r?r[0]===2:e?e.isBSQ:!1}function Ht(t){return t.filter(e=>H(e,"NEWSUBFILETYPE")===1)}function Kt(t){return t.filter(e=>{const o=((H(e,"NEWSUBFILETYPE")??0)&4)===4,s=H(e,"PHOTOMETRICINTERPRETATION")===4;return o&&s})}function Or(t){const{littleEndian:e,isBigTiff:r,firstIFDPos:o}=Vr(t);let s=o;const a=[];do{const l=zr(t,e,s,0,Ee.TIFF_TAGS,r?8:4);if(l.success)a.push(l.ifd),s=l.nextIFD;else break}while(s>0);const u=Ct(a),i=Ht(a),n=Kt(a);return{...u,littleEndian:e,isBigTiff:r,ifds:a,pyramidIFDs:i,maskIFDs:n}}function bt(t,e,r){const o=t.getUint32(e,r),s=t.getUint32(e+4,r);return r?s*De+o:o*De+s}function Nr(t,e,r){let o=r?t.getInt32(e,r):t.getUint32(e,r),s=r?t.getUint32(e+4,r):t.getInt32(e+4,r);const a=(r?o:s)>=0?1:-1;return r?o*=a:s*=a,a*(r?s*De+o:o*De+s)}function He(t,e,r,o){return o?bt(t,e,r):t.getUint32(e,r)}function Vr(t){const e=new DataView(t,0,16),r=e.getUint16(0,!1);let o=null;if(r===18761)o=!0;else if(r===19789)o=!1;else throw new Error("unexpected endianess byte");const s=e.getUint16(2,o);if(s!==42&&s!==43)throw new Error("unexpected tiff identifier");let a=4;const u=s===43;if(u){const n=e.getUint16(a,o);if(a+=2,n!==8)throw new Error("unsupported bigtiff version");if(e.getUint16(a,o)!==0)throw new Error("unsupported bigtiff version");a+=2}const i=He(e,a,o,u);return{littleEndian:o,isBigTiff:u,firstIFDPos:i}}function zr(t,e,r,o=0,s=Ee.TIFF_TAGS,a=4){const u=tt(t,e,r,o,s,a);let i;const n=u.ifd;if(n){if(Ee.ifdTags.forEach((l,c)=>{n.has(c)&&(i=n.get(c),i.data=tt(t,e,i.valueOffset-o,o,l).ifd)}),n.has("GEOKEYDIRECTORY")){i=n.get("GEOKEYDIRECTORY");const l=i.values;if(l&&l.length>4){const c=l[0]+"."+l[1]+"."+l[2];i.data=tt(t,e,i.valueOffset+6-o,o,Ee.GEO_KEYS,2).ifd,i.data&&i.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[c]})}}if(n.has("XMP")){i=n.get("XMP");const l=i.values;typeof l[0]=="number"&&i.type===7&&(i.values=[Ir(new Uint8Array(l))])}}return u}function qt(t){const{width:e,height:r,tileHeight:o,tileWidth:s}=t,a=t.planes,u=s?s*o:e*r,i=H(t.ifds[0],"BITSPERSAMPLE"),n=u*a;let l="";return n>2**30/(i>8?i/8:1)&&(l=s?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),l}async function jr(t,e){const{headerInfo:r,ifd:o,offsets:s,sizes:a}=e,u=[];for(let k=0;k<s.length;k++){const R=await at(t,r.littleEndian,o,s[k],a[k]||t.byteLength);u.push(R)}const i=vt(o,r),n=H(o,"BITSPERSAMPLE"),l=H(o,"SAMPLEFORMAT")??1,c=yt(l,n),h=H(o,"SAMPLESPERPIXEL")||r.planes,f=Je(c),d=H(o,"TILEWIDTH"),p=H(o,"TILELENGTH"),m=H(o,"COMPRESSION")??1,b=d*p;let y;const g=[];let C=u[0];const T=m===34887;for(let k=0;k<h;k++){if(y=new f(b),i&&T){if(C=u[k],C.length)for(let R=0;R<b;R++)y[R]=C[R+k]}else if(C.length)if(i||T&&!i)y=C.slice(b*k,b*(k+1));else for(let R=0;R<b;R++)y[R]=C[R*h+k];g.push(y)}const x=r.noData?r.noData[0]:e.noDataValue,S=r.metadata?r.metadata.statistics:null,A=S?S.map(k=>k.min):null,w=S?S.map(k=>k.max):null,v={pixelType:c,width:d,height:p,pixels:g,noDataValue:x};return x!=null?dt(v,x):A&&w&&e.applyMinMaxConstraint&&(v.mask=Gr(g,A,w)),v}async function Wr(t,e={}){const r=e.pyramidLevel||0,o=e.headerInfo||Or(t),{ifds:s,noData:a}=o;if(s.length===0)throw new Error("no valid image file directory");const u=qt(o);if(u)throw u;let i=null;const n=r===-1?s[s.length-1]:s[r],l=a??e.noDataValue;return o.tileWidth?i=await Fr(t,o,n):i=await Mr(t,o,n),i&&(l!=null&&dt(i,l),i)}var Yr=function(t){var e,r,o,s,a,u;i.load=function(n,l,c){var h;return typeof l=="function"&&(c=l),h=new XMLHttpRequest,h.open("GET",n,!0),h.responseType="arraybuffer",h.onload=function(){var f,d;return f=new Uint8Array(h.response||h.mozResponseArrayBuffer),d=new i(f),typeof(l!=null?l.getContext:void 0)=="function"&&d.render(l),typeof c=="function"?c(d):void 0},h.send(null)},r=1,o=2,e=0;function i(n){var l,c,h,f,d,p,m,b,y,g,C,T,x;for(this.data=n,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},d=null;;){switch(l=this.readUInt32(),b=function(){var S,A;for(A=[],S=0;S<4;++S)A.push(String.fromCharCode(this.data[this.pos++]));return A}.call(this).join(""),b){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(l);break;case"fcTL":d&&this.animation.frames.push(d),this.pos+=4,d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},f=this.readUInt16(),h=this.readUInt16()||100,d.delay=1e3*f/h,d.disposeOp=this.data[this.pos++],d.blendOp=this.data[this.pos++],d.data=[];break;case"IDAT":case"fdAT":for(b==="fdAT"&&(this.pos+=4,l-=4),n=(d!=null?d.data:void 0)||this.imgData,C=0;0<=l?C<l:C>l;0<=l?++C:--C)n.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(l),y=255-this.transparency.indexed.length,y>0)for(T=0;0<=y?T<y:T>y;0<=y?++T:--T)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(l)[0];break;case 2:this.transparency.rgb=this.read(l)}break;case"tEXt":g=this.read(l),p=g.indexOf(0),m=String.fromCharCode.apply(String,g.slice(0,p)),this.text[m]=String.fromCharCode.apply(String,g.slice(p+1));break;case"IEND":d&&this.animation.frames.push(d),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(x=this.colorType)===4||x===6,c=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*c,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=l}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return i.prototype.read=function(n){var l,c;for(c=[],l=0;0<=n?l<n:l>n;0<=n?++l:--l)c.push(this.data[this.pos++]);return c},i.prototype.readUInt32=function(){var n,l,c,h;return n=this.data[this.pos++]<<24,l=this.data[this.pos++]<<16,c=this.data[this.pos++]<<8,h=this.data[this.pos++],n|l|c|h},i.prototype.readUInt16=function(){var n,l;return n=this.data[this.pos++]<<8,l=this.data[this.pos++],n|l},i.prototype.decodePixels=function(n){var l,c,h,f,d,p,m,b,y,g,C,T,x,S,A,w,v,k,R,I,P,L,_;if(n==null&&(n=this.imgData),n.length===0)return new Uint8Array(0);for(n=new Ae(n),n=n.getBytes(),T=this.pixelBitlength/8,w=T*this.width,x=new Uint8Array(w*this.height),p=n.length,A=0,S=0,c=0;S<p;){switch(n[S++]){case 0:for(f=R=0;R<w;f=R+=1)x[c++]=n[S++];break;case 1:for(f=I=0;I<w;f=I+=1)l=n[S++],d=f<T?0:x[c-T],x[c++]=(l+d)%256;break;case 2:for(f=P=0;P<w;f=P+=1)l=n[S++],h=(f-f%T)/T,v=A&&x[(A-1)*w+h*T+f%T],x[c++]=(v+l)%256;break;case 3:for(f=L=0;L<w;f=L+=1)l=n[S++],h=(f-f%T)/T,d=f<T?0:x[c-T],v=A&&x[(A-1)*w+h*T+f%T],x[c++]=(l+Math.floor((d+v)/2))%256;break;case 4:for(f=_=0;_<w;f=_+=1)l=n[S++],h=(f-f%T)/T,d=f<T?0:x[c-T],A===0?v=k=0:(v=x[(A-1)*w+h*T+f%T],k=h&&x[(A-1)*w+(h-1)*T+f%T]),m=d+v-k,b=Math.abs(m-d),g=Math.abs(m-v),C=Math.abs(m-k),b<=g&&b<=C?y=d:g<=C?y=v:y=k,x[c++]=(l+y)%256;break;default:throw new Error("Invalid filter algorithm: "+n[S-1])}A++}return x},i.prototype.decodePalette=function(){var n,l,c,h,f,d,p,m,b;for(c=this.palette,d=this.transparency.indexed||[],f=new Uint8Array((d.length||0)+c.length),h=0,c.length,n=0,l=p=0,m=c.length;p<m;l=p+=3)f[h++]=c[l],f[h++]=c[l+1],f[h++]=c[l+2],f[h++]=(b=d[n++])!=null?b:255;return f},i.prototype.copyToImageData=function(n,l){var c,h,f,d,p,m,b,y,g,C,T;if(h=this.colors,g=null,c=this.hasAlphaChannel,this.palette.length&&(g=(T=this._decodedPalette)!=null?T:this._decodedPalette=this.decodePalette(),h=4,c=!0),f=n.data||n,y=f.length,p=g||l,d=m=0,h===1)for(;d<y;)b=g?l[d/4]*4:m,C=p[b++],f[d++]=C,f[d++]=C,f[d++]=C,f[d++]=c?p[b++]:this.transparency.grayscale&&this.transparency.grayscale===C?0:255,m=b;else for(;d<y;)b=g?l[d/4]*4:m,f[d++]=p[b++],f[d++]=p[b++],f[d++]=p[b++],f[d++]=c?p[b++]:this.transparency.rgb&&this.transparency.rgb[1]===p[b-3]&&this.transparency.rgb[3]===p[b-2]&&this.transparency.rgb[5]===p[b-1]?0:255,m=b},i.prototype.decode=function(){var n;return n=new Uint8Array(this.width*this.height*4),this.copyToImageData(n,this.decodePixels()),n},a=t.document&&t.document.createElement("canvas"),u=a&&a.getContext("2d"),s=function(n){var l;return u.width=n.width,u.height=n.height,u.clearRect(0,0,n.width,n.height),u.putImageData(n,0,0),l=new Image,l.src=a.toDataURL(),l},i.prototype.decodeFrames=function(n){var l,c,h,f,d,p,m,b;if(this.animation){for(m=this.animation.frames,b=[],c=d=0,p=m.length;d<p;c=++d)l=m[c],h=n.createImageData(l.width,l.height),f=this.decodePixels(new Uint8Array(l.data)),this.copyToImageData(h,f),l.imageData=h,b.push(l.image=s(h));return b}},i.prototype.renderFrame=function(n,l){var c,h,f;return h=this.animation.frames,c=h[l],f=h[l-1],l===0&&n.clearRect(0,0,this.width,this.height),(f!=null?f.disposeOp:void 0)===r?n.clearRect(f.xOffset,f.yOffset,f.width,f.height):(f!=null?f.disposeOp:void 0)===o&&n.putImageData(f.imageData,f.xOffset,f.yOffset),c.blendOp===e&&n.clearRect(c.xOffset,c.yOffset,c.width,c.height),n.drawImage(c.image,c.xOffset,c.yOffset)},i.prototype.animate=function(n){var l,c,h,f,d,p,m=this;return c=0,p=this.animation,f=p.numFrames,h=p.frames,d=p.numPlays,(l=function(){var b,y;if(b=c++%f,y=h[b],m.renderFrame(n,b),f>1&&c/f<d)return m.animation._timeout=setTimeout(l,y.delay)})()},i.prototype.stopAnimation=function(){var n;return clearTimeout((n=this.animation)!=null?n._timeout:void 0)},i.prototype.render=function(n){var l,c;return n._png&&n._png.stopAnimation(),n._png=this,n.width=this.width,n.height=this.height,l=n.getContext("2d"),this.animation?(this.decodeFrames(l),this.animate(l)):(c=l.createImageData(this.width,this.height),this.copyToImageData(c,this.decodePixels()),l.putImageData(c,0,0))},i}(self);const Hr=new Set(["jpg","png","bmp","gif"]);async function Kr(t,e){if(!xt)throw new ye("rasterCoded:decode","lerc decoder is not supported on big endian platform");await zt();const{offset:r}=e,{width:o,height:s,pixelType:a,statistics:u,depthCount:i,noDataValues:n,bandMasks:l,pixels:c,mask:h}=jt(t,{inputOffset:r,returnInterleaved:e.returnInterleaved});return new se({width:o,height:s,pixelType:a.toLowerCase(),pixels:c,mask:h,statistics:u,bandMasks:l,depthCount:i,noDataValues:n})}async function qr(t,e){const r=await Wr(t,{...e,noDataValue:null});Ye(r);const o=new se({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return o.updateStatistics(),o}async function Xr(t,e){const r=await jr(t,e.customOptions),o=new se({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return o.updateStatistics(),o}function Xt(t,e){const r=e.pixelType||"u8",o=se.getPixelArrayConstructor(r),s=r==="u8"?t:new o(t.buffer),a=[],u=e.planes||1;if(u===1)a.push(s);else for(let n=0;n<u;n++){const l=e.width||1,c=e.height||t.length,h=l*c,f=new o(h);for(let d=0;d<h;d++)f[d]=s[d*u+n];a.push(f)}const i=new se({width:e.width||1,height:e.height||t.length,pixels:a,pixelType:r,statistics:null});return i.updateStatistics(),i}function Jr(t,e){const o=new Ae(new Uint8Array(t)).getBytes();return Xt(o,e)}function $r(t,e){const r=pt(t,e.offset,e.eof,!e.isInputBigEndian);return Xt(r,e)}function Zr(t,e,r){const{pixelTypeCtor:o}=oo(e.pixelType),s=Ar.decode,a=s(t,{width:e.width,height:e.height,pixelType:o,format:r}),u=new se({width:e.width,height:e.height,pixels:a.pixels,pixelType:e.pixelType,mask:a.mask,statistics:null});return u.updateStatistics(),u}function Qr(t,e){const r=Cr.decode(t,e.hasNoZlibMask??void 0),o=new se({width:r.width,height:r.height,pixels:r.pixels,pixelType:"U8",mask:r.mask,statistics:null});return o.updateStatistics(),o}function eo(t,e){const r=new Uint8Array(t),o=new Yr(r),{width:s,height:a}=e,u=s*a,i=o.decode();let n=0,l=0,c;const h=new Uint8Array(u);for(n=0;n<u;n++)h[n]=i[n*4+3];const f=new se({width:s,height:a,pixels:[],pixelType:"U8",mask:h,statistics:[]});for(n=0;n<3;n++){for(c=new Uint8Array(u),l=0;l<u;l++)c[l]=i[l*4+n];f.addData({pixels:c})}return f.updateStatistics(),f}async function to(t,e,r,o){const s=new ht,a={applyJpegMask:!1,format:e,...r},u=await s.decode(t,a,o),i=new se(u);return i.updateStatistics(),i}function Jt(t){if(t==null)throw new ye("rasterCodec:decode","parameter encodeddata is required.");const e=new Uint8Array(t,0,10);let r="";return e[0]===255&&e[1]===216?r="jpg":e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71?r="png":e[0]===67&&e[1]===110&&e[2]===116&&e[3]===90&&e[4]===73&&e[5]===109&&e[6]===97&&e[7]===103&&e[8]===101&&e[9]===32?r="lerc":e[0]===76&&e[1]===101&&e[2]===114&&e[3]===99&&e[4]===50&&e[5]===32?r="lerc2":e[0]===73&&e[1]===73&&e[2]===42&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===42||e[0]===73&&e[1]===73&&e[2]===43&&e[3]===0||e[0]===77&&e[1]===77&&e[2]===0&&e[3]===43?r="tiff":e[0]===71&&e[1]===73&&e[2]===70?r="gif":e[0]===66&&e[1]===77?r="bmp":String.fromCharCode.apply(null,e).toLowerCase().includes("error")&&(r="error"),r}function ro(t){let e=null;switch(t){case"lerc":case"lerc2":e=Kr;break;case"jpg":e=Qr;break;case"png":e=eo;break;case"bsq":case"bip":e=(r,o)=>Zr(r,o,t);break;case"tiff":e=qr;break;case"deflate":e=Jr;break;case"lzw":e=$r;break;case"error":e=()=>{throw new ye("rasterCodec:decode","input data contains error")};break;default:e=()=>{throw new ye("rasterCodec:decode","unsupported raster format")}}return e}function oo(t){const e=t?t.toLowerCase():"f32";let r=null,o=null;switch(e){case"u1":case"u2":case"u4":case"u8":o=2**8-1,r=Uint8Array;break;case"u16":o=o||2**16-1,r=Uint16Array;break;case"u32":o=o||2**32-1,r=Uint32Array;break;case"s8":o=o||0-2**7,r=Int8Array;break;case"s16":o=o||0-2**15,r=Int16Array;break;case"s32":o=o||0-2**31,r=Int32Array;break;default:r=Float32Array}return{pixelTypeCtor:r,noDataValue:o}}function no(t,e=1){if(!t)return;const{pixels:r,width:o,height:s,mask:a}=t;if(!r||r.length===0)return;const u=r.length,i=o-1,n=s-1,l=[];let c,h,f,d,p,m,b=null;const y=se.getPixelArrayConstructor(t.pixelType);if(e===0){for(c=0;c<u;c++){for(p=r[c],m=new y(i*n),h=0;h<n;h++)for(d=h*o,f=0;f<i;f++)m[h*i+f]=p[d+f];l.push(m)}if(a!=null)for(b=new Uint8Array(i*n),h=0;h<n;h++)for(d=h*o,f=0;f<i;f++)b[h*i+f]=a[d+f]}else{for(c=0;c<u;c++){for(p=r[c],m=new y(i*n),h=0;h<n;h++)for(d=h*o,f=0;f<i;f++)m[h*i+f]=(p[d+f]+p[d+f+1]+p[d+o+f]+p[d+o+f+1])/4;l.push(m)}if(a)for(b=new Uint8Array(i*n),h=0;h<n;h++)for(d=h*o,f=0;f<i;f++)b[h*i+f]=Math.min.apply(null,[a[d+f],a[d+f+1],a[d+o+f],a[d+o+f+1]])}t.width=i,t.height=n,t.mask=b,t.pixels=l}function Lo(t){let e=Jt(t);return e==="lerc2"?e="lerc":e==="error"&&(e=""),e}async function Fo(t,e={},r){if(t==null)throw new ye("rasterCodec:decode","missing encodeddata parameter.");let o=e.format&&e.format.toLowerCase();if((o==="bsq"||o==="bip")&&(e.width==null||e.height==null))throw new ye("rasterCodec:decode","requires width and height in options parameter.");if(o==="tiff"&&e.customOptions)return Xr(t,e);if((!o||o!=="bsq"&&o!=="bip"&&o!=="deflate"&&o!=="lzw")&&(o=Jt(t)),e.useCanvas&&Hr.has(o))return to(t,o,e,r);const s=ro(o);e.isPoint&&(e={...e},e.width!=null&&e.width++,e.height!=null&&e.height++);const a=await s(t,e);return a&&(o!=="jpg"&&e.noDataValue!=null&&a.depthCount===1&&dt(a,e.noDataValue,{customFloatTolerance:e.tolerance}),e.isPoint&&no(a),a)}var lt;function ke(t){return t=Number(t),isNaN(t)?void 0:t}let ue=lt=class extends Oe{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}clone(){return new lt({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};M([O({json:{name:"BandName",write:!0}})],ue.prototype,"name",void 0);M([O({json:{name:"WavelengthMin",read:{reader:ke},write:!0}})],ue.prototype,"minWavelength",void 0);M([O({json:{name:"WavelengthMax",read:{reader:ke},write:!0}})],ue.prototype,"maxWavelength",void 0);M([O({json:{name:"RadianceBias",read:{reader:ke},write:!0}})],ue.prototype,"radianceBias",void 0);M([O({json:{name:"RadianceGain",read:{reader:ke},write:!0}})],ue.prototype,"radianceGain",void 0);M([O({json:{name:"ReflectanceBias",read:{reader:ke},write:!0}})],ue.prototype,"reflectanceBias",void 0);M([O({json:{name:"ReflectanceGain",read:{reader:ke},write:!0}})],ue.prototype,"reflectanceGain",void 0);M([O({json:{name:"SolarIrradiance",read:{reader:ke},write:!0}})],ue.prototype,"solarIrradiance",void 0);ue=lt=M([Ue("esri.layers.support.RasterBandInfo")],ue);const Lt=ue;var ct;function Ne(t){return t=Number(t),isNaN(t)?void 0:t}let le=ct=class extends Oe{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(e){return new Date(e)}writeAcquisitionDate(e,r){r.AcquisitionDate=e.getTime()}clone(){return new ct({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};M([O({json:{name:"AcquisitionDate",write:!0}})],le.prototype,"acquisitionDate",void 0);M([ur("acquisitionDate")],le.prototype,"readAcquisitionDate",null);M([fr("acquisitionDate")],le.prototype,"writeAcquisitionDate",null);M([O({json:{name:"CloudCover",read:{reader:Ne},write:!0}})],le.prototype,"cloudCover",void 0);M([O({json:{name:"ProductName",write:!0}})],le.prototype,"productName",void 0);M([O({json:{name:"SensorName",write:!0}})],le.prototype,"sensorName",void 0);M([O({json:{name:"SensorAzimuth",read:{reader:Ne},write:!0}})],le.prototype,"sensorAzimuth",void 0);M([O({json:{name:"SensorElevation",read:{reader:Ne},write:!0}})],le.prototype,"sensorElevation",void 0);M([O({json:{name:"SunAzimuth",read:{reader:Ne},write:!0}})],le.prototype,"sunAzimuth",void 0);M([O({json:{name:"SunElevation",read:{reader:Ne},write:!0}})],le.prototype,"sunElevation",void 0);le=ct=M([Ue("esri.layers.support.RasterSensorInfo")],le);const io=le;var ut;let oe=ut=class extends Oe{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new ut({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:re(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:re(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:re(this.tileInfo),transposeInfo:re(this.transposeInfo),blockBoundary:re(this.blockBoundary)})}};M([O({type:Number,json:{write:!0}})],oe.prototype,"blockWidth",void 0);M([O({type:Number,json:{write:!0}})],oe.prototype,"blockHeight",void 0);M([O({type:String,json:{write:!0}})],oe.prototype,"compression",void 0);M([O({type:dr,json:{write:!0}})],oe.prototype,"origin",void 0);M([O({type:Number,json:{write:!0}})],oe.prototype,"firstPyramidLevel",void 0);M([O({type:Number,json:{write:!0}})],oe.prototype,"maximumPyramidLevel",void 0);M([O({json:{write:!0}})],oe.prototype,"pyramidResolutions",void 0);M([O({type:Number,json:{write:!0}})],oe.prototype,"pyramidScalingFactor",void 0);M([O({type:Number,json:{write:!0}})],oe.prototype,"pyramidBlockWidth",void 0);M([O({type:Number,json:{write:!0}})],oe.prototype,"pyramidBlockHeight",void 0);M([O({type:Boolean,json:{write:!0}})],oe.prototype,"isVirtualTileInfo",void 0);M([O({json:{write:!0}})],oe.prototype,"tileInfo",void 0);M([O()],oe.prototype,"transposeInfo",void 0);M([O()],oe.prototype,"blockBoundary",void 0);oe=ut=M([Ue("esri.layers.support.RasterStorageInfo")],oe);const so=oe;var ft;let $=ft=class extends Oe{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){const e=this.keyProperties.BandProperties;if(!(e!=null&&e.length)){const o=[];for(let s=1;s<=this.bandCount;s++)o.push(new Lt({name:"band_"+s}));return o}const r=e.map(o=>Lt.fromJSON(o));for(let o=0;o<r.length;o++)r[o].name=r[o].name??"band_"+(o+1);return r}get dataType(){var r,o;const e=((o=(r=this.keyProperties)==null?void 0:r.DataType)==null?void 0:o.toLowerCase())??"generic";return e==="stdtime"?"standard-time":e}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(e){e&&this._set("nativeExtent",e)}get nativePixelSize(){if(this.transform==null||!this.transform.affectsPixelSize)return this.pixelSize;const e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}get hasMultidimensionalTranspose(){var e;return!!((e=this.storageInfo)!=null&&e.transposeInfo)}get sensorInfo(){var e;if((e=this.keyProperties)!=null&&e.SensorName)return io.fromJSON(this.keyProperties)}clone(){return new ft({attributeTable:re(this.attributeTable),bandCount:this.bandCount,colormap:re(this.colormap),extent:re(this.extent),nativePixelSize:re(this.nativePixelSize),format:this.format,height:this.height,width:this.width,histograms:re(this.histograms),keyProperties:re(this.keyProperties),multidimensionalInfo:re(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:re(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:re(this.spatialReference),statistics:re(this.statistics),storageInfo:re(this.storageInfo),transform:re(this.transform)})}};M([O({json:{write:!0}})],$.prototype,"attributeTable",void 0);M([O({json:{write:!0}})],$.prototype,"bandCount",void 0);M([O({readOnly:!0})],$.prototype,"bandInfos",null);M([O({json:{write:!0}})],$.prototype,"colormap",void 0);M([O({type:String,readOnly:!0})],$.prototype,"dataType",null);M([O({type:Ot,json:{write:!0}})],$.prototype,"extent",void 0);M([O({type:Ot,json:{write:!0}})],$.prototype,"nativeExtent",null);M([O({json:{write:!0}})],$.prototype,"nativePixelSize",null);M([O({json:{write:!0}})],$.prototype,"format",void 0);M([O({json:{write:!0}})],$.prototype,"height",void 0);M([O({json:{write:!0}})],$.prototype,"width",void 0);M([O({json:{write:!0}})],$.prototype,"hasMultidimensionalTranspose",null);M([O({json:{write:!0}})],$.prototype,"histograms",void 0);M([O({json:{write:!0}})],$.prototype,"keyProperties",void 0);M([O({json:{write:!0}})],$.prototype,"multidimensionalInfo",void 0);M([O({json:{write:!0}})],$.prototype,"noDataValue",void 0);M([O({json:{write:!0}})],$.prototype,"pixelSize",void 0);M([O({json:{write:!0}})],$.prototype,"pixelType",void 0);M([O()],$.prototype,"isPseudoSpatialReference",void 0);M([O({readOnly:!0})],$.prototype,"sensorInfo",null);M([O({type:hr,json:{write:!0}})],$.prototype,"spatialReference",void 0);M([O({json:{write:!0}})],$.prototype,"statistics",void 0);M([O({type:so,json:{write:!0}})],$.prototype,"storageInfo",void 0);M([O({json:{write:!0}})],$.prototype,"transform",void 0);$=ft=M([Ue("esri.layers.support.RasterInfo")],$);const ao=$,ie=1,Pe=1/111e3;function $t(t){let{altitude:e,azimuth:r}=t;const{hillshadeType:o,pixelSizePower:s=1,pixelSizeFactor:a=1,scalingType:u,isGCS:i,resolution:n}=t,l=o==="multi-directional"?t.zFactor*2:t.zFactor,{x:c,y:h}=n;let f=l/(8*c),d=l/(8*h);if(i&&l>.001&&(f/=Pe,d/=Pe),u==="adjusted")if(i){const I=c*Pe,P=h*Pe;f=(l+I**s*a)/(8*I),d=(l+P**s*a)/(8*P)}else f=(l+c**s*a)/(8*c),d=(l+h**s*a)/(8*h);let p=(90-e)*Math.PI/180,m=Math.cos(p),b=(360-r+90)*Math.PI/180,y=Math.sin(p)*Math.cos(b),g=Math.sin(p)*Math.sin(b);const C=[315,270,225,360,180,0],T=[60,60,60,60,60,90],x=new Float32Array([3,5,3,2,1,4]),S=x.reduce((I,P)=>I+P),A=x.map(I=>I/S),w=o==="multi-directional"?C.length:1,v=new Float32Array(6),k=new Float32Array(6),R=new Float32Array(6);if(o==="multi-directional")for(let I=0;I<w;I++)e=T[I],r=C[I],p=(90-e)*Math.PI/180,m=Math.cos(p),b=(360-r+90)*Math.PI/180,y=Math.sin(p)*Math.cos(b),g=Math.sin(p)*Math.sin(b),v[I]=m,k[I]=y,R[I]=g;else v.fill(m),k.fill(y),R.fill(g);return{resolution:n,factor:[f,d],sinZcosA:y,sinZsinA:g,cosZ:m,sinZcosAs:k,sinZsinAs:R,cosZs:v,weights:A,hillshadeType:["traditional","multi-directional"].indexOf(o)}}function $e(t,e){const{width:r,height:o,mask:s}=t,a=new Uint8Array(r*o),u=s!=null;if(u)for(let x=0;x<s.length;x++)s[x]&&(a[x]=1);const i=t.pixels[0],n=new Float32Array(r*o),l=new Float32Array(r*o);let c=0,h;if(e){const{resolution:x}=e,S=x?(x.x+x.y)/2:1;c=200*e.zFactor/(S*S),h=new Float32Array(r*o)}const f=e==null?void 0:e.curvatureType;let d,p,m,b,y,g,C,T;for(let x=ie;x<o-ie;x++){const S=x*r;for(let A=ie;A<r-ie;A++){const w=S+A;if(!(u&&s[w]===0)){if(u){if(s[w-r-1]+s[w-r]+s[w-r+1]+s[w-1]+s[w+1]+s[w+r-1]+s[w+r]+s[w+r+1]<7){a[w]=0;continue}d=s[w-r-1]?i[w-r-1]:i[w],p=s[w-r]?i[w-r]:i[w],m=s[w-r+1]?i[w-r+1]:i[w],b=s[w-1]?i[w-1]:i[w],y=s[w+1]?i[w+1]:i[w],g=s[w+r-1]?i[w+r-1]:i[w],C=s[w+r]?i[w+r]:i[w],T=s[w+r+1]?i[w+r+1]:i[w]}else d=i[w-r-1],p=i[w-r],m=i[w-r+1],b=i[w-1],y=i[w+1],g=i[w+r-1],C=i[w+r],T=i[w+r+1];if(n[w]=m+y+y+T-(d+b+b+g),l[w]=g+C+C+T-(d+p+p+m),h!=null){const v=i[w],k=(b+y)*.5-v,R=(p+C)*.5-v;if(f==="standard")h[w]=-c*(k+R);else{const I=(-d+m+g-T)/4,P=(-b+y)/2,L=(p-C)/2,_=P*P,D=L*L,N=_+D;N&&(f==="profile"?h[w]=c*(k*_+R*D+I*P*L)/N:h[w]=-c*(k*D+R*_-I*P*L)/N)}}}}}return{outMask:u?a:null,dzxs:n,dzys:l,curvatures:h}}function Ze(t,e,r){for(let o=0;o<r;o++)t[o*e]=t[o*e+1],t[(o+1)*e-1]=t[(o+1)*e-2];for(let o=1;o<e-1;o++)t[o]=t[o+e],t[o+(r-1)*e]=t[o+(r-2)*e]}function lo(t,e){if(!Se(t))return t;const{factor:r,sinZcosA:o,sinZsinA:s,cosZ:a,sinZcosAs:u,sinZsinAs:i,cosZs:n,weights:l}=$t(e),[c,h]=r,f=e.hillshadeType==="traditional",{width:d,height:p}=t,m=new Uint8Array(d*p),{dzxs:b,dzys:y,outMask:g}=$e(t);for(let T=ie;T<p-ie;T++){const x=T*d;for(let S=ie;S<d-ie;S++){const A=x+S;if(!g||g[A]){const w=b[A]*c,v=y[A]*h,k=Math.sqrt(1+w*w+v*v);let R=0;if(f){let I=255*(a+s*v-o*w)/k;I<0&&(I=0),R=I}else{const I=i.length;for(let P=0;P<I;P++){let L=255*(n[P]+i[P]*v-u[P]*w)/k;L<0&&(L=0),R+=L*l[P]}}m[A]=R&255}}}return Ze(m,d,p),new se({width:d,height:p,pixels:[m],mask:g,pixelType:"u8",validPixelCount:t.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function co(t,e,r,o){if(!Se(t)||!Se(e))return;const{min:s,max:a}=o,u=t.pixels[0],{pixels:i,mask:n}=e,l=i[0],c=255.00001/(a-s),h=new Uint8ClampedArray(l.length),f=new Uint8ClampedArray(l.length),d=new Uint8ClampedArray(l.length),p=r.length-1;for(let m=0;m<l.length;m++){if(n&&n[m]===0)continue;const b=Math.floor((l[m]-s)*c),[y,g]=r[b<0?0:b>p?p:b],C=u[m],T=C*g,x=T*(1-Math.abs(y%2-1)),S=Math.floor(y),A=C-T;switch(S){case 0:h[m]=T+A,f[m]=x+A,d[m]=A;break;case 1:h[m]=x+A,f[m]=T+A,d[m]=A;break;case 2:h[m]=A,f[m]=T+A,d[m]=x+A;break;case 3:h[m]=A,f[m]=x+A,d[m]=T+A;break;case 4:h[m]=x+A,f[m]=A,d[m]=T+A;break;case 5:case 6:h[m]=T+A,f[m]=A,d[m]=x+A;break}}t.pixels=[h,f,d],t.updateStatistics()}function Oo(t,e){if(!Se(t))return t;const r=e.zFactor,o=e.pixelSizePower??1,s=e.pixelSizeFactor??1,a=e.slopeType,u=e.isGCS,{x:i,y:n}=e.resolution;let l=r/(8*i),c=r/(8*n);u&&Math.abs(r-1)<1e-4&&(l/=Pe,c/=Pe),a==="adjusted"&&(l=(r+i**o*s)/(8*i),c=(r+n**o*s)/(8*n));const{dzxs:h,dzys:f,outMask:d}=$e(t),{width:p,height:m}=t,b=new Float32Array(p*m);for(let g=ie;g<m-ie;g++){const C=g*p;for(let T=ie;T<p-ie;T++){const x=C+T;if(!d||d[x]){const S=h[x]*l,A=f[x]*c,w=Math.sqrt(S*S+A*A);a==="percent-rise"?b[C+T]=w*100:b[C+T]=Math.atan(w)*57.2957795}}}Ze(b,p,m);const y=new se({width:p,height:m,pixels:[b],mask:d,pixelType:"f32",validPixelCount:t.validPixelCount});return y.updateStatistics(),y}function No(t,e={}){if(!Se(t))return t;const{resolution:r}=e,o=r?1/r.x:1,s=r?1/r.y:1,{dzxs:a,dzys:u,outMask:i}=$e(t),{width:n,height:l}=t,c=new Float32Array(n*l);for(let f=ie;f<l-ie;f++){const d=f*n;for(let p=ie;p<n-ie;p++){const m=d+p;if(!i||i[m]){const b=a[m]*o,y=u[m]*s;let g=-1;(b!==0||y!==0)&&(g=90-57.29578*Math.atan2(y,-b),g<0&&(g+=360),g===360?g=0:g>360&&(g=g%360)),c[d+p]=g}}}return Ze(c,n,l),new se({width:n,height:l,pixels:[c],mask:i,pixelType:"f32",validPixelCount:t.validPixelCount,statistics:[{minValue:-1,maxValue:360}]})}function Vo(t,e){if(!Se(t))return t;const{curvatures:r,outMask:o}=$e(t,e),{width:s,height:a}=t;Ze(r,s,a);const u=new se({width:s,height:a,pixels:[r],mask:o,pixelType:"f32",validPixelCount:t.validPixelCount});return u.updateStatistics(),u}const zo=["random","ndvi","ndvi2","ndvi3","elevation","gray","hillshade"],Zt=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}],Qt={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"},uo=new Nt({Aspect:"aspect","Black to White":"black-to-white","Blue Bright":"blue-bright","Blue Light to Dark":"blue-light-to-dark","Blue-Green Bright":"blue-green-bright","Blue-Green Light to Dark":"blue-green-light-to-dark","Brown Light to Dark":"brown-light-to-dark","Brown to Blue Green Diverging, Bright":"brown-to-blue-green-diverging-right","Brown to Blue Green Diverging, Dark":"brown-to-blue-green-diverging-dark","Coefficient Bias":"coefficient-bias","Cold to Hot Diverging":"cold-to-hot-diverging","Condition Number":"condition-number","Cyan to Purple":"cyan-to-purple","Cyan-Light to Blue-Dark":"cyan-light-to-blue-dark",Distance:"distance","Elevation #1":"elevation1","Elevation #2":"elevation2",Errors:"errors","Gray Light to Dark":"gray-light-to-dark","Green Bright":"green-bright","Green Light to Dark":"green-light-to-dark","Green to Blue":"green-to-blue","Orange Bright":"orange-bright","Orange Light to Dark":"orange-light-to-dark","Partial Spectrum":"partial-spectrum","Partial Spectrum 1 Diverging":"partial-spectrum-1-diverging","Partial Spectrum 2 Diverging":"partial-spectrum-2-diverging","Pink to YellowGreen Diverging, Bright":"pink-to-yellow-green-diverging-bright","Pink to YellowGreen Diverging, Dark":"pink-to-yellow-green-diverging-dark",Precipitation:"precipitation",Prediction:"prediction","urple Bright":"purple-bright","Purple to Green Diverging, Bright":"purple-to-green-diverging-bright","Purple to Green Diverging, Dark":"purple-to-green-diverging-dark","Purple-Blue Bright":"purple-blue-bright","Purple-Blue Light to Dark":"purple-blue-light-to-dark","Purple-Red Bright":"purple-red-bright","Purple-Red Light to Dark":"purple-red-light-to-dark","Red Bright":"red-bright","Red Light to Dark":"red-light-to-dark","Red to Blue Diverging, Bright":"red-to-blue-diverging-bright","Red to Blue Diverging, Dark":"red-to-blue-diverging-dark","Red to Green":"red-to-green","Red to Green Diverging, Bright":"red-to-green-diverging-bright","Red to Green Diverging, Dark":"red-to-green-diverging-dark",Slope:"slope","Spectrum-Full Bright":"spectrum-full-bright","Spectrum-Full Dark":"spectrum-full-dark","Spectrum-Full Light":"spectrum-full-light",Surface:"surface",Temperature:"temperature","White to Black":"white-to-black","Yellow to Dark Red":"yellow-to-dark-red","Yellow to Green to Dark Blue":"yellow-to-green-to-dark-blue","Yellow to Red":"yellow-to-red","Yellow-Green Bright":"yellow-green-bright","Yellow-Green Light to Dark":"yellow-green-light-to-dark"});function We(t,e){if(!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]>e[r]+2||t[r]<e[r]-2)return!1;return!0}function fo(t,e){if(!t)return;const r=e??Zt;let o=null;return t.type==="algorithmic"?r.some(s=>{if(We(t.fromColor.toRgb(),s.fromColor)&&We(t.toColor.toRgb(),s.toColor))return o=s.id,!0}):t.type==="multipart"&&r.some(s=>{const a=t.colorRamps,u=s.colorRamps;if(a&&u&&a.length===u.length&&!u.some((i,n)=>{if(!We(a[n].fromColor.toRgb(),new wt(i.fromColor).toRgb())||!We(a[n].toColor.toRgb(),new wt(i.toColor).toRgb()))return!0})){if(o)return!0;o=s.id}}),o}function ho(t){const e=fo(t);return e?Qt[e]:null}function jo(t){var s;const e=uo.toJSON(t),r=(s=Object.entries(Qt).find(a=>a[1]===e))==null?void 0:s[0],o=Zt.find(a=>a.id===r);return o?o.colorRamps?{type:"multipart",colorRamps:o.colorRamps.map(a=>({type:"algorithmic",algorithm:"esriCIELabAlgorithm",fromColor:a.fromColor,toColor:a.toColor}))}:{type:"algorithmic",algorithm:"esriCIELabAlgorithm",fromColor:o.fromColor,toColor:o.toColor}:null}function er(t){t=t||{};const e=t.numColors||256,r=t.distanceOffset||0,o=t.isCustomInterval!=null?t.isCustomInterval:t.distanceInterval!==null&&t.distanceInterval!==1/(e-1),s=t.distanceInterval||1/(e-1);return{...t,numColors:e,distanceOffset:r,interpolateAlpha:!!t.interpolateAlpha,distanceInterval:s,isCustomInterval:o,weights:t.weights}}function po(t,e,r){const{numColors:o,distanceOffset:s,distanceInterval:a,isCustomInterval:u}=r,i=t.s===0,n=e.s===0;let l=t.h,c=e.h;i&&!n?l=c:n&&!i&&(e={...e,h:l},c=l);let h=Math.abs(c-l),f;const d=360;h<d/2?f=(c-l)*a:(h=d-h,l>c?f=h*a:f=-h*a);const p=(e.s-t.s)*a,m=(e.v-t.v)*a;let{s:b,v:y}=t,g=l;if(s){const T=s/a;g=(g+T*f+d)%d,b+=T*p,y+=T*m}const C=[];for(let T=0;T<o-1;T++)C.push({h:g,s:b,v:y}),g=(g+f+d)%d,b+=p,y+=m;return C.push(u?{h:g,s:b,v:y}:e),C}function mo(t,e,r){const{numColors:o,distanceOffset:s,distanceInterval:a,isCustomInterval:u}=r;let{l:i,a:n,b:l}=t;const c=(e.l-i)*a,h=(e.a-n)*a,f=(e.b-l)*a,d=[];if(s){const p=s/a;i+=p*c,n+=p*h,l+=p*f}for(let p=0;p<o-1;p++)d.push({l:i,a:n,b:l}),i+=c,n+=h,l+=f;return d.push(u?{l:i,a:n,b:l}:e),d}function go(t,e,r){const{numColors:o,distanceOffset:s,distanceInterval:a,isCustomInterval:u}=r,i=t.h,n=e.h,l=2*Math.PI;let c;if(i<=n){const g=n-i,C=n-i-l;c=Math.abs(C)<Math.abs(g)?C:g}else{const g=n+l-i,C=n-i;c=Math.abs(C)<Math.abs(g)?C:g}const h=c*a,f=(e.l-t.l)*a,d=(e.c-t.c)*a;let{l:p,c:m,h:b}=t;if(s){const g=s/a;p+=g*f,m+=g*d,b=(b+g*h+l)%l}const y=[];for(let g=0;g<o-1;g++)y.push({l:p,c:m,h:b}),p+=f,m+=d,b=(b+h+l)%l;return y.push(u?{l:p,c:m,h:b}:e),y}function tr(t,e){let{fromColor:r,toColor:o}=t;r.length===3&&(r=r.concat([255])),o.length===3&&(o=o.concat([255]));const s=t.algorithm||"esriCIELabAlgorithm",a=er(e),{numColors:u,distanceOffset:i,isCustomInterval:n,interpolateAlpha:l}=a;if(u===1&&i===0)return[r];if(u===2&&i===0&&!n)return[r,o];const c={r:r[0],g:r[1],b:r[2]},h={r:o[0],g:o[1],b:o[2]},f=s==="esriCIELabAlgorithm"?mo(It(c),It(h),a):s==="esriHSVAlgorithm"?po(Ke(c),Ke(h),a):go(kt(c),kt(h),a),d=[],p=r[3]??255,b=((o[3]??255)-p)/(u-1);for(let y=0;y<u;y++){const{r:g,g:C,b:T}=gr(f[y]),x=l?Math.round(p+b*y):255;d.push([g,C,T,x])}return d}function xo(t,e){const{numColors:r,interpolateAlpha:o}=er(e);let s=e==null?void 0:e.weights;const{colorRamps:a}=t;if(s){const f=s.reduce((d,p)=>d+p);s=s.map(d=>d/f)}else{s=[];for(let f=0;f<a.length;f++)s[f]=1/a.length}const u=[];let i=0,n=0;const l=1/(r-1);let c=!1;for(let f=0;f<a.length;f++){let d=c?0:i*l-n,p=f===a.length-1?r-1-i:(s[f]-d)/l;if(c=Math.ceil(p)===p,p=Math.ceil(p),p===0)continue;d/=s[f];const m=tr(a[f],{numColors:p,interpolateAlpha:o,distanceOffset:d,distanceInterval:l/s[f]});i+=m.length,u.push(...m),n+=s[f]}const h=[...a[a.length-1].toColor];return h.length===3&&h.push(255),u.push(h),u}function yo(t,e){const r="toJSON"in t?t.toJSON():t;return r.type==="multipart"?xo(r,e):tr(r,e)}function Ft(t,e){const r=yo(t,e),o=e==null?void 0:e.interpolateAlpha;return r.forEach((s,a)=>{s.unshift(a),o||s.pop()}),r}function Wo(t){const e=ho(t);if(t){if(t.type==="algorithmic")return{...Mt(t),Name:e};if(t.colorRamps){const r=t.colorRamps.map(Mt);return{type:"MultiPartColorRamp",NumColorRamps:r.length,ArrayOfColorRamp:r,Name:e}}}}function Mt(t){if(!t)return;const e=t.toJSON();return{Algorithm:(e==null?void 0:e.Algorithm)||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:Gt(t.fromColor),ToColor:Gt(t.toColor)}}function Gt(t){const e=Ke(t);return{type:"HsvColor",Hue:e.h,Saturation:e.s,Value:e.v,AlphaValue:255}}function Yo(t){const e=t.reverse().map(r=>{const o=r.toString(16);return o.length<2?"0"+o:o});return 4294967295&Number.parseInt(e.join(""),16)}const Ho=new Nt({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),Co={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"},rt=1,vo=[.299,.587,.114];function rr(t,e=256){e=Math.min(e,256);const{size:r,counts:o}=t,s=new Uint8Array(r),a=o.reduce((c,h)=>c+h/e,0);let u=0,i=0,n=0,l=a;for(let c=0;c<r;c++)if(n+=o[c],!(c<r-1&&n+o[c+1]<l)){for(;u<e-1&&l<n;)u++,l+=a;for(let h=i;h<=c;h++)s[h]=u;i=c+1}for(let c=i;c<r;c++)s[c]=e-1;return s}function Bt(t){const{minCutOff:e,maxCutOff:r,gamma:o,pixelType:s,rounding:a}=t,u=t.outMin||0,i=t.outMax||255;if(!["u8","u16","s8","s16"].includes(s))return null;const n=e.length;let l,c,h=0;s==="s8"?h=-127:s==="s16"&&(h=-32767);let f=256;["u16","s16"].includes(s)&&(f=65536);const d=[],p=[],m=i-u;for(l=0;l<n;l++)p[l]=r[l]-e[l],d[l]=p[l]===0?0:m/p[l];let b;const y=[];let g,C,T;if(o&&o.length>=n){const S=or(n,o);for(l=0;l<n;l++){for(T=[],c=0;c<f;c++){if(p[l]===0){T[c]=u;continue}if(g=c+h,b=(g-e[l])/p[l],C=1,o[l]>1&&(C-=(1/m)**(b*S[l])),g<r[l]&&g>e[l]){const A=C*m*b**(1/o[l])+u;T[c]=a==="floor"?Math.floor(A):a==="round"?Math.round(A):A}else g>=r[l]?T[c]=i:T[c]=u}y[l]=T}}else for(l=0;l<n;l++){for(T=[],c=0;c<f;c++)if(g=c+h,g<=e[l])T[c]=u;else if(g>=r[l])T[c]=i;else{const S=(g-e[l])*d[l]+u;T[c]=a==="floor"?Math.floor(S):a==="round"?Math.round(S):S}y[l]=T}if(t.contrastOffset!=null){const S=bo(t.contrastOffset,t.brightnessOffset);for(l=0;l<n;l++)for(T=y[l],c=0;c<f;c++)T[c]=S[T[c]]}return{lut:y,offset:h}}function bo(t,e){const r=Math.min(Math.max(t,-100),100),o=Math.min(Math.max(e??0,-100),100),s=255,a=128;let u=0,i=0;const n=new Uint8Array(256);for(u=0;u<256;u++)r>0&&r<100?i=(200*u-100*s+2*s*o)/(2*(100-r))+a:r<=0&&r>-100?i=(200*u-100*s+2*s*o)*(100+r)/2e4+a:r===100?(i=200*u-100*s+(s+1)*(100-r)+2*s*o,i=i>0?s:0):r===-100&&(i=a),n[u]=i>s?s:i<0?0:i;return n}function wo(t,e,r){const o=[];for(let s=0;s<e.length;s++){let a=0,u=0,i=0;"min"in e[s]?{min:a,max:u,avg:i}=e[s]:[a,u,i]=e[s];let n=i??0;t!=="u8"&&(n=255*(n-a)/(u-a)),r&&(n=n*vo[s]),o.push(To(n))}return o}function To(t){if(t<=0||t>=255)return rt;let e=0;t!==150&&(e=t<=150?45*Math.cos(.01047*t):17*Math.sin(.021*t));const r=255,o=t+e,s=Math.log(t/r),a=Math.log(o/r);if(a===0)return rt;const u=s/a;return isNaN(u)?rt:Math.min(9.9,Math.max(.01,u))}function So(t,e,r,o){let s=1/0,a=-1/0,u=0,i=0;const n=t.length;for(let g=0;g<n;g++){const C=t[g];(!e||e[g])&&(s=C<s?C:s,a=C>a?C:a,u+=C,i++)}if(i===0)return{statistics:{min:0,max:0,avg:0,stddev:0},histogram:null};const l=u/i;let c=0;for(let g=0;g<n;g++)(!e||e[g])&&(c+=(t[g]-l)**2);const h=e?e.filter(g=>g).length:n,f=h<=1?0:Math.sqrt(c/(h-1)),d={min:s,max:a,avg:l,stddev:f};if(!o)return{statistics:d,histogram:null};if(["u8","s8","u4","u2","u1"].includes(r)){const g=a-s+1,C=new Uint32Array(g);for(let T=0;T<n;T++)(!e||e[T])&&C[t[T]-s]++;return{statistics:d,histogram:{min:s-.5,max:a+.5,size:g,counts:C}}}const p=256,m=new Uint32Array(p),b=(a-s)/p;if(b===0)return{statistics:d,histogram:{min:s,max:a,size:1,counts:new Uint32Array(1).fill(i)}};const y=new Uint32Array(p+1);for(let g=0;g<n;g++)(!e||e[g])&&y[Math.floor((t[g]-s)/b)]++;for(let g=0;g<p-1;g++)m[g]=y[g];return m[p-1]=y[p-1]+y[p],{statistics:d,histogram:{min:s,max:a,size:p,counts:m}}}function Ko(t){const{pixels:e,mask:r,pixelType:o}=t,s=e.map(i=>So(i,r,o,!0)),a=s.map(({statistics:i})=>i),u=s.map(({histogram:i})=>i);return{statistics:a,histograms:u}}function Ao(t){var w;if(t==null||!((w=t.pixels)!=null&&w.length))return null;const{pixels:e,mask:r,pixelType:o}=t,s=t.width*t.height,a=e.length;let u,i,n,l,c;const h=[],f=[];let d,p,m,b,y,g,C,T,x,S;const A=256;for(l=0;l<a;l++){if(d=new Uint32Array(A),m=e[l],o==="u8")if(u=-.5,i=255.5,r)for(c=0;c<s;c++)r[c]&&d[m[c]]++;else for(c=0;c<s;c++)d[m[c]]++;else{let v=!1;t.statistics||(t.updateStatistics(),v=!0);const k=t.statistics;if(u=k[l].minValue,i=k[l].maxValue,n=(i-u)/A,n===0){k&&!t.validPixelCount&&!v&&t.updateStatistics();const I=(t.validPixelCount||t.width*t.height)/A;for(let P=0;P<A;P++)d[P]=Math.round(I*(P+1))-Math.round(I*P)}else{for(p=new Uint32Array(A+1),c=0;c<s;c++)(!r||r[c])&&p[Math.floor((m[c]-u)/n)]++;for(c=0;c<A-1;c++)d[c]=p[c];d[A-1]=p[A-1]+p[A]}}for(h.push({min:u,max:i,size:A,counts:d}),b=0,y=0,T=0,c=0;c<A;c++)b+=d[c],y+=c*d[c];for(x=y/b,c=0;c<A;c++)T+=d[c]*(c-x)**2;S=Math.sqrt(T/(b-1)),n=(i-u)/A,g=(x+.5)*n+u,C=S*n,f.push({min:u,max:i,avg:g,stddev:C})}return{statistics:f,histograms:h}}function qo(t){const e=[];for(let r=0;r<t.length;r++){const{min:o,max:s,size:a,counts:u}=t[r];let i=0,n=0;for(let m=0;m<a;m++)i+=u[m],n+=m*u[m];const l=n/i;let c=0;for(let m=0;m<a;m++)c+=u[m]*(m-l)**2;const h=Math.sqrt(c/(i-1)),f=(s-o)/a,d=(l+.5)*f+o,p=h*f;e.push({min:o,max:s,avg:d,stddev:p})}return e}function Be(t,e){var R;const{pixelBlock:r,bandIds:o,returnHistogramLut:s,rasterInfo:a}=e;let u=null,i=null,n=t.stretchType;if(typeof n=="number"&&(n=Co[n]),t.dra)if(n==="minMax"&&r!=null&&r.statistics)u=r.statistics.map(I=>[I.minValue,I.maxValue,0,0]);else{const I=Ao(r);u=I!=null?I.statistics:null,i=I!=null?I.histograms:null}else u=((R=t.statistics)==null?void 0:R.length)>0?t.statistics:a.statistics,i="histograms"in t?t.histograms:void 0,i||(i=a.histograms);(n==="percentClip"||n==="histogramEqualization")&&!(i!=null&&i.length)&&(n="minMax");const l=(u==null?void 0:u.length)||(i==null?void 0:i.length)||a.bandCount,c=[],h=[];let f,d,p,m,b,y,g,C,T;u&&!Array.isArray(u[0])&&(u=u.map(I=>[I.min,I.max,I.avg,I.stddev]));const[x,S]=pr(a.pixelType);if(!(u!=null&&u.length)){for(u=[],C=0;C<l;C++)u.push([x,S,1,1]);n==="standardDeviation"&&(n="minMax")}switch(n){case"none":for(C=0;C<l;C++)c[C]=x,h[C]=S;break;case"minMax":for(C=0;C<l;C++){const I=u[C];c[C]=I[0],h[C]=I[1]}break;case"standardDeviation":for(C=0;C<l;C++){const I=u[C];c[C]=I[2]-t.numberOfStandardDeviations*I[3],h[C]=I[2]+t.numberOfStandardDeviations*I[3],c[C]<I[0]&&(c[C]=I[0]),h[C]>I[1]&&(h[C]=I[1])}break;case"histogramEqualization":for(Ye(i),C=0;C<l;C++)c[C]=i[C].min,h[C]=i[C].max;break;case"percentClip":for(Ye(i),C=0;C<i.length;C++){for(f=i[C],b=new Uint32Array(f.size),m=[...f.counts],m.length>=20&&(m[0]=m[1]=m[2]=m[m.length-1]=m[m.length-2]=0),p=0,d=(f.max-f.min)/f.size,g=f.min===-.5&&d===1?.5:0,T=0;T<f.size;T++)p+=m[T],b[T]=p;for(y=(t.minPercent||0)*p/100,c[C]=f.min+g,T=0;T<f.size;T++)if(b[T]>y){c[C]=f.min+d*(T+g);break}for(y=(1-(t.maxPercent||0)/100)*p,h[C]=f.max+g,T=f.size-2;T>=0;T--)if(b[T]<y){h[C]=f.min+d*(T+2-g);break}if(h[C]<c[C]){const L=c[C];c[C]=h[C],h[C]=L}}break;default:for(C=0;C<l;C++){const I=u[C];c[C]=I[0],h[C]=I[1]}}let A,w,v;return n==="histogramEqualization"?(Ye(i),w=i[0].size||256,A=0,s&&(v=i.map(I=>rr(I)))):(w=t.max||255,A=t.min||0),Io({minCutOff:c,maxCutOff:h,outMax:w,outMin:A,histogramLut:v},o)}function Io(t,e){if(e==null||e.length===0)return t;const r=Math.max.apply(null,e),{minCutOff:o,maxCutOff:s,outMin:a,outMax:u,histogramLut:i}=t;return o.length===e.length||o.length<=r?t:{minCutOff:e.map(n=>o[n]),maxCutOff:e.map(n=>s[n]),histogramLut:i?e.map(n=>i[n]):null,outMin:a,outMax:u}}function or(t,e){const r=new Float32Array(t);for(let o=0;o<t;o++)e[o]>1?e[o]>2?r[o]=6.5+(e[o]-2)**2.5:r[o]=6.5+100*(2-e[o])**4:r[o]=1;return r}function ot(t,e){var R;if(t==null||!((R=t.pixels)!=null&&R.length))return t;const{mask:r,width:o,height:s,pixels:a}=t,{minCutOff:u,maxCutOff:i,gamma:n}=e,l=e.outMin||0,c=e.outMax||255,h=o*s,f=e.outputPixelType||"u8",d=t.pixels.map(()=>se.createEmptyBand(f,h)),p=d.length;let m,b,y,g,C;const T=c-l,x=[],S=[];for(m=0;m<p;m++)S[m]=i[m]-u[m],x[m]=S[m]===0?0:T/S[m];const A=f.startsWith("u")||f.startsWith("s"),w=n&&n.length>=p,v=!!e.isRenderer;if(w){const I=or(p,n);for(b=0;b<h;b++)if(r==null||r[b])for(m=0;m<p;m++){if(S[m]===0){d[m][b]=l;continue}if(y=a[m][b],C=(y-u[m])/S[m],g=1,n[m]>1&&(g-=(1/T)**(C*I[m])),y<i[m]&&y>u[m]){const P=g*T*C**(1/n[m])+l;d[m][b]=v?Math.floor(P):A?Math.round(P):P}else y>=i[m]?d[m][b]=c:d[m][b]=l}}else for(b=0;b<h;b++)if(r==null||r[b])for(m=0;m<p;m++)if(y=a[m][b],y<i[m]&&y>u[m]){const I=(y-u[m])*x[m]+l;d[m][b]=v?Math.floor(I):A?Math.round(I):I}else y>=i[m]?d[m][b]=c:d[m][b]=l;const k=new se({width:o,height:s,mask:r,pixels:d,pixelType:f});return k.updateStatistics(),k}function ko(t,e){const{attributeTable:r,bandCount:o}=t;return!(r==null||o>1||e&&r.fields.find(a=>a.name.toLowerCase()===e.toLowerCase())==null)}function Ro(t){const{bandCount:e,dataType:r,pixelType:o}=t;return r==="elevation"||r==="generic"&&e===1&&(o==="s16"||o==="f32"||o==="f64")}function Po(t){const{bandCount:e,colormap:r}=t;return r!=null&&r.length>0&&e===1}let Ie=class extends Oe{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};this.lookup={rendererJSON:{}};let r;switch(e.type){case"uniqueValue":r=this._updateUVRenderer(e);break;case"rasterColormap":r=this._updateColormapRenderer(e);break;case"rasterStretch":r=this._updateStretchRenderer(e);break;case"classBreaks":r=this._updateClassBreaksRenderer(e);break;case"rasterShadedRelief":r=this._updateShadedReliefRenderer(e);break;case"vectorField":r=this._updateVectorFieldRenderer();break;case"flowRenderer":r=this._updateFlowRenderer();break}return r}symbolize(e){let r=e&&e.pixelBlock;if(!Ut(r))return r;if(e.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(r,e.simpleStretchParams);try{r.pixels.length>3&&(r=St(r,[0,1,2]));let o;switch(this.rendererJSON.type){case"uniqueValue":case"rasterColormap":o=this._symbolizeColormap(r);break;case"classBreaks":o=this._symbolizeClassBreaks(r);break;case"rasterStretch":o=this._symbolizeStretch(r,e.bandIds);break;case"rasterShadedRelief":{const s=e.extent,a=s.spatialReference.isGeographic,u={x:(s.xmax-s.xmin)/r.width,y:(s.ymax-s.ymin)/r.height};o=this._symbolizeShadedRelief(r,{isGCS:a,resolution:u});break}}return o}catch(o){return Tt.getLogger(this.declaredClass).error("symbolize",o.message),r}}simpleStretch(e,r){if(!Ut(e))return e;try{return e.pixels.length>3&&(e=St(e,[0,1,2])),ot(e,{...r,isRenderer:!0})}catch(o){return Tt.getLogger(this.declaredClass).error("symbolize",o.message),e}}generateWebGLParameters(e){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){const{indexedColormap:i,offset:n}=this.lookup.colormapLut||{};return{colormap:i,colormapOffset:n,type:"lut"}}const{pixelBlock:r,isGCS:o,resolution:s,bandIds:a}=e,{rendererJSON:u}=this;return u.type==="rasterStretch"?this._generateStretchWebGLParams(r,u,a):u.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(u,o,s??void 0):u.type==="vectorField"?this._generateVectorFieldWebGLParams(u):null}_isLUTChanged(e){if(!(this.lookup&&this.lookup.rendererJSON))return!0;if("colorRamp"in this.rendererJSON){const r=this.rendererJSON.colorRamp;return e?JSON.stringify(r)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):({...this.rendererJSON},{...this.lookup.rendererJSON},JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(e){return this._isLUTChanged()&&!this.bind().success?e:et(e,this.lookup.colormapLut)}_symbolizeClassBreaks(e){const{canUseIndexedLUT:r}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?e:r?et(e,this.lookup.colormapLut):mr(e,this.lookup.remapLut??[])}_symbolizeStretch(e,r){var f,d;const{rasterInfo:o}=this,{pixelType:s,bandCount:a}=o,u=this.rendererJSON,i=["u8","u16","s8","s16"].includes(s);let n,l;const{dra:c}=u,{gamma:h}=this.lookup;if(u.stretchType==="histogramEqualization"){const p=c?null:(f=this.lookup)==null?void 0:f.histogramLut,m=Be(u,{rasterInfo:o,pixelBlock:e,bandIds:r,returnHistogramLut:!p}),b=ot(e,{...m,gamma:h,isRenderer:!0});l=At(b,{lut:c?m.histogramLut:p,offset:0})}else if(i){if(c){const p=Be(u,{rasterInfo:o,pixelBlock:e,bandIds:r});n=Bt({pixelType:s,...p,gamma:h,rounding:"floor"})}else if(this._isLUTChanged()){if(!this.bind().success)return e;n=this.lookup?this.lookup.stretchLut:null}else n=this.lookup?this.lookup.stretchLut:null;if(!n)return e;a>1&&r!=null&&r.length===(e==null?void 0:e.pixels.length)&&(n==null?void 0:n.lut.length)===a&&(n={lut:r.map(p=>n.lut[p]),offset:n.offset}),l=At(e,n)}else{const p=Be(u,{rasterInfo:o,pixelBlock:e,bandIds:r});l=ot(e,{...p,gamma:h,isRenderer:!0})}if(u.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;l=et(l,(d=this.lookup)==null?void 0:d.colormapLut)}return l}_symbolizeShadedRelief(e,r){var n;const o=this.rendererJSON,s={...o,...r},a=lo(e,s);if(!o.colorRamp)return a;let u;if(this._isLUTChanged(!0)){if(!this.bind().success)return a;u=this.lookup?this.lookup.hsvMap:null}else u=this.lookup?this.lookup.hsvMap:null;if(!u)return a;const i=((n=this.rasterInfo.statistics)==null?void 0:n[0])??{min:0,max:8e3};return co(a,e,u,i),a}_isVectorFieldData(){const{bandCount:e,dataType:r}=this.rasterInfo;return e===2&&(r==="vector-magdir"||r==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){var c;const{bandCount:r,attributeTable:o,pixelType:s}=this.rasterInfo,a=e.field1;if(!a)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const u=e.defaultSymbol,i=r===1&&["u8","s8"].includes(s);if(!(ko(this.rasterInfo,a)||i))return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};const n=[];if(o!=null){const h=o.fields.find(f=>f.name.toLowerCase()==="value");if(!h)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};o.features.forEach(f=>{var m,b;const d=(m=e.uniqueValueInfos)==null?void 0:m.find(y=>String(y.value)===String(f.attributes[a])),p=(b=d==null?void 0:d.symbol)==null?void 0:b.color;p?n.push([f.attributes[h.name]].concat(p)):u&&n.push([f.attributes[h.name]].concat(u.color))})}else{if(a.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not availalbe.'};(c=e.uniqueValueInfos)==null||c.forEach(h=>{var d;const f=(d=h==null?void 0:h.symbol)==null?void 0:d.color;f?n.push([parseInt(""+h.value,10)].concat(f)):u&&n.push([parseInt(""+h.value,10)].concat(u==null?void 0:u.color))})}if(n.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};const l=Ge({colormap:n});return this.lookup={rendererJSON:e,colormapLut:l},this.canRenderInWebGL=!0,{success:!0}}_updateColormapRenderer(e){if(!Po(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};const r=e.colormapInfos.map(s=>[s.value].concat(s.color)).sort((s,a)=>s[0]-a[0]);if(!r||r.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};const o=Ge({colormap:r});return this.lookup={rendererJSON:e,colormapLut:o},this.canRenderInWebGL=!0,{success:!0}}_updateShadedReliefRenderer(e){if(!Ro(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(e.colorRamp){const r=Ft(e.colorRamp,{interpolateAlpha:!0}),o=Ge({colormap:r}),s=[],a=o.indexedColormap;for(let u=0;u<a.length;u+=4){const i=Ke({r:a[u],g:a[u+1],b:a[u+2]});s.push([i.h/60,i.s/100,i.v*255/100])}this.lookup={rendererJSON:e,colormapLut:o,hsvMap:s}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(e){const{attributeTable:r,pixelType:o}=this.rasterInfo,s=r!=null?r.fields.find(n=>n.name.toLowerCase()==="value"):null,a=r!=null?r.fields.find(n=>n.name.toLowerCase()===e.field.toLowerCase()):null,u=s!=null&&a!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(o)||u,tableValueField:s,tableBreakField:a}}_updateClassBreaksRenderer(e){const{attributeTable:r}=this.rasterInfo,{canUseIndexedLUT:o,tableValueField:s,tableBreakField:a}=this._analyzeClassBreaks(e),u=e.classBreakInfos;if(!(u!=null&&u.length))return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};const i=u.sort((f,d)=>f.classMaxValue-d.classMaxValue),n=i[i.length-1];let l=e.minValue;if(!o){const f=[];for(let d=0;d<i.length;d++)f.push({value:i[d].classMinValue??l,mappedColor:i[d].symbol.color}),l=i[d].classMaxValue;return f.push({value:n.classMaxValue,mappedColor:n.symbol.color}),this.lookup={rendererJSON:e,remapLut:f},this.canRenderInWebGL=!1,{success:!0}}const c=[];if(r!=null&&s!=null&&a!==null&&s!==a){const f=s.name,d=a.name,p=i[i.length-1],{classMaxValue:m}=p;l=e.minValue;for(const b of r.features){const y=b.attributes[f],g=b.attributes[d],C=g===m?p:g<l?null:i.find(({classMaxValue:T})=>T>g);C&&c.push([y].concat(C.symbol.color))}}else{l=Math.floor(e.minValue);for(let f=0;f<i.length;f++){const d=i[f];for(let p=l;p<d.classMaxValue;p++)c.push([p].concat(d.symbol.color));l=Math.ceil(d.classMaxValue)}n.classMaxValue===l&&c.push([n.classMaxValue].concat(n.symbol.color))}const h=Ge({colormap:c,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:h},this.canRenderInWebGL=!0,{success:!0}}_isHistogramRequired(e){return e==="percentClip"||e==="histogramEqualization"}_isValidRasterStatistics(e){return e!=null&&e.length>0&&e[0].min!=null&&e[0].max!=null}_updateStretchRenderer(e){var h,f;let{stretchType:r,dra:o}=e;if(!(r==="none"||(h=e.statistics)!=null&&h.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||o))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};const s=e.histograms||this.rasterInfo.histograms;this._isHistogramRequired(e.stretchType)&&!(s!=null&&s.length)&&!o&&(r="minMax");const{computeGamma:a,useGamma:u,colorRamp:i}=e;let{gamma:n}=e;if(u&&a&&!(n!=null&&n.length)){const d=(f=e.statistics)!=null&&f.length?e.statistics:this.rasterInfo.statistics;n=wo(this.rasterInfo.pixelType,d)}const l=this.rasterInfo.pixelType,c=!o&&["u8","u16","s8","s16"].includes(l);if(r==="histogramEqualization"){const d=s.map(p=>rr(p));this.lookup={rendererJSON:e,histogramLut:d}}else if(c){const d=Be(e,{rasterInfo:this.rasterInfo}),p=Bt({pixelType:l,...d,gamma:u?n:null,rounding:"floor"});this.lookup={rendererJSON:e,stretchLut:p}}if(i){const d=Ft(i,{interpolateAlpha:!0});this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=Ge({colormap:d}),this.lookup.rendererJSON=e}return this.lookup.gamma=u&&(n!=null&&n.length)?n:null,this.canRenderInWebGL=!0,{success:!0}}_generateStretchWebGLParams(e,r,o){let s=null,a=null;const u=this.lookup&&this.lookup.colormapLut;r.colorRamp&&u&&(s=u.indexedColormap,a=u.offset),r.stretchType==="histogramEqualization"&&(r={...r,stretchType:"minMax"});const{gamma:i}=this.lookup,n=!!(r.useGamma&&i&&i.some(T=>T!==1)),{minCutOff:l,maxCutOff:c,outMin:h,outMax:f}=Be(r,{rasterInfo:this.rasterInfo,pixelBlock:e,bandIds:o});let d=0;e!=null&&(d=e.getPlaneCount(),d===2&&(e=e.clone(),e.statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const{bandCount:p}=this.rasterInfo,m=Math.min(3,(o==null?void 0:o.length)||d||p,p),b=new Float32Array(m),y=s||n?1:255;let g;for(g=0;g<l.length;g++)b[g]=c[g]===l[g]?0:(f-h)/(c[g]-l[g])/y;const C=new Float32Array(m);if(n&&i)for(g=0;g<m;g++)i[g]>1?i[g]>2?C[g]=6.5+(i[g]-2)**2.5:C[g]=6.5+100*(2-i[g])**4:C[g]=1;return{bandCount:m,outMin:h/y,outMax:f/y,minCutOff:l,maxCutOff:c,factor:b,useGamma:n,gamma:n?i:[1,1,1],gammaCorrection:n?C:[1,1,1],colormap:s,colormapOffset:a,stretchType:r.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(e,r=!1,o={x:0,y:0}){var c;let s=null,a=null;const u=this.lookup&&this.lookup.colormapLut;e.colorRamp&&u&&(s=u.indexedColormap,a=u.offset);const i={...e,isGCS:r,resolution:o},n=$t(i),l=(c=this.rasterInfo.statistics)==null?void 0:c[0];return{...n,minValue:(l==null?void 0:l.min)??0,maxValue:(l==null?void 0:l.max)??8e3,hillshadeType:e.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:s,colormapOffset:a}}_generateVectorFieldWebGLParams(e){var S,A,w;const{style:r,inputUnit:o,outputUnit:s,visualVariables:a,symbolTileSize:u,flowRepresentation:i}=e;let n;const l=((S=this.rasterInfo.statistics)==null?void 0:S[0].min)??0,c=((A=this.rasterInfo.statistics)==null?void 0:A[0].max)??50,h=(a==null?void 0:a.find(v=>v.type==="sizeInfo"))??{type:"sizeInfo",field:"Magnitude",maxDataValue:c,maxSize:u*.8,minDataValue:l,minSize:u*.2},f=h.minDataValue??l,d=h.maxDataValue??c,p=h.maxSize!=null&&h.minSize!=null?[h.minSize/u,h.maxSize/u]:[.2,.8];if(r==="wind_speed"){const v=(p[0]+p[1])/2;p[0]=p[1]=v}const m=f!=null&&d!=null?[f,d]:null;if(r==="classified_arrow")if(f!=null&&d!=null&&h!=null){n=[];const v=(h.maxDataValue-h.minDataValue)/5;for(let k=0;k<6;k++)n.push(h.minDataValue+v*k)}else n=[0,1e-6,3.5,7,10.5,14];const g=i==="flow_to"===(r==="ocean_current_kn"||r==="ocean_current_m")?0:Math.PI,C=a==null?void 0:a.find(v=>v.type==="rotationInfo"),x=((w=this.rasterInfo.storageInfo)==null?void 0:w.tileInfo)&&this.rasterInfo.dataType==="vector-uv"?"geographic":(C==null?void 0:C.rotationType)||e.rotationType;return{breakValues:n,dataRange:m,inputUnit:o,outputUnit:s,symbolTileSize:u,symbolPercentRange:p,style:r||"single_arrow",rotation:g,rotationType:x,type:"vectorField"}}};M([O({json:{write:!0}})],Ie.prototype,"rendererJSON",void 0);M([O({type:ao,json:{write:!0}})],Ie.prototype,"rasterInfo",void 0);M([O({json:{write:!0}})],Ie.prototype,"lookup",void 0);M([O()],Ie.prototype,"canRenderInWebGL",void 0);Ie=M([Ue("esri.renderers.support.RasterSymbolizer")],Ie);function Ut(t){return Se(t)&&t.validPixelCount!==0}const Jo=Ie;export{Vr as A,Ht as B,Kt as C,Ct as D,zr as E,Ur as F,Pe as G,vt as H,Zt as P,Jo as R,Ee as T,ao as a,No as b,Ko as c,Fo as d,Ao as e,uo as f,yo as g,Ft as h,jo as i,Vo as j,Be as k,Bt as l,ot as m,or as n,Wo as o,Ho as p,ho as q,zo as r,Oo as s,Yo as t,so as u,Lo as v,Co as w,Ir as x,qo as y,xt as z};
